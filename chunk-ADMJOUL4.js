import{a as p}from"./chunk-O4QGXHKX.js";import{a as h}from"./chunk-CQ6SLR32.js";import{a as t}from"./chunk-C3MGKPDK.js";import{A as c}from"./chunk-HUSU2JWO.js";import{Z as l,ba as a,ca as u,g as n,r as o}from"./chunk-HCNG3XRF.js";var m=class i{constructor(e,r){this.http=e;this.sessionStorage=r;this.currentUserSubject=new n(this.sessionStorage.getItem("currentUser")),this.currentUser=this.currentUserSubject.asObservable();let s=localStorage.getItem("userRole");s&&this.currentUserRole.next(JSON.parse(s))}currentUserSubject;currentUser;apiUrl=`${t.apiUrl}/auth`;currentUserRole=new n(null);permissionCache=new Map;rolesService=u(p);setUserRole(e){this.permissionCache.clear(),localStorage.setItem("userRole",JSON.stringify(e)),this.currentUserRole.next(e)}getUserRole(){return this.currentUserRole.asObservable()}getCurrentRole(){return this.currentUserRole.getValue()}hasPermission(e){return this.currentUserRole.getValue()?Array.isArray(e)?e.some(s=>this.checkSinglePermission(s)):this.checkSinglePermission(e):!1}checkSinglePermission(e){if(this.permissionCache.has(e))return this.permissionCache.get(e)||!1;let r=this.currentUserRole.getValue();if(!r||!r.permissions)return!1;let s=r.permissions.some(g=>g.code===e);return this.permissionCache.set(e,s),s}hasAllPermissions(e){return e.every(r=>this.hasPermission(r))}hasAnyPermission(e){return e.some(r=>this.hasPermission(r))}getPermissionsByModule(e){let r=this.currentUserRole.getValue();return!r||!r.permissions?[]:r.permissions.filter(s=>s.module.toLowerCase()===e.toLowerCase())}hasModuleAccess(e){return this.getPermissionsByModule(e).length>0}clearPermissions(){this.permissionCache.clear(),localStorage.removeItem("userRole"),this.currentUserRole.next(null)}get currentUserValue(){return this.currentUserSubject.value}login(e,r){return this.http.post(`${t.apiUrl}/auth/login?user=merchant`,{email:e,password:r}).pipe(o(s=>(console.log(s.user),this.sessionStorage.setItem("currentUser",s.user),this.sessionStorage.setItem("auth_token",s.access_token),this.currentUserSubject.next(s.user),s.user)))}signup(e){return this.http.post(`${t.apiUrl}/merchants`,e).pipe(o(r=>r))}logout(){this.rolesService.clearAccess(),this.sessionStorage.removeItem("currentUser"),this.sessionStorage.clearAll(),this.currentUserSubject.next(null)}resetPassword(e){return this.http.post(`${this.apiUrl}/rest-password`,{email:e},{params:{userType:"merchant"}})}verifyResetToken(e,r){return this.http.post(`${this.apiUrl}/verify-code`,{email:e,resetToken:r},{params:{userType:"merchant"}})}updatePassword(e,r){return this.http.post(`${this.apiUrl}/update-password`,{email:e,newPassword:r},{params:{userType:"merchant"}})}changePassword(e,r,s){return this.http.post(`${this.apiUrl}/change-password`,{email:e,currentPassword:r,newPassword:s},{params:{userType:"merchant"}})}static \u0275fac=function(r){return new(r||i)(a(c),a(h))};static \u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})};export{m as a};
