import{X as d}from"./chunk-X4GPFF2S.js";import{$ as x,Ec as C,Gc as k,Hc as w,W as D,Z as u,d as y,ea as p,g as S,qa as m,ua as f}from"./chunk-EV5SF5GC.js";import{a as v,b as E}from"./chunk-EQDQRRRY.js";function N(r){r||(r=p(m));let e=new y(t=>{if(r.destroyed){t.next();return}return r.onDestroy(t.next.bind(t))});return t=>t.pipe(D(e))}function z(r,e){let n=!e?.manualCleanup?e?.injector?.get(m)??p(m):null,o=M(e?.equal),s;e?.requireSync?s=f({kind:0},{equal:o}):s=f({kind:1,value:e?.initialValue},{equal:o});let a,l=r.subscribe({next:i=>s.set({kind:1,value:i}),error:i=>{s.set({kind:2,error:i}),a?.()},complete:()=>{a?.()}});if(e?.requireSync&&s().kind===0)throw new u(601,!1);return a=n?.onDestroy(l.unsubscribe.bind(l)),C(()=>{let i=s();switch(i.kind){case 1:return i.value;case 2:throw i.error;case 0:throw new u(601,!1)}},{equal:e?.equal})}function M(r=Object.is){return(e,t)=>e.kind===1&&t.kind===1&&r(e.value,t.value)}function G(r){return k(E(v({},r),{loader:void 0,stream:e=>{let t,n=()=>t.unsubscribe();e.abortSignal.addEventListener("abort",n);let o=f({value:void 0}),s,a=new Promise(c=>s=c);function l(c){o.set(c),s?.(o),s=void 0}let i=r.stream??r.loader;if(i===void 0)throw new u(990,!1);return t=i(e).subscribe({next:c=>l({value:c}),error:c=>{l({error:w(c)}),e.abortSignal.removeEventListener("abort",n)},complete:()=>{s&&l({error:new u(991,!1)}),e.abortSignal.removeEventListener("abort",n)}}),a}}))}var I=(()=>{class r{_listeners=[];notify(t,n){for(let o of this._listeners)o(t,n)}listen(t){return this._listeners.push(t),()=>{this._listeners=this._listeners.filter(n=>t!==n)}}ngOnDestroy(){this._listeners=[]}static \u0275fac=function(n){return new(n||r)};static \u0275prov=x({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var _=class{applyChanges(e,t,n,o,s){e.forEachOperation((a,l,i)=>{let c,h;if(a.previousIndex==null){let g=n(a,l,i);c=t.createEmbeddedView(g.templateRef,g.context,g.index),h=d.INSERTED}else i==null?(t.remove(l),h=d.REMOVED):(c=t.get(l),t.move(c,i),h=d.MOVED);s&&s({context:c?.context,operation:h,record:a})})}detach(){}};var b=class{_multiple;_emitChanges;compareWith;_selection=new Set;_deselectedToEmit=[];_selectedToEmit=[];_selected;get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}changed=new S;constructor(e=!1,t,n=!0,o){this._multiple=e,this._emitChanges=n,this.compareWith=o,t&&t.length&&(e?t.forEach(s=>this._markSelected(s)):this._markSelected(t[0]),this._selectedToEmit.length=0)}select(...e){this._verifyValueAssignment(e),e.forEach(n=>this._markSelected(n));let t=this._hasQueuedChanges();return this._emitChangeEvent(),t}deselect(...e){this._verifyValueAssignment(e),e.forEach(n=>this._unmarkSelected(n));let t=this._hasQueuedChanges();return this._emitChangeEvent(),t}setSelection(...e){this._verifyValueAssignment(e);let t=this.selected,n=new Set(e.map(s=>this._getConcreteValue(s)));e.forEach(s=>this._markSelected(s)),t.filter(s=>!n.has(this._getConcreteValue(s,n))).forEach(s=>this._unmarkSelected(s));let o=this._hasQueuedChanges();return this._emitChangeEvent(),o}toggle(e){return this.isSelected(e)?this.deselect(e):this.select(e)}clear(e=!0){this._unmarkAll();let t=this._hasQueuedChanges();return e&&this._emitChangeEvent(),t}isSelected(e){return this._selection.has(this._getConcreteValue(e))}isEmpty(){return this._selection.size===0}hasValue(){return!this.isEmpty()}sort(e){this._multiple&&this.selected&&this._selected.sort(e)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(e){e=this._getConcreteValue(e),this.isSelected(e)||(this._multiple||this._unmarkAll(),this.isSelected(e)||this._selection.add(e),this._emitChanges&&this._selectedToEmit.push(e))}_unmarkSelected(e){e=this._getConcreteValue(e),this.isSelected(e)&&(this._selection.delete(e),this._emitChanges&&this._deselectedToEmit.push(e))}_unmarkAll(){this.isEmpty()||this._selection.forEach(e=>this._unmarkSelected(e))}_verifyValueAssignment(e){e.length>1&&this._multiple}_hasQueuedChanges(){return!!(this._deselectedToEmit.length||this._selectedToEmit.length)}_getConcreteValue(e,t){if(this.compareWith){t=t??this._selection;for(let n of t)if(this.compareWith(e,n))return n;return e}else return e}};export{I as a,_ as b,b as c,N as d,z as e,G as f};
