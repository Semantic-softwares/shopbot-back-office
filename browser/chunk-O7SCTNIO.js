import{a as A,b as ot,c as rt,d as pt}from"./chunk-LOMVTW2P.js";import{a as nt,b as at,c as lt,d as mt,g as H}from"./chunk-ULL5FEQX.js";import{a as it}from"./chunk-OTISESC2.js";import{a as O,b as V}from"./chunk-4HWAAQBN.js";import"./chunk-MS4AQ6UA.js";import{a as Ae,b as He,c as je,d as Ge,e as Ue,f as Qe,g as ze,h as We,i as Ke,j as Ye,k as Je,l as Xe,m as B,n as tt}from"./chunk-MJSSRP5S.js";import{a as Ze,b as et}from"./chunk-GVVLVMJ4.js";import{c as fe}from"./chunk-CP7AR52L.js";import{a as Te,c as Ie,e as Pe}from"./chunk-TVZ5A6ZZ.js";import{c as N,d as Le,e as Ne,f as Re,j as R,k,l as F,m as q}from"./chunk-6YYGNHFV.js";import{a as I,b as he}from"./chunk-TSZNLSNS.js";import"./chunk-L3V4XNTA.js";import{a as qe,b as $e,c as Be,d as Oe}from"./chunk-W47L67LG.js";import{f as Ve}from"./chunk-WU5UPTYN.js";import"./chunk-MTGDZ7DV.js";import{b as P,d as f,g as L,h as Ee,l as Ce,m as Se,o as be,q as Me,t as ve,u as xe,v as De,w as we,x as ke,y as Fe}from"./chunk-DTRSFJFJ.js";import{N as _e,O as w,P as T,pa as ye,qa as ge,sa as $}from"./chunk-X4GPFF2S.js";import{i as ue,o as D,u as ce}from"./chunk-5RF4TXO5.js";import{$ as re,Bb as C,Cb as S,Eb as U,Fb as Q,Gb as z,Hb as m,Ib as r,Jb as i,Kb as u,Lb as y,Mb as g,Ob as ae,Sb as h,Tb as x,Xb as W,Y as oe,Yb as K,Za as l,Zb as Y,bc as le,ea as s,gc as n,hc as _,ic as J,jb as v,ka as j,kc as me,la as G,lc as pe,mc as se,pb as d,qc as de,ua as ne}from"./chunk-EV5SF5GC.js";import"./chunk-EQDQRRRY.js";var E=class e{http=s(ce);hostServer=ye.apiUrl;resetPassword(t){return this.http.post(`${this.hostServer}/auth/rest-password?userType=merchant`,t)}verifyCode(t){return this.http.post(`${this.hostServer}/auth/verify-code?userType=merchant`,t)}changePassword(t){return this.http.post(`${this.hostServer}/auth/update-password?userType=merchant`,t)}validateEmailAndPhoneNumber({email:t,phoneNumber:o}){return this.http.post(`${this.hostServer}/auth/validate-email-and-phone?userType=merchant`,{email:t,phoneNumber:o})}createMerchant(t){return this.http.post(`${this.hostServer}/merchants`,t)}getStoreMerchants(t){return this.http.get(`${this.hostServer}/merchants/find-by-store/${t}`)}deleteMerchant(t){return this.http.delete(`${this.hostServer}/merchants/${t}`)}updateMerchant(t,o){return this.http.put(`${this.hostServer}/merchants/${t}`,o)}register(t){return this.http.post(`${this.hostServer}/staffs`,t)}updatePassword(t){return this.http.post(`${this.hostServer}/staffs/update/password`,t)}static \u0275fac=function(o){return new(o||e)};static \u0275prov=re({token:e,factory:e.\u0275fac,providedIn:"root"})};function yt(e,t){e&1&&(r(0,"mat-error"),n(1," Name is required "),i())}function gt(e,t){if(e&1&&(r(0,"mat-option",9),n(1),i()),e&2){let o=t.$implicit;m("value",o),l(),_(o)}}function Et(e,t){e&1&&(r(0,"mat-error"),n(1," Gender is required "),i())}function Ct(e,t){if(e&1&&(r(0,"mat-option",9),n(1),i()),e&2){let o=t.$implicit;m("value",o),l(),_(o)}}function St(e,t){e&1&&(r(0,"mat-error"),n(1," Role is required "),i())}function bt(e,t){e&1&&(r(0,"mat-hint"),n(1,"Role cannot be changed for owners"),i())}function Mt(e,t){e&1&&(r(0,"mat-error"),n(1," Email is required "),i())}function vt(e,t){e&1&&(r(0,"mat-error"),n(1," Please enter a valid email address "),i())}function xt(e,t){e&1&&(r(0,"mat-error"),n(1," Phone number is required "),i())}function Dt(e,t){e&1&&(r(0,"mat-error"),n(1," PIN is required "),i())}function wt(e,t){e&1&&(r(0,"mat-error"),n(1," PIN must be exactly 4 digits "),i())}function Tt(e,t){e&1&&u(0,"mat-spinner",17)}var b=class e{storeStore=s($);fb=s(xe);userService=s(E);snackBar=s(I);dialogRef=s(nt);data=s(at);sessionStorage=s(ge);isSubmitting=ne(!1);roles=["Owner","Cashier","Waiter","Admin","Courier","Kitchen"];genders=["Male","Female"];isEdit=this.data.isEdit;form=this.fb.group({name:["",[f.required]],gender:["",[f.required]],email:["",[f.required,f.email]],phoneNumber:["",[f.required]],pin:["",[f.required,f.minLength(4),f.maxLength(4)]],role:[{value:"",disabled:this.isRoleDisabled()},[f.required]],store:[this.storeStore.selectedStore()?._id,f.required]});isRoleDisabled(){return this.isEdit&&this.data.employee?.role==="Owner"}ngOnInit(){this.isEdit&&this.data.employee&&this.form.patchValue(this.data.employee)}onSubmit(){if(this.form.valid){this.isSubmitting.set(!0);let t=this.form.getRawValue();(this.isEdit?this.userService.updateMerchant(this.data.employee._id,t):this.userService.createMerchant(t)).subscribe({next:()=>{this.snackBar.open(`Employee ${this.isEdit?"updated":"created"} successfully`,"Close",{duration:3e3}),this.dialogRef.close(!0)},error:()=>{this.snackBar.open(`Error ${this.isEdit?"updating":"creating"} employee`,"Close",{duration:3e3}),this.isSubmitting.set(!1)}})}}onCancel(){this.dialogRef.close()}static \u0275fac=function(o){return new(o||e)};static \u0275cmp=v({type:e,selectors:[["app-employee-dialog"]],decls:50,vars:15,consts:[[1,"p-6"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter employee name"],[4,"ngIf"],[1,"grid","grid-cols-2","gap-4"],["formControlName","gender"],[3,"value"],["formControlName","role"],["matInput","","formControlName","email","type","email","placeholder","Enter email address"],["matInput","","formControlName","phoneNumber","placeholder","Enter phone number"],["matInput","","formControlName","pin","type","password","maxlength","4","placeholder","Enter 4-digit PIN"],[1,"flex","justify-end","space-x-2","mt-6","pt-4","border-t","border-gray-200"],["mat-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",1,"mr-2"]],template:function(o,a){if(o&1&&(r(0,"div",0)(1,"h2",1),n(2),i(),r(3,"form",2),h("ngSubmit",function(){return a.onSubmit()}),r(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),n(7,"Name"),i(),u(8,"input",5),d(9,yt,2,0,"mat-error",6),i(),r(10,"div",7)(11,"mat-form-field",4)(12,"mat-label"),n(13,"Gender"),i(),r(14,"mat-select",8),Q(15,gt,2,2,"mat-option",9,U),i(),d(17,Et,2,0,"mat-error",6),i(),r(18,"mat-form-field",4)(19,"mat-label"),n(20,"Role"),i(),r(21,"mat-select",10),Q(22,Ct,2,2,"mat-option",9,U),i(),d(24,St,2,0,"mat-error",6),C(25,bt,2,0,"mat-hint"),i()(),r(26,"mat-form-field",4)(27,"mat-label"),n(28,"Email"),i(),u(29,"input",11),d(30,Mt,2,0,"mat-error",6)(31,vt,2,0,"mat-error",6),i(),r(32,"div",7)(33,"mat-form-field",4)(34,"mat-label"),n(35,"Phone Number"),i(),u(36,"input",12),d(37,xt,2,0,"mat-error",6),i(),r(38,"mat-form-field",4)(39,"mat-label"),n(40,"PIN"),i(),u(41,"input",13),d(42,Dt,2,0,"mat-error",6)(43,wt,2,0,"mat-error",6),i()()(),r(44,"div",14)(45,"button",15),h("click",function(){return a.onCancel()}),n(46,"Cancel"),i(),r(47,"button",16),C(48,Tt,1,0,"mat-spinner",17),n(49),i()()()()),o&2){let p,c,X,Z,ee,te,ie,M;l(2),J(" ",a.isEdit?"Edit Employee":"Create New Employee"," "),l(),m("formGroup",a.form),l(6),m("ngIf",(p=a.form.get("name"))==null?null:p.hasError("required")),l(6),z(a.genders),l(2),m("ngIf",(c=a.form.get("gender"))==null?null:c.hasError("required")),l(5),z(a.roles),l(2),m("ngIf",(X=a.form.get("role"))==null?null:X.hasError("required")),l(),S(a.isRoleDisabled()?25:-1),l(5),m("ngIf",(Z=a.form.get("email"))==null?null:Z.hasError("required")),l(),m("ngIf",(ee=a.form.get("email"))==null?null:ee.hasError("email")),l(6),m("ngIf",(te=a.form.get("phoneNumber"))==null?null:te.hasError("required")),l(5),m("ngIf",(ie=a.form.get("pin"))==null?null:ie.hasError("required")),l(),m("ngIf",((M=a.form.get("pin"))==null?null:M.hasError("minlength"))||((M=a.form.get("pin"))==null?null:M.hasError("maxlength"))),l(2),m("disabled",a.isSubmitting()),l(2),m("disabled",!a.form.valid||a.isSubmitting()),l(),S(a.isSubmitting()?48:-1),l(),J(" ",a.isEdit?"Update":"Create"," ")}},dependencies:[D,ue,H,mt,T,w,k,R,N,Ne,Le,q,F,et,Ze,fe,we,Se,P,L,Ee,ve,be,Me,V,O],encapsulation:2})};var It=()=>[5,10,25,100];function Pt(e,t){e&1&&(r(0,"div",10),u(1,"mat-spinner",14),i())}function Lt(e,t){e&1&&u(0,"app-no-record",11)}function Nt(e,t){e&1&&u(0,"app-no-record",12)}function Rt(e,t){e&1&&(r(0,"th",28),n(1,"Name"),i())}function kt(e,t){if(e&1&&(r(0,"td",29),n(1),i()),e&2){let o=t.$implicit;l(),_(o.name)}}function Ft(e,t){e&1&&(r(0,"th",28),n(1,"Gender"),i())}function qt(e,t){if(e&1&&(r(0,"td",29),n(1),i()),e&2){let o=t.$implicit;l(),_(o.gender)}}function $t(e,t){e&1&&(r(0,"th",28),n(1,"Email"),i())}function Bt(e,t){if(e&1&&(r(0,"td",29),n(1),i()),e&2){let o=t.$implicit;l(),_(o.email)}}function Ot(e,t){e&1&&(r(0,"th",28),n(1,"Phone"),i())}function Vt(e,t){if(e&1&&(r(0,"td",29),n(1),i()),e&2){let o=t.$implicit;l(),_(o.phoneNumber)}}function At(e,t){e&1&&(r(0,"th",28),n(1,"Role"),i())}function Ht(e,t){if(e&1&&(r(0,"td",29),n(1),i()),e&2){let o=t.$implicit;l(),_(o.role)}}function jt(e,t){e&1&&(r(0,"th",30),n(1,"Actions"),i())}function Gt(e,t){if(e&1){let o=ae();r(0,"td",29)(1,"button",31)(2,"mat-icon"),n(3,"more_vert"),i()(),r(4,"mat-menu",null,0)(6,"button",32),h("click",function(){let p=j(o).$implicit,c=x(2);return G(c.editEmployee(p))}),r(7,"mat-icon"),n(8,"edit"),i(),r(9,"span"),n(10,"Edit"),i()(),r(11,"button",32),h("click",function(){let p=j(o).$implicit,c=x(2);return G(c.deleteEmployee(p))}),r(12,"mat-icon"),n(13,"delete"),i(),r(14,"span"),n(15,"Delete"),i()()()()}if(e&2){let o=le(5);l(),m("matMenuTriggerFor",o)}}function Ut(e,t){e&1&&u(0,"tr",33)}function Qt(e,t){e&1&&u(0,"tr",34)}function zt(e,t){if(e&1&&(r(0,"div",13)(1,"table",15),y(2,16),d(3,Rt,2,0,"th",17)(4,kt,2,1,"td",18),g(),y(5,19),d(6,Ft,2,0,"th",17)(7,qt,2,1,"td",18),g(),y(8,20),d(9,$t,2,0,"th",17)(10,Bt,2,1,"td",18),g(),y(11,21),d(12,Ot,2,0,"th",17)(13,Vt,2,1,"td",18),g(),y(14,22),d(15,At,2,0,"th",17)(16,Ht,2,1,"td",18),g(),y(17,23),d(18,jt,2,0,"th",24)(19,Gt,16,1,"td",18),g(),d(20,Ut,1,0,"tr",25)(21,Qt,1,0,"tr",26),i(),u(22,"mat-paginator",27),i()),e&2){let o=x();l(),m("dataSource",o.dataSource),l(19),m("matHeaderRowDef",o.displayedColumns),l(),m("matRowDefColumns",o.displayedColumns),l(),m("pageSizeOptions",de(4,It))}}var dt=class e{dialog=s(lt);snackBar=s(I);userService=s(E);storeStore=s($);displayedColumns=["name","gender","email","phoneNumber","role","actions"];dataSource;searchText="";paginator;sort;employees=Ve({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:t})=>this.userService.getStoreMerchants(t.storeId).pipe(oe(o=>{this.dataSource=new Xe(o),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}))});applyFilter(t){let o=t.target.value;this.dataSource.filter=o.trim().toLowerCase()}openDialog(){this.dialog.open(b,{width:"800px",data:{isEdit:!1}}).afterClosed().subscribe(o=>{o&&this.employees.reload()})}editEmployee(t){this.dialog.open(b,{width:"800px",data:{isEdit:!0,employee:t}}).afterClosed().subscribe(a=>{a&&this.employees.reload()})}deleteEmployee(t){if(t.role==="Owner"){this.snackBar.open("Cannot delete an owner","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"});return}this.dialog.open(pt,{width:"350px",data:{message:`Are you sure you want to delete ${t.name}?`}}).afterClosed().subscribe(a=>{a&&this.userService.deleteMerchant(t._id).subscribe({next:()=>{this.snackBar.open("Employee deleted successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.employees.reload()},error:()=>{this.snackBar.open("Error deleting employee","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})})}static \u0275fac=function(o){return new(o||e)};static \u0275cmp=v({type:e,selectors:[["app-list-employees"]],viewQuery:function(o,a){if(o&1&&(W(B,5),W(A,5)),o&2){let p;K(p=Y())&&(a.paginator=p.first),K(p=Y())&&(a.sort=p.first)}},decls:19,vars:2,consts:[["menu","matMenu"],[1,"employees-container","!bg-white"],[1,"!bg-white"],[1,"flex","flex-col","md:flex-row","justify-between","gap-4","p-4"],[1,"flex","flex-col","sm:flex-row","gap-4","flex-grow"],["appearance","outline",1,"w-full","sm:w-48","md:w-72","lg:w-96"],["matPrefix",""],["matInput","","placeholder","Search employees",3,"keyup","ngModelChange","ngModel"],[1,"flex","gap-3","justify-end"],["mat-raised-button","","color","primary",3,"click"],[1,"flex","items-center","justify-center","min-h-[300px]"],["icon","people","title","No Employees","message","No employees found matching your criteria."],["icon","error","title","Error","message","An error occurred while fetching employees. Please try again later."],[1,"table-container","!bg-white"],["diameter","40"],["mat-table","","matSort","",1,"!bg-white",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","gender"],["matColumnDef","email"],["matColumnDef","phoneNumber"],["matColumnDef","role"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of employees",1,"!bg-white",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","aria-label","Employee actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(o,a){o&1&&(r(0,"mat-card",1)(1,"mat-card-content",2)(2,"div",3)(3,"div",4)(4,"mat-form-field",5)(5,"mat-label"),n(6,"Search"),i(),r(7,"mat-icon",6),n(8,"search"),i(),r(9,"input",7),h("keyup",function(c){return a.applyFilter(c)}),se("ngModelChange",function(c){return pe(a.searchText,c)||(a.searchText=c),c}),i()()(),r(10,"div",8)(11,"button",9),h("click",function(){return a.openDialog()}),r(12,"mat-icon"),n(13,"add"),i(),n(14," ADD EMPLOYEE "),i()()(),C(15,Pt,2,0,"div",10)(16,Lt,1,0,"app-no-record",11)(17,Nt,1,0,"app-no-record",12)(18,zt,23,5,"div",13),i()()),o&2&&(l(9),me("ngModel",a.searchText),l(6),S(a.employees.isLoading()?15:a.employees.hasValue()&&a.dataSource.data.length===0?16:a.employees.error()?17:a.employees.hasValue()?18:-1))},dependencies:[D,Je,Ae,je,ze,Ge,He,We,Ue,Qe,Ke,Ye,tt,B,rt,A,ot,Pe,Te,Ie,k,R,N,Re,q,F,T,w,_e,Fe,ke,Oe,$e,qe,Be,V,O,it,H,he,De,P,L,Ce],encapsulation:2})};export{dt as EmployeeListComponent};
