import{A as x,a as I,c as k}from"./chunk-APGJ2ZCU.js";import{s as R}from"./chunk-T7PMTSVA.js";import{$b as E,Da as w,Dc as M,_ as m,aa as v,ca as S,hd as y,jb as d,qb as V,rb as C}from"./chunk-ZCSDIQ3M.js";var H=new S("currency.mask.config"),c=class{constructor(t){this.htmlInputElement=t}setCursorAt(t){if(this.htmlInputElement.setSelectionRange)this.htmlInputElement.focus(),this.htmlInputElement.setSelectionRange(t,t);else if(this.htmlInputElement.createTextRange){let e=this.htmlInputElement.createTextRange();e.collapse(!0),e.moveEnd("character",t),e.moveStart("character",t),e.select()}}updateValueAndCursor(t,e,i){this.rawValue=t;let s=t.length;i=i-(e-s),this.setCursorAt(i)}get canInputMoreNumbers(){let t=!(this.rawValue.length>=this.htmlInputElement.maxLength&&this.htmlInputElement.maxLength>=0),e=this.inputSelection.selectionStart,i=this.inputSelection.selectionEnd,s=!!(e!=i&&this.htmlInputElement.value.substring(e,i).match(/\d/)),n=this.htmlInputElement.value.substring(0,1)=="0";return t||s||n}get inputSelection(){let t=0,e=0;if(typeof this.htmlInputElement.selectionStart=="number"&&typeof this.htmlInputElement.selectionEnd=="number")t=this.htmlInputElement.selectionStart,e=this.htmlInputElement.selectionEnd;else{let i=document.getSelection().anchorNode;if(i&&i.firstChild==this.htmlInputElement){let s=this.htmlInputElement.value.length,n=this.htmlInputElement.value.replace(/\r\n/g,`
`),l=this.htmlInputElement.createTextRange(),u=this.htmlInputElement.createTextRange();u.collapse(!1),l.compareEndPoints("StartToEnd",u)>-1?t=e=s:(t=-l.moveStart("character",-s),t+=n.slice(0,t).split(`
`).length-1,l.compareEndPoints("EndToEnd",u)>-1?e=s:(e=-l.moveEnd("character",-s),e+=n.slice(0,e).split(`
`).length-1))}}return{selectionStart:t,selectionEnd:e}}get rawValue(){return this.htmlInputElement&&this.htmlInputElement.value}set rawValue(t){this._storedRawValue=t,this.htmlInputElement&&(this.htmlInputElement.value=t)}get storedRawValue(){return this._storedRawValue}},p=class{constructor(t,e){this.htmlInputElement=t,this.options=e,this.inputManager=new c(t)}addNumber(t){this.rawValue||(this.rawValue=this.applyMask(!1,"0"));let e=String.fromCharCode(t),i=this.inputSelection.selectionStart,s=this.inputSelection.selectionEnd;this.rawValue=this.rawValue.substring(0,i)+e+this.rawValue.substring(s,this.rawValue.length),this.updateFieldValue(i+1)}applyMask(t,e){let{allowNegative:i,decimal:s,precision:n,prefix:l,suffix:u,thousands:b}=this.options;e=t?new Number(e).toFixed(n):e;let h=e.replace(/[^0-9]/g,"");if(!h)return"";let o=h.slice(0,h.length-n).replace(/^0*/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,b);o==""&&(o="0");let f=o,a=h.slice(h.length-n);n>0&&(a="0".repeat(n-a.length)+a,f+=s+a);let N=parseInt(o)==0&&(parseInt(a)==0||a=="");return(e.indexOf("-")>-1&&i&&!N?"-":"")+l+f+u}clearMask(t){if(t==null||t=="")return null;let e=t.replace(this.options.prefix,"").replace(this.options.suffix,"");return this.options.thousands&&(e=e.replace(new RegExp("\\"+this.options.thousands,"g"),"")),this.options.decimal&&(e=e.replace(this.options.decimal,".")),parseFloat(e)}changeToNegative(){if(this.options.allowNegative&&this.rawValue!=""&&this.rawValue.charAt(0)!="-"&&this.value!=0){let t=this.inputSelection.selectionStart;this.rawValue="-"+this.rawValue,this.updateFieldValue(t+1)}}changeToPositive(){let t=this.inputSelection.selectionStart;this.rawValue=this.rawValue.replace("-",""),this.updateFieldValue(t-1)}fixCursorPosition(t){let e=this.inputSelection.selectionStart;e>this.getRawValueWithoutSuffixEndPosition()||t?this.inputManager.setCursorAt(this.getRawValueWithoutSuffixEndPosition()):e<this.getRawValueWithoutPrefixStartPosition()&&this.inputManager.setCursorAt(this.getRawValueWithoutPrefixStartPosition())}getRawValueWithoutSuffixEndPosition(){return this.rawValue.length-this.options.suffix.length}getRawValueWithoutPrefixStartPosition(){return this.value!=null&&this.value<0?this.options.prefix.length+1:this.options.prefix.length}removeNumber(t){let{decimal:e,thousands:i}=this.options,s=this.inputSelection.selectionEnd,n=this.inputSelection.selectionStart;n>this.rawValue.length-this.options.suffix.length&&(s=this.rawValue.length-this.options.suffix.length,n=this.rawValue.length-this.options.suffix.length),s==n&&((t==46||t==63272)&&/^\d+$/.test(this.rawValue.substring(n,s+1))&&(s=s+1),(t==46||t==63272)&&(this.rawValue.substring(n,s+1)==e||this.rawValue.substring(n,s+1)==i)&&(s=s+2,n=n+1),t==8&&/^\d+$/.test(this.rawValue.substring(n-1,s))&&(n=n-1),t==8&&(this.rawValue.substring(n-1,s)==e||this.rawValue.substring(n-1,s)==i)&&(n=n-2,s=s-1)),this.rawValue=this.rawValue.substring(0,n)+this.rawValue.substring(s,this.rawValue.length),this.updateFieldValue(n)}updateFieldValue(t){let e=this.applyMask(!1,this.rawValue||"");t=t??this.rawValue.length,this.inputManager.updateValueAndCursor(e,this.rawValue.length,t)}updateOptions(t){let e=this.value;this.options=t,this.value=e}get canInputMoreNumbers(){return this.inputManager.canInputMoreNumbers}get inputSelection(){return this.inputManager.inputSelection}get rawValue(){return this.inputManager.rawValue}set rawValue(t){this.inputManager.rawValue=t}get storedRawValue(){return this.inputManager.storedRawValue}get value(){return this.clearMask(this.rawValue)}set value(t){this.rawValue=this.applyMask(!0,""+t)}},g=class{constructor(t,e){this.inputService=new p(t,e),this.htmlInputElement=t}handleClick(t,e){Math.abs(this.inputService.inputSelection.selectionEnd-this.inputService.inputSelection.selectionStart)==0&&!isNaN(this.inputService.value)&&this.inputService.fixCursorPosition(e)}handleCut(t){this.isReadOnly()||setTimeout(()=>{this.inputService.updateFieldValue(),this.setValue(this.inputService.value),this.onModelChange(this.inputService.value)},0)}handleInput(t){if(this.isReadOnly())return;let e=this.getNewKeyCode(this.inputService.storedRawValue,this.inputService.rawValue),i=this.inputService.rawValue.length,s=this.inputService.inputSelection.selectionEnd,n=this.inputService.getRawValueWithoutSuffixEndPosition(),l=this.inputService.storedRawValue.length;if(this.inputService.rawValue=this.inputService.storedRawValue,(s!=n||Math.abs(i-l)!=1)&&l!=0){this.setCursorPosition(t);return}if(i<l&&(this.inputService.value!=0?this.inputService.removeNumber(8):this.setValue(null)),i>l)switch(e){case 43:this.inputService.changeToPositive();break;case 45:this.inputService.changeToNegative();break;default:if(!this.inputService.canInputMoreNumbers||isNaN(this.inputService.value)&&String.fromCharCode(e).match(/\d/)==null)return;this.inputService.addNumber(e)}this.setCursorPosition(t),this.onModelChange(this.inputService.value)}handleKeydown(t){if(this.isReadOnly())return;let e=t.which||t.charCode||t.keyCode;if(e==8||e==46||e==63272){t.preventDefault();let i=Math.abs(this.inputService.inputSelection.selectionEnd-this.inputService.inputSelection.selectionStart);(i==this.inputService.rawValue.length||this.inputService.value==0)&&(this.setValue(null),this.onModelChange(this.inputService.value)),i==0&&!isNaN(this.inputService.value)&&(this.inputService.removeNumber(e),this.onModelChange(this.inputService.value)),(e===8||e===46)&&i!=0&&!isNaN(this.inputService.value)&&(this.inputService.removeNumber(e),this.onModelChange(this.inputService.value))}}handleKeypress(t){if(this.isReadOnly())return;let e=t.which||t.charCode||t.keyCode;if(!(e==null||[9,13].indexOf(e)!=-1||this.isArrowEndHomeKeyInFirefox(t))){switch(e){case 43:this.inputService.changeToPositive();break;case 45:this.inputService.changeToNegative();break;default:this.inputService.canInputMoreNumbers&&(!isNaN(this.inputService.value)||String.fromCharCode(e).match(/\d/)!=null)&&this.inputService.addNumber(e)}t.preventDefault(),this.onModelChange(this.inputService.value)}}handleKeyup(t){this.inputService.fixCursorPosition()}handlePaste(t){this.isReadOnly()||setTimeout(()=>{this.inputService.updateFieldValue(),this.setValue(this.inputService.value),this.onModelChange(this.inputService.value)},1)}updateOptions(t){this.inputService.updateOptions(t)}getOnModelChange(){return this.onModelChange}setOnModelChange(t){this.onModelChange=t}getOnModelTouched(){return this.onModelTouched}setOnModelTouched(t){this.onModelTouched=t}setValue(t){this.inputService.value=t}getNewKeyCode(t,e){if(t.length>e.length)return null;for(let i=0;i<e.length;i++)if(t.length==i||t[i]!=e[i])return e.charCodeAt(i);return null}isArrowEndHomeKeyInFirefox(t){return[35,36,37,38,39,40].indexOf(t.keyCode)!=-1&&(t.charCode==null||t.charCode==0)}isReadOnly(){return this.htmlInputElement&&this.htmlInputElement.readOnly}setCursorPosition(t){let e=this.inputService.getRawValueWithoutSuffixEndPosition(),i=t.target;setTimeout(function(){i.setSelectionRange(e,e)},0)}},P={provide:I,useExisting:m(()=>A),multi:!0},A=(()=>{class r{constructor(e,i,s){this.currencyMaskConfig=e,this.elementRef=i,this.keyValueDiffers=s,this.options={},this.optionsTemplate={align:"right",allowNegative:!0,decimal:".",precision:2,prefix:"$ ",suffix:"",thousands:","},e&&(this.optionsTemplate=e),this.keyValueDiffer=s.find({}).create()}ngAfterViewInit(){this.elementRef.nativeElement.style.textAlign=this.options.align?this.options.align:this.optionsTemplate.align}ngDoCheck(){this.keyValueDiffer.diff(this.options)&&(this.elementRef.nativeElement.style.textAlign=this.options.align?this.options.align:this.optionsTemplate.align,this.inputHandler.updateOptions(Object.assign({},this.optionsTemplate,this.options)))}ngOnInit(){this.inputHandler=new g(this.elementRef.nativeElement,Object.assign({},this.optionsTemplate,this.options))}handleBlur(e){this.inputHandler.getOnModelTouched().apply(e)}handleClick(e){this.inputHandler.handleClick(e,this.isChromeAndroid())}handleCut(e){this.isChromeAndroid()||this.inputHandler.handleCut(e)}handleInput(e){this.isChromeAndroid()&&this.inputHandler.handleInput(e)}handleKeydown(e){this.isChromeAndroid()||this.inputHandler.handleKeydown(e)}handleKeypress(e){this.isChromeAndroid()||this.inputHandler.handleKeypress(e)}handleKeyup(e){this.isChromeAndroid()||this.inputHandler.handleKeyup(e)}handlePaste(e){this.isChromeAndroid()||this.inputHandler.handlePaste(e)}isChromeAndroid(){return/chrome/i.test(navigator.userAgent)&&/android/i.test(navigator.userAgent)}registerOnChange(e){this.inputHandler.setOnModelChange(e)}registerOnTouched(e){this.inputHandler.setOnModelTouched(e)}setDisabledState(e){this.elementRef.nativeElement.disabled=e}validate(e){let i={};return e.value>this.max&&(i.max=!0),e.value<this.min&&(i.min=!0),i!={}?i:null}writeValue(e){this.inputHandler.setValue(e)}}return r.\u0275fac=function(e){return new(e||r)(d(H,8),d(w),d(y))},r.\u0275dir=C({type:r,selectors:[["","currencyMask",""]],hostBindings:function(e,i){e&1&&E("blur",function(n){return i.handleBlur(n)})("click",function(n){return i.handleClick(n)})("cut",function(n){return i.handleCut(n)})("input",function(n){return i.handleInput(n)})("keydown",function(n){return i.handleKeydown(n)})("keypress",function(n){return i.handleKeypress(n)})("keyup",function(n){return i.handleKeyup(n)})("paste",function(n){return i.handlePaste(n)})},inputs:{max:"max",min:"min",options:"options"},standalone:!1,features:[M([P,{provide:k,useExisting:r,multi:!0}])]}),r})(),G=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=V({type:r}),r.\u0275inj=v({imports:[[R,x]]}),r})();export{A as a,G as b};
