import{a as et}from"./chunk-VRW2HZGF.js";import{b as Xe,f as Ye}from"./chunk-4L4VWXIM.js";import{c as Ze}from"./chunk-V6Q2J3ZF.js";import{a as We}from"./chunk-YZQZHEMG.js";import"./chunk-LCNY3JPX.js";import{c as $e,d as Ae,e as He,f as je,g as Ue,h as qe}from"./chunk-MSN3EE44.js";import{a as Ke,b as Qe}from"./chunk-5NCGVO7F.js";import{a as Je}from"./chunk-HOFFRLAS.js";import{a as Ge}from"./chunk-OFQMF3WN.js";import{a as Le,b as Be,c as we,d as Ee,e as Te,f as Re,g as ye,h as Ie,i as Ne,j as Ve,k as ze}from"./chunk-BAU4EBFS.js";import{b as Fe}from"./chunk-E4PTFC5Z.js";import{a as J}from"./chunk-YHIOFNIN.js";import"./chunk-PYUUH7RE.js";import"./chunk-OKEXGVJ3.js";import"./chunk-O7SXWP4H.js";import{a as ae,b as re,c as le,d as me}from"./chunk-4P4GBQE7.js";import{i as X}from"./chunk-ZKQYDJ5W.js";import{a as Pe,b as Se}from"./chunk-LCF3SYDV.js";import{d as q}from"./chunk-ZLVLWRZH.js";import{d as Oe}from"./chunk-HJGFVW6K.js";import"./chunk-TVH27JLT.js";import"./chunk-G4CZ6LK2.js";import"./chunk-I564X6SI.js";import"./chunk-VTDH2LYT.js";import{b as be,c as ke,d as xe}from"./chunk-63HT37SK.js";import{a as Ce,e as Me,h as ve}from"./chunk-YJCGHVXK.js";import"./chunk-UHBDKNKX.js";import{a as he,b as De}from"./chunk-3ZLH5HUN.js";import{B as _e,b as ce,g as se,h as de,m as ge,s as pe,t as ue,z as fe}from"./chunk-O5GCTPYR.js";import"./chunk-EGLRIU4H.js";import"./chunk-53AK2UWQ.js";import"./chunk-BFT2MTJY.js";import{a as ee,b as te,c as ne,f as ie,h as oe}from"./chunk-JONI64R4.js";import"./chunk-H7INH462.js";import"./chunk-OOL2KACG.js";import"./chunk-KZJMNFJ3.js";import{b as Y,c as Z}from"./chunk-G6I3OKXX.js";import{Z as K,_ as Q,ba as W}from"./chunk-4Z2XUZY2.js";import{e as H,g as j,h as U}from"./chunk-F436VINI.js";import{m as G,s as $,u as A}from"./chunk-H22US2IH.js";import{Gc as y,Hc as I,Ib as E,Jb as T,Mb as F,Mc as B,Nb as L,Nc as N,Ob as c,Oc as V,Pb as o,Qb as i,Rb as p,Vb as _,Wb as C,Wc as z,Yb as P,ac as h,bb as r,cc as M,fa as b,ka as k,la as x,mc as S,qb as w,rc as a,sc as O,tc as D,uc as R,wa as g,wb as u}from"./chunk-P5WOETP4.js";import"./chunk-GAL4ENT6.js";var ot=()=>[10,20,50,100],at=e=>["../../live-booking",e,"details"],tt=(e,n)=>n.value;function rt(e,n){if(e&1&&(o(0,"mat-option",13),a(1),i()),e&2){let t=n.$implicit;c("value",t.value),r(),D(" ",t.label," ")}}function lt(e,n){if(e&1&&(o(0,"mat-option",13),a(1),i()),e&2){let t=n.$implicit;c("value",t.value),r(),D(" ",t.label," ")}}function mt(e,n){e&1&&(o(0,"div",23),p(1,"mat-spinner"),o(2,"p"),a(3,"Loading live bookings..."),i()())}function ct(e,n){if(e&1){let t=P();o(0,"div",24)(1,"mat-icon"),a(2,"error"),i(),o(3,"p"),a(4),i(),o(5,"button",25),h("click",function(){k(t);let m=M();return x(m.refreshBookings())}),a(6," Retry "),i()()}if(e&2){let t,l=M();r(4),O((t=l.liveBookings.error())==null?null:t.message)}}function st(e,n){e&1&&(o(0,"th",41),a(1,"Status"),i())}function dt(e,n){if(e&1&&(o(0,"td",42)(1,"mat-chip",43),a(2),B(3,"uppercase"),i()()),e&2){let t=n.$implicit,l=M(2);r(),c("color",l.getStatusChip(t.status).color),r(),D(" ",N(3,2,t.status)," ")}}function gt(e,n){e&1&&(o(0,"th",41),a(1,"Unique ID"),i())}function pt(e,n){if(e&1&&(o(0,"td",42)(1,"span",44),a(2),i()()),e&2){let t=n.$implicit;r(2),O(t.uniqueId)}}function ut(e,n){e&1&&(o(0,"th",41),a(1,"Source"),i())}function ft(e,n){if(e&1&&(o(0,"td",42)(1,"span",44),a(2),i()()),e&2){let t=n.$implicit;r(2),O(t.otaName)}}function _t(e,n){e&1&&(o(0,"th",41),a(1,"Customer"),i())}function Ct(e,n){if(e&1&&(o(0,"td",42)(1,"div",45)(2,"strong"),a(3),i()()()),e&2){let t=n.$implicit;r(3),R("",t.customerName==null?null:t.customerName.name," ",t.customerName==null?null:t.customerName.surname)}}function Mt(e,n){e&1&&(o(0,"th",41),a(1,"Dates"),i())}function vt(e,n){if(e&1&&(o(0,"td",42)(1,"div",46),a(2),i()()),e&2){let t=n.$implicit,l=M(2);r(),c("routerLink",I(2,at,t.id)),r(),D(" ",l.getDateRange(t.arrivalDate,t.departureDate)," ")}}function bt(e,n){e&1&&(o(0,"th",41),a(1,"Rooms"),i())}function kt(e,n){if(e&1&&(o(0,"td",42)(1,"mat-chip",47),a(2),i()()),e&2){let t=n.$implicit;r(2),O(t.roomsCount)}}function xt(e,n){e&1&&(o(0,"th",41),a(1,"Total"),i())}function ht(e,n){if(e&1&&(o(0,"td",42)(1,"span",44),a(2),B(3,"currency"),i()()),e&2){let t=n.$implicit;r(2),D(" ",V(3,1,t.amount,t.currency)," ")}}function Dt(e,n){e&1&&(o(0,"th",41),a(1,"Actions"),i())}function Pt(e,n){if(e&1){let t=P();o(0,"td",42)(1,"button",48)(2,"mat-icon"),a(3,"more_vert"),i()(),o(4,"mat-menu",null,4)(6,"button",49),h("click",function(){let m=k(t).$implicit,s=M(2);return x(s.viewBookingDetails(m))}),o(7,"mat-icon"),a(8,"open_in_new"),i(),o(9,"span"),a(10,"View Full Details"),i()()()()}if(e&2){let t=S(5);r(),c("matMenuTriggerFor",t)}}function St(e,n){e&1&&p(0,"tr",50)}function Ot(e,n){e&1&&p(0,"tr",51)}function Ft(e,n){if(e&1){let t=P();o(0,"div",26)(1,"table",27),_(2,28),u(3,st,2,0,"th",29)(4,dt,4,4,"td",30),C(),_(5,31),u(6,gt,2,0,"th",29)(7,pt,3,1,"td",30),C(),_(8,32),u(9,ut,2,0,"th",29)(10,ft,3,1,"td",30),C(),_(11,33),u(12,_t,2,0,"th",29)(13,Ct,4,2,"td",30),C(),_(14,34),u(15,Mt,2,0,"th",29)(16,vt,3,4,"td",30),C(),_(17,35),u(18,bt,2,0,"th",29)(19,kt,3,1,"td",30),C(),_(20,36),u(21,xt,2,0,"th",29)(22,ht,4,4,"td",30),C(),_(23,37),u(24,Dt,2,0,"th",29)(25,Pt,11,1,"td",30),C(),u(26,St,1,0,"tr",38)(27,Ot,1,0,"tr",39),i()(),o(28,"mat-paginator",40,3),h("page",function(m){k(t);let s=M();return x(s.onPageChange(m))}),i()}if(e&2){let t=M();r(),c("dataSource",t.bookingsList),r(25),c("matHeaderRowDef",t.displayedColumns),r(),c("matRowDefColumns",t.displayedColumns),r(),c("length",t.pagination.total)("pageSize",t.pageSize())("pageIndex",t.currentPage()-1)("pageSizeOptions",y(7,ot))}}var nt=class e{fb=b(fe);liveBookingService=b(et);storeStore=b(X);router=b(j);route=b(H);currentPage=g(1);pageSize=g(20);searchFilter=g("");otaFilter=g([]);arrivalDateFromFilter=g(null);arrivalDateToFilter=g(null);departureDateFromFilter=g(null);departureDateToFilter=g(null);bookingDateFromFilter=g(null);bookingDateToFilter=g(null);statusFilter=g("");filterForm=this.fb.group({search:[""],otaCodes:[[]],arrivalDateRange:this.fb.group({start:[null],end:[null]}),departureDateRange:this.fb.group({start:[null],end:[null]}),bookingDateRange:this.fb.group({start:[null],end:[null]}),status:[""]});filterParams=z(()=>{if(!this.storeStore.selectedStore()?._id)return{};let t=this.filterForm.get("arrivalDateRange")?.value,l=this.filterForm.get("departureDateRange")?.value,m=this.filterForm.get("bookingDateRange")?.value,s=this.filterForm.get("search")?.value,f=this.filterForm.get("status")?.value,v=this.filterForm.get("otaCodes")?.value;return{page:this.currentPage(),limit:this.pageSize(),search:s&&s.trim()?s.trim():void 0,otaCodes:v&&v.length>0?v:void 0,status:f&&f.length>0?f:void 0,arrivalDateFrom:t?.start?this.formatDate(t.start):void 0,arrivalDateTo:t?.end?this.formatDate(t.end):void 0,departureDateFrom:l?.start?this.formatDate(l.start):void 0,departureDateTo:l?.end?this.formatDate(l.end):void 0,bookingDateFrom:m?.start?this.formatDate(m.start):void 0,bookingDateTo:m?.end?this.formatDate(m.end):void 0}});otaOptions=[{value:"BookingCom",label:"Booking.com"},{value:"Airbnb",label:"Airbnb"},{value:"Expedia",label:"Expedia"},{value:"Hotels.com",label:"Hotels.com"},{value:"VRBO",label:"VRBO"}];statusOptions=[{value:"",label:"All Status"},{value:"new",label:"New"},{value:"modified",label:"Modified"},{value:"cancelled",label:"Cancelled"}];liveBookings=Oe({params:()=>{let n=this.storeStore.selectedStore()?._id,t=this.filterParams();return{storeId:n,filters:t}},stream:({params:n})=>{if(!n.storeId)throw new Error("Store ID not available");return console.log(n.filters),this.liveBookingService.getLiveBookings(n.storeId,n.filters)}});displayedColumns=["status","uniqueId","source","customerName","dates","roomsCount","total","actions"];get arrivalDateRange(){return this.filterForm.get("arrivalDateRange")}get departureDateRange(){return this.filterForm.get("departureDateRange")}get bookingDateRange(){return this.filterForm.get("bookingDateRange")}get bookingsList(){return this.liveBookings.value()?.bookings||[]}get pagination(){return this.liveBookings.value()?.pagination||{page:1,limit:20,total:0,totalPages:0}}onPageChange(n){this.currentPage.set(n.pageIndex+1),this.pageSize.set(n.pageSize)}clearFilters(){this.searchFilter.set(""),this.otaFilter.set([]),this.statusFilter.set(""),this.arrivalDateFromFilter.set(null),this.arrivalDateToFilter.set(null),this.departureDateFromFilter.set(null),this.departureDateToFilter.set(null),this.bookingDateFromFilter.set(null),this.bookingDateToFilter.set(null),this.currentPage.set(1),this.filterForm.reset()}refreshBookings(){this.liveBookings.reload()}exportToCSV(){let n=this.bookingsList;if(!n.length)return;let t=["Unique ID","Property","Customer","Arrival Date","Departure Date","Rooms","Status","Total","Currency"],l=n.map(d=>[d.uniqueId,d.property,d.customerName,d.arrivalDate,d.departureDate,d.roomsCount,d.status,d.amount,d.currency]),m=[t.join(","),...l.map(d=>d.map(it=>`"${it}"`).join(","))].join(`
`),s=new Blob([m],{type:"text/csv"}),f=window.URL.createObjectURL(s),v=document.createElement("a");v.href=f,v.download=`live-bookings-${new Date().toISOString().split("T")[0]}.csv`,v.click(),window.URL.revokeObjectURL(f)}getStatusChip(n){return{new:{icon:"add_circle",color:"accent"},modified:{icon:"edit",color:"warn"},cancelled:{icon:"cancel",color:"warn"}}[n]||{icon:"info",color:"primary"}}getDateRange(n,t){return`${new Date(n).toLocaleDateString()} \u2192 ${new Date(t).toLocaleDateString()}`}formatDate(n){return n.toISOString().split("T")[0]}viewBookingDetails(n){this.router.navigate(["../../live-booking",n.id,"details"],{relativeTo:this.route}).catch(t=>{console.error("Navigation error:",t)})}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=w({type:e,selectors:[["app-list-live-booking"]],decls:67,vars:13,consts:[["arrivalRangePicker",""],["departureRangePicker",""],["bookingRangePicker",""],["paginator",""],["menu","matMenu"],[3,"title","subtitle"],[1,"container"],["appearance","outlined",1,"filters-card"],[1,"filters-grid",3,"formGroup"],["appearance","outline"],["matInput","","formControlName","search","placeholder","Search..."],["matSuffix",""],["formControlName","otaCodes","multiple",""],[3,"value"],["formControlName","status"],[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder","From date"],["matEndDate","","formControlName","end","placeholder","To date"],["matIconSuffix","",3,"for"],[1,"filter-actions"],["matButton","filled","color","primary",3,"click"],["matButton","outlined",3,"click"],["appearance","outlined",1,"results-card"],[1,"loading-container"],[1,"error-container"],["mat-raised-button","","color","primary",3,"click"],[1,"table-container"],["mat-table","",3,"dataSource"],["matColumnDef","status"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","uniqueId"],["matColumnDef","source"],["matColumnDef","customerName"],["matColumnDef","dates"],["matColumnDef","roomsCount"],["matColumnDef","total"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"page","length","pageSize","pageIndex","pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],["selected","","matTooltip","Booking Status",3,"color"],[1,"font-weight-500"],[1,"customer-info"],[1,"date-range",3,"routerLink"],["selected",""],["mat-icon-button","","matTooltip","More Actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,l){if(t&1){let m=P();p(0,"app-page-header",5),o(1,"div",6)(2,"mat-card",7)(3,"mat-card-header")(4,"mat-card-title"),a(5,"Filters"),i()(),o(6,"mat-card-content")(7,"form",8)(8,"mat-form-field",9)(9,"mat-label"),a(10,"Search by Customer or Booking ID"),i(),p(11,"input",10),o(12,"mat-icon",11),a(13,"search"),i()(),o(14,"mat-form-field",9)(15,"mat-label"),a(16,"OTA Providers"),i(),o(17,"mat-select",12),F(18,rt,2,2,"mat-option",13,tt),i()(),o(20,"mat-form-field",9)(21,"mat-label"),a(22,"Status"),i(),o(23,"mat-select",14),F(24,lt,2,2,"mat-option",13,tt),i()(),o(26,"mat-form-field",9)(27,"mat-label"),a(28,"Arrival Date Range"),i(),o(29,"mat-date-range-input",15),p(30,"input",16)(31,"input",17),i(),p(32,"mat-datepicker-toggle",18)(33,"mat-date-range-picker",null,0),i(),o(35,"mat-form-field",9)(36,"mat-label"),a(37,"Departure Date Range"),i(),o(38,"mat-date-range-input",15),p(39,"input",16)(40,"input",17),i(),p(41,"mat-datepicker-toggle",18)(42,"mat-date-range-picker",null,1),i(),o(44,"mat-form-field",9)(45,"mat-label"),a(46,"Booking Date Range"),i(),o(47,"mat-date-range-input",15),p(48,"input",16)(49,"input",17),i(),p(50,"mat-datepicker-toggle",18)(51,"mat-date-range-picker",null,2),i(),o(53,"div",19)(54,"button",20),h("click",function(){return k(m),x(l.refreshBookings())}),o(55,"mat-icon"),a(56,"refresh"),i(),a(57," Apply Filters "),i(),o(58,"button",21),h("click",function(){return k(m),x(l.clearFilters())}),o(59,"mat-icon"),a(60,"clear"),i(),a(61," Clear "),i()()()()(),o(62,"mat-card",22)(63,"mat-card-content"),E(64,mt,4,0,"div",23)(65,ct,7,1,"div",24)(66,Ft,30,8),i()()()}if(t&2){let m=S(34),s=S(43),f=S(52);c("title","Live Bookings")("subtitle","Manage and monitor your live bookings from various OTA providers in one centralized location."),r(7),c("formGroup",l.filterForm),r(11),L(l.otaOptions),r(6),L(l.statusOptions),r(5),c("formGroup",l.arrivalDateRange)("rangePicker",m),r(3),c("for",m),r(6),c("formGroup",l.departureDateRange)("rangePicker",s),r(3),c("for",s),r(6),c("formGroup",l.bookingDateRange)("rangePicker",f),r(3),c("for",f),r(14),T(l.liveBookings.isLoading()?64:l.liveBookings.error()?65:66)}},dependencies:[A,_e,ge,ce,se,de,ue,pe,ze,Le,we,ye,Ee,Be,Ie,Te,Re,Ne,Ve,Qe,Ke,Ze,xe,ke,ve,Ce,Me,Se,Pe,q,W,Q,K,Z,Y,Ye,Xe,oe,ee,ne,ie,te,me,re,ae,le,Je,Ge,qe,$e,Ae,He,je,Ue,J,De,he,Fe,be,We,U,G,$],styles:["[_nghost-%COMP%]{display:block}.container[_ngcontent-%COMP%]{padding:24px;max-width:1600px;margin:0 auto;display:flex;flex-direction:column;gap:24px}.filters-card[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.12)}.filters-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{margin-bottom:16px}.filters-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:18px;font-weight:500;margin:0}.filters-card[_ngcontent-%COMP%]   .filters-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(6,1fr);gap:16px}.filters-card[_ngcontent-%COMP%]   .filters-grid[_ngcontent-%COMP%]   .filter-actions[_ngcontent-%COMP%]{grid-column:1/-1;display:flex;gap:12px;margin-top:8px}.filters-card[_ngcontent-%COMP%]   .filters-grid[_ngcontent-%COMP%]   .filter-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.results-card[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.12)}.results-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:0}.loading-container[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 24px;gap:16px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:#666}.loading-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;color:#d32f2f}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.table-container[_ngcontent-%COMP%]   .bookings-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table-container[_ngcontent-%COMP%]   .bookings-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f5f5f5;font-weight:600;padding:16px;text-align:left;border-bottom:1px solid #e0e0e0}.table-container[_ngcontent-%COMP%]   .bookings-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:16px;border-bottom:1px solid #e0e0e0;vertical-align:middle}.table-container[_ngcontent-%COMP%]   .bookings-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#fafafa}.table-container[_ngcontent-%COMP%]   .bookings-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.table-container[_ngcontent-%COMP%]   .bookings-table[_ngcontent-%COMP%]   .font-weight-500[_ngcontent-%COMP%]{font-weight:500}.table-container[_ngcontent-%COMP%]   .bookings-table[_ngcontent-%COMP%]   .customer-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.table-container[_ngcontent-%COMP%]   .bookings-table[_ngcontent-%COMP%]   .customer-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:600}.table-container[_ngcontent-%COMP%]   .bookings-table[_ngcontent-%COMP%]   .customer-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:12px;color:#666}.table-container[_ngcontent-%COMP%]   .bookings-table[_ngcontent-%COMP%]   .date-range[_ngcontent-%COMP%]{white-space:nowrap;font-size:14px}.table-container[_ngcontent-%COMP%]   .bookings-table[_ngcontent-%COMP%]   mat-chip[_ngcontent-%COMP%]{margin:0}.table-container[_ngcontent-%COMP%]   .bookings-table[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center}mat-paginator[_ngcontent-%COMP%]{border-top:1px solid #e0e0e0;display:flex;justify-content:flex-end;padding:16px}@media(max-width:960px){.container[_ngcontent-%COMP%]{padding:16px}.filters-card[_ngcontent-%COMP%]   .filters-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.filters-card[_ngcontent-%COMP%]   .filters-grid[_ngcontent-%COMP%]   .date-range-group[_ngcontent-%COMP%]{flex-direction:column}.filters-card[_ngcontent-%COMP%]   .filters-grid[_ngcontent-%COMP%]   .date-range-group[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.bookings-table[_ngcontent-%COMP%]{font-size:14px}.bookings-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .bookings-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 8px}}@media(max-width:600px){.bookings-table[_ngcontent-%COMP%]{font-size:12px}.bookings-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .bookings-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px}.customer-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:11px}}"],changeDetection:0})};export{nt as ListLiveBooking};
