import{a as Le,b as Re,c as Ne}from"./chunk-PPJJE4RL.js";import{a as Ve,c as Ae}from"./chunk-YWHWR4KJ.js";import"./chunk-QS3AL2H2.js";import{b as Pe,d as Fe,f as $e}from"./chunk-VQA5W3EJ.js";import{c as ke}from"./chunk-5PPPFRRH.js";import{a as De,b as Ie,c as Oe}from"./chunk-L7BDTWLS.js";import{a as Ce,b as fe,c as Te,d as he,e as ye,f as Se,g as ve,h as xe,i as Me,j as we,k as Ee}from"./chunk-IFYNKVPK.js";import"./chunk-Q24JN32N.js";import{a as c,b as ee,c as te,d as ae,e as ie,f as re,g as I,h as O,i as P}from"./chunk-WFQLSX5X.js";import"./chunk-UATHS3SB.js";import"./chunk-GZ7S2I6F.js";import"./chunk-L5R7UQHM.js";import{b as be,c as ge,d as _e}from"./chunk-323BPMCN.js";import{a as ce,d as pe,h as ue}from"./chunk-TW5XL4DD.js";import"./chunk-GBJWJHBW.js";import{A as me}from"./chunk-ADPCW6JI.js";import"./chunk-UUMWQRYG.js";import"./chunk-UPMF7ZC6.js";import{a as q}from"./chunk-BFT2MTJY.js";import{a as ne,c as de,h as se}from"./chunk-GI3DA2RF.js";import"./chunk-DDDMZQMU.js";import"./chunk-6NXOHEKD.js";import"./chunk-47XHPHB4.js";import{b as oe,c as le}from"./chunk-5P5QATX2.js";import{$ as Z}from"./chunk-LG6YQHRU.js";import{e as X,g as Y}from"./chunk-DWM5GR6S.js";import{r as K,x as W}from"./chunk-6BQAOBQP.js";import{$ as G,$a as d,Gb as S,Hb as v,Kb as A,Lb as H,Mb as b,Nb as r,Ob as i,Pb as j,Tb as E,Tc as J,U as M,Ub as D,Wb as B,X as w,_b as _,ac as g,c as x,ea as u,ja as T,ka as h,ob as U,pc as l,qc as z,rc as C,ub as y,va as V}from"./chunk-H33Y42PP.js";import{a as N}from"./chunk-GAL4ENT6.js";var F=class e{hostServer=q.apiUrl;_httpClient=u(W);getStoreTableCategories(t){return this._httpClient.get(`${this.hostServer}/table-categories/store/${t}`)}deleteTableCategory(t){return this._httpClient.delete(`${this.hostServer}/table-categories/${t}`)}createTableCategory(t){return this._httpClient.post(`${this.hostServer}/table-categories`,t)}updateTableCategory(t,a){return this._httpClient.put(`${this.hostServer}/table-categories/${t}`,a)}static \u0275fac=function(a){return new(a||e)};static \u0275prov=G({token:e,factory:e.\u0275fac,providedIn:"root"})};var Ue={tableCategories:[],selectedTableCategory:null,isLoading:!1,error:null},He=ee({providedIn:"root"},re(Ue),te(({tableCategories:e})=>({tablesCategoryCount:J(()=>e().length)})),ie((e,t=u(F))=>{let a=n=>{c(e,{selectedTableCategory:n})},o=()=>{c(e,{selectedTableCategory:null})},s=(n,p)=>{let L=e.tableCategories().map(R=>R._id===n?N(N({},R),p):R);c(e,{tableCategories:L})},m=n=>{c(e,{tableCategories:[...e.tableCategories(),n]})},$=n=>{let p=e.tableCategories().filter(L=>L._id!==n);c(e,{tableCategories:p})},f=O(x(w(()=>c(e,{isLoading:!0,error:null,tableCategories:[]})),M(n=>t.getStoreTableCategories(n).pipe(I({next(p){c(e,{isLoading:!1,error:null,tableCategories:p,selectedTableCategory:null})},error(p){c(e,{isLoading:!1,error:String(p)})}}))))),k=O(x(w(()=>c(e,{isLoading:!0,error:null})),M(n=>t.createTableCategory(n.tableParams).pipe(I({next(p){c(e,{isLoading:!1,error:null}),m(p),n?.modalParams&&n.modalParams.closeCallback()},error(p){c(e,{isLoading:!1,error:String(p)})}}))))),Q=O(x(w(()=>c(e,{isLoading:!0,error:null})),M(n=>t.updateTableCategory(n.tableId,n.tableParams).pipe(I({next(p){c(e,{isLoading:!1,error:null}),s(n.tableId,n.tableParams),n?.modalParams&&n.modalParams.closeCallback()},error(p){c(e,{isLoading:!1,error:String(p)})}}))))),Qe=O(x(w(()=>c(e,{isLoading:!0,error:null})),M(n=>t.deleteTableCategory(n).pipe(I({next(p){c(e,{isLoading:!1,error:null}),$(n)},error(p){c(e,{isLoading:!1,error:String(p)})}})))));return{selectTableCategory:a,clearSelectedTableCategory:o,updateTableParams:s,createTableCategory:m,deleteTableCategory:$,getTablesCategories$:f,createTableCategory$:k,updateTableCategory$:Q,deleteTableCategory$:Qe}}),ae({onInit(e){let a=u(P).selectedStore();a?._id&&e.getTablesCategories$(a._id)}}));var Be=(e,t)=>t._id;function ze(e,t){if(e&1){let a=B();r(0,"mat-chip",14),_("click",function(){let s=T(a).$implicit,m=g();return h(m.onCategorySelect(s))}),l(1),i()}if(e&2){let a,o=t.$implicit,s=g();b("highlighted",((a=s.tableCategoryStore.selectedTableCategory())==null?null:a._id)===o._id),d(),C(" ",o.name," ")}}function Je(e,t){if(e&1){let a=B();r(0,"app-table-card",20),_("addNewOrder",function(s){T(a);let m=g(2);return h(m.onAddNewOrder(s))})("completeOrder",function(s){T(a);let m=g(2);return h(m.completeOrder(s))})("clearOrder",function(s){T(a);let m=g(2);return h(m.onClearOrder(s))})("tableClick",function(s){T(a);let m=g(2);return h(m.onTableClick(s))}),i()}if(e&2){let a=t.$implicit;b("table",a)}}function Ke(e,t){e&1&&(r(0,"div",19)(1,"mat-icon",21),l(2,"table_restaurant"),i(),r(3,"p"),l(4,"No tables found"),i()())}function We(e,t){if(e&1&&(r(0,"div",17),A(1,Je,1,1,"app-table-card",18,Be),i(),S(3,Ke,5,0,"div",19)),e&2){let a=g();d(),H(a.tableStore.filteredTables()),d(2),v(a.tableStore.filteredTables().length===0?3:-1)}}function Xe(e,t){e&1&&(r(0,"th",32),l(1,"Table Name"),i())}function Ye(e,t){if(e&1&&(r(0,"td",33),l(1),i()),e&2){let a=t.$implicit;d(),z(a.name)}}function Ze(e,t){e&1&&(r(0,"th",32),l(1,"Seats"),i())}function qe(e,t){if(e&1&&(r(0,"td",33)(1,"div",34)(2,"mat-icon",35),l(3,"event_seat"),i(),l(4),i()()),e&2){let a=t.$implicit;d(4),C(" ",a.numberOfGuest," ")}}function et(e,t){e&1&&(r(0,"th",32),l(1,"Category"),i())}function tt(e,t){if(e&1&&(r(0,"td",33),l(1),i()),e&2){let a=t.$implicit;d(),C(" ",(a.category==null?null:a.category.name)||"N/A"," ")}}function at(e,t){e&1&&(r(0,"th",32),l(1,"Status"),i())}function it(e,t){e&1&&(r(0,"span",36),l(1," Occupied "),i())}function rt(e,t){e&1&&(r(0,"span",37),l(1," Available "),i())}function ot(e,t){if(e&1&&(r(0,"td",33),S(1,it,2,0,"span",36)(2,rt,2,0,"span",37),i()),e&2){let a=t.$implicit;d(),v(a.order?1:2)}}function lt(e,t){e&1&&j(0,"tr",38)}function nt(e,t){e&1&&j(0,"tr",39)}function dt(e,t){e&1&&(r(0,"div",19)(1,"mat-icon",21),l(2,"table_restaurant"),i(),r(3,"p"),l(4,"No tables found"),i()())}function st(e,t){if(e&1&&(r(0,"mat-card",16)(1,"mat-card-content",22)(2,"table",23),E(3,24),y(4,Xe,2,0,"th",25)(5,Ye,2,1,"td",26),D(),E(6,27),y(7,Ze,2,0,"th",25)(8,qe,5,1,"td",26),D(),E(9,28),y(10,et,2,0,"th",25)(11,tt,2,1,"td",26),D(),E(12,29),y(13,at,2,0,"th",25)(14,ot,3,1,"td",26),D(),y(15,lt,1,0,"tr",30)(16,nt,1,0,"tr",31),i(),S(17,dt,5,0,"div",19),i()()),e&2){let a=g();d(2),b("dataSource",a.tableStore.filteredTables()),d(13),b("matHeaderRowDef",a.displayedColumns),d(),b("matRowDefColumns",a.displayedColumns),d(),v(a.tableStore.filteredTables().length===0?17:-1)}}var je=class e{tableStore=u(Ne);tableCategoryStore=u(He);saleTypeStore=u(Ve);orderStore=u(Ae);storeStore=u(P);dialog=u(ke);router=u(Y);route=u(X);viewMode=V("grid");searchQuery=V("");displayedColumns=["name","seats","category","status"];onSearchChange(t){this.searchQuery.set(t),this.tableStore.updateSearchQuery(t)}onStatusFilterChange(t){this.tableStore.updateStatusFilter(t)}onCategorySelect(t){this.tableCategoryStore.selectTableCategory(t),this.tableStore.updateSearchFilter(t)}clearCategoryFilter(){this.tableCategoryStore.clearSelectedTableCategory(),this.tableStore.updateSearchFilter(null)}onTableClick(t){this.tableStore.selectTable(t._id)}onAddNewOrder(t){this.tableStore.selectTable(t._id),this.saleTypeStore.setSelectedSaleType("table"),this.router.navigate(["checkout"],{relativeTo:this.route})}onClearOrder(t){t.orderId&&(this.tableStore.updateTable(t._id,{orderId:null,order:null}),this.tableStore.updateTableOrderSync(t._id,{orderId:null}),console.log("Order cleared from table:",t.name))}completeOrder(t){console.log("Completing order for table:",t);let a=t.orderId?._id,o=t.orderId?.total||0,s=this.storeStore.selectedStore()?.currency||"\u20A6";if(!a){console.error("No order found for this table");return}let m={totalAmount:o,currency:s};this.dialog.open(Re,{width:"450px",data:m}).afterClosed().subscribe(f=>{if(f){let k=f.action==="confirm"&&f.paymentMethod?f.paymentMethod.name:"Cash";this.orderStore.completeOrder(a,k).then(Q=>{this.tableStore.updateTable(t._id,{orderId:null,order:null}),this.tableStore.updateTableOrderSync(t._id,{orderId:null}),this.orderStore.deleteSelectedOrder(),this.tableStore.clearSelectedTable(),this.saleTypeStore.setDefaultSaleType()})}})}static \u0275fac=function(a){return new(a||e)};static \u0275cmp=U({type:e,selectors:[["app-tables"]],decls:32,vars:9,consts:[[1,"p-6","min-h-full"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-4"],["appearance","outline",1,"w-80"],["matInput","","placeholder","Search by table name...",3,"input","value"],["matPrefix",""],[1,"flex","items-center","gap-3"],[3,"change","value"],["value","all"],["value","free"],["value","occupied"],["value","grid"],["value","list"],[1,"mb-4"],[1,"cursor-pointer",3,"click","highlighted"],[1,"cursor-pointer",3,"highlighted"],["appearance","outlined"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-4"],[3,"table"],[1,"text-center","py-12","text-gray-500"],[3,"addNewOrder","completeOrder","clearOrder","tableClick","table"],[1,"text-6xl","mb-4"],[1,"p-0"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","class","font-semibold",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","seats"],["matColumnDef","category"],["matColumnDef","status"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","hover:bg-gray-50 cursor-pointer",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"font-semibold"],["mat-cell",""],[1,"flex","items-center","gap-2"],[1,"text-gray-500","text-sm"],[1,"px-3","py-1","rounded-full","text-xs","font-medium","bg-red-100","text-red-800"],[1,"px-3","py-1","rounded-full","text-xs","font-medium","bg-green-100","text-green-800"],["mat-header-row",""],["mat-row","",1,"hover:bg-gray-50","cursor-pointer"]],template:function(a,o){a&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-form-field",3)(4,"mat-label"),l(5,"Search tables"),i(),r(6,"input",4),_("input",function(m){return o.onSearchChange(m.target.value)}),i(),r(7,"mat-icon",5),l(8,"search"),i()()(),r(9,"div",6)(10,"mat-button-toggle-group",7),_("change",function(m){return o.onStatusFilterChange(m.value)}),r(11,"mat-button-toggle",8),l(12),i(),r(13,"mat-button-toggle",9),l(14),i(),r(15,"mat-button-toggle",10),l(16),i()(),r(17,"mat-button-toggle-group",7),_("change",function(m){return o.viewMode.set(m.value)}),r(18,"mat-button-toggle",11)(19,"mat-icon"),l(20,"grid_view"),i()(),r(21,"mat-button-toggle",12)(22,"mat-icon"),l(23,"view_list"),i()()()()(),r(24,"div",13)(25,"mat-chip-set")(26,"mat-chip",14),_("click",function(){return o.clearCategoryFilter()}),l(27," All Categories "),i(),A(28,ze,2,2,"mat-chip",15,Be),i()(),S(30,We,4,1),S(31,st,18,4,"mat-card",16),i()),a&2&&(d(6),b("value",o.searchQuery()),d(4),b("value",o.tableStore.statusFilter()),d(2),C(" All (",o.tableStore.tablesCount(),") "),d(2),C(" Free (",o.tableStore.freeTableCount(),") "),d(2),C(" Occupied (",o.tableStore.occupiedTableCount(),") "),d(),b("value",o.viewMode()),d(9),b("highlighted",!o.tableCategoryStore.selectedTableCategory()),d(2),H(o.tableCategoryStore.tableCategories()),d(2),v(o.viewMode()==="grid"?30:-1),d(),v(o.viewMode()==="list"?31:-1))},dependencies:[K,se,ne,de,Ee,Ce,Te,ve,he,fe,xe,ye,Se,Me,we,$e,Pe,Fe,Z,le,oe,be,ue,ce,pe,_e,ge,Oe,De,Ie,me,Le],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto}"]})};export{je as Tables};
