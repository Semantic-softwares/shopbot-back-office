import{a as Ht,b as Yi,c as Qi,d as Xi}from"./chunk-YHH6U7IV.js";import{a as De}from"./chunk-NVPRDFZM.js";import{a as Ji}from"./chunk-VQRQEB7B.js";import{a as mt}from"./chunk-DLDGJ2G7.js";import{a as Wi,b as zi,c as Zi}from"./chunk-WNSBBNVN.js";import{b as ji}from"./chunk-JWH6MPF3.js";import{g as Hi}from"./chunk-ROZP2TNQ.js";import"./chunk-R6677L7M.js";import{a as $i,b as Ki,c as Ve,d as at,e as rt,f as st,g as lt,h as Me}from"./chunk-NGP3QI5W.js";import"./chunk-72VJX2YS.js";import{a as Ee,b as re}from"./chunk-DB3A7P3M.js";import{a as Ke}from"./chunk-CZ2S7A5U.js";import"./chunk-KVJZH652.js";import"./chunk-XTLJZNJU.js";import{a as Ti}from"./chunk-HUTJFBBB.js";import{d as ce}from"./chunk-SWNYNPHN.js";import{a as Ze,b as xe}from"./chunk-TLN5MM36.js";import{b as $,c as he,d as w}from"./chunk-3BP5U2AG.js";import{a as je,b as kt}from"./chunk-BF5Y3WJN.js";import{c as Ut}from"./chunk-ZNHPNQ3W.js";import{a as qt,b as et,c as Ae,d as Ui,e as tt,f as it,g as nt,h as ot}from"./chunk-TXVLFBH3.js";import{a as Ye,b as Ot,c as qi,e as Bt,f as Qe,g as Xe,k as Fe}from"./chunk-S3WAFRZZ.js";import{a as Vt,b as Je}from"./chunk-OLCCZ3IB.js";import{a as we}from"./chunk-CZME4V75.js";import{a as Lt}from"./chunk-CQES5GWZ.js";import"./chunk-K6UY4OSY.js";import{c as P,d as Ne}from"./chunk-ZBSG24BC.js";import"./chunk-GXR3VSCN.js";import{a as ae}from"./chunk-RBYYFQHC.js";import"./chunk-UPBHOZRL.js";import{a as de,b as ue,c as pe,d as At,e as Li,f as ge,g as H}from"./chunk-L2IRRR6J.js";import{a as J,b as We,c as be,d as ze,e as Pe,h as Y}from"./chunk-27T6VRU4.js";import{C as Se,D as wt,E as L,a as Ii,b as ne,c as Pi,d as u,e as wi,g as Z,h as U,i as Tt,k as Ai,m as Te,n as It,o as ft,p as Vi,q as Ie,r as Pt,s as oe,t as B,y as Oi,z as Bi}from"./chunk-LM7FYRY4.js";import"./chunk-ZENMOCFL.js";import{a as Q,b as A}from"./chunk-EDESGICS.js";import{a as Gt}from"./chunk-6UI2KQ7N.js";import"./chunk-7KAGHLPR.js";import"./chunk-JRF7K3G5.js";import"./chunk-HRGWPEEQ.js";import{X as Rt,Y as ie,Z as q}from"./chunk-BVLPFG4Z.js";import"./chunk-LYY57WCE.js";import"./chunk-5CST2L2O.js";import{a as Nt,c as Gi}from"./chunk-QJAAU2EQ.js";import"./chunk-S3JL7UCS.js";import{g as Ni,i as Ri,n as ki,q as Ge,r as I}from"./chunk-ETP2OZKZ.js";import{$c as Ei,Ac as ni,Ba as fi,Bc as ve,Db as h,Eb as f,F as ci,Fb as Mt,Gb as _i,Gc as T,Hb as j,Hc as Dt,Ib as W,Ic as Be,J as Ue,Jb as g,Jc as te,Kb as a,Lb as n,Mb as v,Oc as D,R as di,S as ui,T as ee,Tb as R,Tc as z,Uc as O,V as He,Xb as S,Y as pi,Ya as m,Yc as Mi,Z as xt,Zb as p,_ as gi,aa as hi,bd as Di,ca as _,f as ke,fb as Ft,g as mi,ha as F,hc as fe,ia as M,lb as G,m as bt,mb as vi,mc as s,nb as Ci,nc as V,oc as b,pc as Et,qc as yi,rc as Si,sc as bi,ta as E,tc as xi,wa as ht,xc as Fi,zc as $e}from"./chunk-KGWH6IHP.js";import{a as ti,b as ii,f as ye}from"./chunk-EQDQRRRY.js";var oi=(d=>(d.PENDING="pending",d.RESERVED="reserved",d.CONFIRMED="confirmed",d.CHECKED_IN="checked_in",d.CHECKED_OUT="checked_out",d.CANCELLED="cancelled",d.NO_SHOW="no_show",d))(oi||{});var $t=class r{countries=[{code:"AF",name:"Afghanistan"},{code:"AL",name:"Albania"},{code:"DZ",name:"Algeria"},{code:"AS",name:"American Samoa"},{code:"AD",name:"Andorra"},{code:"AO",name:"Angola"},{code:"AI",name:"Anguilla"},{code:"AQ",name:"Antarctica"},{code:"AG",name:"Antigua and Barbuda"},{code:"AR",name:"Argentina"},{code:"AM",name:"Armenia"},{code:"AW",name:"Aruba"},{code:"AU",name:"Australia"},{code:"AT",name:"Austria"},{code:"AZ",name:"Azerbaijan"},{code:"BS",name:"Bahamas"},{code:"BH",name:"Bahrain"},{code:"BD",name:"Bangladesh"},{code:"BB",name:"Barbados"},{code:"BY",name:"Belarus"},{code:"BE",name:"Belgium"},{code:"BZ",name:"Belize"},{code:"BJ",name:"Benin"},{code:"BM",name:"Bermuda"},{code:"BT",name:"Bhutan"},{code:"BO",name:"Bolivia"},{code:"BA",name:"Bosnia and Herzegovina"},{code:"BW",name:"Botswana"},{code:"BV",name:"Bouvet Island"},{code:"BR",name:"Brazil"},{code:"BN",name:"Brunei"},{code:"BG",name:"Bulgaria"},{code:"BF",name:"Burkina Faso"},{code:"BI",name:"Burundi"},{code:"KH",name:"Cambodia"},{code:"CM",name:"Cameroon"},{code:"CA",name:"Canada"},{code:"CV",name:"Cape Verde"},{code:"KY",name:"Cayman Islands"},{code:"CF",name:"Central African Republic"},{code:"TD",name:"Chad"},{code:"CL",name:"Chile"},{code:"CN",name:"China"},{code:"CX",name:"Christmas Island"},{code:"CC",name:"Cocos Islands"},{code:"CO",name:"Colombia"},{code:"KM",name:"Comoros"},{code:"CG",name:"Congo"},{code:"CD",name:"Congo (Democratic Republic)"},{code:"CK",name:"Cook Islands"},{code:"CR",name:"Costa Rica"},{code:"HR",name:"Croatia"},{code:"CU",name:"Cuba"},{code:"CY",name:"Cyprus"},{code:"CZ",name:"Czech Republic"},{code:"DK",name:"Denmark"},{code:"DJ",name:"Djibouti"},{code:"DM",name:"Dominica"},{code:"DO",name:"Dominican Republic"},{code:"EC",name:"Ecuador"},{code:"EG",name:"Egypt"},{code:"SV",name:"El Salvador"},{code:"GQ",name:"Equatorial Guinea"},{code:"ER",name:"Eritrea"},{code:"EE",name:"Estonia"},{code:"ET",name:"Ethiopia"},{code:"FK",name:"Falkland Islands"},{code:"FO",name:"Faroe Islands"},{code:"FJ",name:"Fiji"},{code:"FI",name:"Finland"},{code:"FR",name:"France"},{code:"GF",name:"French Guiana"},{code:"PF",name:"French Polynesia"},{code:"TF",name:"French Southern Territories"},{code:"GA",name:"Gabon"},{code:"GM",name:"Gambia"},{code:"GE",name:"Georgia"},{code:"DE",name:"Germany"},{code:"GH",name:"Ghana"},{code:"GI",name:"Gibraltar"},{code:"GR",name:"Greece"},{code:"GL",name:"Greenland"},{code:"GD",name:"Grenada"},{code:"GP",name:"Guadeloupe"},{code:"GU",name:"Guam"},{code:"GT",name:"Guatemala"},{code:"GG",name:"Guernsey"},{code:"GN",name:"Guinea"},{code:"GW",name:"Guinea-Bissau"},{code:"GY",name:"Guyana"},{code:"HT",name:"Haiti"},{code:"HK",name:"Hong Kong"},{code:"HU",name:"Hungary"},{code:"IS",name:"Iceland"},{code:"IN",name:"India"},{code:"ID",name:"Indonesia"},{code:"IR",name:"Iran"},{code:"IQ",name:"Iraq"},{code:"IE",name:"Ireland"},{code:"IM",name:"Isle of Man"},{code:"IL",name:"Israel"},{code:"IT",name:"Italy"},{code:"CI",name:"Ivory Coast"},{code:"JM",name:"Jamaica"},{code:"JP",name:"Japan"},{code:"JE",name:"Jersey"},{code:"JO",name:"Jordan"},{code:"KZ",name:"Kazakhstan"},{code:"KE",name:"Kenya"},{code:"KI",name:"Kiribati"},{code:"KP",name:"North Korea"},{code:"KR",name:"South Korea"},{code:"KW",name:"Kuwait"},{code:"KG",name:"Kyrgyzstan"},{code:"LA",name:"Laos"},{code:"LV",name:"Latvia"},{code:"LB",name:"Lebanon"},{code:"LS",name:"Lesotho"},{code:"LR",name:"Liberia"},{code:"LY",name:"Libya"},{code:"LI",name:"Liechtenstein"},{code:"LT",name:"Lithuania"},{code:"LU",name:"Luxembourg"},{code:"MO",name:"Macao"},{code:"MK",name:"Macedonia"},{code:"MG",name:"Madagascar"},{code:"MW",name:"Malawi"},{code:"MY",name:"Malaysia"},{code:"MV",name:"Maldives"},{code:"ML",name:"Mali"},{code:"MT",name:"Malta"},{code:"MH",name:"Marshall Islands"},{code:"MQ",name:"Martinique"},{code:"MR",name:"Mauritania"},{code:"MU",name:"Mauritius"},{code:"YT",name:"Mayotte"},{code:"MX",name:"Mexico"},{code:"FM",name:"Micronesia"},{code:"MD",name:"Moldova"},{code:"MC",name:"Monaco"},{code:"MN",name:"Mongolia"},{code:"ME",name:"Montenegro"},{code:"MA",name:"Morocco"},{code:"MZ",name:"Mozambique"},{code:"MM",name:"Myanmar"},{code:"NA",name:"Namibia"},{code:"NR",name:"Nauru"},{code:"NP",name:"Nepal"},{code:"NL",name:"Netherlands"},{code:"AN",name:"Netherlands Antilles"},{code:"NC",name:"New Caledonia"},{code:"NZ",name:"New Zealand"},{code:"NI",name:"Nicaragua"},{code:"NE",name:"Niger"},{code:"NG",name:"Nigeria"},{code:"NU",name:"Niue"},{code:"NF",name:"Norfolk Island"},{code:"MP",name:"Northern Mariana Islands"},{code:"NO",name:"Norway"},{code:"OM",name:"Oman"},{code:"PK",name:"Pakistan"},{code:"PW",name:"Palau"},{code:"PS",name:"Palestine"},{code:"PA",name:"Panama"},{code:"PG",name:"Papua New Guinea"},{code:"PY",name:"Paraguay"},{code:"PE",name:"Peru"},{code:"PH",name:"Philippines"},{code:"PN",name:"Pitcairn Islands"},{code:"PL",name:"Poland"},{code:"PT",name:"Portugal"},{code:"PR",name:"Puerto Rico"},{code:"QA",name:"Qatar"},{code:"RE",name:"Reunion"},{code:"RO",name:"Romania"},{code:"RU",name:"Russia"},{code:"RW",name:"Rwanda"},{code:"BL",name:"Saint Barthelemy"},{code:"SH",name:"Saint Helena"},{code:"KN",name:"Saint Kitts and Nevis"},{code:"LC",name:"Saint Lucia"},{code:"MF",name:"Saint Martin"},{code:"PM",name:"Saint Pierre and Miquelon"},{code:"VC",name:"Saint Vincent and the Grenadines"},{code:"WS",name:"Samoa"},{code:"SM",name:"San Marino"},{code:"ST",name:"Sao Tome and Principe"},{code:"SA",name:"Saudi Arabia"},{code:"SN",name:"Senegal"},{code:"RS",name:"Serbia"},{code:"SC",name:"Seychelles"},{code:"SL",name:"Sierra Leone"},{code:"SG",name:"Singapore"},{code:"SK",name:"Slovakia"},{code:"SI",name:"Slovenia"},{code:"SB",name:"Solomon Islands"},{code:"SO",name:"Somalia"},{code:"ZA",name:"South Africa"},{code:"GS",name:"South Georgia and the South Sandwich Islands"},{code:"SS",name:"South Sudan"},{code:"ES",name:"Spain"},{code:"LK",name:"Sri Lanka"},{code:"SD",name:"Sudan"},{code:"SR",name:"Suriname"},{code:"SJ",name:"Svalbard and Jan Mayen"},{code:"SZ",name:"Swaziland"},{code:"SE",name:"Sweden"},{code:"CH",name:"Switzerland"},{code:"SY",name:"Syria"},{code:"TW",name:"Taiwan"},{code:"TJ",name:"Tajikistan"},{code:"TZ",name:"Tanzania"},{code:"TH",name:"Thailand"},{code:"TL",name:"Timor-Leste"},{code:"TG",name:"Togo"},{code:"TK",name:"Tokelau"},{code:"TO",name:"Tonga"},{code:"TT",name:"Trinidad and Tobago"},{code:"TN",name:"Tunisia"},{code:"TR",name:"Turkey"},{code:"TM",name:"Turkmenistan"},{code:"TC",name:"Turks and Caicos Islands"},{code:"TV",name:"Tuvalu"},{code:"UG",name:"Uganda"},{code:"UA",name:"Ukraine"},{code:"AE",name:"United Arab Emirates"},{code:"GB",name:"United Kingdom"},{code:"US",name:"United States"},{code:"UY",name:"Uruguay"},{code:"UZ",name:"Uzbekistan"},{code:"VU",name:"Vanuatu"},{code:"VA",name:"Vatican City"},{code:"VE",name:"Venezuela"},{code:"VN",name:"Vietnam"},{code:"VG",name:"Virgin Islands (British)"},{code:"VI",name:"Virgin Islands (US)"},{code:"WF",name:"Wallis and Futuna"},{code:"EH",name:"Western Sahara"},{code:"YE",name:"Yemen"},{code:"ZM",name:"Zambia"},{code:"ZW",name:"Zimbabwe"}];nationalities=[{code:"AF",name:"Afghan"},{code:"AL",name:"Albanian"},{code:"DZ",name:"Algerian"},{code:"AS",name:"American Samoan"},{code:"AD",name:"Andorran"},{code:"AO",name:"Angolan"},{code:"AI",name:"Anguillan"},{code:"AQ",name:"Antarctic"},{code:"AG",name:"Antiguan or Barbudan"},{code:"AR",name:"Argentine"},{code:"AM",name:"Armenian"},{code:"AW",name:"Aruban"},{code:"AU",name:"Australian"},{code:"AT",name:"Austrian"},{code:"AZ",name:"Azerbaijani"},{code:"BS",name:"Bahamian"},{code:"BH",name:"Bahraini"},{code:"BD",name:"Bangladeshi"},{code:"BB",name:"Barbadian"},{code:"BY",name:"Belarusian"},{code:"BE",name:"Belgian"},{code:"BZ",name:"Belizean"},{code:"BJ",name:"Beninese"},{code:"BM",name:"Bermudian"},{code:"BT",name:"Bhutanese"},{code:"BO",name:"Bolivian"},{code:"BA",name:"Bosnian"},{code:"BW",name:"Botswanan"},{code:"BV",name:"Bouvet Islander"},{code:"BR",name:"Brazilian"},{code:"BN",name:"Bruneian"},{code:"BG",name:"Bulgarian"},{code:"BF",name:"Burkinabe"},{code:"BI",name:"Burundian"},{code:"KH",name:"Cambodian"},{code:"CM",name:"Cameroonian"},{code:"CA",name:"Canadian"},{code:"CV",name:"Cape Verdean"},{code:"KY",name:"Caymanian"},{code:"CF",name:"Central African"},{code:"TD",name:"Chadian"},{code:"CL",name:"Chilean"},{code:"CN",name:"Chinese"},{code:"CX",name:"Christmas Islander"},{code:"CC",name:"Cocos Islander"},{code:"CO",name:"Colombian"},{code:"KM",name:"Comorian"},{code:"CG",name:"Congolese"},{code:"CD",name:"Congolese"},{code:"CK",name:"Cook Islander"},{code:"CR",name:"Costa Rican"},{code:"HR",name:"Croatian"},{code:"CU",name:"Cuban"},{code:"CY",name:"Cypriot"},{code:"CZ",name:"Czech"},{code:"DK",name:"Danish"},{code:"DJ",name:"Djiboutian"},{code:"DM",name:"Dominican"},{code:"DO",name:"Dominican"},{code:"EC",name:"Ecuadorian"},{code:"EG",name:"Egyptian"},{code:"SV",name:"Salvadoran"},{code:"GQ",name:"Equatorial Guinean"},{code:"ER",name:"Eritrean"},{code:"EE",name:"Estonian"},{code:"ET",name:"Ethiopian"},{code:"FK",name:"Falkland Islander"},{code:"FO",name:"Faroese"},{code:"FJ",name:"Fijian"},{code:"FI",name:"Finnish"},{code:"FR",name:"French"},{code:"GF",name:"French Guianan"},{code:"PF",name:"French Polynesian"},{code:"TF",name:"French Southern"},{code:"GA",name:"Gabonese"},{code:"GM",name:"Gambian"},{code:"GE",name:"Georgian"},{code:"DE",name:"German"},{code:"GH",name:"Ghanaian"},{code:"GI",name:"Gibraltar"},{code:"GR",name:"Greek"},{code:"GL",name:"Greenlandic"},{code:"GD",name:"Grenadian"},{code:"GP",name:"Guadeloupe"},{code:"GU",name:"Guamanian"},{code:"GT",name:"Guatemalan"},{code:"GG",name:"Guernseyite"},{code:"GN",name:"Guinean"},{code:"GW",name:"Guinea-Bissauan"},{code:"GY",name:"Guyanese"},{code:"HT",name:"Haitian"},{code:"HK",name:"Hong Kong"},{code:"HU",name:"Hungarian"},{code:"IS",name:"Icelandic"},{code:"IN",name:"Indian"},{code:"ID",name:"Indonesian"},{code:"IR",name:"Iranian"},{code:"IQ",name:"Iraqi"},{code:"IE",name:"Irish"},{code:"IM",name:"Manx"},{code:"IL",name:"Israeli"},{code:"IT",name:"Italian"},{code:"CI",name:"Ivorian"},{code:"JM",name:"Jamaican"},{code:"JP",name:"Japanese"},{code:"JE",name:"Jersey"},{code:"JO",name:"Jordanian"},{code:"KZ",name:"Kazakhstani"},{code:"KE",name:"Kenyan"},{code:"KI",name:"I-Kiribati"},{code:"KP",name:"North Korean"},{code:"KR",name:"South Korean"},{code:"KW",name:"Kuwaiti"},{code:"KG",name:"Kyrgyzstani"},{code:"LA",name:"Laotian"},{code:"LV",name:"Latvian"},{code:"LB",name:"Lebanese"},{code:"LS",name:"Sotho"},{code:"LR",name:"Liberian"},{code:"LY",name:"Libyan"},{code:"LI",name:"Liechtenstein"},{code:"LT",name:"Lithuanian"},{code:"LU",name:"Luxembourg"},{code:"MO",name:"Macanese"},{code:"MK",name:"Macedonian"},{code:"MG",name:"Malagasy"},{code:"MW",name:"Malawian"},{code:"MY",name:"Malaysian"},{code:"MV",name:"Maldivian"},{code:"ML",name:"Malian"},{code:"MT",name:"Maltese"},{code:"MH",name:"Marshallese"},{code:"MQ",name:"Martinique"},{code:"MR",name:"Mauritanian"},{code:"MU",name:"Mauritian"},{code:"YT",name:"Mahoran"},{code:"MX",name:"Mexican"},{code:"FM",name:"Micronesian"},{code:"MD",name:"Moldovan"},{code:"MC",name:"Monegasque"},{code:"MN",name:"Mongolian"},{code:"ME",name:"Montenegrin"},{code:"MA",name:"Moroccan"},{code:"MZ",name:"Mozambican"},{code:"MM",name:"Burmese"},{code:"NA",name:"Namibian"},{code:"NR",name:"Nauruan"},{code:"NP",name:"Nepalese"},{code:"NL",name:"Dutch"},{code:"AN",name:"Dutch"},{code:"NC",name:"New Caledonian"},{code:"NZ",name:"New Zealand"},{code:"NI",name:"Nicaraguan"},{code:"NE",name:"Nigerien"},{code:"NG",name:"Nigerian"},{code:"NU",name:"Niuean"},{code:"NF",name:"Norfolk Islander"},{code:"MP",name:"Northern Mariana Islander"},{code:"NO",name:"Norwegian"},{code:"OM",name:"Omani"},{code:"PK",name:"Pakistani"},{code:"PW",name:"Palauan"},{code:"PS",name:"Palestinian"},{code:"PA",name:"Panamanian"},{code:"PG",name:"Papua New Guinean"},{code:"PY",name:"Paraguayan"},{code:"PE",name:"Peruvian"},{code:"PH",name:"Philippine"},{code:"PN",name:"Pitcairn Islander"},{code:"PL",name:"Polish"},{code:"PT",name:"Portuguese"},{code:"PR",name:"Puerto Rican"},{code:"QA",name:"Qatari"},{code:"RE",name:"Reunionese"},{code:"RO",name:"Romanian"},{code:"RU",name:"Russian"},{code:"RW",name:"Rwandan"},{code:"BL",name:"Saint Barthelemy"},{code:"SH",name:"Saint Helenian"},{code:"KN",name:"Kittitian or Nevisian"},{code:"LC",name:"Saint Lucian"},{code:"MF",name:"Saint Martin"},{code:"PM",name:"Saint Pierre"},{code:"VC",name:"Vincentian"},{code:"WS",name:"Samoan"},{code:"SM",name:"Sammarinese"},{code:"ST",name:"Sao Tome"},{code:"SA",name:"Saudi"},{code:"SN",name:"Senegalese"},{code:"RS",name:"Serbian"},{code:"SC",name:"Seychellois"},{code:"SL",name:"Sierra Leonean"},{code:"SG",name:"Singaporean"},{code:"SK",name:"Slovak"},{code:"SI",name:"Slovenian"},{code:"SB",name:"Solomon Islander"},{code:"SO",name:"Somali"},{code:"ZA",name:"South African"},{code:"GS",name:"South Georgia"},{code:"SS",name:"South Sudanese"},{code:"ES",name:"Spanish"},{code:"LK",name:"Sri Lankan"},{code:"SD",name:"Sudanese"},{code:"SR",name:"Surinamese"},{code:"SJ",name:"Svalbard Islander"},{code:"SZ",name:"Swazi"},{code:"SE",name:"Swedish"},{code:"CH",name:"Swiss"},{code:"SY",name:"Syrian"},{code:"TW",name:"Taiwanese"},{code:"TJ",name:"Tajikistani"},{code:"TZ",name:"Tanzanian"},{code:"TH",name:"Thai"},{code:"TL",name:"Timorese"},{code:"TG",name:"Togolese"},{code:"TK",name:"Tokelauan"},{code:"TO",name:"Tongan"},{code:"TT",name:"Trinidad and Tobagonian"},{code:"TN",name:"Tunisian"},{code:"TR",name:"Turkish"},{code:"TM",name:"Turkmenistani"},{code:"TC",name:"Turks and Caicos Islander"},{code:"TV",name:"Tuvaluan"},{code:"UG",name:"Ugandan"},{code:"UA",name:"Ukrainian"},{code:"AE",name:"Emirati"},{code:"GB",name:"British"},{code:"US",name:"American"},{code:"UY",name:"Uruguayan"},{code:"UZ",name:"Uzbekistani"},{code:"VU",name:"Vanuatu"},{code:"VA",name:"Vatican"},{code:"VE",name:"Venezuelan"},{code:"VN",name:"Vietnamese"},{code:"VG",name:"Virgin Islander"},{code:"VI",name:"Virgin Islander"},{code:"WF",name:"Wallis and Futuna Islander"},{code:"EH",name:"Sahrawi"},{code:"YE",name:"Yemeni"},{code:"ZM",name:"Zambian"},{code:"ZW",name:"Zimbabwean"}];getCountries(){return[...this.countries]}getNationalities(){return[...this.nationalities]}getCountryByCode(e){return this.countries.find(t=>t.code===e)}getNationalityByCode(e){return this.nationalities.find(t=>t.code===e)}getCountryName(e){let t=this.getCountryByCode(e);return t?t.name:e}getNationalityName(e){let t=this.getNationalityByCode(e);return t?t.name:e}static \u0275fac=function(t){return new(t||r)};static \u0275prov=xt({token:r,factory:r.\u0275fac,providedIn:"root"})};var mn=(r,e)=>e._id;function cn(r,e){r&1&&(a(0,"span"),s(1,"Searching..."),n())}function dn(r,e){if(r&1&&(a(0,"mat-option",6)(1,"span",8),s(2),T(3,"getGuestName"),n(),a(4,"span",9),s(5),n()()),r&2){let t=e.$implicit;g("value",t),m(2),V(Dt(3,3,t)),m(3),V(t==null?null:t.email)}}function un(r,e){r&1&&(a(0,"mat-option",7),s(1,"No guests found"),n())}var ct=class r{placeholder=O("Search for guest by name or email...");label=O("Select Guest");initialValue=O("");guestType=O(void 0);guestSelected=z();searchCleared=z();guestService=_(De);storeStore=_(ae);destroy$=new ke;guestSearchControl=new Ai("");filteredGuests=E([]);isLoading=E(!1);ngOnInit(){this.initializeSearchControl()}initializeSearchControl(){this.guestSearchControl.valueChanges.pipe(di(""),ci(300),Ue(),ui(e=>{if(!e||e.length<2)return this.filteredGuests.set([]),bt({guests:[],total:0,page:1,totalPages:0});this.isLoading.set(!0);let t=this.storeStore.selectedStore()?._id;return this.guestService.searchGuests(e,1,10,t)}),ee(this.destroy$)).subscribe(e=>{this.filteredGuests.set(e?.guests||[]),this.isLoading.set(!1)},e=>{console.error("Error searching guests:",e),this.filteredGuests.set([]),this.isLoading.set(!1)}),this.initialValue()&&this.guestSearchControl.setValue(this.initialValue())}onGuestSelected(e){this.guestSearchControl.setValue(`${this.guestService.getGuestName(e)}`),this.guestSelected.emit(e)}onClear(){this.guestSearchControl.setValue(""),this.filteredGuests.set([]),this.searchCleared.emit()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=G({type:r,selectors:[["app-guest-search"]],inputs:{placeholder:[1,"placeholder"],label:[1,"label"],initialValue:[1,"initialValue"],guestType:[1,"guestType"]},outputs:{guestSelected:"guestSelected",searchCleared:"searchCleared"},decls:13,vars:6,consts:[["guestAutoComplete","matAutocomplete"],[1,"w-full"],["appearance","outline",1,"w-full"],["matPrefix","",1,"text-gray-500","material-icons-outlined"],["matInput","",3,"formControl","placeholder","matAutocomplete"],[3,"optionSelected"],[3,"value"],["disabled",""],[1,"font-medium"],[1,"text-sm","text-gray-500","ml-2"]],template:function(t,i){if(t&1){let o=R();a(0,"div",1)(1,"mat-form-field",2)(2,"mat-label"),s(3),n(),a(4,"mat-icon",3),s(5,"search"),n(),v(6,"input",4),h(7,cn,2,0,"span"),a(8,"mat-autocomplete",5,0),S("optionSelected",function(c){return F(o),M(i.onGuestSelected(c.option.value))}),j(10,dn,6,5,"mat-option",6,mn),h(12,un,2,0,"mat-option",7),n()()()}if(t&2){let o=fe(9);m(3),V(i.label()),m(3),g("formControl",i.guestSearchControl)("placeholder",i.placeholder())("matAutocomplete",o),m(),f(i.isLoading()?7:-1),m(3),W(i.filteredGuests()),m(2),f(i.filteredGuests().length===0&&!i.isLoading()?12:-1)}},dependencies:[I,L,ne,Z,Vi,$,Y,J,ze,w,he,Zi,Wi,ce,zi,A,Q,xe,q,we,Ht],styles:["[_nghost-%COMP%]{display:block;width:100%}"]})};var Kt=(r,e)=>e.code;function pn(r,e){r&1&&(a(0,"h2",11),s(1,"Edit Child Guest"),n())}function gn(r,e){r&1&&(a(0,"h2",11),s(1,"Edit Individual Guest"),n())}function hn(r,e){r&1&&(a(0,"h2",11),s(1,"Edit Company Guest"),n())}function fn(r,e){if(r&1&&h(0,pn,2,0,"h2",11)(1,gn,2,0,"h2",11)(2,hn,2,0,"h2",11),r&2){let t=p();f(t.isChildGuest()?0:t.guestType()==="individual"?1:2)}}function vn(r,e){r&1&&(a(0,"h2",11),s(1,"Create Child Guest"),n())}function Cn(r,e){r&1&&(a(0,"h2",11),s(1,"Create Individual Guest"),n())}function _n(r,e){r&1&&(a(0,"h2",11),s(1,"Create Company Guest"),n())}function yn(r,e){if(r&1&&h(0,vn,2,0,"h2",11)(1,Cn,2,0,"h2",11)(2,_n,2,0,"h2",11),r&2){let t=p();f(t.isChildGuest()?0:t.guestType()==="individual"?1:2)}}function Sn(r,e){if(r&1){let t=R();a(0,"div",3)(1,"h4",12),s(2,"Search Existing Guest"),n(),a(3,"p",13),s(4,"Search and select an existing guest to auto-fill the form"),n(),a(5,"app-guest-search",14),S("guestSelected",function(o){F(t);let l=p();return M(l.onSelectExistingGuest(o))}),n()()}}function bn(r,e){r&1&&(a(0,"mat-error"),s(1,"First name is required"),n())}function xn(r,e){r&1&&(a(0,"mat-error"),s(1,"First name must be at least 2 characters"),n())}function Fn(r,e){r&1&&(a(0,"mat-error"),s(1,"Last name is required"),n())}function Mn(r,e){r&1&&(a(0,"mat-error"),s(1,"Last name must be at least 2 characters"),n())}function En(r,e){if(r&1&&(a(0,"mat-option",21),s(1),n()),r&2){let t=e.$implicit;g("value",t.name),m(),V(t.name)}}function Dn(r,e){if(r&1&&(a(0,"h4",12),s(1,"Individual Information"),n(),a(2,"div",15)(3,"mat-form-field",6)(4,"mat-label"),s(5,"First Name"),n(),v(6,"input",16),h(7,bn,2,0,"mat-error"),h(8,xn,2,0,"mat-error"),n(),a(9,"mat-form-field",6)(10,"mat-label"),s(11,"Last Name"),n(),v(12,"input",17),h(13,Fn,2,0,"mat-error"),h(14,Mn,2,0,"mat-error"),n(),a(15,"mat-form-field",6)(16,"mat-label"),s(17,"Date of Birth"),n(),v(18,"input",18)(19,"mat-datepicker-toggle",19)(20,"mat-datepicker",null,0),n(),a(22,"mat-form-field",6)(23,"mat-label"),s(24,"Nationality"),n(),a(25,"mat-select",20),j(26,En,2,2,"mat-option",21,Kt),n()()()),r&2){let t,i,o,l,c=fe(21),d=p();m(7),f((t=d.guestForm.get("firstName"))!=null&&t.hasError("required")&&((t=d.guestForm.get("firstName"))!=null&&t.touched)?7:-1),m(),f((i=d.guestForm.get("firstName"))!=null&&i.hasError("minlength")&&((i=d.guestForm.get("firstName"))!=null&&i.touched)?8:-1),m(5),f((o=d.guestForm.get("lastName"))!=null&&o.hasError("required")&&((o=d.guestForm.get("lastName"))!=null&&o.touched)?13:-1),m(),f((l=d.guestForm.get("lastName"))!=null&&l.hasError("minlength")&&((l=d.guestForm.get("lastName"))!=null&&l.touched)?14:-1),m(4),g("matDatepicker",c),m(),g("for",c),m(7),W(d.nationalities())}}function Nn(r,e){r&1&&(a(0,"mat-error"),s(1,"Company name is required"),n())}function Rn(r,e){r&1&&(a(0,"mat-error"),s(1,"Company name must be at least 2 characters"),n())}function kn(r,e){r&1&&(a(0,"mat-error"),s(1,"First name is required"),n())}function Gn(r,e){r&1&&(a(0,"mat-error"),s(1,"First name must be at least 2 characters"),n())}function Tn(r,e){r&1&&(a(0,"mat-error"),s(1,"Last name is required"),n())}function In(r,e){r&1&&(a(0,"mat-error"),s(1,"Last name must be at least 2 characters"),n())}function Pn(r,e){if(r&1&&(a(0,"h4",12),s(1,"Company Information"),n(),a(2,"div",15)(3,"mat-form-field",6)(4,"mat-label"),s(5,"Company Name"),n(),v(6,"input",22),h(7,Nn,2,0,"mat-error"),h(8,Rn,2,0,"mat-error"),n(),a(9,"mat-form-field",6)(10,"mat-label"),s(11,"Registration Number"),n(),v(12,"input",23),n(),a(13,"mat-form-field",6)(14,"mat-label"),s(15,"Contact Person First Name"),n(),v(16,"input",24),h(17,kn,2,0,"mat-error"),h(18,Gn,2,0,"mat-error"),n(),a(19,"mat-form-field",6)(20,"mat-label"),s(21,"Contact Person Last Name"),n(),v(22,"input",25),h(23,Tn,2,0,"mat-error"),h(24,In,2,0,"mat-error"),n(),a(25,"mat-form-field",26)(26,"mat-label"),s(27,"Contact Person Title"),n(),v(28,"input",27),n()()),r&2){let t,i,o,l,c,d,C=p();m(7),f((t=C.guestForm.get("companyName"))!=null&&t.hasError("required")&&((t=C.guestForm.get("companyName"))!=null&&t.touched)?7:-1),m(),f((i=C.guestForm.get("companyName"))!=null&&i.hasError("minlength")&&((i=C.guestForm.get("companyName"))!=null&&i.touched)?8:-1),m(9),f((o=C.guestForm.get("contactPersonFirstName"))!=null&&o.hasError("required")&&((o=C.guestForm.get("contactPersonFirstName"))!=null&&o.touched)?17:-1),m(),f((l=C.guestForm.get("contactPersonFirstName"))!=null&&l.hasError("minlength")&&((l=C.guestForm.get("contactPersonFirstName"))!=null&&l.touched)?18:-1),m(5),f((c=C.guestForm.get("contactPersonLastName"))!=null&&c.hasError("required")&&((c=C.guestForm.get("contactPersonLastName"))!=null&&c.touched)?23:-1),m(),f((d=C.guestForm.get("contactPersonLastName"))!=null&&d.hasError("minlength")&&((d=C.guestForm.get("contactPersonLastName"))!=null&&d.touched)?24:-1)}}function wn(r,e){r&1&&(a(0,"mat-error"),s(1,"Email is required"),n())}function An(r,e){r&1&&(a(0,"mat-error"),s(1,"Please enter a valid email"),n())}function Vn(r,e){if(r&1&&(a(0,"div")(1,"h4",12),s(2,"Contact Information"),n(),a(3,"div",15)(4,"mat-form-field",6)(5,"mat-label"),s(6,"Email"),n(),v(7,"input",28),h(8,wn,2,0,"mat-error"),h(9,An,2,0,"mat-error"),n(),a(10,"mat-form-field",6)(11,"mat-label"),s(12,"Phone"),n(),v(13,"input",29),n()()()),r&2){let t,i,o=p();m(8),f((t=o.guestForm.get("email"))!=null&&t.hasError("required")&&((t=o.guestForm.get("email"))!=null&&t.touched)?8:-1),m(),f((i=o.guestForm.get("email"))!=null&&i.hasError("email")&&((i=o.guestForm.get("email"))!=null&&i.touched)?9:-1)}}function On(r,e){if(r&1&&(a(0,"mat-option",21),s(1),n()),r&2){let t=e.$implicit;g("value",t.name),m(),b(" ",t.name," ")}}function Bn(r,e){if(r&1&&(a(0,"div")(1,"h4",12),s(2,"Additional Details"),n(),a(3,"div",15)(4,"mat-form-field",6)(5,"mat-label"),s(6,"Nationality"),n(),a(7,"mat-select",30)(8,"mat-option",31),s(9,"-- Select Nationality --"),n(),j(10,On,2,2,"mat-option",21,Kt),n()()()()),r&2){let t=p();m(10),W(t.nationalities())}}function Ln(r,e){if(r&1&&(a(0,"mat-option",21),s(1),n()),r&2){let t=e.$implicit;g("value",t.name),m(),b(" ",t.name," ")}}function qn(r,e){if(r&1&&(a(0,"div",5)(1,"h4",12),s(2,"ID Document"),n(),a(3,"div",15)(4,"mat-form-field",6)(5,"mat-label"),s(6,"Document Type"),n(),a(7,"mat-select",32)(8,"mat-option",33),s(9,"Passport"),n(),a(10,"mat-option",34),s(11,"National ID"),n(),a(12,"mat-option",35),s(13,"Driver's License"),n(),a(14,"mat-option",36),s(15,"Other"),n()()(),a(16,"mat-form-field",6)(17,"mat-label"),s(18,"Document Number"),n(),v(19,"input",37),n(),a(20,"mat-form-field",6)(21,"mat-label"),s(22,"Expiry Date"),n(),v(23,"input",38)(24,"mat-datepicker-toggle",19)(25,"mat-datepicker",null,1),n(),a(27,"mat-form-field",6)(28,"mat-label"),s(29,"Issuing Country"),n(),a(30,"mat-select",39)(31,"mat-option",31),s(32,"-- Select Country --"),n(),j(33,Ln,2,2,"mat-option",21,Kt),n()()()()),r&2){let t=fe(26),i=p();g("formGroup",i.idDocumentForm),m(23),g("matDatepicker",t),m(),g("for",t),m(9),W(i.countries())}}function Un(r,e){if(r&1&&(a(0,"mat-option",21),s(1),n()),r&2){let t=e.$implicit;g("value",t.name),m(),b(" ",t.name," ")}}function Hn(r,e){if(r&1&&(a(0,"div",5)(1,"h4",12),s(2,"Address"),n(),a(3,"div",40)(4,"mat-form-field",6)(5,"mat-label"),s(6,"Street"),n(),v(7,"input",41),n(),a(8,"div",15)(9,"mat-form-field",6)(10,"mat-label"),s(11,"City"),n(),v(12,"input",42),n(),a(13,"mat-form-field",6)(14,"mat-label"),s(15,"State/Province"),n(),v(16,"input",43),n()(),a(17,"div",15)(18,"mat-form-field",6)(19,"mat-label"),s(20,"Country"),n(),a(21,"mat-select",44)(22,"mat-option",31),s(23,"-- Select Country --"),n(),j(24,Un,2,2,"mat-option",21,Kt),n()(),a(26,"mat-form-field",6)(27,"mat-label"),s(28,"Postal Code"),n(),v(29,"input",45),n()()()()),r&2){let t=p();g("formGroup",t.addressForm),m(24),W(t.countries())}}function $n(r,e){if(r&1&&(a(0,"div",5)(1,"h4",12),s(2,"Emergency Contact"),n(),a(3,"div",40)(4,"div",15)(5,"mat-form-field",6)(6,"mat-label"),s(7,"Name"),n(),v(8,"input",46),n(),a(9,"mat-form-field",6)(10,"mat-label"),s(11,"Relationship"),n(),v(12,"input",47),n()(),a(13,"div",15)(14,"mat-form-field",6)(15,"mat-label"),s(16,"Phone"),n(),v(17,"input",48),n(),a(18,"mat-form-field",6)(19,"mat-label"),s(20,"Email"),n(),v(21,"input",49),n()()()()),r&2){let t=p();g("formGroup",t.emergencyContactForm)}}function Kn(r,e){r&1&&(a(0,"mat-form-field",6)(1,"mat-label"),s(2,"Notes"),n(),v(3,"textarea",50),n())}function jn(r,e){r&1&&(a(0,"mat-icon",10),s(1,"refresh"),n())}function Wn(r,e){r&1&&(a(0,"mat-icon",51),s(1,"edit_outline"),n())}function zn(r,e){r&1&&(a(0,"mat-icon",51),s(1,"person_add"),n())}function Zn(r,e){if(r&1&&h(0,Wn,2,0,"mat-icon",51)(1,zn,2,0,"mat-icon",51),r&2){let t=p();f(t.isEditing()?0:1)}}function Jn(r,e){r&1&&s(0," Update Guest ")}function Yn(r,e){r&1&&s(0," Create Guest ")}var _e=class r{dialogRef=_(qt);fb=_(Se);snackBar=_(je);guestService=_(De);storeStore=_(ae);locationService=_($t);dialogData=_(et,{optional:!0});destroy$=new ke;isSaving=E(!1);countries=E([]);nationalities=E([]);guestType=E("individual");ageGrade=E("adult");isEditing=E(!1);editingGuestId=E(null);isChildGuest=D(()=>this.ageGrade()==="child");guestForm;constructor(){let e=this.dialogData?.guest,t=this.dialogData?.bookingType||"single",i=this.dialogData?.ageGrade||"adult";if(this.ageGrade.set(i),e){this.isEditing.set(!0),this.editingGuestId.set(e._id);let o=e.guestType||"individual";this.guestType.set(o)}else i==="child"?this.guestType.set("individual"):t==="group"&&this.guestType.set("corporate");this.guestForm=this.createForm(),this.countries.set(this.locationService.getCountries()),this.nationalities.set(this.locationService.getNationalities()),e&&this.populateFormWithGuest(e)}ngOnInit(){this.updateValidators()}populateFormWithGuest(e){let t={guestType:e.guestType||"individual",email:e.email||"",phone:e.phone||"",nationality:e.nationality||"",dateOfBirth:e.dateOfBirth||"",firstName:e.firstName||"",lastName:e.lastName||"",companyName:e.companyName||"",companyRegistrationNumber:e.companyRegistrationNumber||"",contactPersonFirstName:e.contactPersonFirstName||"",contactPersonLastName:e.contactPersonLastName||"",contactPersonTitle:e.contactPersonTitle||"",notes:e.notes||"",idDocument:{type:e.idDocument?.type||"passport",number:e.idDocument?.number||"",expiryDate:e.idDocument?.expiryDate||"",issuingCountry:e.idDocument?.issuingCountry||""},address:{street:e.address?.street||"",city:e.address?.city||"",state:e.address?.state||"",country:e.address?.country||"",postalCode:e.address?.postalCode||""},emergencyContact:{name:e.emergencyContact?.name||"",relationship:e.emergencyContact?.relationship||"",phone:e.emergencyContact?.phone||"",email:e.emergencyContact?.email||""}};this.guestForm.patchValue(t)}updateValidators(){let e=this.guestType(),t=this.isChildGuest(),i=this.guestForm.get("firstName"),o=this.guestForm.get("lastName"),l=this.guestForm.get("email"),c=this.guestForm.get("phone"),d=this.guestForm.get("companyName"),C=this.guestForm.get("contactPersonFirstName"),x=this.guestForm.get("contactPersonLastName");t||e==="individual"?(i?.setValidators([u.required,u.minLength(2)]),o?.setValidators([u.required,u.minLength(2)]),t?(l?.clearValidators(),c?.clearValidators()):(l?.setValidators([u.required,u.email]),c?.setValidators([u.required])),d?.clearValidators(),C?.clearValidators(),x?.clearValidators()):e==="corporate"&&(i?.clearValidators(),o?.clearValidators(),l?.setValidators([u.required,u.email]),c?.setValidators([u.required]),d?.setValidators([u.required,u.minLength(2)]),C?.setValidators([u.required,u.minLength(2)]),x?.setValidators([u.required,u.minLength(2)])),i?.updateValueAndValidity(),o?.updateValueAndValidity(),l?.updateValueAndValidity(),c?.updateValueAndValidity(),d?.updateValueAndValidity(),C?.updateValueAndValidity(),x?.updateValueAndValidity()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}createForm(){return this.fb.group({guestType:[this.guestType(),[u.required]],firstName:[""],lastName:[""],dateOfBirth:[""],nationality:[""],companyName:[""],companyRegistrationNumber:[""],contactPersonFirstName:[""],contactPersonLastName:[""],contactPersonTitle:[""],email:["",[u.required,u.email]],phone:[""],idDocument:this.fb.group({type:["passport"],number:[""],expiryDate:[""],issuingCountry:[""]}),address:this.fb.group({street:[""],city:[""],state:[""],country:[""],postalCode:[""]}),emergencyContact:this.fb.group({name:[""],relationship:[""],phone:[""],email:[""]}),notes:[""]})}get addressForm(){return this.guestForm.get("address")}get emergencyContactForm(){return this.guestForm.get("emergencyContact")}get idDocumentForm(){return this.guestForm.get("idDocument")}onSelectExistingGuest(e){this.dialogRef.close(e)}onSubmit(){return ye(this,null,function*(){if(this.guestForm.invalid){this.markFormGroupTouched(this.guestForm),this.showError("Please fill in all required fields correctly");return}this.isSaving.set(!0);try{let e=this.guestForm.value,t=this.prepareGuestData(e),i;if(this.isEditing()){let o=this.editingGuestId();if(!o){this.showError("Guest ID is missing");return}i=yield this.guestService.updateGuest(o,t).toPromise(),this.showSuccess("Guest updated successfully")}else i=yield this.guestService.createGuest(t).toPromise(),this.showSuccess("Guest created successfully");this.dialogRef.close(i)}catch(e){console.error("Error saving guest:",e),this.showError(this.isEditing()?"Failed to update guest":"Failed to create guest")}finally{this.isSaving.set(!1)}})}prepareGuestData(e){let t=this.storeStore.selectedStore()?._id,i=e.guestType||"individual";if(this.isChildGuest())return{guestType:"individual",firstName:e.firstName,lastName:e.lastName,dateOfBirth:e.dateOfBirth,stores:t?[t]:[]};let l={guestType:i,email:e.email,phone:e.phone,idDocument:e.idDocument,address:e.address,emergencyContact:e.emergencyContact,notes:e.notes,stores:t?[t]:[]};return i==="individual"?ii(ti({},l),{firstName:e.firstName,lastName:e.lastName,dateOfBirth:e.dateOfBirth,nationality:e.nationality}):ii(ti({},l),{companyName:e.companyName,companyRegistrationNumber:e.companyRegistrationNumber,contactPersonFirstName:e.contactPersonFirstName,contactPersonLastName:e.contactPersonLastName,contactPersonTitle:e.contactPersonTitle})}onCancel(){this.dialogRef.close()}getFieldError(e){let t=this.guestForm.get(e);if(t&&t.errors&&t.touched){if(t.errors.required)return`${this.getFieldLabel(e)} is required`;if(t.errors.email)return"Please enter a valid email address";if(t.errors.minlength)return`${this.getFieldLabel(e)} must be at least ${t.errors.minlength.requiredLength} characters`}return""}getFieldLabel(e){return{firstName:"First Name",lastName:"Last Name",email:"Email",phone:"Phone Number"}[e]||e}markFormGroupTouched(e){Object.keys(e.controls).forEach(t=>{let i=e.get(t);i?.markAsTouched({onlySelf:!0}),i instanceof Tt&&this.markFormGroupTouched(i)})}showSuccess(e){this.snackBar.open(e,"Close",{duration:3e3,panelClass:["success-snackbar"]})}showError(e){this.snackBar.open(e,"Close",{duration:5e3,panelClass:["error-snackbar"]})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=G({type:r,selectors:[["app-guest-form-modal"]],decls:22,vars:13,consts:[["dateOfBirthPicker",""],["expiryDatePicker",""],[1,"max-h-[70vh]","overflow-y-auto"],[1,"mb-6","pb-6","border-b","border-gray-200"],[1,"space-y-6",3,"formGroup"],[3,"formGroup"],["appearance","outline",1,"w-full"],["align","end",1,"pt-4"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"animate-spin","mr-2"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[1,"font-semibold","text-sm","text-gray-700","mb-3"],[1,"text-xs","text-gray-500","mb-3"],["label","Select Guest","placeholder","Search by name or email...",3,"guestSelected"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["matInput","","formControlName","firstName","placeholder","Enter first name","required",""],["matInput","","formControlName","lastName","placeholder","Enter last name","required",""],["matInput","","formControlName","dateOfBirth","placeholder","Select date of birth","readonly","",3,"matDatepicker"],["matIconSuffix","",3,"for"],["formControlName","nationality","placeholder","Select nationality"],[3,"value"],["matInput","","formControlName","companyName","placeholder","Enter company name","required",""],["matInput","","formControlName","companyRegistrationNumber","placeholder","Enter registration number"],["matInput","","formControlName","contactPersonFirstName","placeholder","Enter first name","required",""],["matInput","","formControlName","contactPersonLastName","placeholder","Enter last name","required",""],["appearance","outline",1,"w-full","md:col-span-2"],["matInput","","formControlName","contactPersonTitle","placeholder","e.g. Manager, Director"],["matInput","","formControlName","email","placeholder","Enter email address","type","email","required",""],["matInput","","formControlName","phone","placeholder","Enter phone number"],["formControlName","nationality"],["value",""],["formControlName","type"],["value","passport"],["value","national_id"],["value","drivers_license"],["value","other"],["matInput","","formControlName","number","placeholder","Enter document number"],["matInput","","formControlName","expiryDate","placeholder","Select expiry date","readonly","",3,"matDatepicker"],["formControlName","issuingCountry"],[1,"space-y-4"],["matInput","","formControlName","street","placeholder","Enter street address"],["matInput","","formControlName","city","placeholder","Enter city"],["matInput","","formControlName","state","placeholder","Enter state/province"],["formControlName","country"],["matInput","","formControlName","postalCode","placeholder","Enter postal code"],["matInput","","formControlName","name","placeholder","Emergency contact name"],["matInput","","formControlName","relationship","placeholder","e.g., Family, Friend"],["matInput","","formControlName","phone","placeholder","Emergency contact phone"],["matInput","","formControlName","email","placeholder","Emergency contact email","type","email"],["matInput","","formControlName","notes","placeholder","Add any additional notes about the guest","rows","3"],[1,"mr-2"]],template:function(t,i){t&1&&(h(0,fn,3,1)(1,yn,3,1),a(2,"mat-dialog-content",2),h(3,Sn,6,0,"div",3),a(4,"form",4)(5,"div"),h(6,Dn,28,6)(7,Pn,29,6),n(),h(8,Vn,14,2,"div"),h(9,Bn,12,0,"div"),h(10,qn,35,3,"div",5),h(11,Hn,30,1,"div",5),h(12,$n,22,1,"div",5),h(13,Kn,4,0,"mat-form-field",6),n()(),a(14,"mat-dialog-actions",7)(15,"button",8),S("click",function(){return i.onCancel()}),s(16,"Cancel"),n(),a(17,"button",9),S("click",function(){return i.onSubmit()}),h(18,jn,2,0,"mat-icon",10)(19,Zn,2,1),h(20,Jn,1,0)(21,Yn,1,0),n()()),t&2&&(f(i.isEditing()?0:1),m(3),f(i.isEditing()?-1:3),m(),g("formGroup",i.guestForm),m(2),f(i.guestType()==="individual"?6:7),m(2),f(i.isChildGuest()?-1:8),m(),f(i.isChildGuest()?-1:9),m(),f(i.isChildGuest()?-1:10),m(),f(i.isChildGuest()?-1:11),m(),f(i.isChildGuest()?-1:12),m(),f(i.isChildGuest()?-1:13),m(4),g("disabled",i.isSaving()||i.guestForm.invalid),m(),f(i.isSaving()?18:19),m(2),f(i.isEditing()?20:21))},dependencies:[I,L,Te,ne,Z,U,Bi,B,oe,ot,tt,nt,it,w,he,Y,J,We,Pe,re,Ee,ce,q,ie,A,Q,H,$,xe,Me,$i,Ki,Ve,Ke,Hi,ct],encapsulation:2})};var X=class r{formSubject=new mi(null);form$=this.formSubject.asObservable();setForm(e){this.formSubject.next(e)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=xt({token:r,factory:r.\u0275fac,providedIn:"root"})};function Qn(r,e){if(r&1){let t=R();a(0,"div",1)(1,"div",4)(2,"mat-icon",5),s(3,"person_outline"),n(),a(4,"p",6),s(5,"No guest selected"),n()(),a(6,"app-guest-search",7),S("guestSelected",function(o){F(t);let l=p();return M(l.onGuestSearchSelected(o))}),n()()}if(r&2){let t=p();m(6),g("guestType",t.bookingType()==="group"?"group":"single")}}function Xn(r,e){if(r&1&&(a(0,"mat-list-item")(1,"mat-icon",8),s(2,"mail_outline"),n(),a(3,"div",10),s(4,"Email"),n(),a(5,"div",11),s(6),n()()),r&2){let t,i=p(2);m(6),V((t=i.guest())==null?null:t.email)}}function eo(r,e){if(r&1&&(a(0,"mat-list-item")(1,"mat-icon",8),s(2,"phone_outline"),n(),a(3,"div",10),s(4,"Phone"),n(),a(5,"div",11),s(6),n()()),r&2){let t,i=p(2);m(6),V((t=i.guest())==null?null:t.phone)}}function to(r,e){if(r&1&&(a(0,"mat-list-item")(1,"mat-icon",8),s(2,"cake_outline"),n(),a(3,"div",10),s(4,"Date of Birth"),n(),a(5,"div",11),s(6),T(7,"date"),n()()),r&2){let t,i=p(2);m(6),b(" ",Be(7,1,(t=i.guest())==null?null:t.dateOfBirth,"MMM dd, yyyy")," ")}}function io(r,e){if(r&1&&(a(0,"mat-list-item")(1,"mat-icon",8),s(2,"verified_outline"),n(),a(3,"div",10),s(4,"Registration Number"),n(),a(5,"div",11),s(6),n()()),r&2){let t,i=p(2);m(6),b(" ",(t=i.guest())==null?null:t.companyRegistrationNumber," ")}}function no(r,e){if(r&1&&(a(0,"span"),s(1),n()),r&2){let t,i=p(3);m(),b("",(t=i.guest())==null||t.address==null?null:t.address.street,", ")}}function oo(r,e){if(r&1&&(a(0,"span"),s(1),n()),r&2){let t,i=p(3);m(),b("",(t=i.guest())==null||t.address==null?null:t.address.city,", ")}}function ao(r,e){if(r&1&&(a(0,"span"),s(1),n()),r&2){let t,i=p(3);m(),V((t=i.guest())==null||t.address==null?null:t.address.country)}}function ro(r,e){if(r&1&&(a(0,"mat-list-item")(1,"mat-icon",8),s(2,"location_on_outline"),n(),a(3,"div",10),s(4,"Address"),n(),a(5,"div",11),h(6,no,2,1,"span"),h(7,oo,2,1,"span"),h(8,ao,2,1,"span"),n()()),r&2){let t,i,o,l=p(2);m(6),f(!((t=l.guest())==null||t.address==null)&&t.address.street?6:-1),m(),f(!((i=l.guest())==null||i.address==null)&&i.address.city?7:-1),m(),f(!((o=l.guest())==null||o.address==null)&&o.address.country?8:-1)}}function so(r,e){if(r&1&&(a(0,"div",1)(1,"mat-list")(2,"mat-list-item")(3,"mat-icon",8),s(4,"account_circle"),n(),a(5,"div",9),s(6),T(7,"getGuestName"),n()(),h(8,Xn,7,1,"mat-list-item"),h(9,eo,7,1,"mat-list-item"),h(10,to,8,4,"mat-list-item"),h(11,io,7,1,"mat-list-item"),h(12,ro,9,3,"mat-list-item"),n()()),r&2){let t,i,o,l,c,d=p();m(6),b(" ",Dt(7,6,d.guest())," "),m(2),f((t=d.guest())!=null&&t.email?8:-1),m(),f((i=d.guest())!=null&&i.phone?9:-1),m(),f(d.bookingType()==="single"&&((o=d.guest())!=null&&o.dateOfBirth)?10:-1),m(),f(d.bookingType()==="group"&&((l=d.guest())!=null&&l.companyRegistrationNumber)?11:-1),m(),f((c=d.guest())!=null&&c.address?12:-1)}}function lo(r,e){if(r&1){let t=R();a(0,"button",12),S("click",function(){F(t);let o=p();return M(o.onAddGuest())}),a(1,"mat-icon",13),s(2,"person_add_outline"),n(),s(3," Add Guest "),n()}}function mo(r,e){if(r&1){let t=R();a(0,"button",14),S("click",function(){F(t);let o=p();return M(o.onEditGuest())}),a(1,"mat-icon",13),s(2,"edit_outline"),n(),s(3," Edit "),n(),a(4,"button",15),S("click",function(){F(t);let o=p();return M(o.onDeleteGuest())}),a(5,"mat-icon",13),s(6,"delete_outline"),n(),s(7," Delete "),n()}}var jt=class r{reservationFormService=_(X);reservationForm=P(this.reservationFormService.form$,{initialValue:null});guest=O(null);bookingType=E(this.reservationForm().get("bookingType")?.value||"single");guestAdded=z();guestEdited=z();guestDeleted=z();guestSelected=z();dialog=_(Ae);onAddGuest(){this.dialog.open(_e,{width:"600px",disableClose:!1,data:{bookingType:this.bookingType(),ageGrade:"adult"}}).afterClosed().subscribe(t=>{t&&this.onGuestSearchSelected(t)})}onGuestSearchSelected(e){this.guestSelected.emit(e)}onEditGuest(){let e=this.guest();if(!e)return;this.dialog.open(_e,{width:"600px",disableClose:!1,data:{guest:e,bookingType:this.bookingType(),ageGrade:"adult"}}).afterClosed().subscribe(i=>{i&&this.guestEdited.emit()})}onDeleteGuest(){confirm("Are you sure you want to remove this guest?")&&this.guestDeleted.emit()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=G({type:r,selectors:[["app-guest-details"]],inputs:{guest:[1,"guest"]},outputs:{guestAdded:"guestAdded",guestEdited:"guestEdited",guestDeleted:"guestDeleted",guestSelected:"guestSelected"},decls:10,vars:4,consts:[["appearance","outlined"],[1,"space-y-4"],[1,"border-t","border-gray-200","pt-4","flex","justify-end","gap-2"],["type","button","matButton","filled","color","primary"],[1,"text-center","py-4"],[1,"text-gray-300","text-6xl","mb-4","inline-block"],[1,"text-gray-500","text-sm","mb-4"],["placeholder","Search for existing guest...","label","Select Guest",3,"guestSelected","guestType"],["matListItemIcon","",1,"text-gray-600!","material-icons-outlined"],["matListItemTitle","",1,"text-xl","font-semibold","text-gray-900"],["matListItemTitle","",1,"text-sm","text-gray-600!"],["matListItemLine","",1,"text-gray-900","font-medium"],["type","button","matButton","filled","color","primary",3,"click"],[1,"mr-2"],["type","button","mat-button","","color","primary",3,"click"],["type","button","mat-button","","color","warn",3,"click"]],template:function(t,i){t&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),s(3),n()(),a(4,"mat-card-content"),h(5,Qn,7,1,"div",1),h(6,so,13,8,"div",1),n(),a(7,"mat-card-actions",2),h(8,lo,4,0,"button",3)(9,mo,8,0),n()()),t&2&&(m(3),b(" ",i.bookingType()==="single"?"Guest Details":"Booking Owner Details"," "),m(2),f(i.guest()?-1:5),m(),f(i.guest()?6:-1),m(2),f(i.guest()?9:8))},dependencies:[I,H,de,Li,pe,ge,ue,q,ie,A,Q,$,w,Fe,Qe,Xe,Bt,Ot,Ye,ct,ki,Ht],styles:["[_nghost-%COMP%]{display:block}"]})};function co(r,e){if(r&1){let t=R();a(0,"form",2)(1,"div",3)(2,"mat-form-field",4)(3,"mat-label"),s(4,"Stay Dates"),n(),a(5,"mat-date-range-input",5)(6,"input",6),S("change",function(){F(t);let o=p();return M(o.onDateChange())}),n(),a(7,"input",7),S("change",function(){F(t);let o=p();return M(o.onDateChange())}),n()(),v(8,"mat-datepicker-toggle",8),a(9,"mat-hint"),s(10),n(),v(11,"mat-date-range-picker",null,0),n(),a(13,"mat-form-field",4)(14,"mat-label"),s(15,"Sales Person"),n(),v(16,"input",9),n(),a(17,"mat-form-field",4)(18,"mat-label"),s(19,"Number of Nights"),n(),v(20,"input",10),n(),a(21,"mat-form-field",4)(22,"mat-label"),s(23,"Booking Source"),n(),a(24,"mat-select",11)(25,"mat-option",12),s(26,"-- Select Source --"),n(),a(27,"mat-option",13),s(28,"Direct"),n(),a(29,"mat-option",14),s(30,"Phone"),n(),a(31,"mat-option",15),s(32,"Online"),n(),a(33,"mat-option",16),s(34,"Walk-in"),n(),a(35,"mat-option",17),s(36,"Booking.com"),n(),a(37,"mat-option",18),s(38,"Expedia"),n(),a(39,"mat-option",19),s(40,"Airbnb"),n(),a(41,"mat-option",20),s(42,"Travel Agent"),n(),a(43,"mat-option",21),s(44,"Corporate"),n()()()()()}if(r&2){let t=fe(12),i=p();g("formGroup",i.reservationForm()),m(5),g("rangePicker",t),m(3),g("for",t),m(2),b("",i.numberOfNights()," night(s)"),m(6),g("value",i.salesPersonName())}}var zt=class r{reservationFormService=_(X);reservationForm=P(this.reservationFormService.form$,{initialValue:null});checkInDate=P(this.reservationForm().get("checkInDate").valueChanges,{initialValue:this.reservationForm().get("checkInDate").value});checkOutDate=P(this.reservationForm().get("checkOutDate").valueChanges,{initialValue:this.reservationForm().get("checkOutDate").value});numberOfNights=D(()=>{let e=this.checkInDate(),t=this.checkOutDate();if(e&&t){let i=Math.abs(t.getTime()-e.getTime());return Math.ceil(i/(1e3*60*60*24))}return 0});fb=_(Se);authService=_(Gt);quickReservation=O(null);isEditing=O(!1);dateChanged=z();currentUser=P(this.authService.currentUser,{initialValue:null});salesPersonName=D(()=>{let e=this.currentUser();return e&&e.name||""});ngAfterViewInit(){this.reservationForm()?.valueChanges.pipe(Ue((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(e=>{this.reservationForm()?.patchValue({createdBy:this.currentUser()?._id,checkInDate:this.checkInDate(),checkOutDate:this.checkOutDate(),numberOfNights:this.numberOfNights()},{emitEvent:!1})})}onDateChange(){this.dateChanged.emit()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=G({type:r,selectors:[["app-stay-details"]],inputs:{quickReservation:[1,"quickReservation"],isEditing:[1,"isEditing"]},outputs:{dateChanged:"dateChanged"},features:[$e([],[{provide:wi,useExisting:B}])],decls:6,vars:1,consts:[["stayPicker",""],["appearance","outlined"],[3,"formGroup"],[1,"space-y-4","py-3"],["appearance","outline",1,"w-full"],[3,"rangePicker"],["matStartDate","","formControlName","checkInDate","placeholder","Check-in date",3,"change"],["matEndDate","","formControlName","checkOutDate","placeholder","Check-out date",3,"change"],["matSuffix","",3,"for"],["matInput","","readonly","",3,"value"],["formControlName","numberOfNights","matInput","","readonly",""],["formControlName","bookingSource"],["value",""],["value","direct"],["value","phone"],["value","online"],["value","walk_in"],["value","booking_com"],["value","expedia"],["value","airbnb"],["value","travel_agent"],["value","corporate"]],template:function(t,i){t&1&&(a(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title"),s(3," Stay Details "),n()(),a(4,"mat-card-content"),h(5,co,45,5,"form",2),n()()),t&2&&(m(5),f(i.reservationForm()?5:-1))},dependencies:[I,L,Te,ne,Z,U,B,oe,H,de,pe,ge,ue,w,he,Y,J,be,Pe,$,re,Ee,ce,Me,Ve,at,rt,st,lt,A,q],encapsulation:2})};var uo=new hi("currency.mask.config"),ri=class{constructor(e){this.htmlInputElement=e}setCursorAt(e){if(this.htmlInputElement.setSelectionRange)this.htmlInputElement.focus(),this.htmlInputElement.setSelectionRange(e,e);else if(this.htmlInputElement.createTextRange){let t=this.htmlInputElement.createTextRange();t.collapse(!0),t.moveEnd("character",e),t.moveStart("character",e),t.select()}}updateValueAndCursor(e,t,i){this.rawValue=e;let o=e.length;i=i-(t-o),this.setCursorAt(i)}get canInputMoreNumbers(){let e=!(this.rawValue.length>=this.htmlInputElement.maxLength&&this.htmlInputElement.maxLength>=0),t=this.inputSelection.selectionStart,i=this.inputSelection.selectionEnd,o=!!(t!=i&&this.htmlInputElement.value.substring(t,i).match(/\d/)),l=this.htmlInputElement.value.substring(0,1)=="0";return e||o||l}get inputSelection(){let e=0,t=0;if(typeof this.htmlInputElement.selectionStart=="number"&&typeof this.htmlInputElement.selectionEnd=="number")e=this.htmlInputElement.selectionStart,t=this.htmlInputElement.selectionEnd;else{let i=document.getSelection().anchorNode;if(i&&i.firstChild==this.htmlInputElement){let o=this.htmlInputElement.value.length,l=this.htmlInputElement.value.replace(/\r\n/g,`
`),c=this.htmlInputElement.createTextRange(),d=this.htmlInputElement.createTextRange();d.collapse(!1),c.compareEndPoints("StartToEnd",d)>-1?e=t=o:(e=-c.moveStart("character",-o),e+=l.slice(0,e).split(`
`).length-1,c.compareEndPoints("EndToEnd",d)>-1?t=o:(t=-c.moveEnd("character",-o),t+=l.slice(0,t).split(`
`).length-1))}}return{selectionStart:e,selectionEnd:t}}get rawValue(){return this.htmlInputElement&&this.htmlInputElement.value}set rawValue(e){this._storedRawValue=e,this.htmlInputElement&&(this.htmlInputElement.value=e)}get storedRawValue(){return this._storedRawValue}},si=class{constructor(e,t){this.htmlInputElement=e,this.options=t,this.inputManager=new ri(e)}addNumber(e){this.rawValue||(this.rawValue=this.applyMask(!1,"0"));let t=String.fromCharCode(e),i=this.inputSelection.selectionStart,o=this.inputSelection.selectionEnd;this.rawValue=this.rawValue.substring(0,i)+t+this.rawValue.substring(o,this.rawValue.length),this.updateFieldValue(i+1)}applyMask(e,t){let{allowNegative:i,decimal:o,precision:l,prefix:c,suffix:d,thousands:C}=this.options;t=e?new Number(t).toFixed(l):t;let x=t.replace(/[^0-9]/g,"");if(!x)return"";let y=x.slice(0,x.length-l).replace(/^0*/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,C);y==""&&(y="0");let k=y,N=x.slice(x.length-l);l>0&&(N="0".repeat(l-N.length)+N,k+=o+N);let le=parseInt(y)==0&&(parseInt(N)==0||N=="");return(t.indexOf("-")>-1&&i&&!le?"-":"")+c+k+d}clearMask(e){if(e==null||e=="")return null;let t=e.replace(this.options.prefix,"").replace(this.options.suffix,"");return this.options.thousands&&(t=t.replace(new RegExp("\\"+this.options.thousands,"g"),"")),this.options.decimal&&(t=t.replace(this.options.decimal,".")),parseFloat(t)}changeToNegative(){if(this.options.allowNegative&&this.rawValue!=""&&this.rawValue.charAt(0)!="-"&&this.value!=0){let e=this.inputSelection.selectionStart;this.rawValue="-"+this.rawValue,this.updateFieldValue(e+1)}}changeToPositive(){let e=this.inputSelection.selectionStart;this.rawValue=this.rawValue.replace("-",""),this.updateFieldValue(e-1)}fixCursorPosition(e){let t=this.inputSelection.selectionStart;t>this.getRawValueWithoutSuffixEndPosition()||e?this.inputManager.setCursorAt(this.getRawValueWithoutSuffixEndPosition()):t<this.getRawValueWithoutPrefixStartPosition()&&this.inputManager.setCursorAt(this.getRawValueWithoutPrefixStartPosition())}getRawValueWithoutSuffixEndPosition(){return this.rawValue.length-this.options.suffix.length}getRawValueWithoutPrefixStartPosition(){return this.value!=null&&this.value<0?this.options.prefix.length+1:this.options.prefix.length}removeNumber(e){let{decimal:t,thousands:i}=this.options,o=this.inputSelection.selectionEnd,l=this.inputSelection.selectionStart;l>this.rawValue.length-this.options.suffix.length&&(o=this.rawValue.length-this.options.suffix.length,l=this.rawValue.length-this.options.suffix.length),o==l&&((e==46||e==63272)&&/^\d+$/.test(this.rawValue.substring(l,o+1))&&(o=o+1),(e==46||e==63272)&&(this.rawValue.substring(l,o+1)==t||this.rawValue.substring(l,o+1)==i)&&(o=o+2,l=l+1),e==8&&/^\d+$/.test(this.rawValue.substring(l-1,o))&&(l=l-1),e==8&&(this.rawValue.substring(l-1,o)==t||this.rawValue.substring(l-1,o)==i)&&(l=l-2,o=o-1)),this.rawValue=this.rawValue.substring(0,l)+this.rawValue.substring(o,this.rawValue.length),this.updateFieldValue(l)}updateFieldValue(e){let t=this.applyMask(!1,this.rawValue||"");e=e??this.rawValue.length,this.inputManager.updateValueAndCursor(t,this.rawValue.length,e)}updateOptions(e){let t=this.value;this.options=e,this.value=t}get canInputMoreNumbers(){return this.inputManager.canInputMoreNumbers}get inputSelection(){return this.inputManager.inputSelection}get rawValue(){return this.inputManager.rawValue}set rawValue(e){this.inputManager.rawValue=e}get storedRawValue(){return this.inputManager.storedRawValue}get value(){return this.clearMask(this.rawValue)}set value(e){this.rawValue=this.applyMask(!0,""+e)}},li=class{constructor(e,t){this.inputService=new si(e,t),this.htmlInputElement=e}handleClick(e,t){Math.abs(this.inputService.inputSelection.selectionEnd-this.inputService.inputSelection.selectionStart)==0&&!isNaN(this.inputService.value)&&this.inputService.fixCursorPosition(t)}handleCut(e){this.isReadOnly()||setTimeout(()=>{this.inputService.updateFieldValue(),this.setValue(this.inputService.value),this.onModelChange(this.inputService.value)},0)}handleInput(e){if(this.isReadOnly())return;let t=this.getNewKeyCode(this.inputService.storedRawValue,this.inputService.rawValue),i=this.inputService.rawValue.length,o=this.inputService.inputSelection.selectionEnd,l=this.inputService.getRawValueWithoutSuffixEndPosition(),c=this.inputService.storedRawValue.length;if(this.inputService.rawValue=this.inputService.storedRawValue,(o!=l||Math.abs(i-c)!=1)&&c!=0){this.setCursorPosition(e);return}if(i<c&&(this.inputService.value!=0?this.inputService.removeNumber(8):this.setValue(null)),i>c)switch(t){case 43:this.inputService.changeToPositive();break;case 45:this.inputService.changeToNegative();break;default:if(!this.inputService.canInputMoreNumbers||isNaN(this.inputService.value)&&String.fromCharCode(t).match(/\d/)==null)return;this.inputService.addNumber(t)}this.setCursorPosition(e),this.onModelChange(this.inputService.value)}handleKeydown(e){if(this.isReadOnly())return;let t=e.which||e.charCode||e.keyCode;if(t==8||t==46||t==63272){e.preventDefault();let i=Math.abs(this.inputService.inputSelection.selectionEnd-this.inputService.inputSelection.selectionStart);(i==this.inputService.rawValue.length||this.inputService.value==0)&&(this.setValue(null),this.onModelChange(this.inputService.value)),i==0&&!isNaN(this.inputService.value)&&(this.inputService.removeNumber(t),this.onModelChange(this.inputService.value)),(t===8||t===46)&&i!=0&&!isNaN(this.inputService.value)&&(this.inputService.removeNumber(t),this.onModelChange(this.inputService.value))}}handleKeypress(e){if(this.isReadOnly())return;let t=e.which||e.charCode||e.keyCode;if(!(t==null||[9,13].indexOf(t)!=-1||this.isArrowEndHomeKeyInFirefox(e))){switch(t){case 43:this.inputService.changeToPositive();break;case 45:this.inputService.changeToNegative();break;default:this.inputService.canInputMoreNumbers&&(!isNaN(this.inputService.value)||String.fromCharCode(t).match(/\d/)!=null)&&this.inputService.addNumber(t)}e.preventDefault(),this.onModelChange(this.inputService.value)}}handleKeyup(e){this.inputService.fixCursorPosition()}handlePaste(e){this.isReadOnly()||setTimeout(()=>{this.inputService.updateFieldValue(),this.setValue(this.inputService.value),this.onModelChange(this.inputService.value)},1)}updateOptions(e){this.inputService.updateOptions(e)}getOnModelChange(){return this.onModelChange}setOnModelChange(e){this.onModelChange=e}getOnModelTouched(){return this.onModelTouched}setOnModelTouched(e){this.onModelTouched=e}setValue(e){this.inputService.value=e}getNewKeyCode(e,t){if(e.length>t.length)return null;for(let i=0;i<t.length;i++)if(e.length==i||e[i]!=t[i])return t.charCodeAt(i);return null}isArrowEndHomeKeyInFirefox(e){return[35,36,37,38,39,40].indexOf(e.keyCode)!=-1&&(e.charCode==null||e.charCode==0)}isReadOnly(){return this.htmlInputElement&&this.htmlInputElement.readOnly}setCursorPosition(e){let t=this.inputService.getRawValueWithoutSuffixEndPosition(),i=e.target;setTimeout(function(){i.setSelectionRange(t,t)},0)}},po={provide:Ii,useExisting:pi(()=>_t),multi:!0},_t=(()=>{class r{constructor(t,i,o){this.currencyMaskConfig=t,this.elementRef=i,this.keyValueDiffers=o,this.options={},this.optionsTemplate={align:"right",allowNegative:!0,decimal:".",precision:2,prefix:"$ ",suffix:"",thousands:","},t&&(this.optionsTemplate=t),this.keyValueDiffer=o.find({}).create()}ngAfterViewInit(){this.elementRef.nativeElement.style.textAlign=this.options.align?this.options.align:this.optionsTemplate.align}ngDoCheck(){this.keyValueDiffer.diff(this.options)&&(this.elementRef.nativeElement.style.textAlign=this.options.align?this.options.align:this.optionsTemplate.align,this.inputHandler.updateOptions(Object.assign({},this.optionsTemplate,this.options)))}ngOnInit(){this.inputHandler=new li(this.elementRef.nativeElement,Object.assign({},this.optionsTemplate,this.options))}handleBlur(t){this.inputHandler.getOnModelTouched().apply(t)}handleClick(t){this.inputHandler.handleClick(t,this.isChromeAndroid())}handleCut(t){this.isChromeAndroid()||this.inputHandler.handleCut(t)}handleInput(t){this.isChromeAndroid()&&this.inputHandler.handleInput(t)}handleKeydown(t){this.isChromeAndroid()||this.inputHandler.handleKeydown(t)}handleKeypress(t){this.isChromeAndroid()||this.inputHandler.handleKeypress(t)}handleKeyup(t){this.isChromeAndroid()||this.inputHandler.handleKeyup(t)}handlePaste(t){this.isChromeAndroid()||this.inputHandler.handlePaste(t)}isChromeAndroid(){return/chrome/i.test(navigator.userAgent)&&/android/i.test(navigator.userAgent)}registerOnChange(t){this.inputHandler.setOnModelChange(t)}registerOnTouched(t){this.inputHandler.setOnModelTouched(t)}setDisabledState(t){this.elementRef.nativeElement.disabled=t}validate(t){let i={};return t.value>this.max&&(i.max=!0),t.value<this.min&&(i.min=!0),i!={}?i:null}writeValue(t){this.inputHandler.setValue(t)}}return r.\u0275fac=function(t){return new(t||r)(Ft(uo,8),Ft(fi),Ft(Di))},r.\u0275dir=Ci({type:r,selectors:[["","currencyMask",""]],hostBindings:function(t,i){t&1&&S("blur",function(l){return i.handleBlur(l)})("click",function(l){return i.handleClick(l)})("cut",function(l){return i.handleCut(l)})("input",function(l){return i.handleInput(l)})("keydown",function(l){return i.handleKeydown(l)})("keypress",function(l){return i.handleKeypress(l)})("keyup",function(l){return i.handleKeyup(l)})("paste",function(l){return i.handlePaste(l)})},inputs:{max:"max",min:"min",options:"options"},standalone:!1,features:[$e([po,{provide:Pi,useExisting:r,multi:!0}])]}),r})(),ut=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=vi({type:r}),r.\u0275inj=gi({imports:[[I,wt]]}),r})();var pt=class r{reservationFormService=_(X);reservationForm=P(this.reservationFormService.form$,{initialValue:null});storeStore=_(ae);roomsChangeCounter=E(0);getRoomsFormArray(){let e=this.reservationForm();return e?e.get("rooms"):null}totalNumberOfNights=D(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let o=i.get("stayPeriod");return t+(o?.get("numberOfNights")?.value||0)},0):0});breakdownSubtotal=D(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let o=i.get("pricing");if(o){let l=o.get("totalPrice")?.value||0;return t+l}return t},0):0});breakdownServiceFee=D(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let o=i.get("pricing")?.get("fees");return t+(o?.get("serviceFee")?.value||0)},0):0});breakdownCleaningFee=D(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let o=i.get("pricing")?.get("fees");return t+(o?.get("cleaningFee")?.value||0)},0):0});breakdownResortFee=D(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let o=i.get("pricing")?.get("fees");return t+(o?.get("resortFee")?.value||0)},0):0});breakdownOtherFees=D(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let o=i.get("pricing")?.get("fees");return t+(o?.get("other")?.value||0)},0):0});breakdownTotalFees=D(()=>this.breakdownServiceFee()+this.breakdownCleaningFee()+this.breakdownResortFee()+this.breakdownOtherFees());breakdownTaxes=D(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let o=i.get("pricing");return t+(o?.get("taxes")?.value||0)},0):0});breakdownDiscount=D(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let o=i.get("pricing");return t+(o?.get("discount")?.value||0)},0):0});breakdownGrandTotal=D(()=>this.breakdownSubtotal()+this.breakdownTotalFees()+this.breakdownTaxes()-this.breakdownDiscount());pricingChangeCounter=E(0);paidAmount=D(()=>{this.pricingChangeCounter();let e=this.reservationForm();return e&&e.get("pricing")?.get("paid")?.value||0});breakdownBalance=D(()=>this.breakdownGrandTotal()-this.paidAmount());constructor(){let e=this.getRoomsFormArray();e&&e.valueChanges.subscribe(()=>{this.roomsChangeCounter.update(t=>t+1)}),ht(()=>{let t=this.reservationForm();if(t){let i=t.get("pricing");i&&i.valueChanges.subscribe(()=>{this.pricingChangeCounter.update(o=>o+1)})}},{allowSignalWrites:!0}),ht(()=>{let i=this.reservationForm()?.get("pricing");i&&i.patchValue({subtotal:this.breakdownSubtotal(),taxes:this.breakdownTaxes(),fees:{serviceFee:this.breakdownServiceFee(),cleaningFee:this.breakdownCleaningFee(),resortFee:this.breakdownResortFee(),other:this.breakdownOtherFees()},discounts:this.breakdownDiscount(),total:this.breakdownGrandTotal(),balance:this.breakdownBalance()},{emitEvent:!1})})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=G({type:r,selectors:[["break-down-total"]],decls:78,vars:68,consts:[[1,"mt-6",3,"formGroup"],[1,"text-sm","font-bold","text-gray-800","mb-4","flex","items-center","gap-2"],["formGroupName","pricing"],["matListItemTitle",""],["matListItemMeta","",1,"font-semibold"],["matListItemMeta",""],["matListItemTitle","",1,"font-semibold"],[1,"py-4"]],template:function(t,i){if(t&1&&(a(0,"div",0)(1,"h3",1),s(2," Price Breakdown "),n(),a(3,"mat-list",2)(4,"mat-list-item")(5,"span",3),s(6,"Total Nights"),n(),a(7,"span",4),s(8),n()(),a(9,"mat-list-item")(10,"span",3),s(11,"Base Total (all rooms)"),n(),a(12,"span",5),s(13),T(14,"currency"),n()(),a(15,"mat-list-item")(16,"span",3),s(17,"Service Fee"),n(),a(18,"span",5),s(19),T(20,"currency"),n()(),a(21,"mat-list-item")(22,"span",3),s(23,"Cleaning Fee"),n(),a(24,"span",5),s(25),T(26,"currency"),n()(),a(27,"mat-list-item")(28,"span",3),s(29,"Resort Fee"),n(),a(30,"span",5),s(31),T(32,"currency"),n()(),a(33,"mat-list-item")(34,"span",3),s(35,"Other Fees"),n(),a(36,"span",5),s(37),T(38,"currency"),n()(),v(39,"mat-divider"),a(40,"mat-list-item")(41,"span",6),s(42,"Total Fees"),n(),a(43,"span",4),s(44),T(45,"currency"),n()(),v(46,"mat-divider"),a(47,"mat-list-item")(48,"span",3),s(49,"Taxes"),n(),a(50,"span",5),s(51),T(52,"currency"),n()(),a(53,"mat-list-item")(54,"span",3),s(55,"Discount"),n(),a(56,"span",5),s(57),T(58,"currency"),n()(),v(59,"mat-divider"),a(60,"mat-list-item",7)(61,"span",3),s(62,"Grand Total"),n(),a(63,"span",5),s(64),T(65,"currency"),n()(),a(66,"mat-list-item",7)(67,"span",3),s(68,"Paid"),n(),a(69,"span",5),s(70),T(71,"currency"),n()(),a(72,"mat-list-item",7)(73,"span",3),s(74,"Balance"),n(),a(75,"span",5),s(76),T(77,"currency"),n()()()()),t&2){let o,l,c,d,C,x,y,k,N,le,K;g("formGroup",i.reservationForm()),m(8),b(" ",i.totalNumberOfNights()," night(s) "),m(5),b(" ",te(14,13,i.breakdownSubtotal(),(o=i.storeStore.selectedStore())==null?null:o.currency,"symbol","1.2-2")," "),m(6),b(" ",te(20,18,i.breakdownServiceFee(),(l=i.storeStore.selectedStore())==null?null:l.currency,"symbol","1.2-2")," "),m(6),b(" ",te(26,23,i.breakdownCleaningFee(),(c=i.storeStore.selectedStore())==null?null:c.currency,"symbol","1.2-2")," "),m(6),b(" ",te(32,28,i.breakdownResortFee(),(d=i.storeStore.selectedStore())==null?null:d.currency,"symbol","1.2-2")," "),m(6),b(" ",te(38,33,i.breakdownOtherFees(),(C=i.storeStore.selectedStore())==null?null:C.currency,"symbol","1.2-2")," "),m(7),b(" ",te(45,38,i.breakdownTotalFees(),(x=i.storeStore.selectedStore())==null?null:x.currency,"symbol","1.2-2")," "),m(7),b(" ",te(52,43,i.breakdownTaxes(),(y=i.storeStore.selectedStore())==null?null:y.currency,"symbol","1.2-2")," "),m(6),b(" ",te(58,48,i.breakdownDiscount(),(k=i.storeStore.selectedStore())==null?null:k.currency,"symbol","1.2-2")," "),m(7),b(" ",te(65,53,i.breakdownGrandTotal(),(N=i.storeStore.selectedStore())==null?null:N.currency,"symbol","1.2-2")," "),m(6),b(" ",te(71,58,i.paidAmount(),(le=i.storeStore.selectedStore())==null?null:le.currency,"symbol","1.2-2")," "),m(6),b(" ",te(77,63,i.breakdownBalance(),(K=i.storeStore.selectedStore())==null?null:K.currency,"symbol","1.2-2")," ")}},dependencies:[Fe,Qe,Xe,Vt,Ye,qi,I,L,U,B,Ie,w,ut,Ge],styles:["[_nghost-%COMP%]{display:block}"]})};var Oe=r=>({prefix:r}),ho=(r,e)=>e.value;function fo(r,e){if(r&1&&(a(0,"mat-option",10),s(1),n()),r&2){let t=e.$implicit;g("value",t.value),m(),b(" ",t.label," ")}}function vo(r,e){if(r&1&&(a(0,"mat-hint"),s(1),T(2,"currency"),n()),r&2){let t,i=p();m(),b(" % of subtotal (= ",Be(2,1,(i.subtotal()*i.discount()/100).toFixed(2),(t=i.storeStore.selectedStore())==null?null:t.currency),") ")}}function Co(r,e){r&1&&(a(0,"mat-hint"),s(1," Fixed amount "),n())}var gt=class r{reservationFormService=_(X);reservationForm=P(this.reservationFormService.form$,{initialValue:null});dialogRef=_(qt);data=_(et);storeStore=_(ae);destroy$=new ke;discountTypeOptions=[{value:"percentage",label:"Percentage (%)"},{value:"amount",label:"Fixed Amount"}];pricingForm;stayPeriodForm=null;fees;constructor(){let e=this.reservationForm().get("rooms");this.pricingForm=e.at(this.data.roomIndex).get("pricing"),this.stayPeriodForm=e.at(this.data.roomIndex).get("stayPeriod"),this.fees=this.pricingForm.get("fees")}discountType=E("amount");taxes=E(0);discount=E(0);serviceFee=E(0);cleaningFee=E(0);resortFee=E(0);otherFee=E(0);numberOfNights=E(0);pricePerNight=E(0);subtotal=D(()=>{let e=this.pricePerNight(),t=this.numberOfNights();return e*t});discountAmount=D(()=>this.discountType()==="percentage"?this.subtotal()*this.discount()/100:this.discount());calculatedTotal=D(()=>{let e=this.subtotal(),t=this.discountAmount(),i=this.taxes(),o=this.serviceFee(),l=this.cleaningFee(),c=this.resortFee(),d=this.otherFee(),C=e-t+i+o+l+c+d;return Math.max(0,C)});eff=ht(()=>{let e=this.calculatedTotal(),t=this.subtotal();this.pricingForm.patchValue({subtotal:t,total:e},{emitEvent:!1})});ngOnInit(){this.discountType.set(this.pricingForm?.get("discountType")?.value||"amount"),this.taxes.set(this.pricingForm?.get("taxes")?.value||0),this.discount.set(this.pricingForm?.get("discount")?.value||0),this.pricePerNight.set(this.pricingForm?.get("pricePerNight")?.value||0),this.fees&&(this.serviceFee.set(this.fees.get("serviceFee")?.value||0),this.cleaningFee.set(this.fees.get("cleaningFee")?.value||0),this.resortFee.set(this.fees.get("resortFee")?.value||0),this.otherFee.set(this.fees.get("other")?.value||0)),this.stayPeriodForm&&this.numberOfNights.set(this.stayPeriodForm.get("numberOfNights")?.value||0),this.pricingForm?.get("discountType")?.valueChanges.pipe(ee(this.destroy$)).subscribe(e=>{this.discountType.set(e)}),this.pricingForm?.get("taxes")?.valueChanges.pipe(ee(this.destroy$)).subscribe(e=>{this.taxes.set(e||0)}),this.pricingForm?.get("discount")?.valueChanges.pipe(ee(this.destroy$)).subscribe(e=>{this.discount.set(e||0)}),this.pricingForm?.get("pricePerNight")?.valueChanges.pipe(ee(this.destroy$)).subscribe(e=>{this.pricePerNight.set(e||0)}),this.fees&&(this.fees.get("serviceFee")?.valueChanges.pipe(ee(this.destroy$)).subscribe(e=>{console.log("serviceFee changed:",e),this.serviceFee.set(e||0)}),this.fees.get("cleaningFee")?.valueChanges.pipe(ee(this.destroy$)).subscribe(e=>{this.cleaningFee.set(e||0)}),this.fees.get("resortFee")?.valueChanges.pipe(ee(this.destroy$)).subscribe(e=>{this.resortFee.set(e||0)}),this.fees.get("other")?.valueChanges.pipe(ee(this.destroy$)).subscribe(e=>{this.otherFee.set(e||0)})),this.stayPeriodForm&&this.stayPeriodForm.get("numberOfNights")?.valueChanges.pipe(ee(this.destroy$)).subscribe(e=>{this.numberOfNights.set(e||0)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onCancel(){this.dialogRef.close()}onSave(){this.pricingForm.valid&&this.dialogRef.close(this.pricingForm.value)}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=G({type:r,selectors:[["app-price-edit-dialog"]],decls:96,vars:37,consts:[["mat-dialog-title",""],[1,"space-y-4",3,"formGroup"],[1,"space-y-3"],[1,"text-sm","font-semibold","text-gray-700"],[1,"grid","grid-cols-2","gap-2"],["appearance","outline",1,"w-full"],["matInput","","currencyMask","","formControlName","pricePerNight","readonly","",3,"options"],["matPrefix",""],["matInput","","currencyMask","","formControlName","subtotal","readonly","",3,"options"],["formControlName","discountType"],[3,"value"],["matInput","","type","number","formControlName","discount","placeholder","0"],["matInput","","currencyMask","","formControlName","taxes","placeholder","0.00",3,"options"],["formGroupName","fees",1,"space-y-3"],["matInput","","currencyMask","","formControlName","serviceFee","placeholder","0.00",3,"options"],["matInput","","currencyMask","","formControlName","cleaningFee","placeholder","0.00",3,"options"],["matInput","","currencyMask","","formControlName","resortFee","placeholder","0.00",3,"options"],["matInput","","currencyMask","","formControlName","other","placeholder","0.00",3,"options"],["matInput","","currencyMask","","formControlName","total","readonly","",1,"text-lg","font-bold",3,"options"],["align","end"],["matButton","outlined",3,"click"],["matButton","filled","color","primary",3,"click","disabled"]],template:function(t,i){if(t&1&&(a(0,"h2",0),s(1),n(),a(2,"mat-dialog-content")(3,"form",1)(4,"div",2)(5,"div",3),s(6,"Base Price (Before Discount)"),n(),a(7,"div",4)(8,"mat-form-field",5)(9,"mat-label"),s(10,"Price/Night"),n(),v(11,"input",6),a(12,"mat-icon",7),s(13),n()(),a(14,"mat-form-field",5)(15,"mat-label"),s(16,"Subtotal"),n(),v(17,"input",8),a(18,"mat-icon",7),s(19),n(),a(20,"mat-hint"),s(21),T(22,"currency"),n()()()(),v(23,"mat-divider"),a(24,"div",2)(25,"div",3),s(26,"Discount"),n(),a(27,"div",4)(28,"mat-form-field",5)(29,"mat-label"),s(30,"Discount Type"),n(),a(31,"mat-select",9),j(32,fo,2,2,"mat-option",10,ho),n(),a(34,"mat-icon",7),s(35,"local_offer"),n()(),a(36,"mat-form-field",5)(37,"mat-label"),s(38,"Discount Value"),n(),v(39,"input",11),a(40,"mat-icon",7),s(41,"money_off"),n(),h(42,vo,3,4,"mat-hint"),h(43,Co,2,0,"mat-hint"),n()()(),v(44,"mat-divider"),a(45,"div",2)(46,"div",3),s(47,"Taxes & Fees"),n(),a(48,"mat-form-field",5)(49,"mat-label"),s(50,"Taxes"),n(),v(51,"input",12),a(52,"mat-icon",7),s(53,"receipt"),n()(),a(54,"div",13)(55,"mat-form-field",5)(56,"mat-label"),s(57,"Service Fee"),n(),v(58,"input",14),a(59,"mat-icon",7),s(60,"room_service"),n()(),a(61,"mat-form-field",5)(62,"mat-label"),s(63,"Cleaning Fee"),n(),v(64,"input",15),a(65,"mat-icon",7),s(66,"cleaning_services"),n()(),a(67,"mat-form-field",5)(68,"mat-label"),s(69,"Resort Fee"),n(),v(70,"input",16),a(71,"mat-icon",7),s(72,"villa"),n()(),a(73,"mat-form-field",5)(74,"mat-label"),s(75,"Other Fee"),n(),v(76,"input",17),a(77,"mat-icon",7),s(78,"add_circle_outline"),n()()()(),v(79,"mat-divider"),a(80,"div",2)(81,"div",3),s(82,"Total Price (After Discount)"),n(),a(83,"mat-form-field",5)(84,"mat-label"),s(85,"Total"),n(),v(86,"input",18),a(87,"mat-icon",7),s(88),n(),a(89,"mat-hint"),s(90,"Subtotal - Discount + Taxes + Fees"),n()()()()(),a(91,"mat-dialog-actions",19)(92,"button",20),S("click",function(){return i.onCancel()}),s(93," Cancel "),n(),a(94,"button",21),S("click",function(){return i.onSave()}),s(95," Save Changes "),n()()),t&2){let o,l,c,d,C,x,y,k,N,le,K,me,yt,St;m(),b("Edit Room Pricing (",i.numberOfNights(),") night(s)"),m(2),g("formGroup",i.pricingForm),m(8),g("options",ve(21,Oe,(o=i.storeStore.selectedStore())==null?null:o.currency)),m(2),V((l=i.storeStore.selectedStore())==null?null:l.currency),m(4),g("options",ve(23,Oe,(c=i.storeStore.selectedStore())==null?null:c.currency)),m(2),V((d=i.storeStore.selectedStore())==null?null:d.currency),m(2),Et("",Be(22,18,i.pricePerNight(),(C=i.storeStore.selectedStore())==null?null:C.currency)," \xD7 ",i.numberOfNights()," nights"),m(11),W(i.discountTypeOptions),m(10),f(((x=i.pricingForm.get("discountType"))==null?null:x.value)==="percentage"?42:-1),m(),f(((y=i.pricingForm.get("discountType"))==null?null:y.value)==="amount"?43:-1),m(8),g("options",ve(25,Oe,(k=i.storeStore.selectedStore())==null?null:k.currency)),m(7),g("options",ve(27,Oe,(N=i.storeStore.selectedStore())==null?null:N.currency)),m(6),g("options",ve(29,Oe,(le=i.storeStore.selectedStore())==null?null:le.currency)),m(6),g("options",ve(31,Oe,(K=i.storeStore.selectedStore())==null?null:K.currency)),m(6),g("options",ve(33,Oe,(me=i.storeStore.selectedStore())==null?null:me.currency)),m(10),g("options",ve(35,Oe,(yt=i.storeStore.selectedStore())==null?null:yt.currency)),m(2),V((St=i.storeStore.selectedStore())==null?null:St.currency),m(6),g("disabled",!i.pricingForm.valid)}},dependencies:[I,L,Te,ne,It,Z,U,B,oe,Ie,q,ie,H,$,Y,J,be,ze,w,he,A,Q,re,Ee,ce,Je,Vt,ot,tt,nt,it,ut,_t,Ge],styles:["[_nghost-%COMP%]{display:block}.space-y-3[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:.75rem}.space-y-4[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:1rem}.grid[_ngcontent-%COMP%]{display:grid}.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3[_ngcontent-%COMP%]{grid-template-columns:repeat(3,minmax(0,1fr))}.gap-2[_ngcontent-%COMP%]{gap:.5rem}.w-full[_ngcontent-%COMP%]{width:100%}.text-sm[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.font-semibold[_ngcontent-%COMP%]{font-weight:600}.text-gray-700[_ngcontent-%COMP%]{color:#374151}.text-lg[_ngcontent-%COMP%]{font-size:1.125rem;line-height:1.75rem}.font-bold[_ngcontent-%COMP%]{font-weight:700}mat-form-field.ng-invalid.ng-touched[_ngcontent-%COMP%]     .mat-mdc-form-field-error{display:block}"]})};function yo(r,e){if(r&1&&(a(0,"pre"),s(1),T(2,"currency"),n()),r&2){let t,i=p();m(),yi("Selected Room: ",i.roomsResource.value().name," (",i.roomsResource.value().roomNumber,") - ",Be(2,3,i.roomsResource.value().priceOverride,(t=i.storeStore.selectedStore())==null?null:t.currency)," ")}}function So(r,e){r&1&&(a(0,"div",9),v(1,"mat-spinner",11),n())}function bo(r,e){if(r&1){let t=R();a(0,"div",12)(1,"div",14)(2,"span",15),s(3),n(),a(4,"div",16)(5,"mat-icon",17),s(6,"person"),n(),a(7,"div",18)(8,"span",19),s(9),n(),a(10,"span",20),s(11),n()()(),a(12,"mat-form-field",21)(13,"mat-label"),s(14,"Check-in to Check-out"),n(),a(15,"mat-date-range-input",22),v(16,"input",23)(17,"input",24),n(),v(18,"mat-datepicker-toggle",25)(19,"mat-date-range-picker",null,0),a(21,"mat-hint"),s(22),n()(),a(23,"div",26)(24,"a",27),S("click",function(){let o,l=F(t),c=l.$implicit,d=l.$index,C=p(2);return M(C.editSharer(d,(o=c.get("ageGrade"))==null?null:o.value))}),a(25,"mat-icon",5),s(26,"edit"),n()(),a(27,"a",28),S("click",function(){let o=F(t).$index,l=p(2);return M(l.deleteSharer(o))}),a(28,"mat-icon",5),s(29,"delete"),n()()()()()}if(r&2){let t,i,o,l,c,d=e.$implicit,C=e.$index,x=fe(20),y=p(2);g("formGroup",y.asFormGroup(d)),m(3),b(" P",C+1," "),m(6),b(" ",y.getSharerName(d)||"Unassigned Guest"," "),m(2),b(" ",((t=d.get("ageGrade"))==null?null:t.value)||"Adult"," "),m(4),g("rangePicker",x)("min",y.getReservationMinDate())("max",y.getReservationMaxDate()),m(3),g("for",x),m(4),b("",y.calculateNights((i=d.get("checkInDate"))==null?null:i.value,(i=d.get("checkOutDate"))==null?null:i.value)," night(s)"),m(2),g("matTooltip",Fi(!y.hasPrimaryGuest()&&((o=d.get("ageGrade"))==null?null:o.value)==="child"?"Assign primary guest first":"Edit Guest"))("disabled",!y.hasPrimaryGuest()&&((l=d.get("ageGrade"))==null?null:l.value)==="child")("ngClass",!y.hasPrimaryGuest()&&((c=d.get("ageGrade"))==null?null:c.value)==="child"?"text-gray-300":"text-blue-600 hover:bg-blue-50"),m(3),g("disabled",C===0)("ngClass",C===0?"text-gray-300 cursor-not-allowed":"text-red-600 hover:bg-red-50")}}function xo(r,e){r&1&&(a(0,"div",13)(1,"mat-icon",29),s(2,"group_off"),n(),a(3,"p",30),s(4,"No guests added yet"),n()())}function Fo(r,e){r&1&&v(0,"break-down-total")}function Mo(r,e){r&1&&(a(0,"div",13)(1,"mat-icon",29),s(2,"meeting_room"),n(),a(3,"p",30),s(4,"No rooms assigned yet"),n()())}function Eo(r,e){if(r&1&&(a(0,"div",10),j(1,bo,30,15,"div",12,Mt,!1,xo,5,0,"div",13),h(4,Fo,1,0,"break-down-total")(5,Mo,5,0,"div",13),n()),r&2){let t=p();m(),W(t.getSharersFormArray().controls),m(3),f(t.roomsResource.hasValue()?4:5)}}var Zt=class r{fb=_(Se);storeStore=_(ae);route=_(Nt);guestService=_(De);id=E(this.route.snapshot.paramMap.get("id"));isEditing=D(()=>!!this.id());reservationFormService=_(X);reservationForm=P(this.reservationFormService.form$,{initialValue:null});checkInDate=P(this.reservationForm().get("checkInDate").valueChanges,{initialValue:this.reservationForm().get("checkInDate").value});checkOutDate=P(this.reservationForm().get("checkOutDate").valueChanges,{initialValue:this.reservationForm().get("checkOutDate").value});numberOfAdults=P(this.reservationForm().get("numberOfAdults").valueChanges,{initialValue:this.reservationForm().get("numberOfAdults").value});numberOfChildren=P(this.reservationForm().get("numberOfChildren").valueChanges,{initialValue:this.reservationForm().get("numberOfChildren").value});quickReservation=O(null);selectedGuest=Mi(null);reservation=O(null);sharerAdded=z();sharerEdited=z();sharerDeleted=z();sharersArrayUpdated=z();reservationMinDate=E(null);reservationMaxDate=E(null);dialog=_(Ae);roomService=_(mt);roomsResource=Ne({params:()=>({roomId:this.isEditing()?this.reservation().rooms[0]?.room._id:this.quickReservation()?.selectedRoom,isEditing:this.isEditing()}),stream:({params:e})=>this.getRoom(e.roomId).pipe(He(t=>{e.isEditing?this.populateSharersFromReservation(this.reservation()):this.buildSharesOnNewReservation(),this.buildARoomForTheSharers(t)}))});populateSharersFromReservation(e){if(!e){console.log("[RoomSharers] No reservation provided, skipping population");return}console.log("[RoomSharers] populateSharersFromReservation called with reservation:",e);let t=this.getSharersFormArray();if(!t){console.warn("[RoomSharers] getSharersFormArray() returned null");return}t.clear(),console.log("[RoomSharers] Sharers array cleared"),e.sharers&&e.sharers.length>0?(console.log("[RoomSharers] Populating sharers from reservation.sharers:",e.sharers),e.sharers.forEach((i,o)=>{console.log(`[RoomSharers] Processing sharer ${o}:`,i);let l=this.fb.group({guest:[i.guest._id||i.guest,[u.required]],meta:[i.guest,[]],guestType:[i.guestType||"adult",[u.required]],checkInDate:[new Date(i.checkInDate),[u.required]],checkOutDate:[new Date(i.checkOutDate),[u.required]],ageGrade:[i.ageGrade||"",[]]});t.push(l),console.log(`[RoomSharers] Sharer ${o} added to form array. Current array length:`,t.length)})):console.warn("[RoomSharers] No sharers found in reservation"),console.log("[RoomSharers] populateSharersFromReservation completed. Final array length:",t.length)}buildSharesOnNewReservation(){let e=this.getSharersFormArray();if(e){let t=e.length,i=this.numberOfAdults()+this.numberOfChildren();if(t!==i){e.clear();for(let o=0;o<this.numberOfAdults();o++){let l=o===0&&this.selectedGuest()?this.selectedGuest()?._id:null;e.push(this.fb.group({guest:[l,[u.required]],guestType:["individual"],ageGrade:["adult"],checkInDate:[this.checkInDate()],checkOutDate:[this.checkOutDate()],meta:[null]}))}for(let o=0;o<this.numberOfChildren();o++)e.push(this.fb.group({guest:[null,[u.required]],meta:[null],guestType:["individual"],ageGrade:["child"],checkInDate:[this.checkInDate()],checkOutDate:[this.checkOutDate()]}));this.sharersArrayUpdated.emit(e)}}}buildARoomForTheSharers(e){let t=this.getRoomsFormArray();if(console.log(t,e),t&&e){let i=this.createRoomFormGroup(e);t.clear(),t.push(i)}}createRoomFormGroup(e,t){let i=t?.pricing?.pricePerNight||0;i||(e.priceOverride?i=e.priceOverride:typeof e.roomType=="object"&&e.roomType?.basePrice&&(i=e.roomType.basePrice));let o=i*this.numberOfNights();return this.fb.group({room:[t?.room||e._id||"",[u.required]],roomNumber:[t?.roomNumber||e.roomNumber||""],assignedGuest:[t?.assignedGuest||this.reservation()?.guest._id||""],assignedGuestName:[t?.assignedGuestName||this.guestService.getGuestName(this.reservation()?.guest)||""],roomType:[t?.roomType||(typeof e.roomType=="string"?e.roomType:e.roomType?._id)||"",[u.required]],stayPeriod:this.fb.group({from:[this.checkInDate(),[u.required]],to:[this.checkOutDate(),[u.required]],numberOfNights:[t?.stayPeriod?.numberOfNights||this.numberOfNights(),[u.required,u.min(1)]]}),guests:this.fb.group({adults:[t?.guests?.adults||1,[u.required,u.min(1)]],children:[t?.guests?.children||0,[u.required,u.min(0)]]}),pricing:this.fb.group({pricePerNight:[t?.pricing?.pricePerNight||i,[u.required,u.min(0)]],totalPrice:[t?.pricing?.totalPrice||o,[u.required,u.min(0)]],discount:[t?.pricing?.discount||0,[u.min(0)]],subtotal:[t?.pricing?.subtotal||o,[u.min(0)]],taxes:[t?.pricing?.taxes||0,[u.min(0)]],discountType:[t?.pricing?.discountType||"amount"],fees:this.fb.group({serviceFee:[t?.pricing?.fees?.serviceFee||0,[u.min(0)]],cleaningFee:[t?.pricing?.fees?.cleaningFee||0,[u.min(0)]],resortFee:[t?.pricing?.fees?.resortFee||0,[u.min(0)]],other:[t?.pricing?.fees?.other||0,[u.min(0)]]}),total:[t?.pricing?.total||o,[u.min(0)]]}),notes:[t?.notes||""]})}ngAfterViewInit(){this.reservationMinDate.set(this.checkInDate()),this.reservationMaxDate.set(this.checkOutDate());let e=this.reservationForm().get("rooms"),t=this.reservationForm().get("sharers"),i=this.reservationForm()?.get("checkInDate")?.valueChanges.subscribe(l=>{this.reservationMinDate.set(l);for(let d=0;d<e.length;d++)e.at(d)?.patchValue({stayPeriod:{from:l}},{emitEvent:!1});let c=this.reservationForm().get("sharers");if(c)for(let d=0;d<c.length;d++)c.at(d)?.patchValue({checkInDate:l},{emitEvent:!1})}),o=this.reservationForm()?.get("checkOutDate")?.valueChanges.subscribe(l=>{this.reservationMaxDate.set(l);let c=this.reservationForm()?.get("checkInDate")?.value,d=Math.abs(l.getTime()-c.getTime()),C=Math.ceil(d/(1e3*60*60*24));for(let y=0;y<e.length;y++){let k=e.at(y),K=(k?.get("pricing")?.get("pricePerNight")?.value||0)*C;k?.patchValue({stayPeriod:{to:l,numberOfNights:C},pricing:{totalPrice:K,subtotal:K,total:K}},{emitEvent:!0})}let x=this.reservationForm().get("sharers");if(x)for(let y=0;y<x.length;y++)x.at(y)?.patchValue({checkOutDate:l},{emitEvent:!1})});e?.valueChanges.pipe(Ue((l,c)=>JSON.stringify(l)===JSON.stringify(c))).subscribe(()=>{for(let l=0;l<e.length;l++){let c=e.at(l),d=c?.get("pricing"),C=c?.get("stayPeriod"),x=d?.get("pricePerNight")?.value||0,y=C?.get("numberOfNights")?.value||0,k=x*y;c?.patchValue({pricing:{totalPrice:k,subtotal:k,total:k}},{emitEvent:!0})}})}numberOfNights=D(()=>{let e=this.checkInDate(),t=this.checkOutDate();if(e&&t){let i=Math.abs(t.getTime()-e.getTime());return Math.ceil(i/(1e3*60*60*24))}return 0});getRoomsFormArray(){let e=this.reservationForm();return e?e.get("rooms"):new ft([])}getRoom(e){return this.roomService.getRoom(e)}hasPrimaryGuest=D(()=>{let e=this.selectedGuest();if(!e)return!1;let t=e?._id;return t!=null&&t!==""});getSharersFormArray(){let e=this.reservationForm();return e?e.get("sharers"):new ft([])}getPrimaryGuest(){let e=this.getSharersFormArray();return e.length>0?e.at(0):null}getOtherSharers(){let e=this.getSharersFormArray();return e.length>1?Array.from({length:e.length-1},(t,i)=>e.at(i+1)):[]}addSharer(e,t){let i=this.getSharersFormArray(),o=this.getPrimaryGuest();o?.value?.guest?i.push(this.fb.group({guest:[e?._id],meta:e,guestType:["individual"],ageGrade:t,checkInDate:[this.reservationMinDate()],checkOutDate:[this.reservationMaxDate()]})):(o?.patchValue({guest:e?._id,meta:e,guestType:"individual",ageGrade:t,checkInDate:this.reservationMinDate(),checkOutDate:this.reservationMaxDate()}),this.selectedGuest.set(e))}onCreateGuest(){this.dialog.open(_e,{width:"600px",disableClose:!1,data:{bookingType:"single",ageGrade:"adult"}}).afterClosed().subscribe(t=>{t&&this.addSharer(t,"adult")})}editSharer(e,t){let i=this.getSharersFormArray();if(!i.at(e))return;let l=this.getPrimaryGuest(),c=l&&l.value.guest;e!==0&&!c&&(e=0),this.dialog.open(_e,{width:"600px",disableClose:!1,data:{bookingType:"single",guest:i.at(e)?.value.meta||null,ageGrade:t}}).afterClosed().subscribe(C=>{C&&(this.updateSharerWithGuest(e,C),this.sharerEdited.emit({index:e,sharer:C}))})}deleteSharer(e){let t=this.getSharersFormArray();e!==0&&(t.removeAt(e),this.sharerDeleted.emit({index:e}))}updateSharerWithGuest(e,t){}getSharerName(e){let t=e.get("meta")?.value?.firstName,i=e.get("meta")?.value?.lastName;return t||i?`${t||""} ${i||""}`.trim():"Unassigned Guest"}asFormGroup(e){return e}getSharerTypeBadge(e){return this.getSharersFormArray().controls.indexOf(e)===0?"Primary Guest":e.get("type")?.value==="adult"?"Adult":"Child"}getReservationMinDate(){return this.reservationMinDate()}getReservationMaxDate(){return this.reservationMaxDate()}calculateNights(e,t){if(!e||!t)return 0;let i=new Date(e).getTime(),o=new Date(t).getTime(),l=Math.ceil((o-i)/(1e3*60*60*24));return l>0?l:0}onSharerHome(e){}onGuestCheckIn(){this.sharerAdded.emit({action:"check_in"})}onGenerateGuestService(){this.sharerAdded.emit({action:"generate_service"})}onAddInfants(){this.dialog.open(_e,{width:"600px",disableClose:!1,data:{bookingType:"single",ageGrade:"child"}}).afterClosed().subscribe(t=>{t&&this.addSharer(t,"child")}),this.sharerAdded.emit({action:"add_infants"})}onEditRoomPricing(){let e=this.getRoomsFormArray();if(!e||e.length===0)return;this.dialog.open(gt,{width:"800px",disableClose:!1,data:{roomIndex:0}}).afterClosed().subscribe(i=>{if(i){let l=e.at(0)?.get("pricing");l&&l.patchValue(i,{emitEvent:!0})}})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=G({type:r,selectors:[["app-room-sharers"]],inputs:{quickReservation:[1,"quickReservation"],selectedGuest:[1,"selectedGuest"],reservation:[1,"reservation"]},outputs:{selectedGuest:"selectedGuestChange",sharerAdded:"sharerAdded",sharerEdited:"sharerEdited",sharerDeleted:"sharerDeleted",sharersArrayUpdated:"sharersArrayUpdated"},decls:24,vars:7,consts:[["picker",""],["appearance","outlined",3,"formGroup"],[1,"flex","justify-between","items-center","w-full"],[1,"flex","gap-2"],["matButton","","color","accent",3,"click","disabled"],[1,"material-icons-outlined"],["matButton","tonal","color","secondary",3,"click","disabled","matTooltip"],["matButton","filled","color","primary",3,"click","disabled"],["formArrayName","sharers"],[1,"flex","justify-center","py-12"],[1,"py-4","space-y-3"],["diameter","40"],[1,"border","border-gray-200","rounded-lg",3,"formGroup"],[1,"text-center","py-8","text-gray-500"],[1,"flex","items-center","gap-3","p-4"],[1,"px-3","py-1","bg-orange-100","text-orange-700","rounded-full","text-xs","font-bold","min-w-fit"],[1,"flex","items-center","gap-2","min-w-[180px]"],[1,"text-gray-400"],[1,"flex","flex-col"],[1,"font-medium","text-gray-900","truncate"],[1,"text-xs","text-gray-500","uppercase"],["appearance","outline",1,"min-w-[220px]","w-[220px]"],[3,"rangePicker","min","max"],["matStartDate","","formControlName","checkInDate","placeholder","Start date"],["matEndDate","","formControlName","checkOutDate","placeholder","End date"],["matSuffix","",3,"for"],[1,"flex","items-center","gap-1","ml-auto"],["mat-icon-button","",3,"click","matTooltip","disabled","ngClass"],["mat-icon-button","","matTooltip","Delete Guest",3,"click","disabled","ngClass"],[1,"text-4xl","text-gray-300","mb-2"],[1,"text-sm"]],template:function(t,i){t&1&&(a(0,"mat-card",1)(1,"mat-card-header")(2,"div",2)(3,"div")(4,"mat-card-title"),s(5," Room Sharers "),n(),a(6,"mat-card-subtitle"),h(7,yo,3,6,"pre"),n()(),a(8,"div",3)(9,"a",4),S("click",function(){return i.onEditRoomPricing()}),a(10,"mat-icon",5),s(11,"edit"),n(),s(12," Edit Pricing "),n(),a(13,"a",6),S("click",function(){return i.onAddInfants()}),a(14,"mat-icon",5),s(15,"child_care"),n(),s(16," Add Infant "),n(),a(17,"a",7),S("click",function(){return i.onCreateGuest()}),a(18,"mat-icon",5),s(19,"person_add"),n(),s(20," ADD ROOM SHARER "),n()()()(),a(21,"mat-card-content",8),h(22,So,2,0,"div",9)(23,Eo,6,2,"div",10),n()()),t&2&&(g("formGroup",i.reservationForm()),m(7),f(i.roomsResource.hasValue()?7:-1),m(2),g("disabled",i.roomsResource.isLoading()),m(4),g("disabled",!i.hasPrimaryGuest()||i.roomsResource.isLoading())("matTooltip",i.hasPrimaryGuest()?"":"Please assign a primary guest first"),m(4),g("disabled",i.roomsResource.isLoading()),m(5),f(i.roomsResource.isLoading()?22:23))},dependencies:[I,Ri,L,ne,Z,U,B,oe,Pt,H,de,pe,ge,At,ue,$,Y,J,be,Pe,w,q,ie,Rt,A,Q,re,Je,Fe,Ut,we,Lt,Me,Ve,at,rt,st,lt,Ke,ji,pt,xe,Ze,Ge],encapsulation:2})};var an=()=>[],Do=r=>({prefix:r}),No=(r,e)=>e._id||e.id,Ro=(r,e)=>e._id;function ko(r,e){r&1&&(a(0,"div",6),v(1,"mat-spinner",8),n())}function Go(r,e){if(r&1&&(a(0,"mat-option",15),s(1),n()),r&2){let t=e.$implicit;g("value",t._id||t.id),m(),b(" ",t.name," ")}}function To(r,e){if(r&1&&(a(0,"mat-option",15),s(1),n()),r&2){let t=e.$implicit;g("value",t._id),m(),b(" ",t.roomNumber," ")}}function Io(r,e){r&1&&(a(0,"mat-error"),s(1,"Check-in date is required"),n())}function Po(r,e){r&1&&(a(0,"mat-error"),s(1,"Check-out date is required"),n())}function wo(r,e){if(r&1){let t=R();a(0,"div",11)(1,"div")(2,"mat-form-field",13)(3,"mat-label"),s(4,"Room Type"),n(),a(5,"mat-select",14),S("selectionChange",function(o){let l=F(t).$index,c=p(2);return M(c.onRoomTypeChange(l,o.value))}),j(6,Go,2,2,"mat-option",15,No),n()()(),a(8,"div")(9,"mat-form-field",13)(10,"mat-label"),s(11,"Room"),n(),a(12,"mat-select",16),S("selectionChange",function(o){let l=F(t).$index,c=p(2);return M(c.onRoomChange(l,o.value))}),a(13,"mat-option",17),s(14,"-- Select Room --"),n(),j(15,To,2,2,"mat-option",15,Ro),n()()(),a(17,"div")(18,"mat-form-field",13)(19,"mat-label"),s(20,"Assigned Guest"),n(),v(21,"input",18),a(22,"button",19),S("click",function(){let o=F(t).$index,l=p(2);return M(l.onAddOrChangeGuest(o))}),a(23,"mat-icon",20),s(24,"person_add"),n()()()(),a(25,"div",21)(26,"mat-form-field",22)(27,"mat-label"),s(28,"Adults"),n(),v(29,"input",23),a(30,"mat-icon",24),s(31,"person"),n()(),a(32,"mat-form-field",22)(33,"mat-label"),s(34,"Children"),n(),v(35,"input",25),a(36,"mat-icon",24),s(37,"child_care"),n()()(),a(38,"div",26)(39,"mat-form-field",13)(40,"mat-label"),s(41,"Stay Period"),n(),a(42,"mat-date-range-input",27)(43,"input",28),S("dateChange",function(){let o=F(t).$index,l=p(2);return M(l.onStayPeriodChange(o))}),n(),a(44,"input",29),S("dateChange",function(){let o=F(t).$index,l=p(2);return M(l.onStayPeriodChange(o))}),n()(),v(45,"mat-datepicker-toggle",30)(46,"mat-date-range-picker",null,0),a(48,"mat-hint"),s(49),n(),h(50,Io,2,0,"mat-error"),h(51,Po,2,0,"mat-error"),n()(),a(52,"div",31)(53,"mat-form-field",13)(54,"mat-label"),s(55,"Price"),n(),v(56,"input",32),a(57,"span",33),s(58),n(),a(59,"button",34),S("click",function(){let o=F(t).$index,l=p(2);return M(l.onEditPrice(o))}),a(60,"mat-icon",20),s(61,"edit"),n()(),a(62,"mat-hint"),s(63),T(64,"currency"),n()()(),a(65,"div",35)(66,"button",36),S("click",function(){let o=F(t).$index,l=p(2);return M(l.removeRoom(o))}),a(67,"mat-icon",20),s(68,"delete"),n()()()()}if(r&2){let t,i,o,l,c,d,C,x,y=e.$index,k=fe(47),N=p(2);g("formGroupName",y),m(6),W(N.roomTypes.value()||ni(17,an)),m(9),W(N.filterRoomsByType((t=N.getRoomsFormArray())==null||(t=t.at(y))==null||(t=t.get("roomType"))==null?null:t.value,y)),m(6),g("value",((i=N.getRoomsFormArray())==null||(i=i.at(y))==null||(i=i.get("assignedGuestName"))==null?null:i.value)||"Select a guest"),m(21),g("rangePicker",k)("min",N.getMinDate())("max",N.getMaxDate()),m(3),g("for",k),m(4),b(" ",((o=N.getRoomsFormArray())==null||(o=o.at(y))==null||(o=o.get("stayPeriod"))==null||(o=o.get("numberOfNights"))==null?null:o.value)||0," night(s) "),m(),f(!((l=N.getRoomsFormArray())==null||(l=l.at(y))==null||(l=l.get("stayPeriod"))==null||(l=l.get("from"))==null)&&l.hasError("required")?50:-1),m(),f(!((c=N.getRoomsFormArray())==null||(c=c.at(y))==null||(c=c.get("stayPeriod"))==null||(c=c.get("to"))==null)&&c.hasError("required")?51:-1),m(5),g("options",ve(18,Do,(d=N.storeStore.selectedStore())==null?null:d.currency)),m(2),b(" ",(C=N.storeStore.selectedStore())==null?null:C.currency),m(5),b(" Total: ",te(64,12,N.price(y),(x=N.storeStore.selectedStore())==null?null:x.currency,"symbol","1.2-2")," ")}}function Ao(r,e){r&1&&(a(0,"div",12)(1,"mat-icon",37),s(2,"meeting_room"),n(),a(3,"p",20),s(4,"No rooms selected"),n()())}function Vo(r,e){if(r&1&&(a(0,"div",7)(1,"div",9)(2,"div",10),j(3,wo,69,20,"div",11,Mt,!1,Ao,5,0,"div",12),n()(),v(6,"break-down-total"),n()),r&2){let t,i=p();g("formGroup",i.reservationForm()),m(3),W(((t=i.getRoomsFormArray())==null?null:t.controls)||ni(2,an))}}var Jt=class r{roomsService=_(mt);guestService=_(De);storeStore=_(ae);fb=_(Se);snackBar=_(je);dialog=_(Ae);reservationFormService=_(X);reservationForm=P(this.reservationFormService.form$,{initialValue:null});selectedRoomIds=O([]);reservation=O(null);roomAssigned=z();assigningRoomId=E(null);filteredRooms=E([]);assignedGuests=E(new Map);roomTypes=Ne({params:()=>({id:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.roomsService.getRoomTypes(e.id)});selectedRooms=Ne({params:()=>({roomIds:this.selectedRoomIds()}),stream:({params:e})=>this.roomsService.getRoomsByIds(e.roomIds).pipe(He(t=>{this.populateRoomsFormArray2(t)}))});rooms=Ne({params:()=>({store:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.roomsService.getRooms(e.store)});isRoomsReadyForAssignment=D(()=>this.selectedRoomIds()?this.selectedRooms.hasValue()&&this.rooms.hasValue()&&this.roomTypes.hasValue():this.rooms.hasValue()&&this.roomTypes.hasValue());totalRooms=D(()=>this.rooms.hasValue()?this.rooms.value().length:0);totalCapacity=D(()=>this.rooms.value()?.reduce((e,t)=>{let i=t.capacity;return typeof i=="object"&&i!==null?e+(i.adults||0)+(i.children||0):e+(i||0)},0));isEditingRooms=D(()=>{let e=this.getRoomsFormArray();return e&&e.length>0});price(e){return this.getRoomsFormArray().at(e).get("pricing").get("total")?.value}onCreateRoom(){let e=this.createRoomFormGroup({}),t=this.getRoomsFormArray();if(t){let i=t.length;t.push(e);let o=e.get("stayPeriod");o&&o.valueChanges.subscribe(()=>{this.onStayPeriodChange(i)})}}populateRoomsFormArray(e){}populateRoomsFormArray2(e){console.log("[RoomDetails] populateRoomsFormArray2 called with rooms:",e);let t=this.getRoomsFormArray();if(!t)return;t.clear();let i=this.reservation(),o=!!i;(o?i.rooms:e).forEach((c,d)=>{let C;if(o){let x="",y="";c.assignedGuest&&(typeof c.assignedGuest=="object"&&c.assignedGuest._id?(x=c.assignedGuest._id,y=this.guestService.getGuestName(c.assignedGuest)):typeof c.assignedGuest=="string"&&(x=c.assignedGuest)),C=this.fb.group({room:[c.room._id||c.room,[u.required]],roomNumber:[c.room?.roomNumber||"",[]],roomType:[c?.roomType||c?.room?.roomType?._id,[]],assignedGuest:[x,[u.required]],status:[c.status||"reserved",[u.required]],assignedGuestName:[y,[u.required]],stayPeriod:this.fb.group({from:[new Date(c.stayPeriod?.from||i.checkInDate),[u.required]],to:[new Date(c.stayPeriod?.to||i.checkOutDate),[u.required]],numberOfNights:[c.stayPeriod?.numberOfNights||1,[u.required,u.min(1)]]}),guests:this.fb.group({adults:[c.guests?.adults||1,[u.required,u.min(1)]],children:[c.guests?.children||0,[u.required,u.min(0)]]}),pricing:this.fb.group({pricePerNight:[c?.pricing?.pricePerNight||c?.room?.priceOverride||0,[u.required,u.min(0)]],totalPrice:[c.pricing?.totalPrice||0,[u.required,u.min(0)]],discount:[c.pricing?.discount||0,[u.min(0)]],discountType:[c.pricing?.discountType||"percentage",[]],subtotal:[c.pricing?.subtotal||0,[u.min(0)]],taxes:[c.pricing?.taxes||0,[u.min(0)]],fees:this.fb.group({serviceFee:[c.pricing?.fees?.serviceFee||0,[u.min(0)]],cleaningFee:[c.pricing?.fees?.cleaningFee||0,[u.min(0)]],resortFee:[c.pricing?.fees?.resortFee||0,[u.min(0)]],other:[c.pricing?.fees?.other||0,[u.min(0)]]}),total:[c.pricing?.total||0,[u.min(0)]]}),notes:[c.notes||"",[]]})}else console.log("[RoomDetails] NEW mode - using createRoomFormGroup for room:",c._id),C=this.createRoomFormGroup(c);t.push(C),console.log(`[RoomDetails] Room ${d} added to form array. Current array length:`,t.length)}),console.log("[RoomDetails] populateRoomsFormArray2 completed. Final array length:",t.length),this.reservationForm()?.patchValue({rooms:t},{emitEvent:!1})}createRoomFormGroup(e,t){let i=t?.pricing?.pricePerNight;i||(e.priceOverride?i=e.priceOverride:typeof e.roomType=="object"&&e.roomType?.basePrice&&(i=e.roomType.basePrice));let o=this.reservationForm(),l=t?.stayPeriod?.from||o?.get("checkInDate")?.value||new Date,c=t?.stayPeriod?.to||o?.get("checkOutDate")?.value||new Date,d=this.calculateNumberOfNights(l,c),C=i*d;return this.fb.group({room:[t?.room||e._id||"",[u.required]],roomNumber:[t?.roomNumber||e.roomNumber||""],assignedGuest:[t?.assignedGuest||""],assignedGuestName:[t?.assignedGuestName||""],roomType:[t?.roomType||(typeof e.roomType=="string"?e.roomType:e.roomType?._id)||"",[u.required]],stayPeriod:this.fb.group({from:[l,[u.required]],to:[c,[u.required]],numberOfNights:[t?.stayPeriod?.numberOfNights||d,[u.required,u.min(1)]]}),guests:this.fb.group({adults:[t?.guests?.adults||1,[u.required,u.min(1)]],children:[t?.guests?.children||0,[u.required,u.min(0)]]}),pricing:this.fb.group({pricePerNight:[t?.pricing?.pricePerNight||i,[u.required,u.min(0)]],totalPrice:[t?.pricing?.totalPrice||C,[u.required,u.min(0)]],discount:[t?.pricing?.discount||0,[u.min(0)]],subtotal:[t?.pricing?.subtotal||C,[u.min(0)]],taxes:[t?.pricing?.taxes||0,[u.min(0)]],discountType:[t?.pricing?.discountType||"amount"],fees:this.fb.group({serviceFee:[t?.pricing?.fees?.serviceFee||0,[u.min(0)]],cleaningFee:[t?.pricing?.fees?.cleaningFee||0,[u.min(0)]],resortFee:[t?.pricing?.fees?.resortFee||0,[u.min(0)]],other:[t?.pricing?.fees?.other||0,[u.min(0)]]}),total:[t?.pricing?.total||C,[u.min(0)]]}),notes:[t?.notes||""]})}assignRoom(e){this.assigningRoomId.set(e._id||null);let t=this.createRoomFormGroup(e),i=this.getRoomsFormArray();if(i){let o=i.length;i.push(t);let l=t.get("stayPeriod");l&&l.valueChanges.subscribe(()=>{this.onStayPeriodChange(o)}),this.roomAssigned.emit({room:e,formGroup:t,index:o})}}removeRoom(e){let t=this.getRoomsFormArray();t&&t.removeAt(e)}filterRoomsByType(e,t){return e?this.rooms.value().filter(i=>(typeof i.roomType=="string"?i.roomType:i.roomType?._id)===e):this.rooms.value()||[]}onRoomTypeChange(e,t){let i=this.getRoomsFormArray();if(!i)return;i.at(e)?.get("room")?.reset()}getRoomsFormArray(){let e=this.reservationForm();if(e){let t=e.controls.rooms;return console.log("[RoomDetails] getRoomsFormArray called, array length:",t?.length),t}return console.warn("[RoomDetails] getRoomsFormArray: form is null"),null}onAddOrChangeGuest(e){this.dialog.open(_e,{width:"600px",disableClose:!1,data:{bookingType:"single",ageGrade:"adult"}}).afterClosed().subscribe(i=>{if(i){let o=this.assignedGuests();o.set(i._id,i),this.assignedGuests.set(o);let l=this.getRoomsFormArray();l&&l.at(e).patchValue({assignedGuest:i._id,assignedGuestName:this.getGuestDisplayName(i)})}})}getGuestDisplayName(e){return e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:e.firstName?e.firstName:e.companyName?e.companyName:"Unknown Guest"}getGuestNameById(e){if(!e)return"";let t=this.assignedGuests().get(e);return t?this.getGuestDisplayName(t):e}onEditPrice(e){let t=this.getRoomsFormArray();if(!t)return;let i=t.at(e),o=i?.get("pricing"),l=i?.get("stayPeriod");if(!o||!l)return;this.dialog.open(gt,{width:"500px",disableClose:!1,data:{roomIndex:e}}).afterClosed().subscribe(d=>{d&&d.success&&this.snackBar.open("Price updated successfully","Close",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["success-snackbar"]})})}isRoomAlreadySelected(e,t){let i=this.getRoomsFormArray();return i?i.controls.some((o,l)=>l===t?!1:o.get("room")?.value===e):!1}isRoomAvailable(e,t){return!this.isRoomAlreadySelected(e,t)}getSelectedRoomIds(e){let t=this.getRoomsFormArray();return t?t.controls.map((i,o)=>o===e?null:i.get("room")?.value).filter(i=>i!==null&&i!==""):[]}onRoomChange(e,t){if(this.isRoomAlreadySelected(t,e)){this.getRoomsFormArray()?.at(e)?.get("room")?.reset(),this.snackBar.open("This room is already selected in another row","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["error-snackbar"]});return}let i=this.rooms.value().find(o=>o._id===t);if(i){let o=this.getRoomsFormArray();if(o){let l=o.at(e),c=0;i.priceOverride?c=i.priceOverride:typeof i.roomType=="object"&&i.roomType?.basePrice&&(c=i.roomType.basePrice);let C=l?.get("stayPeriod")?.get("numberOfNights")?.value||1,x=c*C;l?.patchValue({roomNumber:i.roomNumber||"",pricing:{pricePerNight:c,totalPrice:x,discount:0,subtotal:x,taxes:0,discountType:"amount",fees:{serviceFee:0,cleaningFee:0,resortFee:0,other:0},total:x}})}}}trackByFormArrayIndex(e){return e}getRoomTypeBadgeColor(e){let t=typeof e=="string"?e:e?.name||"standard";return{deluxe:"bg-blue-100 text-blue-700",suite:"bg-purple-100 text-purple-700",standard:"bg-gray-100 text-gray-700",luxury:"bg-yellow-100 text-yellow-700",penthouse:"bg-red-100 text-red-700"}[t.toLowerCase()]||"bg-gray-100 text-gray-700"}getRoomStatusColor(e){return{available:"text-green-600",occupied:"text-red-600",maintenance:"text-yellow-600",reserved:"text-blue-600"}[e.toLowerCase()]||"text-gray-600"}trackByRoomId(e,t){return t._id||e.toString()}getRoomTypeNameById(e){let t=this.roomTypes.value().find(i=>i._id===e||i.id===e);return t?t.name:"Unknown"}getMinDate(){return this.reservationForm()?.get("checkInDate")?.value||null}getMaxDate(){return this.reservationForm()?.get("checkOutDate")?.value||null}calculateNumberOfNights(e,t){if(!e||!t)return 0;let i=new Date(e),o=new Date(t);i.setHours(0,0,0,0),o.setHours(0,0,0,0);let l=1440*60*1e3,c=Math.ceil((o.getTime()-i.getTime())/l);return Math.max(1,c)}onStayPeriodChange(e){let t=this.getRoomsFormArray();if(!t)return;let i=t.at(e),o=i?.get("stayPeriod"),l=i?.get("room")?.value;if(!o||!l)return;let c=o.get("from")?.value,d=o.get("to")?.value;if(!c||!d)return;let C=this.calculateNumberOfNights(c,d),x=i?.get("pricing"),k=(x?.get("pricePerNight")?.value||0)*C;if(o.patchValue({numberOfNights:C},{emitEvent:!1}),x?.patchValue({totalPrice:k,subtotal:k,total:k},{emitEvent:!0}),!this.rooms.value().find(ei=>ei._id===l))return;let le=this.reservationForm(),K=le?.get("checkInDate")?.value,me=le?.get("checkOutDate")?.value;if(!K||!me)return;let yt=new Date(c),St=new Date(d),sn=new Date(K),ln=new Date(me);if(yt<sn||St>ln){this.snackBar.open("Room stay period must be within the reservation dates","Close",{duration:4e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["warning-snackbar"]}),o.patchValue({from:K,to:me});return}this.checkRoomAvailability(l,c,d).then(ei=>{if(!ei){this.snackBar.open("Room is not available for the selected dates","Close",{duration:4e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["error-snackbar"]}),o.patchValue({from:K,to:me});return}this.updateReservationDatesFromRooms()})}updateReservationDatesFromRooms(){}checkRoomAvailability(e,t,i){return new Promise(o=>{let l=this.storeStore.selectedStore()?._id;if(!l){o(!1);return}let c=new Date(t).toISOString().split("T")[0],d=new Date(i).toISOString().split("T")[0];this.roomsService.getAvailableRooms({storeId:l,checkInDate:c,checkOutDate:d}).subscribe({next:C=>{let x=C.some(y=>y._id===e);o(x)},error:()=>{o(!1)}})})}calculateTotalBreakdown(e){let t=this.getRoomsFormArray();return t?t.controls.reduce((i,o)=>{let l=o.get("pricing");if(!l)return i;switch(e){case"subtotal":return i+(l.get("totalPrice")?.value||0);case"serviceFee":let c=l.get("fees");return c?i+(c.get("serviceFee")?.value||0):i;case"cleaningFee":let d=l.get("fees");return d?i+(d.get("cleaningFee")?.value||0):i;case"resortFee":let C=l.get("fees");return C?i+(C.get("resortFee")?.value||0):i;case"otherFees":let x=l.get("fees");return x?i+(x.get("other")?.value||0):i;case"fees":let y=l.get("fees");return y?i+((y.get("serviceFee")?.value||0)+(y.get("cleaningFee")?.value||0)+(y.get("resortFee")?.value||0)+(y.get("other")?.value||0)):i;case"taxes":return i+(l.get("taxes")?.value||0);case"discount":return i+(l.get("discount")?.value||0);case"total":let k=l.get("totalPrice")?.value||0,N=(()=>{let me=l.get("fees");return me?(me.get("serviceFee")?.value||0)+(me.get("cleaningFee")?.value||0)+(me.get("resortFee")?.value||0)+(me.get("other")?.value||0):0})(),le=l.get("taxes")?.value||0,K=l.get("discount")?.value||0;return i+(k+N+le-K);default:return i}},0):0}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=G({type:r,selectors:[["app-room-details"]],inputs:{selectedRoomIds:[1,"selectedRoomIds"],reservation:[1,"reservation"]},outputs:{roomAssigned:"roomAssigned"},features:[$e([{provide:Ti,useValue:"en-US"}])],decls:16,vars:3,consts:[["dateRangePicker",""],["appearance","outlined"],[1,"flex","justify-between","items-center","w-full"],[1,"flex","gap-2"],["matButton","filled","color","primary",3,"click"],[1,"material-icons-outlined"],[1,"flex","justify-center","items-center","py-8"],[3,"formGroup"],["diameter","40"],[1,"overflow-x-auto"],["formArrayName","rooms"],[1,"grid","gap-3","p-3","border-b","border-gray-200","items-center","text-xs","hover:bg-gray-50",2,"grid-template-columns","1.2fr 1fr 1.2fr 1fr 1fr 1.2fr 0.8fr",3,"formGroupName"],[1,"text-center","py-8","text-gray-500"],["appearance","outline",1,"w-full"],["formControlName","roomType",1,"text-xs",3,"selectionChange"],[3,"value"],["formControlName","room",1,"text-xs",3,"selectionChange"],["value",""],["matInput","","placeholder","Select or create guest","readonly","",1,"text-xs",3,"value"],["mat-icon-button","","matPrefix","","color","primary","type","button","matTooltip","Add or change guest",3,"click"],[1,"text-sm"],["formGroupName","guests",1,"flex","gap-2"],["appearance","outline",1,"flex-1"],["matInput","","type","number","formControlName","adults","min","1",1,"text-xs"],["matPrefix","",1,"text-sm"],["matInput","","type","number","formControlName","children","min","0",1,"text-xs"],["formGroupName","stayPeriod"],[3,"rangePicker","min","max"],["matStartDate","","formControlName","from","placeholder","Start date",1,"text-xs",3,"dateChange"],["matEndDate","","formControlName","to","placeholder","End date",1,"text-xs",3,"dateChange"],["matIconSuffix","",3,"for"],["formGroupName","pricing"],["matInput","","currencyMask","","formControlName","totalPrice","placeholder","0.00","readonly","",1,"text-xs","text-right","font-semibold",3,"options"],["matPrefix","",1,"text-gray-600"],["mat-icon-button","","matSuffix","","color","primary","type","button","matTooltip","Edit price",3,"click"],[1,"flex","justify-center"],["type","button","mat-icon-button","","color","warn","matTooltip","Remove room",1,"h-8","w-8",3,"click"],[1,"text-4xl","text-gray-300","mb-2"]],template:function(t,i){t&1&&(a(0,"mat-card",1)(1,"mat-card-header")(2,"div",2)(3,"div")(4,"mat-card-title"),s(5," Selected Rooms "),n(),a(6,"mat-card-subtitle"),s(7),n()(),a(8,"div",3)(9,"a",4),S("click",function(){return i.onCreateRoom()}),a(10,"mat-icon",5),s(11,"add"),n(),s(12," ADD MORE ROOM(S) "),n()()()(),a(13,"mat-card-content"),h(14,ko,2,0,"div",6)(15,Vo,7,3,"div",7),n()()),t&2&&(m(7),Et(" ",i.totalRooms()," room(s) - Total Capacity: ",i.totalCapacity()," guest(s) "),m(7),f(i.rooms.isLoading()&&i.selectedRooms.isLoading()&&i.roomTypes.isLoading()?14:15))},dependencies:[I,L,ne,It,Z,U,Oi,B,oe,Ie,Pt,H,de,pe,ge,At,ue,$,Y,J,be,We,ze,Pe,w,he,q,ie,Rt,A,Q,Ut,Je,we,Lt,xe,Ze,re,Ee,ce,Me,Ve,at,rt,st,lt,Ke,kt,Fe,ut,_t,pt,Ge],styles:["[_nghost-%COMP%]{display:block}mat-card-header[_ngcontent-%COMP%]{padding-bottom:1rem;margin-bottom:1rem;border-bottom:1px solid #e5e7eb}"]})};function Oo(r,e){r&1&&(a(0,"mat-error"),s(1,"Payment method is required"),n())}function Bo(r,e){r&1&&(a(0,"mat-error"),s(1,"Status is required"),n())}var Yt=class r{reservationForm=O(void 0);static \u0275fac=function(t){return new(t||r)};static \u0275cmp=G({type:r,selectors:[["payment-info"]],inputs:{reservationForm:[1,"reservationForm"]},decls:38,vars:3,consts:[["appearance","outlined"],[3,"formGroup"],["formGroupName","paymentInfo",1,"space-y-4","py-3"],["appearance","outline",1,"w-full"],["formControlName","method"],["value","cash"],["value","credit_card"],["value","debit_card"],["value","bank_transfer"],["value","check"],["value","mobile_payment"],["value","other"],["formControlName","status"],["value","pending"],["value","partial"],["value","paid"],["value","refunded"]],template:function(t,i){if(t&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),s(3," Payment Info "),n()(),a(4,"mat-card-content",1)(5,"div",2)(6,"mat-form-field",3)(7,"mat-label"),s(8,"Payment Method"),n(),a(9,"mat-select",4)(10,"mat-option",5),s(11,"Cash"),n(),a(12,"mat-option",6),s(13,"Credit Card"),n(),a(14,"mat-option",7),s(15,"Debit Card"),n(),a(16,"mat-option",8),s(17,"Bank Transfer"),n(),a(18,"mat-option",9),s(19,"Check"),n(),a(20,"mat-option",10),s(21,"Mobile Payment"),n(),a(22,"mat-option",11),s(23,"Other"),n()(),h(24,Oo,2,0,"mat-error"),n(),a(25,"mat-form-field",3)(26,"mat-label"),s(27,"Payment Method"),n(),a(28,"mat-select",12)(29,"mat-option",13),s(30,"Pending"),n(),a(31,"mat-option",14),s(32,"Partial"),n(),a(33,"mat-option",15),s(34,"Paid"),n(),a(35,"mat-option",16),s(36,"Refunded"),n()(),h(37,Bo,2,0,"mat-error"),n()()()()),t&2){let o,l;m(4),g("formGroup",i.reservationForm()),m(20),f(!((o=i.reservationForm())==null||(o=o.get("paymentMethod"))==null||(o=o.get("method"))==null)&&o.hasError("required")?24:-1),m(13),f(!((l=i.reservationForm())==null||(l=l.get("paymentMethod"))==null||(l=l.get("status"))==null)&&l.hasError("required")?37:-1)}},dependencies:[H,de,pe,ge,ue,A,Y,w,J,We,re,Ee,ce,L,Z,U,B,oe,Ie,wt],styles:["[_nghost-%COMP%]{display:block}"]})};var Qt=class r{reservationForm=O(void 0);getReservationForm(){return this.reservationForm()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=G({type:r,selectors:[["app-special-requests"]],inputs:{reservationForm:[1,"reservationForm"]},decls:18,vars:1,consts:[["appearance","outlined"],[1,"space-y-4",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","specialRequests","placeholder","e.g., High floor, late arrival, anniversary celebration, dietary requirements...","rows","3",1,"text-sm"],["matInput","","formControlName","internalNotes","placeholder","e.g., Guest prefers quiet hours, previous complaints, VIP notes, maintenance issues...","rows","3",1,"text-sm"]],template:function(t,i){t&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),s(3," Special Requests & Notes "),n()(),a(4,"mat-card-content")(5,"div",1)(6,"mat-form-field",2)(7,"mat-label"),s(8,"Special Requests"),n(),v(9,"textarea",3),a(10,"mat-hint"),s(11,"Enter any special requests from the guest (visible to guest)"),n()(),a(12,"mat-form-field",2)(13,"mat-label"),s(14,"Internal Notes"),n(),v(15,"textarea",4),a(16,"mat-hint"),s(17,"Internal notes visible only to staff (not shown to guest)"),n()()()()()),t&2&&(m(5),g("formGroup",i.getReservationForm()))},dependencies:[I,L,ne,Z,U,B,oe,H,de,pe,ge,ue,$,Y,J,be,w,he,A,we],encapsulation:2})};function Lo(r,e){if(r&1&&(a(0,"mat-list-item")(1,"mat-icon",4),s(2,"warning"),n(),a(3,"div",5),s(4),n(),a(5,"div",6),s(6),n()()),r&2){let t=e.$implicit,i=p();m(4),V(i.formatFieldName(t)),m(2),V(i.formatFullPath(t))}}function qo(r,e){r&1&&(a(0,"mat-list-item")(1,"mat-icon",7),s(2,"check_circle"),n(),a(3,"div",5),s(4,"All fields are valid"),n()())}var Xt=class r{data=_(et);constructor(){}formatFieldName(e){let t=e.split("."),i=t[t.length-1];if(t.length>1&&!isNaN(Number(t[t.length-2]))){let o=parseInt(t[t.length-2]),l=this.camelCaseToTitleCase(i),c=t[0],d=this.getArrayContext(c,o);return`${l} ${d}`.trim()}return this.camelCaseToTitleCase(i||e)}getArrayContext(e,t){let o={sharers:l=>l===0?"(Primary Guest)":`(Guest #${l+1})`,rooms:l=>`(Room #${l+1})`,fees:l=>`(Fee Item #${l+1})`}[e];return o?o(t):""}camelCaseToTitleCase(e){return e.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase()).trim()}formatFullPath(e){let t=e.split("."),i=[];for(let o=0;o<t.length;o++){let l=t[o];if(!isNaN(Number(l)))continue;let c=this.getSectionName(l,o===0);c&&i.push(c)}for(let o=0;o<t.length-1;o++)if(!isNaN(Number(t[o+1]))){let l=t[o],c=parseInt(t[o+1]),d=this.getArrayContext(l,c);if(d){let C=i.findIndex(x=>x.toLowerCase().includes(l));C>=0&&i.splice(C+1,0,d)}}return i.length>0?i.join(" > "):e}getSectionName(e,t){return{guest:"Guest",checkInDate:"Check-in Date",checkOutDate:"Check-out Date",numberOfAdults:"Number of Adults",numberOfChildren:"Number of Children",pricing:"Pricing",subtotal:"Subtotal",taxes:"Taxes",fees:"Fees",serviceFee:"Service Fee",cleaningFee:"Cleaning Fee",resortFee:"Resort Fee",total:"Total",paid:"Paid Amount",balance:"Balance",sharers:"Room Sharers",rooms:"Rooms",room:"Room",assignedGuest:"Assigned Guest",stayPeriod:"Stay Period",guests:"Guests",pricePerNight:"Price Per Night",totalPrice:"Total Price"}[e]||this.camelCaseToTitleCase(e)}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=G({type:r,selectors:[["app-validation-errors-dialog"]],decls:15,vars:3,consts:[["mat-dialog-title",""],["inline","",1,"align-middle"],["align","end"],["matButton","filled","color","primary","mat-dialog-close",""],["matListItemIcon",""],["matListItemTitle",""],["matListItemLine",""],["matListItemIcon","","color","accent"]],template:function(t,i){t&1&&(a(0,"div")(1,"h2",0)(2,"mat-icon",1),s(3,"error_outline"),n(),s(4),n(),a(5,"mat-dialog-content")(6,"p"),s(7),n(),a(8,"mat-list"),j(9,Lo,7,2,"mat-list-item",null,_i),h(11,qo,5,0,"mat-list-item"),n()(),a(12,"mat-dialog-actions",2)(13,"button",3),s(14," Close "),n()()()),t&2&&(m(4),b(" ",i.data.title||"Validation Errors"," "),m(3),b(" ",i.data.message||"Please fix the following errors before submitting:"," "),m(2),W(i.data.invalidControls),m(2),f(i.data.invalidControls.length===0?11:-1))},dependencies:[I,ot,Ui,tt,nt,it,q,ie,A,Q,Fe,Qe,Xe,Bt,Ot,Ye],encapsulation:2})};function Uo(r,e){if(r&1&&(a(0,"h1",6),s(1," Edit Reservation "),n(),a(2,"p",7),s(3," Confirmation: "),a(4,"span",8),s(5),n()()),r&2){let t,i=p();m(5),V((t=i.reservation.value())==null?null:t.confirmationNumber)}}function Ho(r,e){if(r&1&&(a(0,"h1",6),s(1),n(),a(2,"p",7),s(3," Create a new guest reservation "),n()),r&2){let t=p();m(),b(" Create New ",t.bookingType()==="group"?"Group":"Single"," Reservation ")}}function $o(r,e){if(r&1){let t=R();a(0,"a",13),S("click",function(){F(t);let o=p(2);return M(o.updateReservationStatus(o.ReservationStatus.CANCELLED))}),a(1,"mat-icon"),s(2,"cancel"),n(),s(3," Cancel "),n()}if(r&2){let t=p(2);g("disabled",t.statusUpdating()||t.isSubmitted())}}function Ko(r,e){if(r&1){let t=R();a(0,"button",9),S("click",function(){F(t);let o=p(2);return M(o.updateReservationStatus(o.ReservationStatus.CONFIRMED))}),a(1,"mat-icon"),s(2,"verified"),n(),s(3," Confirm "),n()}if(r&2){let t=p(2);g("disabled",t.statusUpdating()||t.isSubmitted())}}function jo(r,e){if(r&1){let t=R();a(0,"button",9),S("click",function(){F(t);let o=p(2);return M(o.reopenReservation())}),a(1,"mat-icon"),s(2,"redo"),n(),s(3," Re-open "),n()}if(r&2){let t=p(2);g("disabled",t.statusUpdating()||t.isSubmitted())}}function Wo(r,e){if(r&1){let t=R();a(0,"button",9),S("click",function(){F(t);let o=p(2);return M(o.updateReservationStatus(o.ReservationStatus.CHECKED_IN))}),a(1,"mat-icon"),s(2,"check_circle_outline"),n(),s(3," Check-in "),n()}if(r&2){let t=p(2);g("disabled",t.statusUpdating())}}function zo(r,e){if(r&1){let t=R();a(0,"button",9),S("click",function(){F(t);let o=p(2);return M(o.updateReservationStatus(o.ReservationStatus.CHECKED_OUT))}),a(1,"mat-icon"),s(2,"logout"),n(),s(3," Check-out "),n()}if(r&2){let t=p(2);g("disabled",t.statusUpdating())}}function Zo(r,e){if(r&1){let t=R();a(0,"a",9),S("click",function(){F(t);let o=p();return M(o.exportReservationToPDF())}),a(1,"mat-icon"),s(2),n(),s(3),n(),h(4,$o,4,1,"a",10),a(5,"a",9),S("click",function(){F(t);let o=p();return M(o.payment())}),a(6,"mat-icon"),s(7,"payment"),n(),s(8," Payment "),n(),h(9,Ko,4,1,"button",11),h(10,jo,4,1,"button",11),h(11,Wo,4,1,"button",11),h(12,zo,4,1,"button",11),a(13,"button",12),S("click",function(){F(t);let o=p();return M(o.onSubmit())}),a(14,"mat-icon"),s(15,"save"),n(),s(16," Save "),n()}if(r&2){let t,i,o,l,c,d=p();g("disabled",d.exportingPDF()||d.statusUpdating()||d.isSubmitted()),m(2),V(d.exportingPDF()?"download":"picture_as_pdf"),m(),b(" ",d.exportingPDF()?"Exporting...":"Export to PDF"," "),m(),f(((t=d.reservation.value())==null?null:t.status)!==d.ReservationStatus.CANCELLED&&((t=d.reservation.value())==null?null:t.status)!==d.ReservationStatus.NO_SHOW?4:-1),m(),g("disabled",d.isSubmitted()),m(4),f(((i=d.reservation.value())==null?null:i.status)===d.ReservationStatus.PENDING||((i=d.reservation.value())==null?null:i.status)===d.ReservationStatus.RESERVED?9:-1),m(),f(((o=d.reservation.value())==null?null:o.status)===d.ReservationStatus.CHECKED_OUT||((o=d.reservation.value())==null?null:o.status)===d.ReservationStatus.CANCELLED||((o=d.reservation.value())==null?null:o.status)===d.ReservationStatus.NO_SHOW?10:-1),m(),f(((l=d.reservation.value())==null?null:l.status)===d.ReservationStatus.CONFIRMED?11:-1),m(),f(((c=d.reservation.value())==null?null:c.status)===d.ReservationStatus.CHECKED_IN?12:-1),m(),g("disabled",d.isSubmitted())}}function Jo(r,e){if(r&1){let t=R();a(0,"a",9),S("click",function(){F(t);let o=p();return M(o.payment())}),a(1,"mat-icon"),s(2,"payment"),n(),s(3," Payment "),n(),a(4,"a",14),S("click",function(){F(t);let o=p();return M(o.onSubmit())}),a(5,"mat-icon"),s(6,"event"),n(),s(7," Reserve "),n()}if(r&2){let t=p();g("disabled",t.isSubmitted()),m(4),g("disabled",t.isSubmitted())}}function Yo(r,e){if(r&1&&(a(0,"div",5),v(1,"mat-spinner",15),a(2,"span",16),s(3),n()()),r&2){let t=p();m(3),b(" ",t.isEditing()?"Loading reservation...":"Creating reservation..."," ")}}function Qo(r,e){if(r&1){let t=R();a(0,"div",17)(1,"div",26)(2,"mat-icon",27),s(3,"error"),n(),a(4,"div",28)(5,"h3",29),s(6,"Error"),n(),a(7,"p",30),s(8),n(),a(9,"button",31),S("click",function(){F(t);let o=p(2);return M(o.clearError())}),s(10,"Dismiss"),n()()()()}if(r&2){let t=p(2);m(8),V(t.reservation.error())}}function Xo(r,e){if(r&1){let t=R();a(0,"app-room-sharers",32),xi("selectedGuestChange",function(o){F(t);let l=p(2);return bi(l.selectedGuest,o)||(l.selectedGuest=o),M(o)}),S("selectedGuestChange",function(o){F(t);let l=p(2);return M(l.onSelectedGuestChange(o))})("sharerAdded",function(){F(t);let o=p(2);return M(o.onAddSharer())})("sharerEdited",function(o){F(t);let l=p(2);return M(l.onEditSharer(o))})("sharerDeleted",function(o){F(t);let l=p(2);return M(l.onDeleteSharer(o))}),n()}if(r&2){let t=p(2);Si("selectedGuest",t.selectedGuest),g("quickReservation",t.quickReservation())("reservation",t.reservation.value())}}function ea(r,e){if(r&1&&v(0,"app-room-details",24),r&2){let t=p(2);g("reservation",t.reservation.value())("selectedRoomIds",t.selectedRoomIds())}}function ta(r,e){if(r&1){let t=R();a(0,"div",0),h(1,Qo,11,1,"div",17),a(2,"form",18),S("ngSubmit",function(){F(t);let o=p();return M(o.onSubmit())}),a(3,"div",19)(4,"app-guest-details",20),S("guestAdded",function(){F(t);let o=p();return M(o.onAddGuest())})("guestEdited",function(){F(t);let o=p();return M(o.onEditGuest())})("guestDeleted",function(){F(t);let o=p();return M(o.onDeleteGuest())})("guestSelected",function(o){F(t);let l=p();return M(l.onGuestSelected(o))}),n(),v(5,"app-stay-details",21)(6,"payment-info",22),h(7,Xo,1,3,"app-room-sharers",23)(8,ea,1,2,"app-room-details",24),v(9,"app-special-requests",25),n()()()}if(r&2){let t=p();m(),f(t.reservation.error()?1:-1),m(),g("formGroup",t.reservationForm),m(2),g("guest",t.selectedGuest()),m(),g("quickReservation",t.quickReservation())("isEditing",t.isEditing()),m(),g("reservationForm",t.reservationForm),m(),f(t.isSingleBooking()?7:8),m(2),g("reservationForm",t.reservationForm)}}var rn=class r{router=_(Gi);route=_(Nt);location=_(Ni);fb=_(Se);reservationService=_(Ji);roomsService=_(mt);guestService=_(De);authService=_(Gt);storeStore=_(ae);snackBar=_(je);cdr=_(Ei);dialog=_(Ae);destroy$=new ke;reservationFormService=_(X);id=E(this.route.snapshot.paramMap.get("id"));isSubmitted=E(!1);quickReservationQuery=E(this.route.snapshot.queryParamMap.get("quickReservation"));statusUpdating=E(!1);exportingPDF=E(!1);ReservationStatus=oi;quickReservation=D(()=>{let e=this.quickReservationQuery();return e?JSON.parse(e):null});currentUser=P(this.authService.currentUser,{initialValue:null});selectedGuest=E(null);isEditing=D(()=>!!this.id());paymentRedirection=E(!1);constructor(){this.reservationFormService.setForm(this.reservationForm),this.route.queryParamMap.subscribe(e=>{let t=e.get("paymentRedirection");t&&this.paymentRedirection.set(!!t)})}bookingType=D(()=>this.isEditing()?this.reservationForm.get("bookingType")?.value:this.quickReservation()?.bookingType);isSingleBooking=D(()=>this.bookingType()==="single");selectedRoomIds=D(()=>this.isEditing()?this.reservation.hasValue()?this.reservation.value().rooms.map(e=>e.room._id):[]:this.quickReservation()?.selectedRoom||[]);exportReservationToPDF(){return ye(this,null,function*(){let e=this.reservation.value();if(e){this.exportingPDF.set(!0);try{let t=yield this.reservationService.exportReservationToPDF(e._id).toPromise();if(t){let i=window.URL.createObjectURL(t),o=document.createElement("a");o.href=i,o.download=`reservation-${e.confirmationNumber}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(i),this.snackBar.open("Reservation details exported to PDF successfully!","Close",{duration:3e3})}}catch(t){console.error("Error exporting reservation to PDF:",t);let i=t instanceof Error?t.message:"Failed to export reservation to PDF";this.snackBar.open(i,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.exportingPDF.set(!1)}}})}reservationForm=this.fb.group({bookingType:[this.quickReservation()?.bookingType,[u.required]],guest:["",[u.required]],store:[this.storeStore.selectedStore()?._id||"",[u.required]],checkInDate:[new Date(this.quickReservation()?.checkInDate),[u.required]],checkOutDate:[new Date(this.quickReservation()?.checkOutDate),[u.required]],numberOfNights:[1,[u.required,u.min(1)]],bookingSource:["walk_in",[u.required]],createdBy:[this.currentUser()?._id,[u.required]],paymentInfo:this.fb.group({method:[{value:"cash",disabled:!0},[u.required]],status:[{value:"pending",disabled:!0},[u.required]]}),numberOfAdults:[1,[u.required,u.min(1)]],numberOfChildren:[0,[u.required,u.min(0)]],pricing:this.fb.group({subtotal:[0,[u.required,u.min(0)]],taxes:[0,[u.min(0)]],fees:this.fb.group({serviceFee:[0,[u.min(0)]],cleaningFee:[0,[u.min(0)]],resortFee:[0,[u.min(0)]],other:[0,[u.min(0)]]}),discounts:[0,[u.min(0)]],total:[0,[u.required,u.min(0)]],paid:[0,[u.min(0)]],balance:[0,[u.min(0)]]}),specialRequests:["",[]],internalNotes:["",[]],sharers:this.fb.array([]),rooms:this.fb.array([])});availableRoomsResource=Ne({params:()=>({checkIn:this.checkIn(),checkOut:this.checkOut()}),stream:({params:e})=>this.getAvailableRooms({checkIn:e.checkIn,checkOut:e.checkOut})});checkIn=P(this.reservationForm.get("checkInDate").valueChanges,{initialValue:this.reservationForm.get("checkInDate").value});checkOut=P(this.reservationForm.get("checkOutDate").valueChanges,{initialValue:this.reservationForm.get("checkOutDate").value});reservation=Ne({params:()=>({id:this.id()}),stream:({params:e})=>this.getReservation(e.id).pipe(He(t=>(t&&(this.populateForm(t),this.paymentRedirection()&&this.showPaymentRequiredDialog(t)),t)))});reopenReservation(){return ye(this,null,function*(){let e=this.reservation.value();if(!e)return;if(e.status!=="cancelled"&&e.status!=="checked_out"&&e.status!=="no_show"){this.snackBar.open("Only cancelled, checked-out, or no-show reservations can be reopened","Close",{duration:5e3,panelClass:["error-snackbar"]});return}let t=this.storeStore.selectedStore()?._id;if(!t){this.snackBar.open("Store information not available","Close",{duration:5e3,panelClass:["error-snackbar"]});return}this.dialog.open(Xi,{width:"400px",disableClose:!0,data:{storeId:t,actionDescription:"reopen this cancelled reservation",reservationId:e._id}}).afterClosed().subscribe(o=>ye(this,null,function*(){if(o&&o.authorized&&o.pin){this.statusUpdating.set(!0);try{let l=yield this.reservationService.reopenReservation(e._id,o.pin).toPromise();l&&(this.reservation.set(l),this.snackBar.open("Reservation reopened successfully","Close",{duration:3e3,panelClass:["success-snackbar"]}))}catch(l){console.error("Error reopening reservation:",l);let c="Failed to reopen reservation";(l instanceof Error&&l.message||l&&typeof l=="object"&&l.message)&&(c=l.message),this.snackBar.open(c,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.statusUpdating.set(!1)}}}))})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getSharersFormArray(){return this.reservationForm.controls.sharers}getRoomsFormArray(){return this.reservationForm.controls.rooms}getAvailableRooms(e){let t=this.storeStore.selectedStore()?._id,i=new Date(e.checkIn).toISOString().split("T")[0],o=new Date(e.checkOut).toISOString().split("T")[0];return!i||!o||!t?bt([]):this.roomsService.getAvailableRooms({storeId:t,checkInDate:i,checkOutDate:o})}getReservation(e){return this.reservationService.getReservationById(e)}totalAmount=D(()=>{let e=this.reservationForm.get("subtotal")?.value||0,t=this.reservationForm.get("taxes")?.value||0,i=this.reservationForm.get("discount")?.value||0,o=e+t-i;return Math.max(0,o)});onAddGuest(){this.snackBar.open("Guest creation dialog will be implemented","Close",{duration:3e3})}onEditGuest(){this.selectedGuest()&&this.snackBar.open("Guest edit dialog will be implemented","Close",{duration:3e3})}onGuestSelected(e){this.selectedGuest.set(e),this.reservationForm.patchValue({guest:e._id}),this.isSingleBooking()&&this.getPrimaryGuest()&&(this.getPrimaryGuest()?.patchValue({guest:e._id,meta:e,guestType:"adult",checkInDate:this.checkIn(),checkOutDate:this.checkOut()}),this.getPrimaryRoom()?.patchValue({assignedGuest:e._id,assignedGuestName:this.guestService.getGuestName(e)})),this.snackBar.open(`Guest ${this.guestService.getGuestName(e)} selected`,"Close",{duration:2e3,panelClass:["success-snackbar"]})}onDeleteGuest(){let e=this.getSharersFormArray(),t=e.length>1&&Array.from({length:e.length-1},(i,o)=>e.at(o+1)).some(i=>i?.get("guest")?.value);if(this.isSingleBooking()&&t){this.snackBar.open("Cannot remove primary guest while there are other sharers assigned. Please remove sharers first.","Close",{duration:3e3,panelClass:["error-snackbar"]});return}this.selectedGuest.set(null),this.getPrimaryGuest()?.patchValue({guest:null,meta:null,guestType:null}),this.snackBar.open("Guest removed","Close",{duration:2e3,panelClass:["success-snackbar"]})}getPrimaryGuest(){return this.getSharersFormArray().length>0?this.getSharersFormArray().at(0):null}getPrimaryRoom(){return this.getRoomsFormArray().length>0?this.getRoomsFormArray().at(0):null}onSelectedGuestChange(e){}populateForm(e){this.reservationForm.patchValue({bookingType:e?.bookingType||"group",guest:e.guest._id,checkInDate:new Date(e.checkInDate),checkOutDate:new Date(e.checkOutDate),numberOfNights:e.numberOfNights,bookingSource:e.bookingSource,paymentInfo:{method:e.paymentInfo?.method||"cash",status:e.paymentInfo?.status||"pending"},numberOfAdults:e.numberOfAdults||1,numberOfChildren:e.numberOfChildren||0,pricing:{subtotal:e.pricing?.subtotal||0,taxes:e.pricing?.taxes||0,fees:{serviceFee:e.pricing?.fees?.serviceFee||0,cleaningFee:e.pricing?.fees?.cleaningFee||0,resortFee:e.pricing?.fees?.resortFee||0,other:e.pricing?.fees?.other||0},discounts:e.pricing?.discounts||0,total:e.pricing?.total||0,paid:e.pricing?.paid||0,balance:e.pricing?.balance||0},specialRequests:e.specialRequests||"",internalNotes:e.internalNotes||""}),e.guest&&this.selectedGuest.set(e.guest)}payment(){this.isEditing()?this.showPaymentRequiredDialog(this.reservation.value()):this.onSubmit(!0)}onSubmit(e){if(this.reservationForm.invalid){let l=this.getInvalidControls(this.reservationForm);this.dialog.open(Xt,{data:{invalidControls:l,title:"Form Validation Errors",message:"Please fix the following errors before submitting:"},width:"500px",maxWidth:"90vw",disableClose:!1});return}if(!this.selectedGuest()){this.snackBar.open("Please select a guest","Close",{duration:3e3,panelClass:["error-snackbar"]});return}let i=this.reservationForm.getRawValue();if(!this.storeStore.selectedStore()?._id){this.snackBar.open("No store selected","Close",{duration:3e3,panelClass:["error-snackbar"]});return}this.isSubmitted.set(!0),this.isEditing()?this.updateReservation(i):this.createReservation(i,e)}createReservation(e,t){this.reservationService.createReservation(e).pipe(ee(this.destroy$)).subscribe({next:i=>{this.isSubmitted.set(!1),this.snackBar.open("Reservation created successfully","Close",{duration:3e3,panelClass:["success-snackbar"]}),this.router.navigate(["../edit",i._id],{relativeTo:this.route}).then(()=>{t&&this.showPaymentRequiredDialog(i)})},error:i=>{this.isSubmitted.set(!1),console.error("Error creating reservation:",i),this.snackBar.open("Failed to create reservation. Please try again.","Close",{duration:3e3,panelClass:["error-snackbar"]})}})}updateReservation(e){let t=this.id();t&&this.reservationService.updateReservation(t,this.reservationForm.getRawValue()).pipe(ee(this.destroy$)).subscribe({next:i=>{this.isSubmitted.set(!1),this.snackBar.open("Reservation updated successfully","Close",{duration:3e3,panelClass:["success-snackbar"]}),this.reservation.reload()},error:i=>{console.error("Error updating reservation:",i),this.isSubmitted.set(!1),this.snackBar.open("Failed to update reservation. Please try again.","Close",{duration:3e3,panelClass:["error-snackbar"]})}})}onAddSharer(){this.snackBar.open("Guest selection dialog will be implemented","Close",{duration:3e3})}onEditSharer(e){let{index:t,sharer:i}=e;this.snackBar.open(`Editing sharer at index ${t}`,"Close",{duration:3e3})}onDeleteSharer(e){let{index:t}=e;this.snackBar.open(`Sharer at index ${t} deleted`,"Close",{duration:2e3,panelClass:["success-snackbar"]})}performCheckOut(){return ye(this,null,function*(){let e=this.reservation.value();if(e){if(this.requiresPaymentBeforeCheckout(e)){this.showPaymentRequiredDialog(e);return}this.statusUpdating.set(!0);try{let t=yield this.reservationService.checkOutReservationWithRooms(e._id).toPromise();t&&(this.reservation.set(t),this.snackBar.open("Guest checked out successfully! Room status updated to cleaning.","Close",{duration:5e3}))}catch(t){console.error("Error during check-out:",t);let i=t instanceof Error?t.message:"Failed to check out guest";this.snackBar.open(i,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.statusUpdating.set(!1)}}})}requiresPaymentBeforeCheckout(e){let t=e.pricing.balance>0,i=e.paymentInfo?.status!=="paid";return t&&i}showPaymentRequiredDialog(e){let t={reservation:e,isCheckoutFlow:!0};this.dialog.open(Qi,{data:t,width:"600px",maxWidth:"90vw",disableClose:!0}).afterClosed().subscribe(o=>{if(o?.confirmed){this.reservation.reload();let l=this.reservation.value();if(l&&l.pricing.balance<=0)this.snackBar.open("\u2713 Payment completed! Checkout is now available.","Close",{duration:5e3,panelClass:["success-snackbar"],horizontalPosition:"center",verticalPosition:"top"});else{let c=l?l.pricing.balance:0;this.snackBar.open(`\u26A0\uFE0F Checkout Requires Full Payment - Outstanding balance: ${this.storeStore.selectedStore()?.currency} ${c}. Please collect full payment before checkout.`,"Continue Collecting",{duration:0,panelClass:["warning-snackbar"],horizontalPosition:"center",verticalPosition:"top"}).onAction().subscribe(()=>{this.showPaymentRequiredDialog(l)})}}else{let l=this.reservation.value();l&&this.requiresPaymentBeforeCheckout(l)&&this.snackBar.open(`\u26A0\uFE0F Checkout Requires Full Payment - Outstanding balance: 
            ${this.storeStore.selectedStore()?.currency} ${l.pricing.balance}. Please collect full payment before checkout.`,"Close",{duration:5e3,panelClass:["warning-snackbar"],horizontalPosition:"center",verticalPosition:"top"})}})}getInvalidControls(e,t=""){let i=[];return Object.keys(e.controls).forEach(o=>{let l=e.get(o),c=t?`${t}.${o}`:o;l&&(l instanceof Tt||l instanceof ft?i.push(...this.getInvalidControls(l,c)):l.invalid&&i.push(c))}),i}updateReservationStatus(e){return ye(this,null,function*(){let t=this.reservation.value();if(!(!t||t.status===e)){if(e==="checked_in"){this.showCheckInDialog(t);return}if(e==="checked_out"){this.performCheckOut();return}(e==="cancelled"||e==="no_show")&&!confirm(`Are you sure you want to change the status to ${e}?`)||(yield this.performStatusUpdate(e))}})}performStatusUpdate(e){return ye(this,null,function*(){let t=this.reservation.value();if(t){this.statusUpdating.set(!0);try{let i={status:e},o=yield this.reservationService.updateReservation(t._id,i).toPromise();o&&(this.reservation.set(o),this.snackBar.open(`Reservation status updated to ${e}`,"Close",{duration:3e3,panelClass:["success-snackbar"]}))}catch(i){console.error("Error updating reservation status:",i);let o=i instanceof Error?i.message:"Failed to update reservation status";this.snackBar.open(o,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.statusUpdating.set(!1)}}})}showCheckInDialog(e){let t={reservation:e};this.dialog.open(Yi,{data:t,width:"600px",maxWidth:"90vw",disableClose:!0}).afterClosed().subscribe(o=>{o?.confirmed&&this.performCheckIn(o)})}performCheckIn(e){return ye(this,null,function*(){let t=this.reservation.value();if(t){this.statusUpdating.set(!0);try{let i=yield this.reservationService.checkInReservationWithRooms(t._id,e).toPromise();i&&(this.reservation.set(i),this.snackBar.open("Guest checked in successfully! Room status updated to occupied.","Close",{duration:5e3}))}catch(i){console.error("Error during check-in:",i);let o=i instanceof Error?i.message:"Failed to check in guest";this.snackBar.open(o,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.statusUpdating.set(!1)}}})}onCancel(){this.location.back()}clearError(){}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=G({type:r,selectors:[["app-reservation-form"]],decls:14,vars:4,consts:[[1,"max-w-12xl","px-4"],[1,"flex","justify-between","items-center","py-4"],["matButton","","color","primary",3,"click"],[1,"mr-1",2,"font-size","18px","width","18px","height","18px"],[1,"flex","space-x-3"],[1,"flex","justify-center","items-center","py-12"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-600","mt-1"],[1,"font-mono","font-semibold","text-gray-900"],["matButton","outlined",3,"click","disabled"],["matButton","tonal",3,"disabled"],["matButton","outlined",3,"disabled"],["matButton","filled","color","primary","type","submit",3,"click","disabled"],["matButton","tonal",3,"click","disabled"],["matButton","filled","color","primary",3,"click","disabled"],["diameter","40"],[1,"ml-3","text-gray-600"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","mb-6"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","lg:grid-cols-4","gap-6"],[1,"lg:col-span-2",3,"guestAdded","guestEdited","guestDeleted","guestSelected","guest"],[3,"quickReservation","isEditing"],[3,"reservationForm"],[1,"lg:col-span-4",3,"selectedGuest","quickReservation","reservation"],[1,"lg:col-span-4",3,"reservation","selectedRoomIds"],[1,"lg:col-span-4",3,"reservationForm"],[1,"flex"],[1,"text-red-500","mr-3"],[1,"flex-1"],[1,"text-red-800","font-medium"],[1,"text-red-700","text-sm","mt-1"],["mat-button","",1,"mt-2",3,"click"],[1,"lg:col-span-4",3,"selectedGuestChange","sharerAdded","sharerEdited","sharerDeleted","selectedGuest","quickReservation","reservation"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"div",1)(2,"div")(3,"a",2),S("click",function(){return i.onCancel()}),a(4,"mat-icon",3),s(5,"arrow_back"),n(),s(6," Back to Reservations "),n(),h(7,Uo,6,1)(8,Ho,4,1),n(),a(9,"div",4),h(10,Zo,17,10)(11,Jo,8,2),n()()(),h(12,Yo,4,1,"div",5),h(13,ta,10,8,"div",0)),t&2&&(m(7),f(i.isEditing()?7:8),m(3),f(i.isEditing()?10:11),m(2),f(i.isEditing()&&i.reservation.isLoading()?12:-1),m(),f(i.reservation.hasValue()?13:-1))},dependencies:[I,L,Te,U,B,H,w,$,re,q,ie,A,Q,Me,xe,Ze,kt,jt,zt,Zt,Jt,Yt,Qt],styles:["@media(max-width:768px){.grid[_ngcontent-%COMP%]{grid-template-columns:repeat(1,minmax(0,1fr))}.pricing-summary[_ngcontent-%COMP%]{margin-left:1rem;margin-right:1rem}}"]})};export{rn as ReservationFormComponent};
