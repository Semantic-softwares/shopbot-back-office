import{a as Wt}from"./chunk-U2AOJ4DG.js";import{b as Ot}from"./chunk-24SFQJLQ.js";import{g as Nt}from"./chunk-M3D2B6CG.js";import"./chunk-MS4AQ6UA.js";import{a as Mt,b as wt,c as Tt,d as Pt,e as Vt,f as kt,g as Rt,h as Dt,i as Ft,j as Bt,k as Qt}from"./chunk-BWWYPHKT.js";import{a as At,b as Lt}from"./chunk-YVYCFWPM.js";import"./chunk-3RK6DDJD.js";import"./chunk-JQGESV5S.js";import{d as z}from"./chunk-XQNDMVIO.js";import{b as pt,c as _t,d as Ct}from"./chunk-3632TDEK.js";import{a as Z,b as tt}from"./chunk-I24LUS2H.js";import{a as gt,b as ht}from"./chunk-53YJL7QH.js";import"./chunk-F5X5MWHG.js";import{c as Et}from"./chunk-DSRTAZMJ.js";import{g as It}from"./chunk-H55FNLX4.js";import{a as St,b as bt}from"./chunk-LPJWQZ4I.js";import"./chunk-EEQKDLYL.js";import{c as yt}from"./chunk-NGGCDKIH.js";import"./chunk-JTD73F4Y.js";import{a as mt,e as st,h as ut}from"./chunk-JGZ2V5AL.js";import{C as at,D as rt,b as nt,g as it,l as ot}from"./chunk-CXVWFC6J.js";import"./chunk-JTLCVARK.js";import{a as lt,c as ct,g as dt}from"./chunk-HA7VDR7W.js";import{a as ft,b as xt}from"./chunk-7C3RSL2D.js";import{a as et}from"./chunk-FJ3Q27WB.js";import"./chunk-OHZSVTBE.js";import"./chunk-VIOSJ367.js";import"./chunk-TEL7Y7UN.js";import{o as J,p as X,q as Y}from"./chunk-FSA22CPB.js";import{b as vt}from"./chunk-JTAKXPWP.js";import"./chunk-M2YK6UF7.js";import"./chunk-BVQK7CK4.js";import"./chunk-LJSEVW7O.js";import{a as U,c as G,d as K,g as q}from"./chunk-7EKHSXIM.js";import"./chunk-TQDHD3WD.js";import{o as $,s as H,t as j}from"./chunk-DWCYWQVU.js";import{Cc as F,Db as f,Dc as O,Eb as x,Fc as W,Jb as _,Kb as o,Lb as i,Mb as P,Mc as M,Nb as y,Ob as g,Qb as E,Ub as S,Vb as s,_a as c,fa as I,fc as D,hc as N,ic as a,jc as b,kb as Q,kc as T,la as u,lc as A,ma as p,nc as V,oc as k,pc as R,qb as C,va as w,wc as L}from"./chunk-5AECHVKR.js";import{a as v}from"./chunk-EQDQRRRY.js";var jt=()=>["../.."];function Ut(n,e){if(n&1&&(o(0,"p",3),a(1),i()),n&2){let t=s();c(),b(t.reconciliation().name)}}function Gt(n,e){n&1&&(o(0,"mat-icon"),a(1,"refresh"),i())}function Kt(n,e){if(n&1){let t=E();o(0,"button",8),S("click",function(){u(t);let l=s();return p(l.saveProgress())}),f(1,Gt,2,0,"mat-icon"),a(2," Save Progress "),i()}if(n&2){let t=s();_("disabled",t.isSaving()),c(),x(t.isSaving()?1:-1)}}function qt(n,e){n&1&&(o(0,"th",49),a(1,"Product"),i())}function zt(n,e){if(n&1&&(o(0,"div",52),a(1),i()),n&2){let t=s().$implicit;c(),T("SKU: ",t.productSku)}}function Jt(n,e){if(n&1&&(o(0,"td",50)(1,"div")(2,"div",51),a(3),i(),f(4,zt,2,1,"div",52),i()()),n&2){let t=e.$implicit;c(3),b(t.productName),c(),x(t.productSku?4:-1)}}function Xt(n,e){n&1&&(o(0,"th",49),a(1,"System Qty"),i())}function Yt(n,e){if(n&1&&(o(0,"td",50)(1,"span",51),a(2),i()()),n&2){let t=e.$implicit;c(2),b(t.systemQuantity)}}function Zt(n,e){n&1&&(o(0,"th",49),a(1,"Physical Count"),i())}function te(n,e){if(n&1){let t=E();o(0,"td",50)(1,"mat-form-field",53)(2,"input",54),S("input",function(l){let d=u(t).$implicit,m=s(2);return p(m.updatePhysicalCount(d,l))}),i()()()}if(n&2){let t=e.$implicit;c(2),_("value",t.physicalQuantity||"")}}function ee(n,e){n&1&&(o(0,"th",49),a(1,"Variance"),i())}function ne(n,e){if(n&1&&(o(0,"td",50)(1,"span",51),a(2),i()()),n&2){let t=e.$implicit;c(),D("text-red-600",t.variance<0)("text-green-600",t.variance>0)("text-gray-600",t.variance===0),c(),T(" ",t.variance||0," ")}}function ie(n,e){n&1&&(o(0,"th",49),a(1,"Value Impact"),i())}function oe(n,e){if(n&1&&(o(0,"td",50)(1,"span",51),a(2),F(3,"currency"),i()()),n&2){let t=e.$implicit,r=s(2);c(),D("text-red-600",t.varianceValue<0)("text-green-600",t.varianceValue>0)("text-gray-600",t.varianceValue===0),c(),T(" ",W(3,7,t.varianceValue||0,r.currency(),"symbol","1.2-2")," ")}}function ae(n,e){n&1&&(o(0,"th",49),a(1,"Reason"),i())}function re(n,e){if(n&1){let t=E();o(0,"mat-form-field",55)(1,"mat-select",56),S("selectionChange",function(l){u(t);let d=s().$implicit,m=s(2);return p(m.updateReason(d,l.value))}),o(2,"mat-option",57),a(3,"Damage"),i(),o(4,"mat-option",58),a(5,"Theft"),i(),o(6,"mat-option",59),a(7,"Expiry"),i(),o(8,"mat-option",60),a(9,"Supplier Error"),i(),o(10,"mat-option",61),a(11,"Counting Error"),i(),o(12,"mat-option",62),a(13,"System Error"),i(),o(14,"mat-option",63),a(15,"Other"),i()()()}if(n&2){let t=s().$implicit;c(),_("value",t.reason||"")}}function le(n,e){if(n&1&&(o(0,"td",50),f(1,re,16,1,"mat-form-field",55),i()),n&2){let t=e.$implicit;c(),x(t.variance!==0&&t.physicalQuantity!==void 0?1:-1)}}function ce(n,e){n&1&&(o(0,"th",49),a(1,"Status"),i())}function de(n,e){if(n&1&&(o(0,"td",50)(1,"span",64),a(2),F(3,"titlecase"),i()()),n&2){let t=e.$implicit,r=s(2);c(),N(r.getStatusClass(t.status)),c(),T(" ",O(3,3,t.status)," ")}}function me(n,e){n&1&&(o(0,"th",49),a(1,"Actions"),i())}function se(n,e){if(n&1){let t=E();o(0,"button",67),S("click",function(){u(t);let l=s().$implicit,d=s(2);return p(d.markAsCounted(l))}),o(1,"mat-icon"),a(2,"check"),i()()}}function ue(n,e){if(n&1){let t=E();o(0,"button",68),S("click",function(){u(t);let l=s().$implicit,d=s(2);return p(d.resetCount(l))}),o(1,"mat-icon"),a(2,"undo"),i()()}}function pe(n,e){if(n&1&&(o(0,"td",50),f(1,se,3,0,"button",65),f(2,ue,3,0,"button",66),i()),n&2){let t=e.$implicit;c(),x(t.physicalQuantity!==void 0&&t.status==="pending"?1:-1),c(),x(t.status==="counted"?2:-1)}}function _e(n,e){n&1&&P(0,"tr",69)}function Ce(n,e){n&1&&P(0,"tr",70)}function fe(n,e){n&1&&(o(0,"div",45)(1,"mat-icon",71),a(2,"inventory_2"),i(),o(3,"h3",72),a(4,"No items found"),i(),o(5,"p",73),a(6,"Try adjusting your search or filter criteria"),i()())}function xe(n,e){if(n&1){let t=E();o(0,"mat-card",9)(1,"mat-card-content",10)(2,"div",11)(3,"div",12)(4,"div",13),a(5),i(),o(6,"div",14),a(7,"Total Products"),i()(),o(8,"div",12)(9,"div",15),a(10),i(),o(11,"div",14),a(12,"Counted"),i()(),o(13,"div",12)(14,"div",16),a(15),i(),o(16,"div",14),a(17,"Remaining"),i()(),o(18,"div",12)(19,"div",17),a(20),i(),o(21,"div",14),a(22,"Discrepancies"),i()()(),P(23,"mat-progress-bar",18),o(24,"div",19),a(25),i()()(),o(26,"mat-card",9)(27,"mat-card-content",20)(28,"div",21)(29,"mat-form-field",22)(30,"mat-label"),a(31,"Search products"),i(),o(32,"input",23),R("ngModelChange",function(l){u(t);let d=s();return k(d.searchTerm,l)||(d.searchTerm=l),p(l)}),i(),o(33,"mat-icon",24),a(34,"search"),i()(),o(35,"mat-form-field",22)(36,"mat-label"),a(37,"Filter by status"),i(),o(38,"mat-select",25),R("ngModelChange",function(l){u(t);let d=s();return k(d.statusFilter,l)||(d.statusFilter=l),p(l)}),o(39,"mat-option",26),a(40,"All"),i(),o(41,"mat-option",27),a(42,"Pending"),i(),o(43,"mat-option",28),a(44,"Counted"),i(),o(45,"mat-option",29),a(46,"Approved"),i()()(),o(47,"mat-form-field",22)(48,"mat-label"),a(49,"Show discrepancies only"),i(),o(50,"mat-select",25),R("ngModelChange",function(l){u(t);let d=s();return k(d.discrepancyFilter,l)||(d.discrepancyFilter=l),p(l)}),o(51,"mat-option",26),a(52,"All items"),i(),o(53,"mat-option",30),a(54,"Discrepancies only"),i()()()()()(),o(55,"mat-card")(56,"div",31)(57,"table",32),y(58,33),C(59,qt,2,0,"th",34)(60,Jt,5,2,"td",35),g(),y(61,36),C(62,Xt,2,0,"th",34)(63,Yt,3,1,"td",35),g(),y(64,37),C(65,Zt,2,0,"th",34)(66,te,3,1,"td",35),g(),y(67,38),C(68,ee,2,0,"th",34)(69,ne,3,7,"td",35),g(),y(70,39),C(71,ie,2,0,"th",34)(72,oe,4,12,"td",35),g(),y(73,40),C(74,ae,2,0,"th",34)(75,le,2,1,"td",35),g(),y(76,41),C(77,ce,2,0,"th",34)(78,de,4,5,"td",35),g(),y(79,42),C(80,me,2,0,"th",34)(81,pe,3,2,"td",35),g(),C(82,_e,1,0,"tr",43)(83,Ce,1,0,"tr",44),i()(),f(84,fe,7,0,"div",45),i(),o(85,"div",46)(86,"div",14),a(87),i(),o(88,"div",47)(89,"button",48),S("click",function(){u(t);let l=s();return p(l.saveProgress())}),a(90," Save Progress "),i(),o(91,"button",8),S("click",function(){u(t);let l=s();return p(l.proceedToReview())}),a(92," Review & Complete "),i()()()}if(n&2){let t=s();c(5),b(t.reconciliation().totalProducts),c(5),b(t.reconciliation().countedProducts),c(5),b(t.remainingProducts()),c(5),b(t.reconciliation().discrepancyCount),c(3),_("value",t.progressPercentage()),c(2),T(" ",t.progressPercentage(),"% Complete "),c(7),V("ngModel",t.searchTerm),c(6),V("ngModel",t.statusFilter),c(12),V("ngModel",t.discrepancyFilter),c(7),_("dataSource",t.filteredItems()),c(25),_("matHeaderRowDef",t.displayedColumns),c(),_("matRowDefColumns",t.displayedColumns),c(),x(t.filteredItems().length===0?84:-1),c(3),A(" ",t.reconciliation().countedProducts," of ",t.reconciliation().totalProducts," items counted "),c(2),_("disabled",t.isSaving()),c(2),_("disabled",!t.canProceedToReview())}}function ve(n,e){n&1&&(o(0,"div",7),P(1,"mat-progress-bar",74),i())}var $t=class n{route=I(U);router=I(G);reconciliationService=I(Wt);storeStore=I(vt);authService=I(et);snackBar=I(Z);reconciliation=w(null);isSaving=w(!1);searchTerm=w("");statusFilter=w("");discrepancyFilter=w("");selectedStore=M(()=>this.storeStore.selectedStore());currency=M(()=>this.selectedStore()?.currency||"NGN");currentUser=yt(this.authService.currentUser,{initialValue:null});remainingProducts=M(()=>{let e=this.reconciliation();return e?e.totalProducts-e.countedProducts:0});progressPercentage=M(()=>{let e=this.reconciliation();return e?Math.round(e.countedProducts/e.totalProducts*100):0});filteredItems=M(()=>{let e=this.reconciliation();if(!e)return[];let t=e.items,r=this.searchTerm().toLowerCase();r&&(t=t.filter(m=>m.productName.toLowerCase().includes(r)||m.productSku&&m.productSku.toLowerCase().includes(r)));let l=this.statusFilter();return l&&(t=t.filter(m=>m.status===l)),this.discrepancyFilter()==="true"&&(t=t.filter(m=>m.variance!==0)),t});canProceedToReview=M(()=>{let e=this.reconciliation();return e&&e.countedProducts>0});displayedColumns=["product","systemQuantity","physicalQuantity","variance","varianceValue","reason","status","actions"];ngOnInit(){let e=this.route.snapshot.params.id;this.loadReconciliation(e)}loadReconciliation(e){this.reconciliationService.findOne(e).subscribe({next:t=>{this.reconciliation.set(t)},error:t=>{console.error("Error loading reconciliation:",t),this.snackBar.open("Error loading reconciliation","Close",{duration:3e3})}})}updatePhysicalCount(e,t){let r=parseInt(t.target.value),l=isNaN(r)?void 0:r;e.physicalQuantity=l,e.variance=l!==void 0?l-e.systemQuantity:0,e.varianceValue=e.variance*e.unitCost,this.reconciliation.update(d=>{if(!d)return d;let m=v({},d),B=m.items.findIndex(h=>h._id===e._id);return B!==-1&&(m.items[B]=v({},e)),m.countedProducts=m.items.filter(h=>h.physicalQuantity!==void 0).length,m.discrepancyCount=m.items.filter(h=>h.variance!==0&&h.physicalQuantity!==void 0).length,m.totalVarianceValue=m.items.reduce((h,Ht)=>h+(Ht.varianceValue||0),0),m})}updateReason(e,t){e.reason=t,this.reconciliation.update(r=>{if(!r)return r;let l=v({},r),d=l.items.findIndex(m=>m._id===e._id);return d!==-1&&(l.items[d]=v({},e)),l})}markAsCounted(e){e.physicalQuantity!==void 0&&(e.status="counted",e.countedAt=new Date,e.countedBy=this.currentUser()?._id,this.reconciliation.update(t=>{if(!t)return t;let r=v({},t),l=r.items.findIndex(d=>d._id===e._id);return l!==-1&&(r.items[l]=v({},e)),r}),this.snackBar.open("Item marked as counted","Close",{duration:2e3}))}resetCount(e){e.physicalQuantity=void 0,e.variance=0,e.varianceValue=0,e.reason=void 0,e.reasonNote=void 0,e.status="pending",e.countedAt=void 0,e.countedBy=void 0,this.reconciliation.update(t=>{if(!t)return t;let r=v({},t),l=r.items.findIndex(d=>d._id===e._id);return l!==-1&&(r.items[l]=v({},e)),r.countedProducts=r.items.filter(d=>d.physicalQuantity!==void 0).length,r.discrepancyCount=r.items.filter(d=>d.variance!==0&&d.physicalQuantity!==void 0).length,r.totalVarianceValue=r.items.reduce((d,m)=>d+(m.varianceValue||0),0),r}),this.snackBar.open("Count reset","Close",{duration:2e3})}saveProgress(){let e=this.reconciliation();e&&(this.isSaving.set(!0),this.reconciliationService.update(e._id,e).subscribe({next:t=>{this.reconciliation.set(t),this.isSaving.set(!1),this.snackBar.open("Progress saved successfully","Close",{duration:3e3})},error:t=>{console.error("Error saving progress:",t),this.isSaving.set(!1),this.snackBar.open("Error saving progress","Close",{duration:3e3})}}))}proceedToReview(){this.reconciliation()&&(this.saveProgress(),setTimeout(()=>{this.router.navigate(["../review"],{relativeTo:this.route})},1e3))}getStatusClass(e){switch(e){case"counted":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-blue-100 text-blue-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=Q({type:n,selectors:[["app-count-inventory"]],decls:14,vars:5,consts:[[1,"p-6","max-w-7xl","mx-auto"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-gray-600","mt-1"],[1,"flex","space-x-4"],["mat-button","",1,"text-gray-600",3,"routerLink"],["mat-raised-button","","color","primary",3,"disabled"],[1,"flex","justify-center","items-center","py-12"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"mb-6"],[1,"p-6"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-6"],[1,"text-center"],[1,"text-2xl","font-bold","text-blue-600"],[1,"text-sm","text-gray-600"],[1,"text-2xl","font-bold","text-green-600"],[1,"text-2xl","font-bold","text-orange-600"],[1,"text-2xl","font-bold","text-red-600"],["color","primary",1,"mt-4",3,"value"],[1,"text-center","mt-2","text-sm","text-gray-600"],[1,"p-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["appearance","outline"],["matInput","","placeholder","Product name or SKU",3,"ngModelChange","ngModel"],["matSuffix",""],[3,"ngModelChange","ngModel"],["value",""],["value","pending"],["value","counted"],["value","approved"],["value","true"],[1,"overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","product"],["mat-header-cell","","class","font-semibold",4,"matHeaderCellDef"],["mat-cell","","class","py-4",4,"matCellDef"],["matColumnDef","systemQuantity"],["matColumnDef","physicalQuantity"],["matColumnDef","variance"],["matColumnDef","varianceValue"],["matColumnDef","reason"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"text-center","py-12"],[1,"flex","justify-between","items-center","mt-6"],[1,"space-x-4"],["mat-button","","color","primary",3,"click","disabled"],["mat-header-cell","",1,"font-semibold"],["mat-cell","",1,"py-4"],[1,"font-medium"],[1,"text-sm","text-gray-500"],["appearance","outline",1,"w-32"],["matInput","","type","number","min","0","placeholder","0",3,"input","value"],["appearance","outline",1,"w-40"],["placeholder","Select reason",3,"selectionChange","value"],["value","damage"],["value","theft"],["value","expiry"],["value","supplier_error"],["value","counting_error"],["value","system_error"],["value","other"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"],["mat-icon-button","","color","primary","matTooltip","Mark as counted"],["mat-icon-button","","color","warn","matTooltip","Reset count"],["mat-icon-button","","color","primary","matTooltip","Mark as counted",3,"click"],["mat-icon-button","","color","warn","matTooltip","Reset count",3,"click"],["mat-header-row",""],["mat-row",""],[1,"text-gray-400","text-6xl","mb-4"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"text-gray-500"],["mode","indeterminate",1,"w-64"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),a(4,"Count Inventory"),i(),f(5,Ut,2,1,"p",3),i(),o(6,"div",4)(7,"button",5)(8,"mat-icon"),a(9,"arrow_back"),i(),a(10," Back to List "),i(),f(11,Kt,3,2,"button",6),i()(),f(12,xe,93,17)(13,ve,2,0,"div",7),i()),t&2&&(c(5),x(r.reconciliation()?5:-1),c(2),_("routerLink",L(4,jt)),c(4),x(r.reconciliation()?11:-1),c(),x(r.reconciliation()?12:13))},dependencies:[j,$,H,rt,nt,it,at,ot,dt,lt,ct,Y,X,J,xt,ft,pt,ut,mt,st,Ct,_t,Lt,At,z,Qt,Mt,Tt,Rt,Pt,wt,Dt,Vt,kt,Ft,Bt,ht,gt,Et,tt,It,Nt,Ot,bt,St,q,K],styles:[".mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.mat-mdc-table[_ngcontent-%COMP%]{background:transparent}.mat-mdc-row[_ngcontent-%COMP%]:hover{background-color:#00000005}"]})};export{$t as CountInventoryComponent};
