import{a as Me,b as he}from"./chunk-5PRTBKPY.js";import{a as q}from"./chunk-K22N4AM6.js";import{a as rt,b as ue,c as fe}from"./chunk-4QH7IS4X.js";import{a as Se}from"./chunk-TGXE4NSP.js";import{a as ve}from"./chunk-5IXGVCA6.js";import{a as dt,b as st}from"./chunk-PP3XBKNF.js";import{a as at,b as lt,c as _e,e as mt,f as ge,g as Ce,h as pt}from"./chunk-7AEPEFCD.js";import{a as ce}from"./chunk-4KYCCNTD.js";import{a as nt,b as se}from"./chunk-4NJZV7OK.js";import"./chunk-XCRB4NGT.js";import"./chunk-P5H3RIJ7.js";import{a as Zt,b as te,c as ee,d as ie,e as oe,f as ne,g as re,h as ae,i as le,j as me,k as pe,l as de}from"./chunk-4UI7GXCU.js";import"./chunk-W6MIZINO.js";import"./chunk-JN5X2IYW.js";import"./chunk-DSVTILZD.js";import"./chunk-IW6IJ3IN.js";import{a as zt,b as Qt,c as Wt,d as Ut}from"./chunk-62CZFSKL.js";import{i as y}from"./chunk-I4XKOMFF.js";import{a as Yt,b as it}from"./chunk-T3N63WKP.js";import{d as Bt,g as At}from"./chunk-WAEUNFFU.js";import{d as ot}from"./chunk-34VGG7JE.js";import"./chunk-JOC3JCWJ.js";import"./chunk-AXVKE7YV.js";import"./chunk-UDXHODBD.js";import"./chunk-XBTGTIDL.js";import{b as I,c as w,d as P}from"./chunk-3JUXLSAM.js";import{a as F,b as et,d as Xt,h as O}from"./chunk-TKNXELSU.js";import"./chunk-JT5P23LW.js";import{a as k,b as N}from"./chunk-4CSV6WDD.js";import{A as Kt,B as tt,b as T,d as g,g as D,h as W,l as Jt,m as U,n as J,s as K,t as X,v as Y,z as Z}from"./chunk-APGJ2ZCU.js";import"./chunk-KLDQLPSD.js";import{a as z}from"./chunk-6XJLFJNL.js";import"./chunk-R35DVJIH.js";import"./chunk-BFT2MTJY.js";import{a as Lt,c as jt,h as $t}from"./chunk-SV3V3KFF.js";import"./chunk-FTUKKUPK.js";import"./chunk-J6S3CU5H.js";import"./chunk-SBJI2VOL.js";import{b as Ht,c as Q}from"./chunk-A5WKFY2Q.js";import{Y as Gt,Z as x,aa as E}from"./chunk-PD333HOR.js";import{q as Vt,s as $}from"./chunk-T7PMTSVA.js";import{$b as C,Ec as Nt,Fc as Ct,Hb as s,Ib as c,Kc as qt,Lb as Ft,Mb as Ot,Mc as Rt,Nb as d,Ob as o,Pb as i,Qb as f,Ub as A,Vb as G,X as Dt,Xb as ut,ab as l,bc as S,ea as u,fc as ft,gc as _t,hc as gt,ja as V,jb as j,ka as B,lc as It,pb as M,qc as a,rc as b,sc as v,va as L,vb as h,vc as wt,wc as Pt,xc as kt}from"./chunk-ZCSDIQ3M.js";import{a as yt,b as Tt}from"./chunk-GAL4ENT6.js";function Pe(t,e){t&1&&(o(0,"mat-error"),a(1," Name is required "),i())}function ke(t,e){t&1&&(o(0,"mat-error"),a(1," Price is required "),i())}function Ne(t,e){t&1&&(o(0,"mat-error"),a(1," Price must be 0 or greater "),i())}function qe(t,e){t&1&&f(0,"mat-spinner",12)}var H=class t{constructor(e,n,r){this.fb=e;this.dialogRef=n;this.data=r;this.optionForm=this.fb.group({name:["",g.required],price:[0,[g.required,g.min(0)]],inStock:[!0],store:[this.storeStore.selectedStore()?._id,g.required]}),r.isEdit&&r.option&&this.optionForm.patchValue(r.option)}productService=u(q);storeStore=u(y);snackBar=u(z);isSubmitting=L(!1);optionForm;onSubmit(){if(this.optionForm.valid){this.isSubmitting.set(!0);let e=this.optionForm.getRawValue();(this.data.isEdit?this.productService.updateOption(e,this.data.option._id):this.productService.saveOption(e)).subscribe({next:()=>{this.snackBar.open(`Option ${this.data.isEdit?"updated":"created"} successfully`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dialogRef.close(!0)},error:()=>{this.snackBar.open(`Error ${this.data.isEdit?"updating":"creating"} option`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isSubmitting.set(!1)}})}}onCancel(){this.dialogRef.close()}static \u0275fac=function(n){return new(n||t)(j(Z),j(at),j(lt))};static \u0275cmp=M({type:t,selectors:[["app-option-dialog"]],decls:25,vars:8,consts:[[1,"p-6"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter option name"],["matInput","","type","number","formControlName","price","min","0"],[1,"flex","items-center","p-4","bg-gray-50","rounded-lg"],["formControlName","inStock","color","primary"],[1,"flex","justify-end","space-x-2","mt-6","pt-4","border-t","border-gray-200"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",1,"mr-2"]],template:function(n,r){if(n&1&&(o(0,"div",0)(1,"h2",1),a(2),i(),o(3,"form",2),C("ngSubmit",function(){return r.onSubmit()}),o(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),a(7,"Name"),i(),f(8,"input",5),s(9,Pe,2,0,"mat-error"),i(),o(10,"mat-form-field",4)(11,"mat-label"),a(12,"Price"),i(),f(13,"input",6),s(14,ke,2,0,"mat-error"),s(15,Ne,2,0,"mat-error"),i(),o(16,"div",7)(17,"mat-slide-toggle",8),a(18," In Stock "),i()()(),o(19,"div",9)(20,"button",10),C("click",function(){return r.onCancel()}),a(21,"Cancel"),i(),o(22,"button",11),s(23,qe,1,0,"mat-spinner",12),a(24),i()()()()),n&2){let m,p,R;l(2),v(" ",r.data.isEdit?"Edit Option":"Create New Option"," "),l(),d("formGroup",r.optionForm),l(6),c((m=r.optionForm.get("name"))!=null&&m.hasError("required")?9:-1),l(5),c((p=r.optionForm.get("price"))!=null&&p.hasError("required")?14:-1),l(),c((R=r.optionForm.get("price"))!=null&&R.hasError("min")?15:-1),l(7),d("disabled",!r.optionForm.valid||r.isSubmitting()),l(),c(r.isSubmitting()?23:-1),l(),v(" ",r.data.isEdit?"Update":"Create"," ")}},dependencies:[pt,mt,I,O,F,et,P,w,E,x,it,Q,tt,U,T,J,D,W,Y,X,K,N,k,st,dt],encapsulation:2})};var Fe=t=>({prefix:t}),Re=(t,e)=>e._id;function Ve(t,e){t&1&&(o(0,"div",1),f(1,"mat-spinner",7),i())}function Be(t,e){t&1&&(o(0,"div",2),a(1," Error loading menus. Please try again. "),i())}function Ae(t,e){if(t&1&&(o(0,"mat-option",16),a(1),i()),t&2){let n=e.$implicit;d("value",n._id),l(),b(n.name)}}function Ge(t,e){if(t&1&&Ft(0,Ae,2,2,"mat-option",16,Re),t&2){let n=S(2);Ot(n.menus.value())}}function He(t,e){t&1&&(o(0,"mat-error"),a(1,"Please select a menu"),i())}function Le(t,e){t&1&&(o(0,"mat-error"),a(1,"Cost price is required"),i())}function je(t,e){t&1&&(o(0,"mat-error"),a(1,"Cost price must be 0 or greater"),i())}function $e(t,e){t&1&&(o(0,"mat-error"),a(1,"Selling price is required"),i())}function ze(t,e){t&1&&(o(0,"mat-error"),a(1,"Selling price must be 0 or greater"),i())}function Qe(t,e){t&1&&(o(0,"mat-error"),a(1,"Quantity is required"),i())}function We(t,e){t&1&&(o(0,"mat-error"),a(1,"Quantity must be at least 1"),i())}function Ue(t,e){t&1&&(o(0,"mat-error"),a(1,"Status is required"),i())}function Je(t,e){if(t&1&&(o(0,"form",3)(1,"mat-form-field",8)(2,"mat-label"),a(3,"Menu"),i(),o(4,"mat-select",9),s(5,Ge,2,0),i(),s(6,He,2,0,"mat-error"),i(),o(7,"div",10)(8,"mat-form-field",8)(9,"mat-label"),a(10,"Cost Price"),i(),o(11,"span",11),a(12),i(),f(13,"input",12),s(14,Le,2,0,"mat-error"),s(15,je,2,0,"mat-error"),i(),o(16,"mat-form-field",8)(17,"mat-label"),a(18,"Selling Price"),i(),o(19,"span",11),a(20),i(),f(21,"input",13),s(22,$e,2,0,"mat-error"),s(23,ze,2,0,"mat-error"),i()(),o(24,"div",10)(25,"mat-form-field",8)(26,"mat-label"),a(27,"Quantity"),i(),f(28,"input",14),s(29,Qe,2,0,"mat-error"),s(30,We,2,0,"mat-error"),i(),o(31,"mat-form-field",8)(32,"mat-label"),a(33,"Status"),i(),o(34,"mat-select",15)(35,"mat-option",16),a(36,"Active"),i(),o(37,"mat-option",16),a(38,"Inactive"),i()(),s(39,Ue,2,0,"mat-error"),i()()()),t&2){let n,r,m,p,R,St,vt,Mt,ht,bt,xt,Et,_=S();d("formGroup",_.form),l(5),c(_.menus.hasValue()&&_.menus.value()?5:-1),l(),c((n=_.form.get("menuId"))!=null&&n.hasError("required")?6:-1),l(6),v("",(r=_.storeStore.selectedStore())==null?null:r.currency,"\xA0"),l(),d("options",Ct(16,Fe,(m=_.storeStore.selectedStore())==null?null:m.currency)),l(),c((p=_.form.get("costPrice"))!=null&&p.hasError("required")?14:-1),l(),c((R=_.form.get("costPrice"))!=null&&R.hasError("min")?15:-1),l(5),v("",(St=_.storeStore.selectedStore())==null?null:St.currency,"\xA0"),l(),d("options",Ct(18,Fe,(vt=_.storeStore.selectedStore())==null?null:vt.currency)),l(),c((Mt=_.form.get("sellingPrice"))!=null&&Mt.hasError("required")?22:-1),l(),c((ht=_.form.get("sellingPrice"))!=null&&ht.hasError("min")?23:-1),l(6),c((bt=_.form.get("quantity"))!=null&&bt.hasError("required")?29:-1),l(),c((xt=_.form.get("quantity"))!=null&&xt.hasError("min")?30:-1),l(5),d("value",!0),l(2),d("value",!1),l(2),c((Et=_.form.get("active"))!=null&&Et.hasError("required")?39:-1)}}var ct=class t{dialogRef=u(at);categoryService=u(ve);productService=u(q);storeStore=u(y);fb=u(Z);data=u(lt);loading=L(!1);form;menus=ot({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.categoryService.getStoreMenus(e.storeId)});ngOnInit(){this.initializeForm()}initializeForm(){this.form=this.fb.group({menuId:["",g.required],productName:[this.data.option.name,g.required],sellingPrice:[this.data.option.price,[g.required,g.min(0)]],costPrice:[0,[g.required,g.min(0)]],quantity:[this.data.option.quantity||1,[g.required,g.min(1)]],active:[!0,g.required]})}onSubmit(){if(this.form.invalid)return;this.loading.set(!0);let e=this.storeStore.selectedStore()?._id,n=parseFloat(this.form.get("sellingPrice")?.value)||0,r=parseFloat(this.form.get("costPrice")?.value)||0,m={name:this.form.get("productName")?.value,price:n,costPrice:r,quantity:this.form.get("quantity")?.value,menu:this.form.get("menuId")?.value,store:e,active:this.form.get("active")?.value,profit:n-r,initialStock:0,criticalStockLevel:0,qty:this.form.get("quantity")?.value};this.productService.convertOptionToFood(m).subscribe({next:()=>{this.loading.set(!1),this.dialogRef.close(!0)},error:p=>{this.loading.set(!1),console.error("Error converting option to food:",p)}})}onCancel(){this.dialogRef.close(!1)}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=M({type:t,selectors:[["app-convert-to-food-dialog"]],decls:11,vars:5,consts:[["mat-dialog-title","",1,"mb-4"],[1,"flex","items-center","justify-center","py-8"],[1,"text-red-600","p-4","bg-red-50","rounded"],[1,"space-y-4",3,"formGroup"],["align","end",1,"mt-6","pt-4","border-t"],["mat-button","",3,"click","disabled"],["matButton","filled","color","primary",3,"click","disabled"],["diameter","40"],["appearance","outline",1,"w-full"],["formControlName","menuId"],[1,"grid","grid-cols-2","gap-4"],["matPrefix",""],["matInput","","currencyMask","","step","0.01","formControlName","costPrice",3,"options"],["matInput","","currencyMask","","step","0.01","formControlName","sellingPrice",3,"options"],["matInput","","type","number","min","1","step","1","formControlName","quantity"],["formControlName","active"],[3,"value"]],template:function(n,r){n&1&&(o(0,"h2",0),a(1),i(),o(2,"mat-dialog-content"),s(3,Ve,2,0,"div",1)(4,Be,2,0,"div",2)(5,Je,40,20,"form",3),i(),o(6,"mat-dialog-actions",4)(7,"button",5),C("click",function(){return r.onCancel()}),a(8," Cancel "),i(),o(9,"button",6),C("click",function(){return r.onSubmit()}),a(10),i()()),n&2&&(l(),b(r.data.option.name),l(2),c(r.menus.isLoading()?3:r.menus.error()?4:5),l(4),d("disabled",r.loading()),l(2),d("disabled",r.form.invalid||r.loading()),l(),v(" ",r.loading()?"Converting...":"Convert"," "))},dependencies:[$,tt,U,T,J,D,W,Y,X,K,pt,mt,Ce,ge,I,O,F,et,Xt,it,Yt,Bt,At,E,x,N,k,P,w,he,Me],encapsulation:2})};var Ke=()=>[5,10,25,100];function Xe(t,e){t&1&&(o(0,"div",9),f(1,"mat-spinner",13),i())}function Ye(t,e){t&1&&f(0,"app-no-record",10)}function Ze(t,e){t&1&&f(0,"app-no-record",11)}function ti(t,e){t&1&&(o(0,"th",26),a(1,"Name"),i())}function ei(t,e){if(t&1&&(o(0,"td",27),a(1),i()),t&2){let n=e.$implicit;l(),b(n.name)}}function ii(t,e){t&1&&(o(0,"th",26),a(1,"Price"),i())}function oi(t,e){if(t&1&&(o(0,"td",27),a(1),qt(2,"currency"),i()),t&2){let n,r=e.$implicit,m=S(2);l(),b(Rt(2,1,r.price,(n=m.storeStore.selectedStore())==null?null:n.currency))}}function ni(t,e){t&1&&(o(0,"th",28),a(1,"In Stock"),i())}function ri(t,e){if(t&1){let n=ut();o(0,"td",27)(1,"mat-slide-toggle",29),C("change",function(){let m=V(n).$implicit,p=S(2);return B(p.toggleInStock(m))}),i()()}if(t&2){let n=e.$implicit;l(),d("checked",n.inStock)}}function ai(t,e){t&1&&(o(0,"th",30),a(1,"Actions"),i())}function li(t,e){if(t&1){let n=ut();o(0,"td",27)(1,"button",31)(2,"mat-icon"),a(3,"more_vert"),i()(),o(4,"mat-menu",null,0)(6,"button",32),C("click",function(){let m=V(n).$implicit,p=S(2);return B(p.editOption(m))}),o(7,"mat-icon"),a(8,"edit"),i(),o(9,"span"),a(10,"Edit"),i()(),o(11,"button",32),C("click",function(){let m=V(n).$implicit,p=S(2);return B(p.convertToFood(m))}),o(12,"mat-icon"),a(13,"fastfood"),i(),o(14,"span"),a(15,"Convert to Product"),i()(),o(16,"button",32),C("click",function(){let m=V(n).$implicit,p=S(2);return B(p.deleteOption(m))}),o(17,"mat-icon"),a(18,"delete"),i(),o(19,"span"),a(20,"Delete"),i()()()()}if(t&2){let n=It(5);l(),d("matMenuTriggerFor",n)}}function mi(t,e){t&1&&f(0,"tr",33)}function pi(t,e){t&1&&f(0,"tr",34)}function di(t,e){if(t&1&&(o(0,"div",12)(1,"table",14),A(2,15),h(3,ti,2,0,"th",16)(4,ei,2,1,"td",17),G(),A(5,18),h(6,ii,2,0,"th",16)(7,oi,3,4,"td",17),G(),A(8,19),h(9,ni,2,0,"th",20)(10,ri,2,1,"td",17),G(),A(11,21),h(12,ai,2,0,"th",22)(13,li,21,1,"td",17),G(),h(14,mi,1,0,"tr",23)(15,pi,1,0,"tr",24),i(),f(16,"mat-paginator",25),i()),t&2){let n=S();l(),d("dataSource",n.dataSource),l(13),d("matHeaderRowDef",n.displayedColumns),l(),d("matRowDefColumns",n.displayedColumns),l(),d("pageSizeOptions",Nt(4,Ke))}}var Oe=class t{displayedColumns=["name","price","inStock","actions"];dataSource;searchText="";dialog=u(_e);productService=u(q);storeStore=u(y);snackBar=u(z);paginator;sort;options=ot({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.productService.getStoreOptions(e.storeId).pipe(Dt(n=>{this.dataSource=new de(n),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}))});applyFilter(e){let n=e.target.value;this.dataSource.filter=n.trim().toLowerCase()}openDialog(){this.dialog.open(H,{width:"500px",data:{isEdit:!1}}).afterClosed().subscribe(n=>{n&&this.options.reload()})}editOption(e){this.dialog.open(H,{width:"500px",data:{isEdit:!0,option:e}}).afterClosed().subscribe(r=>{r&&this.options.reload()})}convertToFood(e){this.dialog.open(ct,{width:"500px",data:{option:e}}).afterClosed().subscribe(r=>{r&&(this.snackBar.open("Option converted to product successfully!","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.options.reload())})}deleteOption(e){this.dialog.open(Se,{width:"350px",data:{message:`Are you sure you want to delete ${e.name}?`}}).afterClosed().subscribe(r=>{r&&this.productService.deleteOptionItem(e._id).subscribe({next:()=>{this.options.reload()}})})}toggleInStock(e){let n=Tt(yt({},e),{inStock:!e.inStock});this.productService.updateOption(n,e._id).subscribe({next:()=>{this.snackBar.open("Option status updated successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.options.reload()},error:()=>{this.snackBar.open("Error updating option status","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=M({type:t,selectors:[["app-options"]],viewQuery:function(n,r){if(n&1&&(ft(nt,5),ft(rt,5)),n&2){let m;_t(m=gt())&&(r.paginator=m.first),_t(m=gt())&&(r.sort=m.first)}},decls:17,vars:2,consts:[["menu","matMenu"],[1,"options-container","!bg-white"],[1,"!bg-white"],[1,"flex","items-center","space-x-4","p-4"],[1,"w-80"],["appearance","outline",1,"w-full"],["matInput","","placeholder","Search options",3,"keyup","ngModelChange","ngModel"],[1,"flex-shrink-0","ml-auto"],["mat-raised-button","","color","primary",1,"h-[48px]","px-6","font-medium",3,"click"],[1,"flex","items-center","justify-center","min-h-[300px]"],["icon","error","title","Error","message","An error occurred while fetching options. Please try again later."],["icon","list","title","No Options","message","No options found matching your criteria."],[1,"table-container","!bg-white"],["diameter","40"],["mat-table","","matSort","",1,"!bg-white",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","price"],["matColumnDef","inStock"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","w-20",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of options",1,"!bg-white",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["color","primary",3,"change","checked"],["mat-header-cell","",1,"w-20"],["mat-icon-button","","aria-label","Option actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(n,r){n&1&&(o(0,"mat-card",1)(1,"mat-card-content",2)(2,"div",3)(3,"div",4)(4,"mat-form-field",5)(5,"mat-label"),a(6,"Search"),i(),o(7,"input",6),C("keyup",function(p){return r.applyFilter(p)}),kt("ngModelChange",function(p){return Pt(r.searchText,p)||(r.searchText=p),p}),i()()(),o(8,"div",7)(9,"button",8),C("click",function(){return r.openDialog()}),o(10,"mat-icon"),a(11,"add"),i(),a(12," ADD OPTION "),i()()(),s(13,Xe,2,0,"div",9)(14,Ye,1,0,"app-no-record",10)(15,Ze,1,0,"app-no-record",11)(16,di,17,5,"div",12),i()()),n&2&&(l(7),wt("ngModel",r.searchText),l(6),c(r.options.isLoading()?13:r.options.error()?14:r.options.hasValue()&&r.dataSource.data.length===0?15:r.options.hasValue()?16:-1))},dependencies:[$,pe,Zt,ee,re,ie,te,ae,oe,ne,le,me,se,nt,fe,rt,ue,$t,Lt,jt,I,O,F,P,w,E,x,Gt,Q,Ht,Ut,Qt,zt,Wt,N,k,ce,Kt,T,D,Jt,st,dt,Vt],encapsulation:2})};export{Oe as OptionsComponent};
