import{a as be}from"./chunk-43WQ3HDT.js";import{a as Se,b as Ce}from"./chunk-4OM7C35U.js";import"./chunk-3RK6DDJD.js";import{a as fe,b as he}from"./chunk-57GZGP3R.js";import"./chunk-JQGESV5S.js";import{b as le,c as me,d as se}from"./chunk-AQ3KQLE6.js";import{a as V,b as G}from"./chunk-4WFQ5GOX.js";import{c as ce}from"./chunk-NGGCDKIH.js";import{a as re,b as ne,e as oe,h as ae}from"./chunk-QMUPRLKR.js";import{B as J,D as K,b as U,d as h,g as z,h as L,m as O,n as $,p as j,q as R,s as H,x as W}from"./chunk-CXVWFC6J.js";import"./chunk-JTLCVARK.js";import{a as Q,b as X,c as Y,d as Z,e as ee,f as te,g as ie}from"./chunk-UOL4Y3DN.js";import{a as pe,b as de}from"./chunk-MCIFQNRK.js";import{a as q}from"./chunk-COYOKZWK.js";import"./chunk-OHZSVTBE.js";import{a as ue}from"./chunk-P7SQXTVL.js";import"./chunk-IKGBOHBU.js";import"./chunk-SIHSJGX2.js";import{X as D,Y as w}from"./chunk-BPRDVRQX.js";import"./chunk-KP7TGH7C.js";import"./chunk-M2YK6UF7.js";import"./chunk-AGZJ637K.js";import{a as A,c as B}from"./chunk-WTFDJO4H.js";import"./chunk-TQDHD3WD.js";import{k as P,t as T}from"./chunk-DWCYWQVU.js";import{Db as E,Eb as x,Jb as d,Kb as t,Lb as e,Mb as l,Qb as k,Ub as C,Vb as c,_a as m,fa as p,ic as i,jc as g,kb as N,kc as f,la as M,ma as F,qb as b,va as S}from"./chunk-5AECHVKR.js";import{a as I,b as y}from"./chunk-EQDQRRRY.js";function xe(a,n){if(a&1&&(t(0,"div",1)(1,"div",33)(2,"mat-icon",34),i(3,"error"),e(),t(4,"p",35),i(5),e()()()),a&2){let r=c();m(5),g(r.error())}}function ge(a,n){a&1&&(t(0,"mat-error"),i(1," Supplier name is required "),e())}function ve(a,n){a&1&&(t(0,"mat-error"),i(1," Supplier name must be at least 2 characters "),e())}function _e(a,n){a&1&&(t(0,"mat-error"),i(1," Email is required "),e())}function Ie(a,n){a&1&&(t(0,"mat-error"),i(1," Please enter a valid email address "),e())}function ye(a,n){if(a&1&&(t(0,"button",31),l(1,"mat-spinner",36),i(2),e()),a&2){let r=c();m(2),f(" ",r.isEditMode()?"Updating...":"Creating..."," ")}}function Me(a,n){if(a&1){let r=k();t(0,"button",37),C("click",function(){M(r);let s=c();return F(s.onSubmit())}),t(1,"mat-icon"),i(2),e(),i(3),e()}if(a&2){let r=c();d("disabled",r.supplierForm.invalid),m(2),g(r.isEditMode()?"save":"add"),m(),f(" ",r.isEditMode()?"Update Supplier":"Create Supplier"," ")}}var Ee=class a{fb=p(J);suppliersService=p(be);router=p(B);route=p(A);snackBar=p(V);storeStore=p(ue);authService=p(q);currentUser=ce(this.authService.currentUser,{initialValue:null});supplierForm;loading=S(!1);error=S(null);isEditMode=S(!1);supplierId=null;constructor(){this.initializeForm()}ngOnInit(){this.supplierId=this.route.snapshot.paramMap.get("id"),this.supplierId&&(this.isEditMode.set(!0),this.loadSupplier())}initializeForm(){this.supplierForm=this.fb.group({name:["",[h.required,h.minLength(2)]],contactPerson:[""],email:["",[h.required,h.email]],phone:[""],website:[""],description:[""],taxId:[""],paymentTerms:[""],creditLimit:[null],active:[!0],notes:[""],address:this.fb.group({street:[""],city:[""],state:[""],country:[""],postalCode:[""]})})}loadSupplier(){if(!this.supplierId)return;let n=this.storeStore.selectedStore()?._id;n&&(this.loading.set(!0),this.suppliersService.getSupplier(this.supplierId,n).subscribe({next:r=>{this.supplierForm.patchValue(r),this.loading.set(!1)},error:r=>{this.error.set("Failed to load supplier details"),this.loading.set(!1),console.error("Error loading supplier:",r)}}))}onSubmit(){if(this.supplierForm.invalid){this.markAllFieldsAsTouched();return}let n=this.storeStore.selectedStore()?._id,r=this.currentUser();if(!n||!r){this.error.set("Store or user information not available");return}this.loading.set(!0),this.error.set(null);let o=this.supplierForm.value;if(this.isEditMode()&&this.supplierId){let s=o;this.suppliersService.updateSupplier(this.supplierId,s,n).subscribe({next:()=>{this.snackBar.open("Supplier updated successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.router.navigate(["/menu/erp/inventory/suppliers"])},error:u=>{this.error.set("Failed to update supplier"),this.loading.set(!1),this.snackBar.open("Failed to update supplier","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),console.error("Error updating supplier:",u)}})}else{let s=y(I({},o),{store:n,createdBy:r._id});this.suppliersService.createSupplier(s).subscribe({next:()=>{this.snackBar.open("Supplier created successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.router.navigate(["/menu/erp/inventory/suppliers"])},error:u=>{this.error.set("Failed to create supplier"),this.loading.set(!1),this.snackBar.open("Failed to create supplier","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),console.error("Error creating supplier:",u)}})}}onCancel(){this.router.navigate(["/menu/erp/inventory/suppliers"])}markAllFieldsAsTouched(){Object.keys(this.supplierForm.controls).forEach(n=>{let r=this.supplierForm.get(n);if(r?.markAsTouched(),r&&r.value&&typeof r.value=="object"){let o=r;Object.keys(o.controls).forEach(s=>{o.get(s)?.markAsTouched()})}})}isFieldInvalid(n){let r=this.supplierForm.get(n);return r?r.invalid&&r.touched:!1}isNestedFieldInvalid(n,r){let o=this.supplierForm.get(`${n}.${r}`);return o?o.invalid&&o.touched:!1}getFieldError(n){let r=this.supplierForm.get(n);if(r?.errors&&r.touched){if(r.errors.required)return`${n} is required`;if(r.errors.email)return"Please enter a valid email address";if(r.errors.minlength)return`${n} must be at least ${r.errors.minlength.requiredLength} characters`}return""}static \u0275fac=function(r){return new(r||a)};static \u0275cmp=N({type:a,selectors:[["app-create-suppliers"]],decls:114,vars:10,consts:[[1,"max-w-4xl","mx-auto"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","mb-6"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"mb-8"],[1,"text-lg","font-semibold","text-gray-900","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["appearance","outline",1,"md:col-span-2"],["matInput","","formControlName","name","placeholder","Enter supplier name"],["matSuffix",""],[4,"ngIf"],["appearance","outline"],["matInput","","formControlName","contactPerson","placeholder","Enter contact person name"],["matInput","","type","email","formControlName","email","placeholder","Enter email address"],["matInput","","type","tel","formControlName","phone","placeholder","Enter phone number"],["matInput","","type","url","formControlName","website","placeholder","https://example.com"],["matInput","","formControlName","description","rows","3","placeholder","Enter supplier description"],["formGroupName","address",1,"mb-8"],["matInput","","formControlName","street","placeholder","Enter street address"],["matInput","","formControlName","city","placeholder","Enter city"],["matInput","","formControlName","state","placeholder","Enter state or province"],["matInput","","formControlName","country","placeholder","Enter country"],["matInput","","formControlName","postalCode","placeholder","Enter postal code"],["matInput","","formControlName","taxId","placeholder","Enter tax identification number"],["matInput","","formControlName","paymentTerms","placeholder","e.g., Net 30 days"],["matInput","","type","number","formControlName","creditLimit","placeholder","Enter credit limit amount","min","0","step","0.01"],[1,"flex","items-center","mt-4"],["formControlName","active"],["appearance","outline",1,"w-full"],["matInput","","formControlName","notes","rows","4","placeholder","Enter any additional notes about this supplier"],["align","end"],["mat-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","disabled",""],["mat-raised-button","","color","primary",3,"disabled"],[1,"flex"],[1,"text-red-400","mr-2"],[1,"text-sm","text-red-800"],["diameter","20"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(r,o){if(r&1&&(t(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),i(3),e(),t(4,"mat-card-subtitle"),i(5),e()(),t(6,"mat-card-content"),E(7,xe,6,1,"div",1),t(8,"form",2),C("ngSubmit",function(){return o.onSubmit()}),t(9,"div",3)(10,"h3",4),i(11,"Basic Information"),e(),t(12,"div",5)(13,"mat-form-field",6)(14,"mat-label"),i(15,"Supplier Name *"),e(),l(16,"input",7),t(17,"mat-icon",8),i(18,"business"),e(),b(19,ge,2,0,"mat-error",9)(20,ve,2,0,"mat-error",9),e(),t(21,"mat-form-field",10)(22,"mat-label"),i(23,"Contact Person"),e(),l(24,"input",11),t(25,"mat-icon",8),i(26,"person"),e()(),t(27,"mat-form-field",10)(28,"mat-label"),i(29,"Email Address *"),e(),l(30,"input",12),t(31,"mat-icon",8),i(32,"email"),e(),b(33,_e,2,0,"mat-error",9)(34,Ie,2,0,"mat-error",9),e(),t(35,"mat-form-field",10)(36,"mat-label"),i(37,"Phone Number"),e(),l(38,"input",13),t(39,"mat-icon",8),i(40,"phone"),e()(),t(41,"mat-form-field",10)(42,"mat-label"),i(43,"Website"),e(),l(44,"input",14),t(45,"mat-icon",8),i(46,"language"),e()(),t(47,"mat-form-field",6)(48,"mat-label"),i(49,"Description"),e(),l(50,"textarea",15),e()()(),t(51,"div",16)(52,"h3",4),i(53,"Address Information"),e(),t(54,"div",5)(55,"mat-form-field",6)(56,"mat-label"),i(57,"Street Address"),e(),l(58,"input",17),t(59,"mat-icon",8),i(60,"location_on"),e()(),t(61,"mat-form-field",10)(62,"mat-label"),i(63,"City"),e(),l(64,"input",18),e(),t(65,"mat-form-field",10)(66,"mat-label"),i(67,"State/Province"),e(),l(68,"input",19),e(),t(69,"mat-form-field",10)(70,"mat-label"),i(71,"Country"),e(),l(72,"input",20),e(),t(73,"mat-form-field",10)(74,"mat-label"),i(75,"Postal Code"),e(),l(76,"input",21),e()()(),t(77,"div",3)(78,"h3",4),i(79,"Business Information"),e(),t(80,"div",5)(81,"mat-form-field",10)(82,"mat-label"),i(83,"Tax ID"),e(),l(84,"input",22),t(85,"mat-icon",8),i(86,"receipt"),e()(),t(87,"mat-form-field",10)(88,"mat-label"),i(89,"Payment Terms"),e(),l(90,"input",23),t(91,"mat-icon",8),i(92,"payment"),e()(),t(93,"mat-form-field",10)(94,"mat-label"),i(95,"Credit Limit"),e(),l(96,"input",24),t(97,"mat-icon",8),i(98,"attach_money"),e()(),t(99,"div",25)(100,"mat-checkbox",26),i(101,"Active Supplier"),e()()()(),t(102,"div",3)(103,"h3",4),i(104,"Additional Notes"),e(),t(105,"mat-form-field",27)(106,"mat-label"),i(107,"Notes"),e(),l(108,"textarea",28),e()()()(),t(109,"mat-card-actions",29)(110,"button",30),C("click",function(){return o.onCancel()}),i(111," Cancel "),e(),E(112,ye,3,1,"button",31)(113,Me,4,3,"button",32),e()()),r&2){let s,u,v,_;m(3),f(" ",o.isEditMode()?"Edit Supplier":"Add New Supplier"," "),m(2),f(" ",o.isEditMode()?"Update supplier information":"Create a new supplier for your store"," "),m(2),x(o.error()?7:-1),m(),d("formGroup",o.supplierForm),m(11),d("ngIf",(s=o.supplierForm.get("name"))==null?null:s.hasError("required")),m(),d("ngIf",(u=o.supplierForm.get("name"))==null?null:u.hasError("minlength")),m(13),d("ngIf",(v=o.supplierForm.get("email"))==null?null:v.hasError("required")),m(),d("ngIf",(_=o.supplierForm.get("email"))==null?null:_.hasError("email")),m(76),d("disabled",o.loading()),m(2),x(o.loading()?112:113)}},dependencies:[T,P,K,O,U,$,z,L,W,j,H,R,ie,Q,ee,Y,te,Z,X,le,ae,re,ne,oe,se,me,w,D,de,pe,Ce,Se,he,fe,G],styles:["[_nghost-%COMP%]{display:block}"]})};export{Ee as CreateSuppliersComponent};
