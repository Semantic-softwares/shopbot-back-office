<div class="p-4  min-h-screen">
  <!-- Progress Bar -->
  @if (isDeleting()) {
    <mat-progress-bar mode="indeterminate" color="warn"></mat-progress-bar>
  }
  
  <!-- Header Section -->
 
  <app-page-header title="Receipts Reports" subtitle="View and manage all receipts">
    <ng-container actions>
      <date-range-selector />
      <app-employee-selector />
      <button matButton  (click)="dataSource.reload()">
          <mat-icon class="mr-2">refresh</mat-icon>
          Refresh
      </button>
      @if (selection.selected.length > 0) {
        <button matButton color="warn" (click)="deleteMultiple()" [disabled]="isDeleting()">
          <mat-icon class="mr-2">delete</mat-icon>
          Delete ({{selection.selected.length}})
        </button>
      }
        <button matButton="filled" color="primary" [matMenuTriggerFor]="exportMenu">
          <mat-icon class="mr-2">file_download</mat-icon>
          Export Data
        </button>
        <mat-menu #exportMenu="matMenu">
          <button mat-menu-item (click)="exportData('pdf')">
            <mat-icon>picture_as_pdf</mat-icon>
            <span>Export as PDF</span>
          </button>
          <button mat-menu-item (click)="exportData('csv')">
            <mat-icon>description</mat-icon>
            <span>Export as CSV</span>
          </button>
          <button mat-menu-item (click)="exportData('excel')">
            <mat-icon>table_chart</mat-icon>
            <span>Export as Excel</span>
          </button>
        </mat-menu>
    </ng-container> 
  </app-page-header>

  <mat-card class="py-4" appearance="outlined">
    <!-- Tabs Section -->
    @if (dataSource.hasValue()) {
    <nav mat-tab-nav-bar class="grid grid-cols-3" [tabPanel]="tabPanel">
      @for (tab of tabStats ; track tab.value) {
      <a mat-tab-link (click)="onTabChange(tab.value)" [active]="activeTab === tab.value"
        class="!h-auto !min-h-[100px] !px-4 !py-4 border-b">
        <div class="text-center">
          <h3 class="text-gray-600 font-medium mb-1">{{tab.label}}</h3>
          <p class="text-2xl font-semibold">{{tab.count}}</p>
        </div>
      </a>
      }
    </nav>
    <mat-tab-nav-panel #tabPanel>
      <div class="p-6">
        <div class="table-container">
          <table mat-table [dataSource]="orders()" matSort class=" w-full">
            <ng-container matColumnDef="select">
              <th mat-header-cell *matHeaderCellDef>
                <mat-checkbox [checked]="isAllSelected()" [indeterminate]="selection.hasValue() && !isAllSelected()" 
                  (change)="toggleAllRows($event)">
                </mat-checkbox>
              </th>
              <td mat-cell *matCellDef="let row">
                <mat-checkbox [checked]="selection.isSelected(row)" (change)="selection.toggle(row)">
                </mat-checkbox>
              </td>
            </ng-container>

            <ng-container matColumnDef="receiptNo">
              <th mat-header-cell *matHeaderCellDef>Receipt no.</th>
              <td mat-cell *matCellDef="let element">{{element.receiptNo}}</td>
            </ng-container>

            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef>Date</th>
              <td mat-cell *matCellDef="let element">{{element.date}}</td>
            </ng-container>

            <ng-container matColumnDef="orderedBy">
              <th mat-header-cell *matHeaderCellDef>Ordered by</th>
              <td mat-cell *matCellDef="let element">{{element?.orderedBy?.name ?? 'Admin'}}</td>
            </ng-container>

            <ng-container matColumnDef="category">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let element">
                <span
                  class="inline-block px-2 py-1 rounded-full text-xs font-semibold"
                  [ngClass]="{
                    'bg-green-100 text-green-800': element.category === 'Complete',
                    'bg-yellow-100 text-yellow-800': element.category === 'Processing',
                    'bg-red-100 text-red-800': element.category === 'Cancel',
                    'bg-gray-100 text-gray-800': element.category !== 'Complete' && element.category !== 'Processing' && element.category !== 'Cancel'
                  }"
                >
                  {{element.category}}
                </span>
              </td>
            </ng-container>

            <ng-container matColumnDef="type">
              <th mat-header-cell *matHeaderCellDef>Payment Type</th>
              <td mat-cell *matCellDef="let element">{{element.type}}</td>
            </ng-container>

            <ng-container matColumnDef="ordertype">
              <th mat-header-cell *matHeaderCellDef>Order Type</th>
              <td mat-cell *matCellDef="let element">{{element.ordertype | titlecase}}</td>
            </ng-container>

            <ng-container matColumnDef="total">
              <th mat-header-cell *matHeaderCellDef>Total</th>
              <td mat-cell *matCellDef="let element">{{element.total | currency: storeStore.selectedStore()?.currency}}</td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let element">
                <button mat-icon-button [matMenuTriggerFor]="menu">
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                  <button mat-menu-item (click)="viewRecipesDetails(element._id)">
                    <mat-icon>visibility</mat-icon>
                    <span>View Receipt Details</span>
                  </button>
                  <button mat-menu-item (click)="deleteReceipt(element._id)">
                    <mat-icon>delete</mat-icon>
                    <span>Delete</span>
                  </button>
                </mat-menu>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>

        <mat-paginator  [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions" showFirstLastButtons
          aria-label="Select page">
        </mat-paginator>
        </div>
      </div>

    </mat-tab-nav-panel>
    } @else {
    <div class="flex items-center justify-center min-h-[300px]">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
    }

  </mat-card>


</div>