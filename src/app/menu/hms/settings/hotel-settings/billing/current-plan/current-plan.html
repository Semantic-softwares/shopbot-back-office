<div class="mb-12">
  <h2 class="text-sm font-semibold text-blue-600 mb-6">Current Plan</h2>

  <!-- Current Plan Information (shown first) -->
  @if (subscription()) {
    <mat-card appearance="outlined" class="mb-8 bg-white">
      <mat-card-content class="p-0">
        <div class="flex items-center gap-8 py-6 px-6">
          <!-- Status Icon -->
          <div 
            class="flex-shrink-0 w-20 h-20 rounded-lg flex items-center justify-center"
            [ngClass]="{
              'bg-blue-100': subscription()!.status === 'TRIAL',
              'bg-green-100': subscription()!.status === 'ACTIVE'
            }"
          >
            <mat-icon 
            
              [ngClass]="{
                'text-blue-600': subscription()!.status === 'TRIAL',
                'text-green-600': subscription()!.status === 'ACTIVE'
              }"
            >
              {{ subscription()!.status === 'TRIAL' ? 'schedule' : 'verified_user' }}
            </mat-icon>
          </div>

          <!-- Plan Details -->
          <div class="flex-1">
            <div class="flex items-baseline gap-2 mb-1">
              <p class="text-sm font-semibold text-gray-900">
                {{ subscription()!.status === 'TRIAL' ? 'Free Trial' : 'Active Subscription' }}
              </p>
              <span 
                class="text-xs font-semibold px-2.5 py-0.5 rounded-full"
                [ngClass]="{
                  'bg-blue-100 text-blue-700': subscription()!.status === 'TRIAL',
                  'bg-green-100 text-green-700': subscription()!.status === 'ACTIVE'
                }"
              >
                {{ subscription()!.status === 'TRIAL' ? 'TRIAL' : 'ACTIVE' }}
              </span>
            </div>
            <p class="text-sm text-gray-500 mb-3">
              {{ subscription()!.status === 'TRIAL' ? 'Expires on' : 'Renews on' }}
              <span class="font-semibold text-gray-700">
                @if (subscription()!.status === 'TRIAL') {
                  {{ subscription()!.trialEndDate | date: 'MMM d, y' }}
                } @else {
                  {{ subscription()!.nextBillingDate | date: 'MMM d, y' }}
                }
              </span>
            </p>
            <p class="text-sm text-gray-600">
              <span class="font-semibold">{{ getRoomRangeLabel() }}</span>
            </p>
          </div>

          <!-- Action Button -->
          <button 
            mat-raised-button
            (click)="onActionClick()"
            [color]="subscription()!.status === 'TRIAL' ? 'primary' : 'warn'"
            class="flex-shrink-0"
          >
            {{ getButtonLabel() }}
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  }

  <!-- Loading State -->
  @if (pricingResource.isLoading()) {
    <div class="flex justify-center py-8">
      <mat-spinner [diameter]="40"></mat-spinner>
    </div>
  }

  @if (!pricingResource.isLoading() && pricingResource.value()) {
    <!-- Plans Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-4 gap-6">
      <!-- Pricing Tier Plans -->
      @for (plan of pricingResource.value()!.pricingTiers; track plan.roomRange) {
        <mat-card appearance="outlined" class="flex flex-col hover:shadow-lg transition-all duration-300 ease-in-out">
          <mat-card-content class="flex-1 p-6">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-12 h-12 rounded-lg bg-blue-100 flex items-center justify-center">
                <mat-icon class="text-blue-600">home</mat-icon>
              </div>
              <div>
                <h3 class="text-sm font-bold text-gray-900">{{ plan.roomRange }}</h3>
                <p class="text-xs text-gray-500">Per Month</p>
              </div>
            </div>

            <div class="border-t border-gray-100 pt-4 mb-4">
              <p class="text-3xl font-bold text-gray-900">{{ plan.currency }}<span class="text-xl">{{ plan.price }}</span></p>
              <p class="text-xs text-gray-500 mt-1">/month billed annually</p>
            </div>

            <div class="space-y-2 text-xs text-gray-600">
              <div class="flex items-center gap-2">
                <mat-icon class="text-blue-600" [style.font-size]="'16px'">check_circle</mat-icon>
                <span>Unlimited users</span>
              </div>
              <div class="flex items-center gap-2">
                <mat-icon class="text-blue-600" [style.font-size]="'16px'">check_circle</mat-icon>
                <span>24/7 support</span>
              </div>
              <div class="flex items-center gap-2">
                <mat-icon class="text-blue-600" [style.font-size]="'16px'">check_circle</mat-icon>
                <span>All features</span>
              </div>
            </div>
          </mat-card-content>

          <mat-card-actions class="p-6 pt-0">
            <button 
              matButton="filled"
              (click)="onActionClick(plan)"
              [disabled]="isCurrentPlan(plan.roomRange)"
              class="w-full"
            >
              {{ getPlanActionLabel(plan.roomRange) }}
            </button>
          </mat-card-actions>
        </mat-card>
      }
    </div>
  }
</div>

