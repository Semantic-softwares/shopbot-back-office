@if (survey.hasValue()) {
  @let surveyData = survey.value();
  <div class="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
    <!-- Progress Bar -->
    <div class="max-w-3xl mx-auto mb-8">
      <div class="relative pt-1">
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-2xl font-bold text-gray-800">{{surveyData!.name}}</h2>
          <span class="text-sm font-semibold text-indigo-600">
            Question {{currentQuestionIndex + 1}} of {{questions.value()?.length}}
          </span>
        </div>
        <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-indigo-100">
          <div [style.width.%]="(currentQuestionIndex + 1) / questions.value()!.length * 100"
               class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-indigo-500 transition-all duration-500">
          </div>
        </div>
      </div>
    </div>

    <form [formGroup]="surveyForm">
      @if (questions.hasValue()) {
        @for (question of [questions.value()![currentQuestionIndex]]; track $index) {
          <div class="max-w-3xl mx-auto">
            <div class="bg-white rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:shadow-xl">
              <div class="p-8">
                <h3 class="text-xl font-semibold text-gray-900 mb-6">{{question.name}}</h3>
                
                @switch (question.questionType) {
                  @case ('Rating') {
                    <app-rating-field
                      [question]="question"
                      [control]="getAnswerControl(currentQuestionIndex).get('answer')">
                    </app-rating-field>
                  }
                  @case ('Single Choice') {
                    <app-single-choice-field
                      [question]="question"
                      [control]="getAnswerControl(currentQuestionIndex).get('answer')">
                    </app-single-choice-field>
                  }
                  @case ('Multiple Choice') {
                    <app-multiple-choice-field
                      [question]="question"
                      [control]="getAnswerControl(currentQuestionIndex).get('answer')">
                    </app-multiple-choice-field>
                  }
                }
                
                @if (getAnswerControl(currentQuestionIndex).get('answer')?.touched && 
                     getAnswerControl(currentQuestionIndex).get('answer')?.invalid) {
                  <div class="text-red-500 text-sm mt-2">
                    Please answer this question
                  </div>
                }
              </div>

              <!-- Navigation Buttons -->
              <div class="px-8 py-4 bg-gray-50 flex justify-between items-center">
                <button mat-stroked-button
                  *ngIf="currentQuestionIndex > 0"
                  (click)="previousQuestion()">
                  <mat-icon>arrow_back</mat-icon>
                  Previous
                </button>
                
                @if (currentQuestionIndex === questions.value()!.length - 1) {
                  <button mat-raised-button
                    color="primary"
                    (click)="submitSurvey()"
                    [disabled]="surveyForm.invalid">
                    Submit Survey
                    <mat-icon>send</mat-icon>
                  </button>
                } @else {
                  <button mat-raised-button
                    color="primary"
                    (click)="nextQuestion()">
                    Next
                    <mat-icon>arrow_forward</mat-icon>
                  </button>
                }
              </div>
            </div>
          </div>
        }
      }
    </form>

  </div>
}

@if (questions.isLoading() || survey.isLoading()) {
  <div class="min-h-screen flex items-center justify-center">
    <mat-spinner diameter="50"></mat-spinner>
  </div>
}

<!-- @if (questions.error()) {
  <div class="min-h-screen flex items-center justify-center">
    <div class="bg-red-50 p-4 rounded-md">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-red-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-red-800">Error loading survey</h3>
          <div class="mt-2 text-sm text-red-700">
            Please try refreshing the page or contact support if the problem persists.
          </div>
        </div>
      </div>
    </div>
  </div>
} -->
