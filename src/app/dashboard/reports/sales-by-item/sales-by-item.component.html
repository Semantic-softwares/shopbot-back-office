<div class="p-4 bg-gray-50 min-h-screen">
  <!-- Header Card -->
  <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
      <date-range-selector />
      <div class="flex gap-4">
        <app-employee-selector />
      </div>
    </div>
  </div>

  <!-- Sales Analysis Card -->
  <div class="bg-white rounded-lg shadow-sm mb-6">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 p-6">

      <!-- Top 5 Items -->
      <div class="w-full">
        <h2 class="text-lg font-medium mb-4">Top 5 Items (Net Sales)</h2>
        @if (products.hasValue()) {
        <mat-list>
          @for (item of products.value(); track $index) {
          <mat-list-item class="h-16 mb-2">
            <div matListItemAvatar>
              <img [src]="item.photos[0] || 'assets/images/placeholder.png'" class="h-10 w-10 rounded-full object-cover"
                [alt]="item.name">
            </div>
            <div matListItemTitle>{{item.name}}</div>
            <div matListItemLine class="text-gray-600 text-sm">{{item.totalQuantitySold}} item(s)</div>
            <div matListItemMeta class="text-primary font-medium text-lg">{{item.netSales | currency:
              storeStore.selectedStore()?.currency }}</div>
          </mat-list-item>
          } @empty {
          <div class="flex items-center justify-center min-h-[300px]">
            <app-no-record icon="inventory_2" title="No Products Found"
              message="There are no products to display for the selected period.">
            </app-no-record>
          </div>

          }

        </mat-list>
        } @else if (products.isLoading()) {
        <div class="flex items-center justify-center h-full">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
        }

        <!-- @else if (products.hasValue() && products.value().length < 1) { <app-no-record icon="inventory_2"
          title="No Products Found" message="There are no products to display for the selected period.">
          </app-no-record>
          } -->
      </div>

      <!-- Chart -->
      <div class="relative flex flex-col">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-medium">Sales by Item Chart</h2>
          <div class="flex gap-4">
            <mat-form-field appearance="outline" class="w-32">
              <mat-label>Chart Type</mat-label>
              <mat-select [(value)]="selectedChartType" (selectionChange)="onChartTypeChange($event.value)">
                <mat-option *ngFor="let type of chartTypes" [value]="type">
                  {{type | titlecase}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <!-- <period-range-selector /> -->
          </div>
        </div>
        <div class="!h-full w-full min-h-[300px]">
          @if (products.hasValue()) {

            @if ( products.value().length < 1) { 
            <div class="flex items-center justify-center min-h-[300px]">
              <app-no-record icon="inventory_2" title="No Products Found"
                message="There are no products to display for the selected period.">
              </app-no-record>
           </div>

        } @else {
        <canvas baseChart [type]="selectedChartType" [data]="getChartData()" [options]="chartOptions">
        </canvas>
        }
        } @else if (products.isLoading()) {
        <div class="flex items-center justify-center min-h-[300px]">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
        }
      </div>
    </div>
  </div>

  <!-- Table Card -->
  <div class="bg-white rounded-lg shadow-sm">
    <div class="p-6 flex justify-between items-center border-b">
      <h2 class="text-lg font-medium">All Products</h2>
      <button mat-flat-button color="primary" (click)="exportData()">
        <mat-icon class="mr-2">file_download</mat-icon>
        Export Data
      </button>
    </div>

    <div class="p-6">
      @if (products.hasValue()) {
      <div class="overflow-x-auto">
        @if ( products.value().length > 0) { 
        <mat-table [dataSource]="products.value()" class="w-full !bg-white">
          <ng-container matColumnDef="name">
            <mat-header-cell *matHeaderCellDef>Product</mat-header-cell>
            <mat-cell *matCellDef="let element">{{element.name}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="totalQuantitySold">
            <mat-header-cell *matHeaderCellDef>Quantity Sold</mat-header-cell>
            <mat-cell *matCellDef="let element">{{element.totalQuantitySold}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="totalRevenue">
            <mat-header-cell *matHeaderCellDef>Total Revenue</mat-header-cell>
            <mat-cell *matCellDef="let element">{{element.totalRevenue | currency:
              storeStore.selectedStore()?.currency}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="grossSales">
            <mat-header-cell *matHeaderCellDef>Gross Sales</mat-header-cell>
            <mat-cell *matCellDef="let element">{{element.grossSales | currency:
              storeStore.selectedStore()?.currency}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="totalTax">
            <mat-header-cell *matHeaderCellDef>Total Tax</mat-header-cell>
            <mat-cell *matCellDef="let element">{{element.totalTax | currency:
              storeStore.selectedStore()?.currency}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="netSales">
            <mat-header-cell *matHeaderCellDef>Net Sales</mat-header-cell>
            <mat-cell *matCellDef="let element">{{element.netSales | currency:
              storeStore.selectedStore()?.currency}}</mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
        </mat-table>
         <mat-paginator [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions" showFirstLastButtons
          aria-label="Select page" class="!bg-white">
        </mat-paginator>
      } @else {
        <div class="flex items-center justify-center min-h-[300px]">
            <app-no-record icon="inventory_2" title="No Products Found"
              message="There are no products to display for the selected period.">
            </app-no-record>
          </div>
      }
        

       
      </div>
      } @else if (products.isLoading()) {
       <div class="flex items-center justify-center min-h-[300px]">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
      } 



    </div>
  </div>