<div class="p-6">
  <header class="flex justify-between items-center mb-6">
    <div class="text-base">
      <a routerLink="../../" class="text-blue-600 hover:text-blue-800">Surveys</a> / {{survey.value()?.name}}
    </div>
    <button mat-raised-button color="primary" class="flex items-center gap-2" (click)="openQuestionForm()">
      <mat-icon>add</mat-icon>
      Add Question
    </button>
  </header>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-1">
      <h2 class="text-xl font-semibold mb-4">Survey Details</h2>
      @if (survey.isLoading()) {
        <div class="flex justify-center items-center py-4">
          <mat-spinner diameter="30"></mat-spinner>
        </div>
      } @else if (survey.error()) {
        <div class="text-red-500 py-4">Error loading survey details</div>
      } @else if (survey.value()) {
        <div class="bg-white rounded-lg border border-gray-200 p-4">
          <dl class="space-y-4">
            <div>
              <dt class="text-sm font-medium text-gray-500">Name</dt>
              <dd class="mt-1">{{survey.value()?.name}}</dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Description</dt>
              <dd class="mt-1">{{survey.value()?.description}}</dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Feedback Type</dt>
              <dd class="mt-1">{{survey.value()?.feedbackType}}</dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Status</dt>
              <dd class="mt-1">
                <span [class]="survey.value()?.status ? 'text-green-600' : 'text-red-600'">
                  {{survey.value()?.status ? 'Active' : 'Inactive'}}
                </span>
              </dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Duration</dt>
              <dd class="mt-1">
                {{survey.value()?.startDate | date}} - {{survey.value()?.endDate | date}}
              </dd>
            </div>
          
          </dl>
        </div>
      }
    </div>

    <div class="lg:col-span-2">
      @if (questions.isLoading()) {
        <div class="flex justify-center items-center py-12">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
      } @else if (questions.error()) {
        <div class="text-center py-12 bg-red-50 rounded-lg border-2 border-dashed border-red-300">
          <mat-icon class="text-red-400 text-5xl mb-3">error_outline</mat-icon>
          <h3 class="text-lg font-medium text-red-900">Error loading questions</h3>
          <p class="text-red-500 mt-1">{{questions.error()}}</p>
          <button mat-raised-button color="warn" class="mt-4" (click)="questions.reload()">
            Retry
          </button>
        </div>
      } @else if (questions.hasValue() && questions.value()!.length > 0) {
        <h2 class="text-xl font-semibold mb-4">Questions</h2>
        <div class="grid gap-4" cdkDropList (cdkDropListDropped)="drop($event)">
          @for (question of questions.value(); track $index) {
            <div class="p-4 bg-white rounded-lg border border-gray-200 shadow-sm" cdkDrag>
              <div class="flex justify-between items-start">
                <div class="cdkDragHandle cursor-move mr-3">
                  <mat-icon class="text-gray-400">drag_indicator</mat-icon>
                </div>
                <div class="flex-1">
                  <h3 class="font-medium mb-2">{{question.name}}</h3>
                  <p class="text-gray-600">Type: {{question.questionType}}</p>
                  
                  @if (question.questionType === 'Rating') {
                    <div class="mt-2 flex items-center gap-1">
                      @for (star of [].constructor(question.ratingScale); track $index) {
                        <mat-icon class="text-amber-400">star</mat-icon>
                      }
                      <span class="ml-2 text-sm text-gray-500">(Scale: {{question.ratingScale}})</span>
                    </div>
                  }

                  @if (question.choices?.length) {
                    <div class="mt-2">
                      <p class="text-sm text-gray-500">Choices:</p>
                      <ul class="list-disc list-inside">
                        @for (choice of question.choices; track $index) {
                          <li class="text-gray-600">
                            {{choice.text}}
                            @if (choice.isOther) {
                              <span class="ml-2 text-xs bg-gray-100 px-2 py-1 rounded">Other</span>
                            }
                          </li>
                        }
                      </ul>
                    </div>
                  }
                </div>
                
                <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="User actions">
                    <mat-icon>more_vert</mat-icon>
                  </button>
                  <mat-menu #menu="matMenu">
                  
                    <button mat-menu-item (click)="editQuestion(question)">
                      <mat-icon>edit</mat-icon>
                      <span>Edit</span>
                    </button>
                    <button mat-menu-item (click)="deleteQuestion(question)">
                      <mat-icon>delete</mat-icon>
                      <span>Delete</span>
                    </button>
                  </mat-menu>
              </div>
            </div>
          }
        </div>
      } @else {
        <div class="text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300">
          <mat-icon class="text-gray-400 text-5xl mb-3">question_answer</mat-icon>
          <h3 class="text-lg font-medium text-gray-900">No questions yet</h3>
          <p class="text-gray-500 mt-1">Get started by adding a new question to your survey.</p>
          <button mat-raised-button color="primary" class="mt-4" (click)="openQuestionForm()">
            Add Your First Question
          </button>
        </div>
      }
    </div>
  </div>
</div>