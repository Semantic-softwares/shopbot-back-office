import{c as qe,d as Ke,e as We,f as Xe,g as Ze}from"./chunk-625ICML5.js";import{a as Ye}from"./chunk-XM7KJLGN.js";import"./chunk-FUTA6TE5.js";import{a as Ue}from"./chunk-BKAAY5R4.js";import{b as Ge,f as Je}from"./chunk-LPOORG3R.js";import{a as Ae,b as He,c as Qe}from"./chunk-3PQC2AD7.js";import{a as je}from"./chunk-ZEC2X3UU.js";import{c as Pe,d as Fe,e as Re,f as Ve,g as Ne,h as Be}from"./chunk-PYMVMKZE.js";import{a as $e,b as ze}from"./chunk-2EEFUGSW.js";import"./chunk-34V2NAQK.js";import"./chunk-JBPT7IMO.js";import{a as ye,b as be,c as Me,d as Ee,e as Oe,f as De,g as we,h as Te,i as Le,j as ke,k as Ie}from"./chunk-DQAEAUAH.js";import{a as U}from"./chunk-EHJ5MOYI.js";import"./chunk-UDYHQK5Q.js";import"./chunk-2KPMOGOH.js";import"./chunk-TRRVPZ2R.js";import{a as ae,b as oe,c as le,d as se}from"./chunk-XCSZ2RSV.js";import{i as Z}from"./chunk-WFQLSX5X.js";import{a as Ce,b as he}from"./chunk-D2CDDOVY.js";import{d as J}from"./chunk-S6O7RC67.js";import{d as xe}from"./chunk-WD3LGOJ6.js";import"./chunk-KQ2NF2R5.js";import"./chunk-AQTPIICF.js";import"./chunk-GZ7S2I6F.js";import"./chunk-L5R7UQHM.js";import{b as _e,c as fe,d as ge}from"./chunk-VN3HHLBZ.js";import{a as me,d as ce,e as pe,h as ue}from"./chunk-THLNJRLH.js";import"./chunk-GBJWJHBW.js";import{a as Se,b as ve}from"./chunk-YJKLGOC4.js";import{A as de}from"./chunk-ADPCW6JI.js";import"./chunk-UUMWQRYG.js";import{a as W}from"./chunk-VNGKQKTG.js";import{a as X}from"./chunk-RRHIWUSE.js";import"./chunk-VJNXGGOY.js";import"./chunk-UPMF7ZC6.js";import"./chunk-BFT2MTJY.js";import{a as ie,c as re,h as ne}from"./chunk-EALJFX3J.js";import"./chunk-5AHC55Y5.js";import"./chunk-TVQ3FP64.js";import"./chunk-47XHPHB4.js";import{b as ee,c as te}from"./chunk-IYN665YT.js";import{Y,Z as q,aa as K}from"./chunk-OYVOT3CA.js";import{g as j,l as G}from"./chunk-DWM5GR6S.js";import{m as A,p as H,r as Q}from"./chunk-6BQAOBQP.js";import{$a as l,Dc as z,Gb as b,Hb as M,Jc as w,Kb as T,Lb as L,Lc as F,Mb as p,Nb as i,Nc as R,Ob as n,Pb as E,Tb as h,Tc as I,Ub as x,Wb as O,_b as u,ac as _,ea as S,ja as m,ka as c,kc as k,mc as $,ob as B,oc as D,pc as o,qc as f,rc as y,ub as C,va as v}from"./chunk-H33Y42PP.js";import{a as V,b as N,g as P}from"./chunk-GAL4ENT6.js";var it=()=>[10,25,50,100],et=(r,t)=>t.value,rt=(r,t)=>t._id;function nt(r,t){if(r&1&&(i(0,"mat-option",18),o(1),n()),r&2){let e=t.$implicit;p("value",e.value),l(),f(e.label)}}function at(r,t){if(r&1&&(i(0,"mat-option",18),o(1),n()),r&2){let e=t.$implicit;p("value",e.value),l(),f(e.label)}}function ot(r,t){r&1&&(i(0,"div",24),E(1,"mat-spinner",28),n())}function lt(r,t){if(r&1){let e=O();i(0,"app-no-record",25)(1,"button",29),u("click",function(){m(e);let s=_();return c(s.reloadData())}),o(2," Retry "),n()()}if(r&2){let e=_();p("message",e.ordersResource.error())}}function st(r,t){r&1&&E(0,"app-no-record",26)}function dt(r,t){r&1&&(i(0,"th",45),o(1,"Order ID & Name"),n())}function mt(r,t){if(r&1&&(i(0,"td",46)(1,"div",47)(2,"span",48),o(3),n(),i(4,"span",49),o(5),n()()()),r&2){let e=t.$implicit;l(3),y("#",e.reference),l(2),f((e.user==null?null:e.user.name)||(e.user==null?null:e.user.email)||"Guest")}}function ct(r,t){r&1&&(i(0,"th",45),o(1,"Total"),n())}function pt(r,t){if(r&1&&(i(0,"td",46)(1,"span",50),o(2),w(3,"currency"),n()()),r&2){let e=t.$implicit,a=_(2);l(2),f(R(3,1,e.total,a.currency(),"symbol","1.2-2"))}}function ut(r,t){r&1&&(i(0,"th",45),o(1,"Status"),n())}function _t(r,t){if(r&1&&(i(0,"td",46)(1,"mat-chip"),o(2),n()()),r&2){let e=t.$implicit,a=_(2);l(),D(a.getStatusColor(e.category)),l(),y(" ",e.category," ")}}function ft(r,t){r&1&&(i(0,"th",45),o(1,"Payment Method"),n())}function gt(r,t){if(r&1&&(i(0,"td",46)(1,"span",51),o(2),n()()),r&2){let e=t.$implicit;l(2),f(e.payment||"N/A")}}function St(r,t){r&1&&(i(0,"th",45),o(1,"Payment Status"),n())}function vt(r,t){if(r&1&&(i(0,"td",46)(1,"mat-chip",52),o(2),n()()),r&2){let e=t.$implicit,a=_(2);l(),D(a.getPaymentStatusColor(e.paymentStatus)),l(),y(" ",e.paymentStatus," ")}}function Ct(r,t){r&1&&(i(0,"th",45),o(1,"Location"),n())}function ht(r,t){if(r&1&&(i(0,"td",46)(1,"span",51),o(2),n()()),r&2){let e=t.$implicit,a=_(2);l(2),f(a.getLocationInfo(e))}}function xt(r,t){r&1&&(i(0,"th",45),o(1,"Date"),n())}function yt(r,t){if(r&1&&(i(0,"td",46)(1,"span",51),o(2),w(3,"date"),n()()),r&2){let e=t.$implicit;l(2),f(F(3,1,e.createdAt,"short"))}}function bt(r,t){r&1&&(i(0,"th",45),o(1,"Actions"),n())}function Mt(r,t){if(r&1){let e=O();i(0,"td",46)(1,"button",53)(2,"mat-icon"),o(3,"more_vert"),n()(),i(4,"mat-menu",null,1)(6,"button",54),u("click",function(){let s=m(e).$implicit,d=_(2);return c(d.viewOrder(s))}),i(7,"mat-icon"),o(8,"visibility"),n(),i(9,"span"),o(10,"View"),n()(),i(11,"button",54),u("click",function(){let s=m(e).$implicit,d=_(2);return c(d.printOrder(s))}),i(12,"mat-icon"),o(13,"print"),n(),i(14,"span"),o(15,"Print"),n()(),i(16,"button",54),u("click",function(){let s=m(e).$implicit,d=_(2);return c(d.editOrder(s))}),i(17,"mat-icon"),o(18,"edit"),n(),i(19,"span"),o(20,"Edit"),n()()()()}if(r&2){let e=k(5);l(),p("matMenuTriggerFor",e)}}function Et(r,t){r&1&&E(0,"tr",55)}function Ot(r,t){r&1&&E(0,"tr",56)}function Dt(r,t){if(r&1){let e=O();i(0,"div",30)(1,"table",31),h(2,32),C(3,dt,2,0,"th",33)(4,mt,6,2,"td",34),x(),h(5,35),C(6,ct,2,0,"th",33)(7,pt,4,6,"td",34),x(),h(8,36),C(9,ut,2,0,"th",33)(10,_t,3,3,"td",34),x(),h(11,37),C(12,ft,2,0,"th",33)(13,gt,3,1,"td",34),x(),h(14,38),C(15,St,2,0,"th",33)(16,vt,3,3,"td",34),x(),h(17,39),C(18,Ct,2,0,"th",33)(19,ht,3,1,"td",34),x(),h(20,40),C(21,xt,2,0,"th",33)(22,yt,4,4,"td",34),x(),h(23,41),C(24,bt,2,0,"th",33)(25,Mt,21,1,"td",34),x(),C(26,Et,1,0,"tr",42)(27,Ot,1,0,"tr",43),n()(),i(28,"mat-paginator",44),u("page",function(s){m(e);let d=_();return c(d.onPageChange(s))}),n()}if(r&2){let e=_();l(),p("dataSource",e.filteredOrders()),l(25),p("matHeaderRowDef",e.displayedColumns),l(),p("matRowDefColumns",e.displayedColumns),l(),p("length",e.totalOrders())("pageSize",e.pageSize())("pageIndex",e.pageIndex())("pageSizeOptions",z(7,it))}}function wt(r,t){if(r&1){let e=O();i(0,"mat-card",57)(1,"mat-card-content",58)(2,"div",59)(3,"div",60)(4,"h3",61),o(5),n(),i(6,"p",49),o(7),n()(),i(8,"button",53)(9,"mat-icon"),o(10,"more_vert"),n()(),i(11,"mat-menu",null,2)(13,"button",54),u("click",function(){let s=m(e).$implicit,d=_(2);return c(d.viewOrder(s))}),i(14,"mat-icon"),o(15,"visibility"),n(),i(16,"span"),o(17,"View"),n()(),i(18,"button",54),u("click",function(){let s=m(e).$implicit,d=_(2);return c(d.printOrder(s))}),i(19,"mat-icon"),o(20,"print"),n(),i(21,"span"),o(22,"Print"),n()(),i(23,"button",54),u("click",function(){let s=m(e).$implicit,d=_(2);return c(d.editOrder(s))}),i(24,"mat-icon"),o(25,"edit"),n(),i(26,"span"),o(27,"Edit"),n()()()(),i(28,"div",62)(29,"span",63),o(30),w(31,"currency"),n()(),i(32,"div",64)(33,"mat-chip",52),o(34),n(),i(35,"mat-chip",52),o(36),n()(),i(37,"div",65)(38,"div",66)(39,"mat-icon",67),o(40,"payment"),n(),i(41,"span"),o(42),n()(),i(43,"div",66)(44,"mat-icon",67),o(45,"location_on"),n(),i(46,"span"),o(47),n()(),i(48,"div",66)(49,"mat-icon",67),o(50,"schedule"),n(),i(51,"span"),o(52),w(53,"date"),n()()()()()}if(r&2){let e=t.$implicit,a=k(12),s=_(2);l(5),y("#",e.reference),l(2),f((e.user==null?null:e.user.name)||(e.user==null?null:e.user.email)||"Guest"),l(),p("matMenuTriggerFor",a),l(22),f(R(31,13,e.total,s.currency(),"symbol","1.2-2")),l(3),D(s.getStatusColor(e.category)),l(),y(" ",e.category," "),l(),D(s.getPaymentStatusColor(e.paymentStatus)),l(),y(" ",e.paymentStatus," "),l(6),f(e.payment||"N/A"),l(5),f(s.getLocationInfo(e)),l(5),f(F(53,18,e.createdAt,"short"))}}function Tt(r,t){if(r&1&&(i(0,"div",27),T(1,wt,54,21,"mat-card",57,rt),n()),r&2){let e=_();l(),L(e.filteredOrders())}}var tt=class r{ordersService=S(Xe);authService=S(X);storeStore=S(Z);cartStore=S(qe);cartService=S(Ke);orderStore=S(Ze);router=S(j);saleTypeStore=S(We);printJobService=S(Ye);snackBar=S(W);searchQuery=v("");statusFilter=v("");paymentFilter=v("");staffFilter=v(this.authService.currentUserValue?._id||"");startDate=v(new Date(new Date().setHours(0,0,0,0)));endDate=v(new Date(new Date().setHours(23,59,59,999)));tempStartDate=null;tempEndDate=null;viewMode=v("table");pageSize=v(15);pageIndex=v(0);totalOrders=v(0);displayedColumns=["reference","total","status","payment","paymentStatus","location","date","actions"];filterParams=I(()=>{let t={storeId:this.storeStore.selectedStore()?._id,limit:this.pageSize(),skip:this.pageIndex()*this.pageSize(),salesChannel:"Point of Sale"};this.statusFilter()&&(t.status=this.statusFilter()),this.paymentFilter()&&(t.payment=this.paymentFilter()),this.staffFilter()&&(t.staff=this.staffFilter());let e=this.startDate(),a=this.endDate();return e&&a&&(t.startDate=e.toISOString(),t.endDate=a.toISOString()),t});ordersResource=xe({params:()=>this.filterParams(),stream:({params:t})=>{if(!t.storeId)throw new Error("Store not selected");return this.ordersService.getStoreOrders(t.storeId,t)}});filteredOrders=I(()=>{let t=this.ordersResource.value()||[],e=this.searchQuery().toLowerCase();return e?t.filter(a=>a.reference?.toLowerCase().includes(e)||a.user?.name?.toLowerCase().includes(e)||a.user?.email?.toLowerCase().includes(e)):t});currency=I(()=>this.storeStore.selectedStore()?.currency||"\u20A6");statusOptions=[{value:"",label:"All Statuses"},{value:"Processing",label:"Processing"},{value:"Ready",label:"Ready"},{value:"Complete",label:"Complete"},{value:"Cancel",label:"Cancelled"}];paymentOptions=[{value:"",label:"All Payments"},{value:"Cash",label:"Cash"},{value:"POS Terminal",label:"POS Terminal"},{value:"Pay Online",label:"Pay Online"}];reloadData(){this.ordersResource.reload()}startNewSale(){this.router.navigate(["/menu/pos/checkout"])}clearFilters(){this.searchQuery.set(""),this.statusFilter.set(""),this.paymentFilter.set(""),this.staffFilter.set(this.authService.currentUserValue?._id||""),this.startDate.set(null),this.endDate.set(null),this.pageIndex.set(0)}onPageChange(t){this.pageIndex.set(t.pageIndex),this.pageSize.set(t.pageSize)}onStartDateChange(t){this.tempStartDate=t}onEndDateChange(t){this.tempEndDate=t}onDateRangeClosed(){this.tempStartDate&&this.tempEndDate&&(this.startDate.set(this.tempStartDate),this.endDate.set(this.tempEndDate))}getStatusColor(t){return{Processing:"bg-blue-100 text-blue-800",Ready:"bg-purple-100 text-purple-800",Complete:"bg-green-100 text-green-800",Cancel:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800"}getPaymentStatusColor(t){return t==="Paid"?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}getLocationInfo(t){return t.table?`Table: ${t.table.name}`:t.shippingFee&&t.shippingFee>0?"Delivery":"Quick Sale"}viewOrder(t){this.router.navigate(["/menu/pos/orders",t._id,"details"])}printOrder(t){return P(this,null,function*(){if(console.log("Print order:",t),!t._id){this.snackBar.open("Invalid order data","Close",{duration:3e3}),console.error("Invalid order data");return}if(!t.cart?._id){this.snackBar.open("Invalid cart data","Close",{duration:3e3}),console.error("Invalid cart data");return}let e=this.snackBar.open("Loading order data...","",{duration:0,horizontalPosition:"center",verticalPosition:"bottom"});this.cartService.loadCart(t.cart._id).subscribe({next:a=>P(this,null,function*(){try{let s=N(V({},t),{cart:a});console.log("Printing order via PrintJobService:",s),e.dismiss(),(yield this.printJobService.printOrderReceipt(s)).isPrinterConnected?this.snackBar.open("\u2705 Order printed successfully","Close",{duration:3e3}):this.snackBar.open("\u{1F4CB} Print job created - Receipt will print at counter","Close",{duration:5e3,panelClass:["info-snackbar"]})}catch(s){console.error("Failed to print order:",s),e.dismiss(),this.snackBar.open(`Print failed: ${s.message}`,"Close",{duration:5e3})}}),error:a=>{e.dismiss(),this.snackBar.open("Failed to load cart for printing","Close",{duration:3e3}),console.error("Error loading cart:",a)}})})}editOrder(t){if(!t.cart?._id){this.snackBar.open("Invalid cart data","Close",{duration:3e3}),console.error("Invalid cart data");return}let e=this.snackBar.open("Loading order for editing...","",{duration:0,horizontalPosition:"center",verticalPosition:"bottom"});this.cartService.loadCart(t.cart._id).subscribe({next:a=>{e.dismiss(),this.orderStore.selectOrder(t),this.saleTypeStore.setSelectedSaleType(t.type,!0),this.saleTypeStore.startEditing(),this.router.navigate(["/menu/pos/checkout"])},error:a=>{e.dismiss(),this.snackBar.open("Failed to load order for editing","Close",{duration:3e3}),console.error("Error loading cart:",a),this.saleTypeStore.stopEditing()}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=B({type:r,selectors:[["app-list-orders"]],decls:56,vars:16,consts:[["dateRangePicker",""],["menu","matMenu"],["cardMenu","matMenu"],["title","Orders","subtitle","Manage and track all your orders"],["actions",""],[1,"hidden","md:flex",3,"change","value"],["value","table"],["value","grid"],["mat-stroked-button","",3,"click"],["matButton","outlined",3,"click","disabled"],["matButton","filled","color","primary",3,"click"],[1,"max-w-12xl","py-6","px-4"],["appearance","outlined",1,"py-4"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4","px-4","mb-4"],["appearance","outline"],["matInput","","placeholder","Order ID, customer name...",3,"input","value"],["matPrefix",""],[3,"selectionChange","value"],[3,"value"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"dateChange","value"],["matEndDate","","placeholder","End date",3,"dateChange","value"],["matIconSuffix","",3,"for"],[3,"closed"],[1,"flex","items-center","justify-center","py-12"],["icon","error_outline","title","Failed to Load Orders",3,"message"],["icon","receipt_long","title","No Orders Found","message","No orders match your current filters. Try adjusting your search criteria."],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4","px-4"],["diameter","50"],["mat-flat-button","","color","primary",3,"click"],[1,"overflow-x-auto","hidden","md:block"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","reference"],["mat-header-cell","","class","font-semibold",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","total"],["matColumnDef","status"],["matColumnDef","payment"],["matColumnDef","paymentStatus"],["matColumnDef","location"],["matColumnDef","date"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"page","length","pageSize","pageIndex","pageSizeOptions"],["mat-header-cell","",1,"font-semibold"],["mat-cell",""],[1,"flex","flex-col"],[1,"font-medium"],[1,"text-sm","text-gray-600"],[1,"font-semibold"],[1,"text-sm"],[1,"text-xs"],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""],["appearance","outlined",1,"cursor-pointer","hover:shadow-lg","transition-shadow"],[1,"p-4"],[1,"flex","items-start","justify-between","mb-3"],[1,"flex-1"],[1,"font-semibold","text-lg"],[1,"mb-3"],[1,"text-2xl","font-bold"],[1,"flex","gap-2","mb-3"],[1,"space-y-1","text-sm","text-gray-600"],[1,"flex","items-center","gap-2"],[1,"text-base"]],template:function(e,a){if(e&1){let s=O();i(0,"app-page-header",3),h(1,4),i(2,"mat-button-toggle-group",5),u("change",function(g){return m(s),c(a.viewMode.set(g.value))}),i(3,"mat-button-toggle",6)(4,"mat-icon"),o(5,"table_view"),n()(),i(6,"mat-button-toggle",7)(7,"mat-icon"),o(8,"grid_view"),n()()(),i(9,"button",8),u("click",function(){return m(s),c(a.clearFilters())}),i(10,"mat-icon"),o(11,"clear"),n(),o(12," Clear Filters "),n(),i(13,"button",9),u("click",function(){return m(s),c(a.reloadData())}),i(14,"mat-icon"),o(15,"refresh"),n(),o(16," Reload "),n(),i(17,"button",10),u("click",function(){return m(s),c(a.startNewSale())}),i(18,"mat-icon"),o(19,"add_shopping_cart"),n(),o(20," Start New Sale "),n(),x(),n(),i(21,"div",11)(22,"mat-card",12)(23,"div",13)(24,"mat-form-field",14)(25,"mat-label"),o(26,"Search"),n(),i(27,"input",15),u("input",function(g){return m(s),c(a.searchQuery.set(g.target.value))}),n(),i(28,"mat-icon",16),o(29,"search"),n()(),i(30,"mat-form-field",14)(31,"mat-label"),o(32,"Status"),n(),i(33,"mat-select",17),u("selectionChange",function(g){return m(s),c(a.statusFilter.set(g.value))}),T(34,nt,2,2,"mat-option",18,et),n()(),i(36,"mat-form-field",14)(37,"mat-label"),o(38,"Payment"),n(),i(39,"mat-select",17),u("selectionChange",function(g){return m(s),c(a.paymentFilter.set(g.value))}),T(40,at,2,2,"mat-option",18,et),n()(),i(42,"mat-form-field",14)(43,"mat-label"),o(44,"Date Range"),n(),i(45,"mat-date-range-input",19)(46,"input",20),u("dateChange",function(g){return m(s),c(a.onStartDateChange(g.value))}),n(),i(47,"input",21),u("dateChange",function(g){return m(s),c(a.onEndDateChange(g.value))}),n()(),E(48,"mat-datepicker-toggle",22),i(49,"mat-date-range-picker",23,0),u("closed",function(){return m(s),c(a.onDateRangeClosed())}),n()()(),b(51,ot,2,0,"div",24),b(52,lt,3,1,"app-no-record",25),b(53,st,1,0,"app-no-record",26),b(54,Dt,29,8),b(55,Tt,3,0,"div",27),n()()}if(e&2){let s=k(50);l(2),p("value",a.viewMode()),l(11),p("disabled",a.ordersResource.isLoading()),l(),$("animate-spin",a.ordersResource.isLoading()),l(13),p("value",a.searchQuery()),l(6),p("value",a.statusFilter()),l(),L(a.statusOptions),l(5),p("value",a.paymentFilter()),l(),L(a.paymentOptions),l(5),p("rangePicker",s),l(),p("value",a.startDate()),l(),p("value",a.endDate()),l(),p("for",s),l(3),M(a.ordersResource.isLoading()?51:-1),l(),M(a.ordersResource.error()&&!a.ordersResource.isLoading()?52:-1),l(),M(!a.ordersResource.isLoading()&&!a.ordersResource.error()&&a.filteredOrders().length===0?53:-1),l(),M(!a.ordersResource.isLoading()&&!a.ordersResource.error()&&a.filteredOrders().length>0&&a.viewMode()==="table"?54:-1),l(),M(!a.ordersResource.isLoading()&&!a.ordersResource.error()&&a.filteredOrders().length>0&&a.viewMode()==="grid"?55:-1)}},dependencies:[Q,G,de,Ie,ye,Me,we,Ee,be,Te,Oe,De,Le,ke,ne,ie,re,K,q,Y,te,ee,_e,ue,me,ce,pe,ge,fe,he,Ce,J,Be,Pe,Fe,Re,Ve,Ne,U,Je,Ge,ve,Se,se,oe,ae,le,ze,$e,Ue,je,Qe,Ae,He,H,A],styles:["[_nghost-%COMP%]{display:block}"]})};export{tt as ListOrders};
