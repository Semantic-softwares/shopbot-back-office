import{a as g}from"./chunk-HXGWD5KU.js";import{a as o}from"./chunk-LJSEVW7O.js";import{x as m}from"./chunk-5PWABXJE.js";import{aa as h,ea as l,h as n,s as a}from"./chunk-FR2FBSQW.js";var p=class i{constructor(e,r){this.http=e;this.sessionStorage=r;this.currentUserSubject=new n(this.sessionStorage.getItem("currentUser")),this.currentUser=this.currentUserSubject.asObservable();let s=localStorage.getItem("userRole");s&&this.currentUserRole.next(JSON.parse(s))}currentUserSubject;currentUser;apiUrl=`${o.apiUrl}/auth`;currentUserRole=new n(null);permissionCache=new Map;setUserRole(e){this.permissionCache.clear(),localStorage.setItem("userRole",JSON.stringify(e)),this.currentUserRole.next(e)}getUserRole(){return this.currentUserRole.asObservable()}getCurrentRole(){return this.currentUserRole.getValue()}hasPermission(e){return this.currentUserRole.getValue()?Array.isArray(e)?e.some(s=>this.checkSinglePermission(s)):this.checkSinglePermission(e):!1}checkSinglePermission(e){if(this.permissionCache.has(e))return this.permissionCache.get(e)||!1;let r=this.currentUserRole.getValue();if(!r)return!1;let[s,u]=e.toLowerCase().split("_"),U=r.permissions.some(t=>t.action.toLowerCase()===s&&t.resource.toLowerCase()===u),b=r.permissions.some(t=>t.action.toLowerCase()==="all"&&t.resource.toLowerCase()===u||t.action.toLowerCase()===s&&t.resource.toLowerCase()==="all"||t.action.toLowerCase()==="all"&&t.resource.toLowerCase()==="all"),c=U||b;return this.permissionCache.set(e,c),c}hasAllPermissions(e){return e.every(r=>this.hasPermission(r))}hasAnyPermission(e){return e.some(r=>this.hasPermission(r))}getPermissionsByCategory(e){let r=this.currentUserRole.getValue();return r?r.permissions.filter(s=>s.categoryId.name.toLowerCase()===e.toLowerCase()):[]}hasCategory(e){let r=this.currentUserRole.getValue();return r?r.permissions.some(s=>s.categoryId.name.toLowerCase()===e.toLowerCase()):!1}clearPermissions(){this.permissionCache.clear(),localStorage.removeItem("userRole"),this.currentUserRole.next(null)}get currentUserValue(){return this.currentUserSubject.value}login(e,r){return this.http.post(`${o.apiUrl}/auth/login?user=merchant`,{email:e,password:r}).pipe(a(s=>(this.sessionStorage.setItem("currentUser",s.user),this.sessionStorage.setItem("auth_token",s.access_token),this.currentUserSubject.next(s.user),s.user)))}signup(e){return this.http.post(`${o.apiUrl}/auth/signup`,e).pipe(a(r=>r.user))}logout(){this.sessionStorage.removeItem("currentUser"),this.sessionStorage.clearAll(),this.currentUserSubject.next(null)}updatePassword(e,r){return this.http.post(`${this.apiUrl}/${e}/reset-password`,{password:r})}static \u0275fac=function(r){return new(r||i)(l(m),l(g))};static \u0275prov=h({token:i,factory:i.\u0275fac,providedIn:"root"})};export{p as a};
