import{a as E}from"./chunk-Q7PLVOIA.js";import{a as Be,b as $e}from"./chunk-ZAOMQAJO.js";import{a as Oe}from"./chunk-YZQZHEMG.js";import{f as Fe,k as Ae}from"./chunk-XSZYAESL.js";import"./chunk-LCNY3JPX.js";import{a as Le}from"./chunk-W4TGQK6Q.js";import{a as Ve}from"./chunk-XNCSUYGL.js";import{a as Ie}from"./chunk-MTEGI52J.js";import{a as ke}from"./chunk-BS3ATKNX.js";import{h as Ee}from"./chunk-MSN3EE44.js";import{a as Pe}from"./chunk-XJJHORKJ.js";import{a as M,b as De}from"./chunk-5NCGVO7F.js";import"./chunk-HOFFRLAS.js";import"./chunk-OFQMF3WN.js";import{a as xe,b as ge,c as he,d as Se,e as be,f as ve,g as ye,h as Re,i as Me,j as Te,k as we}from"./chunk-BAU4EBFS.js";import"./chunk-FK6H3RFT.js";import{d as ue,e as _e,f as fe,g as Ce}from"./chunk-GE7CTSB3.js";import"./chunk-OKEXGVJ3.js";import"./chunk-O7SXWP4H.js";import{a as ee,b as te}from"./chunk-S7W2IROZ.js";import{a as ne,b as oe,c as ae,d as re}from"./chunk-4P4GBQE7.js";import{i as W}from"./chunk-ZKQYDJ5W.js";import"./chunk-LCF3SYDV.js";import"./chunk-ZLVLWRZH.js";import{c as pe,d as de}from"./chunk-HJGFVW6K.js";import"./chunk-TVH27JLT.js";import"./chunk-G4CZ6LK2.js";import{c as ie}from"./chunk-I564X6SI.js";import"./chunk-VTDH2LYT.js";import{b as ce,d as me}from"./chunk-63HT37SK.js";import"./chunk-YJCGHVXK.js";import"./chunk-UHBDKNKX.js";import{a as se}from"./chunk-3ZLH5HUN.js";import{B as le}from"./chunk-O5GCTPYR.js";import"./chunk-EGLRIU4H.js";import"./chunk-53AK2UWQ.js";import"./chunk-BFT2MTJY.js";import{a as Z}from"./chunk-JONI64R4.js";import"./chunk-H7INH462.js";import"./chunk-OOL2KACG.js";import"./chunk-KZJMNFJ3.js";import{b as X,c as Y}from"./chunk-G6I3OKXX.js";import{Z as J,_ as K,ba as U}from"./chunk-4Z2XUZY2.js";import{e as j,g as G}from"./chunk-F436VINI.js";import{g as N,l as z,s as H,u as Q}from"./chunk-H22US2IH.js";import{Ib as v,Jb as y,Kc as F,Mb as V,Mc as w,Nb as P,Nc as A,Ob as s,Oc as O,Pb as n,Qb as o,Rb as S,Vb as f,Wb as C,Wc as q,Y as D,Yb as b,ac as x,bb as c,cc as p,fa as h,gc as I,hc as B,ic as $,ka as d,la as u,mc as R,qb as L,rc as r,sc as g,tc as T,wa as k,wb as _}from"./chunk-P5WOETP4.js";import"./chunk-GAL4ENT6.js";var Ne=(t,i,e,a)=>({"bg-green-100 text-green-800":t,"bg-yellow-100 text-yellow-800":i,"bg-red-100 text-red-800":e,"bg-gray-100 text-gray-800":a}),ze=(t,i)=>i.value;function He(t,i){t&1&&S(0,"mat-progress-bar",4)}function Qe(t,i){if(t&1){let e=b();n(0,"button",14),x("click",function(){d(e);let l=p();return u(l.deleteMultiple())}),n(1,"mat-icon",8),r(2,"delete"),o(),r(3),o()}if(t&2){let e=p();s("disabled",e.isDeleting()),c(3),T(" Delete (",e.selection.selected.length,") ")}}function je(t,i){if(t&1){let e=b();n(0,"a",34),x("click",function(){let l=d(e).$implicit,m=p(2);return u(m.onTabChange(l.value))}),n(1,"div",35)(2,"h3",36),r(3),o(),n(4,"p",37),r(5),o()()()}if(t&2){let e=i.$implicit,a=p(2);s("active",a.activeTab===e.value),c(3),g(e.label),c(2),g(e.count)}}function Ge(t,i){if(t&1){let e=b();n(0,"th",38)(1,"mat-checkbox",39),x("change",function(l){d(e);let m=p(2);return u(m.toggleAllRows(l))}),o()()}if(t&2){let e=p(2);c(),s("checked",e.isAllSelected())("indeterminate",e.selection.hasValue()&&!e.isAllSelected())}}function Je(t,i){if(t&1){let e=b();n(0,"td",40)(1,"mat-checkbox",41),x("change",function(){let l=d(e).$implicit,m=p(2);return u(m.selection.toggle(l))}),o()()}if(t&2){let e=i.$implicit,a=p(2);c(),s("checked",a.selection.isSelected(e))}}function Ke(t,i){t&1&&(n(0,"th",38),r(1,"Receipt no."),o())}function Ue(t,i){if(t&1&&(n(0,"td",40),r(1),o()),t&2){let e=i.$implicit;c(),g(e.receiptNo)}}function We(t,i){t&1&&(n(0,"th",38),r(1,"Date"),o())}function Xe(t,i){if(t&1&&(n(0,"td",40),r(1),o()),t&2){let e=i.$implicit;c(),g(e.date)}}function Ye(t,i){t&1&&(n(0,"th",38),r(1,"Ordered by"),o())}function Ze(t,i){if(t&1&&(n(0,"td",40),r(1),o()),t&2){let e=i.$implicit;c(),g((e==null||e.orderedBy==null?null:e.orderedBy.name)??"Admin")}}function et(t,i){t&1&&(n(0,"th",38),r(1,"Status"),o())}function tt(t,i){if(t&1&&(n(0,"td",40)(1,"span",42),r(2),o()()),t&2){let e=i.$implicit;c(),s("ngClass",F(2,Ne,e.category==="Complete",e.category==="Processing",e.category==="Cancel",e.category!=="Complete"&&e.category!=="Processing"&&e.category!=="Cancel")),c(),T(" ",e.category," ")}}function it(t,i){t&1&&(n(0,"th",38),r(1,"Payment Type"),o())}function nt(t,i){if(t&1&&(n(0,"td",40),r(1),o()),t&2){let e=i.$implicit;c(),g(e.type)}}function ot(t,i){t&1&&(n(0,"th",38),r(1,"Order Type"),o())}function at(t,i){if(t&1&&(n(0,"td",40),r(1),w(2,"titlecase"),o()),t&2){let e=i.$implicit;c(),g(A(2,1,e.ordertype))}}function rt(t,i){t&1&&(n(0,"th",38),r(1,"Total"),o())}function lt(t,i){if(t&1&&(n(0,"td",40),r(1),w(2,"currency"),o()),t&2){let e,a=i.$implicit,l=p(2);c(),g(O(2,1,a.total,(e=l.storeStore.selectedStore())==null?null:e.currency))}}function ct(t,i){t&1&&(n(0,"th",38),r(1,"Actions"),o())}function mt(t,i){if(t&1){let e=b();n(0,"td",40)(1,"button",43)(2,"mat-icon"),r(3,"more_vert"),o()(),n(4,"mat-menu",null,2)(6,"button",11),x("click",function(){let l=d(e).$implicit,m=p(2);return u(m.viewRecipesDetails(l._id))}),n(7,"mat-icon"),r(8,"visibility"),o(),n(9,"span"),r(10,"View Receipt Details"),o()(),n(11,"button",11),x("click",function(){let l=d(e).$implicit,m=p(2);return u(m.deleteReceipt(l._id))}),n(12,"mat-icon"),r(13,"delete"),o(),n(14,"span"),r(15,"Delete"),o()()()()}if(t&2){let e=R(5);c(),s("matMenuTriggerFor",e)}}function st(t,i){t&1&&S(0,"tr",44)}function pt(t,i){t&1&&S(0,"tr",45)}function dt(t,i){if(t&1&&(n(0,"nav",15),V(1,je,6,3,"a",16,ze),o(),n(3,"mat-tab-nav-panel",null,1)(5,"div",17)(6,"div",18)(7,"table",19),f(8,20),_(9,Ge,2,2,"th",21)(10,Je,2,1,"td",22),C(),f(11,23),_(12,Ke,2,0,"th",21)(13,Ue,2,1,"td",22),C(),f(14,24),_(15,We,2,0,"th",21)(16,Xe,2,1,"td",22),C(),f(17,25),_(18,Ye,2,0,"th",21)(19,Ze,2,1,"td",22),C(),f(20,26),_(21,et,2,0,"th",21)(22,tt,3,7,"td",22),C(),f(23,27),_(24,it,2,0,"th",21)(25,nt,2,1,"td",22),C(),f(26,28),_(27,ot,2,0,"th",21)(28,at,3,3,"td",22),C(),f(29,29),_(30,rt,2,0,"th",21)(31,lt,3,4,"td",22),C(),f(32,30),_(33,ct,2,0,"th",21)(34,mt,16,1,"td",22),C(),_(35,st,1,0,"tr",31)(36,pt,1,0,"tr",32),o(),S(37,"mat-paginator",33),o()()()),t&2){let e=R(4),a=p();s("tabPanel",e),c(),P(a.tabStats),c(6),s("dataSource",a.orders()),c(28),s("matHeaderRowDef",a.displayedColumns),c(),s("matRowDefColumns",a.displayedColumns),c(),s("pageSize",a.pageSize)("pageSizeOptions",a.pageSizeOptions)}}function ut(t,i){t&1&&(n(0,"div",13),S(1,"mat-spinner",46),o())}var qe=class t{queryParams=h(ke);orderService=h(Pe);router=h(G);route=h(j);dialog=h(Fe);storeStore=h(W);query=pe(this.queryParams.getAllParams$);activeTab="all";tabStats;selection=new ie(!0,[]);isDeleting=k(!1);displayedColumns=["select","receiptNo","date","category","type","total","orderedBy","ordertype","actions"];dataSource=de({params:()=>({storeId:this.storeStore.selectedStore()?._id,query:this.query()}),stream:({params:i})=>this.orderService.getSalesReceipts(i.storeId,i.query).pipe(D(e=>{let a=e.data;this.selection.clear(),this.tabStats=[{label:"All Receipts",value:"all",count:a.allReceipts},{label:"Sales",value:"sales",count:a.sales},{label:"Refunds",value:"refund",count:a.refund}]}))});orders=q(()=>this.dataSource.value()?.orders||[]);paginator;pageSize=10;pageSizeOptions=[5,10,25,50];exportService=h(Ie);exportData(i){if(!this.dataSource.value())return;let e=this.dataSource.value().orders,a="receipts";switch(i){case"pdf":this.exportService.exportToPdf(e,a,{from:this.query().start,to:this.query().end});break;case"csv":this.exportService.exportToCSV(e,a);break;case"excel":this.exportService.exportToExcel(e,a);break}}onTabChange(i){this.activeTab=i,this.queryParams.add({type:i})}viewRecipesDetails(i){this.router.navigate(["../",i,"details"],{relativeTo:this.route})}deleteReceipt(i){this.dialog.open(E,{width:"400px",data:{title:"Delete Receipt",message:"Are you sure you want to delete this receipt? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel"}}).afterClosed().subscribe(a=>{a&&(this.isDeleting.set(!0),this.orderService.deleteOrder(i).subscribe({next:()=>{this.isDeleting.set(!1),this.dataSource.reload()},error:l=>{console.error("Error deleting receipt:",l),this.isDeleting.set(!1)}}))})}toggleAllRows(i){i.checked?this.selection.select(...this.dataSource.value()?.orders||[]):this.selection.clear()}isAllSelected(){let i=this.selection.selected.length,e=this.dataSource.value()?.orders?.length||0;return i>0&&i===e}deleteMultiple(){let i=this.selection.selected;if(i.length===0)return;this.dialog.open(E,{width:"400px",data:{title:"Delete Multiple Receipts",message:`Are you sure you want to delete ${i.length} receipt(s)? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel"}}).afterClosed().subscribe(a=>{if(a){this.isDeleting.set(!0);let l=i.map(m=>this.orderService.deleteOrder(m._id).toPromise());Promise.all(l).then(()=>{this.isDeleting.set(!1),this.selection.clear(),this.dataSource.reload()},m=>{console.error("Error deleting receipts:",m),this.isDeleting.set(!1)})}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=L({type:t,selectors:[["app-list-receipts"]],viewQuery:function(e,a){if(e&1&&I(M,5),e&2){let l;B(l=$())&&(a.paginator=l.first)}},decls:35,vars:4,consts:[["exportMenu","matMenu"],["tabPanel",""],["menu","matMenu"],[1,"p-4","min-h-screen"],["mode","indeterminate","color","warn"],["title","Receipts Reports","subtitle","View and manage all receipts"],["actions",""],["matButton","",3,"click"],[1,"mr-2"],["matButton","","color","warn",3,"disabled"],["matButton","filled","color","primary",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["appearance","outlined",1,"py-4"],[1,"flex","items-center","justify-center","min-h-[300px]"],["matButton","","color","warn",3,"click","disabled"],["mat-tab-nav-bar","",1,"grid","grid-cols-3",3,"tabPanel"],["mat-tab-link","",1,"!h-auto","!min-h-[100px]","!px-4","!py-4","border-b",3,"active"],[1,"p-6"],[1,"table-container"],["mat-table","","matSort","",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","receiptNo"],["matColumnDef","date"],["matColumnDef","orderedBy"],["matColumnDef","category"],["matColumnDef","type"],["matColumnDef","ordertype"],["matColumnDef","total"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","","aria-label","Select page",3,"pageSize","pageSizeOptions"],["mat-tab-link","",1,"!h-auto","!min-h-[100px]","!px-4","!py-4","border-b",3,"click","active"],[1,"text-center"],[1,"text-gray-600","font-medium","mb-1"],[1,"text-2xl","font-semibold"],["mat-header-cell",""],[3,"change","checked","indeterminate"],["mat-cell",""],[3,"change","checked"],[1,"inline-block","px-2","py-1","rounded-full","text-xs","font-semibold",3,"ngClass"],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-header-row",""],["mat-row",""],["diameter","40"]],template:function(e,a){if(e&1){let l=b();n(0,"div",3),v(1,He,1,0,"mat-progress-bar",4),n(2,"app-page-header",5),f(3,6),S(4,"date-range-selector")(5,"app-employee-selector"),n(6,"button",7),x("click",function(){return d(l),u(a.dataSource.reload())}),n(7,"mat-icon",8),r(8,"refresh"),o(),r(9," Refresh "),o(),v(10,Qe,4,2,"button",9),n(11,"button",10)(12,"mat-icon",8),r(13,"file_download"),o(),r(14," Export Data "),o(),n(15,"mat-menu",null,0)(17,"button",11),x("click",function(){return d(l),u(a.exportData("pdf"))}),n(18,"mat-icon"),r(19,"picture_as_pdf"),o(),n(20,"span"),r(21,"Export as PDF"),o()(),n(22,"button",11),x("click",function(){return d(l),u(a.exportData("csv"))}),n(23,"mat-icon"),r(24,"description"),o(),n(25,"span"),r(26,"Export as CSV"),o()(),n(27,"button",11),x("click",function(){return d(l),u(a.exportData("excel"))}),n(28,"mat-icon"),r(29,"table_chart"),o(),n(30,"span"),r(31,"Export as Excel"),o()()(),C(),o(),n(32,"mat-card",12),v(33,dt,38,6)(34,ut,2,0,"div",13),o()()}if(e&2){let l=R(16);c(),y(a.isDeleting()?1:-1),c(9),y(a.selection.selected.length>0?10:-1),c(),s("matMenuTriggerFor",l),c(22),y(a.dataSource.hasValue()?33:34)}},dependencies:[Q,N,we,xe,he,ye,Se,ge,Re,be,ve,Me,Te,De,M,re,oe,ne,ae,U,K,J,Y,X,Ee,ce,me,Ce,ue,fe,_e,le,$e,Be,te,ee,Ae,Le,Ve,se,Oe,Z,z,H],styles:["[_nghost-%COMP%]     .mat-mdc-tab-nav-bar{border-bottom:none}.mat-mdc-tab-link[_ngcontent-%COMP%]{opacity:1!important}"]})};export{qe as ListReceiptsComponent};
