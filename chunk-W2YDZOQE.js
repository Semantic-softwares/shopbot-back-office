import{a as ot}from"./chunk-OWMQUOUJ.js";import{a as at}from"./chunk-C2NP2QWT.js";import{a as rt}from"./chunk-5IUJBRG3.js";import{a as nt}from"./chunk-I7TFDAUW.js";import{a as it}from"./chunk-BRU3VHNH.js";import"./chunk-KNO5HCLP.js";import"./chunk-GWC7K72H.js";import{b as Ke,f as Xe}from"./chunk-CU623SSI.js";import{c as et}from"./chunk-7FQZXLFT.js";import{a as Ye}from"./chunk-QLYTOGCJ.js";import{c as tt}from"./chunk-XNNKKASY.js";import"./chunk-XVOO3XAI.js";import{c as ze,d as Ue,e as je,f as He,g as qe,h as Qe}from"./chunk-Y2RO63AQ.js";import{a as Je,b as Ze}from"./chunk-OYJDXI6U.js";import{a as We}from"./chunk-JZKRHT5H.js";import"./chunk-O4OM35BU.js";import{a as Te,b as Ie,c as Ne,d as Pe,e as Le,f as Ve,g as Oe,h as Be,i as Ae,j as $e,k as Ge}from"./chunk-GTRRE3DU.js";import"./chunk-S5GZV54O.js";import{a as Me,b as Fe}from"./chunk-4XV2UKEU.js";import"./chunk-CP5EC6RD.js";import"./chunk-CCJ2KI64.js";import"./chunk-6RCOBA75.js";import"./chunk-A24HMJCQ.js";import{a as re,b as se,c as le,d as ce}from"./chunk-Q4U6FYZ3.js";import{i as Y}from"./chunk-QC7H4KPM.js";import{a as we,b as Ee}from"./chunk-P4SPQCUJ.js";import{d as W}from"./chunk-R6JGHN2R.js";import{d as ye}from"./chunk-BXJEGH2V.js";import"./chunk-64WHNS37.js";import"./chunk-TIVXUJ22.js";import"./chunk-W7B5PSOS.js";import"./chunk-XLZTIYSF.js";import{c as Re,d as be}from"./chunk-UMV4DCPT.js";import{a as fe,d as Ce,e as xe,h as Se}from"./chunk-G3VZM262.js";import"./chunk-BCE7WRWQ.js";import{a as ke,b as De}from"./chunk-6I3AJKA7.js";import{B as ve,b as de,g as me,h as ue,m as pe,s as _e,t as ge,z as he}from"./chunk-W7NMJLMQ.js";import"./chunk-F5SZ3AU3.js";import{a as X}from"./chunk-4UBDYPTG.js";import"./chunk-YXRAJPAB.js";import"./chunk-UVV7QZRX.js";import"./chunk-TILT22SG.js";import"./chunk-BFT2MTJY.js";import{a as ie,c as ne,e as oe,h as ae}from"./chunk-3E3PJ7Q7.js";import"./chunk-FO4KTVQ3.js";import"./chunk-TRZH7NMW.js";import"./chunk-GXTELBJV.js";import{b as ee,c as te}from"./chunk-JPRPNQOM.js";import{Z as J,_ as Z,ba as K}from"./chunk-3LDCGXHW.js";import{e as q,g as Q}from"./chunk-ZLVQTB5B.js";import{g as G,l as z,m as U,q as j,s as H}from"./chunk-6PFJHDFS.js";import{Fc as $,H as P,Ib as x,Jb as S,L,Lc as y,Mb as O,Mc as I,Nb as B,Nc as M,Ob as _,Pb as n,Qb as o,Rb as k,Vb as f,Vc as w,Wb as C,Yb as g,ac as p,bb as c,cc as d,fa as b,ka as m,la as u,mc as T,qb as V,rc as r,sc as R,tc as D,uc as A,wa as h,wb as v}from"./chunk-J2AK4FW5.js";import{g as F}from"./chunk-GAL4ENT6.js";var lt=()=>[5,10,25,50,100],ct=(a,e)=>e.value;function dt(a,e){if(a&1&&(n(0,"mat-option",21)(1,"span",34),k(2,"span",35),r(3),o()()),a&2){let t=e.$implicit;_("value",t.value),c(2),_("ngClass","bg-"+t.color+"-500 ring-"+t.color+"-200"),c(),D(" ",t.label," ")}}function mt(a,e){a&1&&(n(0,"th",52),r(1,"Confirmation #"),o())}function ut(a,e){if(a&1){let t=g();n(0,"td",53)(1,"mat-chip",54),p("click",function(s){let l=m(t).$implicit,E=d(3);return s.stopPropagation(),u(E.viewReservation(l))}),r(2),o()()}if(a&2){let t=e.$implicit;c(2),D(" ",t.confirmationNumber," ")}}function pt(a,e){a&1&&(n(0,"th",52),r(1,"Guest Information"),o())}function _t(a,e){if(a&1&&(n(0,"td",53),r(1),y(2,"getGuestName"),o()),a&2){let t=e.$implicit;c(),D(" ",I(2,1,t.guest)," ")}}function gt(a,e){a&1&&(n(0,"th",52),r(1,"Room Details"),o())}function ht(a,e){if(a&1&&(n(0,"td",53),r(1),o()),a&2){let t=e.$implicit;c(),D(" ",t.rooms.length," Room(s) ")}}function vt(a,e){a&1&&(n(0,"th",52),r(1,"Stay Period"),o())}function ft(a,e){if(a&1&&(n(0,"td",53),r(1),y(2,"date"),y(3,"date"),o()),a&2){let t=e.$implicit;c(),A(" ",M(2,2,t.checkInDate,"MMM dd, yyyy")," - ",M(3,5,t.checkOutDate,"MMM dd, yyyy")," ")}}function Ct(a,e){a&1&&(n(0,"th",52),r(1,"Nights"),o())}function xt(a,e){if(a&1&&(n(0,"td",53),r(1),o()),a&2){let t=e.$implicit;c(),D(" ",t.numberOfNights," ")}}function St(a,e){a&1&&(n(0,"th",52),r(1,"Status"),o())}function Rt(a,e){if(a&1&&(n(0,"td",53)(1,"mat-chip",55),r(2),y(3,"titlecase"),o()()),a&2){let t=e.$implicit,i=d(3);c(),_("ngClass",i.getStatusChipClass(t.status)),c(),D(" ",I(3,2,t.status)," ")}}function bt(a,e){a&1&&(n(0,"th",52),r(1,"Total Amount"),o())}function kt(a,e){if(a&1&&(n(0,"td",53)(1,"div",56),r(2),y(3,"currency"),o()()),a&2){let t,i=e.$implicit,s=d(3);c(2),R(M(3,1,i.pricing==null?null:i.pricing.total,(t=s.storeStore.selectedStore())==null?null:t.currency))}}function Dt(a,e){a&1&&(n(0,"th",52),r(1,"Actions"),o())}function wt(a,e){if(a&1){let t=g();n(0,"button",58),p("click",function(){m(t);let s=d().$implicit,l=d(3);return u(l.editReservation(s))}),n(1,"mat-icon"),r(2,"edit"),o(),n(3,"span"),r(4,"Edit"),o()()}}function Et(a,e){if(a&1){let t=g();n(0,"button",58),p("click",function(){m(t);let s=d().$implicit,l=d(3);return u(l.openRoomChangeDialog(s))}),n(1,"mat-icon"),r(2,"swap_horiz"),o(),n(3,"span"),r(4,"Change Room"),o()()}}function yt(a,e){if(a&1){let t=g();k(0,"mat-divider"),n(1,"button",58),p("click",function(){m(t);let s=d().$implicit,l=d(3);return u(l.deleteReservation(s))}),n(2,"mat-icon",60),r(3,"delete"),o(),n(4,"span"),r(5,"Delete Reservation"),o()()}}function Mt(a,e){if(a&1){let t=g();n(0,"td",53)(1,"button",57),p("click",function(s){return m(t),u(s.stopPropagation())}),n(2,"mat-icon"),r(3,"more_vert"),o()(),n(4,"mat-menu",null,1)(6,"button",58),p("click",function(){let s=m(t).$implicit,l=d(3);return u(l.viewReservation(s))}),n(7,"mat-icon"),r(8,"visibility"),o(),n(9,"span"),r(10,"View Details"),o()(),x(11,wt,5,0,"button",59),x(12,Et,5,0,"button",59),x(13,yt,6,0),o()()}if(a&2){let t=e.$implicit,i=T(5),s=d(3);c(),_("matMenuTriggerFor",i),c(10),S(s.canEdit(t)?11:-1),c(),S(s.canChangeRooms(t)?12:-1),c(),S(s.canDelete(t)?13:-1)}}function Ft(a,e){a&1&&k(0,"tr",61)}function Tt(a,e){if(a&1){let t=g();n(0,"tr",62),p("click",function(){let s=m(t).$implicit,l=d(3);return u(l.viewReservation(s))}),o()}}function It(a,e){if(a&1){let t=g();n(0,"table",37),f(1,38),v(2,mt,2,0,"th",39)(3,ut,3,1,"td",40),C(),f(4,41),v(5,pt,2,0,"th",39)(6,_t,3,3,"td",40),C(),f(7,42),v(8,gt,2,0,"th",39)(9,ht,2,1,"td",40),C(),f(10,43),v(11,vt,2,0,"th",39)(12,ft,4,8,"td",40),C(),f(13,44),v(14,Ct,2,0,"th",39)(15,xt,2,1,"td",40),C(),f(16,45),v(17,St,2,0,"th",39)(18,Rt,4,4,"td",40),C(),f(19,46),v(20,bt,2,0,"th",39)(21,kt,4,4,"td",40),C(),f(22,47),v(23,Dt,2,0,"th",39)(24,Mt,14,4,"td",40),C(),v(25,Ft,1,0,"tr",48)(26,Tt,1,0,"tr",49),o(),n(27,"mat-card-actions",50)(28,"mat-paginator",51),p("page",function(s){m(t);let l=d(2);return u(l.onPageChange(s))}),o()()}if(a&2){let t=d(2);_("dataSource",t.reservations.value().reservations),c(25),_("matHeaderRowDef",t.displayedColumns),c(),_("matRowDefColumns",t.displayedColumns),c(2),_("length",t.totalReservations())("pageSize",t.pageSize())("pageSizeOptions",$(7,lt))("pageIndex",t.currentPage()-1)}}function Nt(a,e){if(a&1){let t=g();n(0,"div",36)(1,"div",63)(2,"mat-icon",64),r(3,"hotel"),o()(),n(4,"h3",65),r(5,"No reservations found"),o(),n(6,"p",66),r(7),o(),n(8,"button",67),p("click",function(){m(t);let s=d(2);return u(s.createReservation())}),n(9,"mat-icon"),r(10,"add"),o(),r(11," Create New Reservation "),o()()}if(a&2){let t,i=d(2);c(7),D(" ",(t=i.filterForm.get("search"))!=null&&t.value||(t=i.filterForm.get("status"))!=null&&t.value?"Try adjusting your filters or search terms to find matching reservations.":"Get started by creating your first reservation to begin managing your hotel bookings."," ")}}function Pt(a,e){if(a&1&&(x(0,It,29,8),x(1,Nt,12,1,"div",36)),a&2){let t=d();S(t.reservations.value().reservations.length>0?0:-1),c(),S(t.reservations.value().reservations.length===0?1:-1)}}function Lt(a,e){if(a&1){let t=g();n(0,"div",32)(1,"div",68)(2,"mat-icon",69),r(3,"error"),o(),n(4,"div")(5,"h3",70),r(6,"Error loading reservations"),o(),n(7,"p",71),r(8),o(),n(9,"div",72)(10,"button",73),p("click",function(){m(t);let s=d();return u(s.refreshReservations())}),n(11,"mat-icon",5),r(12,"refresh"),o(),r(13," Retry "),o(),n(14,"button",74),p("click",function(){m(t);let s=d();return u(s.clearError())}),r(15,"Dismiss"),o()()()()()}if(a&2){let t=d();c(8),R(t.reservations.error())}}function Vt(a,e){a&1&&(n(0,"div",33),k(1,"mat-spinner",75),o())}var st=class a{router=b(Q);route=b(q);fb=b(he);reservationService=b(nt);storeStore=b(Y);snackBar=b(X);dialog=b(tt);currentPage=h(1);pageSize=h(10);statusUpdating=h(new Set);searchFilter=h("");statusFilter=h("");dateFromFilter=h(null);dateToFilter=h(null);sortByFilter=h("createdAt");sortOrderFilter=h("desc");filterForm=this.fb.group({search:[""],status:[""],dateRange:this.fb.group({start:[null],end:[null]}),sortBy:["createdAt"],sortOrder:["desc"]});confirmedCount=w(()=>this.reservations.value()?.reservations.filter(e=>e.status==="confirmed").length);checkedInCount=w(()=>this.reservations.value()?.reservations.filter(e=>e.status==="checked_in").length);pendingCount=w(()=>this.reservations.value()?.reservations.filter(e=>e.status==="pending").length);cancelledCount=w(()=>this.reservations.value()?.reservations.filter(e=>e.status==="cancelled").length);totalRevenue=w(()=>this.reservations.value()?.reservations.reduce((e,t)=>e+this.getEffectiveTotal(t),0));totalReservations=w(()=>this.reservations.value()?.total||0);filterParams=w(()=>{let t={storeId:this.storeStore.selectedStore()?._id,page:this.currentPage(),limit:this.pageSize(),sortBy:this.sortByFilter(),sortOrder:this.sortOrderFilter()};return this.searchFilter()&&this.searchFilter().trim()&&(t.search=this.searchFilter().trim()),this.statusFilter()&&this.statusFilter().trim()&&(t.status=this.statusFilter().trim()),this.dateFromFilter()&&(t.dateFrom=new Date(this.dateFromFilter()).toISOString().split("T")[0]),this.dateToFilter()&&(t.dateTo=new Date(this.dateToFilter()).toISOString().split("T")[0]),t});displayedColumns=["confirmationNumber","guest","rooms","stayPeriod","nights","status","total","actions"];statusOptions=[{value:"",label:"All Statuses",color:"gray"},{value:"pending",label:"Pending",color:"orange"},{value:"confirmed",label:"Confirmed",color:"blue"},{value:"checked_in",label:"Checked In",color:"green"},{value:"checked_out",label:"Checked Out",color:"purple"},{value:"cancelled",label:"Cancelled",color:"red"},{value:"no_show",label:"No Show",color:"gray"}];constructor(){this.filterForm.valueChanges.pipe(P(300),L()).subscribe(e=>{console.log("Form values changed:",e),this.currentPage.set(1),this.searchFilter.set(e.search||""),this.statusFilter.set(e.status||""),this.dateFromFilter.set(e.dateRange?.start||null),this.dateToFilter.set(e.dateRange?.end||null),this.sortByFilter.set(e.sortBy||"createdAt"),this.sortOrderFilter.set(e.sortOrder||"desc")})}reservations=ye({params:()=>({params:this.filterParams()}),stream:({params:e})=>this.reservationService.getReservations(e.params)});loadReservations(){}onPageChange(e){this.currentPage.set(e.pageIndex+1),this.pageSize.set(e.pageSize),this.loadReservations()}clearFilters(){this.filterForm.reset({search:"",status:"",dateRange:{start:null,end:null},sortBy:"createdAt",sortOrder:"desc"}),this.searchFilter.set(""),this.statusFilter.set(""),this.dateFromFilter.set(null),this.dateToFilter.set(null),this.sortByFilter.set("createdAt"),this.sortOrderFilter.set("desc"),this.currentPage.set(1)}refreshReservations(){this.loadReservations()}getStatusColor(e){return this.statusOptions.find(i=>i.value===e)?.color||"gray"}getStatusChipClass(e){return{pending:"bg-yellow-500! text-white!",confirmed:"bg-blue-600! text-white!",checked_in:"bg-green-600! text-white!",checked_out:"bg-gray-500! text-white!",cancelled:"bg-red-600! text-white!",no_show:"bg-orange-600! text-white!",reserved:"bg-indigo-600! text-white!"}[e]||"bg-gray-500! text-white!"}getGuestName(e){return typeof e.guest=="object"&&e.guest!==null?e.guest.firstName+" "+e.guest.lastName:String(e.guest)}getRoomNumbers(e){return e.rooms.map(t=>typeof t.room=="string"?t.room:t.room.roomNumber).join(", ")}reloadData(){this.reservations.reload()}createReservation(){this.dialog.open(at,{width:"600px",disableClose:!1}).afterClosed().subscribe(t=>{t&&this.router.navigate(["../create"],{relativeTo:this.route.parent,queryParams:{quickReservation:JSON.stringify(t)}})})}viewReservation(e){this.router.navigate(["../edit",e._id],{relativeTo:this.route.parent})}editReservation(e){this.router.navigate(["../edit",e._id],{relativeTo:this.route.parent})}checkInReservation(e){e.status==="confirmed"&&this.reservationService.checkInReservation(e._id).subscribe({next:()=>{this.refreshReservations()},error:t=>{console.error("Error checking in reservation:",t)}})}checkOutReservation(e){e.status==="checked_in"&&this.reservationService.checkOutReservation(e._id).subscribe({next:()=>{this.refreshReservations()},error:t=>{console.error("Error checking out reservation:",t)}})}cancelReservation(e){let t=prompt("Please provide a reason for cancellation:");t&&this.reservationService.cancelReservation(e._id,t).subscribe({next:()=>{this.refreshReservations()},error:i=>{console.error("Error cancelling reservation:",i)}})}canCheckIn(e){return e.status==="confirmed"&&new Date(e.checkInDate)<=new Date}canCheckOut(e){return e.status==="checked_in"}canCancel(e){return["pending","confirmed"].includes(e.status)}canEdit(e){return e.status!=="cancelled"&&e.status!=="checked_out"&&e.status!=="no_show"&&e.status!=="checked_in"&&!e.actualCheckInDate}canChangeRooms(e){return e.status!=="cancelled"&&e.status!=="checked_out"&&e.status!=="no_show"}openRoomChangeDialog(e){return F(this,null,function*(){if(!this.canChangeRooms(e)){this.snackBar.open("Cannot change rooms for this reservation","Close",{duration:3e3});return}this.dialog.open(rt,{width:"500px",maxWidth:"95vw",disableClose:!0,data:{reservationId:e._id,currentRooms:e.rooms,checkInDate:new Date(e.checkInDate).toISOString(),checkOutDate:new Date(e.checkOutDate).toISOString(),numberOfNights:e.numberOfNights,currency:this.storeStore.selectedStore()?.currency||"USD",actualCheckInDate:e.actualCheckInDate?new Date(e.actualCheckInDate).toISOString():void 0,reservationStatus:e.status}}).afterClosed().subscribe(i=>F(this,null,function*(){if(i)try{(yield this.reservationService.changeRooms(e._id,i).toPromise())?.success&&(this.snackBar.open("Room changed successfully","Close",{duration:3e3}),this.reloadData())}catch(s){console.error("Error changing rooms:",s);let l=s?.error?.error||s?.error?.message||s?.message||"Failed to change rooms";this.snackBar.open(l,"Close",{duration:5e3})}}))})}canDelete(e){return["pending","cancelled","no_show"].includes(e.status)}deleteReservation(e){let t=this.storeStore.selectedStore();if(!t?._id){this.snackBar.open("No store selected","Close",{duration:3e3});return}let i={storeId:t._id,actionDescription:`delete reservation ${e.confirmationNumber}`,reservationId:e._id};this.dialog.open(ot,{data:i,width:"500px",maxWidth:"90vw",disableClose:!0}).afterClosed().subscribe(l=>{l?.authorized&&l.pin&&this.performReservationDeletion(e,l.pin)})}performReservationDeletion(e,t){let i=new Set(this.statusUpdating());i.add(e._id),this.statusUpdating.set(i),this.reservationService.deleteReservationWithPin(e._id,t).subscribe({next:s=>{let E=(this.reservations.value()?.reservations||[]).filter(N=>N._id!==e._id);this.snackBar.open(`Reservation ${e.confirmationNumber} deleted successfully`,"Close",{duration:5e3})},error:s=>{console.error("Error deleting reservation:",s),this.snackBar.open(s.message||"Failed to delete reservation","Close",{duration:5e3,panelClass:["error-snackbar"]})},complete:()=>{let s=new Set(this.statusUpdating());s.delete(e._id),this.statusUpdating.set(s)}})}allStatusOptions=[{value:"pending",label:"Pending",icon:"schedule",color:"#f59e0b"},{value:"confirmed",label:"Confirmed",icon:"check_circle",color:"#10b981"},{value:"checked_in",label:"Checked In",icon:"login",color:"#3b82f6"},{value:"checked_out",label:"Checked Out",icon:"logout",color:"#6b7280"},{value:"cancelled",label:"Cancelled",icon:"cancel",color:"#ef4444"},{value:"no_show",label:"No Show",icon:"person_off",color:"#f97316"}];isValidStatusTransition(e,t){return{pending:["confirmed","cancelled","no_show"],confirmed:["checked_in","cancelled","no_show"],checked_in:["checked_out"],checked_out:[],cancelled:[],no_show:[]}[e]?.includes(t)||!1}getStatusTransitionError(e,t){switch(t){case"checked_in":return'Guests can only be checked in when reservation status is "Confirmed"';case"checked_out":return'Guests can only be checked out when reservation status is "Checked In"';case"confirmed":return e==="checked_in"?"Cannot change back to confirmed after check-in":e==="checked_out"?"Cannot change back to confirmed after check-out":"Invalid status transition";default:return`Cannot change status from "${e}" to "${t}"`}}requiresPaymentBeforeCheckout(e){let t=e.pricing.balance>0,i=e.paymentInfo?.status!=="paid";return t&&i}isStatusUpdating(e){return this.statusUpdating().has(e)}getStatusColorHex(e){return{pending:"#f59e0b",confirmed:"#10b981",checked_in:"#3b82f6",checked_out:"#6b7280",cancelled:"#ef4444",no_show:"#f97316"}[e]||"#6b7280"}getStatusIcon(e){return{pending:"schedule",confirmed:"check_circle",checked_in:"login",checked_out:"logout",cancelled:"cancel",no_show:"person_off"}[e]||"help"}clearError(){this.loadReservations()}exportReservations(){try{let e=this.generateCSV(),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(i.download!==void 0){let s=URL.createObjectURL(t);i.setAttribute("href",s),i.setAttribute("download",this.generateExportFilename()),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),this.snackBar.open("Reservations exported successfully","Close",{duration:3e3})}}catch(e){console.error("Error exporting reservations:",e),this.snackBar.open("Failed to export reservations","Close",{duration:5e3,panelClass:["error-snackbar"]})}}generateCSV(){let t=[["Confirmation Number","Guest Name","Email","Phone","Room Numbers","Check-in Date","Check-out Date","Check-in Time","Check-out Time","Status","Adults","Children","Nights","Subtotal","Taxes","Total","Balance","Payment Status","Created Date","Special Requests/Notes"].join(",")];return this.reservations.value()?.reservations.forEach(i=>{let s=[this.escapeCsvField(i.confirmationNumber||""),this.escapeCsvField(this.getGuestName(i)),this.escapeCsvField(typeof i.guest!="string"&&i.guest?.email||""),this.escapeCsvField(typeof i.guest!="string"&&i.guest?.phone||""),this.escapeCsvField(this.getRoomNumbers(i)),this.formatDateForCSV(i.checkInDate),this.formatDateForCSV(this.getEffectiveCheckOutDate(i)),this.escapeCsvField(i.expectedCheckInTime||""),this.escapeCsvField(i.expectedCheckOutTime||""),this.escapeCsvField(i.status||""),i.numberOfNights||0,i.pricing?.subtotal||0,i.pricing?.taxes||0,this.getEffectiveTotal(i),i.pricing?.balance||0,this.escapeCsvField(i.paymentInfo?.status||"pending"),this.formatDateForCSV(i.createdAt),this.escapeCsvField(i.specialRequests||i.internalNotes||"")];t.push(s.join(","))}),t.join(`
`)}escapeCsvField(e){if(e==null)return"";let t=String(e);return t.includes(",")||t.includes('"')||t.includes(`
`)?`"${t.replace(/"/g,'""')}"`:t}formatDateForCSV(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}):""}generateExportFilename(){let e=new Date,t=e.toISOString().split("T")[0],i=e.toTimeString().split(" ")[0].replace(/:/g,"-"),s=`reservations_${t}_${i}`,l=this.filterForm.value;return l.search&&(s+=`_search-${l.search.replace(/[^a-zA-Z0-9]/g,"")}`),l.status&&(s+=`_${l.status}`),(l.dateRange?.start||l.dateRange?.end)&&(s+="_filtered"),`${s}.csv`}hasApprovedExtensions(e){return!!(e.extensions&&e.extensions.some(t=>t.status==="approved"))}getEffectiveCheckOutDate(e){if(this.hasApprovedExtensions(e)){let t=e.extensions?.filter(i=>i.status==="approved")||[];if(t.length>0)return t.reduce((s,l)=>{let E=new Date(s.newCheckOutDate);return new Date(l.newCheckOutDate)>E?l:s}).newCheckOutDate}return e.checkOutDate}getExtensionNights(e){return e.extensions?e.extensions.filter(i=>i.status==="approved").reduce((i,s)=>i+(s.additionalNights||0),0):0}getApprovedExtensionCost(e){return e.extensions?e.extensions.filter(i=>i.status==="approved").reduce((i,s)=>i+(s.additionalCost||0),0):0}getEffectiveTotal(e){return e.pricing?.total||0}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=V({type:a,selectors:[["app-reservations-list"]],decls:103,vars:17,consts:[["dateRangePicker",""],["actionMenu","matMenu"],["title","Reservations","subtitle","Manage hotel reservations and guest bookings","viewToggleRoute","/menu/hms/front-desk/reservations/view",3,"showViewToggle"],["actions",""],["matButton","outlined",3,"click"],[1,"mr-1"],["matButton","filled",3,"click"],[1,"max-w-12xl","py-6"],[1,"grid","grid-cols-2","md:grid-cols-3","lg:grid-cols-6","gap-4"],["appearance","outlined"],[1,"p-4!"],[1,"text-sm","text-gray-600"],[1,"text-2xl","font-bold"],[1,"p-3"],[3,"formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","xl:grid-cols-6","gap-4","mb-4"],[1,"lg:col-span-2"],["appearance","outline",1,"w-full"],["matPrefix","",1,"text-gray-400"],["matInput","","placeholder","Guest name or confirmation #","formControlName","search"],["formControlName","status"],[3,"value"],[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date"],["matIconSuffix","",3,"for"],["formControlName","sortBy"],["value","createdAt"],["value","checkInDate"],["value","checkOutDate"],["value","total"],["value","guestName"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","m-4"],[1,"flex","items-center","justify-center","py-20"],[1,"flex","items-center"],[1,"w-3","h-3","rounded-full","mr-3","ring-2",3,"ngClass"],[1,"py-20","text-center"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","confirmationNumber"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","guest"],["matColumnDef","rooms"],["matColumnDef","stayPeriod"],["matColumnDef","nights"],["matColumnDef","status"],["matColumnDef","total"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","cursor-pointer",3,"click",4,"matRowDef","matRowDefColumns"],[1,"flex","justify-end"],["showFirstLastButtons","",3,"page","length","pageSize","pageSizeOptions","pageIndex"],["mat-header-cell",""],["mat-cell",""],[3,"click"],[3,"ngClass"],[1,"font-bold"],["mat-icon-button","",3,"click","matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item",""],["color","warn"],["mat-header-row",""],["mat-row","",1,"cursor-pointer",3,"click"],[1,"w-16","h-16","bg-gray-200","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],[1,"text-4xl","text-gray-400"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-500","mb-6"],["matButton","filled","color","primary",3,"click"],[1,"flex"],[1,"text-red-500","mr-2"],[1,"text-red-800","font-medium"],[1,"text-red-700","text-sm","mt-1"],[1,"mt-3","flex","space-x-3"],["mat-button","","color","warn",1,"!text-red-600",3,"click"],["mat-button","",1,"!text-gray-600",3,"click"],["diameter","48"]],template:function(t,i){if(t&1){let s=g();n(0,"app-page-header",2),f(1,3),n(2,"button",4),p("click",function(){return m(s),u(i.clearFilters())}),n(3,"mat-icon"),r(4,"clear"),o(),r(5," Clear Filters "),o(),n(6,"button",4),p("click",function(){return m(s),u(i.reloadData())}),n(7,"mat-icon",5),r(8,"refresh"),o(),r(9," Reload "),o(),n(10,"button",4),p("click",function(){return m(s),u(i.exportReservations())}),n(11,"mat-icon",5),r(12,"download"),o(),r(13," Export "),o(),n(14,"button",6),p("click",function(){return m(s),u(i.createReservation())}),n(15,"mat-icon",5),r(16,"add"),o(),r(17," Create Reservation "),o(),C(),o(),n(18,"div",7)(19,"div",8)(20,"mat-card",9)(21,"mat-card-content",10)(22,"div",11),r(23,"Total"),o(),n(24,"div",12),r(25),o()()(),n(26,"mat-card",9)(27,"mat-card-content",10)(28,"div",11),r(29,"Confirmed"),o(),n(30,"div",12),r(31),o()()(),n(32,"mat-card",9)(33,"mat-card-content",10)(34,"div",11),r(35,"Checked In"),o(),n(36,"div",12),r(37),o()()(),n(38,"mat-card",9)(39,"mat-card-content",10)(40,"div",11),r(41,"Pending"),o(),n(42,"div",12),r(43),o()()(),n(44,"mat-card",9)(45,"mat-card-content",10)(46,"div",11),r(47,"Cancelled"),o(),n(48,"div",12),r(49),o()()(),n(50,"mat-card",9)(51,"mat-card-content",10)(52,"div",11),r(53,"Revenue"),o(),n(54,"div",12),r(55),y(56,"currency"),o()()()()(),n(57,"mat-card",9)(58,"div",13)(59,"form",14)(60,"div",15)(61,"div",16)(62,"mat-form-field",17)(63,"mat-label"),r(64,"Search reservations..."),o(),n(65,"mat-icon",18),r(66,"search"),o(),k(67,"input",19),o()(),n(68,"div")(69,"mat-form-field",17)(70,"mat-label"),r(71,"Status"),o(),n(72,"mat-select",20),O(73,dt,4,3,"mat-option",21,ct),o()()(),n(75,"div",16)(76,"mat-form-field",17)(77,"mat-label"),r(78,"Check-in date range"),o(),n(79,"mat-date-range-input",22),k(80,"input",23)(81,"input",24),o(),k(82,"mat-datepicker-toggle",25)(83,"mat-date-range-picker",null,0),o()(),n(85,"div")(86,"mat-form-field",17)(87,"mat-label"),r(88,"Sort by"),o(),n(89,"mat-select",26)(90,"mat-option",27),r(91,"Created Date"),o(),n(92,"mat-option",28),r(93,"Check-in Date"),o(),n(94,"mat-option",29),r(95,"Check-out Date"),o(),n(96,"mat-option",30),r(97,"Total Amount"),o(),n(98,"mat-option",31),r(99,"Guest Name"),o()()()()()()(),x(100,Pt,2,2),x(101,Lt,16,1,"div",32),x(102,Vt,2,0,"div",33),o()}if(t&2){let s,l,E=T(84);_("showViewToggle",!0),c(25),R(((s=i.reservations.value())==null||s.reservations==null?null:s.reservations.length)||0),c(6),R(i.confirmedCount()||0),c(6),R(i.checkedInCount()||0),c(6),R(i.pendingCount()||0),c(6),R(i.cancelledCount()||0),c(6),R(M(56,14,i.totalRevenue()||0,(l=i.storeStore.selectedStore())==null?null:l.currency)),c(4),_("formGroup",i.filterForm),c(14),B(i.statusOptions),c(6),_("formGroup",i.filterForm.controls.dateRange)("rangePicker",E),c(3),_("for",E),c(18),S(i.reservations.hasValue()?100:-1),c(),S(i.reservations.error()?101:-1),c(),S(i.reservations.isLoading()?102:-1)}},dependencies:[H,G,ve,pe,de,me,ue,ge,_e,Ge,Te,Ne,Oe,Pe,Ie,Be,Le,Ve,Ae,$e,Ze,Je,et,be,Re,Se,fe,Ce,xe,Ee,we,W,K,Z,J,te,ee,Xe,Ke,ae,ie,oe,ne,ce,se,re,le,We,Qe,ze,Ue,je,He,qe,De,ke,Fe,Me,Ye,z,j,U,it],encapsulation:2})};export{st as ReservationsListComponent};
