import{a as be,b as xe}from"./chunk-2OEO6EUM.js";import{a as q}from"./chunk-GU4Z36JA.js";import{a as st,b as Se,c as ve}from"./chunk-7FQZXLFT.js";import{a as Me}from"./chunk-42HNZPKU.js";import{a as Ce}from"./chunk-7FSETBMW.js";import{a as he}from"./chunk-W4KXP7Q5.js";import{a as ct,b as ut}from"./chunk-GZXF4TWP.js";import{d as rt,e as at,f as ge,h as lt,i as mt,j as pt,k as dt}from"./chunk-Y6EIGA75.js";import"./chunk-HJ3KAQ7K.js";import{a as _e}from"./chunk-5HSGNHP2.js";import{a as nt,b as fe}from"./chunk-LCP7K4QH.js";import{a as ue}from"./chunk-JZKRHT5H.js";import{a as ce}from"./chunk-O4OM35BU.js";import{a as te,b as ee,c as ie,d as oe,e as ne,f as re,g as ae,h as le,i as me,j as pe,k as de,l as se}from"./chunk-2UZI5XAB.js";import"./chunk-CP5EC6RD.js";import"./chunk-CCJ2KI64.js";import"./chunk-6RCOBA75.js";import"./chunk-A24HMJCQ.js";import{a as Qt,b as Wt,c as Ut,d as Jt}from"./chunk-Q4U6FYZ3.js";import{i as D}from"./chunk-QC7H4KPM.js";import{a as Zt,b as it}from"./chunk-WZDQ5XTC.js";import{d as Gt,g as Ht}from"./chunk-R6JGHN2R.js";import{d as ot}from"./chunk-BXJEGH2V.js";import"./chunk-64WHNS37.js";import"./chunk-TIVXUJ22.js";import"./chunk-WAHSRZAW.js";import"./chunk-XLZTIYSF.js";import{b as P,c as w,d as N}from"./chunk-UMV4DCPT.js";import{a as I,b as tt,d as Yt,h as k}from"./chunk-G3VZM262.js";import"./chunk-BCE7WRWQ.js";import{a as et,b as R}from"./chunk-6I3AJKA7.js";import{A as Xt,B as Z,b as O,d as g,g as F,h as Q,l as Kt,m as W,n as U,s as J,t as K,v as X,z as Y}from"./chunk-W7NMJLMQ.js";import"./chunk-F5SZ3AU3.js";import{a as j}from"./chunk-4UBDYPTG.js";import"./chunk-TILT22SG.js";import"./chunk-BFT2MTJY.js";import{a as jt,h as zt}from"./chunk-3E3PJ7Q7.js";import"./chunk-FO4KTVQ3.js";import"./chunk-TRZH7NMW.js";import"./chunk-GXTELBJV.js";import{b as $t,c as z}from"./chunk-JPRPNQOM.js";import{Z as Lt,_ as y,ba as T}from"./chunk-3LDCGXHW.js";import"./chunk-ZLVQTB5B.js";import{q as At,s as $}from"./chunk-6PFJHDFS.js";import{Fc as qt,Gc as vt,Ib as s,Jb as c,Lc as Vt,Mb as It,Nb as kt,Nc as Bt,Ob as d,Pb as o,Qb as e,Rb as _,Vb as b,Wb as x,Y as Ft,Yb as _t,ac as C,bb as l,cc as S,fa as u,gc as gt,hc as Ct,ic as St,ka as B,kb as L,la as A,mc as Pt,qb as M,rc as a,sc as E,tc as v,wa as H,wb as h,wc as wt,xc as Nt,yc as Rt}from"./chunk-J2AK4FW5.js";import{a as Dt,b as Ot}from"./chunk-GAL4ENT6.js";function we(t,i){t&1&&(o(0,"mat-error"),a(1," Name is required "),e())}function Ne(t,i){t&1&&(o(0,"mat-error"),a(1," Price is required "),e())}function Re(t,i){t&1&&(o(0,"mat-error"),a(1," Price must be 0 or greater "),e())}var G=class t{constructor(i,n,r){this.fb=i;this.dialogRef=n;this.data=r;this.optionForm=this.fb.group({name:["",g.required],price:[0,[g.required,g.min(0)]],inStock:[!0],store:[this.storeStore.selectedStore()?._id,g.required]}),r.isEdit&&r.option&&this.optionForm.patchValue(r.option)}productService=u(q);storeStore=u(D);snackBar=u(j);isSubmitting=H(!1);optionForm;onSubmit(){if(this.optionForm.valid){this.isSubmitting.set(!0);let i=this.optionForm.getRawValue();(this.data.isEdit?this.productService.updateOption(i,this.data.option._id):this.productService.saveOption(i)).subscribe({next:()=>{this.snackBar.open(`Option ${this.data.isEdit?"updated":"created"} successfully`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dialogRef.close(!0)},error:()=>{this.snackBar.open(`Error ${this.data.isEdit?"updating":"creating"} option`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isSubmitting.set(!1)}})}}onCancel(){this.dialogRef.close()}static \u0275fac=function(n){return new(n||t)(L(Y),L(rt),L(at))};static \u0275cmp=M({type:t,selectors:[["app-option-dialog"]],decls:24,vars:7,consts:[["mat-dialog-title",""],[1,"mb-2"],[3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter option name"],["matInput","","type","number","formControlName","price","min","0"],[1,"flex","items-center","p-4","rounded-lg"],["formControlName","inStock","color","primary"],["matButton","",3,"click"],["matButton","filled","color","primary",3,"disabled"]],template:function(n,r){if(n&1&&(o(0,"h2",0),a(1),e(),o(2,"mat-dialog-content",1)(3,"form",2),C("ngSubmit",function(){return r.onSubmit()}),o(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),a(7,"Name"),e(),_(8,"input",5),s(9,we,2,0,"mat-error"),e(),o(10,"mat-form-field",4)(11,"mat-label"),a(12,"Price"),e(),_(13,"input",6),s(14,Ne,2,0,"mat-error"),s(15,Re,2,0,"mat-error"),e(),o(16,"div",7)(17,"mat-slide-toggle",8),a(18," In Stock "),e()()()()(),o(19,"mat-dialog-actions")(20,"button",9),C("click",function(){return r.onCancel()}),a(21,"Cancel"),e(),o(22,"button",10),a(23),e()()),n&2){let m,p,V;l(),v(" ",r.data.isEdit?"Edit Option":"Create New Option"," "),l(2),d("formGroup",r.optionForm),l(6),c((m=r.optionForm.get("name"))!=null&&m.hasError("required")?9:-1),l(5),c((p=r.optionForm.get("price"))!=null&&p.hasError("required")?14:-1),l(),c((V=r.optionForm.get("price"))!=null&&V.hasError("min")?15:-1),l(7),d("disabled",!r.optionForm.valid||r.isSubmitting()),l(),v(" ",r.isSubmitting()?"Submit...":r.data.isEdit?"Update":"Create"," ")}},dependencies:[dt,lt,pt,mt,P,k,I,tt,N,w,T,y,it,z,Z,W,O,U,F,Q,X,K,J,R,ut,ct],encapsulation:2})};var Fe=t=>({prefix:t}),Ve=(t,i)=>i._id;function Be(t,i){t&1&&(o(0,"div",1),_(1,"mat-spinner",7),e())}function Ae(t,i){t&1&&(o(0,"div",2),a(1," Error loading menus. Please try again. "),e())}function Ge(t,i){if(t&1&&(o(0,"mat-option",16),a(1),e()),t&2){let n=i.$implicit;d("value",n._id),l(),E(n.name)}}function He(t,i){if(t&1&&It(0,Ge,2,2,"mat-option",16,Ve),t&2){let n=S(2);kt(n.menus.value())}}function Le(t,i){t&1&&(o(0,"mat-error"),a(1,"Please select a menu"),e())}function $e(t,i){t&1&&(o(0,"mat-error"),a(1,"Cost price is required"),e())}function je(t,i){t&1&&(o(0,"mat-error"),a(1,"Cost price must be 0 or greater"),e())}function ze(t,i){t&1&&(o(0,"mat-error"),a(1,"Selling price is required"),e())}function Qe(t,i){t&1&&(o(0,"mat-error"),a(1,"Selling price must be 0 or greater"),e())}function We(t,i){t&1&&(o(0,"mat-error"),a(1,"Quantity is required"),e())}function Ue(t,i){t&1&&(o(0,"mat-error"),a(1,"Quantity must be at least 1"),e())}function Je(t,i){t&1&&(o(0,"mat-error"),a(1,"Status is required"),e())}function Ke(t,i){if(t&1&&(o(0,"form",3)(1,"mat-form-field",8)(2,"mat-label"),a(3,"Menu"),e(),o(4,"mat-select",9),s(5,He,2,0),e(),s(6,Le,2,0,"mat-error"),e(),o(7,"div",10)(8,"mat-form-field",8)(9,"mat-label"),a(10,"Cost Price"),e(),o(11,"span",11),a(12),e(),_(13,"input",12),s(14,$e,2,0,"mat-error"),s(15,je,2,0,"mat-error"),e(),o(16,"mat-form-field",8)(17,"mat-label"),a(18,"Selling Price"),e(),o(19,"span",11),a(20),e(),_(21,"input",13),s(22,ze,2,0,"mat-error"),s(23,Qe,2,0,"mat-error"),e()(),o(24,"div",10)(25,"mat-form-field",8)(26,"mat-label"),a(27,"Quantity"),e(),_(28,"input",14),s(29,We,2,0,"mat-error"),s(30,Ue,2,0,"mat-error"),e(),o(31,"mat-form-field",8)(32,"mat-label"),a(33,"Status"),e(),o(34,"mat-select",15)(35,"mat-option",16),a(36,"Active"),e(),o(37,"mat-option",16),a(38,"Inactive"),e()(),s(39,Je,2,0,"mat-error"),e()()()),t&2){let n,r,m,p,V,Mt,ht,bt,xt,Et,yt,Tt,f=S();d("formGroup",f.form),l(5),c(f.menus.hasValue()&&f.menus.value()?5:-1),l(),c((n=f.form.get("menuId"))!=null&&n.hasError("required")?6:-1),l(6),v("",(r=f.storeStore.selectedStore())==null?null:r.currency,"\xA0"),l(),d("options",vt(16,Fe,(m=f.storeStore.selectedStore())==null?null:m.currency)),l(),c((p=f.form.get("costPrice"))!=null&&p.hasError("required")?14:-1),l(),c((V=f.form.get("costPrice"))!=null&&V.hasError("min")?15:-1),l(5),v("",(Mt=f.storeStore.selectedStore())==null?null:Mt.currency,"\xA0"),l(),d("options",vt(18,Fe,(ht=f.storeStore.selectedStore())==null?null:ht.currency)),l(),c((bt=f.form.get("sellingPrice"))!=null&&bt.hasError("required")?22:-1),l(),c((xt=f.form.get("sellingPrice"))!=null&&xt.hasError("min")?23:-1),l(6),c((Et=f.form.get("quantity"))!=null&&Et.hasError("required")?29:-1),l(),c((yt=f.form.get("quantity"))!=null&&yt.hasError("min")?30:-1),l(5),d("value",!0),l(2),d("value",!1),l(2),c((Tt=f.form.get("active"))!=null&&Tt.hasError("required")?39:-1)}}var ft=class t{dialogRef=u(rt);categoryService=u(he);productService=u(q);storeStore=u(D);fb=u(Y);data=u(at);loading=H(!1);form;menus=ot({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:i})=>this.categoryService.getStoreMenus(i.storeId)});ngOnInit(){this.initializeForm()}initializeForm(){this.form=this.fb.group({menuId:["",g.required],productName:[this.data.option.name,g.required],sellingPrice:[this.data.option.price,[g.required,g.min(0)]],costPrice:[0,[g.required,g.min(0)]],quantity:[this.data.option.quantity||1,[g.required,g.min(1)]],active:[!0,g.required]})}onSubmit(){if(this.form.invalid)return;this.loading.set(!0);let i=this.storeStore.selectedStore()?._id,n=parseFloat(this.form.get("sellingPrice")?.value)||0,r=parseFloat(this.form.get("costPrice")?.value)||0,m={name:this.form.get("productName")?.value,price:n,costPrice:r,quantity:this.form.get("quantity")?.value,menu:this.form.get("menuId")?.value,store:i,active:this.form.get("active")?.value,profit:n-r,initialStock:0,criticalStockLevel:0,qty:this.form.get("quantity")?.value};this.productService.convertOptionToFood(m).subscribe({next:()=>{this.loading.set(!1),this.dialogRef.close(!0)},error:p=>{this.loading.set(!1),console.error("Error converting option to food:",p)}})}onCancel(){this.dialogRef.close(!1)}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=M({type:t,selectors:[["app-convert-to-food-dialog"]],decls:11,vars:5,consts:[["mat-dialog-title","",1,"mb-4"],[1,"flex","items-center","justify-center","py-8"],[1,"text-red-600","p-4","bg-red-50","rounded"],[1,"space-y-4",3,"formGroup"],["align","end",1,"mt-6","pt-4","border-t"],["mat-button","",3,"click","disabled"],["matButton","filled","color","primary",3,"click","disabled"],["diameter","40"],["appearance","outline",1,"w-full"],["formControlName","menuId"],[1,"grid","grid-cols-2","gap-4"],["matPrefix",""],["matInput","","currencyMask","","step","0.01","formControlName","costPrice",3,"options"],["matInput","","currencyMask","","step","0.01","formControlName","sellingPrice",3,"options"],["matInput","","type","number","min","1","step","1","formControlName","quantity"],["formControlName","active"],[3,"value"]],template:function(n,r){n&1&&(o(0,"h2",0),a(1),e(),o(2,"mat-dialog-content"),s(3,Be,2,0,"div",1)(4,Ae,2,0,"div",2)(5,Ke,40,20,"form",3),e(),o(6,"mat-dialog-actions",4)(7,"button",5),C("click",function(){return r.onCancel()}),a(8," Cancel "),e(),o(9,"button",6),C("click",function(){return r.onSubmit()}),a(10),e()()),n&2&&(l(),E(r.data.option.name),l(2),c(r.menus.isLoading()?3:r.menus.error()?4:5),l(4),d("disabled",r.loading()),l(2),d("disabled",r.form.invalid||r.loading()),l(),v(" ",r.loading()?"Converting...":"Convert"," "))},dependencies:[$,Z,W,O,U,F,Q,X,K,J,dt,lt,pt,mt,P,k,I,tt,Yt,it,Zt,Gt,Ht,T,y,R,et,N,w,xe,be],encapsulation:2})};var Xe=()=>[5,10,25,100];function Ye(t,i){t&1&&(o(0,"div",10),_(1,"mat-spinner",14),e())}function Ze(t,i){t&1&&_(0,"app-no-record",11)}function ti(t,i){t&1&&_(0,"app-no-record",12)}function ei(t,i){t&1&&(o(0,"th",26),a(1,"Name"),e())}function ii(t,i){if(t&1&&(o(0,"td",27),a(1),e()),t&2){let n=i.$implicit;l(),E(n.name)}}function oi(t,i){t&1&&(o(0,"th",26),a(1,"Price"),e())}function ni(t,i){if(t&1&&(o(0,"td",27),a(1),Vt(2,"currency"),e()),t&2){let n,r=i.$implicit,m=S(2);l(),E(Bt(2,1,r.price,(n=m.storeStore.selectedStore())==null?null:n.currency))}}function ri(t,i){t&1&&(o(0,"th",28),a(1,"In Stock"),e())}function ai(t,i){if(t&1){let n=_t();o(0,"td",27)(1,"mat-slide-toggle",29),C("change",function(){let m=B(n).$implicit,p=S(2);return A(p.toggleInStock(m))}),e()()}if(t&2){let n=i.$implicit;l(),d("checked",n.inStock)}}function li(t,i){t&1&&(o(0,"th",28),a(1,"Actions"),e())}function mi(t,i){if(t&1){let n=_t();o(0,"td",27)(1,"button",30)(2,"mat-icon"),a(3,"more_vert"),e()(),o(4,"mat-menu",null,0)(6,"button",31),C("click",function(){let m=B(n).$implicit,p=S(2);return A(p.editOption(m))}),o(7,"mat-icon"),a(8,"edit"),e(),o(9,"span"),a(10,"Edit"),e()(),o(11,"button",31),C("click",function(){let m=B(n).$implicit,p=S(2);return A(p.convertToFood(m))}),o(12,"mat-icon"),a(13,"fastfood"),e(),o(14,"span"),a(15,"Convert to Product"),e()(),o(16,"button",31),C("click",function(){let m=B(n).$implicit,p=S(2);return A(p.deleteOption(m))}),o(17,"mat-icon"),a(18,"delete"),e(),o(19,"span"),a(20,"Delete"),e()()()()}if(t&2){let n=Pt(5);l(),d("matMenuTriggerFor",n)}}function pi(t,i){t&1&&_(0,"tr",32)}function di(t,i){t&1&&_(0,"tr",33)}function si(t,i){if(t&1&&(o(0,"div",13)(1,"table",15),b(2,16),h(3,ei,2,0,"th",17)(4,ii,2,1,"td",18),x(),b(5,19),h(6,oi,2,0,"th",17)(7,ni,3,4,"td",18),x(),b(8,20),h(9,ri,2,0,"th",21)(10,ai,2,1,"td",18),x(),b(11,22),h(12,li,2,0,"th",21)(13,mi,21,1,"td",18),x(),h(14,pi,1,0,"tr",23)(15,di,1,0,"tr",24),e(),_(16,"mat-paginator",25),e()),t&2){let n=S();l(),d("dataSource",n.dataSource),l(13),d("matHeaderRowDef",n.displayedColumns),l(),d("matRowDefColumns",n.displayedColumns),l(),d("pageSizeOptions",qt(4,Xe))}}var Ie=class t{displayedColumns=["name","price","inStock","actions"];dataSource;searchText="";dialog=u(ge);productService=u(q);storeStore=u(D);snackBar=u(j);paginator;sort;options=ot({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:i})=>this.productService.getStoreOptions(i.storeId).pipe(Ft(n=>{this.dataSource=new se(n),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}))});applyFilter(i){let n=i.target.value;this.dataSource.filter=n.trim().toLowerCase()}openDialog(){this.dialog.open(G,{width:"500px",data:{isEdit:!1}}).afterClosed().subscribe(n=>{n&&this.options.reload()})}editOption(i){this.dialog.open(G,{width:"500px",data:{isEdit:!0,option:i}}).afterClosed().subscribe(r=>{r&&this.options.reload()})}convertToFood(i){this.dialog.open(ft,{width:"500px",data:{option:i}}).afterClosed().subscribe(r=>{r&&(this.snackBar.open("Option converted to product successfully!","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.options.reload())})}deleteOption(i){this.dialog.open(Me,{width:"350px",data:{message:`Are you sure you want to delete ${i.name}?`}}).afterClosed().subscribe(r=>{r&&this.productService.deleteOptionItem(i._id).subscribe({next:()=>{this.options.reload()}})})}toggleInStock(i){let n=Ot(Dt({},i),{inStock:!i.inStock});this.productService.updateOption(n,i._id).subscribe({next:()=>{this.snackBar.open("Option status updated successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.options.reload()},error:()=>{this.snackBar.open("Error updating option status","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})}reloadOptions(){this.options.reload()}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=M({type:t,selectors:[["app-options"]],viewQuery:function(n,r){if(n&1&&(gt(nt,5),gt(st,5)),n&2){let m;Ct(m=St())&&(r.paginator=m.first),Ct(m=St())&&(r.sort=m.first)}},decls:21,vars:2,consts:[["menu","matMenu"],["title","Options","subtitle","Manage product options and variations"],["actions",""],["matButton","","title","Reload options","matTooltip","Reload",3,"click"],["matButton","filled","color","primary",3,"click"],["appearance","outlined"],[1,"flex","items-center","p-4"],[1,"w-96"],["appearance","outline",1,"w-full"],["matInput","","placeholder","Search options",3,"keyup","ngModelChange","ngModel"],[1,"flex","items-center","justify-center","min-h-[300px]"],["icon","error","title","Error","message","An error occurred while fetching options. Please try again later."],["icon","list","title","No Options","message","No options found matching your criteria."],[1,"table-container","rounded-lg","overflow-x-auto"],["diameter","40"],["mat-table","","matSort","",1,"min-w-full",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","","class","bg-gray-50",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","price"],["matColumnDef","inStock"],["mat-header-cell","","class","bg-gray-50",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-row","","class","bg-gray-50",4,"matHeaderRowDef"],["mat-row","","class","hover:bg-gray-50 transition",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of options",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header","",1,"bg-gray-50"],["mat-cell",""],["mat-header-cell","",1,"bg-gray-50"],["color","primary",3,"change","checked"],["mat-icon-button","","aria-label","Option actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row","",1,"bg-gray-50"],["mat-row","",1,"hover:bg-gray-50","transition"]],template:function(n,r){n&1&&(o(0,"app-page-header",1),b(1,2),o(2,"button",3),C("click",function(){return r.reloadOptions()}),o(3,"mat-icon"),a(4,"refresh"),e(),a(5," Refresh "),e(),o(6,"button",4),C("click",function(){return r.openDialog()}),o(7,"mat-icon"),a(8,"add"),e(),a(9," ADD OPTION "),e(),x(),e(),o(10,"mat-card",5)(11,"div",6)(12,"div",7)(13,"mat-form-field",8)(14,"mat-label"),a(15,"Search"),e(),o(16,"input",9),C("keyup",function(p){return r.applyFilter(p)}),Rt("ngModelChange",function(p){return Nt(r.searchText,p)||(r.searchText=p),p}),e()()()(),s(17,Ye,2,0,"div",10)(18,Ze,1,0,"app-no-record",11)(19,ti,1,0,"app-no-record",12)(20,si,17,5,"div",13),e()),n&2&&(l(16),wt("ngModel",r.searchText),l(),c(r.options.isLoading()?17:r.options.error()?18:r.options.hasValue()&&r.dataSource.data.length===0?19:r.options.hasValue()?20:-1))},dependencies:[$,de,te,ie,ae,oe,ee,le,ne,re,me,pe,fe,nt,ve,st,Se,zt,jt,P,k,I,N,w,T,y,Lt,z,$t,Jt,Wt,Qt,Ut,R,et,ue,ce,_e,Ce,Xt,O,F,Kt,ut,ct,At],encapsulation:2})};export{Ie as OptionsComponent};
