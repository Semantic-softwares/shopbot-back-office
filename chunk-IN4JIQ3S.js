import{a as c}from"./chunk-NQRUH5DO.js";import{w as n,x as b}from"./chunk-U2P6GFP5.js";import{$ as d,X as r,d as u,da as R,r as p,va as m}from"./chunk-IQSYHSID.js";import{a as g,b as h}from"./chunk-EQDQRRRY.js";var y=class l{constructor(o){this.http=o}baseUrl=c.apiUrl;roomsSignal=m([]);roomTypesSignal=m([]);loadingSignal=m(!1);errorSignal=m(null);rooms=this.roomsSignal.asReadonly();roomTypes=this.roomTypesSignal.asReadonly();loading=this.loadingSignal.asReadonly();error=this.errorSignal.asReadonly();getRooms(o,e){this.loadingSignal.set(!0),this.errorSignal.set(null);let t=new n;return e&&(e.status?.length&&(t=t.set("status",e.status.join(","))),e.housekeepingStatus?.length&&(t=t.set("housekeepingStatus",e.housekeepingStatus.join(","))),e.roomType?.length&&(t=t.set("roomType",e.roomType.join(","))),e.floor?.length&&(t=t.set("floor",e.floor.join(","))),e.search&&(t=t.set("search",e.search)),e.page!==void 0&&(t=t.set("page",e.page.toString())),e.limit!==void 0&&(t=t.set("limit",e.limit.toString()))),this.http.get(`${this.baseUrl}/rooms/${o}/store`,{params:t}).pipe(r(s=>{this.roomsSignal.set(s),this.loadingSignal.set(!1)}),p(s=>s))}getRoomsPaginated(o,e){this.loadingSignal.set(!0),this.errorSignal.set(null);let t=new n;return e&&(e.status?.length&&(t=t.set("status",e.status.join(","))),e.housekeepingStatus?.length&&(t=t.set("housekeepingStatus",e.housekeepingStatus.join(","))),e.roomType?.length&&(t=t.set("roomType",e.roomType.join(","))),e.floor?.length&&(t=t.set("floor",e.floor.join(","))),e.search&&(t=t.set("search",e.search)),e.page!==void 0&&(t=t.set("page",e.page.toString())),e.limit!==void 0&&(t=t.set("limit",e.limit.toString()))),this.http.get(`${this.baseUrl}/rooms/${o}/store`,{params:t}).pipe(r(s=>{this.roomsSignal.set(s.rooms),this.loadingSignal.set(!1)}))}getRoomsByFloor(o){return this.http.get(`${this.baseUrl}/rooms/${o}/by-floor`)}getRoom(o){return this.http.get(`${this.baseUrl}/rooms/${o}`)}getRoomsByIds(o){if(!o||o.length===0)return new u(t=>{t.next([]),t.complete()});let e=new n().set("ids",o.join(","));return this.http.get(`${this.baseUrl}/rooms/batch`,{params:e})}createRoom(o,e){let t=h(g({},e),{store:o});return this.http.post(`${this.baseUrl}/rooms`,t).pipe(r(s=>{let a=this.roomsSignal();this.roomsSignal.set([...a,s])}))}updateRoom(o,e){return this.http.put(`${this.baseUrl}/rooms/${o}`,e).pipe(r(t=>{let s=this.roomsSignal(),a=s.findIndex(i=>i._id===o||i.id===o);if(a!==-1){let i=[...s];i[a]=t,this.roomsSignal.set(i)}}))}updateRoomStatus(o,e,t){let s={status:e,notes:t};return this.http.put(`${this.baseUrl}/rooms/${o}/status`,s)}updateHousekeepingStatus(o,e,t){let s={housekeepingStatus:e,notes:t};return this.http.put(`${this.baseUrl}/rooms/${o}/housekeeping`,s)}deleteRoom(o){return this.http.delete(`${this.baseUrl}/rooms/${o}`).pipe(r(()=>{let e=this.roomsSignal();this.roomsSignal.set(e.filter(t=>t._id!==o&&t.id!==o))}))}getAvailableRooms(o){let e=new n().set("checkIn",o.checkInDate).set("checkOut",o.checkOutDate);return o.roomTypeId&&(e=e.set("roomTypeId",o.roomTypeId)),o.excludeReservationId&&(e=e.set("excludeReservationId",o.excludeReservationId)),this.http.get(`${this.baseUrl}/rooms/${o.storeId}/availability`,{params:e}).pipe(p(t=>t.data||[]))}getRoomStats(o){return this.http.get(`${this.baseUrl}/rooms/${o}/stats`)}getMaintenanceRooms(o){return this.http.get(`${this.baseUrl}/rooms/${o}/maintenance`)}bulkUpdateRoomStatus(o,e,t){let s={roomIds:o,status:e,notes:t};return this.http.put(`${this.baseUrl}/rooms/bulk/status`,s)}getRoomTypes(o,e){this.loadingSignal.set(!0),this.errorSignal.set(null);let t=new n;return e&&(e.active!==void 0&&(t=t.set("active",e.active.toString())),e.minPrice!==void 0&&(t=t.set("minPrice",e.minPrice.toString())),e.maxPrice!==void 0&&(t=t.set("maxPrice",e.maxPrice.toString())),e.amenities?.length&&(t=t.set("amenities",e.amenities.join(","))),e.search&&(t=t.set("search",e.search))),this.http.get(`${this.baseUrl}/room-types/${o}/store`,{params:t}).pipe(r(s=>{this.roomTypesSignal.set(s),this.loadingSignal.set(!1)}),p(s=>s))}getRoomType(o){return this.http.get(`${this.baseUrl}/room-types/${o}`)}createRoomType(o,e){let t=h(g({},e),{store:o});return this.http.post(`${this.baseUrl}/room-types`,t).pipe(r(s=>{let a=this.roomTypesSignal();this.roomTypesSignal.set([...a,s])}))}updateRoomType(o,e){return this.http.put(`${this.baseUrl}/room-types/${o}`,e).pipe(r(t=>{let s=this.roomTypesSignal(),a=s.findIndex(i=>i._id===o||i.id===o);if(a!==-1){let i=[...s];i[a]=t,this.roomTypesSignal.set(i)}}))}deleteRoomType(o){return this.http.delete(`${this.baseUrl}/room-types/${o}`).pipe(r(()=>{let e=this.roomTypesSignal();this.roomTypesSignal.set(e.filter(t=>t._id!==o&&t.id!==o))}))}getAvailableRoomTypes(o,e,t){let s=new n().set("checkIn",e).set("checkOut",t);return this.http.get(`${this.baseUrl}/room-types/${o}/availability`,{params:s})}updateRoomTypesSortOrder(o,e){return this.http.put(`${this.baseUrl}/room-types/${o}/sort-order`,e)}getRoomTypeStats(o){return this.http.get(`${this.baseUrl}/room-types/${o}/stats`)}clearState(){this.roomsSignal.set([]),this.roomTypesSignal.set([]),this.errorSignal.set(null),this.loadingSignal.set(!1)}setLoading(o){this.loadingSignal.set(o)}setError(o){this.errorSignal.set(o)}static \u0275fac=function(e){return new(e||l)(R(b))};static \u0275prov=d({token:l,factory:l.\u0275fac,providedIn:"root"})};export{y as a};
