import{a as he,b as be}from"./chunk-ZAOMQAJO.js";import{a as xe}from"./chunk-YZQZHEMG.js";import{a as ve,b as Se}from"./chunk-NYCP7ATN.js";import"./chunk-LCNY3JPX.js";import{a as ye}from"./chunk-4QMHOUIB.js";import{b as ge}from"./chunk-E4PTFC5Z.js";import"./chunk-OKEXGVJ3.js";import{i as O}from"./chunk-ZKQYDJ5W.js";import{a as ue,b as fe}from"./chunk-LCF3SYDV.js";import{d as R}from"./chunk-ZLVLWRZH.js";import{d as _e}from"./chunk-HJGFVW6K.js";import"./chunk-TVH27JLT.js";import"./chunk-G4CZ6LK2.js";import"./chunk-I564X6SI.js";import"./chunk-VTDH2LYT.js";import{b as me,c as se,d as de}from"./chunk-63HT37SK.js";import{a as ne,b as re,c as oe,h as le}from"./chunk-YJCGHVXK.js";import"./chunk-UHBDKNKX.js";import{a as pe,b as ce}from"./chunk-3ZLH5HUN.js";import{B as ie,b as z,d as c,g as J,h as K,m as Q,n as X,s as Y,t as Z,u as ee,v as te,z as ae}from"./chunk-O5GCTPYR.js";import"./chunk-EGLRIU4H.js";import{a as V,b as j}from"./chunk-5TL46KBL.js";import"./chunk-53AK2UWQ.js";import{a as H}from"./chunk-BFT2MTJY.js";import{a as U,b as L,c as $,f as q,h as W}from"./chunk-JONI64R4.js";import"./chunk-H7INH462.js";import"./chunk-OOL2KACG.js";import"./chunk-KZJMNFJ3.js";import"./chunk-G6I3OKXX.js";import{_ as A,ba as B}from"./chunk-4Z2XUZY2.js";import{e as T,g as D}from"./chunk-F436VINI.js";import{A as G,u as P}from"./chunk-H22US2IH.js";import{Ib as d,Jb as p,Ob as _,Pb as t,Qb as e,Rb as s,Vb as k,Wb as I,Y as E,aa as w,ac as x,bb as m,cc as v,fa as u,qb as F,rc as a,tc as N,wa as b}from"./chunk-P5WOETP4.js";import{c as M}from"./chunk-GAL4ENT6.js";var h=class n{http=u(G);apiUrl=H.apiUrl;getPropertySettings(r){return this.http.get(`${this.apiUrl}/admin/channex/properties/${r}/settings`)}updatePropertySettings(r,i){return this.http.patch(`${this.apiUrl}/admin/channex/properties/${r}/settings`,i)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=w({token:n,factory:n.\u0275fac,providedIn:"root"})};function Ee(n,r){n&1&&(t(0,"div",4),s(1,"mat-spinner",38),e())}function we(n,r){if(n&1&&s(0,"app-no-record",5),n&2){let i,o=v();_("message",((i=o.propertyResource.error())==null?null:i.message)||"Unable to load property settings. Please try again.")}}function Fe(n,r){n&1&&(t(0,"mat-error"),a(1,"Minimum price must be greater than 0"),e())}function ke(n,r){n&1&&(t(0,"mat-error"),a(1,"Maximum price must be greater than 0"),e())}function Ie(n,r){n&1&&(t(0,"mat-error"),a(1,"Minimum value is 100 days"),e())}function Ne(n,r){n&1&&(t(0,"mat-error"),a(1,"Maximum value is 730 days"),e())}function Pe(n,r){n&1&&(t(0,"mat-error"),a(1,"Days must be 0 or greater"),e())}function Ge(n,r){n&1&&(t(0,"mat-error"),a(1,"Days must be at least 1"),e())}function Te(n,r){if(n&1&&(t(0,"mat-form-field",25)(1,"mat-label"),a(2,"Max Days Advance"),e(),s(3,"input",39),t(4,"mat-hint"),a(5,"Number of days opened for sale (e.g., 30 for next 30 days)"),e(),d(6,Ge,2,0,"mat-error"),e(),t(7,"p",40),a(8," \u26A0\uFE0F Warning: When you apply max_day_advance, we override existed Availability values to 0 and can't restore it without Full Sync. "),e()),n&2){let i,o=v();m(6),p((i=o.settingsForm.get("max_day_advance"))!=null&&i.hasError("min")?6:-1)}}var Ce=class n{fb=u(ae);storeStore=u(O);propertySettingsService=u(h);route=u(T);router=u(D);snackBar=u(V);settingsForm=this.fb.group({min_price:[null,[c.min(0)]],max_price:[null,[c.min(0)]],allow_availability_autoupdate_on_confirmation:[{value:!0,disabled:!0}],allow_availability_autoupdate_on_modification:[!1],allow_availability_autoupdate_on_cancellation:[!1],state_length:[500,[c.required,c.min(100),c.max(730)]],min_stay_type:["both",c.required],cut_off_time:["00:00:00"],cut_off_days:[0,[c.required,c.min(0)]],max_day_advance_enabled:[!1],max_day_advance:[null,[c.min(1)]]});isSaving=b(!1);propertyId=b(this.storeStore.selectedStore()?.channex?.propertyId);propertyResource=_e({params:()=>({propertyId:this.propertyId()}),stream:({params:r})=>this.propertySettingsService.getPropertySettings(r.propertyId).pipe(E(i=>this.populateForm(i)))});populateForm(r){if(console.log("Populating form with response:",r),!r?.data?.attributes?.settings)return;let i=r.data.attributes.settings;console.log("Populating form with settings:",i),this.settingsForm.patchValue({min_price:i.min_price??void 0,max_price:i.max_price??void 0,allow_availability_autoupdate_on_confirmation:i.allow_availability_autoupdate_on_confirmation??!0,allow_availability_autoupdate_on_modification:i.allow_availability_autoupdate_on_modification??!1,allow_availability_autoupdate_on_cancellation:i.allow_availability_autoupdate_on_cancellation??!1,state_length:i.state_length??500,min_stay_type:i.min_stay_type??"both",cut_off_time:i.cut_off_time??"00:00:00",cut_off_days:i.cut_off_days??0,max_day_advance_enabled:!!i.max_day_advance,max_day_advance:i.max_day_advance??void 0})}saveSettings(){if(!this.settingsForm||!this.settingsForm.valid){this.snackBar.open("Please fix the form errors","Close",{duration:3e3});return}this.isSaving.set(!0);let r=this.propertyId(),f=this.settingsForm.getRawValue(),{max_day_advance_enabled:o}=f,l=M(f,["max_day_advance_enabled"]);o||(l.max_day_advance=null),l.min_price!==null&&l.min_price!==void 0&&(l.min_price=String(l.min_price)),l.max_price!==null&&l.max_price!==void 0&&(l.max_price=String(l.max_price)),this.propertySettingsService.updatePropertySettings(r,l).subscribe({next:()=>{this.isSaving.set(!1),this.snackBar.open("Settings saved successfully","Close",{duration:3e3}),this.propertyResource.reload()},error:g=>{this.isSaving.set(!1);let y=g.error?.message||"Failed to save settings";this.snackBar.open(y,"Close",{duration:5e3})}})}resetForm(){let r=this.propertyResource.value();r&&this.populateForm(r)}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=F({type:n,selectors:[["app-channel-manager-settings-general"]],decls:132,vars:12,consts:[["title","General Settings","description",""],["actions",""],["matButton","outlined","type","button",1,"px-8",3,"click","disabled"],["matButton","filled","color","primary","type","submit",1,"px-8",3,"click","disabled"],[1,"absolute","inset-0","flex","justify-center","items-center","bg-white/50","rounded-lg","z-50"],["icon","error_outline","title","Failed to Load Settings",3,"message"],[1,"space-y-6",3,"formGroup"],["appearance","outlined"],[1,"mb-3"],[1,"text-xl","font-bold","text-gray-900"],[1,"pt-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["appearance","outline",1,"w-full"],["matInput","","type","number","formControlName","min_price","placeholder","10.00","step","0.01"],["matInput","","type","number","formControlName","max_price","placeholder","5000.00","step","0.01"],[1,"text-sm","text-gray-600","mt-4"],[1,"text-sm","text-gray-700","mb-6"],[1,"space-y-4"],[1,"flex","items-start","justify-between","p-4","rounded-lg"],[1,"flex-1"],[1,"font-semibold","text-gray-900","block","mb-1"],[1,"text-xs","text-gray-600"],["formControlName","allow_availability_autoupdate_on_confirmation",1,"ml-4","mt-1"],["formControlName","allow_availability_autoupdate_on_modification",1,"ml-4","mt-1"],["formControlName","allow_availability_autoupdate_on_cancellation",1,"ml-4","mt-1"],["appearance","outline",1,"w-full","md:w-1/2"],["matInput","","type","number","formControlName","state_length","placeholder","500","step","1","min","100","max","730"],[1,"text-xs","text-gray-600","mb-6","p-3","bg-yellow-50","border","border-yellow-200","rounded"],["formControlName","min_stay_type"],["value","both"],["value","arrival"],["value","through"],[1,"text-xs","text-gray-600","mb-6"],["matInput","","type","time","formControlName","cut_off_time"],["matInput","","type","number","formControlName","cut_off_days","min","0","step","1"],[1,"flex","items-center","gap-4"],["formControlName","max_day_advance_enabled",1,"m-0"],[1,"font-semibold","text-gray-900"],["diameter","50"],["matInput","","type","number","formControlName","max_day_advance","min","1","placeholder","30","step","1"],[1,"text-xs","text-amber-700","p-3","bg-amber-50","border","border-amber-200","rounded"]],template:function(i,o){if(i&1&&(t(0,"app-page-header",0),k(1,1),t(2,"button",2),x("click",function(){return o.resetForm()}),a(3," Reset "),e(),t(4,"button",3),x("click",function(){return o.saveSettings()}),a(5),e(),I(),e(),d(6,Ee,2,0,"div",4),d(7,we,1,1,"app-no-record",5),t(8,"form",6)(9,"mat-card",7)(10,"mat-card-header",8)(11,"mat-card-title",9),a(12,"Price Setting"),e()(),t(13,"mat-card-content",10)(14,"div",11)(15,"mat-form-field",12)(16,"mat-label"),a(17,"Min Price"),e(),s(18,"input",13),t(19,"mat-hint"),a(20,"Minimum price for this property"),e(),d(21,Fe,2,0,"mat-error"),e(),t(22,"mat-form-field",12)(23,"mat-label"),a(24,"Max Price"),e(),s(25,"input",14),t(26,"mat-hint"),a(27,"Maximum price for this property"),e(),d(28,ke,2,0,"mat-error"),e()(),t(29,"p",15),a(30," Here you can manage the minimum and maximum price for the property "),e()()(),t(31,"mat-card",7)(32,"mat-card-header")(33,"mat-card-title",9),a(34," Automatic Availability Update Settings "),e()(),t(35,"mat-card-content",10)(36,"p",16),a(37," Here you will decide what should happen when a New, Modified or Cancelled booking happens. If the availability will change automatically or the PMS will control these changes. "),e(),t(38,"div",17)(39,"div",18)(40,"div",19)(41,"label",20),a(42,"New booking"),e(),t(43,"p",21),a(44," This option cannot be disabled for safety reasons. Channex will reduce the availability automatically after any new booking. Imported bookings are not affected "),e()(),s(45,"mat-checkbox",22),e(),t(46,"div",18)(47,"div",19)(48,"label",20),a(49,"Modified booking"),e(),t(50,"p",21),a(51," If selected, for any modified bookings created the availability will be automatically adjusted "),e()(),s(52,"mat-checkbox",23),e(),t(53,"div",18)(54,"div",19)(55,"label",20),a(56,"Cancelled booking"),e(),t(57,"p",21),a(58," If selected, for any cancelled bookings the availability will be positively adjusted "),e()(),s(59,"mat-checkbox",24),e()()()(),t(60,"mat-card",7)(61,"mat-card-header")(62,"mat-card-title",9),a(63,"Inventory Days"),e()(),t(64,"mat-card-content",10)(65,"mat-form-field",25)(66,"mat-label"),a(67,"Inventory Days"),e(),s(68,"input",26),t(69,"mat-hint"),a(70,"Set the length of the inventory table in number of days. Min: 100, Max: 730"),e(),d(71,Ie,2,0,"mat-error"),d(72,Ne,2,0,"mat-error"),e()()(),t(73,"mat-card",7)(74,"mat-card-header")(75,"mat-card-title",9),a(76,"Minimum Stay Settings"),e()(),t(77,"mat-card-content",10)(78,"p",16),a(79," Here you can simplify the user experience for your user by using only one kind of minimum stay. "),e(),t(80,"p",27),a(81," Note: Changing these settings will remove all values from the unused min stay type. Please full sync from PMS after any changes here and check. "),e(),t(82,"mat-form-field",25)(83,"mat-label"),a(84,"Minimum Stay Settings"),e(),t(85,"mat-select",28)(86,"mat-option",29),a(87,"Both"),e(),t(88,"mat-option",30),a(89,"Arrival"),e(),t(90,"mat-option",31),a(91,"Through"),e()(),t(92,"mat-hint"),a(93,"Select which type of minimum stay you want to use"),e()()()(),t(94,"mat-card",7)(95,"mat-card-header")(96,"mat-card-title",9),a(97,"Cut-off Time"),e()(),t(98,"mat-card-content",10)(99,"p",16),a(100,"Control when to stop sales for same day reservations"),e(),t(101,"p",32),a(102," We will use the property timezone, when the time is reached all availability will be 0 for the current day "),e(),t(103,"div",11)(104,"mat-form-field",12)(105,"mat-label"),a(106,"Cut-off Time"),e(),s(107,"input",33),t(108,"mat-hint"),a(109,"Set the cut-off time (30-minute steps)"),e()(),t(110,"mat-form-field",12)(111,"mat-label"),a(112,"Cut-off Days"),e(),s(113,"input",34),t(114,"mat-hint"),a(115,"Number of days to close from the cut-off time"),e(),d(116,Pe,2,0,"mat-error"),e()()()(),t(117,"mat-card",7)(118,"mat-card-header")(119,"mat-card-title",9),a(120,"Max Days Advance"),e()(),t(121,"mat-card-content",10)(122,"p",16),a(123,"Close Availability for some dates in future."),e(),t(124,"p",32),a(125," Please, keep in mind, Availability will not be opened automatically. "),e(),t(126,"div",17)(127,"div",35)(128,"mat-slide-toggle",36)(129,"span",37),a(130,"Enable"),e()()(),d(131,Te,9,1),e()()()()),i&2){let l,f,g,y,S,C;m(2),_("disabled",o.isSaving()||o.propertyResource.isLoading()),m(2),_("disabled",o.isSaving()||o.propertyResource.isLoading()),m(),N(" ",o.isSaving()?"Saving...":"Save Settings"," "),m(),p(o.propertyResource.isLoading()?6:-1),m(),p(o.propertyResource.error()?7:-1),m(),_("formGroup",o.settingsForm),m(13),p((l=o.settingsForm.get("min_price"))!=null&&l.hasError("min")?21:-1),m(7),p((f=o.settingsForm.get("max_price"))!=null&&f.hasError("min")?28:-1),m(43),p((g=o.settingsForm.get("state_length"))!=null&&g.hasError("min")?71:-1),m(),p((y=o.settingsForm.get("state_length"))!=null&&y.hasError("max")?72:-1),m(44),p((S=o.settingsForm.get("cut_off_days"))!=null&&S.hasError("min")?116:-1),m(15),p((C=o.settingsForm.get("max_day_advance_enabled"))!=null&&C.value?131:-1)}},dependencies:[P,ie,Q,z,X,J,K,te,ee,Z,Y,W,U,$,q,L,me,le,ne,oe,re,de,se,B,A,be,he,fe,ue,R,ge,ce,pe,Se,ve,j,ye,xe],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})};export{Ce as ChannelManagerSettingsGeneral};
