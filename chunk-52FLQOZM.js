import{a as Vt}from"./chunk-GU4Z36JA.js";import{a as E,b as $t,c as Bt}from"./chunk-7FQZXLFT.js";import{a as Ht}from"./chunk-37MPZNQ6.js";import{a as Rt}from"./chunk-7FSETBMW.js";import{a as Ft}from"./chunk-W4KXP7Q5.js";import{a as Lt,b as Qt}from"./chunk-GZXF4TWP.js";import{c as kt}from"./chunk-XNNKKASY.js";import"./chunk-HJ3KAQ7K.js";import{a as It}from"./chunk-5HSGNHP2.js";import{a as b,b as Dt}from"./chunk-LCP7K4QH.js";import{a as wt}from"./chunk-JZKRHT5H.js";import{a as Tt}from"./chunk-O4OM35BU.js";import{a as y,b as gt,c as St,d as ht,e as Pt,f as Mt,g as xt,h as vt,i as yt,j as bt,k as Et}from"./chunk-2UZI5XAB.js";import"./chunk-6RCOBA75.js";import{a as ot,b as nt,c as rt,d as at}from"./chunk-Q4U6FYZ3.js";import{i as X}from"./chunk-QC7H4KPM.js";import{a as ft,b as Ct}from"./chunk-WZDQ5XTC.js";import{d as U}from"./chunk-R6JGHN2R.js";import{d as I}from"./chunk-BXJEGH2V.js";import"./chunk-64WHNS37.js";import"./chunk-TIVXUJ22.js";import"./chunk-WAHSRZAW.js";import"./chunk-XLZTIYSF.js";import{b as dt,c as st,d as ut}from"./chunk-UMV4DCPT.js";import{a as lt,d as mt,h as ct}from"./chunk-G3VZM262.js";import"./chunk-BCE7WRWQ.js";import{a as pt,b as _t}from"./chunk-6I3AJKA7.js";import"./chunk-W7NMJLMQ.js";import"./chunk-F5SZ3AU3.js";import{a as W}from"./chunk-4UBDYPTG.js";import"./chunk-TILT22SG.js";import"./chunk-BFT2MTJY.js";import{a as tt,c as et,h as it}from"./chunk-3E3PJ7Q7.js";import"./chunk-FO4KTVQ3.js";import"./chunk-TRZH7NMW.js";import"./chunk-GXTELBJV.js";import{b as Y,c as Z}from"./chunk-JPRPNQOM.js";import{Z as G,_ as J,ba as K}from"./chunk-3LDCGXHW.js";import{g as O}from"./chunk-ZLVQTB5B.js";import{q as A,s as j}from"./chunk-6PFJHDFS.js";import{Fc as Q,Ib as $,Jb as B,Kb as H,Lc as N,Mb as V,Nb as F,Nc as q,Ob as p,Pb as o,Qb as n,Rb as _,Vb as s,Vc as z,Wb as u,Ya as k,Yb as w,ac as f,bb as m,cc as S,fa as C,gc as M,hc as x,ic as v,ka as h,la as P,mc as L,qb as R,rc as r,sc as g,tc as D,wa as T,wb as c}from"./chunk-J2AK4FW5.js";import"./chunk-GAL4ENT6.js";var qt=()=>[5,10,25,100];function zt(t,e){if(t&1&&(o(0,"mat-option",10),r(1),n()),t&2){let i=e.$implicit;p("value",i._id),m(),D(" ",i.name," ")}}function At(t,e){t&1&&(o(0,"div",14),_(1,"mat-spinner",18),n())}function jt(t,e){t&1&&_(0,"app-no-record",15)}function Ot(t,e){t&1&&(o(0,"th",37),r(1,"Photo"),n())}function Ut(t,e){if(t&1&&(o(0,"td",38),_(1,"img",39),n()),t&2){let i=e.$implicit;m(),p("src",i.photos==null?null:i.photos[0],k)}}function Gt(t,e){t&1&&(o(0,"th",40),r(1,"Item name"),n())}function Jt(t,e){if(t&1&&(o(0,"td",41),r(1),n()),t&2){let i=e.$implicit;m(),g(i.name)}}function Kt(t,e){t&1&&(o(0,"th",40),r(1,"Category"),n())}function Wt(t,e){if(t&1&&(o(0,"td",38),r(1),n()),t&2){let i=e.$implicit;m(),g(i==null||i.menu==null?null:i.menu.name)}}function Xt(t,e){t&1&&(o(0,"th",40),r(1,"Price"),n())}function Yt(t,e){if(t&1&&(o(0,"td",38)(1,"span",42),r(2),N(3,"currency"),n()()),t&2){let i,a=e.$implicit,l=S(2);m(2),D(" ",q(3,1,a.price,(i=l.storeStore.selectedStore())==null?null:i.currency)," ")}}function Zt(t,e){t&1&&(o(0,"th",40),r(1,"Cost Price"),n())}function te(t,e){if(t&1&&(o(0,"td",38),r(1),n()),t&2){let i=e.$implicit;m(),g(i.costPrice)}}function ee(t,e){t&1&&(o(0,"th",40),r(1,"Initial Stock"),n())}function ie(t,e){if(t&1&&(o(0,"td",38),r(1),n()),t&2){let i=e.$implicit;m(),g(i.initialStock||0)}}function oe(t,e){t&1&&(o(0,"th",40),r(1,"Critical Level"),n())}function ne(t,e){if(t&1&&(o(0,"td",38),r(1),n()),t&2){let i=e.$implicit;m(),g(i.criticalStockLevel||0)}}function re(t,e){t&1&&(o(0,"th",40),r(1,"Quantity"),n())}function ae(t,e){if(t&1&&(o(0,"td",38),r(1),n()),t&2){let i=e.$implicit;m(),g(i.qty||0)}}function le(t,e){t&1&&(o(0,"th",37),r(1,"Status"),n())}function me(t,e){if(t&1){let i=w();o(0,"td",38)(1,"mat-slide-toggle",43),f("change",function(){let l=h(i).$implicit,d=S(2);return P(d.toggleProductStatus(l))}),n()()}if(t&2){let i=e.$implicit;m(),p("checked",i.active)}}function ce(t,e){t&1&&(o(0,"th",37),r(1,"Actions"),n())}function de(t,e){if(t&1){let i=w();o(0,"td",38)(1,"button",44)(2,"mat-icon"),r(3,"more_vert"),n()(),o(4,"mat-menu",null,0)(6,"button",45),f("click",function(){let l=h(i).$implicit,d=S(2);return P(d.onEditProduct(l._id))}),o(7,"mat-icon"),r(8,"edit"),n(),o(9,"span"),r(10,"Edit"),n()(),o(11,"button",45),f("click",function(){let l=h(i).$implicit,d=S(2);return P(d.deleteProduct(l))}),o(12,"mat-icon"),r(13,"delete"),n(),o(14,"span"),r(15,"Delete"),n()()()()}if(t&2){let i=L(5);m(),p("matMenuTriggerFor",i)}}function se(t,e){t&1&&_(0,"tr",46)}function ue(t,e){t&1&&_(0,"tr",47)}function pe(t,e){if(t&1&&(o(0,"div",16)(1,"table",19),s(2,20),c(3,Ot,2,0,"th",21)(4,Ut,2,1,"td",22),u(),s(5,23),c(6,Gt,2,0,"th",24)(7,Jt,2,1,"td",25),u(),s(8,26),c(9,Kt,2,0,"th",24)(10,Wt,2,1,"td",22),u(),s(11,27),c(12,Xt,2,0,"th",24)(13,Yt,4,4,"td",22),u(),s(14,28),c(15,Zt,2,0,"th",24)(16,te,2,1,"td",22),u(),s(17,29),c(18,ee,2,0,"th",24)(19,ie,2,1,"td",22),u(),s(20,30),c(21,oe,2,0,"th",24)(22,ne,2,1,"td",22),u(),s(23,31),c(24,re,2,0,"th",24)(25,ae,2,1,"td",22),u(),s(26,32),c(27,le,2,0,"th",21)(28,me,2,1,"td",22),u(),s(29,33),c(30,ce,2,0,"th",21)(31,de,16,1,"td",22),u(),c(32,se,1,0,"tr",34)(33,ue,1,0,"tr",35),n(),_(34,"mat-paginator",36),n()),t&2){let i=S();m(),p("dataSource",i.filteredProducts()),m(31),p("matHeaderRowDef",i.displayedColumns),m(),p("matRowDefColumns",i.displayedColumns),m(),p("pageSizeOptions",Q(4,qt))}}function _e(t,e){t&1&&_(0,"app-no-record",17)}var Nt=class t{productService=C(Vt);categoryService=C(Ft);storeStore=C(X);router=C(O);dialog=C(kt);snackBar=C(W);searchTerm=T("");selectedCategory=T("all");displayedColumns=["photo","name","category","price","cost","initialStock","criticalStockLevel","qty","active","actions"];dataSource=I({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.productService.getStoreProducts(e.storeId)});categories=I({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.categoryService.getStoreMenus(e.storeId)});filteredProducts=z(()=>{let e=this.searchTerm().toLowerCase(),i=this.selectedCategory();return this.dataSource.value()?.filter(a=>{let l=a.name.toLowerCase().includes(e),d=i==="all"||a?.menu?._id===i;return l&&d})??[]});paginator;sort;table;onSearch(e){let i=e.target;this.searchTerm.set(i.value)}onCategoryChange(e){this.selectedCategory.set(e)}addItem(){this.router.navigate(["/menu/erp/items/create-product"])}editProduct(e){console.log("Edit product:",e)}onEditProduct(e){this.router.navigate(["/menu/erp/items/edit-product",e])}deleteProduct(e){this.dialog.open(Ht,{width:"400px",data:{message:`Are you sure you want to delete ${e.name}?`}}).afterClosed().subscribe(a=>{a&&this.productService.deleteProduct(e._id).subscribe({next:()=>{console.log("Product deleted successfully"),this.dataSource.reload()},error:l=>{console.error("Error deleting product:",l)}})})}toggleProductStatus(e){let i={active:!e.active};this.productService.saveProduct(i,e._id).subscribe({next:()=>{this.snackBar.open("Product status updated successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})},error:()=>{this.snackBar.open("Error updating product status","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})}reloadProducts(){this.dataSource.reload()}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=R({type:t,selectors:[["app-products"]],viewQuery:function(i,a){if(i&1&&(M(b,5),M(E,5),M(y,5)),i&2){let l;x(l=v())&&(a.paginator=l.first),x(l=v())&&(a.sort=l.first),x(l=v())&&(a.table=l.first)}},decls:31,vars:1,consts:[["menu","matMenu"],["title","Products","subtitle","Manage your menu items and pricing"],["matButton","","actions","","title","Reload products","matTooltip","Reload",3,"click"],["matButton","filled","color","primary","actions","",3,"click"],["appearance","outlined",1,"py-4"],[1,"flex","flex-col","md:flex-row","gap-4","p-4","border-b","mb-4"],[1,"flex","flex-col","sm:flex-row","gap-4","flex-grow"],["appearance","outline",1,"w-full","sm:w-48"],[3,"selectionChange"],["value","all"],[3,"value"],["appearance","outline",1,"w-full","sm:w-48","md:w-72","lg:w-96"],["matPrefix",""],["matInput","","placeholder","Search items",3,"input"],[1,"flex","items-center","justify-center","min-h-[300px]"],["icon","inventory_2","title","No Products","message","No products found matching your criteria."],[1,"table-container","rounded-lg","overflow-x-auto"],["icon","error","title","Error","message","An error occurred while fetching the data. Please try again later."],["diameter","40"],["mat-table","","matSort","",1,"min-w-full",3,"dataSource"],["matColumnDef","photo"],["mat-header-cell","","class","bg-gray-50",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","","class","bg-gray-50",4,"matHeaderCellDef"],["mat-cell","","class","font-semibold",4,"matCellDef"],["matColumnDef","category"],["matColumnDef","price"],["matColumnDef","cost"],["matColumnDef","initialStock"],["matColumnDef","criticalStockLevel"],["matColumnDef","qty"],["matColumnDef","active"],["matColumnDef","actions"],["mat-header-row","","class","bg-gray-50",4,"matHeaderRowDef"],["mat-row","","class","hover:bg-gray-50 transition",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of products",3,"pageSizeOptions"],["mat-header-cell","",1,"bg-gray-50"],["mat-cell",""],["alt","product",1,"w-10","h-10","object-cover","rounded-full","border","shadow",3,"src"],["mat-header-cell","","mat-sort-header","",1,"bg-gray-50"],["mat-cell","",1,"font-semibold"],[1,"font-semibold","text-primary"],["color","primary",3,"change","checked"],["mat-icon-button","","aria-label","Product actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row","",1,"bg-gray-50"],["mat-row","",1,"hover:bg-gray-50","transition"]],template:function(i,a){i&1&&(o(0,"app-page-header",1)(1,"button",2),f("click",function(){return a.reloadProducts()}),o(2,"mat-icon"),r(3,"refresh"),n(),r(4," Refresh "),n(),o(5,"button",3),f("click",function(){return a.addItem()}),o(6,"mat-icon"),r(7,"add"),n(),r(8," ADD ITEM "),n()(),o(9,"mat-card",4)(10,"mat-card-content")(11,"div",5)(12,"div",6)(13,"mat-form-field",7)(14,"mat-label"),r(15,"Category"),n(),o(16,"mat-select",8),f("selectionChange",function(d){return a.onCategoryChange(d.value)}),o(17,"mat-option",9),r(18,"All Categories"),n(),V(19,zt,2,2,"mat-option",10,H),n()(),o(21,"mat-form-field",11)(22,"mat-label"),r(23,"Search"),n(),o(24,"mat-icon",12),r(25,"search"),n(),o(26,"input",13),f("input",function(d){return a.onSearch(d)}),n()()()(),$(27,At,2,0,"div",14)(28,jt,1,0,"app-no-record",15)(29,pe,35,5,"div",16)(30,_e,1,0,"app-no-record",17),n()()),i&2&&(m(19),F(a.categories.value()),m(8),B(a.dataSource.isLoading()?27:a.dataSource.hasValue()&&a.filteredProducts().length===0?28:a.dataSource.hasValue()?29:a.dataSource.error()?30:-1))},dependencies:[j,Et,y,St,xt,ht,gt,vt,Pt,Mt,yt,bt,Dt,b,Bt,E,$t,dt,ct,lt,mt,ut,st,Ct,ft,U,K,J,G,it,tt,et,at,nt,ot,rt,Z,Y,wt,Tt,_t,pt,Qt,Lt,Rt,It,A],encapsulation:2})};export{Nt as ProductsComponent};
