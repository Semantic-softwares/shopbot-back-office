import{a as Oe}from"./chunk-VHL4W3XE.js";import{a as Ve,b as we,c as qe}from"./chunk-25J5LEO4.js";import{c as De,d as Te,e as Me,f as Se,g as Ie,h as Fe}from"./chunk-LLLAI5OH.js";import{a as Ee,b as Ne}from"./chunk-46P5YEBT.js";import{a as z}from"./chunk-A2P3GH4G.js";import{d as L}from"./chunk-6KQFCX5X.js";import{a as ve,b as he}from"./chunk-KVX2H4A7.js";import{b as de,c as ue,d as pe}from"./chunk-GYNGZAKB.js";import{a as Ce,b as ke,e as _e,f as be,g as ye,h as xe}from"./chunk-BTSYCNWJ.js";import{c as R,d as Re}from"./chunk-2WBLSBPP.js";import{a as fe}from"./chunk-GIZLGNET.js";import{g as le}from"./chunk-J3TXHOEY.js";import{a as me,e as ce,h as se}from"./chunk-YLKT6R4Z.js";import{C as ae,E as re,b as U,d as p,g as W,h as X,k as Y,m as Z,n as ee,p as te,q as ie,s as oe,t as ne}from"./chunk-2UT4NYMV.js";import{a as ge,b as V}from"./chunk-J5JAEWDO.js";import{Y as J,Z as K}from"./chunk-D3B3XJ53.js";import{c as N}from"./chunk-LTDPQFG4.js";import{q as $,r as E}from"./chunk-FORATDN3.js";import{$b as P,Bc as w,Eb as f,Fb as v,Hb as Q,Hc as H,Ib as M,Jb as S,Jc as j,Kb as s,Lb as a,Mb as n,Nb as C,Pc as k,Ub as I,Yb as x,Za as l,_b as d,ac as B,ca as u,ha as b,ia as y,ic as G,m as O,mb as T,nc as r,oc as F,pc as h,ta as A}from"./chunk-53XJD7JZ.js";var je=[[["","actions",""]]],$e=["[actions]"];function Le(o,e){if(o&1&&(a(0,"div",4)(1,"span"),r(2),n()()),o&2){let t=d();l(2),F(t.subtitle)}}function ze(o,e){if(o&1){let t=I();a(0,"mat-button-toggle-group",7),x("change",function(m){b(t);let c=d();return y(c.onViewChange(m.value))}),a(1,"mat-button-toggle",8)(2,"mat-icon"),r(3,"calendar_month"),n()(),a(4,"mat-button-toggle",9)(5,"mat-icon"),r(6,"list"),n()()()}if(o&2){let t=d();s("value",t.currentView)}}var Ae=class o{router=u(N);title="";subtitle="";showViewToggle=!1;viewToggleRoute="";get currentView(){let e=this.router.url;return e.includes("/list")?"list":(e.includes("/calendar"),"calendar")}onViewChange(e){this.viewToggleRoute&&this.router.navigate([this.viewToggleRoute,e])}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=T({type:o,selectors:[["app-page-header"]],inputs:{title:"title",subtitle:"subtitle",showViewToggle:"showViewToggle",viewToggleRoute:"viewToggleRoute"},ngContentSelectors:$e,decls:9,vars:3,consts:[[1,"border-b","mb-4","p-2"],[1,"lg:flex","lg:items-center","lg:justify-between"],[1,"min-w-0","flex-1"],[1,"text-2xl/7","font-bold","sm:truncate","sm:text-3xl","sm:tracking-tight"],[1,"mt-1","flex","flex-col","sm:mt-0","sm:flex-row","sm:flex-wrap","sm:space-x-6"],[1,"mt-5","flex","lg:mt-0","lg:ml-4","space-x-3","items-center"],["hideSingleSelectionIndicator","",3,"value"],["hideSingleSelectionIndicator","",3,"change","value"],["value","calendar"],["value","list"]],template:function(t,i){t&1&&(P(je),a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),r(4),n(),f(5,Le,3,1,"div",4),n(),a(6,"div",5),f(7,ze,7,1,"mat-button-toggle-group",6),B(8),n()()()),t&2&&(l(4),h(" ",i.title," "),l(),v(i.subtitle?5:-1),l(2),v(i.showViewToggle?7:-1))},dependencies:[E,qe,Ve,we,V,ge],encapsulation:2})};var Qe=()=>[],Be=(o,e)=>e._id||e.id;function Je(o,e){if(o&1&&(a(0,"mat-option",19),r(1),n()),o&2){let t=e.$implicit;s("value",t),l(),F(t)}}function Ke(o,e){o&1&&(a(0,"div",20),C(1,"mat-spinner",27),n())}function Ue(o,e){if(o&1&&r(0),o&2){let t=d().$implicit;h(" - Room #",t.roomNumber," ")}}function We(o,e){if(o&1&&(a(0,"mat-option",19),r(1),f(2,Ue,1,1),n()),o&2){let t=e.$implicit;s("value",t._id||t.id),l(),h(" ",t.name," "),l(),v(t.roomNumber?2:-1)}}function Xe(o,e){if(o&1&&(a(0,"mat-form-field",8)(1,"mat-label"),r(2,"Select Room"),n(),a(3,"mat-select",28),M(4,We,3,3,"mat-option",19,Be),n()()),o&2){let t=d(2);l(4),S(t.filteredRooms())}}function Ye(o,e){if(o&1&&r(0),o&2){let t=d().$implicit;h(" - Room #",t.roomNumber," ")}}function Ze(o,e){if(o&1&&(a(0,"mat-option",19),r(1),f(2,Ye,1,1),n()),o&2){let t=e.$implicit;s("value",t._id||t.id),l(),h(" ",t.name," "),l(),v(t.roomNumber?2:-1)}}function et(o,e){if(o&1&&(a(0,"mat-form-field",8)(1,"mat-label"),r(2,"Select Rooms"),n(),a(3,"mat-select",29),M(4,Ze,3,3,"mat-option",19,Be),n()()),o&2){let t=d(2);l(4),S(t.filteredRooms())}}function tt(o,e){if(o&1&&f(0,Xe,6,0,"mat-form-field",8)(1,et,6,0,"mat-form-field",8),o&2){let t=d();v(t.bookingType()==="single"?0:1)}}function it(o,e){o&1&&(a(0,"p",21),r(1,"No rooms available for selected dates"),n())}function ot(o,e){o&1&&(a(0,"p",21),r(1,"Select a room type to see available rooms"),n())}var Pe=class o{fb=u(ae);dialogRef=u(Ce);roomsService=u(Oe);router=u(N);storeStore=u(fe);dialogData=u(ke,{optional:!0});roomTypeField=new Y("");minDate=A(new Date);quickReservationForm=this.fb.group({bookingType:["single",p.required],dateRange:this.fb.group({start:[new Date,[p.required,this.minDateValidator.bind(this)]],end:[this.getNextDay(new Date),[p.required,this.minDateValidator.bind(this)]]}),selectedRoom:["",p.required],adults:[1,[p.required,p.min(1)]],children:[0,[p.required,p.min(0)]]});ngOnInit(){this.dialogData&&(this.dialogData.checkInDate&&this.dialogData.checkOutDate&&this.quickReservationForm.get("dateRange")?.patchValue({start:this.dialogData.checkInDate,end:this.dialogData.checkOutDate}),this.dialogData.preselectedRoomId&&this.quickReservationForm.patchValue({selectedRoom:this.dialogData.preselectedRoomId}),this.dialogData.preselectedRoomTypeName&&this.roomTypeField.patchValue(this.dialogData.preselectedRoomTypeName))}preselectedRoomId=null;checkIn=R(this.quickReservationForm.get("dateRange.start").valueChanges,{initialValue:this.quickReservationForm.get("dateRange.start").value});checkOut=R(this.quickReservationForm.get("dateRange.end").valueChanges,{initialValue:this.quickReservationForm.get("dateRange.end").value});selectedRoomId=R(this.quickReservationForm.get("selectedRoom").valueChanges,{initialValue:this.quickReservationForm.get("selectedRoom").value});bookingType=R(this.quickReservationForm.get("bookingType").valueChanges,{initialValue:this.quickReservationForm.get("bookingType").value});adultsValue=R(this.quickReservationForm.get("adults").valueChanges,{initialValue:this.quickReservationForm.get("adults").value});childrenValue=R(this.quickReservationForm.get("children").valueChanges,{initialValue:this.quickReservationForm.get("children").value});numberOfNights=k(()=>{let e=this.checkIn(),t=this.checkOut();if(!e||!t)return 0;let i=Math.abs(t.getTime()-e.getTime());return Math.ceil(i/(1e3*60*60*24))});availableRoomsResource=Re({params:()=>({checkIn:this.checkIn(),checkOut:this.checkOut(),storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.getAvailableRooms({checkIn:e.checkIn,checkOut:e.checkOut,storeId:e.storeId})});roomTypeValue=R(this.roomTypeField.valueChanges,{initialValue:this.roomTypeField.value});uniqueRoomTypes=k(()=>{let e=this.availableRoomsResource.value()||[],t=new Set(e.map(i=>i.roomType.name));return Array.from(t).sort()});filteredRooms=k(()=>{let e=this.availableRoomsResource.value()||[],t=this.roomTypeValue();return this.preselectedRoomId&&e.length>0&&e.find(m=>(m._id||m.id)===this.preselectedRoomId)&&(this.quickReservationForm.get("selectedRoom")?.setValue(this.preselectedRoomId),this.preselectedRoomId=null),t?e.filter(i=>i.roomType.name===t):e});maxCapacity=k(()=>{let e=this.selectedRoomId(),t=this.availableRoomsResource.value()||[],i=this.bookingType();if(!e)return{adults:0,children:0};let m=Array.isArray(e)?e:[e],c=0,D=0;return m.forEach(_=>{let g=t.find(q=>(q._id||q.id)===_);g?.roomType?.capacity&&(c+=g.roomType.capacity.adults||0,D+=g.roomType.capacity.children||0)}),{adults:c,children:D}});occupancyValidator=()=>{let e=this.adultsValue()||0,t=this.childrenValue()||0,i=this.maxCapacity();return e>i.adults?(this.quickReservationForm.get("adults")?.setErrors({exceedsCapacity:!0}),{exceedsCapacity:!0}):t>i.children?(this.quickReservationForm.get("children")?.setErrors({exceedsCapacity:!0}),{exceedsCapacity:!0}):e+t>i.adults+i.children?(this.quickReservationForm.setErrors({totalOccupancyExceeded:!0}),{totalOccupancyExceeded:!0}):(this.quickReservationForm.hasError("totalOccupancyExceeded")&&this.quickReservationForm.setErrors(null),null)};occupancyCheck=k(()=>(this.adultsValue(),this.childrenValue(),this.maxCapacity(),this.occupancyValidator()));totalAmount=k(()=>{let e=this.selectedRoomId(),t=this.availableRoomsResource.value()||[],i=this.numberOfNights();if(!e||i===0)return 0;let m=Array.isArray(e)?e:[e],c=0;return m.forEach(D=>{let _=t.find(g=>(g._id||g.id)===D);if(_){let g=_.priceOverride||_.pricePerNight||0;c+=g}}),c*i});getAvailableRooms(e){let t=new Date(e.checkIn).toISOString().split("T")[0],i=new Date(e.checkOut).toISOString().split("T")[0];return!t||!i||!e.storeId?O([]):this.roomsService.getAvailableRooms({storeId:e.storeId,checkInDate:t,checkOutDate:i})}minDateValidator(e){if(!e.value)return null;let t=new Date(e.value),i=new Date;return i.setHours(0,0,0,0),t.setHours(0,0,0,0),t<i?{minDateInvalid:!0}:null}onCancel(){this.dialogRef.close()}onProceed(){if(this.quickReservationForm.invalid||this.occupancyCheck())return;let e=this.quickReservationForm.value,t=e.dateRange,i={bookingType:e.bookingType,checkInDate:t?.start,checkOutDate:t?.end,roomTypeFilter:this.roomTypeField.value||"",selectedRoom:this.selectedRoomId()||"",adults:e.adults||1,children:e.children||0};this.dialogRef.close(i)}getNextDay(e){let t=new Date(e);return t.setDate(t.getDate()+1),t}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=T({type:o,selectors:[["app-quick-reservation-modal"]],decls:56,vars:13,consts:[["picker",""],[1,"flex","justify-between","items-center"],["mat-dialog-title",""],[1,"flex","items-center","space-x-2","pr-4"],[1,"text-gray-600","font-medium"],[1,"text-lg","font-bold","text-blue-600"],[3,"formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["formControlName","bookingType"],["value","single"],["value","group"],["formGroupName","dateRange",3,"min","rangePicker"],["matStartDate","","formControlName","start","placeholder","Check-in","readonly",""],["matDateRangeSeparator",""],["matEndDate","","formControlName","end","placeholder","Check-out","readonly",""],["matIconSuffix","",3,"for"],[3,"formControl"],["value",""],[3,"value"],[1,"flex","justify-center","py-4"],[1,"text-gray-500","text-sm","text-center","py-4"],["matInput","","type","number","formControlName","adults"],["matInput","","type","number","formControlName","children"],["align","end",1,"space-x-2","mt-6"],["matButton","outlined",3,"click"],["matButton","filled","color","primary",3,"click","disabled"],["diameter","40"],["formControlName","selectedRoom"],["formControlName","selectedRoom","multiple",""]],template:function(t,i){if(t&1){let m=I();a(0,"div",1)(1,"h2",2),r(2,"Add Quick Reservation"),n(),a(3,"div",3)(4,"span",4),r(5,"Total:"),n(),a(6,"span",5),r(7),H(8,"currency"),n()()(),a(9,"mat-dialog-content")(10,"form",6)(11,"div",7)(12,"mat-form-field",8)(13,"mat-label"),r(14,"Booking Type"),n(),a(15,"mat-select",9)(16,"mat-option",10),r(17,"Single"),n(),a(18,"mat-option",11),r(19,"Group"),n()()(),a(20,"mat-form-field",8)(21,"mat-label"),r(22,"Stay Dates"),n(),a(23,"mat-date-range-input",12),C(24,"input",13),a(25,"span",14),r(26,"\u2013"),n(),C(27,"input",15),n(),C(28,"mat-datepicker-toggle",16)(29,"mat-date-range-picker",null,0),n(),a(31,"mat-form-field",8)(32,"mat-label"),r(33,"Room Type"),n(),a(34,"mat-select",17)(35,"mat-option",18),r(36,"All Room Types"),n(),M(37,Je,2,2,"mat-option",19,Q),n()(),f(39,Ke,2,0,"div",20)(40,tt,2,1)(41,it,2,0,"p",21)(42,ot,2,0,"p",21),a(43,"mat-form-field",8)(44,"mat-label"),r(45,"Number of Adults"),n(),C(46,"input",22),n(),a(47,"mat-form-field",8)(48,"mat-label"),r(49,"Number of Children"),n(),C(50,"input",23),n()()()(),a(51,"mat-dialog-actions",24)(52,"button",25),x("click",function(){return b(m),y(i.onCancel())}),r(53," Cancel "),n(),a(54,"button",26),x("click",function(){return b(m),y(i.onProceed())}),r(55," Proceed to Details "),n()()}if(t&2){let m,c=G(30);l(7),h(" ",j(8,8,i.totalAmount(),((m=i.storeStore.selectedStore())==null?null:m.currency)||((m=i.storeStore.selectedStore())==null?null:m.currencyCode)||"$")," "),l(3),s("formGroup",i.quickReservationForm),l(13),s("min",i.minDate())("rangePicker",c),l(5),s("for",c),l(6),s("formControl",i.roomTypeField),l(3),S(i.uniqueRoomTypes()),l(2),v(i.availableRoomsResource.isLoading()?39:(i.availableRoomsResource.value()||w(11,Qe)).length>0?40:(i.availableRoomsResource.value()||w(12,Qe)).length===0&&!i.availableRoomsResource.isLoading()?41:42),l(15),s("disabled",i.quickReservationForm.invalid)}},dependencies:[E,re,Z,U,ee,W,X,te,ne,oe,ie,xe,_e,ye,be,le,K,J,Ne,se,me,ce,Ee,L,de,Fe,De,Te,Me,Se,Ie,pe,ue,z,V,he,ve,$],encapsulation:2})};export{Ae as a,Pe as b};
