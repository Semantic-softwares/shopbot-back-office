import{c as Ye,d as qe}from"./chunk-EK3LM46M.js";import{a as We,b as Ke,c as Xe}from"./chunk-YWHWR4KJ.js";import{a as Ue}from"./chunk-WZHBJ4CP.js";import{a as Je}from"./chunk-QTGE4XNY.js";import{b as Qe,f as Ge}from"./chunk-VQA5W3EJ.js";import{a as Ae,b as ze,c as He}from"./chunk-L7BDTWLS.js";import{a as je}from"./chunk-RFNL2MTP.js";import{c as ke,d as Pe,e as Fe,f as Ve,g as Re,h as Ne}from"./chunk-MLXMZDM2.js";import{a as $e,b as Be}from"./chunk-N67EMNJ4.js";import"./chunk-PSH3SVZJ.js";import"./chunk-5LVVGVPB.js";import{a as xe,b as ye,c as be,d as Ee,e as Me,f as Oe,g as De,h as we,i as Te,j as Le,k as Ie}from"./chunk-IFYNKVPK.js";import{a as J}from"./chunk-EHJ5MOYI.js";import"./chunk-23Y5PA5G.js";import"./chunk-2KPMOGOH.js";import"./chunk-TRRVPZ2R.js";import{a as ne,b as ae,c as oe,d as le}from"./chunk-Q24JN32N.js";import{i as X}from"./chunk-WFQLSX5X.js";import{a as ve,b as Ce}from"./chunk-66RT5LSQ.js";import{d as G}from"./chunk-O2QR3P5A.js";import{d as he}from"./chunk-WD3LGOJ6.js";import"./chunk-5IMEEOTN.js";import"./chunk-UATHS3SB.js";import"./chunk-GZ7S2I6F.js";import"./chunk-L5R7UQHM.js";import{b as ue,c as _e,d as fe}from"./chunk-323BPMCN.js";import{a as de,d as me,e as ce,h as pe}from"./chunk-TW5XL4DD.js";import"./chunk-GBJWJHBW.js";import{a as ge,b as Se}from"./chunk-ZDRRUYFZ.js";import{A as se}from"./chunk-ADPCW6JI.js";import"./chunk-UUMWQRYG.js";import{a as W}from"./chunk-7HFBBWIO.js";import{a as K}from"./chunk-RRHIWUSE.js";import"./chunk-VJNXGGOY.js";import"./chunk-UPMF7ZC6.js";import"./chunk-BFT2MTJY.js";import{a as te,c as ie,h as re}from"./chunk-GI3DA2RF.js";import"./chunk-DDDMZQMU.js";import"./chunk-6NXOHEKD.js";import"./chunk-47XHPHB4.js";import{b as Z,c as ee}from"./chunk-5P5QATX2.js";import{$ as q,Y as U,Z as Y}from"./chunk-LG6YQHRU.js";import{g as j,l as Q}from"./chunk-DWM5GR6S.js";import{m as A,p as z,r as H}from"./chunk-6BQAOBQP.js";import{$a as l,Dc as B,Gb as b,Hb as E,Jc as w,Kb as T,Lb as L,Lc as V,Mb as p,Nb as i,Nc as R,Ob as a,Pb as M,Tb as h,Tc as k,Ub as x,Wb as O,_b as u,ac as _,ea as S,ja as m,ka as c,kc as I,mc as $,ob as N,oc as D,pc as o,qc as f,rc as y,ub as C,va as v}from"./chunk-H33Y42PP.js";import{a as P,b as F}from"./chunk-GAL4ENT6.js";var tt=()=>[10,25,50,100],Ze=(n,e)=>e.value,it=(n,e)=>e._id;function rt(n,e){if(n&1&&(i(0,"mat-option",18),o(1),a()),n&2){let t=e.$implicit;p("value",t.value),l(),f(t.label)}}function nt(n,e){if(n&1&&(i(0,"mat-option",18),o(1),a()),n&2){let t=e.$implicit;p("value",t.value),l(),f(t.label)}}function at(n,e){n&1&&(i(0,"div",24),M(1,"mat-spinner",28),a())}function ot(n,e){if(n&1){let t=O();i(0,"app-no-record",25)(1,"button",29),u("click",function(){m(t);let s=_();return c(s.reloadData())}),o(2," Retry "),a()()}if(n&2){let t=_();p("message",t.ordersResource.error())}}function lt(n,e){n&1&&M(0,"app-no-record",26)}function st(n,e){n&1&&(i(0,"th",45),o(1,"Order ID & Name"),a())}function dt(n,e){if(n&1&&(i(0,"td",46)(1,"div",47)(2,"span",48),o(3),a(),i(4,"span",49),o(5),a()()()),n&2){let t=e.$implicit;l(3),y("#",t.reference),l(2),f((t.user==null?null:t.user.name)||(t.user==null?null:t.user.email)||"Guest")}}function mt(n,e){n&1&&(i(0,"th",45),o(1,"Total"),a())}function ct(n,e){if(n&1&&(i(0,"td",46)(1,"span",50),o(2),w(3,"currency"),a()()),n&2){let t=e.$implicit,r=_(2);l(2),f(R(3,1,t.total,r.currency(),"symbol","1.2-2"))}}function pt(n,e){n&1&&(i(0,"th",45),o(1,"Status"),a())}function ut(n,e){if(n&1&&(i(0,"td",46)(1,"mat-chip"),o(2),a()()),n&2){let t=e.$implicit,r=_(2);l(),D(r.getStatusColor(t.category)),l(),y(" ",t.category," ")}}function _t(n,e){n&1&&(i(0,"th",45),o(1,"Payment Method"),a())}function ft(n,e){if(n&1&&(i(0,"td",46)(1,"span",51),o(2),a()()),n&2){let t=e.$implicit;l(2),f(t.payment||"N/A")}}function gt(n,e){n&1&&(i(0,"th",45),o(1,"Payment Status"),a())}function St(n,e){if(n&1&&(i(0,"td",46)(1,"mat-chip",52),o(2),a()()),n&2){let t=e.$implicit,r=_(2);l(),D(r.getPaymentStatusColor(t.paymentStatus)),l(),y(" ",t.paymentStatus," ")}}function vt(n,e){n&1&&(i(0,"th",45),o(1,"Location"),a())}function Ct(n,e){if(n&1&&(i(0,"td",46)(1,"span",51),o(2),a()()),n&2){let t=e.$implicit,r=_(2);l(2),f(r.getLocationInfo(t))}}function ht(n,e){n&1&&(i(0,"th",45),o(1,"Date"),a())}function xt(n,e){if(n&1&&(i(0,"td",46)(1,"span",51),o(2),w(3,"date"),a()()),n&2){let t=e.$implicit;l(2),f(V(3,1,t.createdAt,"short"))}}function yt(n,e){n&1&&(i(0,"th",45),o(1,"Actions"),a())}function bt(n,e){if(n&1){let t=O();i(0,"td",46)(1,"button",53)(2,"mat-icon"),o(3,"more_vert"),a()(),i(4,"mat-menu",null,1)(6,"button",54),u("click",function(){let s=m(t).$implicit,d=_(2);return c(d.viewOrder(s))}),i(7,"mat-icon"),o(8,"visibility"),a(),i(9,"span"),o(10,"View"),a()(),i(11,"button",54),u("click",function(){let s=m(t).$implicit,d=_(2);return c(d.printOrder(s))}),i(12,"mat-icon"),o(13,"print"),a(),i(14,"span"),o(15,"Print"),a()(),i(16,"button",54),u("click",function(){let s=m(t).$implicit,d=_(2);return c(d.editOrder(s))}),i(17,"mat-icon"),o(18,"edit"),a(),i(19,"span"),o(20,"Edit"),a()()()()}if(n&2){let t=I(5);l(),p("matMenuTriggerFor",t)}}function Et(n,e){n&1&&M(0,"tr",55)}function Mt(n,e){n&1&&M(0,"tr",56)}function Ot(n,e){if(n&1){let t=O();i(0,"div",30)(1,"table",31),h(2,32),C(3,st,2,0,"th",33)(4,dt,6,2,"td",34),x(),h(5,35),C(6,mt,2,0,"th",33)(7,ct,4,6,"td",34),x(),h(8,36),C(9,pt,2,0,"th",33)(10,ut,3,3,"td",34),x(),h(11,37),C(12,_t,2,0,"th",33)(13,ft,3,1,"td",34),x(),h(14,38),C(15,gt,2,0,"th",33)(16,St,3,3,"td",34),x(),h(17,39),C(18,vt,2,0,"th",33)(19,Ct,3,1,"td",34),x(),h(20,40),C(21,ht,2,0,"th",33)(22,xt,4,4,"td",34),x(),h(23,41),C(24,yt,2,0,"th",33)(25,bt,21,1,"td",34),x(),C(26,Et,1,0,"tr",42)(27,Mt,1,0,"tr",43),a()(),i(28,"mat-paginator",44),u("page",function(s){m(t);let d=_();return c(d.onPageChange(s))}),a()}if(n&2){let t=_();l(),p("dataSource",t.filteredOrders()),l(25),p("matHeaderRowDef",t.displayedColumns),l(),p("matRowDefColumns",t.displayedColumns),l(),p("length",t.totalOrders())("pageSize",t.pageSize())("pageIndex",t.pageIndex())("pageSizeOptions",B(7,tt))}}function Dt(n,e){if(n&1){let t=O();i(0,"mat-card",57)(1,"mat-card-content",58)(2,"div",59)(3,"div",60)(4,"h3",61),o(5),a(),i(6,"p",49),o(7),a()(),i(8,"button",53)(9,"mat-icon"),o(10,"more_vert"),a()(),i(11,"mat-menu",null,2)(13,"button",54),u("click",function(){let s=m(t).$implicit,d=_(2);return c(d.viewOrder(s))}),i(14,"mat-icon"),o(15,"visibility"),a(),i(16,"span"),o(17,"View"),a()(),i(18,"button",54),u("click",function(){let s=m(t).$implicit,d=_(2);return c(d.printOrder(s))}),i(19,"mat-icon"),o(20,"print"),a(),i(21,"span"),o(22,"Print"),a()(),i(23,"button",54),u("click",function(){let s=m(t).$implicit,d=_(2);return c(d.editOrder(s))}),i(24,"mat-icon"),o(25,"edit"),a(),i(26,"span"),o(27,"Edit"),a()()()(),i(28,"div",62)(29,"span",63),o(30),w(31,"currency"),a()(),i(32,"div",64)(33,"mat-chip",52),o(34),a(),i(35,"mat-chip",52),o(36),a()(),i(37,"div",65)(38,"div",66)(39,"mat-icon",67),o(40,"payment"),a(),i(41,"span"),o(42),a()(),i(43,"div",66)(44,"mat-icon",67),o(45,"location_on"),a(),i(46,"span"),o(47),a()(),i(48,"div",66)(49,"mat-icon",67),o(50,"schedule"),a(),i(51,"span"),o(52),w(53,"date"),a()()()()()}if(n&2){let t=e.$implicit,r=I(12),s=_(2);l(5),y("#",t.reference),l(2),f((t.user==null?null:t.user.name)||(t.user==null?null:t.user.email)||"Guest"),l(),p("matMenuTriggerFor",r),l(22),f(R(31,13,t.total,s.currency(),"symbol","1.2-2")),l(3),D(s.getStatusColor(t.category)),l(),y(" ",t.category," "),l(),D(s.getPaymentStatusColor(t.paymentStatus)),l(),y(" ",t.paymentStatus," "),l(6),f(t.payment||"N/A"),l(5),f(s.getLocationInfo(t)),l(5),f(V(53,18,t.createdAt,"short"))}}function wt(n,e){if(n&1&&(i(0,"div",27),T(1,Dt,54,21,"mat-card",57,it),a()),n&2){let t=_();l(),L(t.filteredOrders())}}var et=class n{ordersService=S(Ke);authService=S(K);storeStore=S(X);cartStore=S(Ye);cartService=S(qe);orderStore=S(Xe);router=S(j);saleTypeStore=S(We);printJobService=S(Ue);snackBar=S(W);searchQuery=v("");statusFilter=v("");paymentFilter=v("");staffFilter=v(this.authService.currentUserValue?._id||"");startDate=v(new Date(new Date().setHours(0,0,0,0)));endDate=v(new Date(new Date().setHours(23,59,59,999)));tempStartDate=null;tempEndDate=null;viewMode=v("table");pageSize=v(15);pageIndex=v(0);totalOrders=v(0);displayedColumns=["reference","total","status","payment","paymentStatus","location","date","actions"];filterParams=k(()=>{let e={storeId:this.storeStore.selectedStore()?._id,limit:this.pageSize(),skip:this.pageIndex()*this.pageSize(),salesChannel:"Point of Sale"};this.statusFilter()&&(e.status=this.statusFilter()),this.paymentFilter()&&(e.payment=this.paymentFilter()),this.staffFilter()&&(e.staff=this.staffFilter());let t=this.startDate(),r=this.endDate();return t&&r&&(e.startDate=t.toISOString(),e.endDate=r.toISOString()),e});ordersResource=he({params:()=>this.filterParams(),stream:({params:e})=>{if(!e.storeId)throw new Error("Store not selected");return this.ordersService.getStoreOrders(e.storeId,e)}});filteredOrders=k(()=>{let e=this.ordersResource.value()||[],t=this.searchQuery().toLowerCase();return t?e.filter(r=>r.reference?.toLowerCase().includes(t)||r.user?.name?.toLowerCase().includes(t)||r.user?.email?.toLowerCase().includes(t)):e});currency=k(()=>this.storeStore.selectedStore()?.currency||"\u20A6");statusOptions=[{value:"",label:"All Statuses"},{value:"Processing",label:"Processing"},{value:"Ready",label:"Ready"},{value:"Complete",label:"Complete"},{value:"Cancel",label:"Cancelled"}];paymentOptions=[{value:"",label:"All Payments"},{value:"Cash",label:"Cash"},{value:"POS Terminal",label:"POS Terminal"},{value:"Pay Online",label:"Pay Online"}];reloadData(){this.ordersResource.reload()}startNewSale(){this.router.navigate(["/menu/pos/checkout"])}clearFilters(){this.searchQuery.set(""),this.statusFilter.set(""),this.paymentFilter.set(""),this.staffFilter.set(this.authService.currentUserValue?._id||""),this.startDate.set(null),this.endDate.set(null),this.pageIndex.set(0)}onPageChange(e){this.pageIndex.set(e.pageIndex),this.pageSize.set(e.pageSize)}onStartDateChange(e){this.tempStartDate=e}onEndDateChange(e){this.tempEndDate=e}onDateRangeClosed(){this.tempStartDate&&this.tempEndDate&&(this.startDate.set(this.tempStartDate),this.endDate.set(this.tempEndDate))}getStatusColor(e){return{Processing:"bg-blue-100 text-blue-800",Ready:"bg-purple-100 text-purple-800",Complete:"bg-green-100 text-green-800",Cancel:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800"}getPaymentStatusColor(e){return e==="Paid"?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}getLocationInfo(e){return e.table?`Table: ${e.table.name}`:e.shippingFee&&e.shippingFee>0?"Delivery":"Quick Sale"}viewOrder(e){this.router.navigate(["/menu/pos/orders",e._id,"details"])}printOrder(e){if(console.log("Print order:",e),!e._id){this.snackBar.open("Invalid order data","Close",{duration:3e3}),console.error("Invalid order data");return}let t=F(P({},e),{store:F(P({},e.store),{currency:this.storeStore.selectedStore()?.currency||e.store?.currency||"NGN"})});this.sendToPrintJob(e._id,t)}sendToPrintJob(e,t){this.printJobService.createPrintJobsForOrder(e,t).subscribe({next:r=>{console.log("Print jobs created:",r),this.snackBar.open(`${r.jobs.length} print job(s) created successfully`,"Close",{duration:3e3})},error:r=>{this.snackBar.open("Failed to create print jobs","Close",{duration:3e3}),console.error("Error creating print jobs:",r)}})}editOrder(e){if(console.log("Editing order:",e),!e.cart?._id){console.error("Invalid cart data");return}if(this.cartStore.carts().length>0){this.cartStore.selectCart(e.cart._id);let r=this.cartStore.selectedCart();if(r){console.log("Using cart from store:",r),this.orderStore.selectOrder(e),this.saleTypeStore.setSelectedSaleType(e.type,!0),this.saleTypeStore.startEditing(),this.router.navigate(["/menu/pos/checkout"]);return}}this.cartService.getCartByIdRestructured(e.cart._id).subscribe({next:r=>{let s=[...this.cartStore.carts(),r];this.cartStore.updateCarts(s),this.cartStore.setCart(r),this.orderStore.selectOrder(e),this.saleTypeStore.setSelectedSaleType(e.type,!0),this.saleTypeStore.startEditing(),this.router.navigate(["/menu/pos/checkout"])},error:r=>{this.saleTypeStore.stopEditing(),console.error("Error fetching cart:",r)}})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=N({type:n,selectors:[["app-list-orders"]],decls:56,vars:16,consts:[["dateRangePicker",""],["menu","matMenu"],["cardMenu","matMenu"],["title","Orders","subtitle","Manage and track all your orders"],["actions",""],[1,"hidden","md:flex",3,"change","value"],["value","table"],["value","grid"],["mat-stroked-button","",3,"click"],["matButton","outlined",3,"click","disabled"],["matButton","filled","color","primary",3,"click"],[1,"max-w-12xl","py-6","px-4"],["appearance","outlined",1,"py-4"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4","px-4","mb-4"],["appearance","outline"],["matInput","","placeholder","Order ID, customer name...",3,"input","value"],["matPrefix",""],[3,"selectionChange","value"],[3,"value"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"dateChange","value"],["matEndDate","","placeholder","End date",3,"dateChange","value"],["matIconSuffix","",3,"for"],[3,"closed"],[1,"flex","items-center","justify-center","py-12"],["icon","error_outline","title","Failed to Load Orders",3,"message"],["icon","receipt_long","title","No Orders Found","message","No orders match your current filters. Try adjusting your search criteria."],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4","px-4"],["diameter","50"],["mat-flat-button","","color","primary",3,"click"],[1,"overflow-x-auto","hidden","md:block"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","reference"],["mat-header-cell","","class","font-semibold",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","total"],["matColumnDef","status"],["matColumnDef","payment"],["matColumnDef","paymentStatus"],["matColumnDef","location"],["matColumnDef","date"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"page","length","pageSize","pageIndex","pageSizeOptions"],["mat-header-cell","",1,"font-semibold"],["mat-cell",""],[1,"flex","flex-col"],[1,"font-medium"],[1,"text-sm","text-gray-600"],[1,"font-semibold"],[1,"text-sm"],[1,"text-xs"],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""],["appearance","outlined",1,"cursor-pointer","hover:shadow-lg","transition-shadow"],[1,"p-4"],[1,"flex","items-start","justify-between","mb-3"],[1,"flex-1"],[1,"font-semibold","text-lg"],[1,"mb-3"],[1,"text-2xl","font-bold"],[1,"flex","gap-2","mb-3"],[1,"space-y-1","text-sm","text-gray-600"],[1,"flex","items-center","gap-2"],[1,"text-base"]],template:function(t,r){if(t&1){let s=O();i(0,"app-page-header",3),h(1,4),i(2,"mat-button-toggle-group",5),u("change",function(g){return m(s),c(r.viewMode.set(g.value))}),i(3,"mat-button-toggle",6)(4,"mat-icon"),o(5,"table_view"),a()(),i(6,"mat-button-toggle",7)(7,"mat-icon"),o(8,"grid_view"),a()()(),i(9,"button",8),u("click",function(){return m(s),c(r.clearFilters())}),i(10,"mat-icon"),o(11,"clear"),a(),o(12," Clear Filters "),a(),i(13,"button",9),u("click",function(){return m(s),c(r.reloadData())}),i(14,"mat-icon"),o(15,"refresh"),a(),o(16," Reload "),a(),i(17,"button",10),u("click",function(){return m(s),c(r.startNewSale())}),i(18,"mat-icon"),o(19,"add_shopping_cart"),a(),o(20," Start New Sale "),a(),x(),a(),i(21,"div",11)(22,"mat-card",12)(23,"div",13)(24,"mat-form-field",14)(25,"mat-label"),o(26,"Search"),a(),i(27,"input",15),u("input",function(g){return m(s),c(r.searchQuery.set(g.target.value))}),a(),i(28,"mat-icon",16),o(29,"search"),a()(),i(30,"mat-form-field",14)(31,"mat-label"),o(32,"Status"),a(),i(33,"mat-select",17),u("selectionChange",function(g){return m(s),c(r.statusFilter.set(g.value))}),T(34,rt,2,2,"mat-option",18,Ze),a()(),i(36,"mat-form-field",14)(37,"mat-label"),o(38,"Payment"),a(),i(39,"mat-select",17),u("selectionChange",function(g){return m(s),c(r.paymentFilter.set(g.value))}),T(40,nt,2,2,"mat-option",18,Ze),a()(),i(42,"mat-form-field",14)(43,"mat-label"),o(44,"Date Range"),a(),i(45,"mat-date-range-input",19)(46,"input",20),u("dateChange",function(g){return m(s),c(r.onStartDateChange(g.value))}),a(),i(47,"input",21),u("dateChange",function(g){return m(s),c(r.onEndDateChange(g.value))}),a()(),M(48,"mat-datepicker-toggle",22),i(49,"mat-date-range-picker",23,0),u("closed",function(){return m(s),c(r.onDateRangeClosed())}),a()()(),b(51,at,2,0,"div",24),b(52,ot,3,1,"app-no-record",25),b(53,lt,1,0,"app-no-record",26),b(54,Ot,29,8),b(55,wt,3,0,"div",27),a()()}if(t&2){let s=I(50);l(2),p("value",r.viewMode()),l(11),p("disabled",r.ordersResource.isLoading()),l(),$("animate-spin",r.ordersResource.isLoading()),l(13),p("value",r.searchQuery()),l(6),p("value",r.statusFilter()),l(),L(r.statusOptions),l(5),p("value",r.paymentFilter()),l(),L(r.paymentOptions),l(5),p("rangePicker",s),l(),p("value",r.startDate()),l(),p("value",r.endDate()),l(),p("for",s),l(3),E(r.ordersResource.isLoading()?51:-1),l(),E(r.ordersResource.error()&&!r.ordersResource.isLoading()?52:-1),l(),E(!r.ordersResource.isLoading()&&!r.ordersResource.error()&&r.filteredOrders().length===0?53:-1),l(),E(!r.ordersResource.isLoading()&&!r.ordersResource.error()&&r.filteredOrders().length>0&&r.viewMode()==="table"?54:-1),l(),E(!r.ordersResource.isLoading()&&!r.ordersResource.error()&&r.filteredOrders().length>0&&r.viewMode()==="grid"?55:-1)}},dependencies:[H,Q,se,Ie,xe,be,De,Ee,ye,we,Me,Oe,Te,Le,re,te,ie,q,Y,U,ee,Z,ue,pe,de,me,ce,fe,_e,Ce,ve,G,Ne,ke,Pe,Fe,Ve,Re,J,Ge,Qe,Se,ge,le,ae,ne,oe,Be,$e,Je,je,He,Ae,ze,z,A],styles:["[_nghost-%COMP%]{display:block}"]})};export{et as ListOrders};
