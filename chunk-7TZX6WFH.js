import{a as st}from"./chunk-M7CDMT4F.js";import{a as V,b as ot,c as nt}from"./chunk-GYR27UWT.js";import{a as rt,b as at,c as mt,e as lt,h as H}from"./chunk-GS72R6E5.js";import{a as it}from"./chunk-ONWZVE76.js";import{a as q,b as tt}from"./chunk-SLNANJBJ.js";import{a as He,b as je,c as Ge,d as ze,e as Qe,f as Ze,g as We,h as Je,i as Ke,j as Xe,k as Ye,l as et}from"./chunk-SNJMCTTD.js";import"./chunk-GGOIOYKP.js";import"./chunk-LXK533WH.js";import{a as Oe,b as $e,c as qe,d as Ve}from"./chunk-EMC432UM.js";import{a as P}from"./chunk-NWQQ2VP3.js";import{a as Ue,b as Ae}from"./chunk-M54QIQPD.js";import"./chunk-ZXNLXZXA.js";import{d as he}from"./chunk-2NVE2BM3.js";import"./chunk-KAQLA7HR.js";import"./chunk-Y7XAAAUB.js";import{d as $}from"./chunk-USTUFZ7V.js";import{a as ve}from"./chunk-DXWLW3LX.js";import{b as R,c as B,d as U}from"./chunk-7JNU3RG5.js";import{a as k,b as ke,d as Fe,h as F}from"./chunk-3SKQMCZR.js";import"./chunk-UJ5WOJLI.js";import{a as Pe,c as Ne,g as Ie}from"./chunk-X7SU23UW.js";import{a as A,b as O}from"./chunk-W6FIBOPD.js";import{C as Te,D as we,E as Le,b as N,d as _,g as I,h as Me,l as Ee,m as xe,s as ye,t as De}from"./chunk-EQD33MW2.js";import"./chunk-3R2L4BJM.js";import{a as L,b as Se}from"./chunk-GGWIF4RR.js";import"./chunk-Y4VWLT32.js";import"./chunk-CDKFCYZ5.js";import{b as Re,c as Be}from"./chunk-2HLT5ZQQ.js";import{X as ge,Y as T,_ as w}from"./chunk-UUZHPQZB.js";import"./chunk-CQ6SLR32.js";import{a as be}from"./chunk-BFT2MTJY.js";import"./chunk-KTA4MFBX.js";import{A as _e,r as fe,t as Ce}from"./chunk-HUSU2JWO.js";import{Bc as D,Eb as p,Fb as c,Gb as ae,Hc as J,Ib as me,Jb as le,Jc as K,Kb as C,Lb as n,Mb as o,Nb as d,Rb as h,Sb as g,Ub as se,V as ne,Yb as S,Z as re,Za as m,_b as v,ca as s,cc as Q,dc as Z,ec as W,ha as j,ia as G,ic as ue,mb as x,nc as a,oc as b,pc as y,sb as f,sc as de,ta as z,tc as pe,uc as ce}from"./chunk-HCNG3XRF.js";import"./chunk-EQDQRRRY.js";var M=class e{http=s(_e);hostServer=be.apiUrl;validateEmailAndPhoneNumber({email:t,phoneNumber:i}){return this.http.post(`${this.hostServer}/auth/validate-email-and-phone?userType=merchant`,{email:t,phoneNumber:i})}createCustomer(t){return this.http.post(`${this.hostServer}/users`,t)}getStoreCustomers(t){return this.http.get(`${this.hostServer}/users/stores/${t}/users`)}deleteCustomer(t){return this.http.delete(`${this.hostServer}/users/${t}`)}updateCustomer(t,i){return this.http.put(`${this.hostServer}/users/${t}`,i)}static \u0275fac=function(i){return new(i||e)};static \u0275prov=re({token:e,factory:e.\u0275fac,providedIn:"root"})};var ht=()=>[];function gt(e,t){e&1&&(n(0,"mat-error"),a(1," Name is required "),o())}function St(e,t){e&1&&(n(0,"mat-error"),a(1," Name must be at least 2 characters "),o())}function bt(e,t){e&1&&(n(0,"mat-error"),a(1," Email is required "),o())}function vt(e,t){e&1&&(n(0,"mat-error"),a(1," Please enter a valid email address "),o())}function Mt(e,t){e&1&&(n(0,"mat-error"),a(1," Email must be lowercase "),o())}function Et(e,t){e&1&&(n(0,"mat-error"),a(1," Phone number is required "),o())}function xt(e,t){e&1&&(n(0,"mat-error"),a(1," Phone number must be at least 6 digits "),o())}function yt(e,t){if(e&1&&(n(0,"mat-option",9),a(1),o()),e&2){let i=t.$implicit;C("value",i.country),m(),y(" ",i.country," ")}}function Dt(e,t){e&1&&(n(0,"mat-error"),a(1," Country is required "),o())}function Tt(e,t){e&1&&d(0,"mat-spinner",14)}function wt(e){if(e.value){let t=e.value.toLowerCase();if(t!==e.value)return{lowercaseEmail:t}}return null}var E=class e{storeStore=s(P);fb=s(Te);customerService=s(M);snackBar=s(L);dialogRef=s(rt);data=s(at);storeService=s(ve);isSubmitting=z(!1);genders=["Male","Female"];isEdit=this.data.isEdit;form=this.fb.group({name:["",[_.required,_.minLength(2)]],email:["",[_.required,_.email,wt]],phoneNumber:["",[_.required,_.minLength(6)]],country:["",_.required],currency:["",_.required],notes:[""],store:[this.storeStore.selectedStore()?._id,_.required],password:["123456",_.required]});isLoading=z(!1);deliveryZones=$({stream:()=>this.storeService.getDeliveryZonesFromServer()});ngOnInit(){this.isEdit&&this.data.customer&&this.form.patchValue(this.data.customer)}selectCountry(t){let i=this.deliveryZones.value().find(r=>r.country===t);i&&this.form.patchValue({currency:i.currency})}onSubmit(){if(this.form.valid){this.isSubmitting.set(!0);let t=this.form.getRawValue();this.isEdit?this.customerService.updateCustomer(this.data.customer._id,t).subscribe(i=>{this.dialogRef.close(!0)},i=>{this.isLoading.set(!1),this.snackBar.open("Server or internet error please try again","Close",{duration:3e3})}):this.customerService.createCustomer(t).subscribe(i=>{i.status==401||i?.err?i.err.keyPattern.hasOwnProperty("email")?(this.isLoading.set(!1),this.snackBar.open("Email has already been used.","Close",{duration:3e3})):i.err.keyPattern.hasOwnProperty("phoneNumber")&&(this.isLoading.set(!1),this.snackBar.open("Phone number has already been used.","Close",{duration:3e3})):this.dialogRef.close(!0)},i=>{this.isLoading.set(!1),this.snackBar.open("Server or internet error please try again","Close",{duration:3e3})})}}onCancel(){this.dialogRef.close()}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=x({type:e,selectors:[["app-customer-dialog"]],decls:41,vars:15,consts:[[1,"p-6"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter customer name"],["matInput","","formControlName","email","type","email","placeholder","Enter email address"],["matInput","","formControlName","phoneNumber","placeholder","Enter phone number"],["formControlName","country","placeholder","Select country",3,"selectionChange"],[3,"value"],["matInput","","formControlName","notes","placeholder","Enter any additional notes"],[1,"flex","justify-end","space-x-2","mt-6","pt-4","border-t","border-gray-200"],["mat-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",1,"mr-2"]],template:function(i,r){if(i&1&&(n(0,"div",0)(1,"h2",1),a(2),o(),n(3,"form",2),S("ngSubmit",function(){return r.onSubmit()}),n(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),a(7,"Name"),o(),d(8,"input",5),p(9,gt,2,0,"mat-error"),p(10,St,2,0,"mat-error"),o(),n(11,"mat-form-field",4)(12,"mat-label"),a(13,"Email"),o(),d(14,"input",6),p(15,bt,2,0,"mat-error"),p(16,vt,2,0,"mat-error"),p(17,Mt,2,0,"mat-error"),o(),n(18,"mat-form-field",4)(19,"mat-label"),a(20,"Phone Number"),o(),d(21,"input",7),p(22,Et,2,0,"mat-error"),p(23,xt,2,0,"mat-error"),o(),n(24,"mat-form-field",4)(25,"mat-label"),a(26,"Country"),o(),n(27,"mat-select",8),S("selectionChange",function(u){return r.selectCountry(u.value)}),me(28,yt,2,2,"mat-option",9,ae),o(),p(30,Dt,2,0,"mat-error"),o(),n(31,"mat-form-field",4)(32,"mat-label"),a(33,"Notes"),o(),d(34,"textarea",10),o()(),n(35,"div",11)(36,"button",12),S("click",function(){return r.onCancel()}),a(37,"Cancel"),o(),n(38,"button",13),p(39,Tt,1,0,"mat-spinner",14),a(40),o()()()()),i&2){let l,u,X,Y,ee,te,ie,oe;m(2),y(" ",r.isEdit?"Edit Customer":"Create New Customer"," "),m(),C("formGroup",r.form),m(6),c((l=r.form.get("name"))!=null&&l.hasError("required")?9:-1),m(),c((u=r.form.get("name"))!=null&&u.hasError("minlength")?10:-1),m(5),c((X=r.form.get("email"))!=null&&X.hasError("required")?15:-1),m(),c((Y=r.form.get("email"))!=null&&Y.hasError("email")?16:-1),m(),c((ee=r.form.get("email"))!=null&&ee.hasError("lowercase")?17:-1),m(5),c((te=r.form.get("phoneNumber"))!=null&&te.hasError("required")?22:-1),m(),c((ie=r.form.get("phoneNumber"))!=null&&ie.hasError("minlength")?23:-1),m(5),le(r.deliveryZones.value()||D(14,ht)),m(2),c((oe=r.form.get("country"))!=null&&oe.hasError("required")?30:-1),m(6),C("disabled",r.isSubmitting()),m(2),C("disabled",!r.form.valid||r.isSubmitting()),m(),c(r.isSubmitting()?39:-1),m(),y(" ",r.isEdit?"Update":"Create"," ")}},dependencies:[H,lt,w,T,R,F,k,ke,U,B,Ae,Ue,he,Le,xe,N,I,Me,De,ye,O,A],encapsulation:2})};var Lt=()=>[5,10,25,100];function Pt(e,t){e&1&&(n(0,"div",10),d(1,"mat-spinner",14),o())}function Nt(e,t){e&1&&d(0,"app-no-record",11)}function It(e,t){e&1&&d(0,"app-no-record",12)}function kt(e,t){e&1&&(n(0,"th",31),a(1,"Name"),o())}function Ft(e,t){if(e&1&&(n(0,"td",32),a(1),o()),e&2){let i=t.$implicit;m(),b(i.name)}}function Rt(e,t){e&1&&(n(0,"th",31),a(1,"Gender"),o())}function Bt(e,t){if(e&1&&(n(0,"td",32),a(1),o()),e&2){let i=t.$implicit;m(),b(i.gender)}}function Ut(e,t){e&1&&(n(0,"th",31),a(1,"Email"),o())}function At(e,t){if(e&1&&(n(0,"td",32),a(1),o()),e&2){let i=t.$implicit;m(),b(i.email)}}function Ot(e,t){e&1&&(n(0,"th",31),a(1,"Phone"),o())}function $t(e,t){if(e&1&&(n(0,"td",32),a(1),o()),e&2){let i=t.$implicit;m(),b(i.phoneNumber)}}function qt(e,t){e&1&&(n(0,"th",31),a(1,"Country"),o())}function Vt(e,t){if(e&1&&(n(0,"td",32),a(1),o()),e&2){let i=t.$implicit;m(),b(i.country)}}function Ht(e,t){e&1&&(n(0,"th",31),a(1,"Total Amount Spent"),o())}function jt(e,t){if(e&1&&(n(0,"td",32),a(1),J(2,"currency"),o()),e&2){let i,r=t.$implicit,l=v(2);m(),b(K(2,1,r.totalAmountSpent||0,(i=l.storeStore.selectedStore())==null?null:i.currency))}}function Gt(e,t){e&1&&(n(0,"th",31),a(1,"Avg Amount Spent"),o())}function zt(e,t){if(e&1&&(n(0,"td",32),a(1),J(2,"currency"),o()),e&2){let i,r=t.$implicit,l=v(2);m(),b(K(2,1,r.avgAmountSpent||0,(i=l.storeStore.selectedStore())==null?null:i.currency))}}function Qt(e,t){e&1&&(n(0,"th",31),a(1,"Total Orders"),o())}function Zt(e,t){if(e&1&&(n(0,"td",32),a(1),o()),e&2){let i=t.$implicit;m(),b(i.totalOrders||0)}}function Wt(e,t){e&1&&(n(0,"th",33),a(1,"Actions"),o())}function Jt(e,t){if(e&1){let i=se();n(0,"td",32)(1,"button",34)(2,"mat-icon"),a(3,"more_vert"),o()(),n(4,"mat-menu",null,0)(6,"button",35),S("click",function(){let l=j(i).$implicit,u=v(2);return G(u.editCustomer(l))}),n(7,"mat-icon"),a(8,"edit"),o(),n(9,"span"),a(10,"Edit"),o()(),n(11,"button",35),S("click",function(){let l=j(i).$implicit,u=v(2);return G(u.deleteCustomer(l))}),n(12,"mat-icon"),a(13,"delete"),o(),n(14,"span"),a(15,"Delete"),o()()()()}if(e&2){let i=ue(5);m(),C("matMenuTriggerFor",i)}}function Kt(e,t){e&1&&d(0,"tr",36)}function Xt(e,t){e&1&&d(0,"tr",37)}function Yt(e,t){if(e&1&&(n(0,"div",13)(1,"table",15),h(2,16),f(3,kt,2,0,"th",17)(4,Ft,2,1,"td",18),g(),h(5,19),f(6,Rt,2,0,"th",17)(7,Bt,2,1,"td",18),g(),h(8,20),f(9,Ut,2,0,"th",17)(10,At,2,1,"td",18),g(),h(11,21),f(12,Ot,2,0,"th",17)(13,$t,2,1,"td",18),g(),h(14,22),f(15,qt,2,0,"th",17)(16,Vt,2,1,"td",18),g(),h(17,23),f(18,Ht,2,0,"th",17)(19,jt,3,4,"td",18),g(),h(20,24),f(21,Gt,2,0,"th",17)(22,zt,3,4,"td",18),g(),h(23,25),f(24,Qt,2,0,"th",17)(25,Zt,2,1,"td",18),g(),h(26,26),f(27,Wt,2,0,"th",27)(28,Jt,16,1,"td",18),g(),f(29,Kt,1,0,"tr",28)(30,Xt,1,0,"tr",29),o(),d(31,"mat-paginator",30),o()),e&2){let i=v();m(),C("dataSource",i.dataSource),m(28),C("matHeaderRowDef",i.displayedColumns),m(),C("matRowDefColumns",i.displayedColumns),m(),C("pageSizeOptions",D(4,Lt))}}var dt=class e{dialog=s(mt);snackBar=s(L);customerService=s(M);storeStore=s(P);displayedColumns=["name","email","phoneNumber","totalAmountSpent","totalOrders","avgAmountSpent","country","actions"];dataSource;searchText="";paginator;sort;customers=$({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:t})=>this.customerService.getStoreCustomers(t.storeId).pipe(ne(i=>{this.dataSource=new et(i),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}))});applyFilter(t){let i=t.target.value;this.dataSource.filter=i.trim().toLowerCase()}openDialog(){this.dialog.open(E,{width:"800px",data:{isEdit:!1}}).afterClosed().subscribe(i=>{i&&this.customers.reload()})}editCustomer(t){this.dialog.open(E,{width:"800px",data:{isEdit:!0,customer:t}}).afterClosed().subscribe(r=>{r&&this.customers.reload()})}deleteCustomer(t){if(t.role?.name==="Owner"){this.snackBar.open("Cannot delete an owner","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"});return}this.dialog.open(st,{width:"350px",data:{message:`Are you sure you want to delete ${t.name}?`}}).afterClosed().subscribe(r=>{r&&this.customerService.deleteCustomer(t._id).subscribe({next:()=>{this.snackBar.open("Customer deleted successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.customers.reload()},error:()=>{this.snackBar.open("Error deleting customer","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})})}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=x({type:e,selectors:[["app-list-customers"]],viewQuery:function(i,r){if(i&1&&(Q(q,5),Q(V,5)),i&2){let l;Z(l=W())&&(r.paginator=l.first),Z(l=W())&&(r.sort=l.first)}},decls:19,vars:2,consts:[["menu","matMenu"],[1,"Customers-container","!bg-white"],[1,"!bg-white"],[1,"flex","flex-col","md:flex-row","justify-between","gap-4","p-4"],[1,"flex","flex-col","sm:flex-row","gap-4","flex-grow"],["appearance","outline",1,"w-full","sm:w-48","md:w-72","lg:w-96"],["matPrefix",""],["matInput","","placeholder","Search Customers",3,"keyup","ngModelChange","ngModel"],[1,"flex","gap-3","justify-end"],["mat-raised-button","","color","primary",3,"click"],[1,"flex","items-center","justify-center","min-h-[300px]"],["icon","people","title","No Customers","message","No Customers found matching your criteria."],["icon","error","title","Error","message","An error occurred while fetching Customers. Please try again later."],[1,"table-container","!bg-white"],["diameter","40"],["mat-table","","matSort","",1,"!bg-white",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","gender"],["matColumnDef","email"],["matColumnDef","phoneNumber"],["matColumnDef","country"],["matColumnDef","totalAmountSpent"],["matColumnDef","avgAmountSpent"],["matColumnDef","totalOrders"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of Customers",1,"!bg-white",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","aria-label","Customer actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,r){i&1&&(n(0,"mat-card",1)(1,"mat-card-content",2)(2,"div",3)(3,"div",4)(4,"mat-form-field",5)(5,"mat-label"),a(6,"Search"),o(),n(7,"mat-icon",6),a(8,"search"),o(),n(9,"input",7),S("keyup",function(u){return r.applyFilter(u)}),ce("ngModelChange",function(u){return pe(r.searchText,u)||(r.searchText=u),u}),o()()(),n(10,"div",8)(11,"button",9),S("click",function(){return r.openDialog()}),n(12,"mat-icon"),a(13,"add"),o(),a(14," ADD Customer "),o()()(),p(15,Pt,2,0,"div",10)(16,Nt,1,0,"app-no-record",11)(17,It,1,0,"app-no-record",12)(18,Yt,32,5,"div",13),o()()),i&2&&(m(9),de("ngModel",r.searchText),m(6),c(r.customers.isLoading()?15:r.customers.hasValue()&&r.dataSource.data.length===0?16:r.customers.error()?17:r.customers.hasValue()?18:-1))},dependencies:[Ce,Ye,He,Ge,We,ze,je,Je,Qe,Ze,Ke,Xe,tt,q,nt,V,ot,Ie,Pe,Ne,R,F,k,Fe,U,B,w,T,ge,Be,Re,Ve,$e,Oe,qe,O,A,it,H,Se,we,N,I,Ee,fe],encapsulation:2})};export{dt as CustomerListComponent};
