import{a as I}from"./chunk-MN2SJZYE.js";import{a as me}from"./chunk-ETASEB53.js";import"./chunk-B276YSOB.js";import{f as se}from"./chunk-6IVFTPYN.js";import{c as ae,h as de}from"./chunk-7AEPEFCD.js";import{a as le}from"./chunk-4KYCCNTD.js";import{a as re}from"./chunk-XCRB4NGT.js";import{a as oe}from"./chunk-P5H3RIJ7.js";import{a as U,b as W,e as X,f as Y,g as Z,h as ee,i as te,k as ie,l as ne}from"./chunk-JR6JYGE5.js";import{b as Q}from"./chunk-IQCUWJKP.js";import"./chunk-DSVTILZD.js";import{i as $}from"./chunk-I4XKOMFF.js";import{d as E}from"./chunk-34VGG7JE.js";import"./chunk-JOC3JCWJ.js";import"./chunk-AXVKE7YV.js";import"./chunk-UDXHODBD.js";import"./chunk-XBTGTIDL.js";import"./chunk-3JUXLSAM.js";import"./chunk-TKNXELSU.js";import"./chunk-JT5P23LW.js";import{a as J,b as K}from"./chunk-4CSV6WDD.js";import"./chunk-APGJ2ZCU.js";import"./chunk-KLDQLPSD.js";import"./chunk-6XJLFJNL.js";import{a as j}from"./chunk-3LEF2TVB.js";import"./chunk-R35DVJIH.js";import"./chunk-BFT2MTJY.js";import{a as O,b as G,c as B,d as H,f as z,h as q}from"./chunk-SV3V3KFF.js";import"./chunk-FTUKKUPK.js";import"./chunk-J6S3CU5H.js";import"./chunk-SBJI2VOL.js";import{b as V,c as A}from"./chunk-A5WKFY2Q.js";import{$ as L,Z as F,aa as N}from"./chunk-PD333HOR.js";import{e as T,g as D}from"./chunk-T7PMTSVA.js";import{$b as C,Hb as p,Ib as _,Kb as P,Lb as x,Mb as g,Nb as v,Ob as o,Pb as r,Qb as y,Uc as f,Xb as M,ab as a,bc as m,ea as h,ja as R,ka as b,pb as k,qc as s,rc as c,sc as S,va as w}from"./chunk-ZCSDIQ3M.js";import"./chunk-GAL4ENT6.js";var ue=(i,t)=>t._id,pe=(i,t)=>t.code;function _e(i,t){i&1&&(o(0,"div",9),y(1,"mat-spinner",14),r())}function fe(i,t){i&1&&y(0,"app-no-record",10)}function xe(i,t){if(i&1){let e=M();o(0,"mat-list-option",18),C("click",function(){let l=R(e).$implicit,u=m(3);return b(u.selectRole(l))}),o(1,"mat-icon",19),s(2),r(),o(3,"div",20),s(4),r(),o(5,"div",21),s(6),r()()}if(i&2){let e,n=t.$implicit,l=m(3);v("selected",((e=l.selectedRole())==null?null:e._id)===n._id),a(2),c(l.getRoleIcon(n)),a(2),c(n.name),a(2),S("",n.permissions.length||0," permissions")}}function ge(i,t){if(i&1&&(o(0,"div",15),s(1,"Administrative Roles"),r(),x(2,xe,7,4,"mat-list-option",17,ue)),i&2){let e=m(2);a(2),g(e.administrativeRoles())}}function ve(i,t){if(i&1){let e=M();o(0,"mat-list-option",18),C("click",function(){let l=R(e).$implicit,u=m(3);return b(u.selectRole(l))}),o(1,"mat-icon",19),s(2),r(),o(3,"div",20),s(4),r(),o(5,"div",21),s(6),r()()}if(i&2){let e,n=t.$implicit,l=m(3);v("selected",((e=l.selectedRole())==null?null:e._id)===n._id),a(2),c(l.getRoleIcon(n)),a(2),c(n.name),a(2),S("",n.permissions.length||0," permissions")}}function Ce(i,t){if(i&1&&x(0,ve,7,4,"mat-list-option",17,ue),i&2){let e=m(2);g(e.customRoles())}}function he(i,t){i&1&&(o(0,"div",16),s(1," No custom roles created yet "),r())}function Re(i,t){if(i&1&&(o(0,"mat-selection-list",11),p(1,ge,4,0),o(2,"div",15),s(3,"Custom Roles"),r(),p(4,Ce,2,0)(5,he,2,0,"div",16),r()),i&2){let e=m();v("multiple",!1),a(),_(e.administrativeRoles().length>0?1:-1),a(3),_(e.customRoles().length>0?4:5)}}function be(i,t){if(i&1&&(o(0,"mat-list-item")(1,"mat-icon",34),s(2,"check_circle"),r(),o(3,"div",20),s(4),r(),o(5,"div",21),s(6),r()()),i&2){let e=t.$implicit;a(4),c(e.name),a(2),c(e.group)}}function Se(i,t){if(i&1&&(o(0,"div",15),s(1),r(),x(2,be,7,2,"mat-list-item",null,pe)),i&2){let e=m().$implicit,n=m(2);a(),c(e),a(),g(n.getGrantedPermissionsForModule(e))}}function Me(i,t){if(i&1&&p(0,Se,4,1),i&2){let e=t.$implicit,n=m(2);_(n.getGrantedPermissionsForModule(e).length>0?0:-1)}}function Pe(i,t){i&1&&(o(0,"div",33),s(1," No permissions granted "),r())}function ye(i,t){if(i&1&&(o(0,"mat-list-item")(1,"mat-icon",35),s(2,"cancel"),r(),o(3,"div",20),s(4),r(),o(5,"div",21),s(6),r()()),i&2){let e=t.$implicit;a(4),c(e.name),a(2),c(e.group)}}function Ee(i,t){if(i&1&&(o(0,"div",15),s(1),r(),x(2,ye,7,2,"mat-list-item",null,pe)),i&2){let e=m().$implicit,n=m(2);a(),c(e),a(),g(n.getDeniedPermissionsForModule(e))}}function Ie(i,t){if(i&1&&p(0,Ee,4,1),i&2){let e=t.$implicit,n=m(2);_(n.getDeniedPermissionsForModule(e).length>0?0:-1)}}function we(i,t){i&1&&(o(0,"div",33),s(1," All permissions granted "),r())}function ke(i,t){if(i&1){let e=M();o(0,"mat-card",5)(1,"mat-card-header",22)(2,"div",23)(3,"div",24)(4,"mat-icon"),s(5),r()(),o(6,"div",25)(7,"mat-card-title"),s(8),r(),o(9,"mat-card-subtitle"),s(10),r()(),o(11,"div",26)(12,"button",27),C("click",function(){R(e);let l=m();return b(l.openEditRoleDialog())}),o(13,"mat-icon"),s(14,"edit"),r(),s(15," Edit Role "),r(),o(16,"button",28),C("click",function(){R(e);let l=m();return b(l.deleteRole())}),o(17,"mat-icon"),s(18,"delete"),r(),s(19," Delete "),r()()()(),o(20,"mat-card-content",29)(21,"div",30)(22,"mat-card",31)(23,"mat-card-header")(24,"mat-card-title"),s(25),r()(),o(26,"mat-card-content",32)(27,"mat-list"),x(28,Me,1,1,null,null,P),p(30,Pe,2,0,"div",33),r()()(),o(31,"mat-card",31)(32,"mat-card-header")(33,"mat-card-title"),s(34),r()(),o(35,"mat-card-content",32)(36,"mat-list"),x(37,Ie,1,1,null,null,P),p(39,we,2,0,"div",33),r()()()()()()}if(i&2){let e,n,l,u,d=m();a(3),v("ngClass",d.getRoleColor(d.selectedRole())),a(2),c(d.getRoleIcon(d.selectedRole())),a(3),c((e=d.selectedRole())==null?null:e.name),a(2),c(((n=d.selectedRole())==null?null:n.description)||"No description"),a(2),v("disabled",(l=d.selectedRole())==null?null:l.isAdministrative),a(4),v("disabled",(u=d.selectedRole())==null?null:u.isAdministrative),a(9),S(" Granted Permissions (",d.allowedPermissions().length,") "),a(3),g(d.modules()),a(2),_(d.allowedPermissions().length===0?30:-1),a(4),S(" Denied Permissions (",d.deniedPermissions().length,") "),a(3),g(d.modules()),a(2),_(d.deniedPermissions().length===0?39:-1)}}function Te(i,t){i&1&&(o(0,"mat-card",13)(1,"mat-card-content",36)(2,"div",37)(3,"mat-icon",38),s(4,"touch_app"),r(),o(5,"h3",39),s(6,"Select a Role"),r(),o(7,"p",40),s(8,"Click on a role from the list to view its permissions"),r()()()())}var ce=class i{rolesService=h(j);storeStore=h($);dialog=h(ae);location=h(T);selectedRole=w(null);roles=E({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:t})=>this.rolesService.getAllRolesForStore(t.storeId)});permissionsResource=E({stream:()=>this.rolesService.getGroupedPermissions()});groupedPermissions=f(()=>this.permissionsResource.value()||{});allPermissions=f(()=>{let t=this.groupedPermissions(),e=[];for(let n of Object.keys(t))for(let l of Object.keys(t[n]))e.push(...t[n][l]);return e});modules=f(()=>Object.keys(this.groupedPermissions()));administrativeRoles=f(()=>this.roles.value()?.filter(t=>t.isAdministrative)||[]);customRoles=f(()=>this.roles.value()?.filter(t=>!t.isAdministrative)||[]);rolePermissionCodes=f(()=>{let t=this.selectedRole();return!t||!t.permissions?new Set:new Set(t.permissions.map(e=>e.code))});hasPermission(t){return this.rolePermissionCodes().has(t)}allowedPermissions=f(()=>{let t=this.rolePermissionCodes();return t.size===0?[]:this.allPermissions().filter(e=>t.has(e.code))});deniedPermissions=f(()=>{if(!this.selectedRole())return[];let e=this.rolePermissionCodes();return this.allPermissions().filter(n=>!e.has(n.code))});selectRole(t){this.selectedRole.set(t)}openCreateRoleDialog(){let t=this.storeStore.selectedStore()?._id;if(!t)return;this.dialog.open(I,{width:"700px",maxHeight:"90vh",data:{storeId:t}}).afterClosed().subscribe(n=>{n&&(this.roles.reload(),this.permissionsResource.reload())})}openEditRoleDialog(){let t=this.selectedRole();if(!t||t.isAdministrative)return;let e=this.storeStore.selectedStore()?._id;if(!e)return;this.dialog.open(I,{width:"700px",maxHeight:"90vh",data:{storeId:e,role:t}}).afterClosed().subscribe(l=>{l&&(this.selectedRole.set(l),this.roles.reload(),this.permissionsResource.reload())})}deleteRole(){let t=this.selectedRole();if(!t||t.isAdministrative)return;this.dialog.open(me,{width:"400px",data:{title:"Delete Role",message:`Are you sure you want to delete the role "${t.name}"? This action cannot be undone.`}}).afterClosed().subscribe(n=>{n&&this.rolesService.deleteRole(t._id).subscribe({next:()=>{this.selectedRole.set(null),this.roles.reload()},error:l=>{console.error("Failed to delete role:",l)}})})}getRoleIcon(t){let e=t.name.toLowerCase();return e.includes("admin")||e.includes("owner")?"admin_panel_settings":e.includes("manager")?"manage_accounts":e.includes("front desk")||e.includes("receptionist")?"support_agent":e.includes("housekeeper")||e.includes("housekeeping")?"cleaning_services":e.includes("accountant")||e.includes("finance")?"account_balance":"person"}getRoleColor(t){let e=t.name.toLowerCase();return e.includes("admin")||e.includes("owner")?"bg-purple-100 text-purple-700":e.includes("manager")?"bg-blue-100 text-blue-700":e.includes("front desk")||e.includes("receptionist")?"bg-green-100 text-green-700":e.includes("housekeeper")||e.includes("housekeeping")?"bg-yellow-100 text-yellow-700":e.includes("accountant")||e.includes("finance")?"bg-indigo-100 text-indigo-700":"bg-gray-100 text-gray-700"}getModuleIcon(t){switch(t){case"Hotel Management":return"hotel";case"ERP":return"inventory_2";case"Finance":return"payments";case"Settings":return"settings";default:return"folder"}}getModuleColor(t){switch(t){case"Hotel Management":return"text-blue-600";case"ERP":return"text-green-600";case"Finance":return"text-purple-600";case"Settings":return"text-gray-600";default:return"text-gray-500"}}getGroupsForModule(t){return Object.keys(this.groupedPermissions()[t]||{})}getTotalModulePermissions(t){let e=this.groupedPermissions()[t];return e?Object.values(e).reduce((n,l)=>n+l.length,0):0}getGrantedModulePermissions(t){let e=this.groupedPermissions()[t];if(!e)return 0;let n=this.rolePermissionCodes(),l=0;for(let u of Object.values(e))for(let d of u)n.has(d.code)&&l++;return l}getGrantedPermissionsForModule(t){let e=this.groupedPermissions()[t];if(!e)return[];let n=this.rolePermissionCodes(),l=[];for(let u of Object.values(e))for(let d of u)n.has(d.code)&&l.push(d);return l}getDeniedPermissionsForModule(t){let e=this.groupedPermissions()[t];if(!e)return[];let n=this.rolePermissionCodes(),l=[];for(let u of Object.values(e))for(let d of u)n.has(d.code)||l.push(d);return l}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=k({type:i,selectors:[["app-roles"]],decls:22,vars:2,consts:[[1,"flex","flex-col","h-[calc(100vh-200px)]"],[1,"mb-4"],["mat-button","",3,"click"],[1,"flex","gap-6","flex-1","min-h-0"],[1,"w-96","shrink-0","flex","flex-col"],["appearance","outlined",1,"h-full","flex","flex-col","overflow-hidden"],[1,"shrink-0","!flex","!justify-between","!items-center"],["mat-mini-fab","","color","primary","matTooltip","Create Custom Role",3,"click"],[1,"p-0","flex-1","overflow-y-auto"],[1,"flex","justify-center","items-center","p-8"],["icon","badge","title","No Roles Found","message","Create your first role to manage staff permissions"],[3,"multiple"],[1,"flex-1","min-w-0","flex","flex-col"],["appearance","outlined",1,"h-full","flex","flex-col"],["diameter","32"],["mat-subheader",""],[1,"px-4","py-3","text-sm","text-gray-500","italic"],[3,"selected"],[3,"click","selected"],["matListItemIcon",""],["matListItemTitle",""],["matListItemLine",""],[1,"pb-4","mb-4","shrink-0"],[1,"flex","items-center","gap-4","w-full"],[1,"w-12","h-12","rounded-full","flex","items-center","justify-center",3,"ngClass"],[1,"flex-1"],[1,"flex","gap-2"],["mat-stroked-button","",3,"click","disabled"],["mat-stroked-button","","color","warn",3,"click","disabled"],[1,"pt-4","flex-1","overflow-y-auto"],[1,"flex","gap-4"],["appearance","outlined",1,"flex-1","!overflow-hidden"],[1,"!p-0","max-h-[400px]","overflow-y-auto"],[1,"p-4","text-center","text-gray-500","italic"],["matListItemIcon","",1,"text-green-600"],["matListItemIcon","",1,"text-red-400"],[1,"flex-1","flex","items-center","justify-center"],[1,"text-center","py-16"],[1,"text-6xl","text-gray-300","mb-4"],[1,"text-lg","font-medium","text-gray-600","mb-2"],[1,"text-gray-500"]],template:function(e,n){if(e&1&&(o(0,"div",0)(1,"div",1)(2,"button",2),C("click",function(){return n.location.back()}),o(3,"mat-icon"),s(4,"arrow_back"),r(),s(5," Back "),r()(),o(6,"div",3)(7,"div",4)(8,"mat-card",5)(9,"mat-card-header",6)(10,"mat-card-title"),s(11,"Roles"),r(),o(12,"button",7),C("click",function(){return n.openCreateRoleDialog()}),o(13,"mat-icon"),s(14,"add"),r()()(),o(15,"mat-card-content",8),p(16,_e,2,0,"div",9)(17,fe,1,0,"app-no-record",10)(18,Re,6,3,"mat-selection-list",11),r()()(),o(19,"div",12),p(20,ke,40,10,"mat-card",5)(21,Te,9,0,"mat-card",13),r()()()),e&2){let l;a(16),_(n.roles.isLoading()?16:((l=n.roles.value())==null?null:l.length)===0?17:18),a(4),_(n.selectedRole()?20:21)}},dependencies:[ne,Y,ie,Z,ee,X,te,W,U,A,V,N,F,L,q,O,B,z,H,G,se,K,J,Q,re,oe,de,le,D],encapsulation:2,changeDetection:0})};export{ce as Roles};
