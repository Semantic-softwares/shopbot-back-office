import{a as si,b as St,c as pn,d as gn}from"./chunk-ERGJHVCZ.js";import{a as dn,b as ri}from"./chunk-KZJU4FZP.js";import{a as un}from"./chunk-JJIO3ERO.js";import{a as we}from"./chunk-KJFNPXES.js";import{a as ai}from"./chunk-W5COJMSM.js";import{a as xt}from"./chunk-LQPRTGPJ.js";import{a as ln,b as mn,c as cn}from"./chunk-XPNY7I6K.js";import{b as sn}from"./chunk-WN4JDJ5Y.js";import{a as rn,c as bt}from"./chunk-PFBPZS4P.js";import{a as oi,b as ht,c as je,d as an,e as Ct,f as vt,g as _t,h as yt}from"./chunk-GS72R6E5.js";import{a as on}from"./chunk-ONWZVE76.js";import"./chunk-HZC625BF.js";import{a as tn,b as nn,c as Ke,d as ut,e as pt,f as gt,g as ft,h as Pe}from"./chunk-3UMN7V3H.js";import{a as Wt,b as zt,c as Zt,d as Jt,e as Yt,f as Qt,g as Xt,h as ei,i as ti,j as ii,k as ni}from"./chunk-SNJMCTTD.js";import{a as Se}from"./chunk-GGOIOYKP.js";import{a as dt}from"./chunk-LXK533WH.js";import{g as Qi}from"./chunk-B3QUAYVA.js";import{e as en}from"./chunk-NABEI5FJ.js";import{a as lt,b as Kt,c as Xi,e as jt,f as mt,g as ct,l as Ie}from"./chunk-TKDVIZGU.js";import{a as Ut,b as Ue}from"./chunk-CRWXVOET.js";import{a as nt}from"./chunk-BTIPWJHT.js";import"./chunk-AR7G356Q.js";import"./chunk-YCI4GSMN.js";import{a as Ui}from"./chunk-BA3SXM5W.js";import{a as K}from"./chunk-NWQQ2VP3.js";import{a as Ge,b as ge}from"./chunk-M54QIQPD.js";import"./chunk-ZXNLXZXA.js";import{d as ye}from"./chunk-2NVE2BM3.js";import"./chunk-KAQLA7HR.js";import"./chunk-Y7XAAAUB.js";import{c as A,d as Re}from"./chunk-USTUFZ7V.js";import"./chunk-DXWLW3LX.js";import{b as W,c as be,d as B}from"./chunk-7JNU3RG5.js";import{a as oe,b as rt,c as ke,d as st,e as $e,h as ae}from"./chunk-3SKQMCZR.js";import"./chunk-UJ5WOJLI.js";import{a as ee,b as te,c as ie,d as at,e as Yi,f as ne,g as O}from"./chunk-X7SU23UW.js";import{a as He,b as xe}from"./chunk-W6FIBOPD.js";import{C as Te,D as Ji,E as $,b as ue,d,e as Ki,g as X,h as j,i as qt,k as ji,m as Le,n as $t,o as Nt,p as Wi,q as qe,r as Ht,s as pe,t as q,y as zi,z as Zi}from"./chunk-EQD33MW2.js";import"./chunk-3R2L4BJM.js";import{a as ot,b as Vt}from"./chunk-GGWIF4RR.js";import{a as Lt}from"./chunk-VVXEDJF7.js";import"./chunk-CUQFI5AX.js";import"./chunk-Y4VWLT32.js";import"./chunk-CDKFCYZ5.js";import{b as H,c as I}from"./chunk-2HLT5ZQQ.js";import{X as Bt,Y as de,_ as L}from"./chunk-UUZHPQZB.js";import"./chunk-CQ6SLR32.js";import"./chunk-BFT2MTJY.js";import{e as Ot,g as Hi}from"./chunk-QAO3BBZ5.js";import"./chunk-KTA4MFBX.js";import{g as Li,i as At,n as qi,o as it,r as _e,s as $i,t as G}from"./chunk-HUSU2JWO.js";import{$c as Bi,Ac as wt,Bc as tt,Cc as De,Dc as Ai,Eb as f,F as Di,Fb as h,Gb as Pt,Gc as xi,Hb as Ti,Hc as R,Ib as z,Ic as ze,J as Qe,Jb as Z,Jc as he,Kb as g,Kc as Oi,Lb as a,Lc as Q,Mb as n,Nb as C,R as Ri,Rb as me,Rc as F,S as Ni,Sb as ce,T as se,Ub as T,V as Xe,Wc as U,Xc as w,Yb as b,Z as It,Za as l,_b as p,ca as _,cd as Vi,f as Ve,g as Ei,ha as x,ia as S,ic as Me,m as Ye,mb as N,mc as et,nc as r,oc as k,pc as y,qc as Ee,rc as ki,sb as Y,sc as Gi,ta as E,tc as Ii,uc as Pi,wa as Ae,yc as wi}from"./chunk-HCNG3XRF.js";import{a as yi,b as bi,f as ve}from"./chunk-EQDQRRRY.js";var Si=(u=>(u.PENDING="pending",u.RESERVED="reserved",u.CONFIRMED="confirmed",u.CHECKED_IN="checked_in",u.CHECKED_OUT="checked_out",u.CANCELLED="cancelled",u.NO_SHOW="no_show",u))(Si||{});var li=class o{countries=[{code:"AF",name:"Afghanistan"},{code:"AL",name:"Albania"},{code:"DZ",name:"Algeria"},{code:"AS",name:"American Samoa"},{code:"AD",name:"Andorra"},{code:"AO",name:"Angola"},{code:"AI",name:"Anguilla"},{code:"AQ",name:"Antarctica"},{code:"AG",name:"Antigua and Barbuda"},{code:"AR",name:"Argentina"},{code:"AM",name:"Armenia"},{code:"AW",name:"Aruba"},{code:"AU",name:"Australia"},{code:"AT",name:"Austria"},{code:"AZ",name:"Azerbaijan"},{code:"BS",name:"Bahamas"},{code:"BH",name:"Bahrain"},{code:"BD",name:"Bangladesh"},{code:"BB",name:"Barbados"},{code:"BY",name:"Belarus"},{code:"BE",name:"Belgium"},{code:"BZ",name:"Belize"},{code:"BJ",name:"Benin"},{code:"BM",name:"Bermuda"},{code:"BT",name:"Bhutan"},{code:"BO",name:"Bolivia"},{code:"BA",name:"Bosnia and Herzegovina"},{code:"BW",name:"Botswana"},{code:"BV",name:"Bouvet Island"},{code:"BR",name:"Brazil"},{code:"BN",name:"Brunei"},{code:"BG",name:"Bulgaria"},{code:"BF",name:"Burkina Faso"},{code:"BI",name:"Burundi"},{code:"KH",name:"Cambodia"},{code:"CM",name:"Cameroon"},{code:"CA",name:"Canada"},{code:"CV",name:"Cape Verde"},{code:"KY",name:"Cayman Islands"},{code:"CF",name:"Central African Republic"},{code:"TD",name:"Chad"},{code:"CL",name:"Chile"},{code:"CN",name:"China"},{code:"CX",name:"Christmas Island"},{code:"CC",name:"Cocos Islands"},{code:"CO",name:"Colombia"},{code:"KM",name:"Comoros"},{code:"CG",name:"Congo"},{code:"CD",name:"Congo (Democratic Republic)"},{code:"CK",name:"Cook Islands"},{code:"CR",name:"Costa Rica"},{code:"HR",name:"Croatia"},{code:"CU",name:"Cuba"},{code:"CY",name:"Cyprus"},{code:"CZ",name:"Czech Republic"},{code:"DK",name:"Denmark"},{code:"DJ",name:"Djibouti"},{code:"DM",name:"Dominica"},{code:"DO",name:"Dominican Republic"},{code:"EC",name:"Ecuador"},{code:"EG",name:"Egypt"},{code:"SV",name:"El Salvador"},{code:"GQ",name:"Equatorial Guinea"},{code:"ER",name:"Eritrea"},{code:"EE",name:"Estonia"},{code:"ET",name:"Ethiopia"},{code:"FK",name:"Falkland Islands"},{code:"FO",name:"Faroe Islands"},{code:"FJ",name:"Fiji"},{code:"FI",name:"Finland"},{code:"FR",name:"France"},{code:"GF",name:"French Guiana"},{code:"PF",name:"French Polynesia"},{code:"TF",name:"French Southern Territories"},{code:"GA",name:"Gabon"},{code:"GM",name:"Gambia"},{code:"GE",name:"Georgia"},{code:"DE",name:"Germany"},{code:"GH",name:"Ghana"},{code:"GI",name:"Gibraltar"},{code:"GR",name:"Greece"},{code:"GL",name:"Greenland"},{code:"GD",name:"Grenada"},{code:"GP",name:"Guadeloupe"},{code:"GU",name:"Guam"},{code:"GT",name:"Guatemala"},{code:"GG",name:"Guernsey"},{code:"GN",name:"Guinea"},{code:"GW",name:"Guinea-Bissau"},{code:"GY",name:"Guyana"},{code:"HT",name:"Haiti"},{code:"HK",name:"Hong Kong"},{code:"HU",name:"Hungary"},{code:"IS",name:"Iceland"},{code:"IN",name:"India"},{code:"ID",name:"Indonesia"},{code:"IR",name:"Iran"},{code:"IQ",name:"Iraq"},{code:"IE",name:"Ireland"},{code:"IM",name:"Isle of Man"},{code:"IL",name:"Israel"},{code:"IT",name:"Italy"},{code:"CI",name:"Ivory Coast"},{code:"JM",name:"Jamaica"},{code:"JP",name:"Japan"},{code:"JE",name:"Jersey"},{code:"JO",name:"Jordan"},{code:"KZ",name:"Kazakhstan"},{code:"KE",name:"Kenya"},{code:"KI",name:"Kiribati"},{code:"KP",name:"North Korea"},{code:"KR",name:"South Korea"},{code:"KW",name:"Kuwait"},{code:"KG",name:"Kyrgyzstan"},{code:"LA",name:"Laos"},{code:"LV",name:"Latvia"},{code:"LB",name:"Lebanon"},{code:"LS",name:"Lesotho"},{code:"LR",name:"Liberia"},{code:"LY",name:"Libya"},{code:"LI",name:"Liechtenstein"},{code:"LT",name:"Lithuania"},{code:"LU",name:"Luxembourg"},{code:"MO",name:"Macao"},{code:"MK",name:"Macedonia"},{code:"MG",name:"Madagascar"},{code:"MW",name:"Malawi"},{code:"MY",name:"Malaysia"},{code:"MV",name:"Maldives"},{code:"ML",name:"Mali"},{code:"MT",name:"Malta"},{code:"MH",name:"Marshall Islands"},{code:"MQ",name:"Martinique"},{code:"MR",name:"Mauritania"},{code:"MU",name:"Mauritius"},{code:"YT",name:"Mayotte"},{code:"MX",name:"Mexico"},{code:"FM",name:"Micronesia"},{code:"MD",name:"Moldova"},{code:"MC",name:"Monaco"},{code:"MN",name:"Mongolia"},{code:"ME",name:"Montenegro"},{code:"MA",name:"Morocco"},{code:"MZ",name:"Mozambique"},{code:"MM",name:"Myanmar"},{code:"NA",name:"Namibia"},{code:"NR",name:"Nauru"},{code:"NP",name:"Nepal"},{code:"NL",name:"Netherlands"},{code:"AN",name:"Netherlands Antilles"},{code:"NC",name:"New Caledonia"},{code:"NZ",name:"New Zealand"},{code:"NI",name:"Nicaragua"},{code:"NE",name:"Niger"},{code:"NG",name:"Nigeria"},{code:"NU",name:"Niue"},{code:"NF",name:"Norfolk Island"},{code:"MP",name:"Northern Mariana Islands"},{code:"NO",name:"Norway"},{code:"OM",name:"Oman"},{code:"PK",name:"Pakistan"},{code:"PW",name:"Palau"},{code:"PS",name:"Palestine"},{code:"PA",name:"Panama"},{code:"PG",name:"Papua New Guinea"},{code:"PY",name:"Paraguay"},{code:"PE",name:"Peru"},{code:"PH",name:"Philippines"},{code:"PN",name:"Pitcairn Islands"},{code:"PL",name:"Poland"},{code:"PT",name:"Portugal"},{code:"PR",name:"Puerto Rico"},{code:"QA",name:"Qatar"},{code:"RE",name:"Reunion"},{code:"RO",name:"Romania"},{code:"RU",name:"Russia"},{code:"RW",name:"Rwanda"},{code:"BL",name:"Saint Barthelemy"},{code:"SH",name:"Saint Helena"},{code:"KN",name:"Saint Kitts and Nevis"},{code:"LC",name:"Saint Lucia"},{code:"MF",name:"Saint Martin"},{code:"PM",name:"Saint Pierre and Miquelon"},{code:"VC",name:"Saint Vincent and the Grenadines"},{code:"WS",name:"Samoa"},{code:"SM",name:"San Marino"},{code:"ST",name:"Sao Tome and Principe"},{code:"SA",name:"Saudi Arabia"},{code:"SN",name:"Senegal"},{code:"RS",name:"Serbia"},{code:"SC",name:"Seychelles"},{code:"SL",name:"Sierra Leone"},{code:"SG",name:"Singapore"},{code:"SK",name:"Slovakia"},{code:"SI",name:"Slovenia"},{code:"SB",name:"Solomon Islands"},{code:"SO",name:"Somalia"},{code:"ZA",name:"South Africa"},{code:"GS",name:"South Georgia and the South Sandwich Islands"},{code:"SS",name:"South Sudan"},{code:"ES",name:"Spain"},{code:"LK",name:"Sri Lanka"},{code:"SD",name:"Sudan"},{code:"SR",name:"Suriname"},{code:"SJ",name:"Svalbard and Jan Mayen"},{code:"SZ",name:"Swaziland"},{code:"SE",name:"Sweden"},{code:"CH",name:"Switzerland"},{code:"SY",name:"Syria"},{code:"TW",name:"Taiwan"},{code:"TJ",name:"Tajikistan"},{code:"TZ",name:"Tanzania"},{code:"TH",name:"Thailand"},{code:"TL",name:"Timor-Leste"},{code:"TG",name:"Togo"},{code:"TK",name:"Tokelau"},{code:"TO",name:"Tonga"},{code:"TT",name:"Trinidad and Tobago"},{code:"TN",name:"Tunisia"},{code:"TR",name:"Turkey"},{code:"TM",name:"Turkmenistan"},{code:"TC",name:"Turks and Caicos Islands"},{code:"TV",name:"Tuvalu"},{code:"UG",name:"Uganda"},{code:"UA",name:"Ukraine"},{code:"AE",name:"United Arab Emirates"},{code:"GB",name:"United Kingdom"},{code:"US",name:"United States"},{code:"UY",name:"Uruguay"},{code:"UZ",name:"Uzbekistan"},{code:"VU",name:"Vanuatu"},{code:"VA",name:"Vatican City"},{code:"VE",name:"Venezuela"},{code:"VN",name:"Vietnam"},{code:"VG",name:"Virgin Islands (British)"},{code:"VI",name:"Virgin Islands (US)"},{code:"WF",name:"Wallis and Futuna"},{code:"EH",name:"Western Sahara"},{code:"YE",name:"Yemen"},{code:"ZM",name:"Zambia"},{code:"ZW",name:"Zimbabwe"}];nationalities=[{code:"AF",name:"Afghan"},{code:"AL",name:"Albanian"},{code:"DZ",name:"Algerian"},{code:"AS",name:"American Samoan"},{code:"AD",name:"Andorran"},{code:"AO",name:"Angolan"},{code:"AI",name:"Anguillan"},{code:"AQ",name:"Antarctic"},{code:"AG",name:"Antiguan or Barbudan"},{code:"AR",name:"Argentine"},{code:"AM",name:"Armenian"},{code:"AW",name:"Aruban"},{code:"AU",name:"Australian"},{code:"AT",name:"Austrian"},{code:"AZ",name:"Azerbaijani"},{code:"BS",name:"Bahamian"},{code:"BH",name:"Bahraini"},{code:"BD",name:"Bangladeshi"},{code:"BB",name:"Barbadian"},{code:"BY",name:"Belarusian"},{code:"BE",name:"Belgian"},{code:"BZ",name:"Belizean"},{code:"BJ",name:"Beninese"},{code:"BM",name:"Bermudian"},{code:"BT",name:"Bhutanese"},{code:"BO",name:"Bolivian"},{code:"BA",name:"Bosnian"},{code:"BW",name:"Botswanan"},{code:"BV",name:"Bouvet Islander"},{code:"BR",name:"Brazilian"},{code:"BN",name:"Bruneian"},{code:"BG",name:"Bulgarian"},{code:"BF",name:"Burkinabe"},{code:"BI",name:"Burundian"},{code:"KH",name:"Cambodian"},{code:"CM",name:"Cameroonian"},{code:"CA",name:"Canadian"},{code:"CV",name:"Cape Verdean"},{code:"KY",name:"Caymanian"},{code:"CF",name:"Central African"},{code:"TD",name:"Chadian"},{code:"CL",name:"Chilean"},{code:"CN",name:"Chinese"},{code:"CX",name:"Christmas Islander"},{code:"CC",name:"Cocos Islander"},{code:"CO",name:"Colombian"},{code:"KM",name:"Comorian"},{code:"CG",name:"Congolese"},{code:"CD",name:"Congolese"},{code:"CK",name:"Cook Islander"},{code:"CR",name:"Costa Rican"},{code:"HR",name:"Croatian"},{code:"CU",name:"Cuban"},{code:"CY",name:"Cypriot"},{code:"CZ",name:"Czech"},{code:"DK",name:"Danish"},{code:"DJ",name:"Djiboutian"},{code:"DM",name:"Dominican"},{code:"DO",name:"Dominican"},{code:"EC",name:"Ecuadorian"},{code:"EG",name:"Egyptian"},{code:"SV",name:"Salvadoran"},{code:"GQ",name:"Equatorial Guinean"},{code:"ER",name:"Eritrean"},{code:"EE",name:"Estonian"},{code:"ET",name:"Ethiopian"},{code:"FK",name:"Falkland Islander"},{code:"FO",name:"Faroese"},{code:"FJ",name:"Fijian"},{code:"FI",name:"Finnish"},{code:"FR",name:"French"},{code:"GF",name:"French Guianan"},{code:"PF",name:"French Polynesian"},{code:"TF",name:"French Southern"},{code:"GA",name:"Gabonese"},{code:"GM",name:"Gambian"},{code:"GE",name:"Georgian"},{code:"DE",name:"German"},{code:"GH",name:"Ghanaian"},{code:"GI",name:"Gibraltar"},{code:"GR",name:"Greek"},{code:"GL",name:"Greenlandic"},{code:"GD",name:"Grenadian"},{code:"GP",name:"Guadeloupe"},{code:"GU",name:"Guamanian"},{code:"GT",name:"Guatemalan"},{code:"GG",name:"Guernseyite"},{code:"GN",name:"Guinean"},{code:"GW",name:"Guinea-Bissauan"},{code:"GY",name:"Guyanese"},{code:"HT",name:"Haitian"},{code:"HK",name:"Hong Kong"},{code:"HU",name:"Hungarian"},{code:"IS",name:"Icelandic"},{code:"IN",name:"Indian"},{code:"ID",name:"Indonesian"},{code:"IR",name:"Iranian"},{code:"IQ",name:"Iraqi"},{code:"IE",name:"Irish"},{code:"IM",name:"Manx"},{code:"IL",name:"Israeli"},{code:"IT",name:"Italian"},{code:"CI",name:"Ivorian"},{code:"JM",name:"Jamaican"},{code:"JP",name:"Japanese"},{code:"JE",name:"Jersey"},{code:"JO",name:"Jordanian"},{code:"KZ",name:"Kazakhstani"},{code:"KE",name:"Kenyan"},{code:"KI",name:"I-Kiribati"},{code:"KP",name:"North Korean"},{code:"KR",name:"South Korean"},{code:"KW",name:"Kuwaiti"},{code:"KG",name:"Kyrgyzstani"},{code:"LA",name:"Laotian"},{code:"LV",name:"Latvian"},{code:"LB",name:"Lebanese"},{code:"LS",name:"Sotho"},{code:"LR",name:"Liberian"},{code:"LY",name:"Libyan"},{code:"LI",name:"Liechtenstein"},{code:"LT",name:"Lithuanian"},{code:"LU",name:"Luxembourg"},{code:"MO",name:"Macanese"},{code:"MK",name:"Macedonian"},{code:"MG",name:"Malagasy"},{code:"MW",name:"Malawian"},{code:"MY",name:"Malaysian"},{code:"MV",name:"Maldivian"},{code:"ML",name:"Malian"},{code:"MT",name:"Maltese"},{code:"MH",name:"Marshallese"},{code:"MQ",name:"Martinique"},{code:"MR",name:"Mauritanian"},{code:"MU",name:"Mauritian"},{code:"YT",name:"Mahoran"},{code:"MX",name:"Mexican"},{code:"FM",name:"Micronesian"},{code:"MD",name:"Moldovan"},{code:"MC",name:"Monegasque"},{code:"MN",name:"Mongolian"},{code:"ME",name:"Montenegrin"},{code:"MA",name:"Moroccan"},{code:"MZ",name:"Mozambican"},{code:"MM",name:"Burmese"},{code:"NA",name:"Namibian"},{code:"NR",name:"Nauruan"},{code:"NP",name:"Nepalese"},{code:"NL",name:"Dutch"},{code:"AN",name:"Dutch"},{code:"NC",name:"New Caledonian"},{code:"NZ",name:"New Zealand"},{code:"NI",name:"Nicaraguan"},{code:"NE",name:"Nigerien"},{code:"NG",name:"Nigerian"},{code:"NU",name:"Niuean"},{code:"NF",name:"Norfolk Islander"},{code:"MP",name:"Northern Mariana Islander"},{code:"NO",name:"Norwegian"},{code:"OM",name:"Omani"},{code:"PK",name:"Pakistani"},{code:"PW",name:"Palauan"},{code:"PS",name:"Palestinian"},{code:"PA",name:"Panamanian"},{code:"PG",name:"Papua New Guinean"},{code:"PY",name:"Paraguayan"},{code:"PE",name:"Peruvian"},{code:"PH",name:"Philippine"},{code:"PN",name:"Pitcairn Islander"},{code:"PL",name:"Polish"},{code:"PT",name:"Portuguese"},{code:"PR",name:"Puerto Rican"},{code:"QA",name:"Qatari"},{code:"RE",name:"Reunionese"},{code:"RO",name:"Romanian"},{code:"RU",name:"Russian"},{code:"RW",name:"Rwandan"},{code:"BL",name:"Saint Barthelemy"},{code:"SH",name:"Saint Helenian"},{code:"KN",name:"Kittitian or Nevisian"},{code:"LC",name:"Saint Lucian"},{code:"MF",name:"Saint Martin"},{code:"PM",name:"Saint Pierre"},{code:"VC",name:"Vincentian"},{code:"WS",name:"Samoan"},{code:"SM",name:"Sammarinese"},{code:"ST",name:"Sao Tome"},{code:"SA",name:"Saudi"},{code:"SN",name:"Senegalese"},{code:"RS",name:"Serbian"},{code:"SC",name:"Seychellois"},{code:"SL",name:"Sierra Leonean"},{code:"SG",name:"Singaporean"},{code:"SK",name:"Slovak"},{code:"SI",name:"Slovenian"},{code:"SB",name:"Solomon Islander"},{code:"SO",name:"Somali"},{code:"ZA",name:"South African"},{code:"GS",name:"South Georgia"},{code:"SS",name:"South Sudanese"},{code:"ES",name:"Spanish"},{code:"LK",name:"Sri Lankan"},{code:"SD",name:"Sudanese"},{code:"SR",name:"Surinamese"},{code:"SJ",name:"Svalbard Islander"},{code:"SZ",name:"Swazi"},{code:"SE",name:"Swedish"},{code:"CH",name:"Swiss"},{code:"SY",name:"Syrian"},{code:"TW",name:"Taiwanese"},{code:"TJ",name:"Tajikistani"},{code:"TZ",name:"Tanzanian"},{code:"TH",name:"Thai"},{code:"TL",name:"Timorese"},{code:"TG",name:"Togolese"},{code:"TK",name:"Tokelauan"},{code:"TO",name:"Tongan"},{code:"TT",name:"Trinidad and Tobagonian"},{code:"TN",name:"Tunisian"},{code:"TR",name:"Turkish"},{code:"TM",name:"Turkmenistani"},{code:"TC",name:"Turks and Caicos Islander"},{code:"TV",name:"Tuvaluan"},{code:"UG",name:"Ugandan"},{code:"UA",name:"Ukrainian"},{code:"AE",name:"Emirati"},{code:"GB",name:"British"},{code:"US",name:"American"},{code:"UY",name:"Uruguayan"},{code:"UZ",name:"Uzbekistani"},{code:"VU",name:"Vanuatu"},{code:"VA",name:"Vatican"},{code:"VE",name:"Venezuelan"},{code:"VN",name:"Vietnamese"},{code:"VG",name:"Virgin Islander"},{code:"VI",name:"Virgin Islander"},{code:"WF",name:"Wallis and Futuna Islander"},{code:"EH",name:"Sahrawi"},{code:"YE",name:"Yemeni"},{code:"ZM",name:"Zambian"},{code:"ZW",name:"Zimbabwean"}];getCountries(){return[...this.countries]}getNationalities(){return[...this.nationalities]}getCountryByCode(e){return this.countries.find(t=>t.code===e)}getNationalityByCode(e){return this.nationalities.find(t=>t.code===e)}getCountryName(e){let t=this.getCountryByCode(e);return t?t.name:e}getNationalityName(e){let t=this.getNationalityByCode(e);return t?t.name:e}static \u0275fac=function(t){return new(t||o)};static \u0275prov=It({token:o,factory:o.\u0275fac,providedIn:"root"})};var Sn=(o,e)=>e._id;function Fn(o,e){o&1&&(a(0,"span"),r(1,"Searching..."),n())}function Mn(o,e){if(o&1&&(a(0,"mat-option",6)(1,"span",8),r(2),R(3,"getGuestName"),n(),a(4,"span",9),r(5),n()()),o&2){let t=e.$implicit;g("value",t),l(2),k(ze(3,3,t)),l(3),k(t==null?null:t.email)}}function En(o,e){o&1&&(a(0,"mat-option",7),r(1,"No guests found"),n())}var Ft=class o{placeholder=w("Search for guest by name or email...");label=w("Select Guest");initialValue=w("");guestType=w(void 0);guestSelected=U();searchCleared=U();guestService=_(we);storeStore=_(K);destroy$=new Ve;guestSearchControl=new ji("");filteredGuests=E([]);isLoading=E(!1);ngOnInit(){this.initializeSearchControl()}initializeSearchControl(){this.guestSearchControl.valueChanges.pipe(Ri(""),Di(300),Qe(),Ni(e=>{if(!e||e.length<2)return this.filteredGuests.set([]),Ye({guests:[],total:0,page:1,totalPages:0});this.isLoading.set(!0);let t=this.storeStore.selectedStore()?._id;return this.guestService.searchGuests(e,1,10,t)}),se(this.destroy$)).subscribe(e=>{this.filteredGuests.set(e?.guests||[]),this.isLoading.set(!1)},e=>{console.error("Error searching guests:",e),this.filteredGuests.set([]),this.isLoading.set(!1)}),this.initialValue()&&this.guestSearchControl.setValue(this.initialValue())}onGuestSelected(e){this.guestSearchControl.setValue(`${this.guestService.getGuestName(e)}`),this.guestSelected.emit(e)}onClear(){this.guestSearchControl.setValue(""),this.filteredGuests.set([]),this.searchCleared.emit()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=N({type:o,selectors:[["app-guest-search"]],inputs:{placeholder:[1,"placeholder"],label:[1,"label"],initialValue:[1,"initialValue"],guestType:[1,"guestType"]},outputs:{guestSelected:"guestSelected",searchCleared:"searchCleared"},decls:13,vars:6,consts:[["guestAutoComplete","matAutocomplete"],[1,"w-full"],["appearance","outline",1,"w-full"],["matPrefix","",1,"text-gray-500","material-icons-outlined"],["matInput","",3,"formControl","placeholder","matAutocomplete"],[3,"optionSelected"],[3,"value"],["disabled",""],[1,"font-medium"],[1,"text-sm","text-gray-500","ml-2"]],template:function(t,i){if(t&1){let s=T();a(0,"div",1)(1,"mat-form-field",2)(2,"mat-label"),r(3),n(),a(4,"mat-icon",3),r(5,"search"),n(),C(6,"input",4),f(7,Fn,2,0,"span"),a(8,"mat-autocomplete",5,0),b("optionSelected",function(c){return x(s),S(i.onGuestSelected(c.option.value))}),z(10,Mn,6,5,"mat-option",6,Sn),f(12,En,2,0,"mat-option",7),n()()()}if(t&2){let s=Me(9);l(3),k(i.label()),l(3),g("formControl",i.guestSearchControl)("placeholder",i.placeholder())("matAutocomplete",s),l(),h(i.isLoading()?7:-1),l(3),Z(i.filteredGuests()),l(2),h(i.filteredGuests().length===0&&!i.isLoading()?12:-1)}},dependencies:[G,$,ue,X,Wi,W,ae,oe,st,B,be,cn,ln,ye,mn,I,H,xe,L,Se,ri],styles:["[_nghost-%COMP%]{display:block;width:100%}"]})};var mi=(o,e)=>e.code;function Dn(o,e){o&1&&(a(0,"h2",11),r(1,"Edit Child Guest"),n())}function Rn(o,e){o&1&&(a(0,"h2",11),r(1,"Edit Individual Guest"),n())}function Nn(o,e){o&1&&(a(0,"h2",11),r(1,"Edit Company Guest"),n())}function Tn(o,e){if(o&1&&f(0,Dn,2,0,"h2",11)(1,Rn,2,0,"h2",11)(2,Nn,2,0,"h2",11),o&2){let t=p();h(t.isChildGuest()?0:t.guestType()==="individual"?1:2)}}function kn(o,e){o&1&&(a(0,"h2",11),r(1,"Create Child Guest"),n())}function Gn(o,e){o&1&&(a(0,"h2",11),r(1,"Create Individual Guest"),n())}function In(o,e){o&1&&(a(0,"h2",11),r(1,"Create Company Guest"),n())}function Pn(o,e){if(o&1&&f(0,kn,2,0,"h2",11)(1,Gn,2,0,"h2",11)(2,In,2,0,"h2",11),o&2){let t=p();h(t.isChildGuest()?0:t.guestType()==="individual"?1:2)}}function wn(o,e){if(o&1){let t=T();a(0,"div",3)(1,"h4",12),r(2,"Search Existing Guest"),n(),a(3,"p",13),r(4,"Search and select an existing guest to auto-fill the form"),n(),a(5,"app-guest-search",14),b("guestSelected",function(s){x(t);let m=p();return S(m.onSelectExistingGuest(s))}),n()()}}function An(o,e){o&1&&(a(0,"mat-error"),r(1,"First name is required"),n())}function On(o,e){o&1&&(a(0,"mat-error"),r(1,"First name must be at least 2 characters"),n())}function Bn(o,e){o&1&&(a(0,"mat-error"),r(1,"Last name is required"),n())}function Vn(o,e){o&1&&(a(0,"mat-error"),r(1,"Last name must be at least 2 characters"),n())}function Ln(o,e){if(o&1&&(a(0,"mat-option",21),r(1),n()),o&2){let t=e.$implicit;g("value",t.name),l(),k(t.name)}}function qn(o,e){if(o&1&&(a(0,"h4",12),r(1,"Individual Information"),n(),a(2,"div",15)(3,"mat-form-field",6)(4,"mat-label"),r(5,"First Name"),n(),C(6,"input",16),f(7,An,2,0,"mat-error"),f(8,On,2,0,"mat-error"),n(),a(9,"mat-form-field",6)(10,"mat-label"),r(11,"Last Name"),n(),C(12,"input",17),f(13,Bn,2,0,"mat-error"),f(14,Vn,2,0,"mat-error"),n(),a(15,"mat-form-field",6)(16,"mat-label"),r(17,"Date of Birth"),n(),C(18,"input",18)(19,"mat-datepicker-toggle",19)(20,"mat-datepicker",null,0),n(),a(22,"mat-form-field",6)(23,"mat-label"),r(24,"Nationality"),n(),a(25,"mat-select",20),z(26,Ln,2,2,"mat-option",21,mi),n()()()),o&2){let t,i,s,m,c=Me(21),u=p();l(7),h((t=u.guestForm.get("firstName"))!=null&&t.hasError("required")&&((t=u.guestForm.get("firstName"))!=null&&t.touched)?7:-1),l(),h((i=u.guestForm.get("firstName"))!=null&&i.hasError("minlength")&&((i=u.guestForm.get("firstName"))!=null&&i.touched)?8:-1),l(5),h((s=u.guestForm.get("lastName"))!=null&&s.hasError("required")&&((s=u.guestForm.get("lastName"))!=null&&s.touched)?13:-1),l(),h((m=u.guestForm.get("lastName"))!=null&&m.hasError("minlength")&&((m=u.guestForm.get("lastName"))!=null&&m.touched)?14:-1),l(4),g("matDatepicker",c),l(),g("for",c),l(7),Z(u.nationalities())}}function $n(o,e){o&1&&(a(0,"mat-error"),r(1,"Company name is required"),n())}function Hn(o,e){o&1&&(a(0,"mat-error"),r(1,"Company name must be at least 2 characters"),n())}function Un(o,e){o&1&&(a(0,"mat-error"),r(1,"First name is required"),n())}function Kn(o,e){o&1&&(a(0,"mat-error"),r(1,"First name must be at least 2 characters"),n())}function jn(o,e){o&1&&(a(0,"mat-error"),r(1,"Last name is required"),n())}function Wn(o,e){o&1&&(a(0,"mat-error"),r(1,"Last name must be at least 2 characters"),n())}function zn(o,e){if(o&1&&(a(0,"h4",12),r(1,"Company Information"),n(),a(2,"div",15)(3,"mat-form-field",6)(4,"mat-label"),r(5,"Company Name"),n(),C(6,"input",22),f(7,$n,2,0,"mat-error"),f(8,Hn,2,0,"mat-error"),n(),a(9,"mat-form-field",6)(10,"mat-label"),r(11,"Registration Number"),n(),C(12,"input",23),n(),a(13,"mat-form-field",6)(14,"mat-label"),r(15,"Contact Person First Name"),n(),C(16,"input",24),f(17,Un,2,0,"mat-error"),f(18,Kn,2,0,"mat-error"),n(),a(19,"mat-form-field",6)(20,"mat-label"),r(21,"Contact Person Last Name"),n(),C(22,"input",25),f(23,jn,2,0,"mat-error"),f(24,Wn,2,0,"mat-error"),n(),a(25,"mat-form-field",26)(26,"mat-label"),r(27,"Contact Person Title"),n(),C(28,"input",27),n()()),o&2){let t,i,s,m,c,u,v=p();l(7),h((t=v.guestForm.get("companyName"))!=null&&t.hasError("required")&&((t=v.guestForm.get("companyName"))!=null&&t.touched)?7:-1),l(),h((i=v.guestForm.get("companyName"))!=null&&i.hasError("minlength")&&((i=v.guestForm.get("companyName"))!=null&&i.touched)?8:-1),l(9),h((s=v.guestForm.get("contactPersonFirstName"))!=null&&s.hasError("required")&&((s=v.guestForm.get("contactPersonFirstName"))!=null&&s.touched)?17:-1),l(),h((m=v.guestForm.get("contactPersonFirstName"))!=null&&m.hasError("minlength")&&((m=v.guestForm.get("contactPersonFirstName"))!=null&&m.touched)?18:-1),l(5),h((c=v.guestForm.get("contactPersonLastName"))!=null&&c.hasError("required")&&((c=v.guestForm.get("contactPersonLastName"))!=null&&c.touched)?23:-1),l(),h((u=v.guestForm.get("contactPersonLastName"))!=null&&u.hasError("minlength")&&((u=v.guestForm.get("contactPersonLastName"))!=null&&u.touched)?24:-1)}}function Zn(o,e){o&1&&(a(0,"mat-error"),r(1,"Email is required"),n())}function Jn(o,e){o&1&&(a(0,"mat-error"),r(1,"Please enter a valid email"),n())}function Yn(o,e){if(o&1&&(a(0,"div")(1,"h4",12),r(2,"Contact Information"),n(),a(3,"div",15)(4,"mat-form-field",6)(5,"mat-label"),r(6,"Email"),n(),C(7,"input",28),f(8,Zn,2,0,"mat-error"),f(9,Jn,2,0,"mat-error"),n(),a(10,"mat-form-field",6)(11,"mat-label"),r(12,"Phone"),n(),C(13,"input",29),n()()()),o&2){let t,i,s=p();l(8),h((t=s.guestForm.get("email"))!=null&&t.hasError("required")&&((t=s.guestForm.get("email"))!=null&&t.touched)?8:-1),l(),h((i=s.guestForm.get("email"))!=null&&i.hasError("email")&&((i=s.guestForm.get("email"))!=null&&i.touched)?9:-1)}}function Qn(o,e){if(o&1&&(a(0,"mat-option",21),r(1),n()),o&2){let t=e.$implicit;g("value",t.name),l(),y(" ",t.name," ")}}function Xn(o,e){if(o&1&&(a(0,"div")(1,"h4",12),r(2,"Additional Details"),n(),a(3,"div",15)(4,"mat-form-field",6)(5,"mat-label"),r(6,"Nationality"),n(),a(7,"mat-select",30)(8,"mat-option",31),r(9,"-- Select Nationality --"),n(),z(10,Qn,2,2,"mat-option",21,mi),n()()()()),o&2){let t=p();l(10),Z(t.nationalities())}}function eo(o,e){if(o&1&&(a(0,"mat-option",21),r(1),n()),o&2){let t=e.$implicit;g("value",t.name),l(),y(" ",t.name," ")}}function to(o,e){if(o&1&&(a(0,"div",5)(1,"h4",12),r(2,"ID Document"),n(),a(3,"div",15)(4,"mat-form-field",6)(5,"mat-label"),r(6,"Document Type"),n(),a(7,"mat-select",32)(8,"mat-option",33),r(9,"Passport"),n(),a(10,"mat-option",34),r(11,"National ID"),n(),a(12,"mat-option",35),r(13,"Driver's License"),n(),a(14,"mat-option",36),r(15,"Other"),n()()(),a(16,"mat-form-field",6)(17,"mat-label"),r(18,"Document Number"),n(),C(19,"input",37),n(),a(20,"mat-form-field",6)(21,"mat-label"),r(22,"Expiry Date"),n(),C(23,"input",38)(24,"mat-datepicker-toggle",19)(25,"mat-datepicker",null,1),n(),a(27,"mat-form-field",6)(28,"mat-label"),r(29,"Issuing Country"),n(),a(30,"mat-select",39)(31,"mat-option",31),r(32,"-- Select Country --"),n(),z(33,eo,2,2,"mat-option",21,mi),n()()()()),o&2){let t=Me(26),i=p();g("formGroup",i.idDocumentForm),l(23),g("matDatepicker",t),l(),g("for",t),l(9),Z(i.countries())}}function io(o,e){if(o&1&&(a(0,"mat-option",21),r(1),n()),o&2){let t=e.$implicit;g("value",t.name),l(),y(" ",t.name," ")}}function no(o,e){if(o&1&&(a(0,"div",5)(1,"h4",12),r(2,"Address"),n(),a(3,"div",40)(4,"mat-form-field",6)(5,"mat-label"),r(6,"Street"),n(),C(7,"input",41),n(),a(8,"div",15)(9,"mat-form-field",6)(10,"mat-label"),r(11,"City"),n(),C(12,"input",42),n(),a(13,"mat-form-field",6)(14,"mat-label"),r(15,"State/Province"),n(),C(16,"input",43),n()(),a(17,"div",15)(18,"mat-form-field",6)(19,"mat-label"),r(20,"Country"),n(),a(21,"mat-select",44)(22,"mat-option",31),r(23,"-- Select Country --"),n(),z(24,io,2,2,"mat-option",21,mi),n()(),a(26,"mat-form-field",6)(27,"mat-label"),r(28,"Postal Code"),n(),C(29,"input",45),n()()()()),o&2){let t=p();g("formGroup",t.addressForm),l(24),Z(t.countries())}}function oo(o,e){if(o&1&&(a(0,"div",5)(1,"h4",12),r(2,"Emergency Contact"),n(),a(3,"div",40)(4,"div",15)(5,"mat-form-field",6)(6,"mat-label"),r(7,"Name"),n(),C(8,"input",46),n(),a(9,"mat-form-field",6)(10,"mat-label"),r(11,"Relationship"),n(),C(12,"input",47),n()(),a(13,"div",15)(14,"mat-form-field",6)(15,"mat-label"),r(16,"Phone"),n(),C(17,"input",48),n(),a(18,"mat-form-field",6)(19,"mat-label"),r(20,"Email"),n(),C(21,"input",49),n()()()()),o&2){let t=p();g("formGroup",t.emergencyContactForm)}}function ao(o,e){o&1&&(a(0,"mat-form-field",6)(1,"mat-label"),r(2,"Notes"),n(),C(3,"textarea",50),n())}function ro(o,e){o&1&&(a(0,"mat-icon",10),r(1,"refresh"),n())}function so(o,e){o&1&&(a(0,"mat-icon",51),r(1,"edit_outline"),n())}function lo(o,e){o&1&&(a(0,"mat-icon",51),r(1,"person_add"),n())}function mo(o,e){if(o&1&&f(0,so,2,0,"mat-icon",51)(1,lo,2,0,"mat-icon",51),o&2){let t=p();h(t.isEditing()?0:1)}}function co(o,e){o&1&&r(0," Update Guest ")}function uo(o,e){o&1&&r(0," Create Guest ")}var Ne=class o{dialogRef=_(oi);fb=_(Te);snackBar=_(ot);guestService=_(we);storeStore=_(K);locationService=_(li);dialogData=_(ht,{optional:!0});destroy$=new Ve;isSaving=E(!1);countries=E([]);nationalities=E([]);guestType=E("individual");ageGrade=E("adult");isEditing=E(!1);editingGuestId=E(null);isChildGuest=F(()=>this.ageGrade()==="child");guestForm;constructor(){let e=this.dialogData?.guest,t=this.dialogData?.bookingType||"single",i=this.dialogData?.ageGrade||"adult";if(this.ageGrade.set(i),e){this.isEditing.set(!0),this.editingGuestId.set(e._id);let s=e.guestType||"individual";this.guestType.set(s)}else i==="child"?this.guestType.set("individual"):t==="group"&&this.guestType.set("corporate");this.guestForm=this.createForm(),this.countries.set(this.locationService.getCountries()),this.nationalities.set(this.locationService.getNationalities()),e&&this.populateFormWithGuest(e)}ngOnInit(){this.updateValidators()}populateFormWithGuest(e){let t={guestType:e.guestType||"individual",email:e.email||"",phone:e.phone||"",nationality:e.nationality||"",dateOfBirth:e.dateOfBirth||"",firstName:e.firstName||"",lastName:e.lastName||"",companyName:e.companyName||"",companyRegistrationNumber:e.companyRegistrationNumber||"",contactPersonFirstName:e.contactPersonFirstName||"",contactPersonLastName:e.contactPersonLastName||"",contactPersonTitle:e.contactPersonTitle||"",notes:e.notes||"",idDocument:{type:e.idDocument?.type||"passport",number:e.idDocument?.number||"",expiryDate:e.idDocument?.expiryDate||"",issuingCountry:e.idDocument?.issuingCountry||""},address:{street:e.address?.street||"",city:e.address?.city||"",state:e.address?.state||"",country:e.address?.country||"",postalCode:e.address?.postalCode||""},emergencyContact:{name:e.emergencyContact?.name||"",relationship:e.emergencyContact?.relationship||"",phone:e.emergencyContact?.phone||"",email:e.emergencyContact?.email||""}};this.guestForm.patchValue(t)}updateValidators(){let e=this.guestType(),t=this.isChildGuest(),i=this.guestForm.get("firstName"),s=this.guestForm.get("lastName"),m=this.guestForm.get("email"),c=this.guestForm.get("phone"),u=this.guestForm.get("companyName"),v=this.guestForm.get("contactPersonFirstName"),D=this.guestForm.get("contactPersonLastName");t||e==="individual"?(i?.setValidators([d.required,d.minLength(2)]),s?.setValidators([d.required,d.minLength(2)]),t?(m?.clearValidators(),c?.clearValidators()):(m?.setValidators([d.required,d.email]),c?.setValidators([d.required])),u?.clearValidators(),v?.clearValidators(),D?.clearValidators()):e==="corporate"&&(i?.clearValidators(),s?.clearValidators(),m?.setValidators([d.required,d.email]),c?.setValidators([d.required]),u?.setValidators([d.required,d.minLength(2)]),v?.setValidators([d.required,d.minLength(2)]),D?.setValidators([d.required,d.minLength(2)])),i?.updateValueAndValidity(),s?.updateValueAndValidity(),m?.updateValueAndValidity(),c?.updateValueAndValidity(),u?.updateValueAndValidity(),v?.updateValueAndValidity(),D?.updateValueAndValidity()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}createForm(){return this.fb.group({guestType:[this.guestType(),[d.required]],firstName:[""],lastName:[""],dateOfBirth:[""],nationality:[""],companyName:[""],companyRegistrationNumber:[""],contactPersonFirstName:[""],contactPersonLastName:[""],contactPersonTitle:[""],email:["",[d.required,d.email]],phone:[""],idDocument:this.fb.group({type:["passport"],number:[""],expiryDate:[""],issuingCountry:[""]}),address:this.fb.group({street:[""],city:[""],state:[""],country:[""],postalCode:[""]}),emergencyContact:this.fb.group({name:[""],relationship:[""],phone:[""],email:[""]}),notes:[""]})}get addressForm(){return this.guestForm.get("address")}get emergencyContactForm(){return this.guestForm.get("emergencyContact")}get idDocumentForm(){return this.guestForm.get("idDocument")}onSelectExistingGuest(e){this.dialogRef.close(e)}onSubmit(){return ve(this,null,function*(){if(this.guestForm.invalid){this.markFormGroupTouched(this.guestForm),this.showError("Please fill in all required fields correctly");return}this.isSaving.set(!0);try{let e=this.guestForm.value,t=this.prepareGuestData(e),i;if(this.isEditing()){let s=this.editingGuestId();if(!s){this.showError("Guest ID is missing");return}i=yield this.guestService.updateGuest(s,t).toPromise(),this.showSuccess("Guest updated successfully")}else i=yield this.guestService.createGuest(t).toPromise(),this.showSuccess("Guest created successfully");this.dialogRef.close(i)}catch(e){console.error("Error saving guest:",e),this.showError(this.isEditing()?"Failed to update guest":"Failed to create guest")}finally{this.isSaving.set(!1)}})}prepareGuestData(e){let t=this.storeStore.selectedStore()?._id,i=e.guestType||"individual";if(this.isChildGuest())return{guestType:"individual",firstName:e.firstName,lastName:e.lastName,dateOfBirth:e.dateOfBirth,stores:t?[t]:[]};let m={guestType:i,email:e.email,phone:e.phone,idDocument:e.idDocument,address:e.address,emergencyContact:e.emergencyContact,notes:e.notes,stores:t?[t]:[]};return i==="individual"?bi(yi({},m),{firstName:e.firstName,lastName:e.lastName,dateOfBirth:e.dateOfBirth,nationality:e.nationality}):bi(yi({},m),{companyName:e.companyName,companyRegistrationNumber:e.companyRegistrationNumber,contactPersonFirstName:e.contactPersonFirstName,contactPersonLastName:e.contactPersonLastName,contactPersonTitle:e.contactPersonTitle})}onCancel(){this.dialogRef.close()}getFieldError(e){let t=this.guestForm.get(e);if(t&&t.errors&&t.touched){if(t.errors.required)return`${this.getFieldLabel(e)} is required`;if(t.errors.email)return"Please enter a valid email address";if(t.errors.minlength)return`${this.getFieldLabel(e)} must be at least ${t.errors.minlength.requiredLength} characters`}return""}getFieldLabel(e){return{firstName:"First Name",lastName:"Last Name",email:"Email",phone:"Phone Number"}[e]||e}markFormGroupTouched(e){Object.keys(e.controls).forEach(t=>{let i=e.get(t);i?.markAsTouched({onlySelf:!0}),i instanceof qt&&this.markFormGroupTouched(i)})}showSuccess(e){this.snackBar.open(e,"Close",{duration:3e3,panelClass:["success-snackbar"]})}showError(e){this.snackBar.open(e,"Close",{duration:5e3,panelClass:["error-snackbar"]})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=N({type:o,selectors:[["app-guest-form-modal"]],decls:22,vars:13,consts:[["dateOfBirthPicker",""],["expiryDatePicker",""],[1,"max-h-[70vh]","overflow-y-auto"],[1,"mb-6","pb-6","border-b","border-gray-200"],[1,"space-y-6",3,"formGroup"],[3,"formGroup"],["appearance","outline",1,"w-full"],["align","end",1,"pt-4"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"animate-spin","mr-2"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[1,"font-semibold","text-sm","text-gray-700","mb-3"],[1,"text-xs","text-gray-500","mb-3"],["label","Select Guest","placeholder","Search by name or email...",3,"guestSelected"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["matInput","","formControlName","firstName","placeholder","Enter first name","required",""],["matInput","","formControlName","lastName","placeholder","Enter last name","required",""],["matInput","","formControlName","dateOfBirth","placeholder","Select date of birth","readonly","",3,"matDatepicker"],["matIconSuffix","",3,"for"],["formControlName","nationality","placeholder","Select nationality"],[3,"value"],["matInput","","formControlName","companyName","placeholder","Enter company name","required",""],["matInput","","formControlName","companyRegistrationNumber","placeholder","Enter registration number"],["matInput","","formControlName","contactPersonFirstName","placeholder","Enter first name","required",""],["matInput","","formControlName","contactPersonLastName","placeholder","Enter last name","required",""],["appearance","outline",1,"w-full","md:col-span-2"],["matInput","","formControlName","contactPersonTitle","placeholder","e.g. Manager, Director"],["matInput","","formControlName","email","placeholder","Enter email address","type","email","required",""],["matInput","","formControlName","phone","placeholder","Enter phone number"],["formControlName","nationality"],["value",""],["formControlName","type"],["value","passport"],["value","national_id"],["value","drivers_license"],["value","other"],["matInput","","formControlName","number","placeholder","Enter document number"],["matInput","","formControlName","expiryDate","placeholder","Select expiry date","readonly","",3,"matDatepicker"],["formControlName","issuingCountry"],[1,"space-y-4"],["matInput","","formControlName","street","placeholder","Enter street address"],["matInput","","formControlName","city","placeholder","Enter city"],["matInput","","formControlName","state","placeholder","Enter state/province"],["formControlName","country"],["matInput","","formControlName","postalCode","placeholder","Enter postal code"],["matInput","","formControlName","name","placeholder","Emergency contact name"],["matInput","","formControlName","relationship","placeholder","e.g., Family, Friend"],["matInput","","formControlName","phone","placeholder","Emergency contact phone"],["matInput","","formControlName","email","placeholder","Emergency contact email","type","email"],["matInput","","formControlName","notes","placeholder","Add any additional notes about the guest","rows","3"],[1,"mr-2"]],template:function(t,i){t&1&&(f(0,Tn,3,1)(1,Pn,3,1),a(2,"mat-dialog-content",2),f(3,wn,6,0,"div",3),a(4,"form",4)(5,"div"),f(6,qn,28,6)(7,zn,29,6),n(),f(8,Yn,14,2,"div"),f(9,Xn,12,0,"div"),f(10,to,35,3,"div",5),f(11,no,30,1,"div",5),f(12,oo,22,1,"div",5),f(13,ao,4,0,"mat-form-field",6),n()(),a(14,"mat-dialog-actions",7)(15,"button",8),b("click",function(){return i.onCancel()}),r(16,"Cancel"),n(),a(17,"button",9),b("click",function(){return i.onSubmit()}),f(18,ro,2,0,"mat-icon",10)(19,mo,2,1),f(20,co,1,0)(21,uo,1,0),n()()),t&2&&(h(i.isEditing()?0:1),l(3),h(i.isEditing()?-1:3),l(),g("formGroup",i.guestForm),l(2),h(i.guestType()==="individual"?6:7),l(2),h(i.isChildGuest()?-1:8),l(),h(i.isChildGuest()?-1:9),l(),h(i.isChildGuest()?-1:10),l(),h(i.isChildGuest()?-1:11),l(),h(i.isChildGuest()?-1:12),l(),h(i.isChildGuest()?-1:13),l(4),g("disabled",i.isSaving()||i.guestForm.invalid),l(),h(i.isSaving()?18:19),l(2),h(i.isEditing()?20:21))},dependencies:[G,$,Le,ue,X,j,Zi,q,pe,yt,Ct,_t,vt,B,be,ae,oe,rt,$e,ge,Ge,ye,L,de,I,H,O,W,xe,Pe,tn,nn,Ke,nt,Qi,Ft],encapsulation:2})};var re=class o{formSubject=new Ei(null);form$=this.formSubject.asObservable();setForm(e){this.formSubject.next(e)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=It({token:o,factory:o.\u0275fac,providedIn:"root"})};function po(o,e){if(o&1){let t=T();a(0,"div",1)(1,"div",4)(2,"mat-icon",5),r(3,"person_outline"),n(),a(4,"p",6),r(5,"No guest selected"),n()(),a(6,"app-guest-search",7),b("guestSelected",function(s){x(t);let m=p();return S(m.onGuestSearchSelected(s))}),n()()}if(o&2){let t=p();l(6),g("guestType",t.bookingType()==="group"?"group":"single")}}function go(o,e){if(o&1&&(a(0,"mat-list-item")(1,"mat-icon",8),r(2,"mail_outline"),n(),a(3,"div",10),r(4,"Email"),n(),a(5,"div",11),r(6),n()()),o&2){let t,i=p(2);l(6),k((t=i.guest())==null?null:t.email)}}function fo(o,e){if(o&1&&(a(0,"mat-list-item")(1,"mat-icon",8),r(2,"phone_outline"),n(),a(3,"div",10),r(4,"Phone"),n(),a(5,"div",11),r(6),n()()),o&2){let t,i=p(2);l(6),k((t=i.guest())==null?null:t.phone)}}function ho(o,e){if(o&1&&(a(0,"mat-list-item")(1,"mat-icon",8),r(2,"cake_outline"),n(),a(3,"div",10),r(4,"Date of Birth"),n(),a(5,"div",11),r(6),R(7,"date"),n()()),o&2){let t,i=p(2);l(6),y(" ",he(7,1,(t=i.guest())==null?null:t.dateOfBirth,"MMM dd, yyyy")," ")}}function Co(o,e){if(o&1&&(a(0,"mat-list-item")(1,"mat-icon",8),r(2,"verified_outline"),n(),a(3,"div",10),r(4,"Registration Number"),n(),a(5,"div",11),r(6),n()()),o&2){let t,i=p(2);l(6),y(" ",(t=i.guest())==null?null:t.companyRegistrationNumber," ")}}function vo(o,e){if(o&1&&(a(0,"span"),r(1),n()),o&2){let t,i=p(3);l(),y("",(t=i.guest())==null||t.address==null?null:t.address.street,", ")}}function _o(o,e){if(o&1&&(a(0,"span"),r(1),n()),o&2){let t,i=p(3);l(),y("",(t=i.guest())==null||t.address==null?null:t.address.city,", ")}}function yo(o,e){if(o&1&&(a(0,"span"),r(1),n()),o&2){let t,i=p(3);l(),k((t=i.guest())==null||t.address==null?null:t.address.country)}}function bo(o,e){if(o&1&&(a(0,"mat-list-item")(1,"mat-icon",8),r(2,"location_on_outline"),n(),a(3,"div",10),r(4,"Address"),n(),a(5,"div",11),f(6,vo,2,1,"span"),f(7,_o,2,1,"span"),f(8,yo,2,1,"span"),n()()),o&2){let t,i,s,m=p(2);l(6),h(!((t=m.guest())==null||t.address==null)&&t.address.street?6:-1),l(),h(!((i=m.guest())==null||i.address==null)&&i.address.city?7:-1),l(),h(!((s=m.guest())==null||s.address==null)&&s.address.country?8:-1)}}function xo(o,e){if(o&1&&(a(0,"div",1)(1,"mat-list")(2,"mat-list-item")(3,"mat-icon",8),r(4,"account_circle"),n(),a(5,"div",9),r(6),R(7,"getGuestName"),n()(),f(8,go,7,1,"mat-list-item"),f(9,fo,7,1,"mat-list-item"),f(10,ho,8,4,"mat-list-item"),f(11,Co,7,1,"mat-list-item"),f(12,bo,9,3,"mat-list-item"),n()()),o&2){let t,i,s,m,c,u=p();l(6),y(" ",ze(7,6,u.guest())," "),l(2),h((t=u.guest())!=null&&t.email?8:-1),l(),h((i=u.guest())!=null&&i.phone?9:-1),l(),h(u.bookingType()==="single"&&((s=u.guest())!=null&&s.dateOfBirth)?10:-1),l(),h(u.bookingType()==="group"&&((m=u.guest())!=null&&m.companyRegistrationNumber)?11:-1),l(),h((c=u.guest())!=null&&c.address?12:-1)}}function So(o,e){if(o&1){let t=T();a(0,"button",12),b("click",function(){x(t);let s=p();return S(s.onAddGuest())}),a(1,"mat-icon",13),r(2,"person_add_outline"),n(),r(3," Add Guest "),n()}}function Fo(o,e){if(o&1){let t=T();a(0,"button",14),b("click",function(){x(t);let s=p();return S(s.onEditGuest())}),a(1,"mat-icon",13),r(2,"edit_outline"),n(),r(3," Edit "),n(),a(4,"button",15),b("click",function(){x(t);let s=p();return S(s.onDeleteGuest())}),a(5,"mat-icon",13),r(6,"delete_outline"),n(),r(7," Delete "),n()}}var ci=class o{reservationFormService=_(re);reservationForm=A(this.reservationFormService.form$,{initialValue:null});guest=w(null);bookingType=E(this.reservationForm().get("bookingType")?.value||"single");guestAdded=U();guestEdited=U();guestDeleted=U();guestSelected=U();dialog=_(je);onAddGuest(){this.dialog.open(Ne,{width:"600px",disableClose:!1,data:{bookingType:this.bookingType(),ageGrade:"adult"}}).afterClosed().subscribe(t=>{t&&this.onGuestSearchSelected(t)})}onGuestSearchSelected(e){this.guestSelected.emit(e)}onEditGuest(){let e=this.guest();if(!e)return;this.dialog.open(Ne,{width:"600px",disableClose:!1,data:{guest:e,bookingType:this.bookingType(),ageGrade:"adult"}}).afterClosed().subscribe(i=>{i&&this.guestEdited.emit()})}onDeleteGuest(){confirm("Are you sure you want to remove this guest?")&&this.guestDeleted.emit()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=N({type:o,selectors:[["app-guest-details"]],inputs:{guest:[1,"guest"]},outputs:{guestAdded:"guestAdded",guestEdited:"guestEdited",guestDeleted:"guestDeleted",guestSelected:"guestSelected"},decls:10,vars:4,consts:[["appearance","outlined"],[1,"space-y-4"],[1,"border-t","border-gray-200","pt-4","flex","justify-end","gap-2"],["type","button","matButton","filled","color","primary"],[1,"text-center","py-4"],[1,"text-gray-300","text-6xl","mb-4","inline-block"],[1,"text-gray-500","text-sm","mb-4"],["placeholder","Search for existing guest...","label","Select Guest",3,"guestSelected","guestType"],["matListItemIcon","",1,"text-gray-600!","material-icons-outlined"],["matListItemTitle","",1,"text-xl","font-semibold","text-gray-900"],["matListItemTitle","",1,"text-sm","text-gray-600!"],["matListItemLine","",1,"text-gray-900","font-medium"],["type","button","matButton","filled","color","primary",3,"click"],[1,"mr-2"],["type","button","mat-button","","color","primary",3,"click"],["type","button","mat-button","","color","warn",3,"click"]],template:function(t,i){t&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),r(3),n()(),a(4,"mat-card-content"),f(5,po,7,1,"div",1),f(6,xo,13,8,"div",1),n(),a(7,"mat-card-actions",2),f(8,So,4,0,"button",3)(9,Fo,8,0),n()()),t&2&&(l(3),y(" ",i.bookingType()==="single"?"Guest Details":"Booking Owner Details"," "),l(2),h(i.guest()?-1:5),l(),h(i.guest()?6:-1),l(2),h(i.guest()?9:8))},dependencies:[G,O,ee,Yi,ie,ne,te,L,de,I,H,W,B,Ie,mt,ct,jt,Kt,lt,Ft,it,ri],styles:["[_nghost-%COMP%]{display:block}"]})};function Mo(o,e){if(o&1){let t=T();a(0,"form",2)(1,"div",3)(2,"mat-form-field",4)(3,"mat-label"),r(4,"Stay Dates"),n(),a(5,"mat-date-range-input",5)(6,"input",6),b("change",function(){x(t);let s=p();return S(s.onDateChange())}),n(),a(7,"input",7),b("change",function(){x(t);let s=p();return S(s.onDateChange())}),n()(),C(8,"mat-datepicker-toggle",8),a(9,"mat-hint"),r(10),n(),C(11,"mat-date-range-picker",null,0),n(),a(13,"mat-form-field",4)(14,"mat-label"),r(15,"Sales Person"),n(),C(16,"input",9),n(),a(17,"mat-form-field",4)(18,"mat-label"),r(19,"Number of Nights"),n(),C(20,"input",10),n(),a(21,"mat-form-field",4)(22,"mat-label"),r(23,"Booking Source"),n(),a(24,"mat-select",11)(25,"mat-option",12),r(26,"-- Select Source --"),n(),a(27,"mat-option",13),r(28,"Direct"),n(),a(29,"mat-option",14),r(30,"Phone"),n(),a(31,"mat-option",15),r(32,"Online"),n(),a(33,"mat-option",16),r(34,"Walk-in"),n(),a(35,"mat-option",17),r(36,"Booking.com"),n(),a(37,"mat-option",18),r(38,"Expedia"),n(),a(39,"mat-option",19),r(40,"Airbnb"),n(),a(41,"mat-option",20),r(42,"Travel Agent"),n(),a(43,"mat-option",21),r(44,"Corporate"),n()()()()()}if(o&2){let t=Me(12),i=p();g("formGroup",i.reservationForm()),l(5),g("rangePicker",t),l(3),g("for",t),l(2),y("",i.numberOfNights()," night(s)"),l(6),g("value",i.salesPersonName())}}var di=class o{reservationFormService=_(re);reservationForm=A(this.reservationFormService.form$,{initialValue:null});checkInDate=A(this.reservationForm().get("checkInDate").valueChanges,{initialValue:this.reservationForm().get("checkInDate").value});checkOutDate=A(this.reservationForm().get("checkOutDate").valueChanges,{initialValue:this.reservationForm().get("checkOutDate").value});numberOfNights=F(()=>{let e=this.checkInDate(),t=this.checkOutDate();if(e&&t){let i=Math.abs(t.getTime()-e.getTime());return Math.ceil(i/(1e3*60*60*24))}return 0});fb=_(Te);authService=_(Lt);quickReservation=w(null);isEditing=w(!1);dateChanged=U();currentUser=A(this.authService.currentUser,{initialValue:null});salesPersonName=F(()=>{let e=this.currentUser();return e&&e.name||""});ngAfterViewInit(){this.reservationForm()?.valueChanges.pipe(Qe((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(e=>{this.reservationForm()?.patchValue({createdBy:this.currentUser()?._id,checkInDate:this.checkInDate(),checkOutDate:this.checkOutDate(),numberOfNights:this.numberOfNights()},{emitEvent:!1})})}onDateChange(){this.dateChanged.emit()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=N({type:o,selectors:[["app-stay-details"]],inputs:{quickReservation:[1,"quickReservation"],isEditing:[1,"isEditing"]},outputs:{dateChanged:"dateChanged"},features:[wt([],[{provide:Ki,useExisting:q}])],decls:6,vars:1,consts:[["stayPicker",""],["appearance","outlined"],[3,"formGroup"],[1,"space-y-4","py-3"],["appearance","outline",1,"w-full"],[3,"rangePicker"],["matStartDate","","formControlName","checkInDate","placeholder","Check-in date",3,"change"],["matEndDate","","formControlName","checkOutDate","placeholder","Check-out date",3,"change"],["matSuffix","",3,"for"],["matInput","","readonly","",3,"value"],["formControlName","numberOfNights","matInput","","readonly",""],["formControlName","bookingSource"],["value",""],["value","direct"],["value","phone"],["value","online"],["value","walk_in"],["value","booking_com"],["value","expedia"],["value","airbnb"],["value","travel_agent"],["value","corporate"]],template:function(t,i){t&1&&(a(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title"),r(3," Stay Details "),n()(),a(4,"mat-card-content"),f(5,Mo,45,5,"form",2),n()()),t&2&&(l(5),h(i.reservationForm()?5:-1))},dependencies:[G,$,Le,ue,X,j,q,pe,O,ee,ie,ne,te,B,be,ae,oe,ke,$e,W,ge,Ge,ye,Pe,Ke,ut,pt,gt,ft,I,L],encapsulation:2})};var Dt=class o{reservationFormService=_(re);reservationForm=A(this.reservationFormService.form$,{initialValue:null});storeStore=_(K);roomsChangeCounter=E(0);getRoomsFormArray(){let e=this.reservationForm();return e?e.get("rooms"):null}totalNumberOfNights=F(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let s=i.get("stayPeriod");return t+(s?.get("numberOfNights")?.value||0)},0):0});breakdownSubtotal=F(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let s=i.get("pricing");if(s){let m=s.get("totalPrice")?.value||0;return t+m}return t},0):0});breakdownServiceFee=F(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let s=i.get("pricing")?.get("fees");return t+(s?.get("serviceFee")?.value||0)},0):0});breakdownCleaningFee=F(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let s=i.get("pricing")?.get("fees");return t+(s?.get("cleaningFee")?.value||0)},0):0});breakdownResortFee=F(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let s=i.get("pricing")?.get("fees");return t+(s?.get("resortFee")?.value||0)},0):0});breakdownOtherFees=F(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let s=i.get("pricing")?.get("fees");return t+(s?.get("other")?.value||0)},0):0});breakdownTotalFees=F(()=>this.breakdownServiceFee()+this.breakdownCleaningFee()+this.breakdownResortFee()+this.breakdownOtherFees());breakdownTaxes=F(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let s=i.get("pricing");return t+(s?.get("taxes")?.value||0)},0):0});breakdownDiscount=F(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,i)=>{let s=i.get("pricing");return t+(s?.get("discount")?.value||0)},0):0});breakdownGrandTotal=F(()=>this.breakdownSubtotal()+this.breakdownTotalFees()+this.breakdownTaxes()-this.breakdownDiscount());pricingChangeCounter=E(0);paidAmount=F(()=>{this.pricingChangeCounter();let e=this.reservationForm();return e&&e.get("pricing")?.get("paid")?.value||0});breakdownBalance=F(()=>this.breakdownGrandTotal()-this.paidAmount());constructor(){let e=this.getRoomsFormArray();e&&e.valueChanges.subscribe(()=>{this.roomsChangeCounter.update(t=>t+1)}),Ae(()=>{let t=this.reservationForm();if(t){let i=t.get("pricing");i&&i.valueChanges.subscribe(()=>{this.pricingChangeCounter.update(s=>s+1)})}},{allowSignalWrites:!0}),Ae(()=>{let i=this.reservationForm()?.get("pricing");i&&i.patchValue({subtotal:this.breakdownSubtotal(),taxes:this.breakdownTaxes(),fees:{serviceFee:this.breakdownServiceFee(),cleaningFee:this.breakdownCleaningFee(),resortFee:this.breakdownResortFee(),other:this.breakdownOtherFees()},discounts:this.breakdownDiscount(),total:this.breakdownGrandTotal(),balance:this.breakdownBalance()},{emitEvent:!1})})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=N({type:o,selectors:[["break-down-total"]],decls:78,vars:68,consts:[[1,"mt-6",3,"formGroup"],[1,"text-sm","font-bold","text-gray-800","mb-4","flex","items-center","gap-2"],["formGroupName","pricing"],["matListItemTitle",""],["matListItemMeta","",1,"font-semibold"],["matListItemMeta",""],["matListItemTitle","",1,"font-semibold"],[1,"py-4"]],template:function(t,i){if(t&1&&(a(0,"div",0)(1,"h3",1),r(2," Price Breakdown "),n(),a(3,"mat-list",2)(4,"mat-list-item")(5,"span",3),r(6,"Total Nights"),n(),a(7,"span",4),r(8),n()(),a(9,"mat-list-item")(10,"span",3),r(11,"Base Total (all rooms)"),n(),a(12,"span",5),r(13),R(14,"currency"),n()(),a(15,"mat-list-item")(16,"span",3),r(17,"Service Fee"),n(),a(18,"span",5),r(19),R(20,"currency"),n()(),a(21,"mat-list-item")(22,"span",3),r(23,"Cleaning Fee"),n(),a(24,"span",5),r(25),R(26,"currency"),n()(),a(27,"mat-list-item")(28,"span",3),r(29,"Resort Fee"),n(),a(30,"span",5),r(31),R(32,"currency"),n()(),a(33,"mat-list-item")(34,"span",3),r(35,"Other Fees"),n(),a(36,"span",5),r(37),R(38,"currency"),n()(),C(39,"mat-divider"),a(40,"mat-list-item")(41,"span",6),r(42,"Total Fees"),n(),a(43,"span",4),r(44),R(45,"currency"),n()(),C(46,"mat-divider"),a(47,"mat-list-item")(48,"span",3),r(49,"Taxes"),n(),a(50,"span",5),r(51),R(52,"currency"),n()(),a(53,"mat-list-item")(54,"span",3),r(55,"Discount"),n(),a(56,"span",5),r(57),R(58,"currency"),n()(),C(59,"mat-divider"),a(60,"mat-list-item",7)(61,"span",3),r(62,"Grand Total"),n(),a(63,"span",5),r(64),R(65,"currency"),n()(),a(66,"mat-list-item",7)(67,"span",3),r(68,"Paid"),n(),a(69,"span",5),r(70),R(71,"currency"),n()(),a(72,"mat-list-item",7)(73,"span",3),r(74,"Balance"),n(),a(75,"span",5),r(76),R(77,"currency"),n()()()()),t&2){let s,m,c,u,v,D,M,V,P,Fe,J;g("formGroup",i.reservationForm()),l(8),y(" ",i.totalNumberOfNights()," night(s) "),l(5),y(" ",Q(14,13,i.breakdownSubtotal(),(s=i.storeStore.selectedStore())==null?null:s.currency,"symbol","1.2-2")," "),l(6),y(" ",Q(20,18,i.breakdownServiceFee(),(m=i.storeStore.selectedStore())==null?null:m.currency,"symbol","1.2-2")," "),l(6),y(" ",Q(26,23,i.breakdownCleaningFee(),(c=i.storeStore.selectedStore())==null?null:c.currency,"symbol","1.2-2")," "),l(6),y(" ",Q(32,28,i.breakdownResortFee(),(u=i.storeStore.selectedStore())==null?null:u.currency,"symbol","1.2-2")," "),l(6),y(" ",Q(38,33,i.breakdownOtherFees(),(v=i.storeStore.selectedStore())==null?null:v.currency,"symbol","1.2-2")," "),l(7),y(" ",Q(45,38,i.breakdownTotalFees(),(D=i.storeStore.selectedStore())==null?null:D.currency,"symbol","1.2-2")," "),l(7),y(" ",Q(52,43,i.breakdownTaxes(),(M=i.storeStore.selectedStore())==null?null:M.currency,"symbol","1.2-2")," "),l(6),y(" ",Q(58,48,i.breakdownDiscount(),(V=i.storeStore.selectedStore())==null?null:V.currency,"symbol","1.2-2")," "),l(7),y(" ",Q(65,53,i.breakdownGrandTotal(),(P=i.storeStore.selectedStore())==null?null:P.currency,"symbol","1.2-2")," "),l(6),y(" ",Q(71,58,i.paidAmount(),(Fe=i.storeStore.selectedStore())==null?null:Fe.currency,"symbol","1.2-2")," "),l(6),y(" ",Q(77,63,i.breakdownBalance(),(J=i.storeStore.selectedStore())==null?null:J.currency,"symbol","1.2-2")," ")}},dependencies:[Ie,mt,ct,Ut,lt,Xi,G,$,j,q,qe,B,St,_e],styles:["[_nghost-%COMP%]{display:block}"]})};var We=o=>({prefix:o}),Ro=(o,e)=>e.value;function No(o,e){if(o&1&&(a(0,"mat-option",10),r(1),n()),o&2){let t=e.$implicit;g("value",t.value),l(),y(" ",t.label," ")}}function To(o,e){if(o&1&&(a(0,"mat-hint"),r(1),R(2,"currency"),n()),o&2){let t,i=p();l(),y(" % of subtotal (= ",he(2,1,(i.subtotal()*i.discount()/100).toFixed(2),(t=i.storeStore.selectedStore())==null?null:t.currency),") ")}}function ko(o,e){o&1&&(a(0,"mat-hint"),r(1," Fixed amount "),n())}var Rt=class o{reservationFormService=_(re);reservationForm=A(this.reservationFormService.form$,{initialValue:null});dialogRef=_(oi);data=_(ht);storeStore=_(K);destroy$=new Ve;discountTypeOptions=[{value:"percentage",label:"Percentage (%)"},{value:"amount",label:"Fixed Amount"}];pricingForm;stayPeriodForm=null;fees;constructor(){let e=this.reservationForm().get("rooms");this.pricingForm=e.at(this.data.roomIndex).get("pricing"),this.stayPeriodForm=e.at(this.data.roomIndex).get("stayPeriod"),this.fees=this.pricingForm.get("fees")}discountType=E("amount");taxes=E(0);discount=E(0);serviceFee=E(0);cleaningFee=E(0);resortFee=E(0);otherFee=E(0);numberOfNights=E(0);pricePerNight=E(0);subtotal=F(()=>{let e=this.pricePerNight(),t=this.numberOfNights();return e*t});discountAmount=F(()=>this.discountType()==="percentage"?this.subtotal()*this.discount()/100:this.discount());calculatedTotal=F(()=>{let e=this.subtotal(),t=this.discountAmount(),i=this.taxes(),s=this.serviceFee(),m=this.cleaningFee(),c=this.resortFee(),u=this.otherFee(),v=e-t+i+s+m+c+u;return Math.max(0,v)});eff=Ae(()=>{let e=this.calculatedTotal(),t=this.subtotal();this.pricingForm.patchValue({subtotal:t,total:e},{emitEvent:!1})});ngOnInit(){this.discountType.set(this.pricingForm?.get("discountType")?.value||"amount"),this.taxes.set(this.pricingForm?.get("taxes")?.value||0),this.discount.set(this.pricingForm?.get("discount")?.value||0),this.pricePerNight.set(this.pricingForm?.get("pricePerNight")?.value||0),this.fees&&(this.serviceFee.set(this.fees.get("serviceFee")?.value||0),this.cleaningFee.set(this.fees.get("cleaningFee")?.value||0),this.resortFee.set(this.fees.get("resortFee")?.value||0),this.otherFee.set(this.fees.get("other")?.value||0)),this.stayPeriodForm&&this.numberOfNights.set(this.stayPeriodForm.get("numberOfNights")?.value||0),this.pricingForm?.get("discountType")?.valueChanges.pipe(se(this.destroy$)).subscribe(e=>{this.discountType.set(e)}),this.pricingForm?.get("taxes")?.valueChanges.pipe(se(this.destroy$)).subscribe(e=>{this.taxes.set(e||0)}),this.pricingForm?.get("discount")?.valueChanges.pipe(se(this.destroy$)).subscribe(e=>{this.discount.set(e||0)}),this.pricingForm?.get("pricePerNight")?.valueChanges.pipe(se(this.destroy$)).subscribe(e=>{this.pricePerNight.set(e||0)}),this.fees&&(this.fees.get("serviceFee")?.valueChanges.pipe(se(this.destroy$)).subscribe(e=>{console.log("serviceFee changed:",e),this.serviceFee.set(e||0)}),this.fees.get("cleaningFee")?.valueChanges.pipe(se(this.destroy$)).subscribe(e=>{this.cleaningFee.set(e||0)}),this.fees.get("resortFee")?.valueChanges.pipe(se(this.destroy$)).subscribe(e=>{this.resortFee.set(e||0)}),this.fees.get("other")?.valueChanges.pipe(se(this.destroy$)).subscribe(e=>{this.otherFee.set(e||0)})),this.stayPeriodForm&&this.stayPeriodForm.get("numberOfNights")?.valueChanges.pipe(se(this.destroy$)).subscribe(e=>{this.numberOfNights.set(e||0)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onCancel(){this.dialogRef.close()}onSave(){this.pricingForm.valid&&this.dialogRef.close(this.pricingForm.value)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=N({type:o,selectors:[["app-price-edit-dialog"]],decls:96,vars:37,consts:[["mat-dialog-title",""],[1,"space-y-4",3,"formGroup"],[1,"space-y-3"],[1,"text-sm","font-semibold","text-gray-700"],[1,"grid","grid-cols-2","gap-2"],["appearance","outline",1,"w-full"],["matInput","","currencyMask","","formControlName","pricePerNight","readonly","",3,"options"],["matPrefix",""],["matInput","","currencyMask","","formControlName","subtotal","readonly","",3,"options"],["formControlName","discountType"],[3,"value"],["matInput","","type","number","formControlName","discount","placeholder","0"],["matInput","","currencyMask","","formControlName","taxes","placeholder","0.00",3,"options"],["formGroupName","fees",1,"space-y-3"],["matInput","","currencyMask","","formControlName","serviceFee","placeholder","0.00",3,"options"],["matInput","","currencyMask","","formControlName","cleaningFee","placeholder","0.00",3,"options"],["matInput","","currencyMask","","formControlName","resortFee","placeholder","0.00",3,"options"],["matInput","","currencyMask","","formControlName","other","placeholder","0.00",3,"options"],["matInput","","currencyMask","","formControlName","total","readonly","",1,"text-lg","font-bold",3,"options"],["align","end"],["matButton","outlined",3,"click"],["matButton","filled","color","primary",3,"click","disabled"]],template:function(t,i){if(t&1&&(a(0,"h2",0),r(1),n(),a(2,"mat-dialog-content")(3,"form",1)(4,"div",2)(5,"div",3),r(6,"Base Price (Before Discount)"),n(),a(7,"div",4)(8,"mat-form-field",5)(9,"mat-label"),r(10,"Price/Night"),n(),C(11,"input",6),a(12,"mat-icon",7),r(13),n()(),a(14,"mat-form-field",5)(15,"mat-label"),r(16,"Subtotal"),n(),C(17,"input",8),a(18,"mat-icon",7),r(19),n(),a(20,"mat-hint"),r(21),R(22,"currency"),n()()()(),C(23,"mat-divider"),a(24,"div",2)(25,"div",3),r(26,"Discount"),n(),a(27,"div",4)(28,"mat-form-field",5)(29,"mat-label"),r(30,"Discount Type"),n(),a(31,"mat-select",9),z(32,No,2,2,"mat-option",10,Ro),n(),a(34,"mat-icon",7),r(35,"local_offer"),n()(),a(36,"mat-form-field",5)(37,"mat-label"),r(38,"Discount Value"),n(),C(39,"input",11),a(40,"mat-icon",7),r(41,"money_off"),n(),f(42,To,3,4,"mat-hint"),f(43,ko,2,0,"mat-hint"),n()()(),C(44,"mat-divider"),a(45,"div",2)(46,"div",3),r(47,"Taxes & Fees"),n(),a(48,"mat-form-field",5)(49,"mat-label"),r(50,"Taxes"),n(),C(51,"input",12),a(52,"mat-icon",7),r(53,"receipt"),n()(),a(54,"div",13)(55,"mat-form-field",5)(56,"mat-label"),r(57,"Service Fee"),n(),C(58,"input",14),a(59,"mat-icon",7),r(60,"room_service"),n()(),a(61,"mat-form-field",5)(62,"mat-label"),r(63,"Cleaning Fee"),n(),C(64,"input",15),a(65,"mat-icon",7),r(66,"cleaning_services"),n()(),a(67,"mat-form-field",5)(68,"mat-label"),r(69,"Resort Fee"),n(),C(70,"input",16),a(71,"mat-icon",7),r(72,"villa"),n()(),a(73,"mat-form-field",5)(74,"mat-label"),r(75,"Other Fee"),n(),C(76,"input",17),a(77,"mat-icon",7),r(78,"add_circle_outline"),n()()()(),C(79,"mat-divider"),a(80,"div",2)(81,"div",3),r(82,"Total Price (After Discount)"),n(),a(83,"mat-form-field",5)(84,"mat-label"),r(85,"Total"),n(),C(86,"input",18),a(87,"mat-icon",7),r(88),n(),a(89,"mat-hint"),r(90,"Subtotal - Discount + Taxes + Fees"),n()()()()(),a(91,"mat-dialog-actions",19)(92,"button",20),b("click",function(){return i.onCancel()}),r(93," Cancel "),n(),a(94,"button",21),b("click",function(){return i.onSave()}),r(95," Save Changes "),n()()),t&2){let s,m,c,u,v,D,M,V,P,Fe,J,fe,kt,Gt;l(),y("Edit Room Pricing (",i.numberOfNights(),") night(s)"),l(2),g("formGroup",i.pricingForm),l(8),g("options",De(21,We,(s=i.storeStore.selectedStore())==null?null:s.currency)),l(2),k((m=i.storeStore.selectedStore())==null?null:m.currency),l(4),g("options",De(23,We,(c=i.storeStore.selectedStore())==null?null:c.currency)),l(2),k((u=i.storeStore.selectedStore())==null?null:u.currency),l(2),Ee("",he(22,18,i.pricePerNight(),(v=i.storeStore.selectedStore())==null?null:v.currency)," \xD7 ",i.numberOfNights()," nights"),l(11),Z(i.discountTypeOptions),l(10),h(((D=i.pricingForm.get("discountType"))==null?null:D.value)==="percentage"?42:-1),l(),h(((M=i.pricingForm.get("discountType"))==null?null:M.value)==="amount"?43:-1),l(8),g("options",De(25,We,(V=i.storeStore.selectedStore())==null?null:V.currency)),l(7),g("options",De(27,We,(P=i.storeStore.selectedStore())==null?null:P.currency)),l(6),g("options",De(29,We,(Fe=i.storeStore.selectedStore())==null?null:Fe.currency)),l(6),g("options",De(31,We,(J=i.storeStore.selectedStore())==null?null:J.currency)),l(6),g("options",De(33,We,(fe=i.storeStore.selectedStore())==null?null:fe.currency)),l(10),g("options",De(35,We,(kt=i.storeStore.selectedStore())==null?null:kt.currency)),l(2),k((Gt=i.storeStore.selectedStore())==null?null:Gt.currency),l(6),g("disabled",!i.pricingForm.valid)}},dependencies:[G,$,Le,ue,$t,X,j,q,pe,qe,L,de,O,W,ae,oe,ke,st,B,be,I,H,ge,Ge,ye,Ue,Ut,yt,Ct,_t,vt,St,si,_e],styles:["[_nghost-%COMP%]{display:block}.space-y-3[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:.75rem}.space-y-4[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:1rem}.grid[_ngcontent-%COMP%]{display:grid}.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3[_ngcontent-%COMP%]{grid-template-columns:repeat(3,minmax(0,1fr))}.gap-2[_ngcontent-%COMP%]{gap:.5rem}.w-full[_ngcontent-%COMP%]{width:100%}.text-sm[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.font-semibold[_ngcontent-%COMP%]{font-weight:600}.text-gray-700[_ngcontent-%COMP%]{color:#374151}.text-lg[_ngcontent-%COMP%]{font-size:1.125rem;line-height:1.75rem}.font-bold[_ngcontent-%COMP%]{font-weight:700}mat-form-field.ng-invalid.ng-touched[_ngcontent-%COMP%]     .mat-mdc-form-field-error{display:block}"]})};function Go(o,e){if(o&1&&(a(0,"pre"),r(1),R(2,"currency"),n()),o&2){let t,i=p();l(),ki("Selected Room: ",i.roomsResource.value().name," (",i.roomsResource.value().roomNumber,") - ",he(2,3,i.roomsResource.value().priceOverride,(t=i.storeStore.selectedStore())==null?null:t.currency)," ")}}function Io(o,e){o&1&&(a(0,"div",9),C(1,"mat-spinner",11),n())}function Po(o,e){if(o&1){let t=T();a(0,"div",12)(1,"div",14)(2,"span",15),r(3),n(),a(4,"div",16)(5,"mat-icon",17),r(6,"person"),n(),a(7,"div",18)(8,"span",19),r(9),n(),a(10,"span",20),r(11),n()()(),a(12,"mat-form-field",21)(13,"mat-label"),r(14,"Check-in to Check-out"),n(),a(15,"mat-date-range-input",22),C(16,"input",23)(17,"input",24),n(),C(18,"mat-datepicker-toggle",25)(19,"mat-date-range-picker",null,0),a(21,"mat-hint"),r(22),n()(),a(23,"div",26)(24,"a",27),b("click",function(){let s,m=x(t),c=m.$implicit,u=m.$index,v=p(2);return S(v.editSharer(u,(s=c.get("ageGrade"))==null?null:s.value))}),a(25,"mat-icon",5),r(26,"edit"),n()(),a(27,"a",28),b("click",function(){let s=x(t).$index,m=p(2);return S(m.deleteSharer(s))}),a(28,"mat-icon",5),r(29,"delete"),n()()()()()}if(o&2){let t,i,s,m,c,u=e.$implicit,v=e.$index,D=Me(20),M=p(2);g("formGroup",M.asFormGroup(u)),l(3),y(" P",v+1," "),l(6),y(" ",M.getSharerName(u)||"Unassigned Guest"," "),l(2),y(" ",((t=u.get("ageGrade"))==null?null:t.value)||"Adult"," "),l(4),g("rangePicker",D)("min",M.getReservationMinDate())("max",M.getReservationMaxDate()),l(3),g("for",D),l(4),y("",M.calculateNights((i=u.get("checkInDate"))==null?null:i.value,(i=u.get("checkOutDate"))==null?null:i.value)," night(s)"),l(2),g("matTooltip",wi(!M.hasPrimaryGuest()&&((s=u.get("ageGrade"))==null?null:s.value)==="child"?"Assign primary guest first":"Edit Guest"))("disabled",!M.hasPrimaryGuest()&&((m=u.get("ageGrade"))==null?null:m.value)==="child")("ngClass",!M.hasPrimaryGuest()&&((c=u.get("ageGrade"))==null?null:c.value)==="child"?"text-gray-300":"text-blue-600 hover:bg-blue-50"),l(3),g("disabled",v===0)("ngClass",v===0?"text-gray-300 cursor-not-allowed":"text-red-600 hover:bg-red-50")}}function wo(o,e){o&1&&(a(0,"div",13)(1,"mat-icon",29),r(2,"group_off"),n(),a(3,"p",30),r(4,"No guests added yet"),n()())}function Ao(o,e){o&1&&C(0,"break-down-total")}function Oo(o,e){o&1&&(a(0,"div",13)(1,"mat-icon",29),r(2,"meeting_room"),n(),a(3,"p",30),r(4,"No rooms assigned yet"),n()())}function Bo(o,e){if(o&1&&(a(0,"div",10),z(1,Po,30,15,"div",12,Pt,!1,wo,5,0,"div",13),f(4,Ao,1,0,"break-down-total")(5,Oo,5,0,"div",13),n()),o&2){let t=p();l(),Z(t.getSharersFormArray().controls),l(3),h(t.roomsResource.hasValue()?4:5)}}var ui=class o{fb=_(Te);storeStore=_(K);route=_(Ot);guestService=_(we);id=E(this.route.snapshot.paramMap.get("id"));isEditing=F(()=>!!this.id());reservationFormService=_(re);reservationForm=A(this.reservationFormService.form$,{initialValue:null});checkInDate=A(this.reservationForm().get("checkInDate").valueChanges,{initialValue:this.reservationForm().get("checkInDate").value});checkOutDate=A(this.reservationForm().get("checkOutDate").valueChanges,{initialValue:this.reservationForm().get("checkOutDate").value});numberOfAdults=A(this.reservationForm().get("numberOfAdults").valueChanges,{initialValue:this.reservationForm().get("numberOfAdults").value});numberOfChildren=A(this.reservationForm().get("numberOfChildren").valueChanges,{initialValue:this.reservationForm().get("numberOfChildren").value});quickReservation=w(null);selectedGuest=Bi(null);reservation=w(null);sharerAdded=U();sharerEdited=U();sharerDeleted=U();sharersArrayUpdated=U();reservationMinDate=E(null);reservationMaxDate=E(null);dialog=_(je);roomService=_(xt);roomsResource=Re({params:()=>({roomId:this.isEditing()?this.reservation().rooms[0]?.room._id:this.quickReservation()?.selectedRoom,isEditing:this.isEditing()}),stream:({params:e})=>this.getRoom(e.roomId).pipe(Xe(t=>{e.isEditing?this.populateSharersFromReservation(this.reservation()):this.buildSharesOnNewReservation(),this.buildARoomForTheSharers(t)}))});populateSharersFromReservation(e){if(!e){console.log("[RoomSharers] No reservation provided, skipping population");return}console.log("[RoomSharers] populateSharersFromReservation called with reservation:",e);let t=this.getSharersFormArray();if(!t){console.warn("[RoomSharers] getSharersFormArray() returned null");return}t.clear(),console.log("[RoomSharers] Sharers array cleared"),e.sharers&&e.sharers.length>0?(console.log("[RoomSharers] Populating sharers from reservation.sharers:",e.sharers),e.sharers.forEach((i,s)=>{console.log(`[RoomSharers] Processing sharer ${s}:`,i);let m=this.fb.group({guest:[i.guest._id||i.guest,[d.required]],meta:[i.guest,[]],guestType:[i.guestType||"adult",[d.required]],checkInDate:[new Date(i.checkInDate),[d.required]],checkOutDate:[new Date(i.checkOutDate),[d.required]],ageGrade:[i.ageGrade||"",[]]});t.push(m),console.log(`[RoomSharers] Sharer ${s} added to form array. Current array length:`,t.length)})):console.warn("[RoomSharers] No sharers found in reservation"),console.log("[RoomSharers] populateSharersFromReservation completed. Final array length:",t.length)}buildSharesOnNewReservation(){let e=this.getSharersFormArray();if(e){let t=e.length,i=this.numberOfAdults()+this.numberOfChildren();if(t!==i){e.clear();for(let s=0;s<this.numberOfAdults();s++){let m=s===0&&this.selectedGuest()?this.selectedGuest()?._id:null;e.push(this.fb.group({guest:[m,[d.required]],guestType:["individual"],ageGrade:["adult"],checkInDate:[this.checkInDate()],checkOutDate:[this.checkOutDate()],meta:[null]}))}for(let s=0;s<this.numberOfChildren();s++)e.push(this.fb.group({guest:[null,[d.required]],meta:[null],guestType:["individual"],ageGrade:["child"],checkInDate:[this.checkInDate()],checkOutDate:[this.checkOutDate()]}));this.sharersArrayUpdated.emit(e)}}}buildARoomForTheSharers(e){console.log(e,"nvnbbnvv");let t=this.getRoomsFormArray();if(t&&e){let i=this.createRoomFormGroup(e,this.reservation()?.rooms[0]);t.clear(),t.push(i)}}createRoomFormGroup(e,t){let i=t?.pricing?.pricePerNight||0;i||(e.priceOverride?i=e.priceOverride:typeof e.roomType=="object"&&e.roomType?.basePrice&&(i=e.roomType.basePrice));let s=i*this.numberOfNights();return console.log(t?.pricing?.discount,"roomData?.pricing?.discount"),this.fb.group({room:[t?.room||e._id||"",[d.required]],roomNumber:[t?.roomNumber||e.roomNumber||""],assignedGuest:[t?.assignedGuest||this.reservation()?.guest._id||""],assignedGuestName:[t?.assignedGuestName||this.guestService.getGuestName(this.reservation()?.guest)||""],roomType:[t?.roomType||(typeof e.roomType=="string"?e.roomType:e.roomType?._id)||"",[d.required]],stayPeriod:this.fb.group({from:[this.checkInDate(),[d.required]],to:[this.checkOutDate(),[d.required]],numberOfNights:[t?.stayPeriod?.numberOfNights||this.numberOfNights(),[d.required,d.min(1)]]}),guests:this.fb.group({adults:[t?.guests?.adults||1,[d.required,d.min(1)]],children:[t?.guests?.children||0,[d.required,d.min(0)]]}),pricing:this.fb.group({pricePerNight:[t?.pricing?.pricePerNight||i,[d.required,d.min(0)]],totalPrice:[t?.pricing?.totalPrice||s,[d.required,d.min(0)]],discount:[t?.pricing?.discount||0,[d.min(0)]],subtotal:[t?.pricing?.subtotal||s,[d.min(0)]],taxes:[t?.pricing?.taxes||0,[d.min(0)]],discountType:[t?.pricing?.discountType||"amount"],fees:this.fb.group({serviceFee:[t?.pricing?.fees?.serviceFee||0,[d.min(0)]],cleaningFee:[t?.pricing?.fees?.cleaningFee||0,[d.min(0)]],resortFee:[t?.pricing?.fees?.resortFee||0,[d.min(0)]],other:[t?.pricing?.fees?.other||0,[d.min(0)]]}),total:[t?.pricing?.total||s,[d.min(0)]]}),notes:[t?.notes||""]})}ngAfterViewInit(){this.reservationMinDate.set(this.checkInDate()),this.reservationMaxDate.set(this.checkOutDate());let e=this.reservationForm().get("rooms"),t=this.reservationForm().get("sharers"),i=this.reservationForm()?.get("checkInDate")?.valueChanges.subscribe(m=>{this.reservationMinDate.set(m);for(let u=0;u<e.length;u++)e.at(u)?.patchValue({stayPeriod:{from:m}},{emitEvent:!1});let c=this.reservationForm().get("sharers");if(c)for(let u=0;u<c.length;u++)c.at(u)?.patchValue({checkInDate:m},{emitEvent:!1})}),s=this.reservationForm()?.get("checkOutDate")?.valueChanges.subscribe(m=>{this.reservationMaxDate.set(m);let c=this.reservationForm()?.get("checkInDate")?.value,u=Math.abs(m.getTime()-c.getTime()),v=Math.ceil(u/(1e3*60*60*24));for(let M=0;M<e.length;M++){let V=e.at(M),J=(V?.get("pricing")?.get("pricePerNight")?.value||0)*v;V?.patchValue({stayPeriod:{to:m,numberOfNights:v},pricing:{totalPrice:J,subtotal:J,total:J}},{emitEvent:!0})}let D=this.reservationForm().get("sharers");if(D)for(let M=0;M<D.length;M++)D.at(M)?.patchValue({checkOutDate:m},{emitEvent:!1})});e?.valueChanges.pipe(Qe((m,c)=>JSON.stringify(m)===JSON.stringify(c))).subscribe(()=>{for(let m=0;m<e.length;m++){let c=e.at(m),u=c?.get("pricing"),v=c?.get("stayPeriod"),D=u?.get("pricePerNight")?.value||0,M=v?.get("numberOfNights")?.value||0,V=D*M;c?.patchValue({pricing:{totalPrice:V,subtotal:V,total:V}},{emitEvent:!0})}})}numberOfNights=F(()=>{let e=this.checkInDate(),t=this.checkOutDate();if(e&&t){let i=Math.abs(t.getTime()-e.getTime());return Math.ceil(i/(1e3*60*60*24))}return 0});getRoomsFormArray(){let e=this.reservationForm();return e?e.get("rooms"):new Nt([])}getRoom(e){return this.roomService.getRoom(e)}hasPrimaryGuest=F(()=>{let e=this.selectedGuest();if(!e)return!1;let t=e?._id;return t!=null&&t!==""});getSharersFormArray(){let e=this.reservationForm();return e?e.get("sharers"):new Nt([])}getPrimaryGuest(){let e=this.getSharersFormArray();return e.length>0?e.at(0):null}getOtherSharers(){let e=this.getSharersFormArray();return e.length>1?Array.from({length:e.length-1},(t,i)=>e.at(i+1)):[]}addSharer(e,t){let i=this.getSharersFormArray(),s=this.getPrimaryGuest();s?.value?.guest?i.push(this.fb.group({guest:[e?._id],meta:e,guestType:["individual"],ageGrade:t,checkInDate:[this.reservationMinDate()],checkOutDate:[this.reservationMaxDate()]})):(s?.patchValue({guest:e?._id,meta:e,guestType:"individual",ageGrade:t,checkInDate:this.reservationMinDate(),checkOutDate:this.reservationMaxDate()}),this.selectedGuest.set(e))}onCreateGuest(){this.dialog.open(Ne,{width:"600px",disableClose:!1,data:{bookingType:"single",ageGrade:"adult"}}).afterClosed().subscribe(t=>{t&&this.addSharer(t,"adult")})}editSharer(e,t){let i=this.getSharersFormArray();if(!i.at(e))return;let m=this.getPrimaryGuest(),c=m&&m.value.guest;e!==0&&!c&&(e=0),this.dialog.open(Ne,{width:"600px",disableClose:!1,data:{bookingType:"single",guest:i.at(e)?.value.meta||null,ageGrade:t}}).afterClosed().subscribe(v=>{v&&(this.updateSharerWithGuest(e,v),this.sharerEdited.emit({index:e,sharer:v}))})}deleteSharer(e){let t=this.getSharersFormArray();e!==0&&(t.removeAt(e),this.sharerDeleted.emit({index:e}))}updateSharerWithGuest(e,t){}getSharerName(e){let t=e.get("meta")?.value?.firstName,i=e.get("meta")?.value?.lastName;return t||i?`${t||""} ${i||""}`.trim():"Unassigned Guest"}asFormGroup(e){return e}getSharerTypeBadge(e){return this.getSharersFormArray().controls.indexOf(e)===0?"Primary Guest":e.get("type")?.value==="adult"?"Adult":"Child"}getReservationMinDate(){return this.reservationMinDate()}getReservationMaxDate(){return this.reservationMaxDate()}calculateNights(e,t){if(!e||!t)return 0;let i=new Date(e).getTime(),s=new Date(t).getTime(),m=Math.ceil((s-i)/(1e3*60*60*24));return m>0?m:0}onSharerHome(e){}onGuestCheckIn(){this.sharerAdded.emit({action:"check_in"})}onGenerateGuestService(){this.sharerAdded.emit({action:"generate_service"})}onAddInfants(){this.dialog.open(Ne,{width:"600px",disableClose:!1,data:{bookingType:"single",ageGrade:"child"}}).afterClosed().subscribe(t=>{t&&this.addSharer(t,"child")}),this.sharerAdded.emit({action:"add_infants"})}onEditRoomPricing(){let e=this.getRoomsFormArray();if(!e||e.length===0)return;this.dialog.open(Rt,{width:"800px",disableClose:!1,data:{roomIndex:0}}).afterClosed().subscribe(i=>{if(i){let m=e.at(0)?.get("pricing");m&&m.patchValue(i,{emitEvent:!0})}})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=N({type:o,selectors:[["app-room-sharers"]],inputs:{quickReservation:[1,"quickReservation"],selectedGuest:[1,"selectedGuest"],reservation:[1,"reservation"]},outputs:{selectedGuest:"selectedGuestChange",sharerAdded:"sharerAdded",sharerEdited:"sharerEdited",sharerDeleted:"sharerDeleted",sharersArrayUpdated:"sharersArrayUpdated"},decls:24,vars:7,consts:[["picker",""],["appearance","outlined",3,"formGroup"],[1,"flex","justify-between","items-center","w-full"],[1,"flex","gap-2"],["matButton","","color","accent",3,"click","disabled"],[1,"material-icons-outlined"],["matButton","tonal","color","secondary",3,"click","disabled","matTooltip"],["matButton","filled","color","primary",3,"click","disabled"],["formArrayName","sharers"],[1,"flex","justify-center","py-12"],[1,"py-4","space-y-3"],["diameter","40"],[1,"border","border-gray-200","rounded-lg",3,"formGroup"],[1,"text-center","py-8","text-gray-500"],[1,"flex","items-center","gap-3","p-4"],[1,"px-3","py-1","bg-orange-100","text-orange-700","rounded-full","text-xs","font-bold","min-w-fit"],[1,"flex","items-center","gap-2","min-w-[180px]"],[1,"text-gray-400"],[1,"flex","flex-col"],[1,"font-medium","text-gray-900","truncate"],[1,"text-xs","text-gray-500","uppercase"],["appearance","outline",1,"min-w-[220px]","w-[220px]"],[3,"rangePicker","min","max"],["matStartDate","","formControlName","checkInDate","placeholder","Start date"],["matEndDate","","formControlName","checkOutDate","placeholder","End date"],["matSuffix","",3,"for"],[1,"flex","items-center","gap-1","ml-auto"],["mat-icon-button","",3,"click","matTooltip","disabled","ngClass"],["mat-icon-button","","matTooltip","Delete Guest",3,"click","disabled","ngClass"],[1,"text-4xl","text-gray-300","mb-2"],[1,"text-sm"]],template:function(t,i){t&1&&(a(0,"mat-card",1)(1,"mat-card-header")(2,"div",2)(3,"div")(4,"mat-card-title"),r(5," Room Sharers "),n(),a(6,"mat-card-subtitle"),f(7,Go,3,6,"pre"),n()(),a(8,"div",3)(9,"a",4),b("click",function(){return i.onEditRoomPricing()}),a(10,"mat-icon",5),r(11,"edit"),n(),r(12," Edit Pricing "),n(),a(13,"a",6),b("click",function(){return i.onAddInfants()}),a(14,"mat-icon",5),r(15,"child_care"),n(),r(16," Add Infant "),n(),a(17,"a",7),b("click",function(){return i.onCreateGuest()}),a(18,"mat-icon",5),r(19,"person_add"),n(),r(20," ADD ROOM SHARER "),n()()()(),a(21,"mat-card-content",8),f(22,Io,2,0,"div",9)(23,Bo,6,2,"div",10),n()()),t&2&&(g("formGroup",i.reservationForm()),l(7),h(i.roomsResource.hasValue()?7:-1),l(2),g("disabled",i.roomsResource.isLoading()),l(4),g("disabled",!i.hasPrimaryGuest()||i.roomsResource.isLoading())("matTooltip",i.hasPrimaryGuest()?"":"Please assign a primary guest first"),l(4),g("disabled",i.roomsResource.isLoading()),l(5),h(i.roomsResource.isLoading()?22:23))},dependencies:[G,At,$,ue,X,j,q,pe,Ht,O,ee,ie,ne,at,te,W,ae,oe,ke,$e,B,L,de,Bt,I,H,ge,Ue,Ie,bt,Se,dt,Pe,Ke,ut,pt,gt,ft,nt,sn,Dt,xe,He,_e],encapsulation:2})};var vn=()=>[],Vo=o=>({prefix:o}),Lo=(o,e)=>e._id||e.id,qo=(o,e)=>e._id;function $o(o,e){o&1&&(a(0,"div",6),C(1,"mat-spinner",8),n())}function Ho(o,e){if(o&1&&(a(0,"mat-option",15),r(1),n()),o&2){let t=e.$implicit;g("value",t._id||t.id),l(),y(" ",t.name," ")}}function Uo(o,e){if(o&1&&(a(0,"mat-option",15),r(1),n()),o&2){let t=e.$implicit;g("value",t._id),l(),y(" ",t.name+" "+t.roomNumber," ")}}function Ko(o,e){o&1&&(a(0,"mat-error"),r(1,"Check-in date is required"),n())}function jo(o,e){o&1&&(a(0,"mat-error"),r(1,"Check-out date is required"),n())}function Wo(o,e){if(o&1){let t=T();a(0,"button",38),b("click",function(){x(t);let s=p().$index,m=p(2);return S(m.onChangeRoom(s))}),a(1,"mat-icon",20),r(2,"swap_horiz"),n()()}}function zo(o,e){if(o&1){let t=T();a(0,"div",11)(1,"div")(2,"mat-form-field",13)(3,"mat-label"),r(4,"Room Type"),n(),a(5,"mat-select",14),b("selectionChange",function(s){let m=x(t).$index,c=p(2);return S(c.onRoomTypeChange(m,s.value))}),z(6,Ho,2,2,"mat-option",15,Lo),n()()(),a(8,"div")(9,"mat-form-field",13)(10,"mat-label"),r(11,"Room"),n(),a(12,"mat-select",16),b("selectionChange",function(s){let m=x(t).$index,c=p(2);return S(c.onRoomChange(m,s.value))}),a(13,"mat-option",17),r(14,"-- Select Room --"),n(),z(15,Uo,2,2,"mat-option",15,qo),n()()(),a(17,"div")(18,"mat-form-field",13)(19,"mat-label"),r(20,"Assigned Guest"),n(),C(21,"input",18),a(22,"button",19),b("click",function(){let s=x(t).$index,m=p(2);return S(m.onAddOrChangeGuest(s))}),a(23,"mat-icon",20),r(24,"person_add"),n()()()(),a(25,"div",21)(26,"mat-form-field",22)(27,"mat-label"),r(28,"Adults"),n(),C(29,"input",23),a(30,"mat-icon",24),r(31,"person"),n()(),a(32,"mat-form-field",22)(33,"mat-label"),r(34,"Children"),n(),C(35,"input",25),a(36,"mat-icon",24),r(37,"child_care"),n()()(),a(38,"div",26)(39,"mat-form-field",13)(40,"mat-label"),r(41,"Stay Period"),n(),a(42,"mat-date-range-input",27)(43,"input",28),b("dateChange",function(){let s=x(t).$index,m=p(2);return S(m.onStayPeriodChange(s))}),n(),a(44,"input",29),b("dateChange",function(){let s=x(t).$index,m=p(2);return S(m.onStayPeriodChange(s))}),n()(),C(45,"mat-datepicker-toggle",30)(46,"mat-date-range-picker",null,0),a(48,"mat-hint"),r(49),n(),f(50,Ko,2,0,"mat-error"),f(51,jo,2,0,"mat-error"),n()(),a(52,"div",31)(53,"mat-form-field",13)(54,"mat-label"),r(55,"Price"),n(),C(56,"input",32),a(57,"span",33),r(58),n(),a(59,"button",34),b("click",function(){let s=x(t).$index,m=p(2);return S(m.onEditPrice(s))}),a(60,"mat-icon",20),r(61,"edit"),n()(),a(62,"mat-hint"),r(63),R(64,"currency"),n()()(),a(65,"div",35),f(66,Wo,3,0,"button",36),a(67,"button",37),b("click",function(){let s=x(t).$index,m=p(2);return S(m.removeRoom(s))}),a(68,"mat-icon",20),r(69,"delete"),n()()()()}if(o&2){let t,i,s,m,c,u,v,D,M=e.$index,V=Me(47),P=p(2);g("formGroupName",M),l(6),Z(P.roomTypes.value()||tt(18,vn)),l(9),Z(P.filterRoomsByType((t=P.getRoomsFormArray())==null||(t=t.at(M))==null||(t=t.get("roomType"))==null?null:t.value,M)),l(6),g("value",((i=P.getRoomsFormArray())==null||(i=i.at(M))==null||(i=i.get("assignedGuestName"))==null?null:i.value)||"Select a guest"),l(21),g("rangePicker",V)("min",P.getMinDate())("max",P.getMaxDate()),l(3),g("for",V),l(4),y(" ",((s=P.getRoomsFormArray())==null||(s=s.at(M))==null||(s=s.get("stayPeriod"))==null||(s=s.get("numberOfNights"))==null?null:s.value)||0," night(s) "),l(),h(!((m=P.getRoomsFormArray())==null||(m=m.at(M))==null||(m=m.get("stayPeriod"))==null||(m=m.get("from"))==null)&&m.hasError("required")?50:-1),l(),h(!((c=P.getRoomsFormArray())==null||(c=c.at(M))==null||(c=c.get("stayPeriod"))==null||(c=c.get("to"))==null)&&c.hasError("required")?51:-1),l(5),g("options",De(19,Vo,(u=P.storeStore.selectedStore())==null?null:u.currency)),l(2),y(" ",(v=P.storeStore.selectedStore())==null?null:v.currency),l(5),y(" Total: ",Q(64,13,P.price(M),(D=P.storeStore.selectedStore())==null?null:D.currency,"symbol","1.2-2")," "),l(3),h(P.isEditMode()?66:-1)}}function Zo(o,e){o&1&&(a(0,"div",12)(1,"mat-icon",39),r(2,"meeting_room"),n(),a(3,"p",20),r(4,"No rooms selected"),n()())}function Jo(o,e){if(o&1&&(a(0,"div",7)(1,"div",9)(2,"div",10),z(3,zo,70,21,"div",11,Pt,!1,Zo,5,0,"div",12),n()(),C(6,"break-down-total"),n()),o&2){let t,i=p();g("formGroup",i.reservationForm()),l(3),Z(((t=i.getRoomsFormArray())==null?null:t.controls)||tt(2,vn))}}var pi=class o{roomsService=_(xt);guestService=_(we);storeStore=_(K);fb=_(Te);snackBar=_(ot);dialog=_(je);reservationFormService=_(re);reservationForm=A(this.reservationFormService.form$,{initialValue:null});selectedRoomIds=w([]);reservation=w(null);roomAssigned=U();roomChangeRequested=U();assigningRoomId=E(null);filteredRooms=E([]);assignedGuests=E(new Map);isEditMode=F(()=>!!this.reservation());roomTypes=Re({params:()=>({id:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.roomsService.getRoomTypes(e.id)});selectedRooms=Re({params:()=>({roomIds:this.selectedRoomIds()}),stream:({params:e})=>this.roomsService.getRoomsByIds(e.roomIds).pipe(Xe(t=>{this.populateRoomsFormArray2(t)}))});rooms=Re({params:()=>({store:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.roomsService.getRooms(e.store)});constructor(){Ae(()=>{this.reservation()&&(this.rooms.reload(),this.roomTypes.reload(),this.selectedRooms.reload())})}isRoomsReadyForAssignment=F(()=>this.selectedRoomIds()?this.selectedRooms.hasValue()&&this.rooms.hasValue()&&this.roomTypes.hasValue():this.rooms.hasValue()&&this.roomTypes.hasValue());totalRooms=F(()=>this.rooms.hasValue()?this.rooms.value().length:0);totalCapacity=F(()=>this.rooms.value()?.reduce((e,t)=>{let i=t.capacity;return typeof i=="object"&&i!==null?e+(i.adults||0)+(i.children||0):e+(i||0)},0));isEditingRooms=F(()=>{let e=this.getRoomsFormArray();return e&&e.length>0});price(e){return this.getRoomsFormArray().at(e).get("pricing").get("total")?.value}onCreateRoom(){let e=this.createRoomFormGroup({}),t=this.getRoomsFormArray();if(t){let i=t.length;t.push(e);let s=e.get("stayPeriod");s&&s.valueChanges.subscribe(()=>{this.onStayPeriodChange(i)})}}populateRoomsFormArray2(e){let t=this.getRoomsFormArray();if(!t)return;t.clear();let i=this.reservation(),s=!!i;(s?i.rooms:e).forEach((c,u)=>{let v;if(s){let D="",M="";c.assignedGuest&&(typeof c.assignedGuest=="object"&&c.assignedGuest._id?(D=c.assignedGuest._id,M=this.guestService.getGuestName(c.assignedGuest)):typeof c.assignedGuest=="string"&&(D=c.assignedGuest)),v=this.fb.group({room:[{value:c.room._id||c.room,disabled:this.isEditMode()},[d.required]],roomNumber:[c.room?.roomNumber||"",[]],roomType:[{value:c?.roomType||c?.room?.roomType?._id,disabled:this.isEditMode()},[]],assignedGuest:[D,[d.required]],status:[c.status||"reserved",[d.required]],assignedGuestName:[M,[d.required]],stayPeriod:this.fb.group({from:[new Date(c.stayPeriod?.from||i.checkInDate),[d.required]],to:[new Date(c.stayPeriod?.to||i.checkOutDate),[d.required]],numberOfNights:[c.stayPeriod?.numberOfNights||1,[d.required,d.min(1)]]}),guests:this.fb.group({adults:[c.guests?.adults||1,[d.required,d.min(1)]],children:[c.guests?.children||0,[d.required,d.min(0)]]}),pricing:this.fb.group({pricePerNight:[c?.pricing?.pricePerNight||c?.room?.priceOverride||0,[d.required,d.min(0)]],totalPrice:[c.pricing?.totalPrice||0,[d.required,d.min(0)]],discount:[c.pricing?.discount||0,[d.min(0)]],discountType:[c.pricing?.discountType||"percentage",[]],subtotal:[c.pricing?.subtotal||0,[d.min(0)]],taxes:[c.pricing?.taxes||0,[d.min(0)]],fees:this.fb.group({serviceFee:[c.pricing?.fees?.serviceFee||0,[d.min(0)]],cleaningFee:[c.pricing?.fees?.cleaningFee||0,[d.min(0)]],resortFee:[c.pricing?.fees?.resortFee||0,[d.min(0)]],other:[c.pricing?.fees?.other||0,[d.min(0)]]}),total:[c.pricing?.total||0,[d.min(0)]]}),notes:[c.notes||"",[]]})}else console.log("[RoomDetails] NEW mode - using createRoomFormGroup for room:",c._id),v=this.createRoomFormGroup(c);t.push(v),console.log(`[RoomDetails] Room ${u} added to form array. Current array length:`,t.length)}),console.log("[RoomDetails] populateRoomsFormArray2 completed. Final array length:",t.length),this.reservationForm()?.patchValue({rooms:t},{emitEvent:!1})}createRoomFormGroup(e,t){let i=t?.pricing?.pricePerNight;i||(e.priceOverride?i=e.priceOverride:typeof e.roomType=="object"&&e.roomType?.basePrice&&(i=e.roomType.basePrice));let s=this.reservationForm(),m=t?.stayPeriod?.from||s?.get("checkInDate")?.value||new Date,c=t?.stayPeriod?.to||s?.get("checkOutDate")?.value||new Date,u=this.calculateNumberOfNights(m,c),v=i*u;return this.fb.group({room:[t?.room||e._id||"",[d.required]],roomNumber:[t?.roomNumber||e.roomNumber||""],assignedGuest:[t?.assignedGuest||"",d.required],assignedGuestName:[t?.assignedGuestName||"",d.required],roomType:[t?.roomType||(typeof e.roomType=="string"?e.roomType:e.roomType?._id)||"",[d.required]],stayPeriod:this.fb.group({from:[m,[d.required]],to:[c,[d.required]],numberOfNights:[t?.stayPeriod?.numberOfNights||u,[d.required,d.min(1)]]}),guests:this.fb.group({adults:[t?.guests?.adults||1,[d.required,d.min(1)]],children:[t?.guests?.children||0,[d.required,d.min(0)]]}),pricing:this.fb.group({pricePerNight:[t?.pricing?.pricePerNight||i,[d.required,d.min(0)]],totalPrice:[t?.pricing?.totalPrice||v,[d.required,d.min(0)]],discount:[t?.pricing?.discount||0,[d.min(0)]],subtotal:[t?.pricing?.subtotal||v,[d.min(0)]],taxes:[t?.pricing?.taxes||0,[d.min(0)]],discountType:[t?.pricing?.discountType||"amount"],fees:this.fb.group({serviceFee:[t?.pricing?.fees?.serviceFee||0,[d.min(0)]],cleaningFee:[t?.pricing?.fees?.cleaningFee||0,[d.min(0)]],resortFee:[t?.pricing?.fees?.resortFee||0,[d.min(0)]],other:[t?.pricing?.fees?.other||0,[d.min(0)]]}),total:[t?.pricing?.total||v,[d.min(0)]]}),notes:[t?.notes||""]})}assignRoom(e){this.assigningRoomId.set(e._id||null);let t=this.createRoomFormGroup(e),i=this.getRoomsFormArray();if(i){let s=i.length;i.push(t);let m=t.get("stayPeriod");m&&m.valueChanges.subscribe(()=>{this.onStayPeriodChange(s)}),this.roomAssigned.emit({room:e,formGroup:t,index:s})}}removeRoom(e){let t=this.getRoomsFormArray();t&&t.removeAt(e)}onChangeRoom(e){this.roomChangeRequested.emit(e)}filterRoomsByType(e,t){return console.log(this.rooms.value()),e?this.rooms.value().filter(i=>(typeof i.roomType=="string"?i.roomType:i.roomType?._id)===e):this.rooms.value()||[]}onRoomTypeChange(e,t){let i=this.getRoomsFormArray();if(!i)return;i.at(e)?.get("room")?.reset()}getRoomsFormArray(){let e=this.reservationForm();if(e){let t=e.controls.rooms;return console.log("[RoomDetails] getRoomsFormArray called, array length:",t?.length),t}return console.warn("[RoomDetails] getRoomsFormArray: form is null"),null}onAddOrChangeGuest(e){this.dialog.open(Ne,{width:"600px",disableClose:!1,data:{bookingType:"single",ageGrade:"adult"}}).afterClosed().subscribe(i=>{if(i){let s=this.assignedGuests();s.set(i._id,i),this.assignedGuests.set(s);let m=this.getRoomsFormArray();m&&m.at(e).patchValue({assignedGuest:i._id,assignedGuestName:this.getGuestDisplayName(i)})}})}getGuestDisplayName(e){return e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:e.firstName?e.firstName:e.companyName?e.companyName:"Unknown Guest"}getGuestNameById(e){if(!e)return"";let t=this.assignedGuests().get(e);return t?this.getGuestDisplayName(t):e}onEditPrice(e){let t=this.getRoomsFormArray();if(!t)return;let i=t.at(e),s=i?.get("pricing"),m=i?.get("stayPeriod");if(!s||!m)return;this.dialog.open(Rt,{width:"500px",disableClose:!1,data:{roomIndex:e}}).afterClosed().subscribe(u=>{u&&u.success&&this.snackBar.open("Price updated successfully","Close",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["success-snackbar"]})})}isRoomAlreadySelected(e,t){let i=this.getRoomsFormArray();return i?i.controls.some((s,m)=>m===t?!1:s.get("room")?.value===e):!1}isRoomAvailable(e,t){return!this.isRoomAlreadySelected(e,t)}getSelectedRoomIds(e){let t=this.getRoomsFormArray();return t?t.controls.map((i,s)=>s===e?null:i.get("room")?.value).filter(i=>i!==null&&i!==""):[]}onRoomChange(e,t){if(this.isRoomAlreadySelected(t,e)){this.getRoomsFormArray()?.at(e)?.get("room")?.reset(),this.snackBar.open("This room is already selected in another row","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["error-snackbar"]});return}let i=this.rooms.value().find(s=>s._id===t);if(i){let s=this.getRoomsFormArray();if(s){let m=s.at(e),c=0;i.priceOverride?c=i.priceOverride:typeof i.roomType=="object"&&i.roomType?.basePrice&&(c=i.roomType.basePrice);let v=m?.get("stayPeriod")?.get("numberOfNights")?.value||1,D=c*v;m?.patchValue({roomNumber:i.roomNumber||"",pricing:{pricePerNight:c,totalPrice:D,discount:0,subtotal:D,taxes:0,discountType:"amount",fees:{serviceFee:0,cleaningFee:0,resortFee:0,other:0},total:D}})}}}trackByFormArrayIndex(e){return e}getRoomTypeBadgeColor(e){let t=typeof e=="string"?e:e?.name||"standard";return{deluxe:"bg-blue-100 text-blue-700",suite:"bg-purple-100 text-purple-700",standard:"bg-gray-100 text-gray-700",luxury:"bg-yellow-100 text-yellow-700",penthouse:"bg-red-100 text-red-700"}[t.toLowerCase()]||"bg-gray-100 text-gray-700"}getRoomStatusColor(e){return{available:"text-green-600",occupied:"text-red-600",maintenance:"text-yellow-600",reserved:"text-blue-600"}[e.toLowerCase()]||"text-gray-600"}trackByRoomId(e,t){return t._id||e.toString()}getRoomTypeNameById(e){let t=this.roomTypes.value().find(i=>i._id===e||i.id===e);return t?t.name:"Unknown"}getMinDate(){return this.reservationForm()?.get("checkInDate")?.value||null}getMaxDate(){return this.reservationForm()?.get("checkOutDate")?.value||null}calculateNumberOfNights(e,t){if(!e||!t)return 0;let i=new Date(e),s=new Date(t);i.setHours(0,0,0,0),s.setHours(0,0,0,0);let m=1440*60*1e3,c=Math.ceil((s.getTime()-i.getTime())/m);return Math.max(1,c)}onStayPeriodChange(e){let t=this.getRoomsFormArray();if(!t)return;let i=t.at(e),s=i?.get("stayPeriod"),m=i?.get("room")?.value;if(!s||!m)return;let c=s.get("from")?.value,u=s.get("to")?.value;if(!c||!u)return;let v=this.calculateNumberOfNights(c,u),D=i?.get("pricing"),V=(D?.get("pricePerNight")?.value||0)*v;if(s.patchValue({numberOfNights:v},{emitEvent:!1}),D?.patchValue({totalPrice:V,subtotal:V,total:V},{emitEvent:!0}),!this.rooms.value().find(_i=>_i._id===m))return;let Fe=this.reservationForm(),J=Fe?.get("checkInDate")?.value,fe=Fe?.get("checkOutDate")?.value;if(!J||!fe)return;let kt=new Date(c),Gt=new Date(u),bn=new Date(J),xn=new Date(fe);if(kt<bn||Gt>xn){this.snackBar.open("Room stay period must be within the reservation dates","Close",{duration:4e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["warning-snackbar"]}),s.patchValue({from:J,to:fe});return}this.checkRoomAvailability(m,c,u).then(_i=>{if(!_i){this.snackBar.open("Room is not available for the selected dates","Close",{duration:4e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["error-snackbar"]}),s.patchValue({from:J,to:fe});return}this.updateReservationDatesFromRooms()})}updateReservationDatesFromRooms(){}checkRoomAvailability(e,t,i){return new Promise(s=>{let m=this.storeStore.selectedStore()?._id;if(!m){s(!1);return}let c=new Date(t).toISOString().split("T")[0],u=new Date(i).toISOString().split("T")[0];this.roomsService.getAvailableRooms({storeId:m,checkInDate:c,checkOutDate:u}).subscribe({next:v=>{let D=v.some(M=>M._id===e);s(D)},error:()=>{s(!1)}})})}calculateTotalBreakdown(e){let t=this.getRoomsFormArray();return t?t.controls.reduce((i,s)=>{let m=s.get("pricing");if(!m)return i;switch(e){case"subtotal":return i+(m.get("totalPrice")?.value||0);case"serviceFee":let c=m.get("fees");return c?i+(c.get("serviceFee")?.value||0):i;case"cleaningFee":let u=m.get("fees");return u?i+(u.get("cleaningFee")?.value||0):i;case"resortFee":let v=m.get("fees");return v?i+(v.get("resortFee")?.value||0):i;case"otherFees":let D=m.get("fees");return D?i+(D.get("other")?.value||0):i;case"fees":let M=m.get("fees");return M?i+((M.get("serviceFee")?.value||0)+(M.get("cleaningFee")?.value||0)+(M.get("resortFee")?.value||0)+(M.get("other")?.value||0)):i;case"taxes":return i+(m.get("taxes")?.value||0);case"discount":return i+(m.get("discount")?.value||0);case"total":let V=m.get("totalPrice")?.value||0,P=(()=>{let fe=m.get("fees");return fe?(fe.get("serviceFee")?.value||0)+(fe.get("cleaningFee")?.value||0)+(fe.get("resortFee")?.value||0)+(fe.get("other")?.value||0):0})(),Fe=m.get("taxes")?.value||0,J=m.get("discount")?.value||0;return i+(V+P+Fe-J);default:return i}},0):0}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=N({type:o,selectors:[["app-room-details"]],inputs:{selectedRoomIds:[1,"selectedRoomIds"],reservation:[1,"reservation"]},outputs:{roomAssigned:"roomAssigned",roomChangeRequested:"roomChangeRequested"},features:[wt([{provide:Ui,useValue:"en-US"}])],decls:16,vars:3,consts:[["dateRangePicker",""],["appearance","outlined"],[1,"flex","justify-between","items-center","w-full"],[1,"flex","gap-2"],["matButton","filled","color","primary",3,"click"],[1,"material-icons-outlined"],[1,"flex","justify-center","items-center","py-8"],[3,"formGroup"],["diameter","40"],[1,"overflow-x-auto"],["formArrayName","rooms"],[1,"grid","gap-3","p-3","border-b","border-gray-200","items-center","text-xs","hover:bg-gray-50",2,"grid-template-columns","1.2fr 1fr 1.2fr 1fr 1fr 1.2fr 0.8fr",3,"formGroupName"],[1,"text-center","py-8","text-gray-500"],["appearance","outline",1,"w-full"],["formControlName","roomType",1,"text-xs",3,"selectionChange"],[3,"value"],["formControlName","room",1,"text-xs",3,"selectionChange"],["value",""],["matInput","","placeholder","Select or create guest","readonly","",1,"text-xs",3,"value"],["mat-icon-button","","matPrefix","","color","primary","type","button","matTooltip","Add or change guest",3,"click"],[1,"text-sm"],["formGroupName","guests",1,"flex","gap-2"],["appearance","outline",1,"flex-1"],["matInput","","type","number","formControlName","adults","min","1",1,"text-xs"],["matPrefix","",1,"text-sm"],["matInput","","type","number","formControlName","children","min","0",1,"text-xs"],["formGroupName","stayPeriod"],[3,"rangePicker","min","max"],["matStartDate","","formControlName","from","placeholder","Start date",1,"text-xs",3,"dateChange"],["matEndDate","","formControlName","to","placeholder","End date",1,"text-xs",3,"dateChange"],["matIconSuffix","",3,"for"],["formGroupName","pricing"],["matInput","","currencyMask","","formControlName","totalPrice","placeholder","0.00","readonly","",1,"text-xs","text-right","font-semibold",3,"options"],["matPrefix","",1,"text-gray-600"],["mat-icon-button","","matSuffix","","color","primary","type","button","matTooltip","Edit price",3,"click"],[1,"flex","justify-center","gap-2"],["type","button","mat-icon-button","","color","primary","matTooltip","Change room",1,"h-8","w-8"],["type","button","mat-icon-button","","color","warn","matTooltip","Remove room",1,"h-8","w-8",3,"click"],["type","button","mat-icon-button","","color","primary","matTooltip","Change room",1,"h-8","w-8",3,"click"],[1,"text-4xl","text-gray-300","mb-2"]],template:function(t,i){t&1&&(a(0,"mat-card",1)(1,"mat-card-header")(2,"div",2)(3,"div")(4,"mat-card-title"),r(5," Selected Rooms "),n(),a(6,"mat-card-subtitle"),r(7),n()(),a(8,"div",3)(9,"a",4),b("click",function(){return i.onCreateRoom()}),a(10,"mat-icon",5),r(11,"add"),n(),r(12," ADD MORE ROOM(S) "),n()()()(),a(13,"mat-card-content"),f(14,$o,2,0,"div",6)(15,Jo,7,3,"div",7),n()()),t&2&&(l(7),Ee(" ",i.totalRooms()," room(s) - Total Capacity: ",i.totalCapacity()," guest(s) "),l(7),h(i.rooms.isLoading()&&i.selectedRooms.isLoading()&&i.roomTypes.isLoading()?14:i.rooms.hasValue()?15:-1))},dependencies:[G,$,ue,$t,X,j,zi,q,pe,qe,Ht,O,ee,ie,ne,at,te,W,ae,oe,ke,rt,st,$e,B,be,L,de,Bt,I,H,bt,Ue,Se,dt,xe,He,ge,Ge,ye,Pe,Ke,ut,pt,gt,ft,nt,Vt,Ie,St,si,Dt,_e],styles:["[_nghost-%COMP%]{display:block}mat-card-header[_ngcontent-%COMP%]{padding-bottom:1rem;margin-bottom:1rem;border-bottom:1px solid #e5e7eb}"]})};function Yo(o,e){o&1&&(a(0,"mat-error"),r(1,"Payment method is required"),n())}function Qo(o,e){o&1&&(a(0,"mat-error"),r(1,"Status is required"),n())}var gi=class o{reservationForm=w(void 0);static \u0275fac=function(t){return new(t||o)};static \u0275cmp=N({type:o,selectors:[["payment-info"]],inputs:{reservationForm:[1,"reservationForm"]},decls:38,vars:3,consts:[["appearance","outlined"],[3,"formGroup"],["formGroupName","paymentInfo",1,"space-y-4","py-3"],["appearance","outline",1,"w-full"],["formControlName","method"],["value","cash"],["value","credit_card"],["value","debit_card"],["value","bank_transfer"],["value","check"],["value","mobile_payment"],["value","other"],["formControlName","status"],["value","pending"],["value","partial"],["value","paid"],["value","refunded"]],template:function(t,i){if(t&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),r(3," Payment Info "),n()(),a(4,"mat-card-content",1)(5,"div",2)(6,"mat-form-field",3)(7,"mat-label"),r(8,"Payment Method"),n(),a(9,"mat-select",4)(10,"mat-option",5),r(11,"Cash"),n(),a(12,"mat-option",6),r(13,"Credit Card"),n(),a(14,"mat-option",7),r(15,"Debit Card"),n(),a(16,"mat-option",8),r(17,"Bank Transfer"),n(),a(18,"mat-option",9),r(19,"Check"),n(),a(20,"mat-option",10),r(21,"Mobile Payment"),n(),a(22,"mat-option",11),r(23,"Other"),n()(),f(24,Yo,2,0,"mat-error"),n(),a(25,"mat-form-field",3)(26,"mat-label"),r(27,"Payment Method"),n(),a(28,"mat-select",12)(29,"mat-option",13),r(30,"Pending"),n(),a(31,"mat-option",14),r(32,"Partial"),n(),a(33,"mat-option",15),r(34,"Paid"),n(),a(35,"mat-option",16),r(36,"Refunded"),n()(),f(37,Qo,2,0,"mat-error"),n()()()()),t&2){let s,m;l(4),g("formGroup",i.reservationForm()),l(20),h(!((s=i.reservationForm())==null||(s=s.get("paymentMethod"))==null||(s=s.get("method"))==null)&&s.hasError("required")?24:-1),l(13),h(!((m=i.reservationForm())==null||(m=m.get("paymentMethod"))==null||(m=m.get("status"))==null)&&m.hasError("required")?37:-1)}},dependencies:[O,ee,ie,ne,te,I,ae,B,oe,rt,ge,Ge,ye,$,X,j,q,pe,qe,Ji],styles:["[_nghost-%COMP%]{display:block}"]})};var fi=class o{reservationForm=w(void 0);getReservationForm(){return this.reservationForm()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=N({type:o,selectors:[["app-special-requests"]],inputs:{reservationForm:[1,"reservationForm"]},decls:18,vars:1,consts:[["appearance","outlined"],[1,"space-y-4",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","specialRequests","placeholder","e.g., High floor, late arrival, anniversary celebration, dietary requirements...","rows","3",1,"text-sm"],["matInput","","formControlName","internalNotes","placeholder","e.g., Guest prefers quiet hours, previous complaints, VIP notes, maintenance issues...","rows","3",1,"text-sm"]],template:function(t,i){t&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),r(3," Special Requests & Notes "),n()(),a(4,"mat-card-content")(5,"div",1)(6,"mat-form-field",2)(7,"mat-label"),r(8,"Special Requests"),n(),C(9,"textarea",3),a(10,"mat-hint"),r(11,"Enter any special requests from the guest (visible to guest)"),n()(),a(12,"mat-form-field",2)(13,"mat-label"),r(14,"Internal Notes"),n(),C(15,"textarea",4),a(16,"mat-hint"),r(17,"Internal notes visible only to staff (not shown to guest)"),n()()()()()),t&2&&(l(5),g("formGroup",i.getReservationForm()))},dependencies:[G,$,ue,X,j,q,pe,O,ee,ie,ne,te,W,ae,oe,ke,B,be,I,Se],encapsulation:2})};function Xo(o,e){if(o&1&&(a(0,"mat-list-item")(1,"mat-icon",4),r(2,"warning"),n(),a(3,"div",5),r(4),n(),a(5,"div",6),r(6),n()()),o&2){let t=e.$implicit,i=p();l(4),k(i.formatFieldName(t)),l(2),k(i.formatFullPath(t))}}function ea(o,e){o&1&&(a(0,"mat-list-item")(1,"mat-icon",7),r(2,"check_circle"),n(),a(3,"div",5),r(4,"All fields are valid"),n()())}var hi=class o{data=_(ht);constructor(){}formatFieldName(e){let t=e.split("."),i=t[t.length-1];if(t.length>1&&!isNaN(Number(t[t.length-2]))){let s=parseInt(t[t.length-2]),m=this.camelCaseToTitleCase(i),c=t[0],u=this.getArrayContext(c,s);return`${m} ${u}`.trim()}return this.camelCaseToTitleCase(i||e)}getArrayContext(e,t){let s={sharers:m=>m===0?"(Primary Guest)":`(Guest #${m+1})`,rooms:m=>`(Room #${m+1})`,fees:m=>`(Fee Item #${m+1})`}[e];return s?s(t):""}camelCaseToTitleCase(e){return e.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase()).trim()}formatFullPath(e){let t=e.split("."),i=[];for(let s=0;s<t.length;s++){let m=t[s];if(!isNaN(Number(m)))continue;let c=this.getSectionName(m,s===0);c&&i.push(c)}for(let s=0;s<t.length-1;s++)if(!isNaN(Number(t[s+1]))){let m=t[s],c=parseInt(t[s+1]),u=this.getArrayContext(m,c);if(u){let v=i.findIndex(D=>D.toLowerCase().includes(m));v>=0&&i.splice(v+1,0,u)}}return i.length>0?i.join(" > "):e}getSectionName(e,t){return{guest:"Guest",checkInDate:"Check-in Date",checkOutDate:"Check-out Date",numberOfAdults:"Number of Adults",numberOfChildren:"Number of Children",pricing:"Pricing",subtotal:"Subtotal",taxes:"Taxes",fees:"Fees",serviceFee:"Service Fee",cleaningFee:"Cleaning Fee",resortFee:"Resort Fee",total:"Total",paid:"Paid Amount",balance:"Balance",sharers:"Room Sharers",rooms:"Rooms",room:"Room",assignedGuest:"Assigned Guest",stayPeriod:"Stay Period",guests:"Guests",pricePerNight:"Price Per Night",totalPrice:"Total Price"}[e]||this.camelCaseToTitleCase(e)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=N({type:o,selectors:[["app-validation-errors-dialog"]],decls:15,vars:3,consts:[["mat-dialog-title",""],["inline","",1,"align-middle"],["align","end"],["matButton","filled","color","primary","mat-dialog-close",""],["matListItemIcon",""],["matListItemTitle",""],["matListItemLine",""],["matListItemIcon","","color","accent"]],template:function(t,i){t&1&&(a(0,"div")(1,"h2",0)(2,"mat-icon",1),r(3,"error_outline"),n(),r(4),n(),a(5,"mat-dialog-content")(6,"p"),r(7),n(),a(8,"mat-list"),z(9,Xo,7,2,"mat-list-item",null,Ti),f(11,ea,5,0,"mat-list-item"),n()(),a(12,"mat-dialog-actions",2)(13,"button",3),r(14," Close "),n()()()),t&2&&(l(4),y(" ",i.data.title||"Validation Errors"," "),l(3),y(" ",i.data.message||"Please fix the following errors before submitting:"," "),l(2),Z(i.data.invalidControls),l(2),h(i.data.invalidControls.length===0?11:-1))},dependencies:[G,yt,an,Ct,_t,vt,L,de,I,H,Ie,mt,ct,jt,Kt,lt],encapsulation:2})};var _n=()=>["status","amount","type","description","performer","date"],ia=(o,e,t,i,s)=>({"text-green-600":o,"text-orange-500":e,"text-blue-600":t,"text-red-600":i,"text-purple-600":s}),na=(o,e,t,i,s)=>({"bg-green-50 text-green-700":o,"bg-orange-50 text-orange-700":e,"bg-blue-50 text-blue-700":t,"bg-red-50 text-red-700":i,"bg-purple-50 text-purple-700":s}),oa=(o,e)=>({"text-green-600":o,"text-red-600":e});function aa(o,e){o&1&&(a(0,"div",3)(1,"mat-icon",5),r(2,"swap_horiz"),n(),a(3,"p"),r(4,"No room changes have been made for this reservation."),n()())}function ra(o,e){o&1&&(a(0,"th",20),r(1,"Status"),n())}function sa(o,e){if(o&1&&(a(0,"td",21)(1,"mat-icon",22),r(2),n(),a(3,"mat-chip",23),r(4),n()()),o&2){let t=e.$implicit,i=p(2);l(),et(xi(6,ia,t.changeType==="upgrade",t.changeType==="downgrade",t.changeType==="lateral",t.changeType==="maintenance",t.changeType==="guest_request")),l(),y(" ",i.getChangeTypeIcon(t.changeType)," "),l(),et(xi(12,na,t.changeType==="upgrade",t.changeType==="downgrade",t.changeType==="lateral",t.changeType==="maintenance",t.changeType==="guest_request")),l(),y(" ",i.formatChangeType(t.changeType)," ")}}function la(o,e){o&1&&(a(0,"th",20),r(1,"Amount"),n())}function ma(o,e){if(o&1&&(a(0,"td",24)(1,"span"),r(2),R(3,"currency"),n(),a(4,"div",25),r(5),n()()),o&2){let t,i=e.$implicit,s=p(2);l(),et(Ai(10,oa,i.pricingDetails.difference<0,i.pricingDetails.difference>0)),l(),Ee(" ",i.pricingDetails.difference>=0?"+":"","",Q(3,5,i.pricingDetails.difference,(t=s.storeStore.selectedStore())==null?null:t.currency,"symbol","1.0-0")," "),l(3),k(i.pricingDetails.adjustmentType?s.formatAdjustmentType(i.pricingDetails.adjustmentType):"")}}function ca(o,e){o&1&&(a(0,"th",20),r(1,"Type"),n())}function da(o,e){if(o&1&&(a(0,"td",21)(1,"div",26),r(2),n(),a(3,"div",27),r(4),n()()),o&2){let t=e.$implicit,i=p(2);l(2),Ee("",t.fromRoom.roomNumber||"Room"," \u2192 ",t.toRoom.roomNumber||"Room"),l(2),Ee("",i.getRoomName(t.fromRoom)," \u2192 ",i.getRoomName(t.toRoom))}}function ua(o,e){o&1&&(a(0,"th",20),r(1,"Description"),n())}function pa(o,e){if(o&1&&(a(0,"div")(1,"span"),r(2),n()()),o&2){let t=p().$implicit;l(2),k(t.pricingDetails.adjustmentNotes)}}function ga(o,e){if(o&1&&(a(0,"td",21)(1,"span"),r(2),n(),f(3,pa,3,1,"div"),n()),o&2){let t=e.$implicit;l(2),k(t.reason),l(),h(t.pricingDetails.adjustmentNotes?3:-1)}}function fa(o,e){o&1&&(a(0,"th",28),r(1,"Performer"),n())}function ha(o,e){if(o&1&&(a(0,"td",29),r(1),n()),o&2){let t=e.$implicit,i=p(2);l(),y(" ",i.getPerformerName(t.performedBy)," ")}}function Ca(o,e){o&1&&(a(0,"th",28),r(1,"Date"),n())}function va(o,e){if(o&1&&(a(0,"td",29),r(1),R(2,"date"),n()),o&2){let t=e.$implicit;l(),y(" ",he(2,1,t.performedAt,"medium")," ")}}function _a(o,e){o&1&&C(0,"tr",30)}function ya(o,e){o&1&&C(0,"tr",31)}function ba(o,e){if(o&1&&(a(0,"div",4)(1,"table",6),me(2,7),Y(3,ra,2,0,"th",8)(4,sa,5,18,"td",9),ce(),me(5,10),Y(6,la,2,0,"th",8)(7,ma,6,13,"td",11),ce(),me(8,12),Y(9,ca,2,0,"th",8)(10,da,5,4,"td",9),ce(),me(11,13),Y(12,ua,2,0,"th",8)(13,ga,4,2,"td",9),ce(),me(14,14),Y(15,fa,2,0,"th",15)(16,ha,2,1,"td",16),ce(),me(17,17),Y(18,Ca,2,0,"th",15)(19,va,3,4,"td",16),ce(),Y(20,_a,1,0,"tr",18)(21,ya,1,0,"tr",19),n()()),o&2){let t=p();l(),g("dataSource",t.roomChanges()),l(19),g("matHeaderRowDef",tt(3,_n)),l(),g("matRowDefColumns",tt(4,_n))}}var Ci=class o{storeStore=_(K);reservation=w();roomChanges=F(()=>[...this.reservation()?.roomChanges||[]].sort((e,t)=>{let i=new Date(e.performedAt).getTime();return new Date(t.performedAt).getTime()-i}));getChangeTypeIcon(e){return{upgrade:"arrow_upward",downgrade:"arrow_downward",lateral:"swap_horiz",maintenance:"build",guest_request:"person"}[e]||"swap_horiz"}formatChangeType(e){return{upgrade:"Upgrade",downgrade:"Downgrade",lateral:"Lateral Move",maintenance:"Maintenance",guest_request:"Guest Request"}[e]||e}formatAdjustmentType(e){return{charged:"Charged",refunded:"Refunded",credited:"Credited",waived:"Waived",kept_original_rate:"Original Rate Kept"}[e]||e}getRoomName(e){return console.log("roomData:",e),e.room?.name?e.room.name:e.roomType?.name?e.roomType.name:""}getPerformerName(e){return e?typeof e=="string"?"Staff":e.firstName||e.lastName?`${e.firstName||""} ${e.lastName||""}`.trim():"Staff":"Unknown"}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=N({type:o,selectors:[["app-room-change-history"]],inputs:{reservation:[1,"reservation"]},decls:9,vars:3,consts:[["appearance","outlined",1,"mb-20!"],[1,"text-gray-500"],[1,"px-0!"],[1,"flex","flex-col","items-center","py-10","text-gray-400"],[1,"overflow-x-auto"],[1,"text-5xl","mb-2"],["mat-table","",1,"min-w-full","text-sm",3,"dataSource"],["matColumnDef","status"],["mat-header-cell","","class","px-4 py-3 text-left font-semibold text-gray-700",4,"matHeaderCellDef"],["mat-cell","","class","px-4 py-3",4,"matCellDef"],["matColumnDef","amount"],["mat-cell","","class","px-4 py-3 font-semibold",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","description"],["matColumnDef","performer"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","date"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"px-4","py-3","text-left","font-semibold","text-gray-700"],["mat-cell","",1,"px-4","py-3"],[1,"align-middle","text-xl"],[1,"ml-2","px-2","py-1","text-xs","font-medium"],["mat-cell","",1,"px-4","py-3","font-semibold"],[1,"text-xs","text-gray-400"],[1,"font-mono","text-xs","text-gray-700"],[1,"text-xs"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""]],template:function(t,i){t&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),r(3,"Room Change History"),n(),a(4,"mat-card-subtitle",1),r(5),n()(),a(6,"mat-card-content",2),f(7,aa,5,0,"div",3)(8,ba,22,5,"div",4),n()()),t&2&&(l(5),Ee(" ",i.roomChanges().length," change",i.roomChanges().length!==1?"s":""," recorded "),l(2),h(i.roomChanges().length===0?7:8))},dependencies:[G,O,ee,ie,ne,at,te,I,H,bt,rn,Se,Ue,en,ni,Wt,Zt,Xt,Jt,zt,ei,Yt,Qt,ti,ii,_e,it],encapsulation:2})};function xa(o,e){o&1&&(a(0,"div",2),C(1,"mat-progress-spinner",6),a(2,"span",7),r(3,"Loading transactions..."),n()())}function Sa(o,e){if(o&1&&(a(0,"div",3)(1,"div",8)(2,"mat-icon",9),r(3,"error"),n(),a(4,"div")(5,"h4",10),r(6,"Failed to load transactions"),n(),a(7,"p",11),r(8),n()()()()),o&2){let t,i=p();l(8),k(((t=i.error())==null?null:t.message)||"An error occurred while loading transactions.")}}function Fa(o,e){o&1&&C(0,"app-no-record",4)}function Ma(o,e){o&1&&(a(0,"th",26),r(1,"Date"),n())}function Ea(o,e){if(o&1&&(a(0,"td",27),r(1),R(2,"date"),n()),o&2){let t=e.$implicit;l(),y(" ",he(2,1,t.createdAt,"medium")," ")}}function Da(o,e){o&1&&(a(0,"th",28),r(1,"Amount"),n())}function Ra(o,e){if(o&1&&(a(0,"td",29),r(1),R(2,"currency"),n()),o&2){let t=e.$implicit,i=p(2);l(),y(" ",he(2,1,t.amount,i.getCurrencyFormat())," ")}}function Na(o,e){o&1&&(a(0,"th",26),r(1,"Type"),n())}function Ta(o,e){if(o&1&&(a(0,"td",27)(1,"span",30),r(2),R(3,"titlecase"),n()()),o&2){let t=e.$implicit,i=p(2);l(),g("ngClass",i.getTransactionTypeClass(t.type)),l(),y(" ",ze(3,2,t.type)," ")}}function ka(o,e){o&1&&(a(0,"th",26),r(1,"Method"),n())}function Ga(o,e){if(o&1&&(a(0,"td",27)(1,"span",31),r(2),R(3,"titlecase"),n()()),o&2){let t=e.$implicit;l(2),y(" ",ze(3,1,t.method)," ")}}function Ia(o,e){o&1&&(a(0,"th",26),r(1,"Notes"),n())}function Pa(o,e){if(o&1&&(a(0,"span",33),r(1),R(2,"slice"),n()),o&2){let t=p().$implicit;g("matTooltip",t.notes),l(),Ee(" ",Oi(2,3,t.notes,0,50),"",t.notes.length>50?"...":""," ")}}function wa(o,e){o&1&&(a(0,"span",34),r(1,"-"),n())}function Aa(o,e){if(o&1&&(a(0,"td",32),f(1,Pa,3,7,"span",33)(2,wa,2,0,"span",34),n()),o&2){let t=e.$implicit;l(),h(t.notes?1:2)}}function Oa(o,e){o&1&&(a(0,"th",28),r(1,"Balance After"),n())}function Ba(o,e){if(o&1&&(a(0,"td",29),r(1),R(2,"currency"),n()),o&2){let t=e.$implicit,i=p(2);et(t.balanceAfterTransaction>0?"text-red-600":"text-green-600"),l(),y(" ",he(2,3,t.balanceAfterTransaction,i.getCurrencyFormat())," ")}}function Va(o,e){o&1&&C(0,"tr",35)}function La(o,e){o&1&&C(0,"tr",36)}function qa(o,e){if(o&1&&(a(0,"table",5),me(1,12),Y(2,Ma,2,0,"th",13)(3,Ea,3,4,"td",14),ce(),me(4,15),Y(5,Da,2,0,"th",16)(6,Ra,3,4,"td",17),ce(),me(7,18),Y(8,Na,2,0,"th",13)(9,Ta,4,4,"td",14),ce(),me(10,19),Y(11,ka,2,0,"th",13)(12,Ga,4,3,"td",14),ce(),me(13,20),Y(14,Ia,2,0,"th",13)(15,Aa,3,1,"td",21),ce(),me(16,22),Y(17,Oa,2,0,"th",16)(18,Ba,3,6,"td",23),ce(),Y(19,Va,1,0,"tr",24)(20,La,1,0,"tr",25),n()),o&2){let t=p();g("dataSource",t.transactions()),l(19),g("matHeaderRowDef",t.displayedColumns),l(),g("matRowDefColumns",t.displayedColumns)}}var vi=class o{reservation=w.required();storeStore=_(K);reservationService=_(ai);reservationId=F(()=>this.reservation()._id);storeId=F(()=>this.storeStore.selectedStore()?._id||"");transactionsResource=Re({params:()=>({storeId:this.storeId(),reservationId:this.reservationId()}),stream:({params:e})=>!e.storeId||!e.reservationId?Ye([]):this.reservationService.getReservationTransactions(e.storeId,e.reservationId)});constructor(){Ae(()=>{this.reservation()&&this.transactionsResource.reload()})}transactions=F(()=>this.transactionsResource.value()||[]);isLoading=F(()=>this.transactionsResource.isLoading());error=F(()=>this.transactionsResource.error());displayedColumns=["date","amount","type","method","notes","balance"];getTransactionTypeClass(e){switch(e){case"payment":return"bg-green-100 text-green-800";case"refund":return"bg-red-100 text-red-800";case"adjustment":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}}getCurrencyFormat(){return this.storeStore.selectedStore()?.currency||"$"}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=N({type:o,selectors:[["app-reservation-transactions"]],inputs:{reservation:[1,"reservation"]},decls:9,vars:1,consts:[["appearance","outlined",1,"mb-20"],[1,"p-0!"],[1,"flex","justify-center","items-center","py-8"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4"],["icon","payment","title","No Transactions","message","No payment transactions recorded for this reservation yet."],["mat-table","",1,"w-full",3,"dataSource"],["diameter","40","mode","indeterminate"],[1,"ml-3","text-gray-600"],[1,"flex","items-start"],[1,"text-red-500","mr-3","mt-1"],[1,"text-red-800","font-medium"],[1,"text-red-700","text-sm","mt-1"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","amount"],["mat-header-cell","","class","text-right",4,"matHeaderCellDef"],["mat-cell","","class","text-right font-semibold",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","method"],["matColumnDef","notes"],["mat-cell","","class","text-gray-600",4,"matCellDef"],["matColumnDef","balance"],["mat-cell","","class","text-right font-semibold",3,"class",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","hover:bg-gray-50",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"text-right"],["mat-cell","",1,"text-right","font-semibold"],[1,"px-2","py-1","rounded","text-xs","font-semibold",3,"ngClass"],[1,"px-2","py-1","rounded","text-xs","font-semibold","bg-blue-100","text-blue-800"],["mat-cell","",1,"text-gray-600"],["matTooltipPosition","above",3,"matTooltip"],[1,"text-gray-400"],["mat-header-row",""],["mat-row","",1,"hover:bg-gray-50"]],template:function(t,i){t&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),r(3," Payment Transactions "),n()(),a(4,"mat-card-content",1),f(5,xa,4,0,"div",2)(6,Sa,9,1,"div",3)(7,Fa,1,0,"app-no-record",4)(8,qa,21,3,"table",5),n()()),t&2&&(l(5),h(i.isLoading()?5:i.error()?6:i.transactions().length===0?7:8))},dependencies:[G,At,ni,Wt,Zt,Xt,Jt,zt,ei,Yt,Qt,ti,ii,xe,He,I,H,L,Se,dt,O,ee,ie,ne,te,on,$i,qi,_e,it],encapsulation:2,changeDetection:0})};function $a(o,e){if(o&1&&(a(0,"h1",6),r(1," Edit Reservation "),n(),a(2,"p",7),r(3," Confirmation: "),a(4,"span",8),r(5),n()()),o&2){let t,i=p();l(5),k((t=i.reservation.value())==null?null:t.confirmationNumber)}}function Ha(o,e){if(o&1&&(a(0,"h1",6),r(1),n(),a(2,"p",7),r(3," Create a new guest reservation "),n()),o&2){let t=p();l(),y(" Create New ",t.bookingType()==="group"?"Group":"Single"," Reservation ")}}function Ua(o,e){if(o&1){let t=T();a(0,"a",13),b("click",function(){x(t);let s=p(2);return S(s.updateReservationStatus(s.ReservationStatus.CANCELLED))}),a(1,"mat-icon"),r(2,"cancel"),n(),r(3," Cancel "),n()}if(o&2){let t=p(2);g("disabled",t.statusUpdating()||t.isSubmitted())}}function Ka(o,e){if(o&1){let t=T();a(0,"button",13),b("click",function(){x(t);let s=p(2);return S(s.openRoomChangeDialog())}),a(1,"mat-icon"),r(2,"swap_horiz"),n(),r(3," Change Room "),n()}if(o&2){let t=p(2);g("disabled",t.statusUpdating()||t.isSubmitted())}}function ja(o,e){if(o&1){let t=T();a(0,"button",9),b("click",function(){x(t);let s=p(2);return S(s.updateReservationStatus(s.ReservationStatus.CONFIRMED))}),a(1,"mat-icon"),r(2,"verified"),n(),r(3," Confirm "),n()}if(o&2){let t=p(2);g("disabled",t.statusUpdating()||t.isSubmitted())}}function Wa(o,e){if(o&1){let t=T();a(0,"button",9),b("click",function(){x(t);let s=p(2);return S(s.reopenReservation())}),a(1,"mat-icon"),r(2,"redo"),n(),r(3," Re-open "),n()}if(o&2){let t=p(2);g("disabled",t.statusUpdating()||t.isSubmitted())}}function za(o,e){if(o&1){let t=T();a(0,"button",9),b("click",function(){x(t);let s=p(2);return S(s.updateReservationStatus(s.ReservationStatus.CHECKED_IN))}),a(1,"mat-icon"),r(2,"check_circle_outline"),n(),r(3," Check-in "),n()}if(o&2){let t=p(2);g("disabled",t.statusUpdating())}}function Za(o,e){if(o&1){let t=T();a(0,"button",9),b("click",function(){x(t);let s=p(2);return S(s.updateReservationStatus(s.ReservationStatus.CHECKED_OUT))}),a(1,"mat-icon"),r(2,"logout"),n(),r(3," Check-out "),n()}if(o&2){let t=p(2);g("disabled",t.statusUpdating())}}function Ja(o,e){if(o&1){let t=T();a(0,"a",9),b("click",function(){x(t);let s=p();return S(s.exportReservationToPDF())}),a(1,"mat-icon"),r(2),n(),r(3),n(),f(4,Ua,4,1,"a",10),a(5,"a",9),b("click",function(){x(t);let s=p();return S(s.payment())}),a(6,"mat-icon"),r(7,"payment"),n(),r(8," Payment "),n(),f(9,Ka,4,1,"button",10),f(10,ja,4,1,"button",11),f(11,Wa,4,1,"button",11),f(12,za,4,1,"button",11),f(13,Za,4,1,"button",11),a(14,"button",12),b("click",function(){x(t);let s=p();return S(s.onSubmit())}),a(15,"mat-icon"),r(16,"save"),n(),r(17," Save "),n()}if(o&2){let t,i,s,m,c,u=p();g("disabled",u.exportingPDF()||u.statusUpdating()||u.isSubmitted()),l(2),k(u.exportingPDF()?"download":"picture_as_pdf"),l(),y(" ",u.exportingPDF()?"Exporting...":"Export to PDF"," "),l(),h(((t=u.reservation.value())==null?null:t.status)!==u.ReservationStatus.CANCELLED&&((t=u.reservation.value())==null?null:t.status)!==u.ReservationStatus.NO_SHOW?4:-1),l(),g("disabled",u.isSubmitted()),l(4),h(u.canChangeRooms()&&u.isSingleBooking()?9:-1),l(),h(((i=u.reservation.value())==null?null:i.status)===u.ReservationStatus.PENDING||((i=u.reservation.value())==null?null:i.status)===u.ReservationStatus.RESERVED?10:-1),l(),h(((s=u.reservation.value())==null?null:s.status)===u.ReservationStatus.CHECKED_OUT||((s=u.reservation.value())==null?null:s.status)===u.ReservationStatus.CANCELLED||((s=u.reservation.value())==null?null:s.status)===u.ReservationStatus.NO_SHOW?11:-1),l(),h(((m=u.reservation.value())==null?null:m.status)===u.ReservationStatus.CONFIRMED?12:-1),l(),h(((c=u.reservation.value())==null?null:c.status)===u.ReservationStatus.CHECKED_IN?13:-1),l(),g("disabled",u.isSubmitted())}}function Ya(o,e){if(o&1){let t=T();a(0,"a",9),b("click",function(){x(t);let s=p();return S(s.payment())}),a(1,"mat-icon"),r(2,"payment"),n(),r(3," Payment "),n(),a(4,"a",14),b("click",function(){x(t);let s=p();return S(s.onSubmit())}),a(5,"mat-icon"),r(6,"event"),n(),r(7," Reserve "),n()}if(o&2){let t=p();g("disabled",t.isSubmitted()),l(4),g("disabled",t.isSubmitted())}}function Qa(o,e){if(o&1&&(a(0,"div",5),C(1,"mat-spinner",15),a(2,"span",16),r(3),n()()),o&2){let t=p();l(3),y(" ",t.isEditing()?"Loading reservation...":"Creating reservation..."," ")}}function Xa(o,e){if(o&1){let t=T();a(0,"div",17)(1,"div",27)(2,"mat-icon",28),r(3,"error"),n(),a(4,"div",29)(5,"h3",30),r(6,"Error"),n(),a(7,"p",31),r(8),n(),a(9,"button",32),b("click",function(){x(t);let s=p(2);return S(s.clearError())}),r(10,"Dismiss"),n()()()()}if(o&2){let t=p(2);l(8),k(t.reservation.error())}}function er(o,e){if(o&1){let t=T();a(0,"app-room-sharers",33),Pi("selectedGuestChange",function(s){x(t);let m=p(2);return Ii(m.selectedGuest,s)||(m.selectedGuest=s),S(s)}),b("selectedGuestChange",function(s){x(t);let m=p(2);return S(m.onSelectedGuestChange(s))})("sharerAdded",function(){x(t);let s=p(2);return S(s.onAddSharer())})("sharerEdited",function(s){x(t);let m=p(2);return S(m.onEditSharer(s))})("sharerDeleted",function(s){x(t);let m=p(2);return S(m.onDeleteSharer(s))}),n()}if(o&2){let t=p(2);Gi("selectedGuest",t.selectedGuest),g("quickReservation",t.quickReservation())("reservation",t.reservation.value())}}function tr(o,e){if(o&1){let t=T();a(0,"app-room-details",34),b("roomChangeRequested",function(s){x(t);let m=p(2);return S(m.openRoomChangeDialog(s))}),n()}if(o&2){let t=p(2);g("reservation",t.reservation.value())("selectedRoomIds",t.selectedRoomIds())}}function ir(o,e){if(o&1&&C(0,"app-room-change-history",26),o&2){let t=p(2);g("reservation",t.reservation.value())}}function nr(o,e){if(o&1&&C(0,"app-reservation-transactions",26),o&2){let t=p(2);g("reservation",t.reservation.value())}}function or(o,e){if(o&1){let t=T();a(0,"div",0),f(1,Xa,11,1,"div",17),a(2,"form",18),b("ngSubmit",function(){x(t);let s=p();return S(s.onSubmit())}),a(3,"div",19)(4,"app-guest-details",20),b("guestAdded",function(){x(t);let s=p();return S(s.onAddGuest())})("guestEdited",function(){x(t);let s=p();return S(s.onEditGuest())})("guestDeleted",function(){x(t);let s=p();return S(s.onDeleteGuest())})("guestSelected",function(s){x(t);let m=p();return S(m.onGuestSelected(s))}),n(),C(5,"app-stay-details",21)(6,"payment-info",22),f(7,er,1,3,"app-room-sharers",23)(8,tr,1,2,"app-room-details",24),C(9,"app-special-requests",25),f(10,ir,1,1,"app-room-change-history",26),f(11,nr,1,1,"app-reservation-transactions",26),n()()()}if(o&2){let t,i=p();l(),h(i.reservation.error()?1:-1),l(),g("formGroup",i.reservationForm),l(2),g("guest",i.selectedGuest()),l(),g("quickReservation",i.quickReservation())("isEditing",i.isEditing()),l(),g("reservationForm",i.reservationForm),l(),h(i.isSingleBooking()?7:8),l(2),g("reservationForm",i.reservationForm),l(),h(i.isEditing()&&(((t=i.reservation.value())==null||t.roomChanges==null?null:t.roomChanges.length)??0)>0?10:-1),l(),h(i.isEditing()?11:-1)}}var yn=class o{router=_(Hi);route=_(Ot);location=_(Li);fb=_(Te);reservationService=_(ai);roomsService=_(xt);guestService=_(we);authService=_(Lt);storeStore=_(K);snackBar=_(ot);cdr=_(Vi);dialog=_(je);destroy$=new Ve;reservationFormService=_(re);id=E(this.route.snapshot.paramMap.get("id"));isSubmitted=E(!1);quickReservationQuery=E(this.route.snapshot.queryParamMap.get("quickReservation"));statusUpdating=E(!1);exportingPDF=E(!1);ReservationStatus=Si;quickReservation=F(()=>{let e=this.quickReservationQuery();return e?JSON.parse(e):null});currentUser=A(this.authService.currentUser,{initialValue:null});selectedGuest=E(null);isEditing=F(()=>!!this.id());paymentRedirection=E(!1);constructor(){this.reservationFormService.setForm(this.reservationForm),this.route.queryParamMap.subscribe(e=>{let t=e.get("paymentRedirection");t&&this.paymentRedirection.set(!!t)})}bookingType=F(()=>this.isEditing()?this.reservationForm.get("bookingType")?.value:this.quickReservation()?.bookingType);isSingleBooking=F(()=>this.bookingType()==="single");selectedRoomIds=F(()=>this.isEditing()?this.reservation.hasValue()?this.reservation.value().rooms.map(e=>e.room._id):[]:this.quickReservation()?.selectedRoom||[]);exportReservationToPDF(){return ve(this,null,function*(){let e=this.reservation.value();if(e){this.exportingPDF.set(!0);try{let t=yield this.reservationService.exportReservationToPDF(e._id).toPromise();if(t){let i=window.URL.createObjectURL(t),s=document.createElement("a");s.href=i,s.download=`reservation-${e.confirmationNumber}.pdf`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(i),this.snackBar.open("Reservation details exported to PDF successfully!","Close",{duration:3e3})}}catch(t){console.error("Error exporting reservation to PDF:",t);let i=t instanceof Error?t.message:"Failed to export reservation to PDF";this.snackBar.open(i,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.exportingPDF.set(!1)}}})}reservationForm=this.fb.group({bookingType:[this.quickReservation()?.bookingType,[d.required]],guest:["",[d.required]],store:[this.storeStore.selectedStore()?._id||"",[d.required]],checkInDate:[new Date(this.quickReservation()?.checkInDate),[d.required]],checkOutDate:[new Date(this.quickReservation()?.checkOutDate),[d.required]],numberOfNights:[1,[d.required,d.min(1)]],bookingSource:["walk_in",[d.required]],createdBy:[this.currentUser()?._id,[d.required]],paymentInfo:this.fb.group({method:[{value:"cash",disabled:!0},[d.required]],status:[{value:"pending",disabled:!0},[d.required]]}),numberOfAdults:[1,[d.required,d.min(1)]],numberOfChildren:[0,[d.required,d.min(0)]],pricing:this.fb.group({subtotal:[0,[d.required,d.min(0)]],taxes:[0,[d.min(0)]],fees:this.fb.group({serviceFee:[0,[d.min(0)]],cleaningFee:[0,[d.min(0)]],resortFee:[0,[d.min(0)]],other:[0,[d.min(0)]]}),discounts:[0,[d.min(0)]],total:[0,[d.required,d.min(0)]],paid:[0,[d.min(0)]],balance:[0]}),specialRequests:["",[]],internalNotes:["",[]],sharers:this.fb.array([]),rooms:this.fb.array([])});availableRoomsResource=Re({params:()=>({checkIn:this.checkIn(),checkOut:this.checkOut()}),stream:({params:e})=>this.getAvailableRooms({checkIn:e.checkIn,checkOut:e.checkOut})});checkIn=A(this.reservationForm.get("checkInDate").valueChanges,{initialValue:this.reservationForm.get("checkInDate").value});checkOut=A(this.reservationForm.get("checkOutDate").valueChanges,{initialValue:this.reservationForm.get("checkOutDate").value});reservation=Re({params:()=>({id:this.id()}),stream:({params:e})=>this.getReservation(e.id).pipe(Xe(t=>(t&&(this.populateForm(t),this.paymentRedirection()&&this.showPaymentRequiredDialog(t)),t)))});reopenReservation(){return ve(this,null,function*(){let e=this.reservation.value();if(!e)return;if(e.status!=="cancelled"&&e.status!=="checked_out"&&e.status!=="no_show"){this.snackBar.open("Only cancelled, checked-out, or no-show reservations can be reopened","Close",{duration:5e3,panelClass:["error-snackbar"]});return}let t=this.storeStore.selectedStore()?._id;if(!t){this.snackBar.open("Store information not available","Close",{duration:5e3,panelClass:["error-snackbar"]});return}this.dialog.open(dn,{width:"400px",disableClose:!0,data:{storeId:t,actionDescription:"reopen this cancelled reservation",reservationId:e._id}}).afterClosed().subscribe(s=>ve(this,null,function*(){if(s&&s.authorized&&s.pin){this.statusUpdating.set(!0);try{let m=yield this.reservationService.reopenReservation(e._id,s.pin).toPromise();m&&(this.reservation.set(m),this.snackBar.open("Reservation reopened successfully","Close",{duration:3e3,panelClass:["success-snackbar"]}))}catch(m){console.error("Error reopening reservation:",m);let c="Failed to reopen reservation";(m instanceof Error&&m.message||m&&typeof m=="object"&&m.message)&&(c=m.message),this.snackBar.open(c,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.statusUpdating.set(!1)}}}))})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getSharersFormArray(){return this.reservationForm.controls.sharers}getRoomsFormArray(){return this.reservationForm.controls.rooms}getAvailableRooms(e){let t=this.storeStore.selectedStore()?._id,i=new Date(e.checkIn).toISOString().split("T")[0],s=new Date(e.checkOut).toISOString().split("T")[0];return!i||!s||!t?Ye([]):this.roomsService.getAvailableRooms({storeId:t,checkInDate:i,checkOutDate:s})}getReservation(e){return this.reservationService.getReservationById(e)}totalAmount=F(()=>{let e=this.reservationForm.get("subtotal")?.value||0,t=this.reservationForm.get("taxes")?.value||0,i=this.reservationForm.get("discount")?.value||0,s=e+t-i;return Math.max(0,s)});onAddGuest(){this.snackBar.open("Guest creation dialog will be implemented","Close",{duration:3e3})}onEditGuest(){this.selectedGuest()&&this.snackBar.open("Guest edit dialog will be implemented","Close",{duration:3e3})}onGuestSelected(e){this.selectedGuest.set(e),this.reservationForm.patchValue({guest:e._id}),this.isSingleBooking()&&this.getPrimaryGuest()&&(this.getPrimaryGuest()?.patchValue({guest:e._id,meta:e,guestType:"adult",checkInDate:this.checkIn(),checkOutDate:this.checkOut()}),this.getPrimaryRoom()?.patchValue({assignedGuest:e._id,assignedGuestName:this.guestService.getGuestName(e)})),this.snackBar.open(`Guest ${this.guestService.getGuestName(e)} selected`,"Close",{duration:2e3,panelClass:["success-snackbar"]})}onDeleteGuest(){let e=this.getSharersFormArray(),t=e.length>1&&Array.from({length:e.length-1},(i,s)=>e.at(s+1)).some(i=>i?.get("guest")?.value);if(this.isSingleBooking()&&t){this.snackBar.open("Cannot remove primary guest while there are other sharers assigned. Please remove sharers first.","Close",{duration:3e3,panelClass:["error-snackbar"]});return}this.selectedGuest.set(null),this.getPrimaryGuest()?.patchValue({guest:null,meta:null,guestType:null}),this.snackBar.open("Guest removed","Close",{duration:2e3,panelClass:["success-snackbar"]})}getPrimaryGuest(){return this.getSharersFormArray().length>0?this.getSharersFormArray().at(0):null}getPrimaryRoom(){return this.getRoomsFormArray().length>0?this.getRoomsFormArray().at(0):null}onSelectedGuestChange(e){}populateForm(e){this.reservationForm.patchValue({bookingType:e?.bookingType||"group",guest:e.guest._id,checkInDate:new Date(e.checkInDate),checkOutDate:new Date(e.checkOutDate),numberOfNights:e.numberOfNights,bookingSource:e.bookingSource,paymentInfo:{method:e.paymentInfo?.method||"cash",status:e.paymentInfo?.status||"pending"},numberOfAdults:e.numberOfAdults||1,numberOfChildren:e.numberOfChildren||0,pricing:{subtotal:e.pricing?.subtotal||0,taxes:e.pricing?.taxes||0,fees:{serviceFee:e.pricing?.fees?.serviceFee||0,cleaningFee:e.pricing?.fees?.cleaningFee||0,resortFee:e.pricing?.fees?.resortFee||0,other:e.pricing?.fees?.other||0},discounts:e.pricing?.discounts||0,total:e.pricing?.total||0,paid:e.pricing?.paid||0,balance:e.pricing?.balance||0},specialRequests:e.specialRequests||"",internalNotes:e.internalNotes||""}),e.guest&&this.selectedGuest.set(e.guest)}payment(){this.isEditing()?this.showPaymentRequiredDialog(this.reservation.value()):this.onSubmit(!0)}onSubmit(e){if(this.reservationForm.invalid){let m=this.getInvalidControls(this.reservationForm);this.dialog.open(hi,{data:{invalidControls:m,title:"Form Validation Errors",message:"Please fix the following errors before submitting:"},width:"500px",maxWidth:"90vw",disableClose:!1});return}if(!this.selectedGuest()){this.snackBar.open("Please select a guest","Close",{duration:3e3,panelClass:["error-snackbar"]});return}let i=this.reservationForm.getRawValue();if(!this.storeStore.selectedStore()?._id){this.snackBar.open("No store selected","Close",{duration:3e3,panelClass:["error-snackbar"]});return}this.isSubmitted.set(!0),this.isEditing()?this.updateReservation(i):this.createReservation(i,e)}createReservation(e,t){this.reservationService.createReservation(e).pipe(se(this.destroy$)).subscribe({next:i=>{this.isSubmitted.set(!1),this.snackBar.open("Reservation created successfully","Close",{duration:3e3,panelClass:["success-snackbar"]}),this.router.navigate(["../edit",i._id],{relativeTo:this.route}).then(()=>{t&&this.showPaymentRequiredDialog(i)})},error:i=>{this.isSubmitted.set(!1),console.error("Error creating reservation:",i),this.snackBar.open("Failed to create reservation. Please try again.","Close",{duration:3e3,panelClass:["error-snackbar"]})}})}updateReservation(e){let t=this.id();t&&this.reservationService.updateReservation(t,this.reservationForm.getRawValue()).pipe(se(this.destroy$)).subscribe({next:i=>{this.isSubmitted.set(!1),this.snackBar.open("Reservation updated successfully","Close",{duration:3e3,panelClass:["success-snackbar"]}),this.reservation.reload()},error:i=>{console.error("Error updating reservation:",i),this.isSubmitted.set(!1),this.snackBar.open("Failed to update reservation. Please try again.","Close",{duration:3e3,panelClass:["error-snackbar"]})}})}onAddSharer(){this.snackBar.open("Guest selection dialog will be implemented","Close",{duration:3e3})}onEditSharer(e){let{index:t,sharer:i}=e;this.snackBar.open(`Editing sharer at index ${t}`,"Close",{duration:3e3})}onDeleteSharer(e){let{index:t}=e;this.snackBar.open(`Sharer at index ${t} deleted`,"Close",{duration:2e3,panelClass:["success-snackbar"]})}performCheckOut(){return ve(this,null,function*(){let e=this.reservation.value();if(e){if(this.requiresPaymentBeforeCheckout(e)){this.showPaymentRequiredDialog(e);return}this.statusUpdating.set(!0);try{let t=yield this.reservationService.checkOutReservationWithRooms(e._id).toPromise();t&&(this.reservation.set(t),this.snackBar.open("Guest checked out successfully! Room status updated to cleaning.","Close",{duration:5e3}))}catch(t){console.error("Error during check-out:",t);let i=t instanceof Error?t.message:"Failed to check out guest";this.snackBar.open(i,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.statusUpdating.set(!1)}}})}requiresPaymentBeforeCheckout(e){let t=e.pricing.balance>0,i=e.paymentInfo?.status!=="paid";return t&&i}showPaymentRequiredDialog(e){let t={reservation:e,isCheckoutFlow:!0};this.dialog.open(gn,{data:t,width:"600px",maxWidth:"90vw",disableClose:!0}).afterClosed().subscribe(s=>{if(s?.confirmed){this.reservation.reload();let m=this.reservation.value();if(m&&m.pricing.balance<=0)this.snackBar.open("\u2713 Payment completed! Checkout is now available.","Close",{duration:5e3,panelClass:["success-snackbar"],horizontalPosition:"center",verticalPosition:"top"});else{let c=m?m.pricing.balance:0;this.snackBar.open(`\u26A0\uFE0F Checkout Requires Full Payment - Outstanding balance: ${this.storeStore.selectedStore()?.currency} ${c}. Please collect full payment before checkout.`,"Continue Collecting",{duration:0,panelClass:["warning-snackbar"],horizontalPosition:"center",verticalPosition:"top"}).onAction().subscribe(()=>{this.showPaymentRequiredDialog(m)})}}else{let m=this.reservation.value();m&&this.requiresPaymentBeforeCheckout(m)&&this.snackBar.open(`\u26A0\uFE0F Checkout Requires Full Payment - Outstanding balance: 
            ${this.storeStore.selectedStore()?.currency} ${m.pricing.balance}. Please collect full payment before checkout.`,"Close",{duration:5e3,panelClass:["warning-snackbar"],horizontalPosition:"center",verticalPosition:"top"})}})}getInvalidControls(e,t=""){let i=[];return Object.keys(e.controls).forEach(s=>{let m=e.get(s),c=t?`${t}.${s}`:s;m&&(m instanceof qt||m instanceof Nt?i.push(...this.getInvalidControls(m,c)):m.invalid&&i.push(c))}),i}updateReservationStatus(e){return ve(this,null,function*(){let t=this.reservation.value();if(!(!t||t.status===e)){if(e==="checked_in"){this.showCheckInDialog(t);return}if(e==="checked_out"){this.performCheckOut();return}(e==="cancelled"||e==="no_show")&&!confirm(`Are you sure you want to change the status to ${e}?`)||(yield this.performStatusUpdate(e))}})}performStatusUpdate(e){return ve(this,null,function*(){let t=this.reservation.value();if(t){this.statusUpdating.set(!0);try{let i={status:e},s=yield this.reservationService.updateReservation(t._id,i).toPromise();s&&(this.reservation.set(s),this.snackBar.open(`Reservation status updated to ${e}`,"Close",{duration:3e3,panelClass:["success-snackbar"]}))}catch(i){console.error("Error updating reservation status:",i);let s=i instanceof Error?i.message:"Failed to update reservation status";this.snackBar.open(s,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.statusUpdating.set(!1)}}})}showCheckInDialog(e){let t={reservation:e};this.dialog.open(pn,{data:t,width:"600px",maxWidth:"90vw",disableClose:!0}).afterClosed().subscribe(s=>{s?.confirmed&&this.performCheckIn(s)})}performCheckIn(e){return ve(this,null,function*(){let t=this.reservation.value();if(t){this.statusUpdating.set(!0);try{let i=yield this.reservationService.checkInReservationWithRooms(t._id,e).toPromise();i&&(this.reservation.set(i),this.snackBar.open("Guest checked in successfully! Room status updated to occupied.","Close",{duration:5e3}))}catch(i){console.error("Error during check-in:",i);let s=i instanceof Error?i.message:"Failed to check in guest";this.snackBar.open(s,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.statusUpdating.set(!1)}}})}canChangeRooms(){let e=this.reservation.value();if(!e)return!1;let t=e.status;return t&&!["checked_out","cancelled","no_show"].includes(t)}openRoomChangeDialog(e){return ve(this,null,function*(){let t=this.reservation.value();if(!t||!this.canChangeRooms()){this.snackBar.open("Cannot change rooms for this reservation","Close",{duration:3e3});return}this.dialog.open(un,{width:"500px",maxWidth:"95vw",disableClose:!0,data:{reservationId:t._id,currentRooms:t.rooms,currentRoomIndex:e,checkInDate:new Date(t.checkInDate).toISOString(),checkOutDate:new Date(t.checkOutDate).toISOString(),numberOfNights:t.numberOfNights,currency:this.storeStore.selectedStore()?.currency||"USD",actualCheckInDate:t.actualCheckInDate?new Date(t.actualCheckInDate).toISOString():void 0,reservationStatus:t.status}}).afterClosed().subscribe(s=>ve(this,null,function*(){if(s)try{(yield this.reservationService.changeRooms(t._id,s).toPromise())?.success&&(this.snackBar.open("Room changed successfully","Close",{duration:3e3}),this.reservation.reload())}catch(m){console.error("Error changing rooms:",m);let c=m?.error?.error||m?.error?.message||m?.message||"Failed to change rooms";this.snackBar.open(c,"Close",{duration:5e3})}}))})}onCancel(){this.location.back()}clearError(){}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=N({type:o,selectors:[["app-reservation-form"]],decls:14,vars:4,consts:[[1,"max-w-12xl","px-4"],[1,"flex","justify-between","items-center","py-4"],["matButton","","color","primary",3,"click"],[1,"mr-1",2,"font-size","18px","width","18px","height","18px"],[1,"flex","space-x-3"],[1,"flex","justify-center","items-center","py-12"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-600","mt-1"],[1,"font-mono","font-semibold","text-gray-900"],["matButton","outlined",3,"click","disabled"],["matButton","tonal",3,"disabled"],["matButton","outlined",3,"disabled"],["matButton","filled","color","primary","type","submit",3,"click","disabled"],["matButton","tonal",3,"click","disabled"],["matButton","filled","color","primary",3,"click","disabled"],["diameter","40"],[1,"ml-3","text-gray-600"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","mb-6"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","lg:grid-cols-4","gap-6"],[1,"lg:col-span-2",3,"guestAdded","guestEdited","guestDeleted","guestSelected","guest"],[3,"quickReservation","isEditing"],[3,"reservationForm"],[1,"lg:col-span-4",3,"selectedGuest","quickReservation","reservation"],[1,"lg:col-span-4",3,"reservation","selectedRoomIds"],[1,"lg:col-span-4",3,"reservationForm"],[1,"lg:col-span-4",3,"reservation"],[1,"flex"],[1,"text-red-500","mr-3"],[1,"flex-1"],[1,"text-red-800","font-medium"],[1,"text-red-700","text-sm","mt-1"],["mat-button","",1,"mt-2",3,"click"],[1,"lg:col-span-4",3,"selectedGuestChange","sharerAdded","sharerEdited","sharerDeleted","selectedGuest","quickReservation","reservation"],[1,"lg:col-span-4",3,"roomChangeRequested","reservation","selectedRoomIds"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"div",1)(2,"div")(3,"a",2),b("click",function(){return i.onCancel()}),a(4,"mat-icon",3),r(5,"arrow_back"),n(),r(6," Back to Reservations "),n(),f(7,$a,6,1)(8,Ha,4,1),n(),a(9,"div",4),f(10,Ja,18,11)(11,Ya,8,2),n()()(),f(12,Qa,4,1,"div",5),f(13,or,12,10,"div",0)),t&2&&(l(7),h(i.isEditing()?7:8),l(3),h(i.isEditing()?10:11),l(2),h(i.isEditing()&&i.reservation.isLoading()?12:-1),l(),h(i.reservation.hasValue()?13:-1))},dependencies:[G,$,Le,j,q,O,B,W,ge,L,de,I,H,Pe,xe,He,Vt,ci,di,ui,pi,gi,fi,Ci,vi],styles:["@media(max-width:768px){.grid[_ngcontent-%COMP%]{grid-template-columns:repeat(1,minmax(0,1fr))}.pricing-summary[_ngcontent-%COMP%]{margin-left:1rem;margin-right:1rem}}"]})};export{yn as ReservationFormComponent};
