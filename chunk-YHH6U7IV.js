import{a as Wt}from"./chunk-NVPRDFZM.js";import{a as Jt}from"./chunk-VQRQEB7B.js";import{a as Yt,b as Qt}from"./chunk-JWH6MPF3.js";import{a as Gt,b as qt,c as jt,g as Ht}from"./chunk-ROZP2TNQ.js";import{a as Kt}from"./chunk-R6677L7M.js";import{a as Tt,b as At,c as It,d as wt,e as Ft,f as Nt,g as Rt,h as Ut,i as zt,j as Vt,k as Bt}from"./chunk-72VJX2YS.js";import{a as Lt,b as $t}from"./chunk-DB3A7P3M.js";import{d as Ct}from"./chunk-SWNYNPHN.js";import{a as Ot,b as it}from"./chunk-TLN5MM36.js";import{b as j,c as H,d as L}from"./chunk-3BP5U2AG.js";import{a as Y,b as Q,e as ot,f as at,g as rt,h as J}from"./chunk-TXVLFBH3.js";import{c as kt}from"./chunk-ZBSG24BC.js";import{a as Dt}from"./chunk-RBYYFQHC.js";import{a as Et}from"./chunk-UPBHOZRL.js";import{a as G,b as nt,d as Mt,e as St,h as q}from"./chunk-27T6VRU4.js";import{B as Pt,C as V,E as B,b as w,d as b,g as F,h as N,m as R,n as bt,s as U,t as z,x as yt,y as vt}from"./chunk-LM7FYRY4.js";import{a as $,b as K}from"./chunk-EDESGICS.js";import{a as xt}from"./chunk-6UI2KQ7N.js";import{X as ht,Y as A,Z as I}from"./chunk-BVLPFG4Z.js";import{m as gt,n as ft,q as _t,r as et}from"./chunk-ETP2OZKZ.js";import{Bb as ct,Db as s,Eb as c,Gc as _,Hc as T,Ic as y,Jb as g,Kb as e,Lb as t,Mb as C,Oc as ut,Qb as D,Rb as O,Tb as Z,Xb as h,Ya as l,Zb as f,ca as u,ha as W,ia as X,ic as pt,lb as k,lc as tt,mc as n,nc as S,ob as st,oc as d,rb as M,ta as x}from"./chunk-KGWH6IHP.js";import{f as dt}from"./chunk-EQDQRRRY.js";var lt=class i{guestService=u(Wt);transform(a){return this.guestService.getGuestName(a)}static \u0275fac=function(o){return new(o||i)};static \u0275pipe=st({name:"getGuestName",type:i,pure:!0})};function le(i,a){i&1&&(e(0,"div",16)(1,"div",21)(2,"mat-icon",22),n(3,"warning"),t(),e(4,"span",23),n(5," Please confirm all room readiness requirements before proceeding. "),t()()())}var Xt=class i{dialogRef=u(Y);fb=u(V);data=u(Q);loading=x(!1);checkInForm=this.fb.group({isClean:[!1,b.requiredTrue],isMaintained:[!1,b.requiredTrue],amenitiesReady:[!1,b.requiredTrue],notes:[""]});get isFormValid(){return this.checkInForm.valid}get roomNumbers(){return this.data.reservation.rooms?this.data.reservation.rooms.map(a=>{let o=a.room;return typeof o=="string"?o:o.roomNumber||o._id}).join(", "):""}onCancel(){this.dialogRef.close({confirmed:!1})}onConfirm(){if(!this.isFormValid)return;let a=this.checkInForm.value,o={confirmed:!0,roomChecks:{isClean:a.isClean||!1,isMaintained:a.isMaintained||!1,amenitiesReady:a.amenitiesReady||!1},notes:a.notes||void 0};this.dialogRef.close(o)}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=k({type:i,selectors:[["app-check-in-confirmation-dialog"]],decls:46,vars:8,consts:[["mat-dialog-title",""],[1,"bg-gray-50","rounded-lg","p-4","mb-6"],[1,"font-semibold","text-gray-900","mb-3"],[1,"grid","grid-cols-2","gap-4","text-sm"],[1,"text-gray-600"],[1,"font-medium","text-gray-900"],[1,"space-y-4",3,"formGroup"],[1,"font-semibold","text-gray-900"],[1,"space-y-3"],[1,"flex","items-center","gap-3"],["formControlName","isClean","color","primary"],[1,"text-sm","text-gray-700"],["formControlName","isMaintained","color","primary"],["formControlName","amenitiesReady","color","primary"],["appearance","outline",1,"w-full","mt-6"],["matInput","","formControlName","notes","rows","3","placeholder","Any special notes or observations..."],[1,"bg-amber-50","border","border-amber-200","rounded-lg","p-3","mt-6"],["align","end"],["mat-button","",3,"click"],["matButton","filled","color","primary",3,"click","disabled"],[1,"mr-2"],[1,"flex","items-center","gap-2"],[1,"text-amber-600","text-sm"],[1,"text-xs","text-amber-800","font-medium"]],template:function(o,r){o&1&&(e(0,"h2",0),n(1),t(),e(2,"mat-dialog-content")(3,"div",1)(4,"h3",2),n(5,"Guest Information"),t(),e(6,"div",3)(7,"div")(8,"span",4),n(9,"Name:"),t(),e(10,"div",5),n(11),_(12,"getGuestName"),t()(),e(13,"div")(14,"span",4),n(15,"Room(s):"),t(),e(16,"div",5),n(17),t()()()(),e(18,"form",6)(19,"h3",7),n(20,"Room Readiness Checklist"),t(),e(21,"div",8)(22,"div",9),C(23,"mat-checkbox",10),e(24,"span",11),n(25,"Room is clean and housekeeping complete"),t()(),e(26,"div",9),C(27,"mat-checkbox",12),e(28,"span",11),n(29,"All maintenance issues resolved"),t()(),e(30,"div",9),C(31,"mat-checkbox",13),e(32,"span",11),n(33,"Amenities and supplies are stocked"),t()()(),e(34,"mat-form-field",14)(35,"mat-label"),n(36,"Check-in Notes (Optional)"),t(),C(37,"textarea",15),t()(),s(38,le,6,0,"div",16),t(),e(39,"mat-dialog-actions",17)(40,"button",18),h("click",function(){return r.onCancel()}),n(41,"Cancel"),t(),e(42,"button",19),h("click",function(){return r.onConfirm()}),e(43,"mat-icon",20),n(44,"check_circle"),t(),n(45," Confirm Check-In "),t()()),o&2&&(l(),d(" Confirm Check-In (",r.data.reservation.confirmationNumber,`)
`),l(10),S(T(12,6,r.data.reservation.guest)),l(6),S(r.roomNumbers),l(),g("formGroup",r.checkInForm),l(20),c(r.isFormValid?-1:38),l(4),g("disabled",!r.isFormValid||r.loading()))},dependencies:[J,ot,rt,at,I,A,K,$,Qt,Yt,j,q,G,L,H,B,R,w,F,N,z,U,et,lt],styles:[".check-in-dialog[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]   .mdc-checkbox[_ngcontent-%COMP%]{margin-right:8px}.check-in-dialog[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{background-color:#fafafa}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}"]})};function me(i,a){i&1&&(e(0,"mat-icon",28),n(1,"add_circle_outline"),t(),n(2," Add Transaction "))}function de(i,a){i&1&&(e(0,"mat-error"),n(1,"Amount is required"),t())}function se(i,a){i&1&&(e(0,"mat-error"),n(1,"Amount must be greater than 0"),t())}function ce(i,a){i&1&&(e(0,"mat-error"),n(1,"Amount cannot exceed balance due"),t())}function pe(i,a){i&1&&(e(0,"mat-error"),n(1,"Payment method is required"),t())}function ue(i,a){if(i&1){let o=Z();e(0,"button",44),h("click",function(){W(o);let m=f(2);return X(m.setAmount(100))}),n(1),_(2,"currency"),t()}if(i&2){let o,r=f(2);l(),d(" ",y(2,1,100,(o=r.storeStore.selectedStore())==null?null:o.currency)," ")}}function ge(i,a){if(i&1){let o=Z();e(0,"button",44),h("click",function(){W(o);let m=f(2);return X(m.setAmount(50))}),n(1),_(2,"currency"),t()}if(i&2){let o,r=f(2);l(),d(" ",y(2,1,50,(o=r.storeStore.selectedStore())==null?null:o.currency)," ")}}function fe(i,a){if(i&1){let o=Z();e(0,"div",29)(1,"mat-form-field",30)(2,"mat-label"),n(3,"Payment Amount"),t(),e(4,"span",31),n(5),t(),C(6,"input",32),s(7,de,2,0,"mat-error"),s(8,se,2,0,"mat-error"),s(9,ce,2,0,"mat-error"),t(),e(10,"mat-form-field",30)(11,"mat-label"),n(12,"Payment Method"),t(),e(13,"mat-select",33)(14,"mat-option",34),n(15,"Cash"),t(),e(16,"mat-option",35),n(17,"Credit/Debit Card"),t(),e(18,"mat-option",36),n(19,"Bank Transfer"),t(),e(20,"mat-option",37),n(21,"Mobile Money"),t(),e(22,"mat-option",38),n(23,"Check"),t(),e(24,"mat-option",39),n(25,"Online Payment"),t()(),s(26,pe,2,0,"mat-error"),t()(),e(27,"mat-form-field",30)(28,"mat-label"),n(29,"Reference Number (Optional)"),t(),C(30,"input",40),t(),e(31,"mat-form-field",30)(32,"mat-label"),n(33,"Notes (Optional)"),t(),C(34,"textarea",41),t(),e(35,"div")(36,"h4",42),n(37,"Quick Amounts"),t(),e(38,"div",43)(39,"button",44),h("click",function(){W(o);let m=f();return X(m.setAmount(m.balanceAmount()))}),n(40),_(41,"currency"),t(),s(42,ue,3,4,"button",45),s(43,ge,3,4,"button",45),t()()}if(i&2){let o,r,m,p,v,E,P=f();l(5),d("",(o=P.storeStore.selectedStore())==null?null:o.currency,"\xA0"),l(),g("max",P.balanceAmount()),l(),c((r=P.paymentForm.get("amount"))!=null&&r.hasError("required")?7:-1),l(),c((m=P.paymentForm.get("amount"))!=null&&m.hasError("min")?8:-1),l(),c((p=P.paymentForm.get("amount"))!=null&&p.hasError("max")?9:-1),l(17),c((v=P.paymentForm.get("method"))!=null&&v.hasError("required")?26:-1),l(14),d(" Full Balance (",y(41,9,P.balanceAmount(),(E=P.storeStore.selectedStore())==null?null:E.currency),") "),l(2),c(P.balanceAmount()>=100?42:-1),l(),c(P.balanceAmount()>=50?43:-1)}}function _e(i,a){i&1&&(e(0,"mat-error"),n(1,"Payment status is required"),t())}function Ce(i,a){i&1&&(e(0,"mat-error"),n(1,"Payment method is required"),t())}function he(i,a){if(i&1&&(e(0,"mat-error",51)(1,"strong"),n(2,'Cannot mark as "Paid in Full":'),t(),n(3," There is still an outstanding balance of "),e(4,"strong"),n(5),_(6,"currency"),t(),n(7,'. Please use "Partial Payment" status or record additional payments first. '),t()),i&2){let o,r=f(2);l(5),S(y(6,1,r.balanceAmount(),(o=r.storeStore.selectedStore())==null?null:o.currency))}}function xe(i,a){if(i&1&&(e(0,"mat-form-field",30)(1,"mat-label"),n(2,"Payment Status"),t(),e(3,"mat-select",46)(4,"mat-option",47),n(5,"Pending Payment"),t(),e(6,"mat-option",48),n(7,"Partial Payment"),t(),e(8,"mat-option",49),n(9,"Paid in Full"),t()(),s(10,_e,2,0,"mat-error"),t(),e(11,"mat-form-field",30)(12,"mat-label"),n(13,"Payment Method"),t(),e(14,"mat-select",33)(15,"mat-option",34),n(16,"Cash"),t(),e(17,"mat-option",35),n(18,"Credit/Debit Card"),t(),e(19,"mat-option",36),n(20,"Bank Transfer"),t(),e(21,"mat-option",37),n(22,"Mobile Money"),t(),e(23,"mat-option",38),n(24,"Check"),t(),e(25,"mat-option",39),n(26,"Online Payment"),t()(),s(27,Ce,2,0,"mat-error"),t(),e(28,"mat-form-field",30)(29,"mat-label"),n(30,"Transaction Reference (Optional)"),t(),C(31,"input",40),t(),e(32,"mat-form-field",30)(33,"mat-label"),n(34,"Payment Notes (Optional)"),t(),C(35,"textarea",50),t(),s(36,he,8,4,"mat-error",51)),i&2){let o,r,m,p=f();l(10),c((o=p.paymentForm.get("status"))!=null&&o.hasError("required")?10:-1),l(17),c((r=p.paymentForm.get("method"))!=null&&r.hasError("required")?27:-1),l(9),c(((m=p.paymentForm.get("status"))==null?null:m.value)==="paid"&&p.balanceAmount()>0?36:-1)}}function be(i,a){if(i&1&&(e(0,"mat-icon",28),n(1,"history"),t(),n(2)),i&2){let o=f();l(2),d(" History (",o.transactions().length,") ")}}function ye(i,a){if(i&1&&(e(0,"div",21)(1,"strong"),n(2,"\u26A0\uFE0F Note:"),t(),n(3),t()),i&2){let o=f();l(3),d(" ",o.loadError()," ")}}function ve(i,a){i&1&&(e(0,"div",22),C(1,"mat-progress-spinner",52),t())}function Pe(i,a){i&1&&(e(0,"div",23)(1,"mat-icon",53),n(2,"payment"),t(),e(3,"p"),n(4,"No transactions recorded yet"),t()())}function Me(i,a){i&1&&(e(0,"th",68),n(1,"Date"),t())}function Se(i,a){if(i&1&&(e(0,"td",69),n(1),_(2,"date"),t()),i&2){let o=a.$implicit;l(),d(" ",y(2,1,o.createdAt,"short")," ")}}function Ee(i,a){i&1&&(e(0,"th",70),n(1,"Amount"),t())}function De(i,a){if(i&1&&(e(0,"td",71),n(1),_(2,"currency"),t()),i&2){let o,r=a.$implicit,m=f(2);l(),d(" ",y(2,1,r.amount,(o=m.storeStore.selectedStore())==null?null:o.currency)," ")}}function Oe(i,a){i&1&&(e(0,"th",68),n(1,"Method"),t())}function ke(i,a){if(i&1&&(e(0,"td",69)(1,"span",72),n(2),_(3,"titlecase"),t()()),i&2){let o=a.$implicit;l(2),d(" ",T(3,1,o.method)," ")}}function Te(i,a){i&1&&(e(0,"th",68),n(1,"Type"),t())}function Ae(i,a){if(i&1&&(e(0,"td",69)(1,"span"),n(2),_(3,"titlecase"),t()()),i&2){let o=a.$implicit;l(),tt(o.type==="payment"?"px-2 py-1 bg-green-100 text-green-800 rounded text-xs":"px-2 py-1 bg-red-100 text-red-800 rounded text-xs"),l(),d(" ",T(3,3,o.type)," ")}}function Ie(i,a){i&1&&(e(0,"th",68),n(1,"Notes"),t())}function we(i,a){if(i&1&&(e(0,"td",73),n(1),t()),i&2){let o=a.$implicit;l(),d(" ",o.notes||"-"," ")}}function Fe(i,a){i&1&&(e(0,"th",70),n(1,"Balance After "),t())}function Ne(i,a){if(i&1&&(e(0,"td",74),n(1),_(2,"currency"),t()),i&2){let o,r=a.$implicit,m=f(2);l(),d(" ",y(2,1,r.balanceAfterTransaction,(o=m.storeStore.selectedStore())==null?null:o.currency)," ")}}function Re(i,a){i&1&&C(0,"tr",75)}function Ue(i,a){i&1&&C(0,"tr",76)}function ze(i,a){if(i&1&&(e(0,"table",24),D(1,54),M(2,Me,2,0,"th",55)(3,Se,3,4,"td",56),O(),D(4,57),M(5,Ee,2,0,"th",58)(6,De,3,4,"td",59),O(),D(7,60),M(8,Oe,2,0,"th",55)(9,ke,4,3,"td",56),O(),D(10,61),M(11,Te,2,0,"th",55)(12,Ae,4,5,"td",56),O(),D(13,62),M(14,Ie,2,0,"th",55)(15,we,2,1,"td",63),O(),D(16,64),M(17,Fe,2,0,"th",58)(18,Ne,3,4,"td",65),O(),M(19,Re,1,0,"tr",66)(20,Ue,1,0,"tr",67),t()),i&2){let o=f();g("dataSource",o.transactions()),l(19),g("matHeaderRowDef",o.displayedColumns),l(),g("matRowDefColumns",o.displayedColumns)}}var oe=class i{fb=u(V);dialogRef=u(Y);data=u(Q);storeStore=u(Dt);reservationService=u(Jt);authService=u(xt);currentUser=kt(this.authService.currentUser,{initialValue:null});queryParamService=u(Kt);processing=x(!1);loadingTransactions=x(!1);transactions=x([]);loadError=x(null);totalAmount=x(0);paidAmount=x(0);balanceAmount=x(0);paymentPercentage=ut(()=>{let a=this.totalAmount(),o=this.paidAmount();return a>0?Math.round(o/a*100):0});displayedColumns=["date","amount","method","type","notes","balance"];paymentForm=this.fb.group({amount:[0],status:[""],method:["",b.required],reference:[""],notes:[""]});constructor(){if(this.data.reservation.status==="checked_out"&&!this.data.isCheckoutFlow){setTimeout(()=>{this.dialogRef.close({confirmed:!1,error:"Cannot edit payment information for checked-out reservations"})});return}}ngOnInit(){this.initializePaymentData(),this.loadTransactions()}initializePaymentData(){let a=this.data.reservation;this.totalAmount.set(a.pricing.total),this.paidAmount.set(a.pricing.paid),this.balanceAmount.set(a.pricing.balance);let o=this.getCurrentPaymentStatus(),r=a.paymentInfo?.method||"cash";this.data.isCheckoutFlow?(this.paymentForm.get("amount")?.setValidators([b.required,b.min(.01),b.max(this.balanceAmount()||0)]),this.paymentForm.patchValue({amount:this.balanceAmount()||0,method:r})):(this.paymentForm.get("status")?.setValidators([b.required]),this.paymentForm.patchValue({status:o,method:r})),this.paymentForm.updateValueAndValidity()}loadTransactions(){this.loadingTransactions.set(!0),this.loadError.set(null);let a=this.storeStore.selectedStore()?._id;if(!a){console.error("Store ID not available"),this.loadingTransactions.set(!1),this.loadError.set("Store information not available");return}this.reservationService.getReservationTransactions(a,this.data.reservation._id).subscribe({next:o=>{this.transactions.set(o),this.loadingTransactions.set(!1),this.loadError.set(null)},error:o=>{console.error("Failed to load transactions:",o),this.loadingTransactions.set(!1),o.status===404?this.loadError.set("Reservation not found. Please refresh and try again."):o.status===403?this.loadError.set("You do not have permission to view transactions for this reservation."):this.loadError.set("Failed to load transaction history. You can still record new payments."),this.transactions.set([])}})}getApprovedExtensionCost(){return this.data.reservation.extensions?this.data.reservation.extensions.filter(o=>o.status==="approved").reduce((o,r)=>o+(r.additionalCost||0),0):0}getApprovedExtensionNights(){return this.data.reservation.extensions?this.data.reservation.extensions.filter(o=>o.status==="approved").reduce((o,r)=>o+(r.additionalNights||0),0):0}hasApprovedExtensions(){return this.getApprovedExtensionCost()>0}getCurrentPaymentStatus(){let a=this.balanceAmount(),o=this.paidAmount();return a<=0?"paid":o>0?"partial":"pending"}getCurrentStatusClass(){switch(this.getCurrentPaymentStatus()){case"paid":return"text-green-600";case"partial":return"text-orange-600";case"pending":return"text-red-600";default:return"text-gray-600"}}canSave(){if(!this.paymentForm.valid)return!1;if(this.data.isCheckoutFlow)return this.paymentForm.valid;{let a=this.paymentForm.get("status")?.value,o=this.balanceAmount();if(a==="paid"&&o>0)return!1}return!0}setAmount(a){this.paymentForm.patchValue({amount:a})}onCancel(){this.queryParamService.remove("paymentRedirection"),this.dialogRef.close({confirmed:!1})}onConfirm(){if(this.queryParamService.remove("paymentRedirection"),this.canSave()){this.processing.set(!0);let a=this.storeStore.selectedStore()?._id;if(!a){console.error("Store ID not available"),this.processing.set(!1);return}let o,r=this.currentUser()?._id;this.data.isCheckoutFlow?o={reservation:this.data.reservation._id,amount:this.paymentForm.value.amount,method:this.paymentForm.value.method,type:"payment",notes:this.paymentForm.value.notes||void 0,processedBy:r}:o={reservation:this.data.reservation._id,amount:0,method:this.paymentForm.value.method,type:"adjustment",notes:this.paymentForm.value.notes||void 0,processedBy:r},this.reservationService.createTransaction(a,this.data.reservation._id,o).subscribe({next:m=>{this.processing.set(!1),this.loadTransactions(),this.dialogRef.close({confirmed:!0,paymentData:o,transaction:m})},error:m=>{console.error("Error creating transaction:",m),this.processing.set(!1);let p="Failed to process transaction. Please try again.";m.status===400?p=m.error?.message||"Invalid transaction data":m.status===404&&(p="Reservation not found"),alert(p)}})}}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=k({type:i,selectors:[["app-payment-update-dialog"]],decls:57,vars:31,consts:[["mat-dialog-title",""],[1,"mb-6","p-4","bg-gray-50","rounded-lg"],[1,"text-sm","font-semibold","mb-4"],[1,"grid","grid-cols-2","gap-4","mb-4"],[1,"bg-white","p-3","rounded","border","border-gray-200"],[1,"text-xs","text-gray-600","mb-1"],[1,"text-lg","font-bold"],[1,"text-lg","font-bold","text-green-600"],[1,"text-sm","font-bold"],[1,"mb-4"],[1,"flex","justify-between","items-center","mb-1"],[1,"text-xs","font-medium"],[1,"text-xs","font-semibold"],[1,"h-2","bg-gray-200","rounded-full","overflow-hidden"],[1,"h-full","bg-green-500","transition-all"],["animationDuration","300"],["label","Add Transaction",3,"disabled"],["mat-tab-label",""],[1,"space-y-4","mt-6",3,"formGroup"],["label","Transaction History",3,"disabled"],[1,"mt-6"],[1,"p-4","bg-yellow-50","border","border-yellow-200","rounded","text-sm","text-yellow-700","mb-4"],[1,"flex","justify-center","items-center","py-8"],[1,"text-center","py-8","text-gray-500"],["mat-table","",1,"w-full","mt-4",3,"dataSource"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"mr-2"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["appearance","outline",1,"w-full"],["matPrefix",""],["matInput","","type","number","step","0.01","min","0","formControlName","amount","placeholder","0.00",3,"max"],["formControlName","method"],["value","cash"],["value","card"],["value","bank_transfer"],["value","mobile_money"],["value","check"],["value","online"],["matInput","","formControlName","reference","placeholder","Transaction ID, Receipt number, etc."],["matInput","","formControlName","notes","rows","3","placeholder","Additional payment notes..."],[1,"text-sm","font-medium","mb-2"],[1,"flex","flex-wrap","gap-2"],["type","button","mat-stroked-button","",3,"click"],["type","button","mat-stroked-button",""],["formControlName","status"],["value","pending"],["value","partial"],["value","paid"],["matInput","","formControlName","notes","rows","3","placeholder","Additional notes about the payment..."],[1,"block"],["diameter","40","mode","indeterminate"],[1,"block","text-4xl","mb-2","opacity-30"],["matColumnDef","date"],["mat-header-cell","","class","text-xs font-semibold",4,"matHeaderCellDef"],["mat-cell","","class","text-sm",4,"matCellDef"],["matColumnDef","amount"],["mat-header-cell","","class","text-xs font-semibold text-right",4,"matHeaderCellDef"],["mat-cell","","class","text-sm text-right font-semibold",4,"matCellDef"],["matColumnDef","method"],["matColumnDef","type"],["matColumnDef","notes"],["mat-cell","","class","text-sm text-gray-600",4,"matCellDef"],["matColumnDef","balance"],["mat-cell","","class","text-sm text-right",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","border-b hover:bg-gray-50",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"text-xs","font-semibold"],["mat-cell","",1,"text-sm"],["mat-header-cell","",1,"text-xs","font-semibold","text-right"],["mat-cell","",1,"text-sm","text-right","font-semibold"],[1,"px-2","py-1","bg-blue-100","text-blue-800","rounded","text-xs"],["mat-cell","",1,"text-sm","text-gray-600"],["mat-cell","",1,"text-sm","text-right"],["mat-header-row",""],["mat-row","",1,"border-b","hover:bg-gray-50"]],template:function(o,r){if(o&1&&(e(0,"h2",0),n(1),t(),e(2,"mat-dialog-content")(3,"div",1)(4,"h3",2),n(5,"Payment Breakdown"),t(),e(6,"div",3)(7,"div",4)(8,"div",5),n(9,"Total Amount"),t(),e(10,"div",6),n(11),_(12,"currency"),t()(),e(13,"div",4)(14,"div",5),n(15,"Amount Paid"),t(),e(16,"div",7),n(17),_(18,"currency"),t()(),e(19,"div",4)(20,"div",5),n(21,"Balance Due"),t(),e(22,"div",6),n(23),_(24,"currency"),t()(),e(25,"div",4)(26,"div",5),n(27,"Payment Status"),t(),e(28,"div",8),n(29),_(30,"titlecase"),t()()(),e(31,"div",9)(32,"div",10)(33,"span",11),n(34,"Payment Progress"),t(),e(35,"span",12),n(36),t()(),e(37,"div",13),C(38,"div",14),t()()(),e(39,"mat-tab-group",15)(40,"mat-tab",16),M(41,me,3,0,"ng-template",17),e(42,"form",18),s(43,fe,44,12)(44,xe,37,3),t()(),e(45,"mat-tab",19),M(46,be,3,1,"ng-template",17),e(47,"div",20),s(48,ye,4,1,"div",21),s(49,ve,2,0,"div",22)(50,Pe,5,0,"div",23)(51,ze,21,3,"table",24),t()()()(),e(52,"mat-dialog-actions",25)(53,"a",26),h("click",function(){return r.onCancel()}),n(54,"Cancel"),t(),e(55,"a",27),h("click",function(){return r.onConfirm()}),n(56),t()()),o&2){let m,p,v;l(),d(" Transaction Management (",r.data.reservation.confirmationNumber,`)
`),l(10),d("",y(12,20,r.totalAmount(),(m=r.storeStore.selectedStore())==null?null:m.currency)," "),l(6),S(y(18,23,r.paidAmount(),(p=r.storeStore.selectedStore())==null?null:p.currency)),l(5),tt(r.balanceAmount()>0?"text-red-600":"text-green-600"),l(),d(" ",y(24,26,r.balanceAmount(),(v=r.storeStore.selectedStore())==null?null:v.currency)," "),l(5),tt(r.getCurrentStatusClass()),l(),d(" ",T(30,29,r.getCurrentPaymentStatus())," "),l(7),d("",r.paymentPercentage(),"%"),l(2),pt("width",r.paymentPercentage(),"%"),l(2),g("disabled",r.loadingTransactions()),l(2),g("formGroup",r.paymentForm),l(),c(r.data.isCheckoutFlow?43:44),l(2),g("disabled",r.loadingTransactions()),l(3),c(r.loadError()?48:-1),l(),c(r.loadingTransactions()?49:r.transactions().length===0?50:51),l(6),g("disabled",!r.canSave()||r.processing()),l(),d(" ",r.processing()?"Processing...":"Save Transaction"," ")}},dependencies:[et,B,R,w,bt,F,N,vt,yt,z,U,J,ot,rt,at,I,A,j,q,G,nt,Mt,L,H,$t,Lt,Ct,K,$,it,Ot,Ht,Gt,qt,jt,Bt,Tt,It,Rt,wt,At,Ut,Ft,Nt,zt,Vt,gt,_t,ft],styles:["mat-dialog-content[_ngcontent-%COMP%]{max-height:600px;padding:24px}mat-dialog-content[_ngcontent-%COMP%]   mat-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-list{border-bottom:1px solid #e5e7eb}mat-dialog-content[_ngcontent-%COMP%]   mat-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab{min-width:150px}.bg-gray-50[_ngcontent-%COMP%]{background-color:#f9fafb}.bg-gray-50[_ngcontent-%COMP%]   .bg-white[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #e5e7eb}.bg-gray-50[_ngcontent-%COMP%]   .bg-white[_ngcontent-%COMP%]   .text-gray-600[_ngcontent-%COMP%]{color:#4b5563;font-size:.75rem}.h-2[_ngcontent-%COMP%]{height:.5rem}.h-2.bg-gray-200[_ngcontent-%COMP%]{background-color:#e5e7eb}.h-2[_ngcontent-%COMP%]   .bg-green-500[_ngcontent-%COMP%]{background-color:#10b981}mat-form-field[_ngcontent-%COMP%]{display:block;margin-bottom:1rem}table[_ngcontent-%COMP%]{border-collapse:collapse}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.75rem;text-align:left;border-bottom:1px solid #e5e7eb;background-color:#f9fafb}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem;border-bottom:1px solid #e5e7eb}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f9fafb}.px-2.py-1.rounded[_ngcontent-%COMP%]{padding:.5rem;border-radius:.25rem;font-size:.75rem;font-weight:600}.bg-blue-100[_ngcontent-%COMP%]{background-color:#dbeafe;color:#0c4a6e}.bg-green-100[_ngcontent-%COMP%]{background-color:#dcfce7;color:#166534}.bg-red-100[_ngcontent-%COMP%]{background-color:#fee2e2;color:#991b1b}.opacity-30[_ngcontent-%COMP%]{opacity:.3}mat-progress-spinner[_ngcontent-%COMP%]{display:block;margin:0 auto}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #e5e7eb;display:flex;justify-content:flex-end;gap:1rem}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:100px}.text-xs[_ngcontent-%COMP%]{font-size:.75rem}.text-sm[_ngcontent-%COMP%]{font-size:.875rem}.text-lg[_ngcontent-%COMP%]{font-size:1.125rem}.font-medium[_ngcontent-%COMP%]{font-weight:500}.font-semibold[_ngcontent-%COMP%]{font-weight:600}.font-bold[_ngcontent-%COMP%]{font-weight:700}.text-gray-500[_ngcontent-%COMP%]{color:#6b7280}.text-gray-600[_ngcontent-%COMP%]{color:#4b5563}.text-green-600[_ngcontent-%COMP%]{color:#16a34a}.text-red-600[_ngcontent-%COMP%]{color:#dc2626}.text-blue-800[_ngcontent-%COMP%]{color:#1e40af}.text-blue-50[_ngcontent-%COMP%]{background-color:#eff6ff}.border-blue-200[_ngcontent-%COMP%]{border:1px solid #bfdbfe}.rounded-lg[_ngcontent-%COMP%]{border-radius:.5rem}.mb-1[_ngcontent-%COMP%]{margin-bottom:.25rem}.mb-2[_ngcontent-%COMP%]{margin-bottom:.5rem}.mb-4[_ngcontent-%COMP%]{margin-bottom:1rem}.mb-6[_ngcontent-%COMP%]{margin-bottom:1.5rem}.p-2[_ngcontent-%COMP%]{padding:.5rem}.p-3[_ngcontent-%COMP%]{padding:.75rem}.p-4[_ngcontent-%COMP%]{padding:1rem}.grid[_ngcontent-%COMP%]{display:grid}.gap-2[_ngcontent-%COMP%]{gap:.5rem}.gap-4[_ngcontent-%COMP%]{gap:1rem}.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}@media(max-width:768px){.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};function Ve(i,a){i&1&&(e(0,"mat-error"),n(1,"PIN is required"),t())}function Be(i,a){i&1&&(e(0,"mat-error"),n(1,"PIN must be at least 4 digits"),t())}function Ge(i,a){i&1&&(e(0,"mat-error"),n(1,"PIN cannot exceed 6 digits"),t())}function qe(i,a){i&1&&(e(0,"mat-error"),n(1,"Invalid PIN entered"),t())}function je(i,a){if(i&1&&(e(0,"div",12)(1,"mat-icon",20),n(2,"error"),t(),e(3,"div")(4,"h4",21),n(5,"Authorization Failed"),t(),e(6,"p",22),n(7),t()()()),i&2){let o=f();l(7),S(o.error())}}function He(i,a){i&1&&(e(0,"mat-icon",23),n(1,"sync"),t(),n(2," Verifying... "))}function Le(i,a){i&1&&(e(0,"mat-icon",24),n(1,"security"),t(),n(2," Authorize "))}var ae=class i{fb=u(V);dialogRef=u(Y);data=u(Q);storeService=u(Et);verifying=x(!1);error=x(null);showPin=x(!1);pinForm;constructor(){this.pinForm=this.fb.group({pin:["",[b.required,b.minLength(4),b.maxLength(6)]]})}get actionDescription(){return this.data.actionDescription||"perform this action"}get storeId(){return this.data.storeId}togglePinVisibility(){this.showPin.set(!this.showPin())}verifyPin(){return dt(this,null,function*(){if(this.pinForm.invalid){this.pinForm.markAllAsTouched();return}let a=this.pinForm.get("pin")?.value;if(a){this.verifying.set(!0),this.error.set(null);try{(yield this.storeService.validateStoreOwnerPin(this.storeId,a).toPromise())?this.dialogRef.close({authorized:!0,pin:a}):(this.error.set("Invalid PIN. Please check with the store owner for the correct PIN."),this.pinForm.get("pin")?.setErrors({invalid:!0}))}catch(o){console.error("Error validating PIN:",o),this.error.set("Unable to verify PIN. Please check your connection and try again.")}finally{this.verifying.set(!1)}}})}cancel(){this.dialogRef.close({authorized:!1})}onPinKeyPress(a){a.key==="Enter"&&this.pinForm.valid&&!this.verifying()&&this.verifyPin()}onPinInput(){this.error()&&(this.error.set(null),this.pinForm.get("pin")?.setErrors(null))}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=k({type:i,selectors:[["app-pin-authorization-dialog"]],decls:38,vars:13,consts:[[1,"pin-authorization-dialog"],[1,"dialog-header"],[1,"text-xl","font-semibold","text-gray-900","mb-2","flex","items-center","gap-3"],[1,"w-10","h-10","bg-gradient-to-r","from-red-500","to-red-600","rounded-full","flex","items-center","justify-center","shadow-lg"],[1,"text-white","text-lg"],[1,"text-gray-600","text-sm"],[1,"dialog-content","mt-6"],[3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","pin","placeholder","Enter 4-6 digit PIN","maxlength","6","autocomplete","off",1,"text-center","text-lg","tracking-wider","font-mono",3,"keypress","input","type"],["type","button","matSuffix","","mat-icon-button","",1,"text-gray-500","hover:text-gray-700",3,"click"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","flex","items-start","gap-3"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-4","flex","items-start","gap-3"],[1,"text-blue-500","mt-0.5","flex-shrink-0"],[1,"text-blue-800","font-medium","text-sm"],[1,"text-blue-700","text-sm","mt-1"],[1,"dialog-actions","mt-8","flex","items-center","justify-end","gap-3","pt-4","border-t","border-gray-200"],["type","button","mat-button","",1,"!text-gray-600","hover:!text-gray-800","hover:!bg-gray-50","!transition-colors","!px-6","!py-2",3,"click","disabled"],["type","button","mat-raised-button","","color","primary",1,"!bg-gradient-to-r","!from-blue-600","!to-blue-700","hover:!from-blue-700","hover:!to-blue-800","!text-white","!px-8","!py-2","!rounded-lg","!font-medium","!transition-all","!duration-200","!shadow-lg","hover:!shadow-xl","disabled:!opacity-50","disabled:!cursor-not-allowed",3,"click","disabled"],[1,"text-red-500","mt-0.5","flex-shrink-0"],[1,"text-red-800","font-medium","text-sm"],[1,"text-red-700","text-sm","mt-1"],[1,"!text-sm","mr-2","animate-spin"],[1,"!text-sm","mr-2"]],template:function(o,r){if(o&1&&(e(0,"div",0)(1,"div",1)(2,"h2",2)(3,"div",3)(4,"mat-icon",4),n(5,"security"),t()(),n(6," Store Owner Authorization Required "),t(),e(7,"p",5),n(8),t()(),e(9,"div",6)(10,"form",7),h("ngSubmit",function(){return r.verifyPin()}),e(11,"div",8)(12,"mat-form-field",9)(13,"mat-label"),n(14,"Store Owner PIN"),t(),e(15,"input",10),h("keypress",function(p){return r.onPinKeyPress(p)})("input",function(){return r.onPinInput()}),t(),e(16,"button",11),h("click",function(){return r.togglePinVisibility()}),e(17,"mat-icon"),n(18),t()(),s(19,Ve,2,0,"mat-error"),s(20,Be,2,0,"mat-error"),s(21,Ge,2,0,"mat-error"),s(22,qe,2,0,"mat-error"),t(),s(23,je,8,1,"div",12),e(24,"div",13)(25,"mat-icon",14),n(26,"info"),t(),e(27,"div")(28,"h4",15),n(29,"Security Notice"),t(),e(30,"p",16),n(31," Only the store owner should have access to this PIN. This authorization ensures that important actions are performed with proper approval. "),t()()()()()(),e(32,"div",17)(33,"button",18),h("click",function(){return r.cancel()}),n(34," Cancel "),t(),e(35,"button",19),h("click",function(){return r.verifyPin()}),s(36,He,3,0)(37,Le,3,0),t()()()),o&2){let m,p,v,E;l(8),d(" Enter the store owner PIN to authorize and ",r.actionDescription,". "),l(2),g("formGroup",r.pinForm),l(5),g("type",r.showPin()?"text":"password"),l(),ct("aria-label","Toggle PIN visibility"),l(2),S(r.showPin()?"visibility_off":"visibility"),l(),c((m=r.pinForm.get("pin"))!=null&&m.hasError("required")&&((m=r.pinForm.get("pin"))!=null&&m.touched)?19:-1),l(),c((p=r.pinForm.get("pin"))!=null&&p.hasError("minlength")&&((p=r.pinForm.get("pin"))!=null&&p.touched)?20:-1),l(),c((v=r.pinForm.get("pin"))!=null&&v.hasError("maxlength")&&((v=r.pinForm.get("pin"))!=null&&v.touched)?21:-1),l(),c((E=r.pinForm.get("pin"))!=null&&E.hasError("invalid")&&((E=r.pinForm.get("pin"))!=null&&E.touched)?22:-1),l(),c(r.error()?23:-1),l(10),g("disabled",r.verifying()),l(2),g("disabled",r.pinForm.invalid||r.verifying()),l(),c(r.verifying()?36:37)}},dependencies:[B,R,w,F,N,Pt,z,U,J,I,A,ht,j,q,G,nt,St,L,H,K,$,it],styles:[".pin-authorization-dialog[_ngcontent-%COMP%]{padding:24px;max-width:450px;min-width:400px}.dialog-header[_ngcontent-%COMP%]{text-align:center}.dialog-content[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]   .mdc-text-field--outlined[_ngcontent-%COMP%]{background-color:#f9fafb;border-color:#e5e7eb}.dialog-content[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]   .mdc-text-field--outlined[_ngcontent-%COMP%]:hover{border-color:#3b82f6}.dialog-content[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]   .mdc-text-field--outlined.mdc-text-field--focused[_ngcontent-%COMP%]{border-color:#2563eb;box-shadow:0 0 0 3px #3b82f61a}.dialog-actions[_ngcontent-%COMP%]   .mat-mdc-raised-button[_ngcontent-%COMP%]:disabled{box-shadow:none}.dialog-actions[_ngcontent-%COMP%]   .mat-mdc-raised-button[_ngcontent-%COMP%]:disabled:hover{transform:none}.dialog-actions[_ngcontent-%COMP%]   .mat-mdc-raised-button[_ngcontent-%COMP%]:not(:disabled):hover{transform:translateY(-1px);box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -2px #0000000d}@keyframes _ngcontent-%COMP%_pulse-security{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}.dialog-header[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse-security 2s infinite}.mat-mdc-form-field[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%], .mat-mdc-form-field[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{font-size:18px;letter-spacing:.2em}.mat-mdc-form-field[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%]::placeholder, .mat-mdc-form-field[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]::placeholder{font-size:14px;letter-spacing:normal}.bg-red-50[_ngcontent-%COMP%], .bg-blue-50[_ngcontent-%COMP%]{transition:all .2s ease-in-out}.bg-red-50[_ngcontent-%COMP%]:hover, .bg-blue-50[_ngcontent-%COMP%]:hover{box-shadow:0 2px 4px #0000001a}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media(max-width:480px){.pin-authorization-dialog[_ngcontent-%COMP%]{padding:16px;min-width:320px;max-width:95vw}.dialog-actions[_ngcontent-%COMP%]{flex-direction:column-reverse}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;margin:4px 0}}"]})};export{lt as a,Xt as b,oe as c,ae as d};
