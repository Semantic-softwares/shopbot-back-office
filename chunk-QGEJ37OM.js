import{a as We}from"./chunk-ETZMAH6M.js";import{c as Qe}from"./chunk-2BDZN2LB.js";import{a as Ge,b as He,c as je,d as Ue,e as ze,f as Je,g as Ke,h as j}from"./chunk-DCD2EY64.js";import{a as Oe}from"./chunk-2MXILDTK.js";import{a as Te,b as Ae,c as ke,d as Fe,e as Re,f as Ie,g as Ne,h as Pe,i as Be,j as Ve,k as $e}from"./chunk-OALZQOYE.js";import{a as Le}from"./chunk-H3VCUIUM.js";import{a as qe}from"./chunk-FB5OTQCF.js";import{a as De,b as we}from"./chunk-FBHRMY6R.js";import{a as re,b as le,c as me,d as se}from"./chunk-U2JZUY6D.js";import{a as ne}from"./chunk-VPPMXXDW.js";import{a as G}from"./chunk-E5OR4KMD.js";import{a as ye,b as O}from"./chunk-3IQG3KHZ.js";import{d as ee}from"./chunk-YK4A772F.js";import"./chunk-HXICWX3M.js";import"./chunk-4YIJHWNC.js";import{d as H}from"./chunk-EPNSEEH4.js";import"./chunk-MMNFDWV7.js";import"./chunk-CGDRKYIW.js";import{b as $,c as be,d as Ee}from"./chunk-IS37LNAK.js";import{a as xe,b as Se,e as Me,h as ve}from"./chunk-QJ2P7YZL.js";import"./chunk-LXD47U2C.js";import{a as q,b as L}from"./chunk-ZG44B3L4.js";import{A as he,B as Ce,b as de,d as v,g as ce,h as fe,m as pe,s as ue,t as _e,z as ge}from"./chunk-SZWYIW32.js";import"./chunk-CTT4BYCX.js";import{a as P,b as te}from"./chunk-V7ZBVJLR.js";import{a as ie}from"./chunk-5QCN73SK.js";import"./chunk-NQRUH5DO.js";import{a as ae,h as oe}from"./chunk-MESJBQC5.js";import"./chunk-QEF3JOQ3.js";import"./chunk-LSROOOYO.js";import"./chunk-7NDZPDVA.js";import{b as B,c as V}from"./chunk-OWLRGWNJ.js";import{$ as N,Y as R,Z as I}from"./chunk-OS2CYUJN.js";import{h as Y,l as Z}from"./chunk-WFEXX4HI.js";import{r as X}from"./chunk-U2P6GFP5.js";import{$a as l,Gb as c,Hb as f,Kb as K,Lb as Q,Mb as u,Nb as n,Ob as a,Pb as _,Tb as b,Ub as E,Wb as D,_b as g,ac as d,ea as p,ja as h,ka as C,kc as W,ob as F,oc as U,pc as o,qc as y,rc as x,ub as M,va as k}from"./chunk-IQSYHSID.js";import{a as z,b as J}from"./chunk-EQDQRRRY.js";var nt=(t,i)=>i._id;function at(t,i){t&1&&(n(0,"mat-error"),o(1,"Name is required"),a())}function ot(t,i){t&1&&(n(0,"mat-error"),o(1,"Email is required"),a())}function rt(t,i){t&1&&(n(0,"mat-error"),o(1,"Please enter a valid email"),a())}function lt(t,i){t&1&&(n(0,"mat-error"),o(1,"Phone number is required"),a())}function mt(t,i){t&1&&(n(0,"mat-error"),o(1,"Password is required"),a())}function st(t,i){t&1&&(n(0,"mat-error"),o(1,"Password must be at least 6 characters"),a())}function dt(t,i){if(t&1){let e=D();n(0,"mat-form-field",3)(1,"mat-label"),o(2,"Password"),a(),_(3,"input",18),n(4,"button",19),g("click",function(){h(e);let m=d();return C(m.hidePassword.set(!m.hidePassword()))}),n(5,"mat-icon"),o(6),a()(),c(7,mt,2,0,"mat-error"),c(8,st,2,0,"mat-error"),a()}if(t&2){let e,r,m=d();l(3),u("type",m.hidePassword()?"password":"text"),l(3),y(m.hidePassword()?"visibility_off":"visibility"),l(),f((e=m.staffForm.get("password"))!=null&&e.hasError("required")&&((e=m.staffForm.get("password"))!=null&&e.touched)?7:-1),l(),f((r=m.staffForm.get("password"))!=null&&r.hasError("minlength")&&((r=m.staffForm.get("password"))!=null&&r.touched)?8:-1)}}function ct(t,i){t&1&&(n(0,"mat-option",13),o(1,"Loading roles..."),a())}function ft(t,i){if(t&1&&(n(0,"mat-option",20)(1,"div",21)(2,"span"),o(3),a()()()),t&2){let e=i.$implicit;u("value",e._id),l(3),y(e.name)}}function pt(t,i){if(t&1&&K(0,ft,4,2,"mat-option",20,nt),t&2){let e=d();Q(e.rolesResource.value())}}function ut(t,i){t&1&&(n(0,"mat-error"),o(1,"Role is required"),a())}function _t(t,i){t&1&&_(0,"mat-spinner",17)}var w=class t{fb=p(ge);rolesService=p(ie);userService=p(G);dialogRef=p(Ge);snackBar=p(P);data=p(He);staffForm;saving=k(!1);hidePassword=k(!0);rolesResource=H({params:()=>({storeId:this.data.storeId}),stream:({params:i})=>this.rolesService.getAllRolesForStore(i.storeId)});isEditMode=k(!1);ngOnInit(){this.isEditMode.set(!!this.data.staff);let i=this.data.staff?.role?typeof this.data.staff.role=="string"?this.data.staff.role:this.data.staff.role._id:"";this.staffForm=this.fb.group({name:[this.data.staff?.name||"",v.required],email:[this.data.staff?.email||"",[v.required,v.email]],phoneNumber:[this.data.staff?.phoneNumber||"",v.required],gender:[this.data.staff?.gender||""],password:["",this.isEditMode()?[]:[v.required,v.minLength(6)]],role:[i,v.required]}),this.isEditMode()&&this.staffForm.removeControl("password")}getRoleIcon(i){let e=i.name.toLowerCase();return e.includes("admin")||e.includes("owner")?"admin_panel_settings":e.includes("manager")?"manage_accounts":e.includes("front desk")||e.includes("receptionist")?"support_agent":e.includes("housekeeper")||e.includes("housekeeping")?"cleaning_services":e.includes("accountant")||e.includes("finance")?"account_balance":"person"}saveStaff(){if(this.staffForm.invalid)return;this.saving.set(!0);let i=J(z({},this.staffForm.value),{stores:[this.data.storeId],pin:this.generatePin()});if(this.isEditMode())this.userService.updateMerchant(this.data.staff._id,i).subscribe({next:e=>{this.saving.set(!1),this.snackBar.open("Staff member updated successfully!","Close",{duration:3e3}),this.dialogRef.close(e)},error:e=>{this.saving.set(!1),this.snackBar.open(e.error?.message||"Failed to update staff member","Close",{duration:5e3})}});else{let e=this.staffForm.value.email,r=this.staffForm.value.phoneNumber;this.userService.validateEmailAndPhoneNumber({email:e,phoneNumber:r}).subscribe({next:m=>{let s=[];if(m.email||s.push("Email is already registered"),m.phoneNumber||s.push("Phone number is already registered"),s.length>0){this.saving.set(!1),this.snackBar.open(s.join(". "),"Close",{duration:5e3});return}this.userService.createMerchant(i).subscribe({next:S=>{this.saving.set(!1),this.snackBar.open("Staff member created successfully!","Close",{duration:3e3}),this.dialogRef.close(S)},error:S=>{this.saving.set(!1),this.snackBar.open(S.error?.message||"Failed to create staff member","Close",{duration:5e3})}})},error:m=>{this.saving.set(!1),this.snackBar.open("Error validating information. Please try again.","Close",{duration:5e3})}})}}generatePin(){return Math.floor(1e3+Math.random()*9e3).toString()}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=F({type:t,selectors:[["app-staff-dialog"]],decls:54,vars:13,consts:[["mat-dialog-title","",1,"!m-0","!p-6","!pb-4"],[1,"!px-6","!py-0"],[1,"flex","flex-col","gap-4",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter full name"],["matSuffix",""],["matInput","","formControlName","email","type","email","placeholder","Enter email address"],["matInput","","formControlName","phoneNumber","placeholder","Enter phone number"],["formControlName","gender"],["value","male"],["value","female"],["value","other"],["formControlName","role"],["disabled",""],["align","end",1,"!px-6","!py-4"],["mat-button","","mat-dialog-close","",3,"disabled"],["mat-flat-button","","color","primary",3,"click","disabled"],["diameter","20",1,"inline-block","mr-2"],["matInput","","formControlName","password","placeholder","Enter password",3,"type"],["mat-icon-button","","matSuffix","","type","button",3,"click"],[3,"value"],[1,"flex","items-center","gap-2"]],template:function(e,r){if(e&1&&(n(0,"h2",0),o(1),a(),n(2,"mat-dialog-content",1)(3,"form",2)(4,"mat-form-field",3)(5,"mat-label"),o(6,"Full Name"),a(),_(7,"input",4),n(8,"mat-icon",5),o(9,"person"),a(),c(10,at,2,0,"mat-error"),a(),n(11,"mat-form-field",3)(12,"mat-label"),o(13,"Email Address"),a(),_(14,"input",6),n(15,"mat-icon",5),o(16,"email"),a(),c(17,ot,2,0,"mat-error"),c(18,rt,2,0,"mat-error"),a(),n(19,"mat-form-field",3)(20,"mat-label"),o(21,"Phone Number"),a(),_(22,"input",7),n(23,"mat-icon",5),o(24,"phone"),a(),c(25,lt,2,0,"mat-error"),a(),n(26,"mat-form-field",3)(27,"mat-label"),o(28,"Gender"),a(),n(29,"mat-select",8)(30,"mat-option",9),o(31,"Male"),a(),n(32,"mat-option",10),o(33,"Female"),a(),n(34,"mat-option",11),o(35,"Other"),a()(),n(36,"mat-icon",5),o(37,"wc"),a()(),c(38,dt,9,4,"mat-form-field",3),n(39,"mat-form-field",3)(40,"mat-label"),o(41,"Role"),a(),n(42,"mat-select",12),c(43,ct,2,0,"mat-option",13)(44,pt,2,0),a(),n(45,"mat-icon",5),o(46,"admin_panel_settings"),a(),c(47,ut,2,0,"mat-error"),a()()(),n(48,"mat-dialog-actions",14)(49,"button",15),o(50,"Cancel"),a(),n(51,"button",16),g("click",function(){return r.saveStaff()}),c(52,_t,1,0,"mat-spinner",17),o(53),a()()),e&2){let m,s,S,T,A;l(),x(" ",r.isEditMode()?"Edit Staff Member":"Add Staff Member"," "),l(2),u("formGroup",r.staffForm),l(7),f((m=r.staffForm.get("name"))!=null&&m.hasError("required")&&((m=r.staffForm.get("name"))!=null&&m.touched)?10:-1),l(7),f((s=r.staffForm.get("email"))!=null&&s.hasError("required")&&((s=r.staffForm.get("email"))!=null&&s.touched)?17:-1),l(),f((S=r.staffForm.get("email"))!=null&&S.hasError("email")&&((S=r.staffForm.get("email"))!=null&&S.touched)?18:-1),l(7),f((T=r.staffForm.get("phoneNumber"))!=null&&T.hasError("required")&&((T=r.staffForm.get("phoneNumber"))!=null&&T.touched)?25:-1),l(13),f(r.isEditMode()?-1:38),l(5),f(r.rolesResource.isLoading()?43:44),l(4),f((A=r.staffForm.get("role"))!=null&&A.hasError("required")&&((A=r.staffForm.get("role"))!=null&&A.touched)?47:-1),l(2),u("disabled",r.saving()),l(2),u("disabled",r.staffForm.invalid||r.saving()),l(),f(r.saving()?52:-1),l(),x(" ",r.isEditMode()?"Update":"Create"," ")}},dependencies:[Ce,pe,de,ce,fe,_e,ue,j,Ue,ze,Ke,Je,N,I,R,$,ve,xe,Se,Me,Ee,be,V,B,O,ye,ee,L,q,te],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})};function gt(t,i){t&1&&(n(0,"div",2),_(1,"mat-spinner",3),n(2,"span",4),o(3,"Loading staff..."),a()())}function ht(t,i){t&1&&(n(0,"th",27),o(1,"Name"),a())}function Ct(t,i){if(t&1&&(n(0,"td",28)(1,"div",29)(2,"div",30)(3,"span",31),o(4),a()(),n(5,"span",32),o(6),a()()()),t&2){let e=i.$implicit;l(4),x(" ",e.name.charAt(0).toUpperCase()," "),l(2),y(e.name)}}function xt(t,i){t&1&&(n(0,"th",27),o(1,"Email"),a())}function St(t,i){if(t&1&&(n(0,"td",33),o(1),a()),t&2){let e=i.$implicit;l(),x(" ",e.email," ")}}function Mt(t,i){t&1&&(n(0,"th",27),o(1,"Phone"),a())}function vt(t,i){if(t&1&&(n(0,"td",33),o(1),a()),t&2){let e=i.$implicit;l(),x(" ",e.phoneNumber," ")}}function bt(t,i){t&1&&(n(0,"th",27),o(1,"Role"),a())}function Et(t,i){if(t&1&&(n(0,"span",36),o(1),a()),t&2){let e=d().$implicit,r=d(3);U(r.getRoleColor(e.role)),l(),x(" ",e.role.name," ")}}function yt(t,i){t&1&&(n(0,"span",35),o(1," No Role "),a())}function Dt(t,i){if(t&1&&(n(0,"td",28),c(1,Et,2,3,"span",34)(2,yt,2,0,"span",35),a()),t&2){let e=i.$implicit;l(),f(e.role?1:2)}}function wt(t,i){t&1&&(n(0,"th",27),o(1,"Status"),a())}function Tt(t,i){if(t&1&&(n(0,"td",28)(1,"span",36),o(2),a()()),t&2){let e=i.$implicit,r=d(3);l(),U(r.getStatusColor(e)),l(),x(" ",r.getStatusText(e)," ")}}function At(t,i){t&1&&(n(0,"th",37),o(1,"Actions"),a())}function kt(t,i){if(t&1){let e=D();n(0,"td",38)(1,"button",39)(2,"mat-icon"),o(3,"more_vert"),a()(),n(4,"mat-menu",null,0)(6,"button",40),g("click",function(){let m=h(e).$implicit,s=d(3);return C(s.openEditMerchantDialog(m))}),n(7,"mat-icon"),o(8,"edit"),a(),n(9,"span"),o(10,"Edit Details"),a()(),n(11,"button",40),g("click",function(){let m=h(e).$implicit,s=d(3);return C(s.openAssignRoleDialog(m))}),n(12,"mat-icon"),o(13,"admin_panel_settings"),a(),n(14,"span"),o(15,"Assign Role"),a()(),n(16,"button",40),g("click",function(){let m=h(e).$implicit,s=d(3);return C(s.toggleMerchantStatus(m))}),n(17,"mat-icon"),o(18),a(),n(19,"span"),o(20),a()(),_(21,"mat-divider"),n(22,"button",41),g("click",function(){let m=h(e).$implicit,s=d(3);return C(s.deleteMerchant(m))}),n(23,"mat-icon",42),o(24,"delete"),a(),n(25,"span"),o(26,"Delete"),a()()()()}if(t&2){let e=i.$implicit,r=W(5);l(),u("matMenuTriggerFor",r),l(17),y(e.deactivate?"toggle_on":"toggle_off"),l(2),y(e.deactivate?"Activate":"Deactivate")}}function Ft(t,i){t&1&&_(0,"tr",43)}function Rt(t,i){t&1&&_(0,"tr",44)}function It(t,i){if(t&1){let e=D();n(0,"mat-card",5)(1,"div",7)(2,"div")(3,"h2",8),o(4,"Staff & Merchants"),a(),n(5,"p",9),o(6,"Manage your hotel staff accounts and their role permissions"),a()(),n(7,"div",10)(8,"button",11)(9,"mat-icon"),o(10,"admin_panel_settings"),a(),o(11," Manage Roles "),a(),n(12,"button",12),g("click",function(){h(e);let m=d(2);return C(m.openAddMerchantDialog())}),n(13,"mat-icon"),o(14,"person_add"),a(),o(15," Add Staff "),a()()(),n(16,"table",13),b(17,14),M(18,ht,2,0,"th",15)(19,Ct,7,2,"td",16),E(),b(20,17),M(21,xt,2,0,"th",15)(22,St,2,1,"td",18),E(),b(23,19),M(24,Mt,2,0,"th",15)(25,vt,2,1,"td",18),E(),b(26,20),M(27,bt,2,0,"th",15)(28,Dt,3,1,"td",16),E(),b(29,21),M(30,wt,2,0,"th",15)(31,Tt,3,3,"td",16),E(),b(32,22),M(33,At,2,0,"th",23)(34,kt,27,3,"td",24),E(),M(35,Ft,1,0,"tr",25)(36,Rt,1,0,"tr",26),a()()}if(t&2){let e=d(2);l(8),u("routerLink","../roles"),l(8),u("dataSource",e.merchants.value()),l(19),u("matHeaderRowDef",e.displayedColumns),l(),u("matRowDefColumns",e.displayedColumns)}}function Nt(t,i){if(t&1){let e=D();n(0,"app-no-record",6)(1,"button",12),g("click",function(){h(e);let m=d(2);return C(m.openAddMerchantDialog())}),n(2,"mat-icon"),o(3,"person_add"),a(),o(4," Add Staff Member "),a()()}}function Pt(t,i){if(t&1&&c(0,It,37,4,"mat-card",5)(1,Nt,5,0,"app-no-record",6),t&2){let e=d();f(e.merchants.value().length>0?0:1)}}var Xe=class t{snackBar=p(P);dialog=p(je);storeStore=p(ne);userService=p(G);merchants=H({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:i})=>this.userService.getStoreMerchants(i.storeId)});displayedColumns=["name","email","phone","role","status","actions"];getRoleColor(i){if(!i)return"bg-gray-100 text-gray-700";let e=i.name.toLowerCase();return e.includes("admin")||e.includes("owner")?"bg-purple-100 text-purple-700":e.includes("manager")?"bg-blue-100 text-blue-700":e.includes("front desk")||e.includes("receptionist")?"bg-green-100 text-green-700":e.includes("housekeeper")||e.includes("housekeeping")?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}getStatusColor(i){return i.deactivate?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}getStatusText(i){return i.deactivate?"Inactive":"Active"}openAddMerchantDialog(){let i=this.storeStore.selectedStore()?._id;if(!i)return;this.dialog.open(w,{width:"500px",data:{storeId:i}}).afterClosed().subscribe(r=>{r&&this.merchants.reload()})}openEditMerchantDialog(i){let e=this.storeStore.selectedStore()?._id;if(!e)return;this.dialog.open(w,{width:"500px",data:{storeId:e,staff:i}}).afterClosed().subscribe(m=>{m&&this.merchants.reload()})}openAssignRoleDialog(i){this.openEditMerchantDialog(i)}toggleMerchantStatus(i){let e=!i.deactivate;this.userService.updateMerchant(i._id,{deactivate:e}).subscribe({next:()=>{this.snackBar.open(`${i.name} ${e?"deactivated":"activated"}`,"Close",{duration:3e3}),this.merchants.reload()},error:r=>{this.snackBar.open(r.error?.message||"Failed to update status","Close",{duration:5e3})}})}deleteMerchant(i){this.dialog.open(We,{width:"400px",data:{title:"Delete Staff Member",message:`Are you sure you want to delete ${i.name}? This action cannot be undone.`}}).afterClosed().subscribe(r=>{r&&this.userService.deleteMerchant(i._id).subscribe({next:()=>{this.snackBar.open(`${i.name} deleted`,"Close",{duration:3e3}),this.merchants.reload()},error:m=>{this.snackBar.open(m.error?.message||"Failed to delete staff member","Close",{duration:5e3})}})})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=F({type:t,selectors:[["app-staff-account"]],decls:3,vars:1,consts:[["menu","matMenu"],[1,"py-6"],[1,"flex","justify-center","items-center","py-12"],["diameter","40"],[1,"ml-3","text-gray-600"],["appearance","outlined",1,"py-3"],["icon","people_outline","title","No Staff Members","message","Add your first staff member to get started"],[1,"flex","p-3","flex-col","sm:flex-row","justify-between","items-start","sm:items-center","gap-4","mb-6"],[1,"text-xl","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"flex","gap-3"],["mat-stroked-button","","color","primary",3,"routerLink"],["mat-flat-button","","color","primary",3,"click"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","class","!py-4 !px-6 !font-semibold",4,"matHeaderCellDef"],["mat-cell","","class","!py-4 !px-6",4,"matCellDef"],["matColumnDef","email"],["mat-cell","","class","!py-4 !px-6 text-gray-600",4,"matCellDef"],["matColumnDef","phone"],["matColumnDef","role"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-cell","","class","!py-4 !px-6 !font-semibold text-right",4,"matHeaderCellDef"],["mat-cell","","class","!py-4 !px-6 text-right",4,"matCellDef"],["mat-header-row","","class","bg-gray-50",4,"matHeaderRowDef"],["mat-row","","class","hover:bg-gray-50",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"!py-4","!px-6","!font-semibold"],["mat-cell","",1,"!py-4","!px-6"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","bg-blue-100","rounded-full","flex","items-center","justify-center"],[1,"text-blue-600","font-medium"],[1,"font-medium","text-gray-900"],["mat-cell","",1,"!py-4","!px-6","text-gray-600"],[1,"px-3","py-1","rounded-full","text-sm","font-medium",3,"class"],[1,"px-3","py-1","rounded-full","text-sm","font-medium","bg-gray-100","text-gray-500"],[1,"px-3","py-1","rounded-full","text-sm","font-medium"],["mat-header-cell","",1,"!py-4","!px-6","!font-semibold","text-right"],["mat-cell","",1,"!py-4","!px-6","text-right"],["mat-icon-button","","matTooltip","More actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",1,"!text-red-600",3,"click"],[1,"!text-red-600"],["mat-header-row","",1,"bg-gray-50"],["mat-row","",1,"hover:bg-gray-50"]],template:function(e,r){e&1&&(n(0,"div",1),c(1,gt,4,0,"div",2)(2,Pt,2,1),a()),e&2&&(l(),f(r.merchants.isLoading()?1:r.merchants.hasValue()?2:-1))},dependencies:[X,he,oe,ae,N,I,R,V,B,$e,Te,ke,Ne,Fe,Ae,Pe,Re,Ie,Be,Ve,Qe,se,le,re,me,j,L,q,Le,qe,O,$,we,De,Oe,Z,Y],styles:["[_nghost-%COMP%]{display:block}"]})};export{Xe as StaffAccount};
