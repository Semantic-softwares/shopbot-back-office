import{a as $}from"./chunk-I72O5CVQ.js";import{a as H,b as et,c as tt,d as at}from"./chunk-3TORYUNM.js";import{a as it,b as ot,c as nt,d as rt,g as O}from"./chunk-HZXTKPL4.js";import{a as Ze}from"./chunk-KBSD74U4.js";import"./chunk-MS4AQ6UA.js";import{a as Ve,b as Ae,c as He,d as Oe,e as $e,f as Ge,g as je,h as Qe,i as ze,j as We,k as Ue,l as Ke,m as B,n as Xe}from"./chunk-BVWLPZES.js";import{a as Ye,b as Je}from"./chunk-RENLSJYB.js";import{a as V,b as A}from"./chunk-LFBEZKOS.js";import{c as ue}from"./chunk-OFYZMDZT.js";import{c as N,d as Te,e as Ie,f as Le,j as P,k as R,l as k,m as F}from"./chunk-FG7UG2DW.js";import{a as ve,c as De,e as we}from"./chunk-FMUIVSDW.js";import{a as T,b as fe}from"./chunk-7ZWB6L3W.js";import"./chunk-Z3XTQNGP.js";import{a as Re,b as ke,c as Fe,d as qe}from"./chunk-6GBZAIAA.js";import"./chunk-GN3UZQS3.js";import{c as Be}from"./chunk-ZZPE5R5A.js";import"./chunk-NGPRL7P4.js";import{b as I,d as f,g as L,h as ge,l as Ee,m as ye,o as Ce,r as he,u as Se,w as Me,x as be,y as xe}from"./chunk-YEMWNPSS.js";import{a as Ne,b as Pe}from"./chunk-DPX2PQEH.js";import{N as _e,P as q,j as ce,k as D,l as w}from"./chunk-OEJYD25C.js";import"./chunk-SRUZJ52Y.js";import{i as se,p as v}from"./chunk-A4R7E6RR.js";import{Bb as C,Cb as h,Eb as Q,Fb as z,Gb as W,Hb as p,Ib as o,Jb as i,Kb as u,Lb as E,Mb as y,Ob as re,Sb as g,Tb as x,Xb as U,Y as oe,Yb as K,Za as l,Zb as Y,bc as ae,ea as s,gc as a,hc as _,ic as J,jb as b,ka as G,kc as le,la as j,lc as me,mc as pe,pb as d,qc as de,ua as ne}from"./chunk-XUJKWI36.js";import"./chunk-EQDQRRRY.js";function ft(e,t){e&1&&(o(0,"mat-error"),a(1," Name is required "),i())}function _t(e,t){if(e&1&&(o(0,"mat-option",9),a(1),i()),e&2){let r=t.$implicit;p("value",r),l(),_(r)}}function gt(e,t){e&1&&(o(0,"mat-error"),a(1," Gender is required "),i())}function Et(e,t){if(e&1&&(o(0,"mat-option",9),a(1),i()),e&2){let r=t.$implicit;p("value",r),l(),_(r)}}function yt(e,t){e&1&&(o(0,"mat-error"),a(1," Role is required "),i())}function Ct(e,t){e&1&&(o(0,"mat-hint"),a(1,"Role cannot be changed for owners"),i())}function ht(e,t){e&1&&(o(0,"mat-error"),a(1," Email is required "),i())}function St(e,t){e&1&&(o(0,"mat-error"),a(1," Please enter a valid email address "),i())}function Mt(e,t){e&1&&(o(0,"mat-error"),a(1," Phone number is required "),i())}function bt(e,t){e&1&&(o(0,"mat-error"),a(1," PIN is required "),i())}function xt(e,t){e&1&&(o(0,"mat-error"),a(1," PIN must be exactly 4 digits "),i())}function vt(e,t){e&1&&u(0,"mat-spinner",17)}var S=class e{storeStore=s(q);fb=s(Me);userService=s($);snackBar=s(T);dialogRef=s(it);data=s(ot);sessionStorage=s(_e);isSubmitting=ne(!1);roles=["Owner","Cashier","Waiter","Admin","Courier","Kitchen"];genders=["Male","Female"];isEdit=this.data.isEdit;form=this.fb.group({name:["",[f.required]],gender:["",[f.required]],email:["",[f.required,f.email]],phoneNumber:["",[f.required]],pin:["",[f.required,f.minLength(4),f.maxLength(4)]],role:[{value:"",disabled:this.isRoleDisabled()},[f.required]],store:[this.storeStore.selectedStore()?._id,f.required]});isRoleDisabled(){return this.isEdit&&this.data.employee?.role==="Owner"}ngOnInit(){this.isEdit&&this.data.employee&&this.form.patchValue(this.data.employee)}onSubmit(){if(this.form.valid){this.isSubmitting.set(!0);let t=this.form.getRawValue();(this.isEdit?this.userService.updateMerchant(this.data.employee._id,t):this.userService.createMerchant(t)).subscribe({next:n=>{if(n?.err?.code===11e3&&n?.err?.keyPattern){let m="Error creating/updating employee";n.err.keyPattern.email?m="Email already exists":n.err.keyPattern.phoneNumber&&(m="Phone number already exists"),this.snackBar.open(m,"Close",{duration:3e3}),this.isSubmitting.set(!1);return}this.snackBar.open(`Employee ${this.isEdit?"updated":"created"} successfully`,"Close",{duration:3e3}),this.dialogRef.close(!0)},error:n=>{this.snackBar.open(`Error ${this.isEdit?"updating":"creating"} employee`,"Close",{duration:3e3}),this.isSubmitting.set(!1)}})}}onCancel(){this.dialogRef.close()}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=b({type:e,selectors:[["app-employee-dialog"]],decls:50,vars:15,consts:[[1,"p-6"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter employee name"],[4,"ngIf"],[1,"grid","grid-cols-2","gap-4"],["formControlName","gender"],[3,"value"],["formControlName","role"],["matInput","","formControlName","email","type","email","placeholder","Enter email address"],["matInput","","formControlName","phoneNumber","placeholder","Enter phone number"],["matInput","","formControlName","pin","type","password","maxlength","4","placeholder","Enter 4-digit PIN"],[1,"flex","justify-end","space-x-2","mt-6","pt-4","border-t","border-gray-200"],["mat-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",1,"mr-2"]],template:function(r,n){if(r&1&&(o(0,"div",0)(1,"h2",1),a(2),i(),o(3,"form",2),g("ngSubmit",function(){return n.onSubmit()}),o(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),a(7,"Name"),i(),u(8,"input",5),d(9,ft,2,0,"mat-error",6),i(),o(10,"div",7)(11,"mat-form-field",4)(12,"mat-label"),a(13,"Gender"),i(),o(14,"mat-select",8),z(15,_t,2,2,"mat-option",9,Q),i(),d(17,gt,2,0,"mat-error",6),i(),o(18,"mat-form-field",4)(19,"mat-label"),a(20,"Role"),i(),o(21,"mat-select",10),z(22,Et,2,2,"mat-option",9,Q),i(),d(24,yt,2,0,"mat-error",6),C(25,Ct,2,0,"mat-hint"),i()(),o(26,"mat-form-field",4)(27,"mat-label"),a(28,"Email"),i(),u(29,"input",11),d(30,ht,2,0,"mat-error",6)(31,St,2,0,"mat-error",6),i(),o(32,"div",7)(33,"mat-form-field",4)(34,"mat-label"),a(35,"Phone Number"),i(),u(36,"input",12),d(37,Mt,2,0,"mat-error",6),i(),o(38,"mat-form-field",4)(39,"mat-label"),a(40,"PIN"),i(),u(41,"input",13),d(42,bt,2,0,"mat-error",6)(43,xt,2,0,"mat-error",6),i()()(),o(44,"div",14)(45,"button",15),g("click",function(){return n.onCancel()}),a(46,"Cancel"),i(),o(47,"button",16),C(48,vt,1,0,"mat-spinner",17),a(49),i()()()()),r&2){let m,c,X,Z,ee,te,ie,M;l(2),J(" ",n.isEdit?"Edit Employee":"Create New Employee"," "),l(),p("formGroup",n.form),l(6),p("ngIf",(m=n.form.get("name"))==null?null:m.hasError("required")),l(6),W(n.genders),l(2),p("ngIf",(c=n.form.get("gender"))==null?null:c.hasError("required")),l(5),W(n.roles),l(2),p("ngIf",(X=n.form.get("role"))==null?null:X.hasError("required")),l(),h(n.isRoleDisabled()?25:-1),l(5),p("ngIf",(Z=n.form.get("email"))==null?null:Z.hasError("required")),l(),p("ngIf",(ee=n.form.get("email"))==null?null:ee.hasError("email")),l(6),p("ngIf",(te=n.form.get("phoneNumber"))==null?null:te.hasError("required")),l(5),p("ngIf",(ie=n.form.get("pin"))==null?null:ie.hasError("required")),l(),p("ngIf",((M=n.form.get("pin"))==null?null:M.hasError("minlength"))||((M=n.form.get("pin"))==null?null:M.hasError("maxlength"))),l(2),p("disabled",n.isSubmitting()),l(2),p("disabled",!n.form.valid||n.isSubmitting()),l(),h(n.isSubmitting()?48:-1),l(),J(" ",n.isEdit?"Update":"Create"," ")}},dependencies:[v,se,O,rt,w,D,R,P,N,Ie,Te,F,k,Je,Ye,ue,xe,ye,I,L,ge,Se,Ce,he,A,V],encapsulation:2})};var Dt=()=>[5,10,25,100];function wt(e,t){e&1&&(o(0,"div",10),u(1,"mat-spinner",14),i())}function Tt(e,t){e&1&&u(0,"app-no-record",11)}function It(e,t){e&1&&u(0,"app-no-record",12)}function Lt(e,t){e&1&&(o(0,"th",28),a(1,"Name"),i())}function Nt(e,t){if(e&1&&(o(0,"td",29),a(1),i()),e&2){let r=t.$implicit;l(),_(r.name)}}function Pt(e,t){e&1&&(o(0,"th",28),a(1,"Gender"),i())}function Rt(e,t){if(e&1&&(o(0,"td",29),a(1),i()),e&2){let r=t.$implicit;l(),_(r.gender)}}function kt(e,t){e&1&&(o(0,"th",28),a(1,"Email"),i())}function Ft(e,t){if(e&1&&(o(0,"td",29),a(1),i()),e&2){let r=t.$implicit;l(),_(r.email)}}function qt(e,t){e&1&&(o(0,"th",28),a(1,"Phone"),i())}function Bt(e,t){if(e&1&&(o(0,"td",29),a(1),i()),e&2){let r=t.$implicit;l(),_(r.phoneNumber)}}function Vt(e,t){e&1&&(o(0,"th",28),a(1,"Role"),i())}function At(e,t){if(e&1&&(o(0,"td",29),a(1),i()),e&2){let r=t.$implicit;l(),_(r.role)}}function Ht(e,t){e&1&&(o(0,"th",30),a(1,"Actions"),i())}function Ot(e,t){if(e&1){let r=re();o(0,"td",29)(1,"button",31)(2,"mat-icon"),a(3,"more_vert"),i()(),o(4,"mat-menu",null,0)(6,"button",32),g("click",function(){let m=G(r).$implicit,c=x(2);return j(c.editEmployee(m))}),o(7,"mat-icon"),a(8,"edit"),i(),o(9,"span"),a(10,"Edit"),i()(),o(11,"button",32),g("click",function(){let m=G(r).$implicit,c=x(2);return j(c.deleteEmployee(m))}),o(12,"mat-icon"),a(13,"delete"),i(),o(14,"span"),a(15,"Delete"),i()()()()}if(e&2){let r=ae(5);l(),p("matMenuTriggerFor",r)}}function $t(e,t){e&1&&u(0,"tr",33)}function Gt(e,t){e&1&&u(0,"tr",34)}function jt(e,t){if(e&1&&(o(0,"div",13)(1,"table",15),E(2,16),d(3,Lt,2,0,"th",17)(4,Nt,2,1,"td",18),y(),E(5,19),d(6,Pt,2,0,"th",17)(7,Rt,2,1,"td",18),y(),E(8,20),d(9,kt,2,0,"th",17)(10,Ft,2,1,"td",18),y(),E(11,21),d(12,qt,2,0,"th",17)(13,Bt,2,1,"td",18),y(),E(14,22),d(15,Vt,2,0,"th",17)(16,At,2,1,"td",18),y(),E(17,23),d(18,Ht,2,0,"th",24)(19,Ot,16,1,"td",18),y(),d(20,$t,1,0,"tr",25)(21,Gt,1,0,"tr",26),i(),u(22,"mat-paginator",27),i()),e&2){let r=x();l(),p("dataSource",r.dataSource),l(19),p("matHeaderRowDef",r.displayedColumns),l(),p("matRowDefColumns",r.displayedColumns),l(),p("pageSizeOptions",de(4,Dt))}}var lt=class e{dialog=s(nt);snackBar=s(T);userService=s($);storeStore=s(q);displayedColumns=["name","gender","email","phoneNumber","role","actions"];dataSource;searchText="";paginator;sort;employees=Be({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:t})=>this.userService.getStoreMerchants(t.storeId).pipe(oe(r=>{this.dataSource=new Ke(r),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}))});applyFilter(t){let r=t.target.value;this.dataSource.filter=r.trim().toLowerCase()}openDialog(){this.dialog.open(S,{width:"800px",data:{isEdit:!1}}).afterClosed().subscribe(r=>{r&&this.employees.reload()})}editEmployee(t){this.dialog.open(S,{width:"800px",data:{isEdit:!0,employee:t}}).afterClosed().subscribe(n=>{n&&this.employees.reload()})}deleteEmployee(t){if(t.role==="Owner"){this.snackBar.open("Cannot delete an owner","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"});return}this.dialog.open(at,{width:"350px",data:{message:`Are you sure you want to delete ${t.name}?`}}).afterClosed().subscribe(n=>{n&&this.userService.deleteMerchant(t._id).subscribe({next:()=>{this.snackBar.open("Employee deleted successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.employees.reload()},error:()=>{this.snackBar.open("Error deleting employee","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})})}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=b({type:e,selectors:[["app-list-employees"]],viewQuery:function(r,n){if(r&1&&(U(B,5),U(H,5)),r&2){let m;K(m=Y())&&(n.paginator=m.first),K(m=Y())&&(n.sort=m.first)}},decls:19,vars:2,consts:[["menu","matMenu"],[1,"employees-container","!bg-white"],[1,"!bg-white"],[1,"flex","flex-col","md:flex-row","justify-between","gap-4","p-4"],[1,"flex","flex-col","sm:flex-row","gap-4","flex-grow"],["appearance","outline",1,"w-full","sm:w-48","md:w-72","lg:w-96"],["matPrefix",""],["matInput","","placeholder","Search employees",3,"keyup","ngModelChange","ngModel"],[1,"flex","gap-3","justify-end"],["mat-raised-button","","color","primary",3,"click"],[1,"flex","items-center","justify-center","min-h-[300px]"],["icon","people","title","No Employees","message","No employees found matching your criteria."],["icon","error","title","Error","message","An error occurred while fetching employees. Please try again later."],[1,"table-container","!bg-white"],["diameter","40"],["mat-table","","matSort","",1,"!bg-white",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","gender"],["matColumnDef","email"],["matColumnDef","phoneNumber"],["matColumnDef","role"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of employees",1,"!bg-white",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","aria-label","Employee actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(r,n){r&1&&(o(0,"mat-card",1)(1,"mat-card-content",2)(2,"div",3)(3,"div",4)(4,"mat-form-field",5)(5,"mat-label"),a(6,"Search"),i(),o(7,"mat-icon",6),a(8,"search"),i(),o(9,"input",7),g("keyup",function(c){return n.applyFilter(c)}),pe("ngModelChange",function(c){return me(n.searchText,c)||(n.searchText=c),c}),i()()(),o(10,"div",8)(11,"button",9),g("click",function(){return n.openDialog()}),o(12,"mat-icon"),a(13,"add"),i(),a(14," ADD EMPLOYEE "),i()()(),C(15,wt,2,0,"div",10)(16,Tt,1,0,"app-no-record",11)(17,It,1,0,"app-no-record",12)(18,jt,23,5,"div",13),i()()),r&2&&(l(9),le("ngModel",n.searchText),l(6),h(n.employees.isLoading()?15:n.employees.hasValue()&&n.dataSource.data.length===0?16:n.employees.error()?17:n.employees.hasValue()?18:-1))},dependencies:[v,Ue,Ve,He,je,Oe,Ae,Qe,$e,Ge,ze,We,Xe,B,tt,H,et,we,ve,De,R,P,N,Le,F,k,w,D,ce,Pe,Ne,qe,ke,Re,Fe,A,V,Ze,O,fe,be,I,L,Ee],encapsulation:2})};export{lt as EmployeeListComponent};
