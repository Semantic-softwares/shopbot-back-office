import{a as Fe}from"./chunk-GWC7K72H.js";import{a as _e,b as xe,e as Me,f as Te,g as Ie,h as Se}from"./chunk-XNNKKASY.js";import{c as Re,d as ke,e as ye,f as Ce,g as be,h as De}from"./chunk-Y2RO63AQ.js";import{a as L}from"./chunk-CP5EC6RD.js";import{i as z}from"./chunk-QC7H4KPM.js";import{a as he,b as ge}from"./chunk-P4SPQCUJ.js";import{d as $}from"./chunk-R6JGHN2R.js";import{c as p,d as ve}from"./chunk-BXJEGH2V.js";import{b as se,c as de,d as ue}from"./chunk-UMV4DCPT.js";import{a as le,e as me,h as ce}from"./chunk-G3VZM262.js";import{a as pe,b as fe}from"./chunk-6I3AJKA7.js";import{B as re,b as U,d,g as W,h as X,k as Y,m as Z,n as ee,p as te,q as ie,s as oe,t as ae,z as ne}from"./chunk-W7NMJLMQ.js";import{h as K}from"./chunk-3E3PJ7Q7.js";import{c as J}from"./chunk-JPRPNQOM.js";import{_ as j,ba as H}from"./chunk-3LDCGXHW.js";import{g as G}from"./chunk-ZLVQTB5B.js";import{q as P,s as B}from"./chunk-6PFJHDFS.js";import{Fc as I,Ib as y,Jb as C,Lb as q,Lc as Q,Mb as D,Nb as _,Nc as w,Ob as s,Pb as n,Qb as a,Rb as h,Vc as g,Yb as V,ac as T,bb as l,cc as v,fa as f,ka as x,la as M,m as F,mc as O,qb as E,rc as r,sc as A,tc as R,wa as N}from"./chunk-J2AK4FW5.js";var Ne=()=>[],qe=(o,e)=>e._id||e.id;function Ve(o,e){if(o&1&&(n(0,"mat-option",19),r(1),a()),o&2){let t=e.$implicit;s("value",t),l(),A(t)}}function Oe(o,e){o&1&&(n(0,"div",20),h(1,"mat-spinner",27),a())}function Ae(o,e){if(o&1&&r(0),o&2){let t=v().$implicit;R(" - Room #",t.roomNumber," ")}}function Qe(o,e){if(o&1&&(n(0,"mat-option",19),r(1),y(2,Ae,1,1),a()),o&2){let t=e.$implicit;s("value",t._id||t.id),l(),R(" ",t.name," "),l(),C(t.roomNumber?2:-1)}}function we(o,e){if(o&1&&(n(0,"mat-form-field",8)(1,"mat-label"),r(2,"Select Room"),a(),n(3,"mat-select",28),D(4,Qe,3,3,"mat-option",19,qe),a()()),o&2){let t=v(2);l(4),_(t.filteredRooms())}}function Pe(o,e){if(o&1&&r(0),o&2){let t=v().$implicit;R(" - Room #",t.roomNumber," ")}}function Be(o,e){if(o&1&&(n(0,"mat-option",19),r(1),y(2,Pe,1,1),a()),o&2){let t=e.$implicit;s("value",t._id||t.id),l(),R(" ",t.name," "),l(),C(t.roomNumber?2:-1)}}function Ge(o,e){if(o&1&&(n(0,"mat-form-field",8)(1,"mat-label"),r(2,"Select Rooms"),a(),n(3,"mat-select",29),D(4,Be,3,3,"mat-option",19,qe),a()()),o&2){let t=v(2);l(4),_(t.filteredRooms())}}function $e(o,e){if(o&1&&y(0,we,6,0,"mat-form-field",8)(1,Ge,6,0,"mat-form-field",8),o&2){let t=v();C(t.bookingType()==="single"?0:1)}}function Le(o,e){o&1&&(n(0,"p",21),r(1,"No rooms available for selected dates"),a())}function je(o,e){o&1&&(n(0,"p",21),r(1,"Select a room type to see available rooms"),a())}var Ee=class o{fb=f(ne);dialogRef=f(_e);roomsService=f(Fe);router=f(G);storeStore=f(z);dialogData=f(xe,{optional:!0});roomTypeField=new Y("");minDate=N(new Date);quickReservationForm=this.fb.group({bookingType:["single",d.required],dateRange:this.fb.group({start:[new Date,[d.required,this.minDateValidator.bind(this)]],end:[this.getNextDay(new Date),[d.required,this.minDateValidator.bind(this)]]}),selectedRoom:["",d.required],adults:[1,[d.required,d.min(1)]],children:[0,[d.required,d.min(0)]]});ngOnInit(){this.dialogData&&(this.dialogData.checkInDate&&this.dialogData.checkOutDate&&this.quickReservationForm.get("dateRange")?.patchValue({start:this.dialogData.checkInDate,end:this.dialogData.checkOutDate}),this.dialogData.preselectedRoomId&&this.quickReservationForm.patchValue({selectedRoom:this.dialogData.preselectedRoomId}),this.dialogData.preselectedRoomTypeName&&this.roomTypeField.patchValue(this.dialogData.preselectedRoomTypeName))}preselectedRoomId=null;checkIn=p(this.quickReservationForm.get("dateRange.start").valueChanges,{initialValue:this.quickReservationForm.get("dateRange.start").value});checkOut=p(this.quickReservationForm.get("dateRange.end").valueChanges,{initialValue:this.quickReservationForm.get("dateRange.end").value});selectedRoomId=p(this.quickReservationForm.get("selectedRoom").valueChanges,{initialValue:this.quickReservationForm.get("selectedRoom").value});bookingType=p(this.quickReservationForm.get("bookingType").valueChanges,{initialValue:this.quickReservationForm.get("bookingType").value});adultsValue=p(this.quickReservationForm.get("adults").valueChanges,{initialValue:this.quickReservationForm.get("adults").value});childrenValue=p(this.quickReservationForm.get("children").valueChanges,{initialValue:this.quickReservationForm.get("children").value});numberOfNights=g(()=>{let e=this.checkIn(),t=this.checkOut();if(!e||!t)return 0;let i=Math.abs(t.getTime()-e.getTime());return Math.ceil(i/(1e3*60*60*24))});availableRoomsResource=ve({params:()=>({checkIn:this.checkIn(),checkOut:this.checkOut(),storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.getAvailableRooms({checkIn:e.checkIn,checkOut:e.checkOut,storeId:e.storeId})});roomTypeValue=p(this.roomTypeField.valueChanges,{initialValue:this.roomTypeField.value});uniqueRoomTypes=g(()=>{let e=this.availableRoomsResource.value()||[],t=new Set(e.map(i=>i.roomType.name));return Array.from(t).sort()});filteredRooms=g(()=>{let e=this.availableRoomsResource.value()||[],t=this.roomTypeValue();return this.preselectedRoomId&&e.length>0&&e.find(m=>(m._id||m.id)===this.preselectedRoomId)&&(this.quickReservationForm.get("selectedRoom")?.setValue(this.preselectedRoomId),this.preselectedRoomId=null),t?e.filter(i=>i.roomType.name===t):e});maxCapacity=g(()=>{let e=this.selectedRoomId(),t=this.availableRoomsResource.value()||[],i=this.bookingType();if(!e)return{adults:0,children:0};let m=Array.isArray(e)?e:[e],c=0,b=0;return m.forEach(k=>{let u=t.find(S=>(S._id||S.id)===k);u?.roomType?.capacity&&(c+=u.roomType.capacity.adults||0,b+=u.roomType.capacity.children||0)}),{adults:c,children:b}});occupancyValidator=()=>{let e=this.adultsValue()||0,t=this.childrenValue()||0,i=this.maxCapacity();return e>i.adults?(this.quickReservationForm.get("adults")?.setErrors({exceedsCapacity:!0}),{exceedsCapacity:!0}):t>i.children?(this.quickReservationForm.get("children")?.setErrors({exceedsCapacity:!0}),{exceedsCapacity:!0}):e+t>i.adults+i.children?(this.quickReservationForm.setErrors({totalOccupancyExceeded:!0}),{totalOccupancyExceeded:!0}):(this.quickReservationForm.hasError("totalOccupancyExceeded")&&this.quickReservationForm.setErrors(null),null)};occupancyCheck=g(()=>(this.adultsValue(),this.childrenValue(),this.maxCapacity(),this.occupancyValidator()));totalAmount=g(()=>{let e=this.selectedRoomId(),t=this.availableRoomsResource.value()||[],i=this.numberOfNights();if(!e||i===0)return 0;let m=Array.isArray(e)?e:[e],c=0;return m.forEach(b=>{let k=t.find(u=>(u._id||u.id)===b);if(k){let u=k.priceOverride||k.pricePerNight||0;c+=u}}),c*i});getAvailableRooms(e){let t=new Date(e.checkIn).toISOString().split("T")[0],i=new Date(e.checkOut).toISOString().split("T")[0];return!t||!i||!e.storeId?F([]):this.roomsService.getAvailableRooms({storeId:e.storeId,checkInDate:t,checkOutDate:i})}minDateValidator(e){if(!e.value)return null;let t=new Date(e.value),i=new Date;return i.setHours(0,0,0,0),t.setHours(0,0,0,0),t<i?{minDateInvalid:!0}:null}onCancel(){this.dialogRef.close()}onProceed(){if(this.quickReservationForm.invalid||this.occupancyCheck())return;let e=this.quickReservationForm.value,t=e.dateRange,i={bookingType:e.bookingType,checkInDate:t?.start,checkOutDate:t?.end,roomTypeFilter:this.roomTypeField.value||"",selectedRoom:this.selectedRoomId()||"",adults:e.adults||1,children:e.children||0};this.dialogRef.close(i)}getNextDay(e){let t=new Date(e);return t.setDate(t.getDate()+1),t}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=E({type:o,selectors:[["app-quick-reservation-modal"]],decls:56,vars:13,consts:[["picker",""],[1,"flex","justify-between","items-center"],["mat-dialog-title",""],[1,"flex","items-center","space-x-2","pr-4"],[1,"text-gray-600","font-medium"],[1,"text-lg","font-bold","text-blue-600"],[3,"formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["formControlName","bookingType"],["value","single"],["value","group"],["formGroupName","dateRange",3,"min","rangePicker"],["matStartDate","","formControlName","start","placeholder","Check-in","readonly",""],["matDateRangeSeparator",""],["matEndDate","","formControlName","end","placeholder","Check-out","readonly",""],["matIconSuffix","",3,"for"],[3,"formControl"],["value",""],[3,"value"],[1,"flex","justify-center","py-4"],[1,"text-gray-500","text-sm","text-center","py-4"],["matInput","","type","number","formControlName","adults"],["matInput","","type","number","formControlName","children"],["align","end",1,"space-x-2","mt-6"],["matButton","outlined",3,"click"],["matButton","filled","color","primary",3,"click","disabled"],["diameter","40"],["formControlName","selectedRoom"],["formControlName","selectedRoom","multiple",""]],template:function(t,i){if(t&1){let m=V();n(0,"div",1)(1,"h2",2),r(2,"Add Quick Reservation"),a(),n(3,"div",3)(4,"span",4),r(5,"Total:"),a(),n(6,"span",5),r(7),Q(8,"currency"),a()()(),n(9,"mat-dialog-content")(10,"form",6)(11,"div",7)(12,"mat-form-field",8)(13,"mat-label"),r(14,"Booking Type"),a(),n(15,"mat-select",9)(16,"mat-option",10),r(17,"Single"),a(),n(18,"mat-option",11),r(19,"Group"),a()()(),n(20,"mat-form-field",8)(21,"mat-label"),r(22,"Stay Dates"),a(),n(23,"mat-date-range-input",12),h(24,"input",13),n(25,"span",14),r(26,"\u2013"),a(),h(27,"input",15),a(),h(28,"mat-datepicker-toggle",16)(29,"mat-date-range-picker",null,0),a(),n(31,"mat-form-field",8)(32,"mat-label"),r(33,"Room Type"),a(),n(34,"mat-select",17)(35,"mat-option",18),r(36,"All Room Types"),a(),D(37,Ve,2,2,"mat-option",19,q),a()(),y(39,Oe,2,0,"div",20)(40,$e,2,1)(41,Le,2,0,"p",21)(42,je,2,0,"p",21),n(43,"mat-form-field",8)(44,"mat-label"),r(45,"Number of Adults"),a(),h(46,"input",22),a(),n(47,"mat-form-field",8)(48,"mat-label"),r(49,"Number of Children"),a(),h(50,"input",23),a()()()(),n(51,"mat-dialog-actions",24)(52,"button",25),T("click",function(){return x(m),M(i.onCancel())}),r(53," Cancel "),a(),n(54,"button",26),T("click",function(){return x(m),M(i.onProceed())}),r(55," Proceed to Details "),a()()}if(t&2){let m,c=O(30);l(7),R(" ",w(8,8,i.totalAmount(),((m=i.storeStore.selectedStore())==null?null:m.currency)||((m=i.storeStore.selectedStore())==null?null:m.currencyCode)||"$")," "),l(3),s("formGroup",i.quickReservationForm),l(13),s("min",i.minDate())("rangePicker",c),l(5),s("for",c),l(6),s("formControl",i.roomTypeField),l(3),_(i.uniqueRoomTypes()),l(2),C(i.availableRoomsResource.isLoading()?39:(i.availableRoomsResource.value()||I(11,Ne)).length>0?40:(i.availableRoomsResource.value()||I(12,Ne)).length===0&&!i.availableRoomsResource.isLoading()?41:42),l(15),s("disabled",i.quickReservationForm.invalid)}},dependencies:[B,re,Z,U,ee,W,X,te,ae,oe,ie,Se,Me,Ie,Te,K,H,j,ge,ce,le,me,he,$,se,De,Re,ke,ye,Ce,be,ue,de,L,J,fe,pe,P],encapsulation:2})};export{Ee as a};
