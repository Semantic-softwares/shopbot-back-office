import{c as Mn,d as En,f as sn,g as ln,h as Rn}from"./chunk-CJPLD6EO.js";import{a as ui,b as pi}from"./chunk-AJRTJGXQ.js";import{a as di}from"./chunk-VKY37EBM.js";import{a as ci}from"./chunk-OFBWW2F5.js";import{a as rn}from"./chunk-5CCATTWV.js";import{a as on}from"./chunk-5Y6UXO26.js";import{a as an,b as Tt}from"./chunk-5PRTBKPY.js";import{a as mi}from"./chunk-S5KAQE73.js";import{a as je}from"./chunk-UAP6KZ37.js";import{a as Dt}from"./chunk-S2GGJVYE.js";import"./chunk-ZDXFSQFM.js";import{a as li}from"./chunk-VJKMZU7H.js";import{b as si}from"./chunk-B276YSOB.js";import{b as ri,f as Rt}from"./chunk-6IVFTPYN.js";import{a as Yt,b as Qt,c as Ke,e as Xt,f as en,g as tn,h as nn}from"./chunk-7AEPEFCD.js";import{a as Zt}from"./chunk-4KYCCNTD.js";import"./chunk-32VWG5BO.js";import{a as oi,b as ai,c as Ue,d as St,e as Ft,f as Mt,g as Et,h as Ie}from"./chunk-OVVKV2U3.js";import{a as ye}from"./chunk-XCRB4NGT.js";import{a as bt}from"./chunk-P5H3RIJ7.js";import{a as ct,b as ut,c as pt,d as gt,e as ft,f as ht,g as _t,h as Ct,i as vt,j as yt,k as xt}from"./chunk-4UI7GXCU.js";import{g as ei}from"./chunk-3BRMB7WO.js";import{a as Jt,b as ti,c as ni,e as ii,f as mt,g as dt,l as Ge}from"./chunk-JR6JYGE5.js";import{a as lt,b as He}from"./chunk-IQCUWJKP.js";import{a as it}from"./chunk-GELMWLCN.js";import"./chunk-JN5X2IYW.js";import"./chunk-DSVTILZD.js";import{a as Wn}from"./chunk-IW6IJ3IN.js";import{e as Jn}from"./chunk-OALDM5KA.js";import{i as W}from"./chunk-I4XKOMFF.js";import{a as ke,b as ge}from"./chunk-T3N63WKP.js";import{d as Ee}from"./chunk-WAEUNFFU.js";import{c as L,d as Fe}from"./chunk-34VGG7JE.js";import"./chunk-JOC3JCWJ.js";import"./chunk-AXVKE7YV.js";import"./chunk-UDXHODBD.js";import"./chunk-XBTGTIDL.js";import{b as ie,c as Te,d as K}from"./chunk-3JUXLSAM.js";import{a as ue,b as st,c as De,d as zt,e as qe,h as pe}from"./chunk-TKNXELSU.js";import"./chunk-JT5P23LW.js";import{a as $e,b as Ne}from"./chunk-4CSV6WDD.js";import{A as Xn,B as ee,b as ve,d as c,e as Zn,g as de,h as X,i as Kt,m as Ve,n as jt,o as Pt,q as Le,r as Wt,s as ce,t as U,v as Yn,w as Qn,z as Re}from"./chunk-APGJ2ZCU.js";import"./chunk-KLDQLPSD.js";import{a as at,b as Ht}from"./chunk-6XJLFJNL.js";import{a as Ut}from"./chunk-NBBA3J5P.js";import"./chunk-3LEF2TVB.js";import"./chunk-R35DVJIH.js";import"./chunk-BFT2MTJY.js";import{a as J,b as Z,c as Y,d as rt,e as zn,f as Q,h as O}from"./chunk-SV3V3KFF.js";import"./chunk-FTUKKUPK.js";import"./chunk-J6S3CU5H.js";import"./chunk-SBJI2VOL.js";import{b as z,c as A}from"./chunk-A5WKFY2Q.js";import{Y as ot,Z as me,aa as j}from"./chunk-PD333HOR.js";import{e as nt,g as Kn,h as jn}from"./chunk-JWHH2AW2.js";import{e as Hn,g as tt,l as $t,m as Be,q as le,r as Un,s as w}from"./chunk-T7PMTSVA.js";import{$ as Vt,$b as b,Bc as Bn,Dc as qt,Ec as Oe,Fb as Gn,Fc as _e,Gc as Vn,Hb as f,Ib as h,Jb as Lt,Jc as Fn,K as Bt,Kc as M,Lb as ae,Lc as Ae,Mb as re,Mc as $,Nb as g,Nc as Ln,Ob as a,Oc as H,Pb as o,Qb as _,Ub as B,Uc as x,V as he,Vb as V,X as Xe,Xb as N,Zc as se,_c as P,ab as l,bc as u,cd as qn,ea as v,f as Qe,fd as $n,g as kn,ja as S,ka as F,lc as we,m as Ot,nc as In,pb as k,pc as et,qc as r,rc as T,sc as C,tc as Se,uc as Pn,va as R,vb as G,vc as wn,wc as An,xc as On,ya as Pe}from"./chunk-ZCSDIQ3M.js";import{a as bn,b as Sn,g as Ce}from"./chunk-GAL4ENT6.js";var Dn=(p=>(p.PENDING="pending",p.RESERVED="reserved",p.CONFIRMED="confirmed",p.CHECKED_IN="checked_in",p.CHECKED_OUT="checked_out",p.CANCELLED="cancelled",p.NO_SHOW="no_show",p))(Dn||{});var mn=class i{countries=[{code:"AF",name:"Afghanistan"},{code:"AL",name:"Albania"},{code:"DZ",name:"Algeria"},{code:"AS",name:"American Samoa"},{code:"AD",name:"Andorra"},{code:"AO",name:"Angola"},{code:"AI",name:"Anguilla"},{code:"AQ",name:"Antarctica"},{code:"AG",name:"Antigua and Barbuda"},{code:"AR",name:"Argentina"},{code:"AM",name:"Armenia"},{code:"AW",name:"Aruba"},{code:"AU",name:"Australia"},{code:"AT",name:"Austria"},{code:"AZ",name:"Azerbaijan"},{code:"BS",name:"Bahamas"},{code:"BH",name:"Bahrain"},{code:"BD",name:"Bangladesh"},{code:"BB",name:"Barbados"},{code:"BY",name:"Belarus"},{code:"BE",name:"Belgium"},{code:"BZ",name:"Belize"},{code:"BJ",name:"Benin"},{code:"BM",name:"Bermuda"},{code:"BT",name:"Bhutan"},{code:"BO",name:"Bolivia"},{code:"BA",name:"Bosnia and Herzegovina"},{code:"BW",name:"Botswana"},{code:"BV",name:"Bouvet Island"},{code:"BR",name:"Brazil"},{code:"BN",name:"Brunei"},{code:"BG",name:"Bulgaria"},{code:"BF",name:"Burkina Faso"},{code:"BI",name:"Burundi"},{code:"KH",name:"Cambodia"},{code:"CM",name:"Cameroon"},{code:"CA",name:"Canada"},{code:"CV",name:"Cape Verde"},{code:"KY",name:"Cayman Islands"},{code:"CF",name:"Central African Republic"},{code:"TD",name:"Chad"},{code:"CL",name:"Chile"},{code:"CN",name:"China"},{code:"CX",name:"Christmas Island"},{code:"CC",name:"Cocos Islands"},{code:"CO",name:"Colombia"},{code:"KM",name:"Comoros"},{code:"CG",name:"Congo"},{code:"CD",name:"Congo (Democratic Republic)"},{code:"CK",name:"Cook Islands"},{code:"CR",name:"Costa Rica"},{code:"HR",name:"Croatia"},{code:"CU",name:"Cuba"},{code:"CY",name:"Cyprus"},{code:"CZ",name:"Czech Republic"},{code:"DK",name:"Denmark"},{code:"DJ",name:"Djibouti"},{code:"DM",name:"Dominica"},{code:"DO",name:"Dominican Republic"},{code:"EC",name:"Ecuador"},{code:"EG",name:"Egypt"},{code:"SV",name:"El Salvador"},{code:"GQ",name:"Equatorial Guinea"},{code:"ER",name:"Eritrea"},{code:"EE",name:"Estonia"},{code:"ET",name:"Ethiopia"},{code:"FK",name:"Falkland Islands"},{code:"FO",name:"Faroe Islands"},{code:"FJ",name:"Fiji"},{code:"FI",name:"Finland"},{code:"FR",name:"France"},{code:"GF",name:"French Guiana"},{code:"PF",name:"French Polynesia"},{code:"TF",name:"French Southern Territories"},{code:"GA",name:"Gabon"},{code:"GM",name:"Gambia"},{code:"GE",name:"Georgia"},{code:"DE",name:"Germany"},{code:"GH",name:"Ghana"},{code:"GI",name:"Gibraltar"},{code:"GR",name:"Greece"},{code:"GL",name:"Greenland"},{code:"GD",name:"Grenada"},{code:"GP",name:"Guadeloupe"},{code:"GU",name:"Guam"},{code:"GT",name:"Guatemala"},{code:"GG",name:"Guernsey"},{code:"GN",name:"Guinea"},{code:"GW",name:"Guinea-Bissau"},{code:"GY",name:"Guyana"},{code:"HT",name:"Haiti"},{code:"HK",name:"Hong Kong"},{code:"HU",name:"Hungary"},{code:"IS",name:"Iceland"},{code:"IN",name:"India"},{code:"ID",name:"Indonesia"},{code:"IR",name:"Iran"},{code:"IQ",name:"Iraq"},{code:"IE",name:"Ireland"},{code:"IM",name:"Isle of Man"},{code:"IL",name:"Israel"},{code:"IT",name:"Italy"},{code:"CI",name:"Ivory Coast"},{code:"JM",name:"Jamaica"},{code:"JP",name:"Japan"},{code:"JE",name:"Jersey"},{code:"JO",name:"Jordan"},{code:"KZ",name:"Kazakhstan"},{code:"KE",name:"Kenya"},{code:"KI",name:"Kiribati"},{code:"KP",name:"North Korea"},{code:"KR",name:"South Korea"},{code:"KW",name:"Kuwait"},{code:"KG",name:"Kyrgyzstan"},{code:"LA",name:"Laos"},{code:"LV",name:"Latvia"},{code:"LB",name:"Lebanon"},{code:"LS",name:"Lesotho"},{code:"LR",name:"Liberia"},{code:"LY",name:"Libya"},{code:"LI",name:"Liechtenstein"},{code:"LT",name:"Lithuania"},{code:"LU",name:"Luxembourg"},{code:"MO",name:"Macao"},{code:"MK",name:"Macedonia"},{code:"MG",name:"Madagascar"},{code:"MW",name:"Malawi"},{code:"MY",name:"Malaysia"},{code:"MV",name:"Maldives"},{code:"ML",name:"Mali"},{code:"MT",name:"Malta"},{code:"MH",name:"Marshall Islands"},{code:"MQ",name:"Martinique"},{code:"MR",name:"Mauritania"},{code:"MU",name:"Mauritius"},{code:"YT",name:"Mayotte"},{code:"MX",name:"Mexico"},{code:"FM",name:"Micronesia"},{code:"MD",name:"Moldova"},{code:"MC",name:"Monaco"},{code:"MN",name:"Mongolia"},{code:"ME",name:"Montenegro"},{code:"MA",name:"Morocco"},{code:"MZ",name:"Mozambique"},{code:"MM",name:"Myanmar"},{code:"NA",name:"Namibia"},{code:"NR",name:"Nauru"},{code:"NP",name:"Nepal"},{code:"NL",name:"Netherlands"},{code:"AN",name:"Netherlands Antilles"},{code:"NC",name:"New Caledonia"},{code:"NZ",name:"New Zealand"},{code:"NI",name:"Nicaragua"},{code:"NE",name:"Niger"},{code:"NG",name:"Nigeria"},{code:"NU",name:"Niue"},{code:"NF",name:"Norfolk Island"},{code:"MP",name:"Northern Mariana Islands"},{code:"NO",name:"Norway"},{code:"OM",name:"Oman"},{code:"PK",name:"Pakistan"},{code:"PW",name:"Palau"},{code:"PS",name:"Palestine"},{code:"PA",name:"Panama"},{code:"PG",name:"Papua New Guinea"},{code:"PY",name:"Paraguay"},{code:"PE",name:"Peru"},{code:"PH",name:"Philippines"},{code:"PN",name:"Pitcairn Islands"},{code:"PL",name:"Poland"},{code:"PT",name:"Portugal"},{code:"PR",name:"Puerto Rico"},{code:"QA",name:"Qatar"},{code:"RE",name:"Reunion"},{code:"RO",name:"Romania"},{code:"RU",name:"Russia"},{code:"RW",name:"Rwanda"},{code:"BL",name:"Saint Barthelemy"},{code:"SH",name:"Saint Helena"},{code:"KN",name:"Saint Kitts and Nevis"},{code:"LC",name:"Saint Lucia"},{code:"MF",name:"Saint Martin"},{code:"PM",name:"Saint Pierre and Miquelon"},{code:"VC",name:"Saint Vincent and the Grenadines"},{code:"WS",name:"Samoa"},{code:"SM",name:"San Marino"},{code:"ST",name:"Sao Tome and Principe"},{code:"SA",name:"Saudi Arabia"},{code:"SN",name:"Senegal"},{code:"RS",name:"Serbia"},{code:"SC",name:"Seychelles"},{code:"SL",name:"Sierra Leone"},{code:"SG",name:"Singapore"},{code:"SK",name:"Slovakia"},{code:"SI",name:"Slovenia"},{code:"SB",name:"Solomon Islands"},{code:"SO",name:"Somalia"},{code:"ZA",name:"South Africa"},{code:"GS",name:"South Georgia and the South Sandwich Islands"},{code:"SS",name:"South Sudan"},{code:"ES",name:"Spain"},{code:"LK",name:"Sri Lanka"},{code:"SD",name:"Sudan"},{code:"SR",name:"Suriname"},{code:"SJ",name:"Svalbard and Jan Mayen"},{code:"SZ",name:"Swaziland"},{code:"SE",name:"Sweden"},{code:"CH",name:"Switzerland"},{code:"SY",name:"Syria"},{code:"TW",name:"Taiwan"},{code:"TJ",name:"Tajikistan"},{code:"TZ",name:"Tanzania"},{code:"TH",name:"Thailand"},{code:"TL",name:"Timor-Leste"},{code:"TG",name:"Togo"},{code:"TK",name:"Tokelau"},{code:"TO",name:"Tonga"},{code:"TT",name:"Trinidad and Tobago"},{code:"TN",name:"Tunisia"},{code:"TR",name:"Turkey"},{code:"TM",name:"Turkmenistan"},{code:"TC",name:"Turks and Caicos Islands"},{code:"TV",name:"Tuvalu"},{code:"UG",name:"Uganda"},{code:"UA",name:"Ukraine"},{code:"AE",name:"United Arab Emirates"},{code:"GB",name:"United Kingdom"},{code:"US",name:"United States"},{code:"UY",name:"Uruguay"},{code:"UZ",name:"Uzbekistan"},{code:"VU",name:"Vanuatu"},{code:"VA",name:"Vatican City"},{code:"VE",name:"Venezuela"},{code:"VN",name:"Vietnam"},{code:"VG",name:"Virgin Islands (British)"},{code:"VI",name:"Virgin Islands (US)"},{code:"WF",name:"Wallis and Futuna"},{code:"EH",name:"Western Sahara"},{code:"YE",name:"Yemen"},{code:"ZM",name:"Zambia"},{code:"ZW",name:"Zimbabwe"}];nationalities=[{code:"AF",name:"Afghan"},{code:"AL",name:"Albanian"},{code:"DZ",name:"Algerian"},{code:"AS",name:"American Samoan"},{code:"AD",name:"Andorran"},{code:"AO",name:"Angolan"},{code:"AI",name:"Anguillan"},{code:"AQ",name:"Antarctic"},{code:"AG",name:"Antiguan or Barbudan"},{code:"AR",name:"Argentine"},{code:"AM",name:"Armenian"},{code:"AW",name:"Aruban"},{code:"AU",name:"Australian"},{code:"AT",name:"Austrian"},{code:"AZ",name:"Azerbaijani"},{code:"BS",name:"Bahamian"},{code:"BH",name:"Bahraini"},{code:"BD",name:"Bangladeshi"},{code:"BB",name:"Barbadian"},{code:"BY",name:"Belarusian"},{code:"BE",name:"Belgian"},{code:"BZ",name:"Belizean"},{code:"BJ",name:"Beninese"},{code:"BM",name:"Bermudian"},{code:"BT",name:"Bhutanese"},{code:"BO",name:"Bolivian"},{code:"BA",name:"Bosnian"},{code:"BW",name:"Botswanan"},{code:"BV",name:"Bouvet Islander"},{code:"BR",name:"Brazilian"},{code:"BN",name:"Bruneian"},{code:"BG",name:"Bulgarian"},{code:"BF",name:"Burkinabe"},{code:"BI",name:"Burundian"},{code:"KH",name:"Cambodian"},{code:"CM",name:"Cameroonian"},{code:"CA",name:"Canadian"},{code:"CV",name:"Cape Verdean"},{code:"KY",name:"Caymanian"},{code:"CF",name:"Central African"},{code:"TD",name:"Chadian"},{code:"CL",name:"Chilean"},{code:"CN",name:"Chinese"},{code:"CX",name:"Christmas Islander"},{code:"CC",name:"Cocos Islander"},{code:"CO",name:"Colombian"},{code:"KM",name:"Comorian"},{code:"CG",name:"Congolese"},{code:"CD",name:"Congolese"},{code:"CK",name:"Cook Islander"},{code:"CR",name:"Costa Rican"},{code:"HR",name:"Croatian"},{code:"CU",name:"Cuban"},{code:"CY",name:"Cypriot"},{code:"CZ",name:"Czech"},{code:"DK",name:"Danish"},{code:"DJ",name:"Djiboutian"},{code:"DM",name:"Dominican"},{code:"DO",name:"Dominican"},{code:"EC",name:"Ecuadorian"},{code:"EG",name:"Egyptian"},{code:"SV",name:"Salvadoran"},{code:"GQ",name:"Equatorial Guinean"},{code:"ER",name:"Eritrean"},{code:"EE",name:"Estonian"},{code:"ET",name:"Ethiopian"},{code:"FK",name:"Falkland Islander"},{code:"FO",name:"Faroese"},{code:"FJ",name:"Fijian"},{code:"FI",name:"Finnish"},{code:"FR",name:"French"},{code:"GF",name:"French Guianan"},{code:"PF",name:"French Polynesian"},{code:"TF",name:"French Southern"},{code:"GA",name:"Gabonese"},{code:"GM",name:"Gambian"},{code:"GE",name:"Georgian"},{code:"DE",name:"German"},{code:"GH",name:"Ghanaian"},{code:"GI",name:"Gibraltar"},{code:"GR",name:"Greek"},{code:"GL",name:"Greenlandic"},{code:"GD",name:"Grenadian"},{code:"GP",name:"Guadeloupe"},{code:"GU",name:"Guamanian"},{code:"GT",name:"Guatemalan"},{code:"GG",name:"Guernseyite"},{code:"GN",name:"Guinean"},{code:"GW",name:"Guinea-Bissauan"},{code:"GY",name:"Guyanese"},{code:"HT",name:"Haitian"},{code:"HK",name:"Hong Kong"},{code:"HU",name:"Hungarian"},{code:"IS",name:"Icelandic"},{code:"IN",name:"Indian"},{code:"ID",name:"Indonesian"},{code:"IR",name:"Iranian"},{code:"IQ",name:"Iraqi"},{code:"IE",name:"Irish"},{code:"IM",name:"Manx"},{code:"IL",name:"Israeli"},{code:"IT",name:"Italian"},{code:"CI",name:"Ivorian"},{code:"JM",name:"Jamaican"},{code:"JP",name:"Japanese"},{code:"JE",name:"Jersey"},{code:"JO",name:"Jordanian"},{code:"KZ",name:"Kazakhstani"},{code:"KE",name:"Kenyan"},{code:"KI",name:"I-Kiribati"},{code:"KP",name:"North Korean"},{code:"KR",name:"South Korean"},{code:"KW",name:"Kuwaiti"},{code:"KG",name:"Kyrgyzstani"},{code:"LA",name:"Laotian"},{code:"LV",name:"Latvian"},{code:"LB",name:"Lebanese"},{code:"LS",name:"Sotho"},{code:"LR",name:"Liberian"},{code:"LY",name:"Libyan"},{code:"LI",name:"Liechtenstein"},{code:"LT",name:"Lithuanian"},{code:"LU",name:"Luxembourg"},{code:"MO",name:"Macanese"},{code:"MK",name:"Macedonian"},{code:"MG",name:"Malagasy"},{code:"MW",name:"Malawian"},{code:"MY",name:"Malaysian"},{code:"MV",name:"Maldivian"},{code:"ML",name:"Malian"},{code:"MT",name:"Maltese"},{code:"MH",name:"Marshallese"},{code:"MQ",name:"Martinique"},{code:"MR",name:"Mauritanian"},{code:"MU",name:"Mauritian"},{code:"YT",name:"Mahoran"},{code:"MX",name:"Mexican"},{code:"FM",name:"Micronesian"},{code:"MD",name:"Moldovan"},{code:"MC",name:"Monegasque"},{code:"MN",name:"Mongolian"},{code:"ME",name:"Montenegrin"},{code:"MA",name:"Moroccan"},{code:"MZ",name:"Mozambican"},{code:"MM",name:"Burmese"},{code:"NA",name:"Namibian"},{code:"NR",name:"Nauruan"},{code:"NP",name:"Nepalese"},{code:"NL",name:"Dutch"},{code:"AN",name:"Dutch"},{code:"NC",name:"New Caledonian"},{code:"NZ",name:"New Zealand"},{code:"NI",name:"Nicaraguan"},{code:"NE",name:"Nigerien"},{code:"NG",name:"Nigerian"},{code:"NU",name:"Niuean"},{code:"NF",name:"Norfolk Islander"},{code:"MP",name:"Northern Mariana Islander"},{code:"NO",name:"Norwegian"},{code:"OM",name:"Omani"},{code:"PK",name:"Pakistani"},{code:"PW",name:"Palauan"},{code:"PS",name:"Palestinian"},{code:"PA",name:"Panamanian"},{code:"PG",name:"Papua New Guinean"},{code:"PY",name:"Paraguayan"},{code:"PE",name:"Peruvian"},{code:"PH",name:"Philippine"},{code:"PN",name:"Pitcairn Islander"},{code:"PL",name:"Polish"},{code:"PT",name:"Portuguese"},{code:"PR",name:"Puerto Rican"},{code:"QA",name:"Qatari"},{code:"RE",name:"Reunionese"},{code:"RO",name:"Romanian"},{code:"RU",name:"Russian"},{code:"RW",name:"Rwandan"},{code:"BL",name:"Saint Barthelemy"},{code:"SH",name:"Saint Helenian"},{code:"KN",name:"Kittitian or Nevisian"},{code:"LC",name:"Saint Lucian"},{code:"MF",name:"Saint Martin"},{code:"PM",name:"Saint Pierre"},{code:"VC",name:"Vincentian"},{code:"WS",name:"Samoan"},{code:"SM",name:"Sammarinese"},{code:"ST",name:"Sao Tome"},{code:"SA",name:"Saudi"},{code:"SN",name:"Senegalese"},{code:"RS",name:"Serbian"},{code:"SC",name:"Seychellois"},{code:"SL",name:"Sierra Leonean"},{code:"SG",name:"Singaporean"},{code:"SK",name:"Slovak"},{code:"SI",name:"Slovenian"},{code:"SB",name:"Solomon Islander"},{code:"SO",name:"Somali"},{code:"ZA",name:"South African"},{code:"GS",name:"South Georgia"},{code:"SS",name:"South Sudanese"},{code:"ES",name:"Spanish"},{code:"LK",name:"Sri Lankan"},{code:"SD",name:"Sudanese"},{code:"SR",name:"Surinamese"},{code:"SJ",name:"Svalbard Islander"},{code:"SZ",name:"Swazi"},{code:"SE",name:"Swedish"},{code:"CH",name:"Swiss"},{code:"SY",name:"Syrian"},{code:"TW",name:"Taiwanese"},{code:"TJ",name:"Tajikistani"},{code:"TZ",name:"Tanzanian"},{code:"TH",name:"Thai"},{code:"TL",name:"Timorese"},{code:"TG",name:"Togolese"},{code:"TK",name:"Tokelauan"},{code:"TO",name:"Tongan"},{code:"TT",name:"Trinidad and Tobagonian"},{code:"TN",name:"Tunisian"},{code:"TR",name:"Turkish"},{code:"TM",name:"Turkmenistani"},{code:"TC",name:"Turks and Caicos Islander"},{code:"TV",name:"Tuvaluan"},{code:"UG",name:"Ugandan"},{code:"UA",name:"Ukrainian"},{code:"AE",name:"Emirati"},{code:"GB",name:"British"},{code:"US",name:"American"},{code:"UY",name:"Uruguayan"},{code:"UZ",name:"Uzbekistani"},{code:"VU",name:"Vanuatu"},{code:"VA",name:"Vatican"},{code:"VE",name:"Venezuelan"},{code:"VN",name:"Vietnamese"},{code:"VG",name:"Virgin Islander"},{code:"VI",name:"Virgin Islander"},{code:"WF",name:"Wallis and Futuna Islander"},{code:"EH",name:"Sahrawi"},{code:"YE",name:"Yemeni"},{code:"ZM",name:"Zambian"},{code:"ZW",name:"Zimbabwean"}];getCountries(){return[...this.countries]}getNationalities(){return[...this.nationalities]}getCountryByCode(e){return this.countries.find(t=>t.code===e)}getNationalityByCode(e){return this.nationalities.find(t=>t.code===e)}getCountryName(e){let t=this.getCountryByCode(e);return t?t.name:e}getNationalityName(e){let t=this.getNationalityByCode(e);return t?t.name:e}static \u0275fac=function(t){return new(t||i)};static \u0275prov=Vt({token:i,factory:i.\u0275fac,providedIn:"root"})};var cn=(i,e)=>e.code;function Fi(i,e){i&1&&(a(0,"h2",11),r(1,"Edit Child Guest"),o())}function Mi(i,e){i&1&&(a(0,"h2",11),r(1,"Edit Individual Guest"),o())}function Ei(i,e){i&1&&(a(0,"h2",11),r(1,"Edit Company Guest"),o())}function Ri(i,e){if(i&1&&f(0,Fi,2,0,"h2",11)(1,Mi,2,0,"h2",11)(2,Ei,2,0,"h2",11),i&2){let t=u();h(t.isChildGuest()?0:t.guestType()==="individual"?1:2)}}function Di(i,e){i&1&&(a(0,"h2",11),r(1,"Create Child Guest"),o())}function Ti(i,e){i&1&&(a(0,"h2",11),r(1,"Create Individual Guest"),o())}function Ni(i,e){i&1&&(a(0,"h2",11),r(1,"Create Company Guest"),o())}function ki(i,e){if(i&1&&f(0,Di,2,0,"h2",11)(1,Ti,2,0,"h2",11)(2,Ni,2,0,"h2",11),i&2){let t=u();h(t.isChildGuest()?0:t.guestType()==="individual"?1:2)}}function Gi(i,e){if(i&1){let t=N();a(0,"div",3)(1,"h4",12),r(2,"Search Existing Guest"),o(),a(3,"p",13),r(4,"Search and select an existing guest to auto-fill the form"),o(),a(5,"app-guest-search",14),b("guestSelected",function(s){S(t);let m=u();return F(m.onSelectExistingGuest(s))}),o()()}}function Ii(i,e){i&1&&(a(0,"mat-error"),r(1,"First name is required"),o())}function Pi(i,e){i&1&&(a(0,"mat-error"),r(1,"First name must be at least 2 characters"),o())}function wi(i,e){i&1&&(a(0,"mat-error"),r(1,"Last name is required"),o())}function Ai(i,e){i&1&&(a(0,"mat-error"),r(1,"Last name must be at least 2 characters"),o())}function Oi(i,e){if(i&1&&(a(0,"mat-option",21),r(1),o()),i&2){let t=e.$implicit;g("value",t.name),l(),T(t.name)}}function Bi(i,e){if(i&1&&(a(0,"h4",12),r(1,"Individual Information"),o(),a(2,"div",15)(3,"mat-form-field",6)(4,"mat-label"),r(5,"First Name"),o(),_(6,"input",16),f(7,Ii,2,0,"mat-error"),f(8,Pi,2,0,"mat-error"),o(),a(9,"mat-form-field",6)(10,"mat-label"),r(11,"Last Name"),o(),_(12,"input",17),f(13,wi,2,0,"mat-error"),f(14,Ai,2,0,"mat-error"),o(),a(15,"mat-form-field",6)(16,"mat-label"),r(17,"Date of Birth"),o(),_(18,"input",18)(19,"mat-datepicker-toggle",19)(20,"mat-datepicker",null,0),o(),a(22,"mat-form-field",6)(23,"mat-label"),r(24,"Nationality"),o(),a(25,"mat-select",20),ae(26,Oi,2,2,"mat-option",21,cn),o()()()),i&2){let t,n,s,m,d=we(21),p=u();l(7),h((t=p.guestForm.get("firstName"))!=null&&t.hasError("required")&&((t=p.guestForm.get("firstName"))!=null&&t.touched)?7:-1),l(),h((n=p.guestForm.get("firstName"))!=null&&n.hasError("minlength")&&((n=p.guestForm.get("firstName"))!=null&&n.touched)?8:-1),l(5),h((s=p.guestForm.get("lastName"))!=null&&s.hasError("required")&&((s=p.guestForm.get("lastName"))!=null&&s.touched)?13:-1),l(),h((m=p.guestForm.get("lastName"))!=null&&m.hasError("minlength")&&((m=p.guestForm.get("lastName"))!=null&&m.touched)?14:-1),l(4),g("matDatepicker",d),l(),g("for",d),l(7),re(p.nationalities())}}function Vi(i,e){i&1&&(a(0,"mat-error"),r(1,"Company name is required"),o())}function Li(i,e){i&1&&(a(0,"mat-error"),r(1,"Company name must be at least 2 characters"),o())}function qi(i,e){i&1&&(a(0,"mat-error"),r(1,"First name is required"),o())}function $i(i,e){i&1&&(a(0,"mat-error"),r(1,"First name must be at least 2 characters"),o())}function Hi(i,e){i&1&&(a(0,"mat-error"),r(1,"Last name is required"),o())}function Ui(i,e){i&1&&(a(0,"mat-error"),r(1,"Last name must be at least 2 characters"),o())}function Ki(i,e){if(i&1&&(a(0,"h4",12),r(1,"Company Information"),o(),a(2,"div",15)(3,"mat-form-field",6)(4,"mat-label"),r(5,"Company Name"),o(),_(6,"input",22),f(7,Vi,2,0,"mat-error"),f(8,Li,2,0,"mat-error"),o(),a(9,"mat-form-field",6)(10,"mat-label"),r(11,"Registration Number"),o(),_(12,"input",23),o(),a(13,"mat-form-field",6)(14,"mat-label"),r(15,"Contact Person First Name"),o(),_(16,"input",24),f(17,qi,2,0,"mat-error"),f(18,$i,2,0,"mat-error"),o(),a(19,"mat-form-field",6)(20,"mat-label"),r(21,"Contact Person Last Name"),o(),_(22,"input",25),f(23,Hi,2,0,"mat-error"),f(24,Ui,2,0,"mat-error"),o(),a(25,"mat-form-field",26)(26,"mat-label"),r(27,"Contact Person Title"),o(),_(28,"input",27),o()()),i&2){let t,n,s,m,d,p,y=u();l(7),h((t=y.guestForm.get("companyName"))!=null&&t.hasError("required")&&((t=y.guestForm.get("companyName"))!=null&&t.touched)?7:-1),l(),h((n=y.guestForm.get("companyName"))!=null&&n.hasError("minlength")&&((n=y.guestForm.get("companyName"))!=null&&n.touched)?8:-1),l(9),h((s=y.guestForm.get("contactPersonFirstName"))!=null&&s.hasError("required")&&((s=y.guestForm.get("contactPersonFirstName"))!=null&&s.touched)?17:-1),l(),h((m=y.guestForm.get("contactPersonFirstName"))!=null&&m.hasError("minlength")&&((m=y.guestForm.get("contactPersonFirstName"))!=null&&m.touched)?18:-1),l(5),h((d=y.guestForm.get("contactPersonLastName"))!=null&&d.hasError("required")&&((d=y.guestForm.get("contactPersonLastName"))!=null&&d.touched)?23:-1),l(),h((p=y.guestForm.get("contactPersonLastName"))!=null&&p.hasError("minlength")&&((p=y.guestForm.get("contactPersonLastName"))!=null&&p.touched)?24:-1)}}function ji(i,e){i&1&&(a(0,"mat-error"),r(1,"Email is required"),o())}function Wi(i,e){i&1&&(a(0,"mat-error"),r(1,"Please enter a valid email"),o())}function zi(i,e){if(i&1&&(a(0,"div")(1,"h4",12),r(2,"Contact Information"),o(),a(3,"div",15)(4,"mat-form-field",6)(5,"mat-label"),r(6,"Email"),o(),_(7,"input",28),f(8,ji,2,0,"mat-error"),f(9,Wi,2,0,"mat-error"),o(),a(10,"mat-form-field",6)(11,"mat-label"),r(12,"Phone"),o(),_(13,"input",29),o()()()),i&2){let t,n,s=u();l(8),h((t=s.guestForm.get("email"))!=null&&t.hasError("required")&&((t=s.guestForm.get("email"))!=null&&t.touched)?8:-1),l(),h((n=s.guestForm.get("email"))!=null&&n.hasError("email")&&((n=s.guestForm.get("email"))!=null&&n.touched)?9:-1)}}function Ji(i,e){if(i&1&&(a(0,"mat-option",21),r(1),o()),i&2){let t=e.$implicit;g("value",t.name),l(),C(" ",t.name," ")}}function Zi(i,e){if(i&1&&(a(0,"div")(1,"h4",12),r(2,"Additional Details"),o(),a(3,"div",15)(4,"mat-form-field",6)(5,"mat-label"),r(6,"Nationality"),o(),a(7,"mat-select",30)(8,"mat-option",31),r(9,"-- Select Nationality --"),o(),ae(10,Ji,2,2,"mat-option",21,cn),o()()()()),i&2){let t=u();l(10),re(t.nationalities())}}function Yi(i,e){if(i&1&&(a(0,"mat-option",21),r(1),o()),i&2){let t=e.$implicit;g("value",t.name),l(),C(" ",t.name," ")}}function Qi(i,e){if(i&1&&(a(0,"div",5)(1,"h4",12),r(2,"ID Document"),o(),a(3,"div",15)(4,"mat-form-field",6)(5,"mat-label"),r(6,"Document Type"),o(),a(7,"mat-select",32)(8,"mat-option",33),r(9,"Passport"),o(),a(10,"mat-option",34),r(11,"National ID"),o(),a(12,"mat-option",35),r(13,"Driver's License"),o(),a(14,"mat-option",36),r(15,"Other"),o()()(),a(16,"mat-form-field",6)(17,"mat-label"),r(18,"Document Number"),o(),_(19,"input",37),o(),a(20,"mat-form-field",6)(21,"mat-label"),r(22,"Expiry Date"),o(),_(23,"input",38)(24,"mat-datepicker-toggle",19)(25,"mat-datepicker",null,1),o(),a(27,"mat-form-field",6)(28,"mat-label"),r(29,"Issuing Country"),o(),a(30,"mat-select",39)(31,"mat-option",31),r(32,"-- Select Country --"),o(),ae(33,Yi,2,2,"mat-option",21,cn),o()()()()),i&2){let t=we(26),n=u();g("formGroup",n.idDocumentForm),l(23),g("matDatepicker",t),l(),g("for",t),l(9),re(n.countries())}}function Xi(i,e){if(i&1&&(a(0,"mat-option",21),r(1),o()),i&2){let t=e.$implicit;g("value",t.name),l(),C(" ",t.name," ")}}function eo(i,e){if(i&1&&(a(0,"div",5)(1,"h4",12),r(2,"Address"),o(),a(3,"div",40)(4,"mat-form-field",6)(5,"mat-label"),r(6,"Street"),o(),_(7,"input",41),o(),a(8,"div",15)(9,"mat-form-field",6)(10,"mat-label"),r(11,"City"),o(),_(12,"input",42),o(),a(13,"mat-form-field",6)(14,"mat-label"),r(15,"State/Province"),o(),_(16,"input",43),o()(),a(17,"div",15)(18,"mat-form-field",6)(19,"mat-label"),r(20,"Country"),o(),a(21,"mat-select",44)(22,"mat-option",31),r(23,"-- Select Country --"),o(),ae(24,Xi,2,2,"mat-option",21,cn),o()(),a(26,"mat-form-field",6)(27,"mat-label"),r(28,"Postal Code"),o(),_(29,"input",45),o()()()()),i&2){let t=u();g("formGroup",t.addressForm),l(24),re(t.countries())}}function to(i,e){if(i&1&&(a(0,"div",5)(1,"h4",12),r(2,"Emergency Contact"),o(),a(3,"div",40)(4,"div",15)(5,"mat-form-field",6)(6,"mat-label"),r(7,"Name"),o(),_(8,"input",46),o(),a(9,"mat-form-field",6)(10,"mat-label"),r(11,"Relationship"),o(),_(12,"input",47),o()(),a(13,"div",15)(14,"mat-form-field",6)(15,"mat-label"),r(16,"Phone"),o(),_(17,"input",48),o(),a(18,"mat-form-field",6)(19,"mat-label"),r(20,"Email"),o(),_(21,"input",49),o()()()()),i&2){let t=u();g("formGroup",t.emergencyContactForm)}}function no(i,e){i&1&&(a(0,"mat-form-field",6)(1,"mat-label"),r(2,"Notes"),o(),_(3,"textarea",50),o())}function io(i,e){i&1&&(a(0,"mat-icon",10),r(1,"refresh"),o())}function oo(i,e){i&1&&(a(0,"mat-icon",51),r(1,"edit_outline"),o())}function ao(i,e){i&1&&(a(0,"mat-icon",51),r(1,"person_add"),o())}function ro(i,e){if(i&1&&f(0,oo,2,0,"mat-icon",51)(1,ao,2,0,"mat-icon",51),i&2){let t=u();h(t.isEditing()?0:1)}}function so(i,e){i&1&&r(0," Update Guest ")}function lo(i,e){i&1&&r(0," Create Guest ")}var Me=class i{dialogRef=v(Yt);fb=v(Re);snackBar=v(at);guestService=v(je);storeStore=v(W);locationService=v(mn);dialogData=v(Qt,{optional:!0});destroy$=new Qe;isSaving=R(!1);countries=R([]);nationalities=R([]);guestType=R("individual");ageGrade=R("adult");isEditing=R(!1);editingGuestId=R(null);isChildGuest=x(()=>this.ageGrade()==="child");guestForm;constructor(){let e=this.dialogData?.guest,t=this.dialogData?.bookingType||"single",n=this.dialogData?.ageGrade||"adult";if(this.ageGrade.set(n),e){this.isEditing.set(!0),this.editingGuestId.set(e._id);let s=e.guestType||"individual";this.guestType.set(s)}else n==="child"?this.guestType.set("individual"):t==="group"&&this.guestType.set("corporate");this.guestForm=this.createForm(),this.countries.set(this.locationService.getCountries()),this.nationalities.set(this.locationService.getNationalities()),e&&this.populateFormWithGuest(e)}ngOnInit(){this.updateValidators()}populateFormWithGuest(e){let t={guestType:e.guestType||"individual",email:e.email||"",phone:e.phone||"",nationality:e.nationality||"",dateOfBirth:e.dateOfBirth||"",firstName:e.firstName||"",lastName:e.lastName||"",companyName:e.companyName||"",companyRegistrationNumber:e.companyRegistrationNumber||"",contactPersonFirstName:e.contactPersonFirstName||"",contactPersonLastName:e.contactPersonLastName||"",contactPersonTitle:e.contactPersonTitle||"",notes:e.notes||"",idDocument:{type:e.idDocument?.type||"passport",number:e.idDocument?.number||"",expiryDate:e.idDocument?.expiryDate||"",issuingCountry:e.idDocument?.issuingCountry||""},address:{street:e.address?.street||"",city:e.address?.city||"",state:e.address?.state||"",country:e.address?.country||"",postalCode:e.address?.postalCode||""},emergencyContact:{name:e.emergencyContact?.name||"",relationship:e.emergencyContact?.relationship||"",phone:e.emergencyContact?.phone||"",email:e.emergencyContact?.email||""}};this.guestForm.patchValue(t)}updateValidators(){let e=this.guestType(),t=this.isChildGuest(),n=this.guestForm.get("firstName"),s=this.guestForm.get("lastName"),m=this.guestForm.get("email"),d=this.guestForm.get("phone"),p=this.guestForm.get("companyName"),y=this.guestForm.get("contactPersonFirstName"),D=this.guestForm.get("contactPersonLastName");t||e==="individual"?(n?.setValidators([c.required,c.minLength(2)]),s?.setValidators([c.required,c.minLength(2)]),t?(m?.clearValidators(),d?.clearValidators()):(m?.setValidators([c.required,c.email]),d?.setValidators([c.required])),p?.clearValidators(),y?.clearValidators(),D?.clearValidators()):e==="corporate"&&(n?.clearValidators(),s?.clearValidators(),m?.setValidators([c.required,c.email]),d?.setValidators([c.required]),p?.setValidators([c.required,c.minLength(2)]),y?.setValidators([c.required,c.minLength(2)]),D?.setValidators([c.required,c.minLength(2)])),n?.updateValueAndValidity(),s?.updateValueAndValidity(),m?.updateValueAndValidity(),d?.updateValueAndValidity(),p?.updateValueAndValidity(),y?.updateValueAndValidity(),D?.updateValueAndValidity()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}createForm(){return this.fb.group({guestType:[this.guestType(),[c.required]],firstName:[""],lastName:[""],dateOfBirth:[""],nationality:[""],companyName:[""],companyRegistrationNumber:[""],contactPersonFirstName:[""],contactPersonLastName:[""],contactPersonTitle:[""],email:["",[c.required,c.email]],phone:[""],idDocument:this.fb.group({type:["passport"],number:[""],expiryDate:[""],issuingCountry:[""]}),address:this.fb.group({street:[""],city:[""],state:[""],country:[""],postalCode:[""]}),emergencyContact:this.fb.group({name:[""],relationship:[""],phone:[""],email:[""]}),notes:[""]})}get addressForm(){return this.guestForm.get("address")}get emergencyContactForm(){return this.guestForm.get("emergencyContact")}get idDocumentForm(){return this.guestForm.get("idDocument")}onSelectExistingGuest(e){this.dialogRef.close(e)}onSubmit(){return Ce(this,null,function*(){if(this.guestForm.invalid){this.markFormGroupTouched(this.guestForm),this.showError("Please fill in all required fields correctly");return}this.isSaving.set(!0);try{let e=this.guestForm.value,t=this.prepareGuestData(e),n;if(this.isEditing()){let s=this.editingGuestId();if(!s){this.showError("Guest ID is missing");return}n=yield this.guestService.updateGuest(s,t).toPromise(),this.showSuccess("Guest updated successfully")}else n=yield this.guestService.createGuest(t).toPromise(),this.showSuccess("Guest created successfully");this.dialogRef.close(n)}catch(e){console.error("Error saving guest:",e),this.showError(this.isEditing()?"Failed to update guest":"Failed to create guest")}finally{this.isSaving.set(!1)}})}prepareGuestData(e){let t=this.storeStore.selectedStore()?._id,n=e.guestType||"individual";if(this.isChildGuest())return{guestType:"individual",firstName:e.firstName,lastName:e.lastName,dateOfBirth:e.dateOfBirth,stores:t?[t]:[]};let m={guestType:n,email:e.email,phone:e.phone,idDocument:e.idDocument,address:e.address,emergencyContact:e.emergencyContact,notes:e.notes,stores:t?[t]:[]};return n==="individual"?Sn(bn({},m),{firstName:e.firstName,lastName:e.lastName,dateOfBirth:e.dateOfBirth,nationality:e.nationality}):Sn(bn({},m),{companyName:e.companyName,companyRegistrationNumber:e.companyRegistrationNumber,contactPersonFirstName:e.contactPersonFirstName,contactPersonLastName:e.contactPersonLastName,contactPersonTitle:e.contactPersonTitle})}onCancel(){this.dialogRef.close()}getFieldError(e){let t=this.guestForm.get(e);if(t&&t.errors&&t.touched){if(t.errors.required)return`${this.getFieldLabel(e)} is required`;if(t.errors.email)return"Please enter a valid email address";if(t.errors.minlength)return`${this.getFieldLabel(e)} must be at least ${t.errors.minlength.requiredLength} characters`}return""}getFieldLabel(e){return{firstName:"First Name",lastName:"Last Name",email:"Email",phone:"Phone Number"}[e]||e}markFormGroupTouched(e){Object.keys(e.controls).forEach(t=>{let n=e.get(t);n?.markAsTouched({onlySelf:!0}),n instanceof Kt&&this.markFormGroupTouched(n)})}showSuccess(e){this.snackBar.open(e,"Close",{duration:3e3,panelClass:["success-snackbar"]})}showError(e){this.snackBar.open(e,"Close",{duration:5e3,panelClass:["error-snackbar"]})}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-guest-form-modal"]],decls:22,vars:13,consts:[["dateOfBirthPicker",""],["expiryDatePicker",""],[1,"max-h-[70vh]","overflow-y-auto"],[1,"mb-6","pb-6","border-b","border-gray-200"],[1,"space-y-6",3,"formGroup"],[3,"formGroup"],["appearance","outline",1,"w-full"],["align","end",1,"pt-4"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"animate-spin","mr-2"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[1,"font-semibold","text-sm","text-gray-700","mb-3"],[1,"text-xs","text-gray-500","mb-3"],["label","Select Guest","placeholder","Search by name or email...",3,"guestSelected"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["matInput","","formControlName","firstName","placeholder","Enter first name","required",""],["matInput","","formControlName","lastName","placeholder","Enter last name","required",""],["matInput","","formControlName","dateOfBirth","placeholder","Select date of birth","readonly","",3,"matDatepicker"],["matIconSuffix","",3,"for"],["formControlName","nationality","placeholder","Select nationality"],[3,"value"],["matInput","","formControlName","companyName","placeholder","Enter company name","required",""],["matInput","","formControlName","companyRegistrationNumber","placeholder","Enter registration number"],["matInput","","formControlName","contactPersonFirstName","placeholder","Enter first name","required",""],["matInput","","formControlName","contactPersonLastName","placeholder","Enter last name","required",""],["appearance","outline",1,"w-full","md:col-span-2"],["matInput","","formControlName","contactPersonTitle","placeholder","e.g. Manager, Director"],["matInput","","formControlName","email","placeholder","Enter email address","type","email","required",""],["matInput","","formControlName","phone","placeholder","Enter phone number"],["formControlName","nationality"],["value",""],["formControlName","type"],["value","passport"],["value","national_id"],["value","drivers_license"],["value","other"],["matInput","","formControlName","number","placeholder","Enter document number"],["matInput","","formControlName","expiryDate","placeholder","Select expiry date","readonly","",3,"matDatepicker"],["formControlName","issuingCountry"],[1,"space-y-4"],["matInput","","formControlName","street","placeholder","Enter street address"],["matInput","","formControlName","city","placeholder","Enter city"],["matInput","","formControlName","state","placeholder","Enter state/province"],["formControlName","country"],["matInput","","formControlName","postalCode","placeholder","Enter postal code"],["matInput","","formControlName","name","placeholder","Emergency contact name"],["matInput","","formControlName","relationship","placeholder","e.g., Family, Friend"],["matInput","","formControlName","phone","placeholder","Emergency contact phone"],["matInput","","formControlName","email","placeholder","Emergency contact email","type","email"],["matInput","","formControlName","notes","placeholder","Add any additional notes about the guest","rows","3"],[1,"mr-2"]],template:function(t,n){t&1&&(f(0,Ri,3,1)(1,ki,3,1),a(2,"mat-dialog-content",2),f(3,Gi,6,0,"div",3),a(4,"form",4)(5,"div"),f(6,Bi,28,6)(7,Ki,29,6),o(),f(8,zi,14,2,"div"),f(9,Zi,12,0,"div"),f(10,Qi,35,3,"div",5),f(11,eo,30,1,"div",5),f(12,to,22,1,"div",5),f(13,no,4,0,"mat-form-field",6),o()(),a(14,"mat-dialog-actions",7)(15,"button",8),b("click",function(){return n.onCancel()}),r(16,"Cancel"),o(),a(17,"button",9),b("click",function(){return n.onSubmit()}),f(18,io,2,0,"mat-icon",10)(19,ro,2,1),f(20,so,1,0)(21,lo,1,0),o()()),t&2&&(h(n.isEditing()?0:1),l(3),h(n.isEditing()?-1:3),l(),g("formGroup",n.guestForm),l(2),h(n.guestType()==="individual"?6:7),l(2),h(n.isChildGuest()?-1:8),l(),h(n.isChildGuest()?-1:9),l(),h(n.isChildGuest()?-1:10),l(),h(n.isChildGuest()?-1:11),l(),h(n.isChildGuest()?-1:12),l(),h(n.isChildGuest()?-1:13),l(4),g("disabled",n.isSaving()||n.guestForm.invalid),l(),h(n.isSaving()?18:19),l(2),h(n.isEditing()?20:21))},dependencies:[w,ee,Ve,ve,de,X,Qn,U,ce,nn,Xt,tn,en,K,Te,pe,ue,st,qe,ge,ke,Ee,j,me,A,z,O,ie,Ne,Ie,oi,ai,Ue,it,ei,on],encapsulation:2})};var oe=class i{formSubject=new kn(null);form$=this.formSubject.asObservable();setForm(e){this.formSubject.next(e)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=Vt({token:i,factory:i.\u0275fac,providedIn:"root"})};function mo(i,e){if(i&1){let t=N();a(0,"div",1)(1,"div",4)(2,"mat-icon",5),r(3,"person_outline"),o(),a(4,"p",6),r(5,"No guest selected"),o()(),a(6,"app-guest-search",7),b("guestSelected",function(s){S(t);let m=u();return F(m.onGuestSearchSelected(s))}),o()()}if(i&2){let t=u();l(6),g("guestType",t.bookingType()==="group"?"group":"single")}}function co(i,e){if(i&1&&(a(0,"mat-list-item")(1,"mat-icon",8),r(2,"mail_outline"),o(),a(3,"div",10),r(4,"Email"),o(),a(5,"div",11),r(6),o()()),i&2){let t,n=u(2);l(6),T((t=n.guest())==null?null:t.email)}}function uo(i,e){if(i&1&&(a(0,"mat-list-item")(1,"mat-icon",8),r(2,"phone_outline"),o(),a(3,"div",10),r(4,"Phone"),o(),a(5,"div",11),r(6),o()()),i&2){let t,n=u(2);l(6),T((t=n.guest())==null?null:t.phone)}}function po(i,e){if(i&1&&(a(0,"mat-list-item")(1,"mat-icon",8),r(2,"cake_outline"),o(),a(3,"div",10),r(4,"Date of Birth"),o(),a(5,"div",11),r(6),M(7,"date"),o()()),i&2){let t,n=u(2);l(6),C(" ",$(7,1,(t=n.guest())==null?null:t.dateOfBirth,"MMM dd, yyyy")," ")}}function go(i,e){if(i&1&&(a(0,"mat-list-item")(1,"mat-icon",8),r(2,"verified_outline"),o(),a(3,"div",10),r(4,"Registration Number"),o(),a(5,"div",11),r(6),o()()),i&2){let t,n=u(2);l(6),C(" ",(t=n.guest())==null?null:t.companyRegistrationNumber," ")}}function fo(i,e){if(i&1&&(a(0,"span"),r(1),o()),i&2){let t,n=u(3);l(),C("",(t=n.guest())==null||t.address==null?null:t.address.street,", ")}}function ho(i,e){if(i&1&&(a(0,"span"),r(1),o()),i&2){let t,n=u(3);l(),C("",(t=n.guest())==null||t.address==null?null:t.address.city,", ")}}function _o(i,e){if(i&1&&(a(0,"span"),r(1),o()),i&2){let t,n=u(3);l(),T((t=n.guest())==null||t.address==null?null:t.address.country)}}function Co(i,e){if(i&1&&(a(0,"mat-list-item")(1,"mat-icon",8),r(2,"location_on_outline"),o(),a(3,"div",10),r(4,"Address"),o(),a(5,"div",11),f(6,fo,2,1,"span"),f(7,ho,2,1,"span"),f(8,_o,2,1,"span"),o()()),i&2){let t,n,s,m=u(2);l(6),h(!((t=m.guest())==null||t.address==null)&&t.address.street?6:-1),l(),h(!((n=m.guest())==null||n.address==null)&&n.address.city?7:-1),l(),h(!((s=m.guest())==null||s.address==null)&&s.address.country?8:-1)}}function vo(i,e){if(i&1&&(a(0,"div",1)(1,"mat-list")(2,"mat-list-item")(3,"mat-icon",8),r(4,"account_circle"),o(),a(5,"div",9),r(6),M(7,"getGuestName"),o()(),f(8,co,7,1,"mat-list-item"),f(9,uo,7,1,"mat-list-item"),f(10,po,8,4,"mat-list-item"),f(11,go,7,1,"mat-list-item"),f(12,Co,9,3,"mat-list-item"),o()()),i&2){let t,n,s,m,d,p=u();l(6),C(" ",Ae(7,6,p.guest())," "),l(2),h((t=p.guest())!=null&&t.email?8:-1),l(),h((n=p.guest())!=null&&n.phone?9:-1),l(),h(p.bookingType()==="single"&&((s=p.guest())!=null&&s.dateOfBirth)?10:-1),l(),h(p.bookingType()==="group"&&((m=p.guest())!=null&&m.companyRegistrationNumber)?11:-1),l(),h((d=p.guest())!=null&&d.address?12:-1)}}function yo(i,e){if(i&1){let t=N();a(0,"button",12),b("click",function(){S(t);let s=u();return F(s.onAddGuest())}),a(1,"mat-icon",13),r(2,"person_add_outline"),o(),r(3," Add Guest "),o()}}function xo(i,e){if(i&1){let t=N();a(0,"button",14),b("click",function(){S(t);let s=u();return F(s.onEditGuest())}),a(1,"mat-icon",13),r(2,"edit_outline"),o(),r(3," Edit "),o(),a(4,"button",15),b("click",function(){S(t);let s=u();return F(s.onDeleteGuest())}),a(5,"mat-icon",13),r(6,"delete_outline"),o(),r(7," Delete "),o()}}var un=class i{reservationFormService=v(oe);reservationForm=L(this.reservationFormService.form$,{initialValue:null});guest=P(null);bookingType=R(this.reservationForm().get("bookingType")?.value||"single");guestAdded=se();guestEdited=se();guestDeleted=se();guestSelected=se();dialog=v(Ke);onAddGuest(){this.dialog.open(Me,{width:"600px",disableClose:!1,data:{bookingType:this.bookingType(),ageGrade:"adult"}}).afterClosed().subscribe(t=>{t&&this.onGuestSearchSelected(t)})}onGuestSearchSelected(e){this.guestSelected.emit(e)}onEditGuest(){let e=this.guest();if(!e)return;this.dialog.open(Me,{width:"600px",disableClose:!1,data:{guest:e,bookingType:this.bookingType(),ageGrade:"adult"}}).afterClosed().subscribe(n=>{n&&this.guestEdited.emit()})}onDeleteGuest(){confirm("Are you sure you want to remove this guest?")&&this.guestDeleted.emit()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-guest-details"]],inputs:{guest:[1,"guest"]},outputs:{guestAdded:"guestAdded",guestEdited:"guestEdited",guestDeleted:"guestDeleted",guestSelected:"guestSelected"},decls:10,vars:4,consts:[["appearance","outlined"],[1,"space-y-4"],[1,"border-t","border-gray-200","pt-4","flex","justify-end","gap-2"],["type","button","matButton","filled","color","primary"],[1,"text-center","py-4"],[1,"text-gray-300","text-6xl","mb-4","inline-block"],[1,"text-gray-500","text-sm","mb-4"],["placeholder","Search for existing guest...","label","Select Guest",3,"guestSelected","guestType"],["matListItemIcon","",1,"text-gray-600!","material-icons-outlined"],["matListItemTitle","",1,"text-xl","font-semibold","text-gray-900"],["matListItemTitle","",1,"text-sm","text-gray-600!"],["matListItemLine","",1,"text-gray-900","font-medium"],["type","button","matButton","filled","color","primary",3,"click"],[1,"mr-2"],["type","button","mat-button","","color","primary",3,"click"],["type","button","mat-button","","color","warn",3,"click"]],template:function(t,n){t&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),r(3),o()(),a(4,"mat-card-content"),f(5,mo,7,1,"div",1),f(6,vo,13,8,"div",1),o(),a(7,"mat-card-actions",2),f(8,yo,4,0,"button",3)(9,xo,8,0),o()()),t&2&&(l(3),C(" ",n.bookingType()==="single"?"Guest Details":"Booking Owner Details"," "),l(2),h(n.guest()?-1:5),l(),h(n.guest()?6:-1),l(2),h(n.guest()?9:8))},dependencies:[w,O,J,zn,Y,Q,Z,j,me,A,z,ie,K,Ge,mt,dt,ii,ti,Jt,on,Be,mi],styles:["[_nghost-%COMP%]{display:block}"]})};function bo(i,e){if(i&1){let t=N();a(0,"form",2)(1,"div",3)(2,"mat-form-field",4)(3,"mat-label"),r(4,"Stay Dates"),o(),a(5,"mat-date-range-input",5)(6,"input",6),b("change",function(){S(t);let s=u();return F(s.onDateChange())}),o(),a(7,"input",7),b("change",function(){S(t);let s=u();return F(s.onDateChange())}),o()(),_(8,"mat-datepicker-toggle",8),a(9,"mat-hint"),r(10),o(),_(11,"mat-date-range-picker",null,0),o(),a(13,"mat-form-field",4)(14,"mat-label"),r(15,"Sales Person"),o(),_(16,"input",9),o(),a(17,"mat-form-field",4)(18,"mat-label"),r(19,"Number of Nights"),o(),_(20,"input",10),o(),a(21,"mat-form-field",4)(22,"mat-label"),r(23,"Booking Source"),o(),a(24,"mat-select",11)(25,"mat-option",12),r(26,"-- Select Source --"),o(),a(27,"mat-option",13),r(28,"Direct"),o(),a(29,"mat-option",14),r(30,"Phone"),o(),a(31,"mat-option",15),r(32,"Online"),o(),a(33,"mat-option",16),r(34,"Walk-in"),o(),a(35,"mat-option",17),r(36,"Booking.com"),o(),a(37,"mat-option",18),r(38,"Expedia"),o(),a(39,"mat-option",19),r(40,"Airbnb"),o(),a(41,"mat-option",20),r(42,"Travel Agent"),o(),a(43,"mat-option",21),r(44,"Corporate"),o()()()()()}if(i&2){let t=we(12),n=u();g("formGroup",n.reservationForm()),l(5),g("rangePicker",t),l(3),g("for",t),l(2),C("",n.numberOfNights()," night(s)"),l(6),g("value",n.salesPersonName())}}var pn=class i{route=v(nt);reservationFormService=v(oe);reservation=P();reservationForm=L(this.reservationFormService.form$,{initialValue:null});id=R(this.route.snapshot.paramMap.get("id"));checkInDate=L(this.reservationForm().get("checkInDate").valueChanges,{initialValue:this.reservationForm().get("checkInDate").value});checkOutDate=L(this.reservationForm().get("checkOutDate").valueChanges,{initialValue:this.reservationForm().get("checkOutDate").value});numberOfNights=x(()=>{let e=this.checkInDate(),t=this.checkOutDate();if(e&&t){let n=Math.abs(t.getTime()-e.getTime());return Math.ceil(n/(1e3*60*60*24))}return 0});fb=v(Re);authService=v(Ut);quickReservation=P(null);isEditing=P(!1);dateChanged=se();currentUser=L(this.authService.currentUser,{initialValue:null});salesPersonName=x(()=>{let e=this.isEditing()?this.reservation()?.createdBy:this.currentUser();return console.log("user for salesPersonName:",e),e&&e.name||""});ngAfterViewInit(){this.reservationForm()?.valueChanges.pipe(Bt((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(e=>{this.reservationForm()?.patchValue({createdBy:this.reservation()?.createdBy?._id||this.currentUser()?._id,checkInDate:this.checkInDate(),checkOutDate:this.checkOutDate(),numberOfNights:this.numberOfNights()},{emitEvent:!1})})}onDateChange(){this.dateChanged.emit()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-stay-details"]],inputs:{reservation:[1,"reservation"],quickReservation:[1,"quickReservation"],isEditing:[1,"isEditing"]},outputs:{dateChanged:"dateChanged"},features:[qt([],[{provide:Zn,useExisting:U}])],decls:6,vars:1,consts:[["stayPicker",""],["appearance","outlined"],[3,"formGroup"],[1,"space-y-4","py-3"],["appearance","outline",1,"w-full"],[3,"rangePicker"],["matStartDate","","formControlName","checkInDate","placeholder","Check-in date",3,"change"],["matEndDate","","formControlName","checkOutDate","placeholder","Check-out date",3,"change"],["matSuffix","",3,"for"],["matInput","","readonly","",3,"value"],["formControlName","numberOfNights","matInput","","readonly",""],["formControlName","bookingSource"],["value",""],["value","direct"],["value","phone"],["value","online"],["value","walk_in"],["value","booking_com"],["value","expedia"],["value","airbnb"],["value","travel_agent"],["value","corporate"]],template:function(t,n){t&1&&(a(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title"),r(3," Stay Details "),o()(),a(4,"mat-card-content"),f(5,bo,45,5,"form",2),o()()),t&2&&(l(5),h(n.reservationForm()?5:-1))},dependencies:[w,ee,Ve,ve,de,X,U,ce,O,J,Y,Q,Z,K,Te,pe,ue,De,qe,ie,ge,ke,Ee,Ie,Ue,St,Ft,Mt,Et,A,j],encapsulation:2})};function So(i,e){if(i&1&&(a(0,"mat-list-item",13)(1,"span",14)(2,"span",15),r(3,"\u{1F4E6}"),o(),r(4," Orders Total "),o(),a(5,"span",16),r(6),M(7,"currency"),o()(),a(8,"mat-list-item",17)(9,"span",18),r(10,"Orders Paid"),o(),a(11,"span",19),r(12),M(13,"currency"),o()(),a(14,"mat-list-item",20)(15,"span",18),r(16,"Orders Balance"),o(),a(17,"span",21),r(18),M(19,"currency"),o()(),_(20,"mat-divider")),i&2){let t,n,s,m=u();l(6),C(" ",H(7,7,m.ordersGrandTotal(),(t=m.storeStore.selectedStore())==null?null:t.currency,"symbol","1.2-2")," "),l(6),C(" ",H(13,12,m.ordersPaidAmount(),(n=m.storeStore.selectedStore())==null?null:n.currency,"symbol","1.2-2")," "),l(5),In("text-red-700",m.ordersBalanceAmount()>0)("text-green-700",m.ordersBalanceAmount()<=0),l(),C(" ",H(19,17,m.ordersBalanceAmount(),(s=m.storeStore.selectedStore())==null?null:s.currency,"symbol","1.2-2")," ")}}var Gt=class i{reservation=P(null);reservationFormService=v(oe);reservationForm=L(this.reservationFormService.form$,{initialValue:null});storeStore=v(W);roomsChangeCounter=R(0);getRoomsFormArray(){let e=this.reservationForm();return e?e.get("rooms"):null}totalNumberOfNights=x(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,n)=>{let s=n.get("stayPeriod");return t+(s?.get("numberOfNights")?.value||0)},0):0});breakdownSubtotal=x(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,n)=>{let s=n.get("pricing");if(s){let m=s.get("totalPrice")?.value||0;return t+m}return t},0):0});breakdownServiceFee=x(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,n)=>{let s=n.get("pricing")?.get("fees");return t+(s?.get("serviceFee")?.value||0)},0):0});breakdownCleaningFee=x(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,n)=>{let s=n.get("pricing")?.get("fees");return t+(s?.get("cleaningFee")?.value||0)},0):0});breakdownResortFee=x(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,n)=>{let s=n.get("pricing")?.get("fees");return t+(s?.get("resortFee")?.value||0)},0):0});breakdownOtherFees=x(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,n)=>{let s=n.get("pricing")?.get("fees");return t+(s?.get("other")?.value||0)},0):0});breakdownTotalFees=x(()=>this.breakdownServiceFee()+this.breakdownCleaningFee()+this.breakdownResortFee()+this.breakdownOtherFees());breakdownTaxes=x(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,n)=>{let s=n.get("pricing");return t+(s?.get("taxes")?.value||0)},0):0});breakdownDiscount=x(()=>{this.roomsChangeCounter();let e=this.getRoomsFormArray();return e?e.controls.reduce((t,n)=>{let s=n.get("pricing");return t+(s?.get("discount")?.value||0)},0):0});breakdownGrandTotal=x(()=>this.breakdownSubtotal()+this.breakdownTotalFees()+this.breakdownTaxes()-this.breakdownDiscount());pricingChangeCounter=R(0);paidAmount=x(()=>{this.pricingChangeCounter();let e=this.reservationForm();return e&&e.get("pricing")?.get("paid")?.value||0});breakdownBalance=x(()=>this.breakdownGrandTotal()-this.paidAmount());ordersGrandTotal=x(()=>{let e=this.reservation();return!e||!e.orders?0:e.orders.reduce((n,s)=>n+(s.total||s.orderCalculation?.totalPrice||0),0)});ordersPaidAmount=x(()=>{let e=this.reservation();return!e||!e.pricing?0:e.pricing.ordersPaid||0});ordersBalanceAmount=x(()=>{let e=this.reservation();return!e||!e.pricing?0:e.pricing.ordersBalance||0});constructor(){let e=this.getRoomsFormArray();e&&e.valueChanges.subscribe(()=>{this.roomsChangeCounter.update(t=>t+1)}),Pe(()=>{let t=this.reservationForm();if(t){let n=t.get("pricing");n&&n.valueChanges.subscribe(()=>{this.pricingChangeCounter.update(s=>s+1)})}},{allowSignalWrites:!0}),Pe(()=>{let n=this.reservationForm()?.get("pricing");n&&n.patchValue({subtotal:this.breakdownSubtotal(),taxes:this.breakdownTaxes(),fees:{serviceFee:this.breakdownServiceFee(),cleaningFee:this.breakdownCleaningFee(),resortFee:this.breakdownResortFee(),other:this.breakdownOtherFees()},discounts:this.breakdownDiscount(),total:this.breakdownGrandTotal(),balance:this.breakdownBalance()},{emitEvent:!1})})}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["break-down-total"]],inputs:{reservation:[1,"reservation"]},decls:86,vars:75,consts:[[1,"mt-6",3,"formGroup"],[1,"text-sm","font-bold","text-gray-800","mb-4","flex","items-center","gap-2"],["formGroupName","pricing"],["matListItemTitle",""],["matListItemMeta","",1,"font-semibold"],["matListItemMeta",""],["matListItemTitle","",1,"font-semibold"],[1,"py-4"],["matListItemTitle","",1,"font-bold","text-lg"],["matListItemMeta","",1,"font-bold","text-lg"],[1,"py-4","bg-indigo-50"],["matListItemTitle","",1,"font-bold","text-indigo-900"],["matListItemMeta","",1,"font-bold","text-indigo-900"],[1,"py-4","bg-green-50"],["matListItemTitle","",1,"font-bold","text-green-900","flex","items-center","gap-2"],[1,"text-sm"],["matListItemMeta","",1,"font-bold","text-green-900"],[1,"py-2","pl-8"],["matListItemTitle","",1,"text-sm","text-gray-700"],["matListItemMeta","",1,"text-sm","text-green-700"],[1,"py-2","pl-8","mb-2"],["matListItemMeta","",1,"text-sm"]],template:function(t,n){if(t&1&&(a(0,"div",0)(1,"h3",1),r(2," Price Breakdown "),o(),a(3,"mat-list",2)(4,"mat-list-item")(5,"span",3),r(6,"Total Nights"),o(),a(7,"span",4),r(8),o()(),a(9,"mat-list-item")(10,"span",3),r(11,"Base Total (all rooms)"),o(),a(12,"span",5),r(13),M(14,"currency"),o()(),a(15,"mat-list-item")(16,"span",3),r(17,"Service Fee"),o(),a(18,"span",5),r(19),M(20,"currency"),o()(),a(21,"mat-list-item")(22,"span",3),r(23,"Cleaning Fee"),o(),a(24,"span",5),r(25),M(26,"currency"),o()(),a(27,"mat-list-item")(28,"span",3),r(29,"Resort Fee"),o(),a(30,"span",5),r(31),M(32,"currency"),o()(),a(33,"mat-list-item")(34,"span",3),r(35,"Other Fees"),o(),a(36,"span",5),r(37),M(38,"currency"),o()(),_(39,"mat-divider"),a(40,"mat-list-item")(41,"span",6),r(42,"Total Fees"),o(),a(43,"span",4),r(44),M(45,"currency"),o()(),_(46,"mat-divider"),a(47,"mat-list-item")(48,"span",3),r(49,"Taxes"),o(),a(50,"span",5),r(51),M(52,"currency"),o()(),a(53,"mat-list-item")(54,"span",3),r(55,"Discount"),o(),a(56,"span",5),r(57),M(58,"currency"),o()(),_(59,"mat-divider"),a(60,"mat-list-item",7)(61,"span",8),r(62,"Grand Total"),o(),a(63,"span",9),r(64),M(65,"currency"),o()(),_(66,"mat-divider"),a(67,"mat-list-item",10)(68,"span",11),r(69,"Reservation Total"),o(),a(70,"span",12),r(71),M(72,"currency"),o()(),f(73,So,21,22),a(74,"mat-list-item",7)(75,"span",3),r(76,"Paid"),o(),a(77,"span",5),r(78),M(79,"currency"),o()(),a(80,"mat-list-item",7)(81,"span",3),r(82,"Balance"),o(),a(83,"span",5),r(84),M(85,"currency"),o()()()()),t&2){let s,m,d,p,y,D,E,q,I,be,te,ne;g("formGroup",n.reservationForm()),l(8),C(" ",n.totalNumberOfNights()," night(s) "),l(5),C(" ",H(14,15,n.breakdownSubtotal(),(s=n.storeStore.selectedStore())==null?null:s.currency,"symbol","1.2-2")," "),l(6),C(" ",H(20,20,n.breakdownServiceFee(),(m=n.storeStore.selectedStore())==null?null:m.currency,"symbol","1.2-2")," "),l(6),C(" ",H(26,25,n.breakdownCleaningFee(),(d=n.storeStore.selectedStore())==null?null:d.currency,"symbol","1.2-2")," "),l(6),C(" ",H(32,30,n.breakdownResortFee(),(p=n.storeStore.selectedStore())==null?null:p.currency,"symbol","1.2-2")," "),l(6),C(" ",H(38,35,n.breakdownOtherFees(),(y=n.storeStore.selectedStore())==null?null:y.currency,"symbol","1.2-2")," "),l(7),C(" ",H(45,40,n.breakdownTotalFees(),(D=n.storeStore.selectedStore())==null?null:D.currency,"symbol","1.2-2")," "),l(7),C(" ",H(52,45,n.breakdownTaxes(),(E=n.storeStore.selectedStore())==null?null:E.currency,"symbol","1.2-2")," "),l(6),C(" ",H(58,50,n.breakdownDiscount(),(q=n.storeStore.selectedStore())==null?null:q.currency,"symbol","1.2-2")," "),l(7),C(" ",H(65,55,n.breakdownGrandTotal(),(I=n.storeStore.selectedStore())==null?null:I.currency,"symbol","1.2-2")," "),l(7),C(" ",H(72,60,n.breakdownGrandTotal(),(be=n.storeStore.selectedStore())==null?null:be.currency,"symbol","1.2-2")," "),l(2),h(n.ordersGrandTotal()>0?73:-1),l(5),C(" ",H(79,65,n.paidAmount(),(te=n.storeStore.selectedStore())==null?null:te.currency,"symbol","1.2-2")," "),l(6),C(" ",H(85,70,n.breakdownBalance(),(ne=n.storeStore.selectedStore())==null?null:ne.currency,"symbol","1.2-2")," ")}},dependencies:[Ge,mt,dt,lt,Jt,ni,w,ee,X,U,Le,K,Tt,le],styles:["[_nghost-%COMP%]{display:block}"]})};var Ze=i=>({prefix:i}),Mo=(i,e)=>e.value;function Eo(i,e){if(i&1&&(a(0,"mat-option",10),r(1),o()),i&2){let t=e.$implicit;g("value",t.value),l(),C(" ",t.label," ")}}function Ro(i,e){if(i&1&&(a(0,"mat-hint"),r(1),M(2,"currency"),o()),i&2){let t,n=u();l(),C(" % of subtotal (= ",$(2,1,(n.subtotal()*n.discount()/100).toFixed(2),(t=n.storeStore.selectedStore())==null?null:t.currency),") ")}}function Do(i,e){i&1&&(a(0,"mat-hint"),r(1," Fixed amount "),o())}var It=class i{reservationFormService=v(oe);reservationForm=L(this.reservationFormService.form$,{initialValue:null});dialogRef=v(Yt);data=v(Qt);storeStore=v(W);destroy$=new Qe;discountTypeOptions=[{value:"percentage",label:"Percentage (%)"},{value:"amount",label:"Fixed Amount"}];pricingForm;stayPeriodForm=null;fees;constructor(){let e=this.reservationForm().get("rooms");this.pricingForm=e.at(this.data.roomIndex).get("pricing"),this.stayPeriodForm=e.at(this.data.roomIndex).get("stayPeriod"),this.fees=this.pricingForm.get("fees")}discountType=R("amount");taxes=R(0);discount=R(0);serviceFee=R(0);cleaningFee=R(0);resortFee=R(0);otherFee=R(0);numberOfNights=R(0);pricePerNight=R(0);subtotal=x(()=>{let e=this.pricePerNight(),t=this.numberOfNights();return e*t});discountAmount=x(()=>this.discountType()==="percentage"?this.subtotal()*this.discount()/100:this.discount());calculatedTotal=x(()=>{let e=this.subtotal(),t=this.discountAmount(),n=this.taxes(),s=this.serviceFee(),m=this.cleaningFee(),d=this.resortFee(),p=this.otherFee(),y=e-t+n+s+m+d+p;return Math.max(0,y)});eff=Pe(()=>{let e=this.calculatedTotal(),t=this.subtotal();this.pricingForm.patchValue({subtotal:t,total:e},{emitEvent:!1})});ngOnInit(){this.discountType.set(this.pricingForm?.get("discountType")?.value||"amount"),this.taxes.set(this.pricingForm?.get("taxes")?.value||0),this.discount.set(this.pricingForm?.get("discount")?.value||0),this.pricePerNight.set(this.pricingForm?.get("pricePerNight")?.value||0),this.fees&&(this.serviceFee.set(this.fees.get("serviceFee")?.value||0),this.cleaningFee.set(this.fees.get("cleaningFee")?.value||0),this.resortFee.set(this.fees.get("resortFee")?.value||0),this.otherFee.set(this.fees.get("other")?.value||0)),this.stayPeriodForm&&this.numberOfNights.set(this.stayPeriodForm.get("numberOfNights")?.value||0),this.pricingForm?.get("discountType")?.valueChanges.pipe(he(this.destroy$)).subscribe(e=>{this.discountType.set(e)}),this.pricingForm?.get("taxes")?.valueChanges.pipe(he(this.destroy$)).subscribe(e=>{this.taxes.set(e||0)}),this.pricingForm?.get("discount")?.valueChanges.pipe(he(this.destroy$)).subscribe(e=>{this.discount.set(e||0)}),this.pricingForm?.get("pricePerNight")?.valueChanges.pipe(he(this.destroy$)).subscribe(e=>{this.pricePerNight.set(e||0)}),this.fees&&(this.fees.get("serviceFee")?.valueChanges.pipe(he(this.destroy$)).subscribe(e=>{console.log("serviceFee changed:",e),this.serviceFee.set(e||0)}),this.fees.get("cleaningFee")?.valueChanges.pipe(he(this.destroy$)).subscribe(e=>{this.cleaningFee.set(e||0)}),this.fees.get("resortFee")?.valueChanges.pipe(he(this.destroy$)).subscribe(e=>{this.resortFee.set(e||0)}),this.fees.get("other")?.valueChanges.pipe(he(this.destroy$)).subscribe(e=>{this.otherFee.set(e||0)})),this.stayPeriodForm&&this.stayPeriodForm.get("numberOfNights")?.valueChanges.pipe(he(this.destroy$)).subscribe(e=>{this.numberOfNights.set(e||0)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onCancel(){this.dialogRef.close()}onSave(){this.pricingForm.valid&&this.dialogRef.close(this.pricingForm.value)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-price-edit-dialog"]],decls:96,vars:37,consts:[["mat-dialog-title",""],[1,"space-y-4",3,"formGroup"],[1,"space-y-3"],[1,"text-sm","font-semibold","text-gray-700"],[1,"grid","grid-cols-2","gap-2"],["appearance","outline",1,"w-full"],["matInput","","currencyMask","","formControlName","pricePerNight","readonly","",3,"options"],["matPrefix",""],["matInput","","currencyMask","","formControlName","subtotal","readonly","",3,"options"],["formControlName","discountType"],[3,"value"],["matInput","","type","number","formControlName","discount","placeholder","0"],["matInput","","currencyMask","","formControlName","taxes","placeholder","0.00",3,"options"],["formGroupName","fees",1,"space-y-3"],["matInput","","currencyMask","","formControlName","serviceFee","placeholder","0.00",3,"options"],["matInput","","currencyMask","","formControlName","cleaningFee","placeholder","0.00",3,"options"],["matInput","","currencyMask","","formControlName","resortFee","placeholder","0.00",3,"options"],["matInput","","currencyMask","","formControlName","other","placeholder","0.00",3,"options"],["matInput","","currencyMask","","formControlName","total","readonly","",1,"text-lg","font-bold",3,"options"],["align","end"],["matButton","outlined",3,"click"],["matButton","filled","color","primary",3,"click","disabled"]],template:function(t,n){if(t&1&&(a(0,"h2",0),r(1),o(),a(2,"mat-dialog-content")(3,"form",1)(4,"div",2)(5,"div",3),r(6,"Base Price (Before Discount)"),o(),a(7,"div",4)(8,"mat-form-field",5)(9,"mat-label"),r(10,"Price/Night"),o(),_(11,"input",6),a(12,"mat-icon",7),r(13),o()(),a(14,"mat-form-field",5)(15,"mat-label"),r(16,"Subtotal"),o(),_(17,"input",8),a(18,"mat-icon",7),r(19),o(),a(20,"mat-hint"),r(21),M(22,"currency"),o()()()(),_(23,"mat-divider"),a(24,"div",2)(25,"div",3),r(26,"Discount"),o(),a(27,"div",4)(28,"mat-form-field",5)(29,"mat-label"),r(30,"Discount Type"),o(),a(31,"mat-select",9),ae(32,Eo,2,2,"mat-option",10,Mo),o(),a(34,"mat-icon",7),r(35,"local_offer"),o()(),a(36,"mat-form-field",5)(37,"mat-label"),r(38,"Discount Value"),o(),_(39,"input",11),a(40,"mat-icon",7),r(41,"money_off"),o(),f(42,Ro,3,4,"mat-hint"),f(43,Do,2,0,"mat-hint"),o()()(),_(44,"mat-divider"),a(45,"div",2)(46,"div",3),r(47,"Taxes & Fees"),o(),a(48,"mat-form-field",5)(49,"mat-label"),r(50,"Taxes"),o(),_(51,"input",12),a(52,"mat-icon",7),r(53,"receipt"),o()(),a(54,"div",13)(55,"mat-form-field",5)(56,"mat-label"),r(57,"Service Fee"),o(),_(58,"input",14),a(59,"mat-icon",7),r(60,"room_service"),o()(),a(61,"mat-form-field",5)(62,"mat-label"),r(63,"Cleaning Fee"),o(),_(64,"input",15),a(65,"mat-icon",7),r(66,"cleaning_services"),o()(),a(67,"mat-form-field",5)(68,"mat-label"),r(69,"Resort Fee"),o(),_(70,"input",16),a(71,"mat-icon",7),r(72,"villa"),o()(),a(73,"mat-form-field",5)(74,"mat-label"),r(75,"Other Fee"),o(),_(76,"input",17),a(77,"mat-icon",7),r(78,"add_circle_outline"),o()()()(),_(79,"mat-divider"),a(80,"div",2)(81,"div",3),r(82,"Total Price (After Discount)"),o(),a(83,"mat-form-field",5)(84,"mat-label"),r(85,"Total"),o(),_(86,"input",18),a(87,"mat-icon",7),r(88),o(),a(89,"mat-hint"),r(90,"Subtotal - Discount + Taxes + Fees"),o()()()()(),a(91,"mat-dialog-actions",19)(92,"button",20),b("click",function(){return n.onCancel()}),r(93," Cancel "),o(),a(94,"button",21),b("click",function(){return n.onSave()}),r(95," Save Changes "),o()()),t&2){let s,m,d,p,y,D,E,q,I,be,te,ne,wt,At;l(),C("Edit Room Pricing (",n.numberOfNights(),") night(s)"),l(2),g("formGroup",n.pricingForm),l(8),g("options",_e(21,Ze,(s=n.storeStore.selectedStore())==null?null:s.currency)),l(2),T((m=n.storeStore.selectedStore())==null?null:m.currency),l(4),g("options",_e(23,Ze,(d=n.storeStore.selectedStore())==null?null:d.currency)),l(2),T((p=n.storeStore.selectedStore())==null?null:p.currency),l(2),Se("",$(22,18,n.pricePerNight(),(y=n.storeStore.selectedStore())==null?null:y.currency)," \xD7 ",n.numberOfNights()," nights"),l(11),re(n.discountTypeOptions),l(10),h(((D=n.pricingForm.get("discountType"))==null?null:D.value)==="percentage"?42:-1),l(),h(((E=n.pricingForm.get("discountType"))==null?null:E.value)==="amount"?43:-1),l(8),g("options",_e(25,Ze,(q=n.storeStore.selectedStore())==null?null:q.currency)),l(7),g("options",_e(27,Ze,(I=n.storeStore.selectedStore())==null?null:I.currency)),l(6),g("options",_e(29,Ze,(be=n.storeStore.selectedStore())==null?null:be.currency)),l(6),g("options",_e(31,Ze,(te=n.storeStore.selectedStore())==null?null:te.currency)),l(6),g("options",_e(33,Ze,(ne=n.storeStore.selectedStore())==null?null:ne.currency)),l(10),g("options",_e(35,Ze,(wt=n.storeStore.selectedStore())==null?null:wt.currency)),l(2),T((At=n.storeStore.selectedStore())==null?null:At.currency),l(6),g("disabled",!n.pricingForm.valid)}},dependencies:[w,ee,Ve,ve,jt,de,X,U,ce,Le,j,me,O,ie,pe,ue,De,zt,K,Te,A,z,ge,ke,Ee,He,lt,nn,Xt,tn,en,Tt,an,le],styles:["[_nghost-%COMP%]{display:block}.space-y-3[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:.75rem}.space-y-4[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:1rem}.grid[_ngcontent-%COMP%]{display:grid}.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3[_ngcontent-%COMP%]{grid-template-columns:repeat(3,minmax(0,1fr))}.gap-2[_ngcontent-%COMP%]{gap:.5rem}.w-full[_ngcontent-%COMP%]{width:100%}.text-sm[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.font-semibold[_ngcontent-%COMP%]{font-weight:600}.text-gray-700[_ngcontent-%COMP%]{color:#374151}.text-lg[_ngcontent-%COMP%]{font-size:1.125rem;line-height:1.75rem}.font-bold[_ngcontent-%COMP%]{font-weight:700}mat-form-field.ng-invalid.ng-touched[_ngcontent-%COMP%]     .mat-mdc-form-field-error{display:block}"]})};function To(i,e){if(i&1&&(a(0,"pre"),r(1),M(2,"currency"),o()),i&2){let t,n=u();l(),Pn("Selected Room: ",n.roomsResource.value().name," (",n.roomsResource.value().roomNumber,") - ",$(2,3,n.roomsResource.value().priceOverride,(t=n.storeStore.selectedStore())==null?null:t.currency)," ")}}function No(i,e){i&1&&(a(0,"div",9),_(1,"mat-spinner",11),o())}function ko(i,e){if(i&1){let t=N();a(0,"div",12)(1,"div",15)(2,"span",16),r(3),o(),a(4,"div",17)(5,"mat-icon",18),r(6,"person"),o(),a(7,"div",19)(8,"span",20),r(9),o(),a(10,"span",21),r(11),o()()(),a(12,"mat-form-field",22)(13,"mat-label"),r(14,"Check-in to Check-out"),o(),a(15,"mat-date-range-input",23),_(16,"input",24)(17,"input",25),o(),_(18,"mat-datepicker-toggle",26)(19,"mat-date-range-picker",null,0),a(21,"mat-hint"),r(22),o()(),a(23,"div",27)(24,"a",28),b("click",function(){let s,m=S(t),d=m.$implicit,p=m.$index,y=u(2);return F(y.editSharer(p,(s=d.get("ageGrade"))==null?null:s.value))}),a(25,"mat-icon",5),r(26,"edit"),o()(),a(27,"a",29),b("click",function(){let s=S(t).$index,m=u(2);return F(m.deleteSharer(s))}),a(28,"mat-icon",5),r(29,"delete"),o()()()()()}if(i&2){let t,n,s,m,d,p=e.$implicit,y=e.$index,D=we(20),E=u(2);g("formGroup",E.asFormGroup(p)),l(3),C(" P",y+1," "),l(6),C(" ",E.getSharerName(p)||"Unassigned Guest"," "),l(2),C(" ",((t=p.get("ageGrade"))==null?null:t.value)||"Adult"," "),l(4),g("rangePicker",D)("min",E.getReservationMinDate())("max",E.getReservationMaxDate()),l(3),g("for",D),l(4),C("",E.calculateNights((n=p.get("checkInDate"))==null?null:n.value,(n=p.get("checkOutDate"))==null?null:n.value)," night(s)"),l(2),g("matTooltip",Bn(!E.hasPrimaryGuest()&&((s=p.get("ageGrade"))==null?null:s.value)==="child"?"Assign primary guest first":"Edit Guest"))("disabled",!E.hasPrimaryGuest()&&((m=p.get("ageGrade"))==null?null:m.value)==="child")("ngClass",!E.hasPrimaryGuest()&&((d=p.get("ageGrade"))==null?null:d.value)==="child"?"text-gray-300":"text-blue-600 hover:bg-blue-50"),l(3),g("disabled",y===0)("ngClass",y===0?"text-gray-300 cursor-not-allowed":"text-red-600 hover:bg-red-50")}}function Go(i,e){i&1&&(a(0,"div",13)(1,"mat-icon",30),r(2,"group_off"),o(),a(3,"p",31),r(4,"No guests added yet"),o()())}function Io(i,e){if(i&1&&_(0,"break-down-total",14),i&2){let t=u(2);g("reservation",t.reservation())}}function Po(i,e){i&1&&(a(0,"div",13)(1,"mat-icon",30),r(2,"meeting_room"),o(),a(3,"p",31),r(4,"No rooms assigned yet"),o()())}function wo(i,e){if(i&1&&(a(0,"div",10),ae(1,ko,30,15,"div",12,Lt,!1,Go,5,0,"div",13),f(4,Io,1,1,"break-down-total",14)(5,Po,5,0,"div",13),o()),i&2){let t=u();l(),re(t.getSharersFormArray().controls),l(3),h(t.roomsResource.hasValue()?4:5)}}var gn=class i{fb=v(Re);storeStore=v(W);route=v(nt);guestService=v(je);id=R(this.route.snapshot.paramMap.get("id"));isEditing=x(()=>!!this.id());reservationFormService=v(oe);reservationForm=L(this.reservationFormService.form$,{initialValue:null});checkInDate=L(this.reservationForm().get("checkInDate").valueChanges,{initialValue:this.reservationForm().get("checkInDate").value});checkOutDate=L(this.reservationForm().get("checkOutDate").valueChanges,{initialValue:this.reservationForm().get("checkOutDate").value});numberOfAdults=L(this.reservationForm().get("numberOfAdults").valueChanges,{initialValue:this.reservationForm().get("numberOfAdults").value});numberOfChildren=L(this.reservationForm().get("numberOfChildren").valueChanges,{initialValue:this.reservationForm().get("numberOfChildren").value});quickReservation=P(null);selectedGuest=qn(null);reservation=P(null);sharerAdded=se();sharerEdited=se();sharerDeleted=se();sharersArrayUpdated=se();reservationMinDate=R(null);reservationMaxDate=R(null);dialog=v(Ke);roomService=v(Dt);roomsResource=Fe({params:()=>({roomId:this.isEditing()?this.reservation().rooms[0]?.room._id:this.quickReservation()?.selectedRoom,isEditing:this.isEditing()}),stream:({params:e})=>this.getRoom(e.roomId).pipe(Xe(t=>{e.isEditing?this.populateSharersFromReservation(this.reservation()):this.buildSharesOnNewReservation(),this.buildARoomForTheSharers(t)}))});populateSharersFromReservation(e){if(!e){console.log("[RoomSharers] No reservation provided, skipping population");return}console.log("[RoomSharers] populateSharersFromReservation called with reservation:",e);let t=this.getSharersFormArray();if(!t){console.warn("[RoomSharers] getSharersFormArray() returned null");return}t.clear(),console.log("[RoomSharers] Sharers array cleared"),e.sharers&&e.sharers.length>0?(console.log("[RoomSharers] Populating sharers from reservation.sharers:",e.sharers),e.sharers.forEach((n,s)=>{console.log(`[RoomSharers] Processing sharer ${s}:`,n);let m=this.fb.group({guest:[n.guest._id||n.guest,[c.required]],meta:[n.guest,[]],guestType:[n.guestType||"adult",[c.required]],checkInDate:[new Date(n.checkInDate),[c.required]],checkOutDate:[new Date(n.checkOutDate),[c.required]],ageGrade:[n.ageGrade||"",[]]});t.push(m),console.log(`[RoomSharers] Sharer ${s} added to form array. Current array length:`,t.length)})):console.warn("[RoomSharers] No sharers found in reservation"),console.log("[RoomSharers] populateSharersFromReservation completed. Final array length:",t.length)}buildSharesOnNewReservation(){let e=this.getSharersFormArray();if(e){let t=e.length,n=this.numberOfAdults()+this.numberOfChildren();if(t!==n){e.clear();for(let s=0;s<this.numberOfAdults();s++){let m=s===0&&this.selectedGuest()?this.selectedGuest()?._id:null;e.push(this.fb.group({guest:[m,[c.required]],guestType:["individual"],ageGrade:["adult"],checkInDate:[this.checkInDate()],checkOutDate:[this.checkOutDate()],meta:[null]}))}for(let s=0;s<this.numberOfChildren();s++)e.push(this.fb.group({guest:[null,[c.required]],meta:[null],guestType:["individual"],ageGrade:["child"],checkInDate:[this.checkInDate()],checkOutDate:[this.checkOutDate()]}));this.sharersArrayUpdated.emit(e)}}}buildARoomForTheSharers(e){console.log(e,"nvnbbnvv");let t=this.getRoomsFormArray();if(t&&e){let n=this.createRoomFormGroup(e,this.reservation()?.rooms[0]);t.clear(),t.push(n)}}createRoomFormGroup(e,t){let n=t?.pricing?.pricePerNight||0;n||(e.priceOverride?n=e.priceOverride:typeof e.roomType=="object"&&e.roomType?.basePrice&&(n=e.roomType.basePrice));let s=n*this.numberOfNights();return console.log(t?.pricing?.discount,"roomData?.pricing?.discount"),this.fb.group({room:[t?.room||e._id||"",[c.required]],roomNumber:[t?.roomNumber||e.roomNumber||""],assignedGuest:[t?.assignedGuest||this.reservation()?.guest._id||""],assignedGuestName:[t?.assignedGuestName||this.guestService.getGuestName(this.reservation()?.guest)||""],roomType:[t?.roomType||(typeof e.roomType=="string"?e.roomType:e.roomType?._id)||"",[c.required]],stayPeriod:this.fb.group({from:[this.checkInDate(),[c.required]],to:[this.checkOutDate(),[c.required]],numberOfNights:[t?.stayPeriod?.numberOfNights||this.numberOfNights(),[c.required,c.min(1)]]}),guests:this.fb.group({adults:[t?.guests?.adults||1,[c.required,c.min(1)]],children:[t?.guests?.children||0,[c.required,c.min(0)]]}),pricing:this.fb.group({pricePerNight:[t?.pricing?.pricePerNight||n,[c.required,c.min(0)]],totalPrice:[t?.pricing?.totalPrice||s,[c.required,c.min(0)]],discount:[t?.pricing?.discount||0,[c.min(0)]],subtotal:[t?.pricing?.subtotal||s,[c.min(0)]],taxes:[t?.pricing?.taxes||0,[c.min(0)]],discountType:[t?.pricing?.discountType||"amount"],fees:this.fb.group({serviceFee:[t?.pricing?.fees?.serviceFee||0,[c.min(0)]],cleaningFee:[t?.pricing?.fees?.cleaningFee||0,[c.min(0)]],resortFee:[t?.pricing?.fees?.resortFee||0,[c.min(0)]],other:[t?.pricing?.fees?.other||0,[c.min(0)]]}),total:[t?.pricing?.total||s,[c.min(0)]]}),notes:[t?.notes||""]})}ngAfterViewInit(){this.reservationMinDate.set(this.checkInDate()),this.reservationMaxDate.set(this.checkOutDate());let e=this.reservationForm().get("rooms"),t=this.reservationForm().get("sharers"),n=this.reservationForm()?.get("checkInDate")?.valueChanges.subscribe(m=>{this.reservationMinDate.set(m);for(let p=0;p<e.length;p++)e.at(p)?.patchValue({stayPeriod:{from:m}},{emitEvent:!1});let d=this.reservationForm().get("sharers");if(d)for(let p=0;p<d.length;p++)d.at(p)?.patchValue({checkInDate:m},{emitEvent:!1})}),s=this.reservationForm()?.get("checkOutDate")?.valueChanges.subscribe(m=>{this.reservationMaxDate.set(m);let d=this.reservationForm()?.get("checkInDate")?.value,p=Math.abs(m.getTime()-d.getTime()),y=Math.ceil(p/(1e3*60*60*24));for(let E=0;E<e.length;E++){let q=e.at(E),te=(q?.get("pricing")?.get("pricePerNight")?.value||0)*y;q?.patchValue({stayPeriod:{to:m,numberOfNights:y},pricing:{totalPrice:te,subtotal:te,total:te}},{emitEvent:!0})}let D=this.reservationForm().get("sharers");if(D)for(let E=0;E<D.length;E++)D.at(E)?.patchValue({checkOutDate:m},{emitEvent:!1})});e?.valueChanges.pipe(Bt((m,d)=>JSON.stringify(m)===JSON.stringify(d))).subscribe(()=>{for(let m=0;m<e.length;m++){let d=e.at(m),p=d?.get("pricing"),y=d?.get("stayPeriod"),D=p?.get("pricePerNight")?.value||0,E=y?.get("numberOfNights")?.value||0,q=D*E;d?.patchValue({pricing:{totalPrice:q,subtotal:q,total:q}},{emitEvent:!0})}})}numberOfNights=x(()=>{let e=this.checkInDate(),t=this.checkOutDate();if(e&&t){let n=Math.abs(t.getTime()-e.getTime());return Math.ceil(n/(1e3*60*60*24))}return 0});getRoomsFormArray(){let e=this.reservationForm();return e?e.get("rooms"):new Pt([])}getRoom(e){return this.roomService.getRoom(e)}hasPrimaryGuest=x(()=>{let e=this.selectedGuest();if(!e)return!1;let t=e?._id;return t!=null&&t!==""});getSharersFormArray(){let e=this.reservationForm();return e?e.get("sharers"):new Pt([])}getPrimaryGuest(){let e=this.getSharersFormArray();return e.length>0?e.at(0):null}getOtherSharers(){let e=this.getSharersFormArray();return e.length>1?Array.from({length:e.length-1},(t,n)=>e.at(n+1)):[]}addSharer(e,t){let n=this.getSharersFormArray(),s=this.getPrimaryGuest();s?.value?.guest?n.push(this.fb.group({guest:[e?._id],meta:e,guestType:["individual"],ageGrade:t,checkInDate:[this.reservationMinDate()],checkOutDate:[this.reservationMaxDate()]})):(s?.patchValue({guest:e?._id,meta:e,guestType:"individual",ageGrade:t,checkInDate:this.reservationMinDate(),checkOutDate:this.reservationMaxDate()}),this.selectedGuest.set(e))}onCreateGuest(){this.dialog.open(Me,{width:"600px",disableClose:!1,data:{bookingType:"single",ageGrade:"adult"}}).afterClosed().subscribe(t=>{t&&this.addSharer(t,"adult")})}editSharer(e,t){let n=this.getSharersFormArray();if(!n.at(e))return;let m=this.getPrimaryGuest(),d=m&&m.value.guest;e!==0&&!d&&(e=0),this.dialog.open(Me,{width:"600px",disableClose:!1,data:{bookingType:"single",guest:n.at(e)?.value.meta||null,ageGrade:t}}).afterClosed().subscribe(y=>{y&&(this.updateSharerWithGuest(e,y),this.sharerEdited.emit({index:e,sharer:y}))})}deleteSharer(e){let t=this.getSharersFormArray();e!==0&&(t.removeAt(e),this.sharerDeleted.emit({index:e}))}updateSharerWithGuest(e,t){}getSharerName(e){let t=e.get("meta")?.value?.firstName,n=e.get("meta")?.value?.lastName;return t||n?`${t||""} ${n||""}`.trim():"Unassigned Guest"}asFormGroup(e){return e}getSharerTypeBadge(e){return this.getSharersFormArray().controls.indexOf(e)===0?"Primary Guest":e.get("type")?.value==="adult"?"Adult":"Child"}getReservationMinDate(){return this.reservationMinDate()}getReservationMaxDate(){return this.reservationMaxDate()}calculateNights(e,t){if(!e||!t)return 0;let n=new Date(e).getTime(),s=new Date(t).getTime(),m=Math.ceil((s-n)/(1e3*60*60*24));return m>0?m:0}onSharerHome(e){}onGuestCheckIn(){this.sharerAdded.emit({action:"check_in"})}onGenerateGuestService(){this.sharerAdded.emit({action:"generate_service"})}onAddInfants(){this.dialog.open(Me,{width:"600px",disableClose:!1,data:{bookingType:"single",ageGrade:"child"}}).afterClosed().subscribe(t=>{t&&this.addSharer(t,"child")}),this.sharerAdded.emit({action:"add_infants"})}onEditRoomPricing(){let e=this.getRoomsFormArray();if(!e||e.length===0)return;this.dialog.open(It,{width:"800px",disableClose:!1,data:{roomIndex:0}}).afterClosed().subscribe(n=>{if(n){let m=e.at(0)?.get("pricing");m&&m.patchValue(n,{emitEvent:!0})}})}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-room-sharers"]],inputs:{quickReservation:[1,"quickReservation"],selectedGuest:[1,"selectedGuest"],reservation:[1,"reservation"]},outputs:{selectedGuest:"selectedGuestChange",sharerAdded:"sharerAdded",sharerEdited:"sharerEdited",sharerDeleted:"sharerDeleted",sharersArrayUpdated:"sharersArrayUpdated"},decls:24,vars:7,consts:[["picker",""],["appearance","outlined",3,"formGroup"],[1,"flex","justify-between","items-center","w-full"],[1,"flex","gap-2"],["matButton","","color","accent",3,"click","disabled"],[1,"material-icons-outlined"],["matButton","tonal","color","secondary",3,"click","disabled","matTooltip"],["matButton","filled","color","primary",3,"click","disabled"],["formArrayName","sharers"],[1,"flex","justify-center","py-12"],[1,"py-4","space-y-3"],["diameter","40"],[1,"border","border-gray-200","rounded-lg",3,"formGroup"],[1,"text-center","py-8","text-gray-500"],[3,"reservation"],[1,"flex","items-center","gap-3","p-4"],[1,"px-3","py-1","bg-orange-100","text-orange-700","rounded-full","text-xs","font-bold","min-w-fit"],[1,"flex","items-center","gap-2","min-w-[180px]"],[1,"text-gray-400"],[1,"flex","flex-col"],[1,"font-medium","text-gray-900","truncate"],[1,"text-xs","text-gray-500","uppercase"],["appearance","outline",1,"min-w-[220px]","w-[220px]"],[3,"rangePicker","min","max"],["matStartDate","","formControlName","checkInDate","placeholder","Start date"],["matEndDate","","formControlName","checkOutDate","placeholder","End date"],["matSuffix","",3,"for"],[1,"flex","items-center","gap-1","ml-auto"],["mat-icon-button","",3,"click","matTooltip","disabled","ngClass"],["mat-icon-button","","matTooltip","Delete Guest",3,"click","disabled","ngClass"],[1,"text-4xl","text-gray-300","mb-2"],[1,"text-sm"]],template:function(t,n){t&1&&(a(0,"mat-card",1)(1,"mat-card-header")(2,"div",2)(3,"div")(4,"mat-card-title"),r(5," Room Sharers "),o(),a(6,"mat-card-subtitle"),f(7,To,3,6,"pre"),o()(),a(8,"div",3)(9,"a",4),b("click",function(){return n.onEditRoomPricing()}),a(10,"mat-icon",5),r(11,"edit"),o(),r(12," Edit Pricing "),o(),a(13,"a",6),b("click",function(){return n.onAddInfants()}),a(14,"mat-icon",5),r(15,"child_care"),o(),r(16," Add Infant "),o(),a(17,"a",7),b("click",function(){return n.onCreateGuest()}),a(18,"mat-icon",5),r(19,"person_add"),o(),r(20," ADD ROOM SHARER "),o()()()(),a(21,"mat-card-content",8),f(22,No,2,0,"div",9)(23,wo,6,2,"div",10),o()()),t&2&&(g("formGroup",n.reservationForm()),l(7),h(n.roomsResource.hasValue()?7:-1),l(2),g("disabled",n.roomsResource.isLoading()),l(4),g("disabled",!n.hasPrimaryGuest()||n.roomsResource.isLoading())("matTooltip",n.hasPrimaryGuest()?"":"Please assign a primary guest first"),l(4),g("disabled",n.roomsResource.isLoading()),l(5),h(n.roomsResource.isLoading()?22:23))},dependencies:[w,tt,ee,ve,de,X,U,ce,Wt,O,J,Y,Q,rt,Z,ie,pe,ue,De,qe,K,j,me,ot,A,z,ge,He,Ge,Rt,ye,bt,Ie,Ue,St,Ft,Mt,Et,it,si,Gt,Ne,$e,le],encapsulation:2})};var _i=()=>[],Ao=i=>({prefix:i}),Oo=(i,e)=>e._id||e.id,Bo=(i,e)=>e._id;function Vo(i,e){i&1&&(a(0,"div",6),_(1,"mat-spinner",8),o())}function Lo(i,e){if(i&1&&(a(0,"mat-option",16),r(1),o()),i&2){let t=e.$implicit;g("value",t._id||t.id),l(),C(" ",t.name," ")}}function qo(i,e){if(i&1&&(a(0,"mat-option",16),r(1),o()),i&2){let t=e.$implicit;g("value",t._id),l(),C(" ",t.name+" "+t.roomNumber," ")}}function $o(i,e){i&1&&(a(0,"mat-error"),r(1,"Check-in date is required"),o())}function Ho(i,e){i&1&&(a(0,"mat-error"),r(1,"Check-out date is required"),o())}function Uo(i,e){if(i&1){let t=N();a(0,"button",39),b("click",function(){S(t);let s=u().$index,m=u(2);return F(m.onChangeRoom(s))}),a(1,"mat-icon",21),r(2,"swap_horiz"),o()()}}function Ko(i,e){if(i&1){let t=N();a(0,"div",11)(1,"div")(2,"mat-form-field",14)(3,"mat-label"),r(4,"Room Type"),o(),a(5,"mat-select",15),b("selectionChange",function(s){let m=S(t).$index,d=u(2);return F(d.onRoomTypeChange(m,s.value))}),ae(6,Lo,2,2,"mat-option",16,Oo),o()()(),a(8,"div")(9,"mat-form-field",14)(10,"mat-label"),r(11,"Room"),o(),a(12,"mat-select",17),b("selectionChange",function(s){let m=S(t).$index,d=u(2);return F(d.onRoomChange(m,s.value))}),a(13,"mat-option",18),r(14,"-- Select Room --"),o(),ae(15,qo,2,2,"mat-option",16,Bo),o()()(),a(17,"div")(18,"mat-form-field",14)(19,"mat-label"),r(20,"Assigned Guest"),o(),_(21,"input",19),a(22,"button",20),b("click",function(){let s=S(t).$index,m=u(2);return F(m.onAddOrChangeGuest(s))}),a(23,"mat-icon",21),r(24,"person_add"),o()()()(),a(25,"div",22)(26,"mat-form-field",23)(27,"mat-label"),r(28,"Adults"),o(),_(29,"input",24),a(30,"mat-icon",25),r(31,"person"),o()(),a(32,"mat-form-field",23)(33,"mat-label"),r(34,"Children"),o(),_(35,"input",26),a(36,"mat-icon",25),r(37,"child_care"),o()()(),a(38,"div",27)(39,"mat-form-field",14)(40,"mat-label"),r(41,"Stay Period"),o(),a(42,"mat-date-range-input",28)(43,"input",29),b("dateChange",function(){let s=S(t).$index,m=u(2);return F(m.onStayPeriodChange(s))}),o(),a(44,"input",30),b("dateChange",function(){let s=S(t).$index,m=u(2);return F(m.onStayPeriodChange(s))}),o()(),_(45,"mat-datepicker-toggle",31)(46,"mat-date-range-picker",null,0),a(48,"mat-hint"),r(49),o(),f(50,$o,2,0,"mat-error"),f(51,Ho,2,0,"mat-error"),o()(),a(52,"div",32)(53,"mat-form-field",14)(54,"mat-label"),r(55,"Price"),o(),_(56,"input",33),a(57,"span",34),r(58),o(),a(59,"button",35),b("click",function(){let s=S(t).$index,m=u(2);return F(m.onEditPrice(s))}),a(60,"mat-icon",21),r(61,"edit"),o()(),a(62,"mat-hint"),r(63),M(64,"currency"),o()()(),a(65,"div",36),f(66,Uo,3,0,"button",37),a(67,"button",38),b("click",function(){let s=S(t).$index,m=u(2);return F(m.removeRoom(s))}),a(68,"mat-icon",21),r(69,"delete"),o()()()()}if(i&2){let t,n,s,m,d,p,y,D,E=e.$index,q=we(47),I=u(2);g("formGroupName",E),l(6),re(I.roomTypes.value()||Oe(18,_i)),l(9),re(I.filterRoomsByType((t=I.getRoomsFormArray())==null||(t=t.at(E))==null||(t=t.get("roomType"))==null?null:t.value,E)),l(6),g("value",((n=I.getRoomsFormArray())==null||(n=n.at(E))==null||(n=n.get("assignedGuestName"))==null?null:n.value)||"Select a guest"),l(21),g("rangePicker",q)("min",I.getMinDate())("max",I.getMaxDate()),l(3),g("for",q),l(4),C(" ",((s=I.getRoomsFormArray())==null||(s=s.at(E))==null||(s=s.get("stayPeriod"))==null||(s=s.get("numberOfNights"))==null?null:s.value)||0," night(s) "),l(),h(!((m=I.getRoomsFormArray())==null||(m=m.at(E))==null||(m=m.get("stayPeriod"))==null||(m=m.get("from"))==null)&&m.hasError("required")?50:-1),l(),h(!((d=I.getRoomsFormArray())==null||(d=d.at(E))==null||(d=d.get("stayPeriod"))==null||(d=d.get("to"))==null)&&d.hasError("required")?51:-1),l(5),g("options",_e(19,Ao,(p=I.storeStore.selectedStore())==null?null:p.currency)),l(2),C(" ",(y=I.storeStore.selectedStore())==null?null:y.currency),l(5),C(" Total: ",H(64,13,I.price(E),(D=I.storeStore.selectedStore())==null?null:D.currency,"symbol","1.2-2")," "),l(3),h(I.isEditMode()?66:-1)}}function jo(i,e){i&1&&(a(0,"div",12)(1,"mat-icon",40),r(2,"meeting_room"),o(),a(3,"p",21),r(4,"No rooms selected"),o()())}function Wo(i,e){if(i&1&&(a(0,"div",7)(1,"div",9)(2,"div",10),ae(3,Ko,70,21,"div",11,Lt,!1,jo,5,0,"div",12),o()(),_(6,"break-down-total",13),o()),i&2){let t,n=u();g("formGroup",n.reservationForm()),l(3),re(((t=n.getRoomsFormArray())==null?null:t.controls)||Oe(3,_i)),l(3),g("reservation",n.reservation())}}var fn=class i{roomsService=v(Dt);guestService=v(je);storeStore=v(W);fb=v(Re);snackBar=v(at);dialog=v(Ke);reservationFormService=v(oe);reservationForm=L(this.reservationFormService.form$,{initialValue:null});selectedRoomIds=P([]);reservation=P(null);roomAssigned=se();roomChangeRequested=se();assigningRoomId=R(null);filteredRooms=R([]);assignedGuests=R(new Map);isEditMode=x(()=>!!this.reservation());roomTypes=Fe({params:()=>({id:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.roomsService.getRoomTypes(e.id)});selectedRooms=Fe({params:()=>({roomIds:this.selectedRoomIds()}),stream:({params:e})=>this.roomsService.getRoomsByIds(e.roomIds).pipe(Xe(t=>{this.populateRoomsFormArray2(t)}))});rooms=Fe({params:()=>({store:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.roomsService.getRooms(e.store)});constructor(){Pe(()=>{this.reservation()&&(this.rooms.reload(),this.roomTypes.reload(),this.selectedRooms.reload())})}isRoomsReadyForAssignment=x(()=>this.selectedRoomIds()?this.selectedRooms.hasValue()&&this.rooms.hasValue()&&this.roomTypes.hasValue():this.rooms.hasValue()&&this.roomTypes.hasValue());totalRooms=x(()=>this.rooms.hasValue()?this.rooms.value().length:0);totalCapacity=x(()=>this.rooms.value()?.reduce((e,t)=>{let n=t.capacity;return typeof n=="object"&&n!==null?e+(n.adults||0)+(n.children||0):e+(n||0)},0));isEditingRooms=x(()=>{let e=this.getRoomsFormArray();return e&&e.length>0});price(e){return this.getRoomsFormArray().at(e).get("pricing").get("total")?.value}onCreateRoom(){let e=this.createRoomFormGroup({}),t=this.getRoomsFormArray();if(t){let n=t.length;t.push(e);let s=e.get("stayPeriod");s&&s.valueChanges.subscribe(()=>{this.onStayPeriodChange(n)})}}populateRoomsFormArray2(e){let t=this.getRoomsFormArray();if(!t)return;t.clear();let n=this.reservation(),s=!!n;(s?n.rooms:e).forEach((d,p)=>{let y;if(s){let D="",E="";d.assignedGuest&&(typeof d.assignedGuest=="object"&&d.assignedGuest._id?(D=d.assignedGuest._id,E=this.guestService.getGuestName(d.assignedGuest)):typeof d.assignedGuest=="string"&&(D=d.assignedGuest)),y=this.fb.group({room:[{value:d.room._id||d.room,disabled:this.isEditMode()},[c.required]],roomNumber:[d.room?.roomNumber||"",[]],roomType:[{value:d?.roomType||d?.room?.roomType?._id,disabled:this.isEditMode()},[]],assignedGuest:[D,[c.required]],status:[d.status||"reserved",[c.required]],assignedGuestName:[E,[c.required]],stayPeriod:this.fb.group({from:[new Date(d.stayPeriod?.from||n.checkInDate),[c.required]],to:[new Date(d.stayPeriod?.to||n.checkOutDate),[c.required]],numberOfNights:[d.stayPeriod?.numberOfNights||1,[c.required,c.min(1)]]}),guests:this.fb.group({adults:[d.guests?.adults||1,[c.required,c.min(1)]],children:[d.guests?.children||0,[c.required,c.min(0)]]}),pricing:this.fb.group({pricePerNight:[d?.pricing?.pricePerNight||d?.room?.priceOverride||0,[c.required,c.min(0)]],totalPrice:[d.pricing?.totalPrice||0,[c.required,c.min(0)]],discount:[d.pricing?.discount||0,[c.min(0)]],discountType:[d.pricing?.discountType||"percentage",[]],subtotal:[d.pricing?.subtotal||0,[c.min(0)]],taxes:[d.pricing?.taxes||0,[c.min(0)]],fees:this.fb.group({serviceFee:[d.pricing?.fees?.serviceFee||0,[c.min(0)]],cleaningFee:[d.pricing?.fees?.cleaningFee||0,[c.min(0)]],resortFee:[d.pricing?.fees?.resortFee||0,[c.min(0)]],other:[d.pricing?.fees?.other||0,[c.min(0)]]}),total:[d.pricing?.total||0,[c.min(0)]]}),notes:[d.notes||"",[]]})}else console.log("[RoomDetails] NEW mode - using createRoomFormGroup for room:",d._id),y=this.createRoomFormGroup(d);t.push(y),console.log(`[RoomDetails] Room ${p} added to form array. Current array length:`,t.length)}),console.log("[RoomDetails] populateRoomsFormArray2 completed. Final array length:",t.length),this.reservationForm()?.patchValue({rooms:t},{emitEvent:!1})}createRoomFormGroup(e,t){let n=t?.pricing?.pricePerNight;n||(e.priceOverride?n=e.priceOverride:typeof e.roomType=="object"&&e.roomType?.basePrice&&(n=e.roomType.basePrice));let s=this.reservationForm(),m=t?.stayPeriod?.from||s?.get("checkInDate")?.value||new Date,d=t?.stayPeriod?.to||s?.get("checkOutDate")?.value||new Date,p=this.calculateNumberOfNights(m,d),y=n*p;return this.fb.group({room:[t?.room||e._id||"",[c.required]],roomNumber:[t?.roomNumber||e.roomNumber||""],assignedGuest:[t?.assignedGuest||"",c.required],assignedGuestName:[t?.assignedGuestName||"",c.required],roomType:[t?.roomType||(typeof e.roomType=="string"?e.roomType:e.roomType?._id)||"",[c.required]],stayPeriod:this.fb.group({from:[m,[c.required]],to:[d,[c.required]],numberOfNights:[t?.stayPeriod?.numberOfNights||p,[c.required,c.min(1)]]}),guests:this.fb.group({adults:[t?.guests?.adults||1,[c.required,c.min(1)]],children:[t?.guests?.children||0,[c.required,c.min(0)]]}),pricing:this.fb.group({pricePerNight:[t?.pricing?.pricePerNight||n,[c.required,c.min(0)]],totalPrice:[t?.pricing?.totalPrice||y,[c.required,c.min(0)]],discount:[t?.pricing?.discount||0,[c.min(0)]],subtotal:[t?.pricing?.subtotal||y,[c.min(0)]],taxes:[t?.pricing?.taxes||0,[c.min(0)]],discountType:[t?.pricing?.discountType||"amount"],fees:this.fb.group({serviceFee:[t?.pricing?.fees?.serviceFee||0,[c.min(0)]],cleaningFee:[t?.pricing?.fees?.cleaningFee||0,[c.min(0)]],resortFee:[t?.pricing?.fees?.resortFee||0,[c.min(0)]],other:[t?.pricing?.fees?.other||0,[c.min(0)]]}),total:[t?.pricing?.total||y,[c.min(0)]]}),notes:[t?.notes||""]})}assignRoom(e){this.assigningRoomId.set(e._id||null);let t=this.createRoomFormGroup(e),n=this.getRoomsFormArray();if(n){let s=n.length;n.push(t);let m=t.get("stayPeriod");m&&m.valueChanges.subscribe(()=>{this.onStayPeriodChange(s)}),this.roomAssigned.emit({room:e,formGroup:t,index:s})}}removeRoom(e){let t=this.getRoomsFormArray();t&&t.removeAt(e)}onChangeRoom(e){this.roomChangeRequested.emit(e)}filterRoomsByType(e,t){return console.log(this.rooms.value()),e?this.rooms.value().filter(n=>(typeof n.roomType=="string"?n.roomType:n.roomType?._id)===e):this.rooms.value()||[]}onRoomTypeChange(e,t){let n=this.getRoomsFormArray();if(!n)return;n.at(e)?.get("room")?.reset()}getRoomsFormArray(){let e=this.reservationForm();if(e){let t=e.controls.rooms;return console.log("[RoomDetails] getRoomsFormArray called, array length:",t?.length),t}return console.warn("[RoomDetails] getRoomsFormArray: form is null"),null}onAddOrChangeGuest(e){this.dialog.open(Me,{width:"600px",disableClose:!1,data:{bookingType:"single",ageGrade:"adult"}}).afterClosed().subscribe(n=>{if(n){let s=this.assignedGuests();s.set(n._id,n),this.assignedGuests.set(s);let m=this.getRoomsFormArray();m&&m.at(e).patchValue({assignedGuest:n._id,assignedGuestName:this.getGuestDisplayName(n)})}})}getGuestDisplayName(e){return e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:e.firstName?e.firstName:e.companyName?e.companyName:"Unknown Guest"}getGuestNameById(e){if(!e)return"";let t=this.assignedGuests().get(e);return t?this.getGuestDisplayName(t):e}onEditPrice(e){let t=this.getRoomsFormArray();if(!t)return;let n=t.at(e),s=n?.get("pricing"),m=n?.get("stayPeriod");if(!s||!m)return;this.dialog.open(It,{width:"500px",disableClose:!1,data:{roomIndex:e}}).afterClosed().subscribe(p=>{p&&p.success&&this.snackBar.open("Price updated successfully","Close",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["success-snackbar"]})})}isRoomAlreadySelected(e,t){let n=this.getRoomsFormArray();return n?n.controls.some((s,m)=>m===t?!1:s.get("room")?.value===e):!1}isRoomAvailable(e,t){return!this.isRoomAlreadySelected(e,t)}getSelectedRoomIds(e){let t=this.getRoomsFormArray();return t?t.controls.map((n,s)=>s===e?null:n.get("room")?.value).filter(n=>n!==null&&n!==""):[]}onRoomChange(e,t){if(this.isRoomAlreadySelected(t,e)){this.getRoomsFormArray()?.at(e)?.get("room")?.reset(),this.snackBar.open("This room is already selected in another row","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["error-snackbar"]});return}let n=this.rooms.value().find(s=>s._id===t);if(n){let s=this.getRoomsFormArray();if(s){let m=s.at(e),d=0;n.priceOverride?d=n.priceOverride:typeof n.roomType=="object"&&n.roomType?.basePrice&&(d=n.roomType.basePrice);let y=m?.get("stayPeriod")?.get("numberOfNights")?.value||1,D=d*y;m?.patchValue({roomNumber:n.roomNumber||"",pricing:{pricePerNight:d,totalPrice:D,discount:0,subtotal:D,taxes:0,discountType:"amount",fees:{serviceFee:0,cleaningFee:0,resortFee:0,other:0},total:D}})}}}trackByFormArrayIndex(e){return e}getRoomTypeBadgeColor(e){let t=typeof e=="string"?e:e?.name||"standard";return{deluxe:"bg-blue-100 text-blue-700",suite:"bg-purple-100 text-purple-700",standard:"bg-gray-100 text-gray-700",luxury:"bg-yellow-100 text-yellow-700",penthouse:"bg-red-100 text-red-700"}[t.toLowerCase()]||"bg-gray-100 text-gray-700"}getRoomStatusColor(e){return{available:"text-green-600",occupied:"text-red-600",maintenance:"text-yellow-600",reserved:"text-blue-600"}[e.toLowerCase()]||"text-gray-600"}trackByRoomId(e,t){return t._id||e.toString()}getRoomTypeNameById(e){let t=this.roomTypes.value().find(n=>n._id===e||n.id===e);return t?t.name:"Unknown"}getMinDate(){return this.reservationForm()?.get("checkInDate")?.value||null}getMaxDate(){return this.reservationForm()?.get("checkOutDate")?.value||null}calculateNumberOfNights(e,t){if(!e||!t)return 0;let n=new Date(e),s=new Date(t);n.setHours(0,0,0,0),s.setHours(0,0,0,0);let m=1440*60*1e3,d=Math.ceil((s.getTime()-n.getTime())/m);return Math.max(1,d)}onStayPeriodChange(e){let t=this.getRoomsFormArray();if(!t)return;let n=t.at(e),s=n?.get("stayPeriod"),m=n?.get("room")?.value;if(!s||!m)return;let d=s.get("from")?.value,p=s.get("to")?.value;if(!d||!p)return;let y=this.calculateNumberOfNights(d,p),D=n?.get("pricing"),q=(D?.get("pricePerNight")?.value||0)*y;if(s.patchValue({numberOfNights:y},{emitEvent:!1}),D?.patchValue({totalPrice:q,subtotal:q,total:q},{emitEvent:!0}),!this.rooms.value().find(xn=>xn._id===m))return;let be=this.reservationForm(),te=be?.get("checkInDate")?.value,ne=be?.get("checkOutDate")?.value;if(!te||!ne)return;let wt=new Date(d),At=new Date(p),xi=new Date(te),bi=new Date(ne);if(wt<xi||At>bi){this.snackBar.open("Room stay period must be within the reservation dates","Close",{duration:4e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["warning-snackbar"]}),s.patchValue({from:te,to:ne});return}this.checkRoomAvailability(m,d,p).then(xn=>{if(!xn){this.snackBar.open("Room is not available for the selected dates","Close",{duration:4e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["error-snackbar"]}),s.patchValue({from:te,to:ne});return}this.updateReservationDatesFromRooms()})}updateReservationDatesFromRooms(){}checkRoomAvailability(e,t,n){return new Promise(s=>{let m=this.storeStore.selectedStore()?._id;if(!m){s(!1);return}let d=new Date(t).toISOString().split("T")[0],p=new Date(n).toISOString().split("T")[0];this.roomsService.getAvailableRooms({storeId:m,checkInDate:d,checkOutDate:p}).subscribe({next:y=>{let D=y.some(E=>E._id===e);s(D)},error:()=>{s(!1)}})})}calculateTotalBreakdown(e){let t=this.getRoomsFormArray();return t?t.controls.reduce((n,s)=>{let m=s.get("pricing");if(!m)return n;switch(e){case"subtotal":return n+(m.get("totalPrice")?.value||0);case"serviceFee":let d=m.get("fees");return d?n+(d.get("serviceFee")?.value||0):n;case"cleaningFee":let p=m.get("fees");return p?n+(p.get("cleaningFee")?.value||0):n;case"resortFee":let y=m.get("fees");return y?n+(y.get("resortFee")?.value||0):n;case"otherFees":let D=m.get("fees");return D?n+(D.get("other")?.value||0):n;case"fees":let E=m.get("fees");return E?n+((E.get("serviceFee")?.value||0)+(E.get("cleaningFee")?.value||0)+(E.get("resortFee")?.value||0)+(E.get("other")?.value||0)):n;case"taxes":return n+(m.get("taxes")?.value||0);case"discount":return n+(m.get("discount")?.value||0);case"total":let q=m.get("totalPrice")?.value||0,I=(()=>{let ne=m.get("fees");return ne?(ne.get("serviceFee")?.value||0)+(ne.get("cleaningFee")?.value||0)+(ne.get("resortFee")?.value||0)+(ne.get("other")?.value||0):0})(),be=m.get("taxes")?.value||0,te=m.get("discount")?.value||0;return n+(q+I+be-te);default:return n}},0):0}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-room-details"]],inputs:{selectedRoomIds:[1,"selectedRoomIds"],reservation:[1,"reservation"]},outputs:{roomAssigned:"roomAssigned",roomChangeRequested:"roomChangeRequested"},features:[qt([{provide:Wn,useValue:"en-US"}])],decls:16,vars:3,consts:[["dateRangePicker",""],["appearance","outlined"],[1,"flex","justify-between","items-center","w-full"],[1,"flex","gap-2"],["matButton","filled","color","primary",3,"click"],[1,"material-icons-outlined"],[1,"flex","justify-center","items-center","py-8"],[3,"formGroup"],["diameter","40"],[1,"overflow-x-auto"],["formArrayName","rooms"],[1,"grid","gap-3","p-3","border-b","border-gray-200","items-center","text-xs","hover:bg-gray-50",2,"grid-template-columns","1.2fr 1fr 1.2fr 1fr 1fr 1.2fr 0.8fr",3,"formGroupName"],[1,"text-center","py-8","text-gray-500"],[3,"reservation"],["appearance","outline",1,"w-full"],["formControlName","roomType",1,"text-xs",3,"selectionChange"],[3,"value"],["formControlName","room",1,"text-xs",3,"selectionChange"],["value",""],["matInput","","placeholder","Select or create guest","readonly","",1,"text-xs",3,"value"],["mat-icon-button","","matPrefix","","color","primary","type","button","matTooltip","Add or change guest",3,"click"],[1,"text-sm"],["formGroupName","guests",1,"flex","gap-2"],["appearance","outline",1,"flex-1"],["matInput","","type","number","formControlName","adults","min","1",1,"text-xs"],["matPrefix","",1,"text-sm"],["matInput","","type","number","formControlName","children","min","0",1,"text-xs"],["formGroupName","stayPeriod"],[3,"rangePicker","min","max"],["matStartDate","","formControlName","from","placeholder","Start date",1,"text-xs",3,"dateChange"],["matEndDate","","formControlName","to","placeholder","End date",1,"text-xs",3,"dateChange"],["matIconSuffix","",3,"for"],["formGroupName","pricing"],["matInput","","currencyMask","","formControlName","totalPrice","placeholder","0.00","readonly","",1,"text-xs","text-right","font-semibold",3,"options"],["matPrefix","",1,"text-gray-600"],["mat-icon-button","","matSuffix","","color","primary","type","button","matTooltip","Edit price",3,"click"],[1,"flex","justify-center","gap-2"],["type","button","mat-icon-button","","color","primary","matTooltip","Change room",1,"h-8","w-8"],["type","button","mat-icon-button","","color","warn","matTooltip","Remove room",1,"h-8","w-8",3,"click"],["type","button","mat-icon-button","","color","primary","matTooltip","Change room",1,"h-8","w-8",3,"click"],[1,"text-4xl","text-gray-300","mb-2"]],template:function(t,n){t&1&&(a(0,"mat-card",1)(1,"mat-card-header")(2,"div",2)(3,"div")(4,"mat-card-title"),r(5," Selected Rooms "),o(),a(6,"mat-card-subtitle"),r(7),o()(),a(8,"div",3)(9,"a",4),b("click",function(){return n.onCreateRoom()}),a(10,"mat-icon",5),r(11,"add"),o(),r(12," ADD MORE ROOM(S) "),o()()()(),a(13,"mat-card-content"),f(14,Vo,2,0,"div",6)(15,Wo,7,4,"div",7),o()()),t&2&&(l(7),Se(" ",n.totalRooms()," room(s) - Total Capacity: ",n.totalCapacity()," guest(s) "),l(7),h(n.rooms.isLoading()&&n.selectedRooms.isLoading()&&n.roomTypes.isLoading()?14:n.rooms.hasValue()?15:-1))},dependencies:[w,ee,ve,jt,de,X,Yn,U,ce,Le,Wt,O,J,Y,Q,rt,Z,ie,pe,ue,De,st,zt,qe,K,Te,j,me,ot,A,z,Rt,He,ye,bt,Ne,$e,ge,ke,Ee,Ie,Ue,St,Ft,Mt,Et,it,Ht,Ge,Tt,an,Gt,le],styles:["[_nghost-%COMP%]{display:block}mat-card-header[_ngcontent-%COMP%]{padding-bottom:1rem;margin-bottom:1rem;border-bottom:1px solid #e5e7eb}"]})};function zo(i,e){i&1&&(a(0,"mat-error"),r(1,"Payment method is required"),o())}function Jo(i,e){i&1&&(a(0,"mat-error"),r(1,"Status is required"),o())}var hn=class i{reservationForm=P(void 0);static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["payment-info"]],inputs:{reservationForm:[1,"reservationForm"]},decls:38,vars:3,consts:[["appearance","outlined"],[3,"formGroup"],["formGroupName","paymentInfo",1,"space-y-4","py-3"],["appearance","outline",1,"w-full"],["formControlName","method"],["value","cash"],["value","credit_card"],["value","debit_card"],["value","bank_transfer"],["value","check"],["value","mobile_payment"],["value","other"],["formControlName","status"],["value","pending"],["value","partial"],["value","paid"],["value","refunded"]],template:function(t,n){if(t&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),r(3," Payment Info "),o()(),a(4,"mat-card-content",1)(5,"div",2)(6,"mat-form-field",3)(7,"mat-label"),r(8,"Payment Method"),o(),a(9,"mat-select",4)(10,"mat-option",5),r(11,"Cash"),o(),a(12,"mat-option",6),r(13,"Credit Card"),o(),a(14,"mat-option",7),r(15,"Debit Card"),o(),a(16,"mat-option",8),r(17,"Bank Transfer"),o(),a(18,"mat-option",9),r(19,"Check"),o(),a(20,"mat-option",10),r(21,"Mobile Payment"),o(),a(22,"mat-option",11),r(23,"Other"),o()(),f(24,zo,2,0,"mat-error"),o(),a(25,"mat-form-field",3)(26,"mat-label"),r(27,"Payment Method"),o(),a(28,"mat-select",12)(29,"mat-option",13),r(30,"Pending"),o(),a(31,"mat-option",14),r(32,"Partial"),o(),a(33,"mat-option",15),r(34,"Paid"),o(),a(35,"mat-option",16),r(36,"Refunded"),o()(),f(37,Jo,2,0,"mat-error"),o()()()()),t&2){let s,m;l(4),g("formGroup",n.reservationForm()),l(20),h(!((s=n.reservationForm())==null||(s=s.get("paymentMethod"))==null||(s=s.get("method"))==null)&&s.hasError("required")?24:-1),l(13),h(!((m=n.reservationForm())==null||(m=m.get("paymentMethod"))==null||(m=m.get("status"))==null)&&m.hasError("required")?37:-1)}},dependencies:[O,J,Y,Q,Z,A,pe,K,ue,st,ge,ke,Ee,ee,de,X,U,ce,Le,Xn],styles:["[_nghost-%COMP%]{display:block}"]})};var _n=class i{reservationForm=P(void 0);getReservationForm(){return this.reservationForm()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-special-requests"]],inputs:{reservationForm:[1,"reservationForm"]},decls:18,vars:1,consts:[["appearance","outlined"],[1,"space-y-4",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","specialRequests","placeholder","e.g., High floor, late arrival, anniversary celebration, dietary requirements...","rows","3",1,"text-sm"],["matInput","","formControlName","internalNotes","placeholder","e.g., Guest prefers quiet hours, previous complaints, VIP notes, maintenance issues...","rows","3",1,"text-sm"]],template:function(t,n){t&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),r(3," Special Requests & Notes "),o()(),a(4,"mat-card-content")(5,"div",1)(6,"mat-form-field",2)(7,"mat-label"),r(8,"Special Requests"),o(),_(9,"textarea",3),a(10,"mat-hint"),r(11,"Enter any special requests from the guest (visible to guest)"),o()(),a(12,"mat-form-field",2)(13,"mat-label"),r(14,"Internal Notes"),o(),_(15,"textarea",4),a(16,"mat-hint"),r(17,"Internal notes visible only to staff (not shown to guest)"),o()()()()()),t&2&&(l(5),g("formGroup",n.getReservationForm()))},dependencies:[w,ee,ve,de,X,U,ce,O,J,Y,Q,Z,ie,pe,ue,De,K,Te,A,ye],encapsulation:2})};var Ci=()=>["status","amount","type","description","performer","date"],Zo=(i,e,t,n,s)=>({"text-green-600":i,"text-orange-500":e,"text-blue-600":t,"text-red-600":n,"text-purple-600":s}),Yo=(i,e,t,n,s)=>({"bg-green-50 text-green-700":i,"bg-orange-50 text-orange-700":e,"bg-blue-50 text-blue-700":t,"bg-red-50 text-red-700":n,"bg-purple-50 text-purple-700":s}),Qo=(i,e)=>({"text-green-600":i,"text-red-600":e});function Xo(i,e){i&1&&(a(0,"div",3)(1,"mat-icon",5),r(2,"swap_horiz"),o(),a(3,"p"),r(4,"No room changes have been made for this reservation."),o()())}function ea(i,e){i&1&&(a(0,"th",20),r(1,"Status"),o())}function ta(i,e){if(i&1&&(a(0,"td",21)(1,"mat-icon",22),r(2),o(),a(3,"mat-chip",23),r(4),o()()),i&2){let t=e.$implicit,n=u(2);l(),et(Fn(6,Zo,t.changeType==="upgrade",t.changeType==="downgrade",t.changeType==="lateral",t.changeType==="maintenance",t.changeType==="guest_request")),l(),C(" ",n.getChangeTypeIcon(t.changeType)," "),l(),et(Fn(12,Yo,t.changeType==="upgrade",t.changeType==="downgrade",t.changeType==="lateral",t.changeType==="maintenance",t.changeType==="guest_request")),l(),C(" ",n.formatChangeType(t.changeType)," ")}}function na(i,e){i&1&&(a(0,"th",20),r(1,"Amount"),o())}function ia(i,e){if(i&1&&(a(0,"td",24)(1,"span"),r(2),M(3,"currency"),o(),a(4,"div",25),r(5),o()()),i&2){let t,n=e.$implicit,s=u(2);l(),et(Vn(10,Qo,n.pricingDetails.difference<0,n.pricingDetails.difference>0)),l(),Se(" ",n.pricingDetails.difference>=0?"+":"","",H(3,5,n.pricingDetails.difference,(t=s.storeStore.selectedStore())==null?null:t.currency,"symbol","1.0-0")," "),l(3),T(n.pricingDetails.adjustmentType?s.formatAdjustmentType(n.pricingDetails.adjustmentType):"")}}function oa(i,e){i&1&&(a(0,"th",20),r(1,"Type"),o())}function aa(i,e){if(i&1&&(a(0,"td",21)(1,"div",26),r(2),o(),a(3,"div",27),r(4),o()()),i&2){let t=e.$implicit,n=u(2);l(2),Se("",t.fromRoom.roomNumber||"Room"," \u2192 ",t.toRoom.roomNumber||"Room"),l(2),Se("",n.getRoomName(t.fromRoom)," \u2192 ",n.getRoomName(t.toRoom))}}function ra(i,e){i&1&&(a(0,"th",20),r(1,"Description"),o())}function sa(i,e){if(i&1&&(a(0,"div")(1,"span"),r(2),o()()),i&2){let t=u().$implicit;l(2),T(t.pricingDetails.adjustmentNotes)}}function la(i,e){if(i&1&&(a(0,"td",21)(1,"span"),r(2),o(),f(3,sa,3,1,"div"),o()),i&2){let t=e.$implicit;l(2),T(t.reason),l(),h(t.pricingDetails.adjustmentNotes?3:-1)}}function ma(i,e){i&1&&(a(0,"th",28),r(1,"Performer"),o())}function da(i,e){if(i&1&&(a(0,"td",29),r(1),o()),i&2){let t=e.$implicit,n=u(2);l(),C(" ",n.getPerformerName(t.performedBy)," ")}}function ca(i,e){i&1&&(a(0,"th",28),r(1,"Date"),o())}function ua(i,e){if(i&1&&(a(0,"td",29),r(1),M(2,"date"),o()),i&2){let t=e.$implicit;l(),C(" ",$(2,1,t.performedAt,"medium")," ")}}function pa(i,e){i&1&&_(0,"tr",30)}function ga(i,e){i&1&&_(0,"tr",31)}function fa(i,e){if(i&1&&(a(0,"div",4)(1,"table",6),B(2,7),G(3,ea,2,0,"th",8)(4,ta,5,18,"td",9),V(),B(5,10),G(6,na,2,0,"th",8)(7,ia,6,13,"td",11),V(),B(8,12),G(9,oa,2,0,"th",8)(10,aa,5,4,"td",9),V(),B(11,13),G(12,ra,2,0,"th",8)(13,la,4,2,"td",9),V(),B(14,14),G(15,ma,2,0,"th",15)(16,da,2,1,"td",16),V(),B(17,17),G(18,ca,2,0,"th",15)(19,ua,3,4,"td",16),V(),G(20,pa,1,0,"tr",18)(21,ga,1,0,"tr",19),o()()),i&2){let t=u();l(),g("dataSource",t.roomChanges()),l(19),g("matHeaderRowDef",Oe(3,Ci)),l(),g("matRowDefColumns",Oe(4,Ci))}}var Cn=class i{storeStore=v(W);reservation=P();roomChanges=x(()=>[...this.reservation()?.roomChanges||[]].sort((e,t)=>{let n=new Date(e.performedAt).getTime();return new Date(t.performedAt).getTime()-n}));getChangeTypeIcon(e){return{upgrade:"arrow_upward",downgrade:"arrow_downward",lateral:"swap_horiz",maintenance:"build",guest_request:"person"}[e]||"swap_horiz"}formatChangeType(e){return{upgrade:"Upgrade",downgrade:"Downgrade",lateral:"Lateral Move",maintenance:"Maintenance",guest_request:"Guest Request"}[e]||e}formatAdjustmentType(e){return{charged:"Charged",refunded:"Refunded",credited:"Credited",waived:"Waived",kept_original_rate:"Original Rate Kept"}[e]||e}getRoomName(e){return console.log("roomData:",e),e.room?.name?e.room.name:e.roomType?.name?e.roomType.name:""}getPerformerName(e){return e?typeof e=="string"?"Staff":e.firstName||e.lastName?`${e.firstName||""} ${e.lastName||""}`.trim():"Staff":"Unknown"}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-room-change-history"]],inputs:{reservation:[1,"reservation"]},decls:9,vars:3,consts:[["appearance","outlined",1,"mb-20!"],[1,"text-gray-500"],[1,"px-0!"],[1,"flex","flex-col","items-center","py-10","text-gray-400"],[1,"overflow-x-auto"],[1,"text-5xl","mb-2"],["mat-table","",1,"min-w-full","text-sm",3,"dataSource"],["matColumnDef","status"],["mat-header-cell","","class","px-4 py-3 text-left font-semibold text-gray-700",4,"matHeaderCellDef"],["mat-cell","","class","px-4 py-3",4,"matCellDef"],["matColumnDef","amount"],["mat-cell","","class","px-4 py-3 font-semibold",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","description"],["matColumnDef","performer"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","date"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"px-4","py-3","text-left","font-semibold","text-gray-700"],["mat-cell","",1,"px-4","py-3"],[1,"align-middle","text-xl"],[1,"ml-2","px-2","py-1","text-xs","font-medium"],["mat-cell","",1,"px-4","py-3","font-semibold"],[1,"text-xs","text-gray-400"],[1,"font-mono","text-xs","text-gray-700"],[1,"text-xs"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""]],template:function(t,n){t&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),r(3,"Room Change History"),o(),a(4,"mat-card-subtitle",1),r(5),o()(),a(6,"mat-card-content",2),f(7,Xo,5,0,"div",3)(8,fa,22,5,"div",4),o()()),t&2&&(l(5),Se(" ",n.roomChanges().length," change",n.roomChanges().length!==1?"s":""," recorded "),l(2),h(n.roomChanges().length===0?7:8))},dependencies:[w,O,J,Y,Q,rt,Z,A,z,Rt,ri,ye,He,Jn,xt,ct,pt,_t,gt,ut,Ct,ft,ht,vt,yt,le,Be],encapsulation:2})};function ha(i,e){i&1&&(a(0,"div",2),_(1,"mat-progress-spinner",6),a(2,"span",7),r(3,"Loading transactions..."),o()())}function _a(i,e){if(i&1&&(a(0,"div",3)(1,"div",8)(2,"mat-icon",9),r(3,"error"),o(),a(4,"div")(5,"h4",10),r(6,"Failed to load transactions"),o(),a(7,"p",11),r(8),o()()()()),i&2){let t,n=u();l(8),T(((t=n.error())==null?null:t.message)||"An error occurred while loading transactions.")}}function Ca(i,e){i&1&&_(0,"app-no-record",4)}function va(i,e){i&1&&(a(0,"th",26),r(1,"Date"),o())}function ya(i,e){if(i&1&&(a(0,"td",27),r(1),M(2,"date"),o()),i&2){let t=e.$implicit;l(),C(" ",$(2,1,t.createdAt,"medium")," ")}}function xa(i,e){i&1&&(a(0,"th",28),r(1,"Amount"),o())}function ba(i,e){if(i&1&&(a(0,"td",29),r(1),M(2,"currency"),o()),i&2){let t=e.$implicit,n=u(2);l(),C(" ",$(2,1,t.amount,n.getCurrencyFormat())," ")}}function Sa(i,e){i&1&&(a(0,"th",26),r(1,"Type"),o())}function Fa(i,e){if(i&1&&(a(0,"td",27)(1,"span",30),r(2),M(3,"titlecase"),o()()),i&2){let t=e.$implicit,n=u(2);l(),g("ngClass",n.getTransactionTypeClass(t.type)),l(),C(" ",Ae(3,2,t.type)," ")}}function Ma(i,e){i&1&&(a(0,"th",26),r(1,"Method"),o())}function Ea(i,e){if(i&1&&(a(0,"td",27)(1,"span",31),r(2),M(3,"titlecase"),o()()),i&2){let t=e.$implicit;l(2),C(" ",Ae(3,1,t.method)," ")}}function Ra(i,e){i&1&&(a(0,"th",26),r(1,"Notes"),o())}function Da(i,e){if(i&1&&(a(0,"span",33),r(1),M(2,"slice"),o()),i&2){let t=u().$implicit;g("matTooltip",t.notes),l(),Se(" ",Ln(2,3,t.notes,0,50),"",t.notes.length>50?"...":""," ")}}function Ta(i,e){i&1&&(a(0,"span",34),r(1,"-"),o())}function Na(i,e){if(i&1&&(a(0,"td",32),f(1,Da,3,7,"span",33)(2,Ta,2,0,"span",34),o()),i&2){let t=e.$implicit;l(),h(t.notes?1:2)}}function ka(i,e){i&1&&(a(0,"th",28),r(1,"Balance After"),o())}function Ga(i,e){if(i&1&&(a(0,"td",29),r(1),M(2,"currency"),o()),i&2){let t=e.$implicit,n=u(2);et(t.balanceAfterTransaction>0?"text-red-600":"text-green-600"),l(),C(" ",$(2,3,t.balanceAfterTransaction,n.getCurrencyFormat())," ")}}function Ia(i,e){i&1&&_(0,"tr",35)}function Pa(i,e){i&1&&_(0,"tr",36)}function wa(i,e){if(i&1&&(a(0,"table",5),B(1,12),G(2,va,2,0,"th",13)(3,ya,3,4,"td",14),V(),B(4,15),G(5,xa,2,0,"th",16)(6,ba,3,4,"td",17),V(),B(7,18),G(8,Sa,2,0,"th",13)(9,Fa,4,4,"td",14),V(),B(10,19),G(11,Ma,2,0,"th",13)(12,Ea,4,3,"td",14),V(),B(13,20),G(14,Ra,2,0,"th",13)(15,Na,3,1,"td",21),V(),B(16,22),G(17,ka,2,0,"th",16)(18,Ga,3,6,"td",23),V(),G(19,Ia,1,0,"tr",24)(20,Pa,1,0,"tr",25),o()),i&2){let t=u();g("dataSource",t.transactions()),l(19),g("matHeaderRowDef",t.displayedColumns),l(),g("matRowDefColumns",t.displayedColumns)}}var vn=class i{reservation=P.required();storeStore=v(W);reservationService=v(rn);reservationId=x(()=>this.reservation()._id);storeId=x(()=>this.storeStore.selectedStore()?._id||"");transactionsResource=Fe({params:()=>({storeId:this.storeId(),reservationId:this.reservationId()}),stream:({params:e})=>!e.storeId||!e.reservationId?Ot([]):this.reservationService.getReservationTransactions(e.storeId,e.reservationId)});constructor(){Pe(()=>{this.reservation()&&this.transactionsResource.reload()})}transactions=x(()=>this.transactionsResource.value()||[]);isLoading=x(()=>this.transactionsResource.isLoading());error=x(()=>this.transactionsResource.error());displayedColumns=["date","amount","type","method","notes","balance"];getTransactionTypeClass(e){switch(e){case"payment":return"bg-green-100 text-green-800";case"refund":return"bg-red-100 text-red-800";case"adjustment":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}}getCurrencyFormat(){return this.storeStore.selectedStore()?.currency||"$"}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-reservation-transactions"]],inputs:{reservation:[1,"reservation"]},decls:9,vars:1,consts:[["appearance","outlined",1,"mb-20"],[1,"p-0!"],[1,"flex","justify-center","items-center","py-8"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4"],["icon","payment","title","No Transactions","message","No payment transactions recorded for this reservation yet."],["mat-table","",1,"w-full",3,"dataSource"],["diameter","40","mode","indeterminate"],[1,"ml-3","text-gray-600"],[1,"flex","items-start"],[1,"text-red-500","mr-3","mt-1"],[1,"text-red-800","font-medium"],[1,"text-red-700","text-sm","mt-1"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","amount"],["mat-header-cell","","class","text-right",4,"matHeaderCellDef"],["mat-cell","","class","text-right font-semibold",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","method"],["matColumnDef","notes"],["mat-cell","","class","text-gray-600",4,"matCellDef"],["matColumnDef","balance"],["mat-cell","","class","text-right font-semibold",3,"class",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","hover:bg-gray-50",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"text-right"],["mat-cell","",1,"text-right","font-semibold"],[1,"px-2","py-1","rounded","text-xs","font-semibold",3,"ngClass"],[1,"px-2","py-1","rounded","text-xs","font-semibold","bg-blue-100","text-blue-800"],["mat-cell","",1,"text-gray-600"],["matTooltipPosition","above",3,"matTooltip"],[1,"text-gray-400"],["mat-header-row",""],["mat-row","",1,"hover:bg-gray-50"]],template:function(t,n){t&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),r(3," Payment Transactions "),o()(),a(4,"mat-card-content",1),f(5,ha,4,0,"div",2)(6,_a,9,1,"div",3)(7,Ca,1,0,"app-no-record",4)(8,wa,21,3,"table",5),o()()),t&2&&(l(5),h(n.isLoading()?5:n.error()?6:n.transactions().length===0?7:8))},dependencies:[w,tt,xt,ct,pt,_t,gt,ut,Ct,ft,ht,vt,yt,Ne,$e,A,z,j,ye,bt,O,J,Y,Q,Z,Zt,Un,$t,le,Be],encapsulation:2,changeDetection:0})};var Aa=()=>["expandedDetail"],Oa=i=>["/menu/dashboard/reports/receipts",i],Ba=(i,e)=>e.productId||e._id||i;function Va(i,e){i&1&&_(0,"app-no-record",3)}function La(i,e){i&1&&(a(0,"th",25),r(1,"Date & Time"),o())}function qa(i,e){if(i&1&&(a(0,"td",26)(1,"div",27)(2,"span",28),r(3),M(4,"date"),o(),a(5,"span",29),r(6),o()()()),i&2){let t=e.$implicit;l(3),T($(4,2,t.createdAt,"short")),l(3),T(t.orderNumber||"N/A")}}function $a(i,e){i&1&&(a(0,"th",25),r(1,"Guest"),o())}function Ha(i,e){if(i&1&&(a(0,"td",26)(1,"div",27)(2,"span",28),r(3),o(),a(4,"span",30),r(5),o()()()),i&2){let t=e.$implicit,n=u(2);l(3),T(n.getCustomerName(t)),l(2),T(n.getCustomerType(t))}}function Ua(i,e){i&1&&(a(0,"th",31),r(1,"Amount"),o())}function Ka(i,e){if(i&1&&(a(0,"td",32),r(1),M(2,"currency"),o()),i&2){let t=e.$implicit,n=u(2);l(),C(" ",$(2,1,n.getTotalAmount(t),n.getCurrencyFormat())," ")}}function ja(i,e){i&1&&(a(0,"th",25),r(1,"Payment Status"),o())}function Wa(i,e){if(i&1&&(a(0,"td",26)(1,"span",33),r(2),M(3,"titlecase"),o()()),i&2){let t=e.$implicit,n=u(2);l(),g("ngClass",n.getPaymentStatusClass(n.getPaymentStatus(t))),l(),C(" ",Ae(3,2,n.getPaymentStatus(t))," ")}}function za(i,e){i&1&&(a(0,"th",25),r(1,"Payment Method"),o())}function Ja(i,e){if(i&1&&(a(0,"td",26)(1,"span",34),r(2),M(3,"titlecase"),o()()),i&2){let t=e.$implicit,n=u(2);l(2),T(Ae(3,1,n.getPaymentType(t)))}}function Za(i,e){i&1&&(a(0,"th",25),r(1,"Type"),o())}function Ya(i,e){if(i&1&&(a(0,"td",26)(1,"span",34),r(2),M(3,"titlecase"),o()()),i&2){let t=e.$implicit,n=u(2);l(2),T(Ae(3,1,n.getOrderType(t)))}}function Qa(i,e){i&1&&(a(0,"th",35),r(1,"\xA0"),o())}function Xa(i,e){if(i&1){let t=N();a(0,"td",26)(1,"button",36),b("click",function(s){let m=S(t).$implicit;return u(2).toggleExpand(m),F(s.stopPropagation())}),a(2,"mat-icon"),r(3),o()()()}if(i&2){let t=e.$implicit,n=u(2);l(3),T(n.expandedElement()===t?"expand_less":"expand_more")}}function er(i,e){i&1&&(a(0,"p",42),r(1,"No items found in this order."),o())}function tr(i,e){i&1&&_(0,"mat-divider")}function nr(i,e){if(i&1&&(a(0,"mat-list-item",46)(1,"div",47)(2,"div",48)(3,"div",49)(4,"span",50),r(5),o(),a(6,"span",51),r(7),o()(),a(8,"div",52)(9,"div",53)(10,"mat-icon",54),r(11,"settings"),o(),a(12,"span"),r(13),o()(),a(14,"div",53)(15,"mat-icon",54),r(16,"payments"),o(),a(17,"span"),r(18),M(19,"currency"),o()()()(),a(20,"div",55)(21,"div",44),r(22),M(23,"currency"),o()()()(),f(24,tr,1,0,"mat-divider")),i&2){let t=e.$implicit,n=e.$index,s=e.$count,m=u(4);l(5),T(t.name||"Item"),l(2),C(" Qty: ",t.quantity||1," "),l(6),T(m.getItemOptions(t)),l(5),C("Unit Price: ",$(19,6,t.price||0,m.getCurrencyFormat())),l(4),C(" ",$(23,9,m.getItemTotal(t),m.getCurrencyFormat())," "),l(2),h(n!==s-1?24:-1)}}function ir(i,e){if(i&1&&(a(0,"mat-list"),ae(1,nr,25,12,null,null,Ba),o(),a(3,"div",43)(4,"span",44),r(5,"Order Total:"),o(),a(6,"span",45),r(7),M(8,"currency"),o()()),i&2){let t=u().$implicit,n=u(2);l(),re(n.getOrderItems(t)),l(6),C(" ",$(8,1,n.getTotalAmount(t),n.getCurrencyFormat())," ")}}function or(i,e){if(i&1&&(a(0,"td",26)(1,"div",37)(2,"div",21)(3,"div",38)(4,"h4",39)(5,"mat-icon",40),r(6,"shopping_cart"),o(),r(7," Order Items "),o(),a(8,"a",41)(9,"mat-icon"),r(10,"visibility"),o(),r(11," View Full Receipt "),o()(),f(12,er,2,0,"p",42)(13,ir,9,4),o()()()),i&2){let t=e.$implicit,n=u(2);Gn("colspan",n.columnsToDisplayWithExpand.length),l(),g("@detailExpand",t===n.expandedElement()?"expanded":"collapsed"),l(7),g("routerLink",_e(4,Oa,t._id)),l(4),h(n.getOrderItems(t).length===0?12:13)}}function ar(i,e){i&1&&_(0,"tr",56)}function rr(i,e){if(i&1){let t=N();a(0,"tr",57),b("click",function(){let s=S(t).$implicit,m=u(2);return F(m.toggleExpand(s))}),o()}}function sr(i,e){i&1&&_(0,"tr",58)}function lr(i,e){if(i&1&&(a(0,"table",4),B(1,5),G(2,La,2,0,"th",6)(3,qa,7,5,"td",7),V(),B(4,8),G(5,$a,2,0,"th",6)(6,Ha,6,2,"td",7),V(),B(7,9),G(8,Ua,2,0,"th",10)(9,Ka,3,4,"td",11),V(),B(10,12),G(11,ja,2,0,"th",6)(12,Wa,4,4,"td",7),V(),B(13,13),G(14,za,2,0,"th",6)(15,Ja,4,3,"td",7),V(),B(16,14),G(17,Za,2,0,"th",6)(18,Ya,4,3,"td",7),V(),B(19,15),G(20,Qa,2,0,"th",16)(21,Xa,4,1,"td",7),V(),B(22,17),G(23,or,14,6,"td",7),V(),G(24,ar,1,0,"tr",18)(25,rr,1,0,"tr",19)(26,sr,1,0,"tr",20),o(),a(27,"div",21)(28,"div",22)(29,"span",23),r(30," Total Orders: "),a(31,"strong"),r(32),o()(),a(33,"span",24),r(34),M(35,"currency"),o()()()),i&2){let t=u();g("dataSource",t.orders()),l(24),g("matHeaderRowDef",t.columnsToDisplayWithExpand),l(),g("matRowDefColumns",t.columnsToDisplayWithExpand),l(),g("matRowDefColumns",Oe(9,Aa)),l(6),T(t.orders().length),l(2),C(" Total Amount: ",$(35,6,t.totalOrdersAmount(),t.getCurrencyFormat())," ")}}var yn=class i{reservation=P.required();storeStore=v(W);orders=x(()=>this.reservation()?.orders||[]);totalOrdersAmount=x(()=>this.orders().reduce((e,t)=>e+this.getTotalAmount(t),0));expandedElement=R(null);displayedColumns=["date","guest","amount","paymentStatus","paymentType","type","expand"];columnsToDisplayWithExpand=[...this.displayedColumns];getOrderStatusClass(e){if(!e||typeof e!="string")return"bg-gray-100 text-gray-800";switch(e.toLowerCase()){case"completed":case"delivered":return"bg-green-100 text-green-800";case"pending":case"processing":return"bg-yellow-100 text-yellow-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}getCustomerName(e){return e.guest?`${e.guest.firstName||""} ${e.guest.lastName||""}`.trim():e.staff?e.staff.name||e.staff.firstName||"Staff":e.user?e.user.name||"Customer":"N/A"}getCustomerType(e){return e.guest?"Guest":e.staff?"Staff":e.user?"Customer":"Unknown"}getCurrencyFormat(){return this.storeStore.selectedStore()?.currency||"$"}getTotalAmount(e){return e.total||e.orderCalculation?.totalPrice||0}getPaymentStatus(e){return e.paymentStatus||"pending"}getPaymentStatusClass(e){if(!e||typeof e!="string")return"bg-gray-100 text-gray-800";switch(e.toLowerCase()){case"paid":case"completed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"failed":case"cancelled":return"bg-red-100 text-red-800";case"partial":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}}getPaymentType(e){return e.payment||"N/A"}getOrderType(e){return e.orderType||e.type||"N/A"}getOrderItems(e){return e.cart&&e.cart.products?e.cart.products:e.items||[]}getItemTotal(e){let t=e.price||0,n=e.quantity||1,s=0;return e.options&&Array.isArray(e.options)&&(s=e.options.reduce((m,d)=>m+(d.price||0)*(d.quantity||1),0)),t*n+s}getItemOptions(e){return!e.options||e.options.length===0?"No options":e.options.map(t=>`${t.name||t.optionItemName||"Option"} ${t.quantity>1?"\xD7"+t.quantity:""}`).join(", ")}toggleExpand(e){this.expandedElement.set(this.expandedElement()===e?null:e)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-reservation-orders"]],inputs:{reservation:[1,"reservation"]},decls:7,vars:1,consts:[["appearance","outlined",1,"mb-20","py-4"],[1,"flex","items-center","gap-2"],[1,"p-0!"],["icon","receipt_long","title","No Orders","message","No orders have been placed for this reservation yet."],["mat-table","","multiTemplateDataRows","",1,"w-full",3,"dataSource"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","guest"],["matColumnDef","amount"],["mat-header-cell","","class","text-right",4,"matHeaderCellDef"],["mat-cell","","class","text-right font-semibold",4,"matCellDef"],["matColumnDef","paymentStatus"],["matColumnDef","paymentType"],["matColumnDef","type"],["matColumnDef","expand"],["mat-header-cell","","aria-label","row actions",4,"matHeaderCellDef"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","cursor-pointer",3,"click",4,"matRowDef","matRowDefColumns"],["mat-row","","class","detail-row",4,"matRowDef","matRowDefColumns"],[1,"p-4"],[1,"flex","justify-between","items-center"],[1,"text-sm","text-gray-600"],[1,"text-sm","font-semibold","text-gray-900"],["mat-header-cell",""],["mat-cell",""],[1,"flex","flex-col"],[1,"font-medium"],[1,"text-xs","text-gray-500","font-mono"],[1,"text-xs","text-gray-500"],["mat-header-cell","",1,"text-right"],["mat-cell","",1,"text-right","font-semibold"],[1,"px-2","py-1","rounded","text-xs","font-semibold",3,"ngClass"],[1,"text-sm"],["mat-header-cell","","aria-label","row actions"],["mat-icon-button","",3,"click"],[1,"order-detail"],[1,"flex","items-center","justify-between","mb-3"],[1,"font-semibold","text-gray-900","flex","items-center","gap-2"],[1,"text-indigo-600"],["mat-stroked-button","",1,"text-sm",3,"routerLink"],[1,"text-sm","text-gray-500","py-2"],[1,"mt-3","rounded-lg","p-3","flex","justify-between","items-center"],[1,"font-semibold","text-gray-900"],[1,"text-lg","font-bold","text-indigo-600"],[1,"!h-auto","!py-3"],[1,"flex","items-start","justify-between","w-full","gap-4"],[1,"flex-1"],[1,"flex","items-center","gap-2","mb-1"],[1,"font-medium","text-gray-900"],[1,"text-xs","text-gray-500","px-2","py-0.5","rounded"],[1,"text-xs","text-gray-600","space-y-1"],[1,"flex","items-center","gap-1"],[1,"!text-sm","!h-4","!w-4"],[1,"text-right"],["mat-header-row",""],["mat-row","",1,"cursor-pointer",3,"click"],["mat-row","",1,"detail-row"]],template:function(t,n){t&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title",1),r(3," Orders "),o()(),a(4,"mat-card-content",2),f(5,Va,1,0,"app-no-record",3)(6,lr,36,10),o()()),t&2&&(l(5),h(n.orders().length===0?5:6))},dependencies:[w,tt,xt,ct,pt,_t,gt,ut,Ct,ft,ht,vt,yt,A,z,j,me,ot,ye,O,J,Y,Q,Z,Ge,mt,dt,lt,Zt,jn,$t,le,Be],styles:[".mat-mdc-table{background:transparent}  .mat-mdc-header-cell{font-weight:600;color:#374151}  .mat-mdc-cell{padding:1rem .5rem}  tr.detail-row{height:0}  .order-detail{overflow:hidden}  .mat-mdc-list-item{border:none!important}"],data:{animation:[Mn("detailExpand",[ln("collapsed,void",sn({height:"0px",minHeight:"0"})),ln("expanded",sn({height:"*"})),Rn("expanded <=> collapsed",En("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]},changeDetection:0})};function mr(i,e){if(i&1&&(a(0,"h1",6),r(1," Edit Reservation "),o(),a(2,"p",7),r(3," Confirmation: "),a(4,"span",8),r(5),o()()),i&2){let t,n=u();l(5),T((t=n.reservation.value())==null?null:t.confirmationNumber)}}function dr(i,e){if(i&1&&(a(0,"h1",6),r(1),o(),a(2,"p",7),r(3," Create a new guest reservation "),o()),i&2){let t=u();l(),C(" Create New ",t.bookingType()==="group"?"Group":"Single"," Reservation ")}}function cr(i,e){if(i&1){let t=N();a(0,"a",13),b("click",function(){S(t);let s=u(2);return F(s.updateReservationStatus(s.ReservationStatus.CANCELLED))}),a(1,"mat-icon"),r(2,"cancel"),o(),r(3," Cancel "),o()}if(i&2){let t=u(2);g("disabled",t.statusUpdating()||t.isSubmitted())}}function ur(i,e){if(i&1){let t=N();a(0,"button",13),b("click",function(){S(t);let s=u(2);return F(s.openRoomChangeDialog())}),a(1,"mat-icon"),r(2,"swap_horiz"),o(),r(3," Change Room "),o()}if(i&2){let t=u(2);g("disabled",t.statusUpdating()||t.isSubmitted())}}function pr(i,e){if(i&1){let t=N();a(0,"button",9),b("click",function(){S(t);let s=u(2);return F(s.updateReservationStatus(s.ReservationStatus.CONFIRMED))}),a(1,"mat-icon"),r(2,"verified"),o(),r(3," Confirm "),o()}if(i&2){let t=u(2);g("disabled",t.statusUpdating()||t.isSubmitted())}}function gr(i,e){if(i&1){let t=N();a(0,"button",9),b("click",function(){S(t);let s=u(2);return F(s.reopenReservation())}),a(1,"mat-icon"),r(2,"redo"),o(),r(3," Re-open "),o()}if(i&2){let t=u(2);g("disabled",t.statusUpdating()||t.isSubmitted())}}function fr(i,e){if(i&1){let t=N();a(0,"button",9),b("click",function(){S(t);let s=u(2);return F(s.updateReservationStatus(s.ReservationStatus.CHECKED_IN))}),a(1,"mat-icon"),r(2,"check_circle_outline"),o(),r(3," Check-in "),o()}if(i&2){let t=u(2);g("disabled",t.statusUpdating())}}function hr(i,e){if(i&1){let t=N();a(0,"button",9),b("click",function(){S(t);let s=u(2);return F(s.updateReservationStatus(s.ReservationStatus.CHECKED_OUT))}),a(1,"mat-icon"),r(2,"logout"),o(),r(3," Check-out "),o()}if(i&2){let t=u(2);g("disabled",t.statusUpdating())}}function _r(i,e){if(i&1){let t=N();a(0,"a",9),b("click",function(){S(t);let s=u();return F(s.exportReservationToPDF())}),a(1,"mat-icon"),r(2),o(),r(3),o(),f(4,cr,4,1,"a",10),a(5,"a",9),b("click",function(){S(t);let s=u();return F(s.payment())}),a(6,"mat-icon"),r(7,"payment"),o(),r(8," Payment "),o(),f(9,ur,4,1,"button",10),f(10,pr,4,1,"button",11),f(11,gr,4,1,"button",11),f(12,fr,4,1,"button",11),f(13,hr,4,1,"button",11),a(14,"button",12),b("click",function(){S(t);let s=u();return F(s.onSubmit())}),a(15,"mat-icon"),r(16,"save"),o(),r(17," Save "),o()}if(i&2){let t,n,s,m,d,p=u();g("disabled",p.exportingPDF()||p.statusUpdating()||p.isSubmitted()),l(2),T(p.exportingPDF()?"download":"picture_as_pdf"),l(),C(" ",p.exportingPDF()?"Exporting...":"Export to PDF"," "),l(),h(((t=p.reservation.value())==null?null:t.status)!==p.ReservationStatus.CANCELLED&&((t=p.reservation.value())==null?null:t.status)!==p.ReservationStatus.NO_SHOW?4:-1),l(),g("disabled",p.isSubmitted()),l(4),h(p.canChangeRooms()&&p.isSingleBooking()?9:-1),l(),h(((n=p.reservation.value())==null?null:n.status)===p.ReservationStatus.PENDING||((n=p.reservation.value())==null?null:n.status)===p.ReservationStatus.RESERVED?10:-1),l(),h(((s=p.reservation.value())==null?null:s.status)===p.ReservationStatus.CHECKED_OUT||((s=p.reservation.value())==null?null:s.status)===p.ReservationStatus.CANCELLED||((s=p.reservation.value())==null?null:s.status)===p.ReservationStatus.NO_SHOW?11:-1),l(),h(((m=p.reservation.value())==null?null:m.status)===p.ReservationStatus.CONFIRMED?12:-1),l(),h(((d=p.reservation.value())==null?null:d.status)===p.ReservationStatus.CHECKED_IN?13:-1),l(),g("disabled",p.isSubmitted())}}function Cr(i,e){if(i&1){let t=N();a(0,"a",9),b("click",function(){S(t);let s=u();return F(s.payment())}),a(1,"mat-icon"),r(2,"payment"),o(),r(3," Payment "),o(),a(4,"a",14),b("click",function(){S(t);let s=u();return F(s.onSubmit())}),a(5,"mat-icon"),r(6,"event"),o(),r(7," Reserve "),o()}if(i&2){let t=u();g("disabled",t.isSubmitted()),l(4),g("disabled",t.isSubmitted())}}function vr(i,e){if(i&1&&(a(0,"div",5),_(1,"mat-spinner",15),a(2,"span",16),r(3),o()()),i&2){let t=u();l(3),C(" ",t.isEditing()?"Loading reservation...":"Creating reservation..."," ")}}function yr(i,e){if(i&1){let t=N();a(0,"div",17)(1,"div",27)(2,"mat-icon",28),r(3,"error"),o(),a(4,"div",29)(5,"h3",30),r(6,"Error"),o(),a(7,"p",31),r(8),o(),a(9,"button",32),b("click",function(){S(t);let s=u(2);return F(s.clearError())}),r(10,"Dismiss"),o()()()()}if(i&2){let t=u(2);l(8),T(t.reservation.error())}}function xr(i,e){if(i&1){let t=N();a(0,"app-room-sharers",33),On("selectedGuestChange",function(s){S(t);let m=u(2);return An(m.selectedGuest,s)||(m.selectedGuest=s),F(s)}),b("selectedGuestChange",function(s){S(t);let m=u(2);return F(m.onSelectedGuestChange(s))})("sharerAdded",function(){S(t);let s=u(2);return F(s.onAddSharer())})("sharerEdited",function(s){S(t);let m=u(2);return F(m.onEditSharer(s))})("sharerDeleted",function(s){S(t);let m=u(2);return F(m.onDeleteSharer(s))}),o()}if(i&2){let t=u(2);wn("selectedGuest",t.selectedGuest),g("quickReservation",t.quickReservation())("reservation",t.reservation.value())}}function br(i,e){if(i&1){let t=N();a(0,"app-room-details",34),b("roomChangeRequested",function(s){S(t);let m=u(2);return F(m.openRoomChangeDialog(s))}),o()}if(i&2){let t=u(2);g("reservation",t.reservation.value())("selectedRoomIds",t.selectedRoomIds())}}function Sr(i,e){if(i&1&&_(0,"app-room-change-history",26),i&2){let t=u(2);g("reservation",t.reservation.value())}}function Fr(i,e){if(i&1&&_(0,"app-reservation-transactions",26),i&2){let t=u(2);g("reservation",t.reservation.value())}}function Mr(i,e){if(i&1&&_(0,"app-reservation-orders",26),i&2){let t=u(2);g("reservation",t.reservation.value())}}function Er(i,e){if(i&1){let t=N();a(0,"div",0),f(1,yr,11,1,"div",17),a(2,"form",18),b("ngSubmit",function(){S(t);let s=u();return F(s.onSubmit())}),a(3,"div",19)(4,"app-guest-details",20),b("guestAdded",function(){S(t);let s=u();return F(s.onAddGuest())})("guestEdited",function(){S(t);let s=u();return F(s.onEditGuest())})("guestDeleted",function(){S(t);let s=u();return F(s.onDeleteGuest())})("guestSelected",function(s){S(t);let m=u();return F(m.onGuestSelected(s))}),o(),_(5,"app-stay-details",21)(6,"payment-info",22),f(7,xr,1,3,"app-room-sharers",23)(8,br,1,2,"app-room-details",24),_(9,"app-special-requests",25),f(10,Sr,1,1,"app-room-change-history",26),f(11,Fr,1,1,"app-reservation-transactions",26),f(12,Mr,1,1,"app-reservation-orders",26),o()()()}if(i&2){let t,n=u();l(),h(n.reservation.error()?1:-1),l(),g("formGroup",n.reservationForm),l(2),g("guest",n.selectedGuest()),l(),g("quickReservation",n.quickReservation())("isEditing",n.isEditing())("reservation",n.reservation.value()),l(),g("reservationForm",n.reservationForm),l(),h(n.isSingleBooking()?7:8),l(2),g("reservationForm",n.reservationForm),l(),h(n.isEditing()&&(((t=n.reservation.value())==null||t.roomChanges==null?null:t.roomChanges.length)??0)>0?10:-1),l(),h(n.isEditing()?11:-1),l(),h(n.isEditing()?12:-1)}}var yi=class i{router=v(Kn);route=v(nt);location=v(Hn);fb=v(Re);reservationService=v(rn);roomsService=v(Dt);guestService=v(je);authService=v(Ut);storeStore=v(W);snackBar=v(at);cdr=v($n);dialog=v(Ke);destroy$=new Qe;reservationFormService=v(oe);id=R(this.route.snapshot.paramMap.get("id"));isSubmitted=R(!1);quickReservationQuery=R(this.route.snapshot.queryParamMap.get("quickReservation"));statusUpdating=R(!1);exportingPDF=R(!1);ReservationStatus=Dn;quickReservation=x(()=>{let e=this.quickReservationQuery();return e?JSON.parse(e):null});currentUser=L(this.authService.currentUser,{initialValue:null});selectedGuest=R(null);isEditing=x(()=>!!this.id());paymentRedirection=R(!1);constructor(){this.reservationFormService.setForm(this.reservationForm),this.route.queryParamMap.subscribe(e=>{let t=e.get("paymentRedirection");t&&this.paymentRedirection.set(!!t)})}bookingType=x(()=>this.isEditing()?this.reservationForm.get("bookingType")?.value:this.quickReservation()?.bookingType);isSingleBooking=x(()=>this.bookingType()==="single");selectedRoomIds=x(()=>this.isEditing()?this.reservation.hasValue()?this.reservation.value().rooms.map(e=>e.room._id):[]:this.quickReservation()?.selectedRoom||[]);exportReservationToPDF(){return Ce(this,null,function*(){let e=this.reservation.value();if(e){this.exportingPDF.set(!0);try{let t=yield this.reservationService.exportReservationToPDF(e._id).toPromise();if(t){let n=window.URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download=`reservation-${e.confirmationNumber}.pdf`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(n),this.snackBar.open("Reservation details exported to PDF successfully!","Close",{duration:3e3})}}catch(t){console.error("Error exporting reservation to PDF:",t);let n=t instanceof Error?t.message:"Failed to export reservation to PDF";this.snackBar.open(n,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.exportingPDF.set(!1)}}})}reservationForm=this.fb.group({bookingType:[this.quickReservation()?.bookingType,[c.required]],guest:["",[c.required]],store:[this.storeStore.selectedStore()?._id||"",[c.required]],checkInDate:[new Date(this.quickReservation()?.checkInDate),[c.required]],checkOutDate:[new Date(this.quickReservation()?.checkOutDate),[c.required]],numberOfNights:[1,[c.required,c.min(1)]],bookingSource:["walk_in",[c.required]],createdBy:[this.currentUser()?._id,[c.required]],paymentInfo:this.fb.group({method:[{value:"cash",disabled:!0},[c.required]],status:[{value:"pending",disabled:!0},[c.required]]}),numberOfAdults:[1,[c.required,c.min(1)]],numberOfChildren:[0,[c.required,c.min(0)]],pricing:this.fb.group({subtotal:[0,[c.required,c.min(0)]],taxes:[0,[c.min(0)]],fees:this.fb.group({serviceFee:[0,[c.min(0)]],cleaningFee:[0,[c.min(0)]],resortFee:[0,[c.min(0)]],other:[0,[c.min(0)]]}),discounts:[0,[c.min(0)]],total:[0,[c.required,c.min(0)]],paid:[0,[c.min(0)]],balance:[0]}),specialRequests:["",[]],internalNotes:["",[]],sharers:this.fb.array([]),rooms:this.fb.array([])});availableRoomsResource=Fe({params:()=>({checkIn:this.checkIn(),checkOut:this.checkOut()}),stream:({params:e})=>this.getAvailableRooms({checkIn:e.checkIn,checkOut:e.checkOut})});checkIn=L(this.reservationForm.get("checkInDate").valueChanges,{initialValue:this.reservationForm.get("checkInDate").value});checkOut=L(this.reservationForm.get("checkOutDate").valueChanges,{initialValue:this.reservationForm.get("checkOutDate").value});reservation=Fe({params:()=>({id:this.id()}),stream:({params:e})=>this.getReservation(e.id).pipe(Xe(t=>(t&&(this.populateForm(t),this.paymentRedirection()&&this.showPaymentRequiredDialog(t)),t)))});reopenReservation(){return Ce(this,null,function*(){let e=this.reservation.value();if(!e)return;if(e.status!=="cancelled"&&e.status!=="checked_out"&&e.status!=="no_show"){this.snackBar.open("Only cancelled, checked-out, or no-show reservations can be reopened","Close",{duration:5e3,panelClass:["error-snackbar"]});return}let t=this.storeStore.selectedStore()?._id;if(!t){this.snackBar.open("Store information not available","Close",{duration:5e3,panelClass:["error-snackbar"]});return}this.dialog.open(di,{width:"400px",disableClose:!0,data:{storeId:t,actionDescription:"reopen this cancelled reservation",reservationId:e._id}}).afterClosed().subscribe(s=>Ce(this,null,function*(){if(s&&s.authorized&&s.pin){this.statusUpdating.set(!0);try{let m=yield this.reservationService.reopenReservation(e._id,s.pin).toPromise();m&&(this.reservation.set(m),this.snackBar.open("Reservation reopened successfully","Close",{duration:3e3,panelClass:["success-snackbar"]}))}catch(m){console.error("Error reopening reservation:",m);let d="Failed to reopen reservation";(m instanceof Error&&m.message||m&&typeof m=="object"&&m.message)&&(d=m.message),this.snackBar.open(d,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.statusUpdating.set(!1)}}}))})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getSharersFormArray(){return this.reservationForm.controls.sharers}getRoomsFormArray(){return this.reservationForm.controls.rooms}getAvailableRooms(e){let t=this.storeStore.selectedStore()?._id,n=new Date(e.checkIn).toISOString().split("T")[0],s=new Date(e.checkOut).toISOString().split("T")[0];return!n||!s||!t?Ot([]):this.roomsService.getAvailableRooms({storeId:t,checkInDate:n,checkOutDate:s})}getReservation(e){return this.reservationService.getReservationById(e)}totalAmount=x(()=>{let e=this.reservationForm.get("subtotal")?.value||0,t=this.reservationForm.get("taxes")?.value||0,n=this.reservationForm.get("discount")?.value||0,s=e+t-n;return Math.max(0,s)});onAddGuest(){this.snackBar.open("Guest creation dialog will be implemented","Close",{duration:3e3})}onEditGuest(){this.selectedGuest()&&this.snackBar.open("Guest edit dialog will be implemented","Close",{duration:3e3})}onGuestSelected(e){this.selectedGuest.set(e),this.reservationForm.patchValue({guest:e._id}),this.isSingleBooking()&&this.getPrimaryGuest()&&(this.getPrimaryGuest()?.patchValue({guest:e._id,meta:e,guestType:"adult",checkInDate:this.checkIn(),checkOutDate:this.checkOut()}),this.getPrimaryRoom()?.patchValue({assignedGuest:e._id,assignedGuestName:this.guestService.getGuestName(e)})),this.snackBar.open(`Guest ${this.guestService.getGuestName(e)} selected`,"Close",{duration:2e3,panelClass:["success-snackbar"]})}onDeleteGuest(){let e=this.getSharersFormArray(),t=e.length>1&&Array.from({length:e.length-1},(n,s)=>e.at(s+1)).some(n=>n?.get("guest")?.value);if(this.isSingleBooking()&&t){this.snackBar.open("Cannot remove primary guest while there are other sharers assigned. Please remove sharers first.","Close",{duration:3e3,panelClass:["error-snackbar"]});return}this.selectedGuest.set(null),this.getPrimaryGuest()?.patchValue({guest:null,meta:null,guestType:null}),this.snackBar.open("Guest removed","Close",{duration:2e3,panelClass:["success-snackbar"]})}getPrimaryGuest(){return this.getSharersFormArray().length>0?this.getSharersFormArray().at(0):null}getPrimaryRoom(){return this.getRoomsFormArray().length>0?this.getRoomsFormArray().at(0):null}onSelectedGuestChange(e){}populateForm(e){this.reservationForm.patchValue({bookingType:e?.bookingType||"group",guest:e.guest._id,checkInDate:new Date(e.checkInDate),checkOutDate:new Date(e.checkOutDate),numberOfNights:e.numberOfNights,bookingSource:e.bookingSource,createdBy:e?.createdBy?._id,paymentInfo:{method:e.paymentInfo?.method||"cash",status:e.paymentInfo?.status||"pending"},numberOfAdults:e.numberOfAdults||1,numberOfChildren:e.numberOfChildren||0,pricing:{subtotal:e.pricing?.subtotal||0,taxes:e.pricing?.taxes||0,fees:{serviceFee:e.pricing?.fees?.serviceFee||0,cleaningFee:e.pricing?.fees?.cleaningFee||0,resortFee:e.pricing?.fees?.resortFee||0,other:e.pricing?.fees?.other||0},discounts:e.pricing?.discounts||0,total:e.pricing?.total||0,paid:e.pricing?.paid||0,balance:e.pricing?.balance||0},specialRequests:e.specialRequests||"",internalNotes:e.internalNotes||""}),e.guest&&this.selectedGuest.set(e.guest)}payment(){this.isEditing()?this.showPaymentRequiredDialog(this.reservation.value()):this.onSubmit(!0)}onSubmit(e){if(this.reservationForm.invalid){let m=this.getInvalidControls(this.reservationForm);this.dialog.open(li,{data:{invalidControls:m,title:"Form Validation Errors",message:"Please fix the following errors before submitting:"},width:"500px",maxWidth:"90vw",disableClose:!1});return}if(!this.selectedGuest()){this.snackBar.open("Please select a guest","Close",{duration:3e3,panelClass:["error-snackbar"]});return}let n=this.reservationForm.getRawValue();if(!this.storeStore.selectedStore()?._id){this.snackBar.open("No store selected","Close",{duration:3e3,panelClass:["error-snackbar"]});return}this.isSubmitted.set(!0),this.isEditing()?this.updateReservation(n):this.createReservation(n,e)}createReservation(e,t){this.reservationService.createReservation(e).pipe(he(this.destroy$)).subscribe({next:n=>{this.isSubmitted.set(!1),this.snackBar.open("Reservation created successfully","Close",{duration:3e3,panelClass:["success-snackbar"]}),this.router.navigate(["../edit",n._id],{relativeTo:this.route}).then(()=>{t&&this.showPaymentRequiredDialog(n)})},error:n=>{this.isSubmitted.set(!1),console.error("Error creating reservation:",n),this.snackBar.open("Failed to create reservation. Please try again.","Close",{duration:3e3,panelClass:["error-snackbar"]})}})}updateReservation(e){let t=this.id();t&&this.reservationService.updateReservation(t,this.reservationForm.getRawValue()).pipe(he(this.destroy$)).subscribe({next:n=>{this.isSubmitted.set(!1),this.snackBar.open("Reservation updated successfully","Close",{duration:3e3,panelClass:["success-snackbar"]}),this.reservation.reload()},error:n=>{console.error("Error updating reservation:",n),this.isSubmitted.set(!1),this.snackBar.open("Failed to update reservation. Please try again.","Close",{duration:3e3,panelClass:["error-snackbar"]})}})}onAddSharer(){this.snackBar.open("Guest selection dialog will be implemented","Close",{duration:3e3})}onEditSharer(e){let{index:t,sharer:n}=e;this.snackBar.open(`Editing sharer at index ${t}`,"Close",{duration:3e3})}onDeleteSharer(e){let{index:t}=e;this.snackBar.open(`Sharer at index ${t} deleted`,"Close",{duration:2e3,panelClass:["success-snackbar"]})}performCheckOut(){return Ce(this,null,function*(){let e=this.reservation.value();if(e){if(this.requiresPaymentBeforeCheckout(e)){this.showPaymentRequiredDialog(e);return}this.statusUpdating.set(!0);try{let t=yield this.reservationService.checkOutReservationWithRooms(e._id).toPromise();t&&(this.reservation.set(t),this.snackBar.open("Guest checked out successfully! Room status updated to cleaning.","Close",{duration:5e3}))}catch(t){console.error("Error during check-out:",t);let n=t instanceof Error?t.message:"Failed to check out guest";this.snackBar.open(n,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.statusUpdating.set(!1)}}})}requiresPaymentBeforeCheckout(e){let t=e.pricing.balance>0,n=e.paymentInfo?.status!=="paid";return t&&n}showPaymentRequiredDialog(e){let t={reservation:e,isCheckoutFlow:!0};this.dialog.open(pi,{data:t,width:"600px",maxWidth:"90vw",disableClose:!0}).afterClosed().subscribe(s=>{if(s?.confirmed){this.reservation.reload();let m=this.reservation.value();if(m&&m.pricing.balance<=0)this.snackBar.open("\u2713 Payment completed! Checkout is now available.","Close",{duration:5e3,panelClass:["success-snackbar"],horizontalPosition:"center",verticalPosition:"top"});else{let d=m?m.pricing.balance:0;this.snackBar.open(`\u26A0\uFE0F Checkout Requires Full Payment - Outstanding balance: ${this.storeStore.selectedStore()?.currency} ${d}. Please collect full payment before checkout.`,"Continue Collecting",{duration:0,panelClass:["warning-snackbar"],horizontalPosition:"center",verticalPosition:"top"}).onAction().subscribe(()=>{this.showPaymentRequiredDialog(m)})}}else{let m=this.reservation.value();m&&this.requiresPaymentBeforeCheckout(m)&&this.snackBar.open(`\u26A0\uFE0F Checkout Requires Full Payment - Outstanding balance: 
            ${this.storeStore.selectedStore()?.currency} ${m.pricing.balance}. Please collect full payment before checkout.`,"Close",{duration:5e3,panelClass:["warning-snackbar"],horizontalPosition:"center",verticalPosition:"top"})}})}getInvalidControls(e,t=""){let n=[];return Object.keys(e.controls).forEach(s=>{let m=e.get(s),d=t?`${t}.${s}`:s;m&&(m instanceof Kt||m instanceof Pt?n.push(...this.getInvalidControls(m,d)):m.invalid&&n.push(d))}),n}updateReservationStatus(e){return Ce(this,null,function*(){let t=this.reservation.value();if(!(!t||t.status===e)){if(e==="checked_in"){this.showCheckInDialog(t);return}if(e==="checked_out"){this.performCheckOut();return}(e==="cancelled"||e==="no_show")&&!confirm(`Are you sure you want to change the status to ${e}?`)||(yield this.performStatusUpdate(e))}})}performStatusUpdate(e){return Ce(this,null,function*(){let t=this.reservation.value();if(t){this.statusUpdating.set(!0);try{let n={status:e},s=yield this.reservationService.updateReservation(t._id,n).toPromise();s&&(this.reservation.set(s),this.snackBar.open(`Reservation status updated to ${e}`,"Close",{duration:3e3,panelClass:["success-snackbar"]}))}catch(n){console.error("Error updating reservation status:",n);let s=n instanceof Error?n.message:"Failed to update reservation status";this.snackBar.open(s,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.statusUpdating.set(!1)}}})}showCheckInDialog(e){let t={reservation:e};this.dialog.open(ui,{data:t,width:"600px",maxWidth:"90vw",disableClose:!0}).afterClosed().subscribe(s=>{s?.confirmed&&this.performCheckIn(s)})}performCheckIn(e){return Ce(this,null,function*(){let t=this.reservation.value();if(t){this.statusUpdating.set(!0);try{let n=yield this.reservationService.checkInReservationWithRooms(t._id,e).toPromise();n&&(this.reservation.set(n),this.snackBar.open("Guest checked in successfully! Room status updated to occupied.","Close",{duration:5e3}))}catch(n){console.error("Error during check-in:",n);let s=n instanceof Error?n.message:"Failed to check in guest";this.snackBar.open(s,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.statusUpdating.set(!1)}}})}canChangeRooms(){let e=this.reservation.value();if(!e)return!1;let t=e.status;return t&&!["checked_out","cancelled","no_show"].includes(t)}openRoomChangeDialog(e){return Ce(this,null,function*(){let t=this.reservation.value();if(!t||!this.canChangeRooms()){this.snackBar.open("Cannot change rooms for this reservation","Close",{duration:3e3});return}this.dialog.open(ci,{width:"500px",maxWidth:"95vw",disableClose:!0,data:{reservationId:t._id,currentRooms:t.rooms,currentRoomIndex:e,checkInDate:new Date(t.checkInDate).toISOString(),checkOutDate:new Date(t.checkOutDate).toISOString(),numberOfNights:t.numberOfNights,currency:this.storeStore.selectedStore()?.currency||"USD",actualCheckInDate:t.actualCheckInDate?new Date(t.actualCheckInDate).toISOString():void 0,reservationStatus:t.status}}).afterClosed().subscribe(s=>Ce(this,null,function*(){if(s)try{(yield this.reservationService.changeRooms(t._id,s).toPromise())?.success&&(this.snackBar.open("Room changed successfully","Close",{duration:3e3}),this.reservation.reload())}catch(m){console.error("Error changing rooms:",m);let d=m?.error?.error||m?.error?.message||m?.message||"Failed to change rooms";this.snackBar.open(d,"Close",{duration:5e3})}}))})}onCancel(){this.location.back()}clearError(){}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=k({type:i,selectors:[["app-reservation-form"]],decls:14,vars:4,consts:[[1,"max-w-12xl","px-4"],[1,"flex","justify-between","items-center","py-4"],["matButton","","color","primary",3,"click"],[1,"mr-1",2,"font-size","18px","width","18px","height","18px"],[1,"flex","space-x-3"],[1,"flex","justify-center","items-center","py-12"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-600","mt-1"],[1,"font-mono","font-semibold","text-gray-900"],["matButton","outlined",3,"click","disabled"],["matButton","tonal",3,"disabled"],["matButton","outlined",3,"disabled"],["matButton","filled","color","primary","type","submit",3,"click","disabled"],["matButton","tonal",3,"click","disabled"],["matButton","filled","color","primary",3,"click","disabled"],["diameter","40"],[1,"ml-3","text-gray-600"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","mb-6"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","lg:grid-cols-4","gap-6"],[1,"lg:col-span-2",3,"guestAdded","guestEdited","guestDeleted","guestSelected","guest"],[3,"quickReservation","isEditing","reservation"],[3,"reservationForm"],[1,"lg:col-span-4",3,"selectedGuest","quickReservation","reservation"],[1,"lg:col-span-4",3,"reservation","selectedRoomIds"],[1,"lg:col-span-4",3,"reservationForm"],[1,"lg:col-span-4",3,"reservation"],[1,"flex"],[1,"text-red-500","mr-3"],[1,"flex-1"],[1,"text-red-800","font-medium"],[1,"text-red-700","text-sm","mt-1"],["mat-button","",1,"mt-2",3,"click"],[1,"lg:col-span-4",3,"selectedGuestChange","sharerAdded","sharerEdited","sharerDeleted","selectedGuest","quickReservation","reservation"],[1,"lg:col-span-4",3,"roomChangeRequested","reservation","selectedRoomIds"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"div",1)(2,"div")(3,"a",2),b("click",function(){return n.onCancel()}),a(4,"mat-icon",3),r(5,"arrow_back"),o(),r(6," Back to Reservations "),o(),f(7,mr,6,1)(8,dr,4,1),o(),a(9,"div",4),f(10,_r,18,11)(11,Cr,8,2),o()()(),f(12,vr,4,1,"div",5),f(13,Er,13,12,"div",0)),t&2&&(l(7),h(n.isEditing()?7:8),l(3),h(n.isEditing()?10:11),l(2),h(n.isEditing()&&n.reservation.isLoading()?12:-1),l(),h(n.reservation.hasValue()?13:-1))},dependencies:[w,ee,Ve,X,U,O,K,ie,ge,j,me,A,z,Ie,Ne,$e,Ht,un,pn,gn,fn,hn,_n,Cn,vn,yn],styles:["@media(max-width:768px){.grid[_ngcontent-%COMP%]{grid-template-columns:repeat(1,minmax(0,1fr))}.pricing-summary[_ngcontent-%COMP%]{margin-left:1rem;margin-right:1rem}}"]})};export{yi as ReservationFormComponent};
