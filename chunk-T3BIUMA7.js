import{c as W,d as X}from"./chunk-2QJHH5H3.js";import{a as L}from"./chunk-UQ6ZHJLZ.js";import{B as K,C as O,F as Q,I as U,b as P,d as c,g as B,h as T,m as q,o as D,r as G,x as V,z as j}from"./chunk-XY46NWPA.js";import{a as z,b as A,c as H,f as R,g as J}from"./chunk-Y7KHCUH6.js";import{a as Y,b as Z}from"./chunk-VJDAHTGR.js";import{a as N}from"./chunk-VMTHPWCC.js";import{l as F,m as k,n as I}from"./chunk-FJR6RDUA.js";import{b as $,c as ee}from"./chunk-4N6XGVIM.js";import"./chunk-DX7AZUD7.js";import"./chunk-C3MGKPDK.js";import{c as x}from"./chunk-QQ5WRBM6.js";import"./chunk-5PWABXJE.js";import{Bb as _,Db as S,E as f,Eb as v,Jb as u,Kb as i,Lb as o,Mb as b,Ub as C,W as g,_a as r,fa as l,ic as a,jc as w,kb as E,kc as y,n as p,o as M,va as h}from"./chunk-FR2FBSQW.js";import"./chunk-EQDQRRRY.js";function ie(m,n){m&1&&(i(0,"mat-error"),a(1,"Please enter a valid email"),o())}function oe(m,n){m&1&&(i(0,"mat-error"),a(1,"Password is required"),o())}var te=class m{fb=l(V);authService=l(N);snackBar=l(L);router=l(x);hide=h(!0);loading=h(!1);storeService=l($);storeStore=l(ee);clickEvent(n){this.hide.set(!this.hide()),n.stopPropagation()}loginForm=this.fb.group({email:["",[c.required,c.email]],password:["",c.required]});onSubmit(){if(this.loginForm.valid){this.loading.set(!0);let{email:n,password:s}=this.loginForm.value;this.authService.login(n,s).pipe(g(e=>{let d=e._id;return this.storeService.getMerchantStores(d).pipe(g(t=>!t||t.length===0?M(()=>new Error("No stores found for this merchant.")):(this.storeStore.setSelectedStores(t),this.storeStore.setSelectedStore(t[0]),setTimeout(()=>{this.router.navigate(["/dashboard"])},2e3),this.loading.set(!1),p(null))),f(t=>(this.snackBar.open(t.message||"Failed to load stores.","Close",{duration:5e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["error-snackbar"]}),this.loading.set(!1),p(null))))}),f(e=>(this.snackBar.open(e.error?.message||e.message||"Login failed. Please try again.","Close",{duration:5e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["error-snackbar"]}),this.loading.set(!1),p(null)))).subscribe()}}static \u0275fac=function(s){return new(s||m)};static \u0275cmp=E({type:m,selectors:[["login"]],decls:25,vars:9,consts:[[1,"min-h-screen","w-full","flex","items-center","justify-center","p-4","bg-gray-50"],[1,"w-full","max-w-sm"],[1,"p-3","!bg-white"],[1,"mb-6","text-center"],[1,"text-xl","font-bold","!text-center"],[1,"flex","flex-col","gap-4",3,"ngSubmit","formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","email","placeholder","Enter your email"],["matSuffix","","fontSet","material-icons-outlined"],["matInput","","formControlName","password","placeholder","Enter your password",3,"type"],["mat-icon-button","","matSuffix","",3,"click"],["fontSet","material-icons-outlined"],["mat-raised-button","","color","primary",3,"disabled"]],template:function(s,e){if(s&1&&(i(0,"div",0)(1,"div",1)(2,"mat-card",2)(3,"mat-card-header",3)(4,"mat-card-title",4),a(5,"Sign in to your Shopbot account "),o()(),i(6,"mat-card-content")(7,"form",5),C("ngSubmit",function(){return e.onSubmit()}),i(8,"mat-form-field",6)(9,"mat-label"),a(10,"Email"),o(),b(11,"input",7),i(12,"mat-icon",8),a(13,"email"),o(),S(14,ie,2,0,"mat-error"),o(),i(15,"mat-form-field",6)(16,"mat-label"),a(17,"Password"),o(),b(18,"input",9),i(19,"a",10),C("click",function(t){return e.clickEvent(t)}),i(20,"mat-icon",11),a(21),o()(),S(22,oe,2,0,"mat-error"),o(),i(23,"button",12),a(24),o()()()()()()),s&2){let d,t;r(7),u("formGroup",e.loginForm),r(7),v((d=e.loginForm.get("email"))!=null&&d.hasError("required")?14:-1),r(4),u("type",e.hide()?"password":"text"),r(),_("aria-label","Hide password")("aria-pressed",e.hide()),r(2),w(e.hide()?"visibility_off":"visibility"),r(),v((t=e.loginForm.get("email"))!=null&&t.hasError("required")?22:-1),r(),u("disabled",!e.loginForm.valid||e.loading()),r(),y("",e.loading()?"Logging in...":"Login"," ")}},dependencies:[J,z,H,R,A,I,k,F,X,W,U,K,O,Q,j,q,P,B,T,D,G,Z,Y],encapsulation:2})};export{te as LoginComponent};
