import{a as Ke}from"./chunk-YCJLZT54.js";import{a as Je}from"./chunk-LQU32KS7.js";import{b as Ye,f as je}from"./chunk-4L4VWXIM.js";import{a as Ge}from"./chunk-YZQZHEMG.js";import"./chunk-LCNY3JPX.js";import{a as Ue,b as $e,c as He,h as ze}from"./chunk-MSN3EE44.js";import{a as qe}from"./chunk-HOFFRLAS.js";import{a as Oe}from"./chunk-OFQMF3WN.js";import{a as Fe,b as Re,c as Ne,e as Le,g as Ae,j as Ve,l as Be}from"./chunk-T7LGKL43.js";import{a as De,b as Pe}from"./chunk-E4PTFC5Z.js";import{b as J}from"./chunk-YHIOFNIN.js";import"./chunk-PYUUH7RE.js";import"./chunk-OKEXGVJ3.js";import"./chunk-O7SXWP4H.js";import{f as le}from"./chunk-F5YHHFYE.js";import{i as Z}from"./chunk-ZKQYDJ5W.js";import{a as Ie,b as Ee,c as we,e as ke}from"./chunk-KOF2GMDH.js";import{a as be,b as Te}from"./chunk-LCF3SYDV.js";import{d as j}from"./chunk-ZLVLWRZH.js";import"./chunk-TVH27JLT.js";import"./chunk-G4CZ6LK2.js";import"./chunk-I564X6SI.js";import"./chunk-VTDH2LYT.js";import{b as ye,c as fe,d as Ce}from"./chunk-63HT37SK.js";import{a as xe,e as Se,h as _e}from"./chunk-YJCGHVXK.js";import"./chunk-UHBDKNKX.js";import{a as ve,b as Me}from"./chunk-3ZLH5HUN.js";import{B as ge,b as se,d as b,g as ce,h as me,m as pe,s as de,t as ue,z as he}from"./chunk-O5GCTPYR.js";import"./chunk-EGLRIU4H.js";import{a as W,b as X}from"./chunk-5TL46KBL.js";import"./chunk-53AK2UWQ.js";import"./chunk-BFT2MTJY.js";import{a as ne,b as ie,c as ae,f as oe,h as re}from"./chunk-JONI64R4.js";import"./chunk-H7INH462.js";import"./chunk-OOL2KACG.js";import"./chunk-KZJMNFJ3.js";import{b as ee,c as te}from"./chunk-G6I3OKXX.js";import{_ as K,ba as Q}from"./chunk-4Z2XUZY2.js";import"./chunk-F436VINI.js";import{G as Y,n as q,u as G}from"./chunk-H22US2IH.js";import{Fc as H,Ib as u,Jb as h,Mb as F,Mc as I,Nb as R,Nc as z,Ob as d,Oc as w,Pb as n,Qb as i,Rb as _,Wc as v,Yb as C,Za as V,ac as y,bb as s,cc as m,fa as M,ka as x,kb as B,la as S,mc as N,qb as O,rc as a,sc as E,tb as U,tc as g,uc as $,wa as f,wb as T}from"./chunk-P5WOETP4.js";import{a as D,b as P}from"./chunk-GAL4ENT6.js";var k=class r{constructor(t){this.sanitizer=t}transform(t){return t?this.sanitizer.bypassSecurityTrustResourceUrl(t):null}static \u0275fac=function(e){return new(e||r)(B(Y,16))};static \u0275pipe=U({name:"sanitizeUrl",type:r,pure:!0})};var Xe=(r,t)=>t._id||t.id,Ze=(r,t)=>t.channelId;function et(r,t){r&1&&(n(0,"div",4),_(1,"mat-spinner",5),i())}function tt(r,t){if(r&1&&(n(0,"mat-card",6)(1,"mat-card-content",30)(2,"mat-icon",31),a(3,"warning"),i(),n(4,"div",32)(5,"h3",33),a(6,"Property Type Required"),i(),n(7,"p",34),a(8),i(),n(9,"p",35),a(10," Please select a valid property type (hotel, resort, guesthouse, etc.) in Step 1 below to enable Channex integration. "),i()()()()),r&2){let e=m(2);s(8),g(' Channel management requires a valid property type. Your property type is currently set to "',e.propertyType(),'". ')}}function nt(r,t){r&1&&(n(0,"mat-card",7)(1,"mat-card-content",30)(2,"div",32)(3,"h3",36),a(4,"Channel Manager Active"),i(),n(5,"p",37),a(6," Your property is synced and ready to receive bookings from distribution channels. "),i()()()())}function it(r,t){r&1&&(n(0,"mat-card",7)(1,"mat-card-content",30)(2,"div",32)(3,"h3",38),a(4,"Setup Required"),i(),n(5,"p"),a(6," Complete the setup steps below to start receiving bookings from OTAs. "),i()()()())}function at(r,t){r&1&&a(0,"Step 1: Sync Property")}function ot(r,t){if(r&1){let e=C();n(0,"div",12)(1,"div",39)(2,"span",40),a(3,"Property ID:"),i(),n(4,"span",41),a(5),i()(),n(6,"div",39)(7,"span",40),a(8,"Last Synced:"),i(),n(9,"span",42),a(10),I(11,"date"),i()(),n(12,"button",26),y("click",function(){x(e);let l=m(2);return S(l.syncStore())}),n(13,"mat-icon"),a(14,"refresh"),i(),a(15," Re-sync Property "),i()()}if(r&2){let e,o,l=m(2);s(5),g(" ",(e=l.channexStatus())==null||e.channex==null?null:e.channex.propertyId," "),s(5),g(" ",w(11,3,(o=l.channexStatus())==null||o.channex==null?null:o.channex.lastSyncAt,"MMM d, y h:mm a")," "),s(2),d("disabled",l.isSyncingStore())}}function rt(r,t){if(r&1){let e=C();n(0,"form",13)(1,"mat-form-field",18)(2,"mat-label"),a(3,"Property Type"),i(),n(4,"mat-select",43)(5,"mat-option",44),a(6,"Hotel"),i(),n(7,"mat-option",45),a(8,"Hostel"),i(),n(9,"mat-option",46),a(10,"Apartment"),i(),n(11,"mat-option",47),a(12,"Guest House"),i(),n(13,"mat-option",48),a(14,"Resort"),i(),n(15,"mat-option",49),a(16,"Motel"),i(),n(17,"mat-option",50),a(18,"Villa"),i(),n(19,"mat-option",51),a(20,"Boutique Hotel"),i(),n(21,"mat-option",52),a(22,"Bed & Breakfast"),i(),n(23,"mat-option",53),a(24,"Lodge"),i()()(),n(25,"div",54)(26,"mat-form-field",18)(27,"mat-label"),a(28,"Check-in Time"),i(),_(29,"input",55),i(),n(30,"mat-form-field",18)(31,"mat-label"),a(32,"Check-out Time"),i(),_(33,"input",56),i()(),n(34,"button",57),y("click",function(){x(e);let l=m(2);return S(l.syncStore())}),a(35),i()()}if(r&2){let e=m(2);d("formGroup",e.syncPropertyForm),s(34),d("disabled",e.isSyncingStore()||e.syncPropertyForm.invalid||!e.isHotelProperty())("matTooltip",e.isHotelProperty()?"":"Please select a valid property type to sync with Channex"),s(),g(" ",e.isSyncingStore()?"Please wait...":"Sync Property to Channex"," ")}}function lt(r,t){r&1&&a(0,"Step 2: Sync Room Types")}function st(r,t){r&1&&(n(0,"div",14)(1,"mat-icon",58),a(2,"meeting_room"),i(),n(3,"p"),a(4,"No room types found. Please create room types first."),i()())}function ct(r,t){r&1&&(n(0,"mat-chip",67),a(1," Synced "),i())}function mt(r,t){r&1&&_(0,"mat-spinner",68)}function pt(r,t){if(r&1){let e=C();n(0,"button",70),y("click",function(){x(e);let l=m().$implicit,c=m(3);return S(c.syncRoomType(l._id||l.id||"",l.name))}),n(1,"mat-icon"),a(2,"sync"),i(),a(3," Sync "),i()}}function dt(r,t){if(r&1&&(n(0,"mat-list-item")(1,"mat-icon",63),a(2,"meeting_room"),i(),n(3,"div",64),a(4),i(),n(5,"div",65),a(6),i(),n(7,"div",66),u(8,ct,2,0,"mat-chip",67)(9,mt,1,0,"mat-spinner",68)(10,pt,4,0,"button",69),i()()),r&2){let e=t.$implicit,o=m(3);s(4),E(e.name),s(2),E(e.description||"No description"),s(2),h(o.isRoomTypeSynced(e._id||e.id||"")?8:o.isRoomTypeSyncing(e._id||e.id||"")?9:10)}}function ut(r,t){if(r&1){let e=C();n(0,"div",59)(1,"button",60),y("click",function(){x(e);let l=m(2);return S(l.syncAllRoomTypes())}),n(2,"mat-icon"),a(3,"sync"),i(),a(4," Sync All Room Types "),i()(),_(5,"mat-divider",61),n(6,"mat-nav-list",62),F(7,dt,11,3,"mat-list-item",null,Xe),i()}if(r&2){let e=m(2);s(7),R(e.roomTypes())}}function ht(r,t){r&1&&a(0,"Step 3: Push Availability")}function gt(r,t){r&1&&a(0,"Step 4: Connect Channels")}function xt(r,t){if(r&1&&(n(0,"div",74)(1,"div",75)(2,"mat-icon",76),a(3,"check_circle"),i(),n(4,"div")(5,"p",77),a(6),i(),n(7,"p",78),a(8),I(9,"date"),i()()(),n(10,"mat-chip",79),a(11),i()()),r&2){let e=t.$implicit;s(6),E(e.channelName),s(2),g(" Connected ",w(9,3,e.connectedAt,"short")," "),s(3),g(" ",e.status," ")}}function St(r,t){if(r&1&&(_(0,"mat-divider",61),n(1,"h4",72),a(2,"Connected Channels"),i(),n(3,"div",73),F(4,xt,12,6,"div",74,Ze),i()),r&2){let e,o=m(3);s(4),R((e=o.channexStatus())==null||e.channex==null?null:e.channex.connectedChannels)}}function _t(r,t){if(r&1){let e=C();n(0,"p",17),a(1," Your property is ready! Click below to connect to OTA channels and start receiving bookings. "),i(),n(2,"div",22)(3,"div",23)(4,"mat-icon",24),a(5,"info"),i(),n(6,"div",25)(7,"p",71),a(8,"Connect OTA Channels"),i(),n(9,"p"),a(10,"You'll be able to connect to Booking.com, Airbnb, Expedia, and other major booking platforms. The connection process is secure and managed by Channex."),i()()()(),n(11,"button",26),y("click",function(){x(e);let l=m(2);return S(l.connectChannels())}),a(12),i(),u(13,St,6,0)}if(r&2){let e,o=m(2);s(11),d("disabled",o.isLoadingIframe()),s(),g(" ",o.isLoadingIframe()?"Connecting...":"Connect to OTA Channels"," "),s(),h(!((e=o.channexStatus())==null||e.channex==null)&&e.channex.connectedChannels&&((e=o.channexStatus())==null||e.channex==null?null:e.channex.connectedChannels.length)>0?13:-1)}}function yt(r,t){if(r&1){let e=C();n(0,"div",28)(1,"div",80)(2,"h4",81),a(3,"Connect Your Channels"),i(),n(4,"button",82),y("click",function(){x(e);let l=m(2);return S(l.closeIframe())}),n(5,"mat-icon"),a(6,"close"),i()()(),n(7,"div",83)(8,"iframe",84),I(9,"sanitizeUrl"),y("load",function(){x(e);let l=m(2);return S(l.onIframeLoad())}),i()(),n(10,"div",85)(11,"mat-icon",86),a(12,"info"),i(),a(13," Use the interface above to connect and configure your OTA channels "),i()()}if(r&2){let e=m(2);s(8),d("src",z(9,1,e.channelIframeUrl()),V)}}function ft(r,t){if(r&1&&(a(0),I(1,"date")),r&2){let e,o=m(3);g(" ",w(1,1,(e=o.channexStatus())==null||e.channex==null?null:e.channex.lastSyncAt,"short")," ")}}function Ct(r,t){r&1&&a(0," Never ")}function vt(r,t){if(r&1&&(n(0,"mat-card",29)(1,"mat-card-header")(2,"mat-card-title",87),a(3,"Current Status"),i()(),n(4,"mat-card-content",88)(5,"div",89)(6,"div",90)(7,"p",91),a(8,"Sync Status"),i(),n(9,"p",92),a(10),i()(),n(11,"div",90)(12,"p",91),a(13,"Room Types Synced"),i(),n(14,"p",92),a(15),i()(),n(16,"div",90)(17,"p",91),a(18,"Last Sync"),i(),n(19,"p",92),u(20,ft,2,4)(21,Ct,1,0),i()()()()()),r&2){let e,o,l,c=m(2);s(10),g(" ",((e=c.channexStatus())==null||e.channex==null?null:e.channex.syncStatus)||"Not Synced"," "),s(5),$(" ",((o=c.channexStatus())==null||o.roomMappings==null?null:o.roomMappings.length)||0," / ",((o=c.channexStatus())==null?null:o.totalRoomTypes)||0," "),s(5),h(!((l=c.channexStatus())==null||l.channex==null)&&l.channex.lastSyncAt?20:21)}}function Mt(r,t){if(r&1){let e=C();u(0,tt,11,1,"mat-card",6),u(1,nt,7,0,"mat-card",7)(2,it,7,0,"mat-card",7),n(3,"mat-horizontal-stepper",8),y("selectionChange",function(l){x(e);let c=m();return S(c.onStepSelectionChange(l))}),n(4,"mat-step",9),T(5,at,1,0,"ng-template",10),n(6,"mat-card",11)(7,"mat-card-content"),u(8,ot,16,6,"div",12)(9,rt,36,4,"form",13),i()()(),n(10,"mat-step",9),T(11,lt,1,0,"ng-template",10),n(12,"mat-card",11)(13,"mat-card-content")(14,"div",12),u(15,st,5,0,"div",14)(16,ut,9,0),i()()()(),n(17,"mat-step",15),T(18,ht,1,0,"ng-template",10),n(19,"mat-card",11)(20,"mat-card-content")(21,"form",16)(22,"p",17),a(23," Choose the date range for which to publish availability and rates to distribution channels. "),i(),n(24,"mat-form-field",18)(25,"mat-label"),a(26,"Start Date"),i(),_(27,"input",19)(28,"mat-datepicker-toggle",20)(29,"mat-datepicker",null,0),i(),n(31,"mat-form-field",18)(32,"mat-label"),a(33,"End Date"),i(),_(34,"input",21)(35,"mat-datepicker-toggle",20)(36,"mat-datepicker",null,1),i(),n(38,"div",22)(39,"div",23)(40,"mat-icon",24),a(41,"info"),i(),n(42,"p",25),a(43," This will push your current room availability, rates, and restrictions for the selected date range. "),i()()(),n(44,"button",26),y("click",function(){x(e);let l=m();return S(l.pushAvailability())}),a(45),i()()()()(),n(46,"mat-step",9),T(47,gt,1,0,"ng-template",10),n(48,"mat-card",11)(49,"mat-card-content")(50,"div",27),u(51,_t,14,3)(52,yt,14,3,"div",28),i()()()()(),u(53,vt,22,4,"mat-card",29)}if(r&2){let e,o,l,c,L=N(30),A=N(37),p=m();h(p.isHotelProperty()?-1:0),s(),h(p.isSetupComplete()?1:2),s(2),d("linear",!0)("selectedIndex",p.currentStep()),s(),d("completed",((e=p.channexStatus())==null||e.channex==null?null:e.channex.syncStatus)==="synced"),s(4),h(((o=p.channexStatus())==null||o.channex==null?null:o.channex.syncStatus)==="synced"?8:9),s(2),d("completed",(((l=p.channexStatus())==null||l.roomMappings==null?null:l.roomMappings.length)||0)>=(((l=p.channexStatus())==null?null:l.totalRoomTypes)||0)&&(((l=p.channexStatus())==null?null:l.totalRoomTypes)||0)>0),s(5),h(p.roomTypes().length===0?15:16),s(2),d("optional",!0),s(4),d("formGroup",p.availabilityForm),s(6),d("matDatepicker",L),s(),d("for",L),s(6),d("matDatepicker",A),s(),d("for",A),s(9),d("disabled",p.isPushingAvailability()||p.availabilityForm.invalid),s(),g(" ",p.isPushingAvailability()?"Pushing Availability...":"Push Availability"," "),s(),d("completed",((c=p.channexStatus())==null||c.channex==null?null:c.channex.syncStatus)==="synced"&&(((c=p.channexStatus())==null||c.roomMappings==null?null:c.roomMappings.length)||0)>=(((c=p.channexStatus())==null?null:c.totalRoomTypes)||0)&&(((c=p.channexStatus())==null?null:c.totalRoomTypes)||0)>0),s(5),h(p.channelIframeUrl()?52:51),s(2),h(p.channexStatus()?53:-1)}}var Qe=class r{storeStore=M(Z);channexService=M(Ke);roomsService=M(Je);snackBar=M(W);fb=M(he);selectedStore=this.storeStore.selectedStore;storeId=v(()=>this.selectedStore()?._id||"");storeName=v(()=>this.selectedStore()?.name||"");storeType=v(()=>this.selectedStore()?.storeType||"restaurant");propertyType=v(()=>this.selectedStore()?.propertyType||"hotel");isHotelProperty=v(()=>{let t=this.propertyType();return t==="hotel"||t==="resort"||t==="boutique_hotel"||t==="motel"||t==="hostel"||t==="guesthouse"||t==="villa"||t==="bed_and_breakfast"||t==="lodge"||t==="apartment"});setupSteps=f([{id:1,title:"Sync Property",description:"Register your hotel with Channex",status:"pending",icon:"hotel"},{id:2,title:"Sync Room Types",description:"Map your room types to distribution channels",status:"pending",icon:"meeting_room"},{id:3,title:"Connect Channels",description:"Link to Booking.com, Airbnb, etc.",status:"pending",icon:"link"}]);currentStep=f(0);channexStatus=f(null);roomTypes=f([]);isLoadingStatus=f(!1);channelIframeUrl=f(null);isLoadingIframe=f(!1);isSetupComplete=v(()=>{let t=this.channexStatus();return t?.channex?.syncStatus==="synced"&&t?.roomMappings&&t.roomMappings.length>0});syncPropertyForm;availabilityForm;isSyncingStore=this.channexService.isSyncingStore;isPushingAvailability=this.channexService.isPushingAvailability;constructor(){this.syncPropertyForm=this.fb.group({propertyType:[this.propertyType()||"hotel",b.required],checkInTime:["15:00",b.required],checkOutTime:["11:00",b.required]});let t=new Date,e=new Date;e.setFullYear(t.getFullYear()+1),this.availabilityForm=this.fb.group({startDate:[t,b.required],endDate:[e,b.required]})}ngOnInit(){this.restoreCachedState(),this.loadChannexStatus(),this.loadRoomTypes()}onStepSelectionChange(t){let e=t?.selectedIndex??0;if(this.setCurrentStep(e),e===2){let o=this.channexStatus()?.channex?.connectedChannels;o&&o.length>0&&!this.channelIframeUrl()&&this.connectChannels()}}loadChannexStatus(){let t=this.storeId();t&&(this.isLoadingStatus.set(!0),this.channexService.getStoreStatus(t).subscribe({next:e=>{this.channexStatus.set(e.data);try{localStorage.setItem(`channexStatus:${t}`,JSON.stringify(e.data))}catch{}this.updateStepsBasedOnStatus(e.data);try{let o=this.currentStep(),l=e.data.channex?.connectedChannels;o===3&&l&&l.length>0&&!this.channelIframeUrl()&&this.connectChannels()}catch{}this.isLoadingStatus.set(!1)},error:e=>{console.error("Failed to load Channex status:",e),this.isLoadingStatus.set(!1),this.showError("Failed to load channel management status")}}))}loadRoomTypes(){let t=this.storeId();t&&this.roomsService.getRoomTypes(t).subscribe({next:e=>{this.roomTypes.set(e)},error:e=>{console.error("Failed to load room types:",e)}})}updateStepsBasedOnStatus(t){let e=this.setupSteps();t.channex?.syncStatus==="synced"?(e[0].status="completed",this.setCurrentStepIfHigher(1)):t.channex?.syncStatus==="error"&&(e[0].status="error",e[0].errorMessage="Sync failed. Please try again."),t.roomMappings&&t.roomMappings.length>0&&(e[1].status="completed",this.setCurrentStepIfHigher(2)),t.roomMappings&&t.roomMappings.length>0&&(e[2].status="completed",this.setCurrentStepIfHigher(3)),this.setupSteps.set([...e])}setCurrentStep(t){this.currentStep.set(t);try{let e=this.storeId();e&&localStorage.setItem(`channelStepper:${e}`,String(t))}catch{}}setCurrentStepIfHigher(t){let e=this.currentStep();t>e&&this.setCurrentStep(t)}restoreCachedState(){let t=this.storeId();if(t)try{let e=localStorage.getItem(`channexStatus:${t}`);if(e){let l=JSON.parse(e);this.channexStatus.set(l),this.updateStepsBasedOnStatus(l)}let o=localStorage.getItem(`channelStepper:${t}`);if(o!==null){let l=Number(o);isNaN(l)||this.setCurrentStep(l)}}catch{}}syncStore(){let t=this.storeId();if(!t||this.syncPropertyForm.invalid)return;if(!this.isHotelProperty()){this.showError("Please set a valid property type (hotel, resort, etc.) to sync with Channex.");return}this.updateStepStatus(0,"in-progress");let e=this.syncPropertyForm.value;this.channexService.syncStoreToChannex(t,e).subscribe({next:o=>{this.updateStepStatus(0,"completed");let l={propertyType:e.propertyType,hotelSettings:P(D({},this.selectedStore()?.hotelSettings||{}),{operationalSettings:P(D({},this.selectedStore()?.hotelSettings?.operationalSettings||{}),{checkInTime:e.checkInTime,checkOutTime:e.checkOutTime})}),channex:{propertyId:o?.store?.channexPropertyId||this.channexStatus()?.channex?.propertyId,syncStatus:"synced",lastSyncAt:new Date().toISOString()}};try{this.storeStore.updateStore$(l)}catch(c){console.error("Failed to invoke store update:",c)}this.setCurrentStep(1),this.showSuccess(o.message),this.loadChannexStatus()},error:o=>{this.updateStepStatus(0,"error",o.error?.message||"Failed to sync property"),this.showError(o.error?.message||"Failed to sync property to Channex")}})}syncRoomType(t,e){let o=this.storeId();o&&this.channexService.syncRoomTypeToChannex(o,t,{}).subscribe({next:l=>{this.showSuccess(`${e} synced successfully`),this.loadChannexStatus()},error:l=>{this.showError(l.error?.message||`Failed to sync ${e}`)}})}syncAllRoomTypes(){let t=this.storeId(),e=this.roomTypes();if(!t||e.length===0)return;this.updateStepStatus(1,"in-progress");let o=0,l=0;e.forEach(c=>{this.channexService.syncRoomTypeToChannex(t,c._id||c.id||"",{}).subscribe({next:()=>{o++,o+l===e.length&&this.handleAllRoomTypesSynced(o,l)},error:()=>{l++,o+l===e.length&&this.handleAllRoomTypesSynced(o,l)}})})}handleAllRoomTypesSynced(t,e){e===0?(this.updateStepStatus(1,"completed"),this.setCurrentStep(2),this.showSuccess(`All ${t} room types synced successfully`)):(this.updateStepStatus(1,"error",`${e} room types failed to sync`),this.showError(`${t} synced, ${e} failed`)),this.loadChannexStatus()}pushAvailability(){let t=this.storeId();if(!t||this.availabilityForm.invalid)return;this.updateStepStatus(2,"in-progress");let e=this.availabilityForm.value.startDate,o=this.availabilityForm.value.endDate,l={startDate:e.toISOString().split("T")[0],endDate:o.toISOString().split("T")[0]};this.channexService.pushAvailability(t,l).subscribe({next:c=>{this.updateStepStatus(2,"completed"),this.setCurrentStep(3),this.showSuccess(c.message)},error:c=>{this.updateStepStatus(2,"error",c.error?.message||"Failed to push availability"),this.showError(c.error?.message||"Failed to push availability")}})}connectChannels(){let t=this.storeId();t&&(this.isLoadingIframe.set(!0),this.updateStepStatus(2,"in-progress"),this.channexService.getChannelConnectionKey(t).subscribe({next:e=>{console.log(e.data.iframeUrl),this.channelIframeUrl.set(e.data.iframeUrl),this.isLoadingIframe.set(!1),this.showSuccess("Channel connection interface loaded")},error:e=>{this.isLoadingIframe.set(!1),this.updateStepStatus(2,"error",e.error?.message||"Failed to load channel connection"),this.showError(e.error?.message||"Failed to load channel connection")}}))}onIframeLoad(){window.addEventListener("message",t=>{if(!t.origin.includes("channex.io"))return;let e=t.data;e.type==="channel_connected"?this.handleChannelConnected(e):e.type==="channel_disconnected"?this.handleChannelDisconnected(e):e.type==="iframe_ready"&&console.log("Channex iframe ready")})}handleChannelConnected(t){this.showSuccess(`${t.channelName||"Channel"} connected successfully`),this.loadChannexStatus()}handleChannelDisconnected(t){this.showSuccess(`${t.channelName||"Channel"} disconnected`),this.loadChannexStatus()}closeIframe(){this.channelIframeUrl.set(null),this.loadChannexStatus()}isRoomTypeSyncing(t){return this.channexService.isRoomTypeSyncing(t)}isRoomTypeSynced(t){let e=this.channexStatus();return e?.roomMappings?e.roomMappings.some(o=>o.roomType._id===t):!1}updateStepStatus(t,e,o){let l=this.setupSteps();if(t<0||t>=l.length){console.warn(`Invalid step index: ${t}`);return}l[t].status=e,o&&(l[t].errorMessage=o),this.setupSteps.set([...l])}showSuccess(t){this.snackBar.open(t,"Close",{duration:5e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["success-snackbar"]})}showError(t){this.snackBar.open(t,"Close",{duration:7e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["error-snackbar"]})}getStepIcon(t){switch(t.status){case"completed":return"check_circle";case"in-progress":return"sync";case"error":return"error";default:return t.icon}}getStepIconColor(t){switch(t.status){case"completed":return"text-green-600";case"in-progress":return"text-blue-600 animate-spin";case"error":return"text-red-600";default:return"text-gray-400"}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=O({type:r,selectors:[["app-channel-management-mapping"]],features:[H([J()])],decls:4,vars:1,consts:[["startPicker",""],["endPicker",""],[1,"max-w-12xl"],["title","Channel Management","subtitle","Connect Chicken Republic to distribution channels and start receiving bookings from OTAs",1,"mb-8"],[1,"flex","items-center","justify-center","py-20"],["diameter","50"],["appearance","outlined"],["appearance","outlined",1,"mb-3"],[1,"mb-8",3,"selectionChange","linear","selectedIndex"],[3,"completed"],["matStepLabel",""],["appearance","outlined",1,"my-4"],[1,"space-y-3"],[1,"my-4","space-y-4",3,"formGroup"],[1,"text-center","py-8","text-gray-500"],[3,"optional"],[1,"space-y-4",3,"formGroup"],[1,"text-sm","text-gray-600","mb-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","startDate",3,"matDatepicker"],["matIconSuffix","",3,"for"],["matInput","","formControlName","endDate",3,"matDatepicker"],[1,"bg-blue-50","p-4","rounded-lg","mb-4"],[1,"flex","items-start","gap-2"],[1,"text-blue-600","text-base","mt-0.5"],[1,"text-sm","text-blue-900"],["matButton","filled","color","primary",3,"click","disabled"],[1,"space-y-4"],[1,"relative"],["appearance","outlined",1,"mt-8"],[1,"flex","items-center","gap-4","py-4"],[1,"text-red-600","text-4xl"],[1,"flex-1"],[1,"text-lg","font-semibold","text-red-900"],[1,"text-red-700","mb-2"],[1,"text-sm","text-red-600"],[1,"text-lg","font-semibold","text-green-900"],[1,"text-green-700"],[1,"text-lg","font-semibold"],[1,"flex","justify-between","items-center","text-sm"],[1,"text-gray-600"],[1,"font-mono","text-gray-900"],[1,"text-gray-900"],["formControlName","propertyType"],["value","hotel"],["value","hostel"],["value","apartment"],["value","guesthouse"],["value","resort"],["value","motel"],["value","villa"],["value","boutique_hotel"],["value","bed_and_breakfast"],["value","lodge"],[1,"grid","grid-cols-2","gap-4"],["matInput","","type","time","formControlName","checkInTime"],["matInput","","type","time","formControlName","checkOutTime"],["matButton","filled","color","primary",3,"click","disabled","matTooltip"],[1,"text-4xl","mb-2"],[1,"mb-4"],["matButton","filled","color","primary",3,"click"],[1,"my-4"],[1,"max-h-96","overflow-y-auto"],["matListItemIcon","",1,"text-gray-600"],["matListItemTitle","",1,"truncate","font-medium","text-gray-900"],["matListItemLine","",1,"text-sm","text-gray-500"],["matListItemMeta","",1,"ml-auto","flex","items-center","gap-2"],["color","primary","selected",""],["diameter","24"],["matButton","outlined","color","primary"],["matButton","outlined","color","primary",3,"click"],[1,"font-medium","mb-1"],[1,"font-semibold","text-gray-900","mb-3"],[1,"space-y-2"],[1,"flex","items-center","justify-between","p-3","bg-green-50","rounded-lg","border","border-green-200"],[1,"flex","items-center","gap-3"],[1,"text-green-600"],[1,"font-medium","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"bg-green-100","text-green-800"],[1,"flex","justify-between","items-center","mb-3"],[1,"font-semibold","text-gray-900"],["matButton","","matTooltip","Close",3,"click"],[1,"border","border-gray-300","rounded-lg","overflow-hidden","bg-white","shadow-sm"],["sandbox","allow-same-origin allow-scripts allow-forms allow-popups",1,"w-full","h-[600px]","border-0",3,"load","src"],[1,"mt-3","text-sm","text-gray-500","text-center"],[1,"text-base","align-middle","mr-1"],[1,"text-xl","font-semibold"],[1,"pt-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"p-4","rounded-lg"],[1,"text-sm","text-gray-600","mb-1"],[1,"text-lg","font-semibold","text-gray-900"]],template:function(e,o){e&1&&(n(0,"div",2),_(1,"app-page-header",3),u(2,et,2,0,"div",4)(3,Mt,54,19),i()),e&2&&(s(2),h(o.isLoadingStatus()?2:3))},dependencies:[G,ge,pe,se,ce,me,ue,de,Q,K,te,ee,re,ne,ae,oe,ie,Me,ve,je,Ye,Pe,De,X,ke,Ee,Ie,we,le,qe,Oe,ye,_e,xe,Se,Ce,fe,Te,be,j,ze,Ue,$e,He,Ge,Be,Ve,Ae,Le,Re,Fe,Ne,q,k],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})};export{Qe as ChannelManagementMapping};
