import{a as l,b as q,c as P,d as M,e as x,f as w}from"./chunk-U4YSNMIZ.js";import{a as b}from"./chunk-NQRUH5DO.js";import{x as S}from"./chunk-U2P6GFP5.js";import{$ as h,Tc as p,ea as _}from"./chunk-IQSYHSID.js";import{a,b as u,f as v}from"./chunk-EQDQRRRY.js";var O=()=>A(Date.now()/1e3)+" ".repeat(16).replace(/./g,()=>A(Math.random()*16));function A(n){return Math.floor(n).toString(16)}var B=()=>`ORD-${Date.now()}`;var $={carts:[],selectedCart:null,quantity:1,isLoading:!1,pendingCarts:[],cartChangeType:null},V=q({providedIn:"root"},w($),P(({carts:n,selectedCart:c,pendingCarts:e})=>({cartCount:p(()=>n().length),activeCarts:p(()=>n().filter(t=>t.active)),pendingCartsCount:p(()=>e().length),selectedCartProducts:p(()=>c()?c().products:[]),isSelectedCart:p(()=>!!c())})),x(n=>({loadAll(){return v(this,null,function*(){l(n,{isLoading:!0})})},updateSelectedCartPaymentMethod(e){let t=n.selectedCart();if(!t){console.warn("No selected cart found.");return}l(n,{selectedCart:u(a({},t),{paymentMethod:a({},e)})})},updateCartSummary(e){let t=n.selectedCart();if(!t){console.warn("No selected cart found.");return}l(n,{selectedCart:u(a({},t),{cartSummary:a({},e)})})},createCart(){let e={_id:O(),products:[],quantity:1,paymentMethod:null,active:!0,note:""};l(n,{carts:[...n.carts(),e],selectedCart:e})},addSelectedCartToPending(){let e=n.selectedCart();e&&l(n,t=>{let r=t.carts.filter(o=>o._id!==e._id),d=[...t.pendingCarts,e];return{carts:r,pendingCarts:d,selectedCart:null}})},deleteFromPendingCarts(e){let r=n.pendingCarts().filter(d=>d._id!==e);l(n,{pendingCarts:r})},restorePendingCart(e){l(n,t=>({carts:t.carts.some(d=>d._id===e._id)?t.carts:[...t.carts,e],selectedCart:e}))},removeSelectedCart(){l(n,{selectedCart:null})},updateCartAction(e){l(n,{cartChangeType:e})},selectCart(e){let t=n.carts().find(r=>(console.log("Comparing cart._id",r._id,"with cartId",e,r._id===e),r._id===e))||null;l(n,{selectedCart:t})},setCart(e){l(n,{selectedCart:e})},updateCarts(e){l(n,{carts:e})},addToCart(e,t,r=!1){let d=n.selectedCart();l(n,o=>{let C=o.carts.map(i=>i._id===e?d&&d._id===e?r?u(a({},d),{products:d.products.map(s=>s._id===t._id?a({},t):s)}):u(a({},d),{products:d.products.some(s=>s._id===t._id)?d.products.map(s=>s._id===t._id?u(a({},s),{quantity:s.quantity+1}):s):[...d.products,u(a({},t),{quantity:t.quantity||1})]}):i.products.find(s=>s._id===t._id)?r?u(a({},i),{products:i.products.map(s=>s._id===t._id?a({},t):s),cartSummary:i.cartSummary,discount:i.discount,user:i.user,note:i.note,delivery:i.delivery,paymentMethod:i.paymentMethod}):u(a({},i),{products:i.products.map(s=>s._id===t._id?u(a({},s),{quantity:s.quantity+1}):s),cartSummary:i.cartSummary,discount:i.discount,user:i.user,note:i.note,delivery:i.delivery,paymentMethod:i.paymentMethod}):u(a({},i),{products:[...i.products,u(a({},t),{quantity:t.quantity||1})],cartSummary:i.cartSummary,discount:i.discount,user:i.user,note:i.note,delivery:i.delivery,paymentMethod:i.paymentMethod}):i),m=C.find(i=>i._id===e)||null;return console.log("Updated selected cart:",m),{carts:C,selectedCart:m}})},removeFromCart(e,t){l(n,r=>{let d=r.carts.map(C=>C._id===e?u(a({},C),{products:C.products.filter(m=>m._id!==t)}):C),o=r.selectedCart&&r.selectedCart._id===e?d.find(C=>C._id===e)||null:r.selectedCart;return{carts:d,selectedCart:o}})},clearCart(e){l(n,t=>{let r=t.carts.map(o=>o._id===e?u(a({},o),{products:[]}):o),d=t.selectedCart&&t.selectedCart._id===e?r.find(o=>o._id===e)||null:t.selectedCart;return{carts:r,selectedCart:d}})},updateCartDiscount(e,t){let r=n.selectedCart();if(!r||r._id!==e)return;let d=u(a({},r),{discount:t,cartSummary:u(a({},r.cartSummary),{discount:t.value})});l(n,{selectedCart:d})},updateCartUser(e,t){let r=n.selectedCart();if(!r||r._id!==e)return;let d=u(a({},r),{user:t});l(n,{selectedCart:d})},updateCartDelivery(e,t){let r=n.selectedCart();if(!r||r._id!==e)return;let d=u(a({},r),{delivery:t,cartSummary:u(a({},r.cartSummary),{deliveryFee:t})});l(n,{selectedCart:d})},updateCartNote(e,t){let r=n.selectedCart();if(!r||r._id!==e)return;let d=u(a({},r),{note:t});l(n,{selectedCart:d})},incrementProductQuantity(e){let t=n.selectedCart();if(t){let r=t.products.map(d=>d._id===e?u(a({},d),{quantity:d.quantity+1}):d);l(n,{selectedCart:u(a({},t),{products:r})})}},decrementProductQuantity(e){let t=n.selectedCart();if(t){let r=t.products.find(d=>d._id===e);if(r&&r.quantity>1){this.updateCartAction("edit");let d=t.products.map(o=>o._id===e?u(a({},o),{quantity:o.quantity-1}):o);l(n,{selectedCart:u(a({},t),{products:d})})}else r&&(this.updateCartAction("delete"),this.removeFromCart(t._id,r._id))}}})),M({onInit(n){n.carts().length===0&&!n.selectedCart()&&n.createCart()}}));var T=class n{_httpClient=_(S);hostServer=b.apiUrl;getStoreCartsRestructured(c){return this._httpClient.get(`${this.hostServer}/carts/store/${c}/restructured`)}getCartByIdRestructured(c){return this._httpClient.get(`${this.hostServer}/carts/${c}/restructured`)}generateCartSummary(c,e){if(c){let t=e?.tax||0,r=0,d=0,o=0;c.products.forEach(s=>{if(r+=s.price*s.quantity,s?.options){let F=s.options.reduce((D,j)=>{let R=j.options.reduce((g,y)=>y.selected?g+y.price*y.quantity:g,0);return D+R},0);d+=F*s.quantity}});let C=r+d,m=0;c.discount&&(c.discount.discountType==="Percentage"?m=C*c.discount.value/100:c.discount.discountType==="Amount"&&(m=c.discount.value)),m=Math.min(m,C);let i=(C-m)*t;c.delivery&&(o=+c.delivery);let f=C-m+i+o;return{totalBaseCost:r,totalVariantCost:d,subtotal:C,discount:m,tax:i,deliveryFee:o,totalCost:f}}else return{totalBaseCost:0,totalVariantCost:0,subtotal:0,discount:0,tax:0,totalCost:0,deliveryFee:0}}getTotalForSelectedOptions(c){return c&&c.length>0?c.reduce((e,t)=>{let r=t?.options?.length?t.options.reduce((d,o)=>o.selected?d+o.price*o.quantity:d,0):0;return e+r},0):0}static \u0275fac=function(e){return new(e||n)};static \u0275prov=h({token:n,factory:n.\u0275fac,providedIn:"root"})};export{O as a,B as b,V as c,T as d};
