import{b as st}from"./chunk-L5PC3B6Q.js";import{a as lt}from"./chunk-MWNCOO7H.js";import{a as ot,b as rt}from"./chunk-HTIQX262.js";import{a as oe,b as re,e as le,f as se,g as me,h as de}from"./chunk-DCD2EY64.js";import{a as at}from"./chunk-XCHHSGI7.js";import{a as $e,b as ze,c as Ye,d as Qe,e as Ze,f as Je,g as Xe,h as et,i as tt,j as nt,k as it}from"./chunk-OALZQOYE.js";import{a as qe,b as Le,c as je,g as We}from"./chunk-KWQBTQML.js";import{a as Ae}from"./chunk-VPPMXXDW.js";import{a as He,b as Ge}from"./chunk-3IQG3KHZ.js";import{d as Ie}from"./chunk-YK4A772F.js";import{c as Ke}from"./chunk-EPNSEEH4.js";import{b as ne,c as ie,d as ae}from"./chunk-IS37LNAK.js";import{a as ee,b as Fe,d as Ne,h as te}from"./chunk-QJ2P7YZL.js";import{a as Ue,b as Be}from"./chunk-ZG44B3L4.js";import{A as Re,B as X,a as Ve,b as W,c as Oe,d as S,g as $,h as z,m as Y,s as Q,t as Z,z as J}from"./chunk-SZWYIW32.js";import{a as Te}from"./chunk-T4ACDKLD.js";import{b as L,c as j}from"./chunk-OWLRGWNJ.js";import{$ as q,Z as K}from"./chunk-OS2CYUJN.js";import{h as Pe,l as De,m as we,p as ke,r as V}from"./chunk-U2P6GFP5.js";import{$a as m,Cc as Se,Da as ve,Ec as Me,Gb as g,Hb as f,Jc as h,Kc as A,Lc as b,Mb as _,Nb as o,Ob as a,Pb as C,Tb as I,Tc as ue,Ub as T,Wb as H,_ as fe,_b as y,aa as Ce,ac as c,ca as _e,ea as v,gd as Ee,ib as U,ja as F,ka as N,lc as be,ob as B,oc as G,pb as xe,pc as r,qb as ye,qc as w,rc as d,ub as x,va as M}from"./chunk-IQSYHSID.js";function vt(i,t){i&1&&(o(0,"div",16)(1,"div",21)(2,"mat-icon",22),r(3,"warning"),a(),o(4,"span",23),r(5," Please confirm all room readiness requirements before proceeding. "),a()()())}var mt=class i{dialogRef=v(oe);fb=v(J);data=v(re);loading=M(!1);checkInForm=this.fb.group({isClean:[!1,S.requiredTrue],isMaintained:[!1,S.requiredTrue],amenitiesReady:[!1,S.requiredTrue],notes:[""]});get isFormValid(){return this.checkInForm.valid}get roomNumbers(){return this.data.reservation.rooms?this.data.reservation.rooms.map(t=>{let e=t.room;return typeof e=="string"?e:e.roomNumber||e._id}).join(", "):""}onCancel(){this.dialogRef.close({confirmed:!1})}onConfirm(){if(!this.isFormValid)return;let t=this.checkInForm.value,e={confirmed:!0,roomChecks:{isClean:t.isClean||!1,isMaintained:t.isMaintained||!1,amenitiesReady:t.amenitiesReady||!1},notes:t.notes||void 0};this.dialogRef.close(e)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=B({type:i,selectors:[["app-check-in-confirmation-dialog"]],decls:46,vars:8,consts:[["mat-dialog-title",""],[1,"bg-gray-50","rounded-lg","p-4","mb-6"],[1,"font-semibold","text-gray-900","mb-3"],[1,"grid","grid-cols-2","gap-4","text-sm"],[1,"text-gray-600"],[1,"font-medium","text-gray-900"],[1,"space-y-4",3,"formGroup"],[1,"font-semibold","text-gray-900"],[1,"space-y-3"],[1,"flex","items-center","gap-3"],["formControlName","isClean","color","primary"],[1,"text-sm","text-gray-700"],["formControlName","isMaintained","color","primary"],["formControlName","amenitiesReady","color","primary"],["appearance","outline",1,"w-full","mt-6"],["matInput","","formControlName","notes","rows","3","placeholder","Any special notes or observations..."],[1,"bg-amber-50","border","border-amber-200","rounded-lg","p-3","mt-6"],["align","end"],["mat-button","",3,"click"],["matButton","filled","color","primary",3,"click","disabled"],[1,"mr-2"],[1,"flex","items-center","gap-2"],[1,"text-amber-600","text-sm"],[1,"text-xs","text-amber-800","font-medium"]],template:function(e,n){e&1&&(o(0,"h2",0),r(1),a(),o(2,"mat-dialog-content")(3,"div",1)(4,"h3",2),r(5,"Guest Information"),a(),o(6,"div",3)(7,"div")(8,"span",4),r(9,"Name:"),a(),o(10,"div",5),r(11),h(12,"getGuestName"),a()(),o(13,"div")(14,"span",4),r(15,"Room(s):"),a(),o(16,"div",5),r(17),a()()()(),o(18,"form",6)(19,"h3",7),r(20,"Room Readiness Checklist"),a(),o(21,"div",8)(22,"div",9),C(23,"mat-checkbox",10),o(24,"span",11),r(25,"Room is clean and housekeeping complete"),a()(),o(26,"div",9),C(27,"mat-checkbox",12),o(28,"span",11),r(29,"All maintenance issues resolved"),a()(),o(30,"div",9),C(31,"mat-checkbox",13),o(32,"span",11),r(33,"Amenities and supplies are stocked"),a()()(),o(34,"mat-form-field",14)(35,"mat-label"),r(36,"Check-in Notes (Optional)"),a(),C(37,"textarea",15),a()(),g(38,vt,6,0,"div",16),a(),o(39,"mat-dialog-actions",17)(40,"button",18),y("click",function(){return n.onCancel()}),r(41,"Cancel"),a(),o(42,"button",19),y("click",function(){return n.onConfirm()}),o(43,"mat-icon",20),r(44,"check_circle"),a(),r(45," Confirm Check-In "),a()()),e&2&&(m(),d(" Confirm Check-In (",n.data.reservation.confirmationNumber,`)
`),m(10),w(A(12,6,n.data.reservation.guest)),m(6),w(n.roomNumbers),m(),_("formGroup",n.checkInForm),m(20),f(n.isFormValid?-1:38),m(4),_("disabled",!n.isFormValid||n.loading()))},dependencies:[de,le,me,se,q,K,j,L,rt,ot,ne,te,ee,ae,ie,X,Y,W,$,z,Z,Q,V,st],styles:[".check-in-dialog[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]   .mdc-checkbox[_ngcontent-%COMP%]{margin-right:8px}.check-in-dialog[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{background-color:#fafafa}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}"]})};var xt=new _e("currency.mask.config"),ce=class{constructor(t){this.htmlInputElement=t}setCursorAt(t){if(this.htmlInputElement.setSelectionRange)this.htmlInputElement.focus(),this.htmlInputElement.setSelectionRange(t,t);else if(this.htmlInputElement.createTextRange){let e=this.htmlInputElement.createTextRange();e.collapse(!0),e.moveEnd("character",t),e.moveStart("character",t),e.select()}}updateValueAndCursor(t,e,n){this.rawValue=t;let l=t.length;n=n-(e-l),this.setCursorAt(n)}get canInputMoreNumbers(){let t=!(this.rawValue.length>=this.htmlInputElement.maxLength&&this.htmlInputElement.maxLength>=0),e=this.inputSelection.selectionStart,n=this.inputSelection.selectionEnd,l=!!(e!=n&&this.htmlInputElement.value.substring(e,n).match(/\d/)),s=this.htmlInputElement.value.substring(0,1)=="0";return t||l||s}get inputSelection(){let t=0,e=0;if(typeof this.htmlInputElement.selectionStart=="number"&&typeof this.htmlInputElement.selectionEnd=="number")t=this.htmlInputElement.selectionStart,e=this.htmlInputElement.selectionEnd;else{let n=document.getSelection().anchorNode;if(n&&n.firstChild==this.htmlInputElement){let l=this.htmlInputElement.value.length,s=this.htmlInputElement.value.replace(/\r\n/g,`
`),u=this.htmlInputElement.createTextRange(),P=this.htmlInputElement.createTextRange();P.collapse(!1),u.compareEndPoints("StartToEnd",P)>-1?t=e=l:(t=-u.moveStart("character",-l),t+=s.slice(0,t).split(`
`).length-1,u.compareEndPoints("EndToEnd",P)>-1?e=l:(e=-u.moveEnd("character",-l),e+=s.slice(0,e).split(`
`).length-1))}}return{selectionStart:t,selectionEnd:e}}get rawValue(){return this.htmlInputElement&&this.htmlInputElement.value}set rawValue(t){this._storedRawValue=t,this.htmlInputElement&&(this.htmlInputElement.value=t)}get storedRawValue(){return this._storedRawValue}},pe=class{constructor(t,e){this.htmlInputElement=t,this.options=e,this.inputManager=new ce(t)}addNumber(t){this.rawValue||(this.rawValue=this.applyMask(!1,"0"));let e=String.fromCharCode(t),n=this.inputSelection.selectionStart,l=this.inputSelection.selectionEnd;this.rawValue=this.rawValue.substring(0,n)+e+this.rawValue.substring(l,this.rawValue.length),this.updateFieldValue(n+1)}applyMask(t,e){let{allowNegative:n,decimal:l,precision:s,prefix:u,suffix:P,thousands:R}=this.options;e=t?new Number(e).toFixed(s):e;let D=e.replace(/[^0-9]/g,"");if(!D)return"";let k=D.slice(0,D.length-s).replace(/^0*/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,R);k==""&&(k="0");let O=k,E=D.slice(D.length-s);s>0&&(E="0".repeat(s-E.length)+E,O+=l+E);let p=parseInt(k)==0&&(parseInt(E)==0||E=="");return(e.indexOf("-")>-1&&n&&!p?"-":"")+u+O+P}clearMask(t){if(t==null||t=="")return null;let e=t.replace(this.options.prefix,"").replace(this.options.suffix,"");return this.options.thousands&&(e=e.replace(new RegExp("\\"+this.options.thousands,"g"),"")),this.options.decimal&&(e=e.replace(this.options.decimal,".")),parseFloat(e)}changeToNegative(){if(this.options.allowNegative&&this.rawValue!=""&&this.rawValue.charAt(0)!="-"&&this.value!=0){let t=this.inputSelection.selectionStart;this.rawValue="-"+this.rawValue,this.updateFieldValue(t+1)}}changeToPositive(){let t=this.inputSelection.selectionStart;this.rawValue=this.rawValue.replace("-",""),this.updateFieldValue(t-1)}fixCursorPosition(t){let e=this.inputSelection.selectionStart;e>this.getRawValueWithoutSuffixEndPosition()||t?this.inputManager.setCursorAt(this.getRawValueWithoutSuffixEndPosition()):e<this.getRawValueWithoutPrefixStartPosition()&&this.inputManager.setCursorAt(this.getRawValueWithoutPrefixStartPosition())}getRawValueWithoutSuffixEndPosition(){return this.rawValue.length-this.options.suffix.length}getRawValueWithoutPrefixStartPosition(){return this.value!=null&&this.value<0?this.options.prefix.length+1:this.options.prefix.length}removeNumber(t){let{decimal:e,thousands:n}=this.options,l=this.inputSelection.selectionEnd,s=this.inputSelection.selectionStart;s>this.rawValue.length-this.options.suffix.length&&(l=this.rawValue.length-this.options.suffix.length,s=this.rawValue.length-this.options.suffix.length),l==s&&((t==46||t==63272)&&/^\d+$/.test(this.rawValue.substring(s,l+1))&&(l=l+1),(t==46||t==63272)&&(this.rawValue.substring(s,l+1)==e||this.rawValue.substring(s,l+1)==n)&&(l=l+2,s=s+1),t==8&&/^\d+$/.test(this.rawValue.substring(s-1,l))&&(s=s-1),t==8&&(this.rawValue.substring(s-1,l)==e||this.rawValue.substring(s-1,l)==n)&&(s=s-2,l=l-1)),this.rawValue=this.rawValue.substring(0,s)+this.rawValue.substring(l,this.rawValue.length),this.updateFieldValue(s)}updateFieldValue(t){let e=this.applyMask(!1,this.rawValue||"");t=t??this.rawValue.length,this.inputManager.updateValueAndCursor(e,this.rawValue.length,t)}updateOptions(t){let e=this.value;this.options=t,this.value=e}get canInputMoreNumbers(){return this.inputManager.canInputMoreNumbers}get inputSelection(){return this.inputManager.inputSelection}get rawValue(){return this.inputManager.rawValue}set rawValue(t){this.inputManager.rawValue=t}get storedRawValue(){return this.inputManager.storedRawValue}get value(){return this.clearMask(this.rawValue)}set value(t){this.rawValue=this.applyMask(!0,""+t)}},he=class{constructor(t,e){this.inputService=new pe(t,e),this.htmlInputElement=t}handleClick(t,e){Math.abs(this.inputService.inputSelection.selectionEnd-this.inputService.inputSelection.selectionStart)==0&&!isNaN(this.inputService.value)&&this.inputService.fixCursorPosition(e)}handleCut(t){this.isReadOnly()||setTimeout(()=>{this.inputService.updateFieldValue(),this.setValue(this.inputService.value),this.onModelChange(this.inputService.value)},0)}handleInput(t){if(this.isReadOnly())return;let e=this.getNewKeyCode(this.inputService.storedRawValue,this.inputService.rawValue),n=this.inputService.rawValue.length,l=this.inputService.inputSelection.selectionEnd,s=this.inputService.getRawValueWithoutSuffixEndPosition(),u=this.inputService.storedRawValue.length;if(this.inputService.rawValue=this.inputService.storedRawValue,(l!=s||Math.abs(n-u)!=1)&&u!=0){this.setCursorPosition(t);return}if(n<u&&(this.inputService.value!=0?this.inputService.removeNumber(8):this.setValue(null)),n>u)switch(e){case 43:this.inputService.changeToPositive();break;case 45:this.inputService.changeToNegative();break;default:if(!this.inputService.canInputMoreNumbers||isNaN(this.inputService.value)&&String.fromCharCode(e).match(/\d/)==null)return;this.inputService.addNumber(e)}this.setCursorPosition(t),this.onModelChange(this.inputService.value)}handleKeydown(t){if(this.isReadOnly())return;let e=t.which||t.charCode||t.keyCode;if(e==8||e==46||e==63272){t.preventDefault();let n=Math.abs(this.inputService.inputSelection.selectionEnd-this.inputService.inputSelection.selectionStart);(n==this.inputService.rawValue.length||this.inputService.value==0)&&(this.setValue(null),this.onModelChange(this.inputService.value)),n==0&&!isNaN(this.inputService.value)&&(this.inputService.removeNumber(e),this.onModelChange(this.inputService.value)),(e===8||e===46)&&n!=0&&!isNaN(this.inputService.value)&&(this.inputService.removeNumber(e),this.onModelChange(this.inputService.value))}}handleKeypress(t){if(this.isReadOnly())return;let e=t.which||t.charCode||t.keyCode;if(!(e==null||[9,13].indexOf(e)!=-1||this.isArrowEndHomeKeyInFirefox(t))){switch(e){case 43:this.inputService.changeToPositive();break;case 45:this.inputService.changeToNegative();break;default:this.inputService.canInputMoreNumbers&&(!isNaN(this.inputService.value)||String.fromCharCode(e).match(/\d/)!=null)&&this.inputService.addNumber(e)}t.preventDefault(),this.onModelChange(this.inputService.value)}}handleKeyup(t){this.inputService.fixCursorPosition()}handlePaste(t){this.isReadOnly()||setTimeout(()=>{this.inputService.updateFieldValue(),this.setValue(this.inputService.value),this.onModelChange(this.inputService.value)},1)}updateOptions(t){this.inputService.updateOptions(t)}getOnModelChange(){return this.onModelChange}setOnModelChange(t){this.onModelChange=t}getOnModelTouched(){return this.onModelTouched}setOnModelTouched(t){this.onModelTouched=t}setValue(t){this.inputService.value=t}getNewKeyCode(t,e){if(t.length>e.length)return null;for(let n=0;n<e.length;n++)if(t.length==n||t[n]!=e[n])return e.charCodeAt(n);return null}isArrowEndHomeKeyInFirefox(t){return[35,36,37,38,39,40].indexOf(t.keyCode)!=-1&&(t.charCode==null||t.charCode==0)}isReadOnly(){return this.htmlInputElement&&this.htmlInputElement.readOnly}setCursorPosition(t){let e=this.inputService.getRawValueWithoutSuffixEndPosition(),n=t.target;setTimeout(function(){n.setSelectionRange(e,e)},0)}},yt={provide:Ve,useExisting:fe(()=>ge),multi:!0},ge=(()=>{class i{constructor(e,n,l){this.currencyMaskConfig=e,this.elementRef=n,this.keyValueDiffers=l,this.options={},this.optionsTemplate={align:"right",allowNegative:!0,decimal:".",precision:2,prefix:"$ ",suffix:"",thousands:","},e&&(this.optionsTemplate=e),this.keyValueDiffer=l.find({}).create()}ngAfterViewInit(){this.elementRef.nativeElement.style.textAlign=this.options.align?this.options.align:this.optionsTemplate.align}ngDoCheck(){this.keyValueDiffer.diff(this.options)&&(this.elementRef.nativeElement.style.textAlign=this.options.align?this.options.align:this.optionsTemplate.align,this.inputHandler.updateOptions(Object.assign({},this.optionsTemplate,this.options)))}ngOnInit(){this.inputHandler=new he(this.elementRef.nativeElement,Object.assign({},this.optionsTemplate,this.options))}handleBlur(e){this.inputHandler.getOnModelTouched().apply(e)}handleClick(e){this.inputHandler.handleClick(e,this.isChromeAndroid())}handleCut(e){this.isChromeAndroid()||this.inputHandler.handleCut(e)}handleInput(e){this.isChromeAndroid()&&this.inputHandler.handleInput(e)}handleKeydown(e){this.isChromeAndroid()||this.inputHandler.handleKeydown(e)}handleKeypress(e){this.isChromeAndroid()||this.inputHandler.handleKeypress(e)}handleKeyup(e){this.isChromeAndroid()||this.inputHandler.handleKeyup(e)}handlePaste(e){this.isChromeAndroid()||this.inputHandler.handlePaste(e)}isChromeAndroid(){return/chrome/i.test(navigator.userAgent)&&/android/i.test(navigator.userAgent)}registerOnChange(e){this.inputHandler.setOnModelChange(e)}registerOnTouched(e){this.inputHandler.setOnModelTouched(e)}setDisabledState(e){this.elementRef.nativeElement.disabled=e}validate(e){let n={};return e.value>this.max&&(n.max=!0),e.value<this.min&&(n.min=!0),n!={}?n:null}writeValue(e){this.inputHandler.setValue(e)}}return i.\u0275fac=function(e){return new(e||i)(U(xt,8),U(ve),U(Ee))},i.\u0275dir=ye({type:i,selectors:[["","currencyMask",""]],hostBindings:function(e,n){e&1&&y("blur",function(s){return n.handleBlur(s)})("click",function(s){return n.handleClick(s)})("cut",function(s){return n.handleCut(s)})("input",function(s){return n.handleInput(s)})("keydown",function(s){return n.handleKeydown(s)})("keypress",function(s){return n.handleKeypress(s)})("keyup",function(s){return n.handleKeyup(s)})("paste",function(s){return n.handlePaste(s)})},inputs:{max:"max",min:"min",options:"options"},standalone:!1,features:[Se([yt,{provide:Oe,useExisting:i,multi:!0}])]}),i})(),ut=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=xe({type:i}),i.\u0275inj=Ce({imports:[[V,Re]]}),i})();var St=i=>({prefix:i});function Mt(i,t){i&1&&(o(0,"mat-icon",28),r(1,"add_circle_outline"),a(),r(2," Add Transaction "))}function Et(i,t){i&1&&(o(0,"mat-form-field",31)(1,"mat-label"),r(2,"Transaction Type"),a(),o(3,"mat-select",45)(4,"mat-option",41),r(5,"Refund"),a(),o(6,"mat-option",46),r(7,"Payment"),a()()())}function Pt(i,t){i&1&&(o(0,"mat-error"),r(1,"Amount is required"),a())}function Dt(i,t){i&1&&(o(0,"mat-error"),r(1,"Amount must be greater than 0"),a())}function wt(i,t){if(i&1&&(o(0,"mat-error"),r(1),a()),i&2){let e,n=c(2);m(),d(" Amount cannot exceed ",((e=n.paymentForm.get("type"))==null?null:e.value)==="refund"?"refund due":"balance due"," ")}}function kt(i,t){if(i&1&&(o(0,"mat-error"),r(1),a()),i&2){let e,n=c(2);m(),d("",((e=n.paymentForm.get("type"))==null?null:e.value)==="refund"?"Refund method":"Payment method"," is required")}}function It(i,t){if(i&1){let e=H();o(0,"button",49),y("click",function(){F(e);let l=c(3);return N(l.setAmount(100))}),r(1),h(2,"currency"),a()}if(i&2){let e,n=c(3);m(),d(" ",b(2,1,100,(e=n.storeStore.selectedStore())==null?null:e.currency)," ")}}function Tt(i,t){if(i&1){let e=H();o(0,"button",49),y("click",function(){F(e);let l=c(3);return N(l.setAmount(50))}),r(1),h(2,"currency"),a()}if(i&2){let e,n=c(3);m(),d(" ",b(2,1,50,(e=n.storeStore.selectedStore())==null?null:e.currency)," ")}}function At(i,t){if(i&1){let e=H();o(0,"div")(1,"h4",47),r(2,"Quick Amounts"),a(),o(3,"div",48)(4,"button",49),y("click",function(){F(e);let l=c(2);return N(l.setAmount(l.balanceAmount()))}),r(5),h(6,"currency"),a(),g(7,It,3,4,"button",50),g(8,Tt,3,4,"button",50),a()()}if(i&2){let e,n=c(2);m(5),d(" Full Balance (",b(6,3,n.balanceAmount(),(e=n.storeStore.selectedStore())==null?null:e.currency),") "),m(2),f(n.balanceAmount()>=100?7:-1),m(),f(n.balanceAmount()>=50?8:-1)}}function Vt(i,t){if(i&1&&(o(0,"div",29),x(1,Et,8,0,"mat-form-field",30),o(2,"mat-form-field",31)(3,"mat-label"),r(4),a(),o(5,"span",32),r(6),a(),C(7,"input",33),g(8,Pt,2,0,"mat-error"),g(9,Dt,2,0,"mat-error"),g(10,wt,2,1,"mat-error"),a(),o(11,"mat-form-field",31)(12,"mat-label"),r(13),a(),o(14,"mat-select",34)(15,"mat-option",35),r(16,"Cash"),a(),o(17,"mat-option",36),r(18,"Credit/Debit Card"),a(),o(19,"mat-option",37),r(20,"Bank Transfer"),a(),o(21,"mat-option",38),r(22,"Mobile Money"),a(),o(23,"mat-option",39),r(24,"Check"),a(),o(25,"mat-option",40),r(26,"Online Payment"),a(),o(27,"mat-option",41),r(28,"Refund"),a()(),g(29,kt,2,1,"mat-error"),a()(),o(30,"mat-form-field",31)(31,"mat-label"),r(32,"Reference Number (Optional)"),a(),C(33,"input",42),a(),o(34,"mat-form-field",31)(35,"mat-label"),r(36,"Notes (Optional)"),a(),C(37,"textarea",43),a(),x(38,At,9,6,"div",44)),i&2){let e,n,l,s,u,P,R,D,k,O,E,p=c();m(),_("ngIf",p.balanceAmount()<0),m(3),w(((e=p.paymentForm.get("type"))==null?null:e.value)==="refund"?"Refund Amount":"Payment Amount"),m(2),d("",(n=p.storeStore.selectedStore())==null?null:n.currency,"\xA0"),m(),_("options",Me(12,St,(l=p.storeStore.selectedStore())==null?null:l.currency))("min",(((s=p.paymentForm.get("type"))==null?null:s.value)==="refund",.01))("max",((u=p.paymentForm.get("type"))==null?null:u.value)==="refund"?p.absBalanceAmount():p.balanceAmount()),m(),f((P=p.paymentForm.get("amount"))!=null&&P.hasError("required")?8:-1),m(),f((R=p.paymentForm.get("amount"))!=null&&R.hasError("min")?9:-1),m(),f((D=p.paymentForm.get("amount"))!=null&&D.hasError("max")?10:-1),m(3),w(((k=p.paymentForm.get("type"))==null?null:k.value)==="refund"?"Refund Method":"Payment Method"),m(16),f((O=p.paymentForm.get("method"))!=null&&O.hasError("required")?29:-1),m(9),_("ngIf",((E=p.paymentForm.get("type"))==null?null:E.value)!=="refund")}}function Ot(i,t){i&1&&(o(0,"mat-error"),r(1,"Payment status is required"),a())}function Rt(i,t){i&1&&(o(0,"mat-error"),r(1,"Payment method is required"),a())}function Ft(i,t){if(i&1&&(o(0,"mat-error",56)(1,"strong"),r(2,'Cannot mark as "Paid in Full":'),a(),r(3," There is still an outstanding balance of "),o(4,"strong"),r(5),h(6,"currency"),a(),r(7,'. Please use "Partial Payment" status or record additional payments first. '),a()),i&2){let e,n=c(2);m(5),w(b(6,1,n.balanceAmount(),(e=n.storeStore.selectedStore())==null?null:e.currency))}}function Nt(i,t){if(i&1&&(o(0,"mat-form-field",31)(1,"mat-label"),r(2,"Payment Status"),a(),o(3,"mat-select",51)(4,"mat-option",52),r(5,"Pending Payment"),a(),o(6,"mat-option",53),r(7,"Partial Payment"),a(),o(8,"mat-option",54),r(9,"Paid in Full"),a()(),g(10,Ot,2,0,"mat-error"),a(),o(11,"mat-form-field",31)(12,"mat-label"),r(13,"Payment Method"),a(),o(14,"mat-select",34)(15,"mat-option",35),r(16,"Cash"),a(),o(17,"mat-option",36),r(18,"Credit/Debit Card"),a(),o(19,"mat-option",37),r(20,"Bank Transfer"),a(),o(21,"mat-option",38),r(22,"Mobile Money"),a(),o(23,"mat-option",39),r(24,"Check"),a(),o(25,"mat-option",40),r(26,"Online Payment"),a()(),g(27,Rt,2,0,"mat-error"),a(),o(28,"mat-form-field",31)(29,"mat-label"),r(30,"Transaction Reference (Optional)"),a(),C(31,"input",42),a(),o(32,"mat-form-field",31)(33,"mat-label"),r(34,"Payment Notes (Optional)"),a(),C(35,"textarea",55),a(),g(36,Ft,8,4,"mat-error",56)),i&2){let e,n,l,s=c();m(10),f((e=s.paymentForm.get("status"))!=null&&e.hasError("required")?10:-1),m(17),f((n=s.paymentForm.get("method"))!=null&&n.hasError("required")?27:-1),m(9),f(((l=s.paymentForm.get("status"))==null?null:l.value)==="paid"&&s.balanceAmount()>0?36:-1)}}function Ut(i,t){if(i&1&&(o(0,"mat-icon",28),r(1,"history"),a(),r(2)),i&2){let e=c();m(2),d(" History (",e.transactions().length,") ")}}function Bt(i,t){if(i&1&&(o(0,"div",21)(1,"strong"),r(2,"\u26A0\uFE0F Note:"),a(),r(3),a()),i&2){let e=c();m(3),d(" ",e.loadError()," ")}}function Ht(i,t){i&1&&(o(0,"div",22),C(1,"mat-progress-spinner",57),a())}function Gt(i,t){i&1&&(o(0,"div",23)(1,"mat-icon",58),r(2,"payment"),a(),o(3,"p"),r(4,"No transactions recorded yet"),a()())}function Kt(i,t){i&1&&(o(0,"th",73),r(1,"Date"),a())}function qt(i,t){if(i&1&&(o(0,"td",74),r(1),h(2,"date"),a()),i&2){let e=t.$implicit;m(),d(" ",b(2,1,e.createdAt,"short")," ")}}function Lt(i,t){i&1&&(o(0,"th",75),r(1,"Amount"),a())}function jt(i,t){if(i&1&&(o(0,"td",76),r(1),h(2,"currency"),a()),i&2){let e,n=t.$implicit,l=c(2);m(),d(" ",b(2,1,n.amount,(e=l.storeStore.selectedStore())==null?null:e.currency)," ")}}function Wt(i,t){i&1&&(o(0,"th",73),r(1,"Method"),a())}function $t(i,t){if(i&1&&(o(0,"td",74)(1,"span",77),r(2),h(3,"titlecase"),a()()),i&2){let e=t.$implicit;m(2),d(" ",A(3,1,e.method)," ")}}function zt(i,t){i&1&&(o(0,"th",73),r(1,"Type"),a())}function Yt(i,t){if(i&1&&(o(0,"td",74)(1,"span"),r(2),h(3,"titlecase"),a()()),i&2){let e=t.$implicit;m(),G(e.type==="payment"?"px-2 py-1 bg-green-100 text-green-800 rounded text-xs":"px-2 py-1 bg-red-100 text-red-800 rounded text-xs"),m(),d(" ",A(3,3,e.type)," ")}}function Qt(i,t){i&1&&(o(0,"th",73),r(1,"Notes"),a())}function Zt(i,t){if(i&1&&(o(0,"td",78),r(1),a()),i&2){let e=t.$implicit;m(),d(" ",e.notes||"-"," ")}}function Jt(i,t){i&1&&(o(0,"th",75),r(1,"Balance After "),a())}function Xt(i,t){if(i&1&&(o(0,"td",79),r(1),h(2,"currency"),a()),i&2){let e,n=t.$implicit,l=c(2);m(),d(" ",b(2,1,n.balanceAfterTransaction,(e=l.storeStore.selectedStore())==null?null:e.currency)," ")}}function en(i,t){i&1&&C(0,"tr",80)}function tn(i,t){i&1&&C(0,"tr",81)}function nn(i,t){if(i&1&&(o(0,"table",24),I(1,59),x(2,Kt,2,0,"th",60)(3,qt,3,4,"td",61),T(),I(4,62),x(5,Lt,2,0,"th",63)(6,jt,3,4,"td",64),T(),I(7,65),x(8,Wt,2,0,"th",60)(9,$t,4,3,"td",61),T(),I(10,66),x(11,zt,2,0,"th",60)(12,Yt,4,5,"td",61),T(),I(13,67),x(14,Qt,2,0,"th",60)(15,Zt,2,1,"td",68),T(),I(16,69),x(17,Jt,2,0,"th",63)(18,Xt,3,4,"td",70),T(),x(19,en,1,0,"tr",71)(20,tn,1,0,"tr",72),a()),i&2){let e=c();_("dataSource",e.transactions()),m(19),_("matHeaderRowDef",e.displayedColumns),m(),_("matRowDefColumns",e.displayedColumns)}}var ct=class i{fb=v(J);dialogRef=v(oe);data=v(re);storeStore=v(Ae);reservationService=v(lt);authService=v(Te);currentUser=Ke(this.authService.currentUser,{initialValue:null});queryParamService=v(at);processing=M(!1);loadingTransactions=M(!1);transactions=M([]);loadError=M(null);totalAmount=M(0);paidAmount=M(0);balanceAmount=M(0);paymentPercentage=ue(()=>{let t=this.totalAmount(),e=this.paidAmount();return t>0?Math.round(e/t*100):0});absBalanceAmount=ue(()=>Math.abs(this.balanceAmount()));displayedColumns=["date","amount","method","type","notes","balance"];paymentForm=this.fb.group({amount:[0],status:[""],method:["",S.required],reference:[""],notes:[""],type:["payment"]});constructor(){if(this.data.reservation.status==="checked_out"&&!this.data.isCheckoutFlow){setTimeout(()=>{this.dialogRef.close({confirmed:!1,error:"Cannot edit payment information for checked-out reservations"})});return}}ngOnInit(){this.initializePaymentData(),this.loadTransactions()}initializePaymentData(){let t=this.data.reservation;this.totalAmount.set(t.pricing.total),this.paidAmount.set(t.pricing.paid),this.balanceAmount.set(t.pricing.balance);let e=this.getCurrentPaymentStatus(),n=t.paymentInfo?.method||"cash";if(this.data.isCheckoutFlow){let l=this.balanceAmount()<0;this.paymentForm.get("type")?.setValue(l?"refund":"payment"),this.paymentForm.get("amount")?.setValidators([S.required,S.min(.01),l?S.max(Math.abs(this.balanceAmount())||0):S.max(this.balanceAmount()||0)]),this.paymentForm.patchValue({amount:l?Math.abs(this.balanceAmount()):this.balanceAmount()||0,method:n,type:l?"refund":"payment"})}else this.paymentForm.get("status")?.setValidators([S.required]),this.paymentForm.patchValue({status:e,method:n});this.paymentForm.updateValueAndValidity()}loadTransactions(){this.loadingTransactions.set(!0),this.loadError.set(null);let t=this.storeStore.selectedStore()?._id;if(!t){console.error("Store ID not available"),this.loadingTransactions.set(!1),this.loadError.set("Store information not available");return}this.reservationService.getReservationTransactions(t,this.data.reservation._id).subscribe({next:e=>{this.transactions.set(e),this.loadingTransactions.set(!1),this.loadError.set(null)},error:e=>{console.error("Failed to load transactions:",e),this.loadingTransactions.set(!1),e.status===404?this.loadError.set("Reservation not found. Please refresh and try again."):e.status===403?this.loadError.set("You do not have permission to view transactions for this reservation."):this.loadError.set("Failed to load transaction history. You can still record new payments."),this.transactions.set([])}})}getApprovedExtensionCost(){return this.data.reservation.extensions?this.data.reservation.extensions.filter(e=>e.status==="approved").reduce((e,n)=>e+(n.additionalCost||0),0):0}getApprovedExtensionNights(){return this.data.reservation.extensions?this.data.reservation.extensions.filter(e=>e.status==="approved").reduce((e,n)=>e+(n.additionalNights||0),0):0}hasApprovedExtensions(){return this.getApprovedExtensionCost()>0}getCurrentPaymentStatus(){let t=this.balanceAmount(),e=this.paidAmount();return t<=0?"paid":e>0?"partial":"pending"}getCurrentStatusClass(){switch(this.getCurrentPaymentStatus()){case"paid":return"text-green-600";case"partial":return"text-orange-600";case"pending":return"text-red-600";default:return"text-gray-600"}}canSave(){if(!this.paymentForm.valid)return!1;if(this.data.isCheckoutFlow)return this.paymentForm.get("type")?.value==="refund"?this.paymentForm.valid&&this.balanceAmount()<0&&this.paymentForm.get("amount")?.value>0&&this.paymentForm.get("amount")?.value<=Math.abs(this.balanceAmount()):this.paymentForm.valid&&this.balanceAmount()>0&&this.paymentForm.get("amount")?.value>0&&this.paymentForm.get("amount")?.value<=this.balanceAmount();{let t=this.paymentForm.get("status")?.value,e=this.balanceAmount();if(t==="paid"&&e>0)return!1}return!0}setAmount(t){this.paymentForm.patchValue({amount:t})}onCancel(){this.queryParamService.remove("paymentRedirection"),this.dialogRef.close({confirmed:!1})}onConfirm(){if(this.queryParamService.remove("paymentRedirection"),this.canSave()){this.processing.set(!0);let t=this.storeStore.selectedStore()?._id;if(!t){console.error("Store ID not available"),this.processing.set(!1);return}let e,n=this.currentUser()?._id;this.data.isCheckoutFlow?e={reservation:this.data.reservation._id,amount:this.paymentForm.value.amount,method:this.paymentForm.value.method,type:this.paymentForm.value.type||(this.balanceAmount()<0?"refund":"payment"),notes:this.paymentForm.value.notes||void 0,processedBy:n}:e={reservation:this.data.reservation._id,amount:0,method:this.paymentForm.value.method,type:"adjustment",notes:this.paymentForm.value.notes||void 0,processedBy:n},this.reservationService.createTransaction(t,this.data.reservation._id,e).subscribe({next:l=>{this.processing.set(!1),this.loadTransactions(),this.dialogRef.close({confirmed:!0,paymentData:e,transaction:l})},error:l=>{console.error("Error creating transaction:",l),this.processing.set(!1);let s="Failed to process transaction. Please try again.";l.status===400?s=l.error?.message||"Invalid transaction data":l.status===404&&(s="Reservation not found"),alert(s)}})}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=B({type:i,selectors:[["app-payment-update-dialog"]],decls:57,vars:31,consts:[["mat-dialog-title",""],[1,"mb-6","p-4","bg-gray-50","rounded-lg"],[1,"text-sm","font-semibold","mb-4"],[1,"grid","grid-cols-2","gap-4","mb-4"],[1,"bg-white","p-3","rounded","border","border-gray-200"],[1,"text-xs","text-gray-600","mb-1"],[1,"text-lg","font-bold"],[1,"text-lg","font-bold","text-green-600"],[1,"text-sm","font-bold"],[1,"mb-4"],[1,"flex","justify-between","items-center","mb-1"],[1,"text-xs","font-medium"],[1,"text-xs","font-semibold"],[1,"h-2","bg-gray-200","rounded-full","overflow-hidden"],[1,"h-full","bg-green-500","transition-all"],["animationDuration","300"],["label","Add Transaction",3,"disabled"],["mat-tab-label",""],[1,"space-y-4","mt-6",3,"formGroup"],["label","Transaction History",3,"disabled"],[1,"mt-6"],[1,"p-4","bg-yellow-50","border","border-yellow-200","rounded","text-sm","text-yellow-700","mb-4"],[1,"flex","justify-center","items-center","py-8"],[1,"text-center","py-8","text-gray-500"],["mat-table","",1,"w-full","mt-4",3,"dataSource"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"mr-2"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["appearance","outline","class","w-full",4,"ngIf"],["appearance","outline",1,"w-full"],["matPrefix",""],["matInput","","currencyMask","","step","0.01","formControlName","amount","placeholder","0.00",3,"options","min","max"],["formControlName","method"],["value","cash"],["value","card"],["value","bank_transfer"],["value","mobile_money"],["value","check"],["value","online"],["value","refund"],["matInput","","formControlName","reference","placeholder","Transaction ID, Receipt number, etc."],["matInput","","formControlName","notes","rows","3","placeholder","Additional payment notes..."],[4,"ngIf"],["formControlName","type"],["value","payment"],[1,"text-sm","font-medium","mb-2"],[1,"flex","flex-wrap","gap-2"],["type","button","mat-stroked-button","",3,"click"],["type","button","mat-stroked-button",""],["formControlName","status"],["value","pending"],["value","partial"],["value","paid"],["matInput","","formControlName","notes","rows","3","placeholder","Additional notes about the payment..."],[1,"block"],["diameter","40","mode","indeterminate"],[1,"block","text-4xl","mb-2","opacity-30"],["matColumnDef","date"],["mat-header-cell","","class","text-xs font-semibold",4,"matHeaderCellDef"],["mat-cell","","class","text-sm",4,"matCellDef"],["matColumnDef","amount"],["mat-header-cell","","class","text-xs font-semibold text-right",4,"matHeaderCellDef"],["mat-cell","","class","text-sm text-right font-semibold",4,"matCellDef"],["matColumnDef","method"],["matColumnDef","type"],["matColumnDef","notes"],["mat-cell","","class","text-sm text-gray-600",4,"matCellDef"],["matColumnDef","balance"],["mat-cell","","class","text-sm text-right",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","border-b hover:bg-gray-50",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"text-xs","font-semibold"],["mat-cell","",1,"text-sm"],["mat-header-cell","",1,"text-xs","font-semibold","text-right"],["mat-cell","",1,"text-sm","text-right","font-semibold"],[1,"px-2","py-1","bg-blue-100","text-blue-800","rounded","text-xs"],["mat-cell","",1,"text-sm","text-gray-600"],["mat-cell","",1,"text-sm","text-right"],["mat-header-row",""],["mat-row","",1,"border-b","hover:bg-gray-50"]],template:function(e,n){if(e&1&&(o(0,"h2",0),r(1),a(),o(2,"mat-dialog-content")(3,"div",1)(4,"h3",2),r(5,"Payment Breakdown"),a(),o(6,"div",3)(7,"div",4)(8,"div",5),r(9,"Total Amount"),a(),o(10,"div",6),r(11),h(12,"currency"),a()(),o(13,"div",4)(14,"div",5),r(15,"Amount Paid"),a(),o(16,"div",7),r(17),h(18,"currency"),a()(),o(19,"div",4)(20,"div",5),r(21,"Balance Due"),a(),o(22,"div",6),r(23),h(24,"currency"),a()(),o(25,"div",4)(26,"div",5),r(27,"Payment Status"),a(),o(28,"div",8),r(29),h(30,"titlecase"),a()()(),o(31,"div",9)(32,"div",10)(33,"span",11),r(34,"Payment Progress"),a(),o(35,"span",12),r(36),a()(),o(37,"div",13),C(38,"div",14),a()()(),o(39,"mat-tab-group",15)(40,"mat-tab",16),x(41,Mt,3,0,"ng-template",17),o(42,"form",18),g(43,Vt,39,14)(44,Nt,37,3),a()(),o(45,"mat-tab",19),x(46,Ut,3,1,"ng-template",17),o(47,"div",20),g(48,Bt,4,1,"div",21),g(49,Ht,2,0,"div",22)(50,Gt,5,0,"div",23)(51,nn,21,3,"table",24),a()()()(),o(52,"mat-dialog-actions",25)(53,"a",26),y("click",function(){return n.onCancel()}),r(54,"Cancel"),a(),o(55,"a",27),y("click",function(){return n.onConfirm()}),r(56),a()()),e&2){let l,s,u;m(),d(" Transaction Management (",n.data.reservation.confirmationNumber,`)
`),m(10),d("",b(12,20,n.totalAmount(),(l=n.storeStore.selectedStore())==null?null:l.currency)," "),m(6),w(b(18,23,n.paidAmount(),(s=n.storeStore.selectedStore())==null?null:s.currency)),m(5),G(n.balanceAmount()>0?"text-red-600":"text-green-600"),m(),d(" ",b(24,26,n.balanceAmount(),(u=n.storeStore.selectedStore())==null?null:u.currency)," "),m(5),G(n.getCurrentStatusClass()),m(),d(" ",A(30,29,n.getCurrentPaymentStatus())," "),m(7),d("",n.paymentPercentage(),"%"),m(2),be("width",n.paymentPercentage(),"%"),m(2),_("disabled",n.loadingTransactions()),m(2),_("formGroup",n.paymentForm),m(),f(n.data.isCheckoutFlow?43:44),m(2),_("disabled",n.loadingTransactions()),m(3),f(n.loadError()?48:-1),m(),f(n.loadingTransactions()?49:n.transactions().length===0?50:51),m(6),_("disabled",!n.canSave()||n.processing()),m(),d(" ",n.processing()?"Processing...":"Save Transaction"," ")}},dependencies:[V,Pe,X,Y,W,$,z,Z,Q,de,le,me,se,q,K,ne,te,ee,Fe,Ne,ae,ie,Ge,He,Ie,j,L,Be,Ue,We,qe,Le,je,it,$e,Ye,Xe,Qe,ze,et,Ze,Je,tt,nt,ut,ge,De,ke,we],styles:["mat-dialog-content[_ngcontent-%COMP%]{max-height:600px;padding:24px}mat-dialog-content[_ngcontent-%COMP%]   mat-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-list{border-bottom:1px solid #e5e7eb}mat-dialog-content[_ngcontent-%COMP%]   mat-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab{min-width:150px}.bg-gray-50[_ngcontent-%COMP%]{background-color:#f9fafb}.bg-gray-50[_ngcontent-%COMP%]   .bg-white[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #e5e7eb}.bg-gray-50[_ngcontent-%COMP%]   .bg-white[_ngcontent-%COMP%]   .text-gray-600[_ngcontent-%COMP%]{color:#4b5563;font-size:.75rem}.h-2[_ngcontent-%COMP%]{height:.5rem}.h-2.bg-gray-200[_ngcontent-%COMP%]{background-color:#e5e7eb}.h-2[_ngcontent-%COMP%]   .bg-green-500[_ngcontent-%COMP%]{background-color:#10b981}mat-form-field[_ngcontent-%COMP%]{display:block;margin-bottom:1rem}table[_ngcontent-%COMP%]{border-collapse:collapse}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.75rem;text-align:left;border-bottom:1px solid #e5e7eb;background-color:#f9fafb}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem;border-bottom:1px solid #e5e7eb}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f9fafb}.px-2.py-1.rounded[_ngcontent-%COMP%]{padding:.5rem;border-radius:.25rem;font-size:.75rem;font-weight:600}.bg-blue-100[_ngcontent-%COMP%]{background-color:#dbeafe;color:#0c4a6e}.bg-green-100[_ngcontent-%COMP%]{background-color:#dcfce7;color:#166534}.bg-red-100[_ngcontent-%COMP%]{background-color:#fee2e2;color:#991b1b}.opacity-30[_ngcontent-%COMP%]{opacity:.3}mat-progress-spinner[_ngcontent-%COMP%]{display:block;margin:0 auto}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #e5e7eb;display:flex;justify-content:flex-end;gap:1rem}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:100px}.text-xs[_ngcontent-%COMP%]{font-size:.75rem}.text-sm[_ngcontent-%COMP%]{font-size:.875rem}.text-lg[_ngcontent-%COMP%]{font-size:1.125rem}.font-medium[_ngcontent-%COMP%]{font-weight:500}.font-semibold[_ngcontent-%COMP%]{font-weight:600}.font-bold[_ngcontent-%COMP%]{font-weight:700}.text-gray-500[_ngcontent-%COMP%]{color:#6b7280}.text-gray-600[_ngcontent-%COMP%]{color:#4b5563}.text-green-600[_ngcontent-%COMP%]{color:#16a34a}.text-red-600[_ngcontent-%COMP%]{color:#dc2626}.text-blue-800[_ngcontent-%COMP%]{color:#1e40af}.text-blue-50[_ngcontent-%COMP%]{background-color:#eff6ff}.border-blue-200[_ngcontent-%COMP%]{border:1px solid #bfdbfe}.rounded-lg[_ngcontent-%COMP%]{border-radius:.5rem}.mb-1[_ngcontent-%COMP%]{margin-bottom:.25rem}.mb-2[_ngcontent-%COMP%]{margin-bottom:.5rem}.mb-4[_ngcontent-%COMP%]{margin-bottom:1rem}.mb-6[_ngcontent-%COMP%]{margin-bottom:1.5rem}.p-2[_ngcontent-%COMP%]{padding:.5rem}.p-3[_ngcontent-%COMP%]{padding:.75rem}.p-4[_ngcontent-%COMP%]{padding:1rem}.grid[_ngcontent-%COMP%]{display:grid}.gap-2[_ngcontent-%COMP%]{gap:.5rem}.gap-4[_ngcontent-%COMP%]{gap:1rem}.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}@media(max-width:768px){.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{ge as a,ut as b,mt as c,ct as d};
