import{a as ke}from"./chunk-GWC7K72H.js";import{a as Pe}from"./chunk-7FSETBMW.js";import"./chunk-HJ3KAQ7K.js";import{a as Re,b as Ee,c as we,h as Te}from"./chunk-Y2RO63AQ.js";import{a as Ie}from"./chunk-JZKRHT5H.js";import{a as Se}from"./chunk-O4OM35BU.js";import{g as Me}from"./chunk-LUSGELTX.js";import{a as q}from"./chunk-CP5EC6RD.js";import"./chunk-CCJ2KI64.js";import"./chunk-6RCOBA75.js";import"./chunk-A24HMJCQ.js";import{i as X}from"./chunk-QC7H4KPM.js";import{a as Ce,b as De}from"./chunk-WZDQ5XTC.js";import{d as Y}from"./chunk-R6JGHN2R.js";import{d as he}from"./chunk-BXJEGH2V.js";import"./chunk-64WHNS37.js";import"./chunk-TIVXUJ22.js";import"./chunk-WAHSRZAW.js";import"./chunk-XLZTIYSF.js";import{b as ve,c as be,d as ye}from"./chunk-UMV4DCPT.js";import{a as ge,e as ue,h as _e}from"./chunk-G3VZM262.js";import"./chunk-BCE7WRWQ.js";import{a as fe,b as xe}from"./chunk-6I3AJKA7.js";import{B as pe,b as oe,d as N,g as re,h as de,m as le,s as se,t as ce,z as me}from"./chunk-W7NMJLMQ.js";import"./chunk-F5SZ3AU3.js";import"./chunk-TILT22SG.js";import{a as W}from"./chunk-BFT2MTJY.js";import{a as te,c as ne,f as ie,h as ae}from"./chunk-3E3PJ7Q7.js";import"./chunk-FO4KTVQ3.js";import"./chunk-TRZH7NMW.js";import"./chunk-GXTELBJV.js";import{b as Z,c as ee}from"./chunk-JPRPNQOM.js";import{Z as J,_ as K,ba as Q}from"./chunk-3LDCGXHW.js";import"./chunk-ZLVQTB5B.js";import{m as U,n as L,o as z,s as j,y as H}from"./chunk-6PFJHDFS.js";import{Ib as g,Jb as u,Kb as w,Lc as f,Mb as M,Mc as G,Nb as S,Nc as x,Ob as _,Pb as a,Qb as i,Rb as R,Vc as I,Yb as T,ac as v,bb as s,cc as c,fa as h,ka as m,la as p,mc as F,oc as O,qb as A,rc as d,sc as C,tc as E,uc as $,wa as b,za as k}from"./chunk-J2AK4FW5.js";import"./chunk-GAL4ENT6.js";var Ne=(r,t)=>t._id||t.id||"";function Ve(r,t){r&1&&(a(0,"div",28),R(1,"mat-spinner",38),a(2,"span",39),d(3,"Loading room types..."),i()())}function Be(r,t){if(r&1&&(a(0,"div",29)(1,"p",40),d(2,"Failed to load room types"),i(),a(3,"p",41),d(4),f(5,"json"),i()()),r&2){let n=c();s(4),C(G(5,1,n.getError()))}}function Ae(r,t){if(r&1&&(a(0,"th",45)(1,"div",46),d(2),f(3,"date"),i(),a(4,"div",47),d(5),f(6,"date"),i()()),r&2){let n=t.$implicit;s(2),C(x(3,2,n,"EEE")),s(3),C(x(6,5,n,"d"))}}function $e(r,t){if(r&1){let n=T();a(0,"input",58),f(1,"number"),v("change",function(o){m(n);let l=c().$implicit,y=c().$implicit,D=c(2);return p(D.updateRate(y._id||y.id||"",l,+o.target.value))}),i()}if(r&2){let n=c().$implicit,e=c().$implicit,o=c(2);_("value",x(1,1,o.getRate(e._id||e.id||"",n),"1.0-2"))}}function Ge(r,t){if(r&1&&(a(0,"span",57),d(1),f(2,"number"),i()),r&2){let n=c().$implicit,e=c().$implicit,o=c(2);s(),E(" ",x(2,1,o.getRate(e._id||e.id||"",n),"1.0-2")," ")}}function Ue(r,t){if(r&1&&(a(0,"td",52),g(1,$e,2,4,"input",56),g(2,Ge,3,4,"span",57),i()),r&2){let n=c(3);s(),u(n.getEditMode()?1:-1),s(),u(n.getEditMode()?-1:2)}}function Le(r,t){if(r&1){let n=T();a(0,"input",61),v("change",function(o){m(n);let l=c().$implicit,y=c().$implicit,D=c(2);return p(D.updateAvailability(y._id||y.id||"",l,+o.target.value))}),i()}if(r&2){let n=c().$implicit,e=c().$implicit,o=c(2);_("value",o.getAvailability(e._id||e.id||"",n))}}function ze(r,t){if(r&1&&(a(0,"span",60),d(1),i()),r&2){let n=c().$implicit,e=c().$implicit,o=c(2);s(),E(" ",o.getAvailability(e._id||e.id||"",n)," ")}}function je(r,t){if(r&1&&(a(0,"td",52),g(1,Le,1,1,"input",59),g(2,ze,2,1,"span",60),i()),r&2){let n=c(3);s(),u(n.getEditMode()?1:-1),s(),u(n.getEditMode()?-1:2)}}function He(r,t){if(r&1&&(a(0,"tr",48)(1,"td",49)(2,"div",50),d(3),i(),a(4,"div",51),d(5),i()(),M(6,Ue,3,2,"td",52,w),i(),a(8,"tr",53)(9,"td",54)(10,"div",55),d(11,"Availability"),i()(),M(12,je,3,2,"td",52,w),i()),r&2){let n=t.$implicit,e=c(2);O("bg-blue-50",e.getEditMode()),s(3),C(n.name),s(2),E("Rate ",e.getCurrencySymbol(e.getSelectedCurrency())),s(),S(e.getCalendarDates()),s(2),O("bg-blue-100",e.getEditMode()),s(4),S(e.getCalendarDates())}}function Ye(r,t){if(r&1&&(a(0,"div",30)(1,"table",42)(2,"thead")(3,"tr",43)(4,"th",44),d(5," Room Type "),i(),M(6,Ae,7,8,"th",45,w),i()(),a(8,"tbody"),M(9,He,14,6,null,null,Ne),i()()()),r&2){let n=c();s(6),S(n.getCalendarDates()),s(3),S(n.getRoomTypes())}}function qe(r,t){r&1&&(a(0,"div",31)(1,"mat-icon",62),d(2,"calendar_today"),i(),a(3,"p",63),d(4,"Select a date range to view the calendar"),i()())}function Je(r,t){r&1&&(a(0,"div",36)(1,"mat-icon",64),d(2,"check_circle"),i(),a(3,"div")(4,"p",40),d(5,"Rates synced successfully"),i(),a(6,"p",65),d(7,"Your changes have been pushed to Channex and will be distributed to OTA partners."),i()()())}function Ke(r,t){r&1&&(a(0,"div",37)(1,"mat-icon",66),d(2,"error"),i(),a(3,"div")(4,"p",40),d(5,"Failed to sync rates"),i(),a(6,"p",65),d(7,"Please check your connection and try again."),i()()())}var Fe=class r{fb=h(me);roomsService=h(ke);storeStore=h(X);http=h(H);baseUrl=W.apiUrl;dateRangeForm=this.fb.group({startDate:[new Date,N.required],endDate:[this.getDateAfter(14),N.required]});roomTypesResource=he({params:()=>({storeId:this.storeStore.selectedStore()?._id||""}),stream:({params:t})=>this.roomsService.getRoomTypes(t.storeId)});dateRange=b({startDate:new Date,endDate:this.getDateAfter(14)});calendarDates=b([]);selectedCurrency=b("NGN");rateData=b(new Map);availabilityData=b(new Map);isSaving=b(!1);saveStatus=b(null);selectedRoomTypeId=b("");editMode=b(!1);getRoomTypes=I(()=>this.roomTypesResource.value()||[]);getIsLoading=I(()=>this.roomTypesResource.isLoading());getError=I(()=>this.roomTypesResource.error());getCalendarDates=this.calendarDates.asReadonly();getSelectedCurrency=this.selectedCurrency.asReadonly();getIsSaving=this.isSaving.asReadonly();getSaveStatus=this.saveStatus.asReadonly();getEditMode=this.editMode.asReadonly();constructor(){k(()=>{let t=this.dateRangeForm.get("startDate")?.value,n=this.dateRangeForm.get("endDate")?.value;t&&n&&(this.dateRange.set({startDate:new Date(t),endDate:new Date(n)}),this.generateCalendarDates(new Date(t),new Date(n)))}),k(()=>{let t=this.getRoomTypes();t.length>0&&!this.selectedRoomTypeId()&&this.selectedRoomTypeId.set(t[0]._id||t[0].id||"")})}getDateAfter(t){let n=new Date;return n.setDate(n.getDate()+t),n}generateCalendarDates(t,n){let e=[],o=new Date(t);for(;o<=n;)e.push(new Date(o)),o.setDate(o.getDate()+1);this.calendarDates.set(e)}getDateString(t){return t.toISOString().split("T")[0]}getRate(t,n){let e=this.getDateString(n);return this.rateData().get(t)?.get(e)||0}getAvailability(t,n){let e=this.getDateString(n);return this.availabilityData().get(t)?.get(e)||0}updateRate(t,n,e){let o=this.getDateString(n),l=this.rateData();l.has(t)||l.set(t,new Map),l.get(t).set(o,e),this.rateData.set(l)}updateAvailability(t,n,e){let o=this.getDateString(n),l=this.availabilityData();l.has(t)||l.set(t,new Map),l.get(t).set(o,e),this.availabilityData.set(l)}selectRoomType(t){this.selectedRoomTypeId.set(t)}toggleEditMode(){this.editMode.set(!this.editMode())}getCurrencySymbol(t){return{NGN:"\u20A6",USD:"$",EUR:"\u20AC",GBP:"\xA3"}[t]||t}saveChanges(){this.isSaving.set(!0),this.saveStatus.set(null);let{startDate:t,endDate:n}=this.dateRange(),e=[];this.getRoomTypes().forEach(l=>{let y=l._id||l.id||"",D=this.rateData().get(y);this.getCalendarDates().forEach(Oe=>{let P=this.getDateString(Oe),V=D?.get(P)||0,B=this.availabilityData().get(y)?.get(P)||0;(V>0||B>0)&&e.push({date:P,roomTypeId:y,rate:V,availability:B})})});let o={storeId:this.storeStore.selectedStore()?._id||"",startDate:this.getDateString(t),endDate:this.getDateString(n),rates:e,currency:this.selectedCurrency()};this.http.post(`${this.baseUrl}/admin/channex/stores/${o.storeId}/rates`,o).subscribe({next:()=>{this.isSaving.set(!1),this.saveStatus.set("success"),this.editMode.set(!1),setTimeout(()=>this.saveStatus.set(null),3e3)},error:l=>{console.error("Failed to save rates:",l),this.isSaving.set(!1),this.saveStatus.set("error"),setTimeout(()=>this.saveStatus.set(null),3e3)}})}resetChanges(){this.rateData.set(new Map),this.availabilityData.set(new Map),this.editMode.set(!1)}navigateToPreviousPeriod(){let{startDate:t,endDate:n}=this.dateRange(),e=Math.ceil((n.getTime()-t.getTime())/(1e3*60*60*24)),o=new Date(t);o.setDate(o.getDate()-e);let l=new Date(n);l.setDate(l.getDate()-e),this.dateRangeForm.patchValue({startDate:o,endDate:l})}navigateToNextPeriod(){let{startDate:t,endDate:n}=this.dateRange(),e=Math.ceil((n.getTime()-t.getTime())/(1e3*60*60*24)),o=new Date(t);o.setDate(o.getDate()+e);let l=new Date(n);l.setDate(l.getDate()+e),this.dateRangeForm.patchValue({startDate:o,endDate:l})}selectDateRange(t){let n=new Date,e=this.getDateAfter(t-1);this.dateRangeForm.patchValue({startDate:n,endDate:e})}updateCurrency(t){this.selectedCurrency.set(t)}getDateAfterPublic(t){return this.getDateAfter(t)}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=A({type:r,selectors:[["app-inventory-rates"]],decls:72,vars:24,consts:[["startPicker",""],["endPicker",""],["title","Rates & Availability","description","Manage room rates and availability by date for Channex distribution"],[1,"space-y-6"],["appearance","outlined"],[1,"border-b","border-gray-200","px-6","py-4"],[1,"text-lg","font-semibold","text-gray-900"],[1,"p-6","space-y-4"],[1,"flex","flex-wrap","gap-2","my-4"],["mat-stroked-button","",1,"text-sm",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","startDate",3,"matDatepicker"],["matIconSuffix","",3,"for"],["matInput","","formControlName","endDate",3,"matDatepicker"],[3,"value"],["value","NGN"],["value","USD"],["value","EUR"],["value","GBP"],[1,"border-b","border-gray-200","px-6","py-4","flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],["mat-icon-button","","matTooltip","Previous period",3,"click"],[1,"font-medium","text-gray-700","whitespace-nowrap"],["mat-icon-button","","matTooltip","Next period",3,"click"],[1,"flex","items-center","gap-2"],["mat-icon-button","","matTooltip","Toggle edit mode",3,"click"],[1,"p-6"],[1,"flex","items-center","justify-center","py-12"],[1,"bg-red-50","border","border-red-200","rounded-md","p-4","text-red-700"],[1,"overflow-x-auto"],[1,"text-center","py-12"],[1,"flex","gap-3","justify-end"],["mat-stroked-button","",1,"text-gray-700",3,"click","disabled"],["matButtonIcon",""],["matButton","filled","color","primary",1,"relative",3,"click","disabled"],[1,"bg-green-50","border","border-green-200","rounded-md","p-4","text-green-700","flex","items-center","gap-3","animate-in","fade-in","duration-300"],[1,"bg-red-50","border","border-red-200","rounded-md","p-4","text-red-700","flex","items-center","gap-3","animate-in","fade-in","duration-300"],["diameter","40"],[1,"ml-4","text-gray-600"],[1,"font-medium"],[1,"text-sm","mt-1"],[1,"min-w-full","border-collapse","border","border-gray-200"],[1,"bg-gray-50","border-b","border-gray-200"],[1,"px-4","py-3","text-left","font-semibold","text-gray-700","border-r","border-gray-200","sticky","left-0","bg-gray-50","w-48"],[1,"px-3","py-2","text-center","font-medium","text-gray-600","text-xs","whitespace-nowrap","border-r","border-gray-200"],[1,"font-semibold","text-gray-900"],[1,"text-gray-500"],[1,"border-b","border-gray-200","hover:bg-blue-50"],[1,"px-4","py-3","font-medium","text-gray-900","border-r","border-gray-200","sticky","left-0","bg-white"],[1,"text-sm","font-semibold"],[1,"text-xs","text-gray-500","mt-1"],[1,"px-2","py-2","border-r","border-gray-200","text-center"],[1,"border-b","border-gray-200","bg-gray-50"],[1,"px-4","py-2","border-r","border-gray-200","sticky","left-0","bg-gray-50"],[1,"text-xs","text-gray-600"],["type","number","min","0","step","0.01","placeholder","0",1,"w-16","px-2","py-1","text-xs","border","border-gray-300","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-500","text-center",3,"value"],[1,"text-sm","font-medium","text-gray-900"],["type","number","min","0","step","0.01","placeholder","0",1,"w-16","px-2","py-1","text-xs","border","border-gray-300","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-500","text-center",3,"change","value"],["type","number","min","0","step","1","placeholder","0",1,"w-16","px-2","py-1","text-xs","border","border-gray-300","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-500","text-center",3,"value"],[1,"text-sm","font-medium","text-gray-600"],["type","number","min","0","step","1","placeholder","0",1,"w-16","px-2","py-1","text-xs","border","border-gray-300","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-500","text-center",3,"change","value"],[1,"text-gray-400","mx-auto",2,"font-size","48px","width","48px","height","48px"],[1,"text-gray-600","mt-4"],[1,"text-green-600"],[1,"text-sm"],[1,"text-red-600"]],template:function(n,e){if(n&1){let o=T();R(0,"app-page-header",2),a(1,"div",3)(2,"mat-card",4)(3,"mat-card-header",5)(4,"h3",6),d(5,"Date Range Selection"),i()(),a(6,"mat-card-content",7)(7,"div",8)(8,"button",9),v("click",function(){return m(o),p(e.selectDateRange(7))}),d(9," 7 Days "),i(),a(10,"button",9),v("click",function(){return m(o),p(e.selectDateRange(14))}),d(11," 14 Days "),i(),a(12,"button",9),v("click",function(){return m(o),p(e.selectDateRange(30))}),d(13," 30 Days "),i()(),a(14,"form",10)(15,"mat-form-field",11)(16,"mat-label"),d(17,"Start Date"),i(),R(18,"input",12)(19,"mat-datepicker-toggle",13)(20,"mat-datepicker",null,0),i(),a(22,"mat-form-field",11)(23,"mat-label"),d(24,"End Date"),i(),R(25,"input",14)(26,"mat-datepicker-toggle",13)(27,"mat-datepicker",null,1),i(),a(29,"mat-form-field",11)(30,"mat-label"),d(31,"Currency"),i(),a(32,"mat-select",15)(33,"mat-option",16),d(34,"NGN (\u20A6)"),i(),a(35,"mat-option",17),d(36,"USD ($)"),i(),a(37,"mat-option",18),d(38,"EUR (\u20AC)"),i(),a(39,"mat-option",19),d(40,"GBP (\xA3)"),i()()()()()(),a(41,"mat-card",4)(42,"mat-card-header",20)(43,"div",21)(44,"button",22),v("click",function(){return m(o),p(e.navigateToPreviousPeriod())}),a(45,"mat-icon"),d(46,"chevron_left"),i()(),a(47,"span",23),d(48),f(49,"date"),f(50,"date"),i(),a(51,"button",24),v("click",function(){return m(o),p(e.navigateToNextPeriod())}),a(52,"mat-icon"),d(53,"chevron_right"),i()()(),a(54,"div",25)(55,"button",26),v("click",function(){return m(o),p(e.toggleEditMode())}),a(56,"mat-icon"),d(57),i()()()(),a(58,"mat-card-content",27),g(59,Ve,4,0,"div",28),g(60,Be,6,3,"div",29),g(61,Ye,11,0,"div",30),g(62,qe,5,0,"div",31),i()(),a(63,"div",32)(64,"button",33),v("click",function(){return m(o),p(e.resetChanges())}),a(65,"mat-icon",34),d(66,"clear"),i(),d(67," Reset "),i(),a(68,"button",35),v("click",function(){return m(o),p(e.saveChanges())}),d(69),i()(),g(70,Je,8,0,"div",36),g(71,Ke,8,0,"div",37),i()}if(n&2){let o=F(21),l=F(28);s(14),_("formGroup",e.dateRangeForm),s(4),_("matDatepicker",o),s(),_("for",o),s(6),_("matDatepicker",l),s(),_("for",l),s(6),_("value",e.getSelectedCurrency()),s(16),$(" ",x(49,18,e.getCalendarDates()[0],"MMM d")," - ",x(50,21,e.getCalendarDates()[e.getCalendarDates().length-1],"MMM d, yyyy")," "),s(9),C(e.getEditMode()?"lock_open":"lock"),s(2),u(e.getIsLoading()?59:-1),s(),u(e.getError()?60:-1),s(),u(!e.getIsLoading()&&!e.getError()&&e.getCalendarDates().length>0?61:-1),s(),u(!e.getIsLoading()&&!e.getError()&&e.getCalendarDates().length===0?62:-1),s(2),_("disabled",!e.getEditMode()||e.getIsSaving()),s(4),_("disabled",!e.getEditMode()||e.getIsSaving()),s(),E(" ",e.getIsSaving()?"Saving...":"Save Changes"," "),s(),u(e.getSaveStatus()==="success"?70:-1),s(),u(e.getSaveStatus()==="error"?71:-1)}},dependencies:[j,pe,le,oe,re,de,ce,se,ae,te,ne,ie,ve,_e,ge,ue,ye,be,Q,K,J,ee,Z,Te,Re,Ee,we,q,xe,fe,De,Ce,Y,Ie,Se,Me,Pe,L,z,U],styles:["[_nghost-%COMP%]{display:block}table[_ngcontent-%COMP%]{border-collapse:collapse;width:100%}table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child, table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-child{position:sticky;left:0;z-index:9}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{transition:background-color .2s ease}table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 3px #3b82f61a}table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled{background-color:#f3f4f6;color:#6b7280;cursor:not-allowed}@media(max-width:1024px){table[_ngcontent-%COMP%]{font-size:.875rem}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.5rem}table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:3rem}}@media(max-width:768px){table[_ngcontent-%COMP%]{font-size:.75rem}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.25rem}table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:2.5rem;font-size:.7rem}.overflow-x-auto[_ngcontent-%COMP%]{-webkit-overflow-scrolling:touch}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.animate-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}  .mat-mdc-card-header{padding:0}"],changeDetection:0})};export{Fe as InventoryRatesComponent};
