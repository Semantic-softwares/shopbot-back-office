import{b as _e}from"./chunk-S35VCKTJ.js";import{f as de}from"./chunk-CU623SSI.js";import{a as fe}from"./chunk-GU4Z36JA.js";import{a as ge,b as ve}from"./chunk-GZXF4TWP.js";import{a as se,b as pe,e as ce,h as ue}from"./chunk-XNNKKASY.js";import{i as R}from"./chunk-QC7H4KPM.js";import{b as oe,c as re,d as ae}from"./chunk-UMV4DCPT.js";import{a as te,b as ie,h as ne}from"./chunk-G3VZM262.js";import{a as le,b as me}from"./chunk-6I3AJKA7.js";import{B as ee,b as U,d,g as H,h as J,m as K,n as Q,s as W,t as X,v as Y,z as Z}from"./chunk-W7NMJLMQ.js";import{a as L}from"./chunk-4UBDYPTG.js";import{b as $,c as z}from"./chunk-JPRPNQOM.js";import{Z as G,_ as P,ba as j}from"./chunk-3LDCGXHW.js";import{q,s as A}from"./chunk-6PFJHDFS.js";import{Ib as s,Jb as p,Lc as w,Mb as V,Nb as k,Nc as T,Ob as g,Pb as i,Qb as t,Rb as c,Vc as B,Yb as N,ac as v,bb as m,cc as C,fa as S,ka as D,kb as h,la as F,qb as I,rc as n,sc as E,tc as f,wa as x}from"./chunk-J2AK4FW5.js";import{a as _,b}from"./chunk-GAL4ENT6.js";var Se=(l,r)=>r._id;function he(l,r){l&1&&(i(0,"mat-error"),n(1," Name is required "),t())}function Ce(l,r){l&1&&(i(0,"mat-error"),n(1," At Least value is required "),t())}function xe(l,r){l&1&&(i(0,"mat-error"),n(1," Value must be 0 or greater "),t())}function Ee(l,r){l&1&&(i(0,"mat-error"),n(1," At Most value is required "),t())}function Me(l,r){l&1&&(i(0,"mat-error"),n(1," Value must be 0 or greater "),t())}function Oe(l,r){if(l&1){let a=N();i(0,"div",29)(1,"div")(2,"span",30),n(3),t(),i(4,"span",31),n(5),w(6,"currency"),t()(),i(7,"a",32),v("click",function(){let o=D(a).$implicit,u=C(2);return F(u.removeOption(o))}),i(8,"mat-icon"),n(9,"close"),t()()()}if(l&2){let a,e=r.$implicit,o=C(2);m(3),E(e.name),m(2),E(T(6,2,e.price,(a=o.storeStore.selectedStore())==null?null:a.currency))}}function ye(l,r){if(l&1&&(i(0,"div",20)(1,"h4",28),n(2,"Added Options:"),t(),V(3,Oe,10,5,"div",29,Se),t()),l&2){let a=C();m(3),k(a.selectedOptions())}}function De(l,r){l&1&&c(0,"mat-spinner",26)}var be=class l{constructor(r,a,e){this.fb=r;this.dialogRef=a;this.data=e;this.variantForm=this.fb.group({name:["",d.required],atLeast:[0,[d.required,d.min(0)]],atMost:[0,[d.required,d.min(0)]],enabled:[!0],store:[this.storeStore.selectedStore()?._id,d.required]}),this.newOptionForm=this.fb.group({name:["",d.required],price:[0,[d.required,d.min(0)]],inStock:[!0],store:[this.storeStore.selectedStore()?._id,d.required]}),e.isEdit&&e.variant&&(this.variantForm.patchValue(e.variant),e.variant._id&&this.productService.getGroupOptionItems(e.variant._id).subscribe({next:o=>{console.log("Loaded variant options:",o),this.selectedOptions.set(o)},error:o=>{console.error("Error loading variant options:",o),this.snackBar.open("Error loading variant options","Close",{duration:3e3})}}))}productService=S(fe);storeStore=S(R);snackBar=S(L);isSubmitting=x(!1);selectedOptions=x([]);selectedOptionIds=B(()=>this.selectedOptions().map(r=>r._id));variantForm;newOptionForm;addNewOption(){if(this.newOptionForm.valid){let r=b(_({},this.newOptionForm.value),{store:this.storeStore.selectedStore()?._id,variant:this.data.variant?._id});this.productService.saveOption(r).subscribe({next:a=>{this.selectedOptions.update(e=>[...e,a]),this.newOptionForm.reset({name:"",price:0,store:this.storeStore.selectedStore()?._id,inStock:!0}),this.snackBar.open("Option added successfully","Close",{duration:3e3})},error:()=>{this.snackBar.open("Error adding option","Close",{duration:3e3})}})}}removeOption(r){let a=this.selectedOptions().findIndex(e=>e._id===r._id);a>-1&&(this.selectedOptions.update(e=>e.filter((o,u)=>u!==a)),this.productService.deleteOptionItem(r._id).subscribe({next:()=>{this.snackBar.open("Option removed successfully","Close",{duration:3e3})},error:()=>{this.selectedOptions.update(e=>{let o=[...e];return o.splice(a,0,r),o}),this.snackBar.open("Error removing option","Close",{duration:3e3})}}))}onSubmit(){if(this.variantForm.valid){this.isSubmitting.set(!0);let r=this.selectedOptions().map(o=>o._id),a=b(_({},this.variantForm.getRawValue()),{options:r});console.log("Submitting variant with data:",{isEdit:this.data.isEdit,variantId:this.data.variant?._id,formValue:a,selectedOptions:this.selectedOptions(),selectedOptionIds:r}),(this.data.isEdit?this.productService.updateVariant(a,this.data.variant._id):this.productService.createVariant(a)).subscribe({next:o=>{console.log("Variant saved successfully:",o),this.snackBar.open(`Variant ${this.data.isEdit?"updated":"created"} successfully`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dialogRef.close({success:!0,data:b(_({},o),{options:this.selectedOptions()})})},error:o=>{console.error("Error saving variant:",o),this.snackBar.open(`Error ${this.data.isEdit?"updating":"creating"} variant`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isSubmitting.set(!1)}})}}onCancel(){this.dialogRef.close()}static \u0275fac=function(a){return new(a||l)(h(Z),h(se),h(pe))};static \u0275cmp=I({type:l,selectors:[["app-variant-dialog"]],decls:65,vars:16,consts:[[1,"p-6"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter variant name"],[1,"grid","grid-cols-2","gap-4"],["matInput","","type","number","formControlName","atLeast","min","0"],["matInput","","type","number","formControlName","atMost","min","0"],[1,"bg-gray-50","rounded-lg","space-y-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-lg","font-medium"],[1,"text-xs","text-gray-500"],[1,"space-y-4",3,"formGroup"],["matInput","","formControlName","name","placeholder","e.g., Small, Medium, Large"],["matInput","","type","number","formControlName","price","min","0"],[1,"flex","items-center","justify-between"],["formControlName","inStock","color","primary"],["mat-stroked-button","","color","primary","type","button",3,"click","disabled"],[1,"mr-2"],[1,"mt-4","space-y-2"],[1,"flex","items-center","py-4","bg-gray-50","rounded-lg"],["formControlName","enabled","color","primary"],[1,"flex","justify-end","space-x-2","mt-6","pt-4","border-t","border-gray-200"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",1,"mr-2"],[1,"mt-4","p-2","bg-blue-50","rounded","text-xs","text-gray-600"],[1,"text-sm","font-medium","text-gray-700"],[1,"flex","items-center","justify-between","p-2","bg-white","rounded","border","border-gray-200"],[1,"font-medium"],[1,"ml-2","text-sm","text-gray-500"],["mat-icon-button","","color","warn",3,"click"]],template:function(a,e){if(a&1&&(i(0,"div",0)(1,"h2",1),n(2),t(),i(3,"form",2),v("ngSubmit",function(){return e.onSubmit()}),i(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),n(7,"Name"),t(),c(8,"input",5),s(9,he,2,0,"mat-error"),t(),i(10,"div",6)(11,"mat-form-field",4)(12,"mat-label"),n(13,"At Least"),t(),c(14,"input",7),s(15,Ce,2,0,"mat-error"),s(16,xe,2,0,"mat-error"),t(),i(17,"mat-form-field",4)(18,"mat-label"),n(19,"At Most"),t(),c(20,"input",8),s(21,Ee,2,0,"mat-error"),s(22,Me,2,0,"mat-error"),t()(),i(23,"div",9)(24,"div",10)(25,"h3",11),n(26,"Options"),t(),i(27,"span",12),n(28),t()(),i(29,"form",13)(30,"div",6)(31,"mat-form-field",4)(32,"mat-label"),n(33,"Option Name"),t(),c(34,"input",14),t(),i(35,"mat-form-field",4)(36,"mat-label"),n(37,"Price"),t(),c(38,"input",15),t()(),i(39,"div",16)(40,"mat-slide-toggle",17),n(41," In Stock "),t(),i(42,"a",18),v("click",function(){return e.addNewOption()}),i(43,"mat-icon",19),n(44,"add"),t(),n(45," Add Option "),t()()(),s(46,ye,5,0,"div",20),t(),i(47,"div",21)(48,"mat-slide-toggle",22),n(49," Published "),t()()(),i(50,"div",23)(51,"button",24),v("click",function(){return e.onCancel()}),n(52,"Cancel"),t(),i(53,"button",25),s(54,De,1,0,"mat-spinner",26),n(55),t()(),i(56,"div",27)(57,"div")(58,"strong"),n(59,"Selected Options Count:"),t(),n(60),t(),i(61,"div")(62,"strong"),n(63,"Option IDs:"),t(),n(64),t()()()()),a&2){let o,u,M,O,y;m(2),f(" ",e.data.isEdit?"Edit Variant":"Create New Variant"," "),m(),g("formGroup",e.variantForm),m(6),p((o=e.variantForm.get("name"))!=null&&o.hasError("required")?9:-1),m(6),p((u=e.variantForm.get("atLeast"))!=null&&u.hasError("required")?15:-1),m(),p((M=e.variantForm.get("atLeast"))!=null&&M.hasError("min")?16:-1),m(5),p((O=e.variantForm.get("atMost"))!=null&&O.hasError("required")?21:-1),m(),p((y=e.variantForm.get("atMost"))!=null&&y.hasError("min")?22:-1),m(6),f("",e.selectedOptions().length," selected"),m(),g("formGroup",e.newOptionForm),m(13),g("disabled",!e.newOptionForm.valid),m(4),p(e.selectedOptions().length>0?46:-1),m(7),g("disabled",!e.variantForm.valid||e.isSubmitting()),m(),p(e.isSubmitting()?54:-1),m(),f(" ",e.data.isEdit?"Update":"Create"," "),m(5),f(" ",e.selectedOptions().length),m(4),f(" ",e.selectedOptionIds().join(", ")||"None")}},dependencies:[A,ue,ce,j,P,G,oe,ne,te,ie,ae,re,z,$,ee,K,U,Q,H,J,Y,X,W,ve,ge,me,le,de,_e,q],encapsulation:2})};export{be as a};
