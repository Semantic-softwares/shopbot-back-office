import{a as We,b as te}from"./chunk-3G4LSAIG.js";import{a as ze}from"./chunk-Z73K3IEL.js";import{a as Le}from"./chunk-BADSAPV5.js";import{a as Ge}from"./chunk-VHL4W3XE.js";import"./chunk-25J5LEO4.js";import"./chunk-LLLAI5OH.js";import"./chunk-46P5YEBT.js";import"./chunk-A2P3GH4G.js";import"./chunk-J7O4JBGR.js";import"./chunk-HFTRPIKU.js";import"./chunk-SDXYS6W7.js";import"./chunk-6KQFCX5X.js";import{a as fe,b as be}from"./chunk-KVX2H4A7.js";import"./chunk-GYNGZAKB.js";import{a as Ae,b as Be,c as He}from"./chunk-DX5KEI4P.js";import{a as Ee,b as Pe,c as Fe,e as Oe,f as Ve,g as $e,h as q}from"./chunk-BTSYCNWJ.js";import{c as De,f as xe,g as Se,i as we,l as Ce}from"./chunk-HUKPPBNE.js";import{a as _e,b as ye}from"./chunk-WRXDGLET.js";import{a as Ne}from"./chunk-QGGN4OMJ.js";import{a as Ie}from"./chunk-IG3JOGNL.js";import{a as Me,b as Re,c as ke,d as Te}from"./chunk-BPPWALS2.js";import"./chunk-JXNS4S7R.js";import{d as U}from"./chunk-2WBLSBPP.js";import"./chunk-XVOW2NM6.js";import{a as Y}from"./chunk-GIZLGNET.js";import"./chunk-NXTZK4C5.js";import"./chunk-J3TXHOEY.js";import"./chunk-YLKT6R4Z.js";import"./chunk-2UT4NYMV.js";import"./chunk-S2P5547C.js";import{a as he,b as j}from"./chunk-J5JAEWDO.js";import"./chunk-AGG277FR.js";import"./chunk-7KULNFHZ.js";import"./chunk-5M2ITBTB.js";import{Y as z,Z as Q}from"./chunk-D3B3XJ53.js";import"./chunk-RDMIWI4X.js";import"./chunk-AGZJ637K.js";import{a as L,c as W,d as ve}from"./chunk-LTDPQFG4.js";import"./chunk-VYX7HJYX.js";import{i as ce,m as ue,n as pe,q as ge,r as G}from"./chunk-FORATDN3.js";import{Cb as ae,Cc as de,Eb as B,Fb as H,Gb as X,Hb as Z,Hc as w,Ib as R,Ic as $,Jb as k,Jc as P,Kb as T,Lb as o,Mb as s,Nb as I,Pc as p,Rb as se,Sb as le,Ub as O,Ya as re,Yb as f,Za as m,_b as v,ca as x,ha as _,ia as y,ic as ee,jc as V,kc as me,mb as A,nc as a,oc as g,pc as N,ta as E}from"./chunk-53XJD7JZ.js";import{a as ne,b as oe}from"./chunk-EQDQRRRY.js";var Xe=d=>["/menu","hms","front-desk","reservations","edit",d],J=class d{dialogRef=x(Ee);data=x(Pe);guestService=x(ze);storeStore=x(Y);router=x(W);route=x(L);reservation=E(this.data.reservation);roomAssignment=p(()=>{let e=this.reservation()?.rooms||[];return this.data.room?.id&&e.find(i=>i?.room?._id===this.data.room?.id)||e[0]});assignedGuest=p(()=>this.roomAssignment()?.assignedGuest||this.reservation()?.guest);guestName=p(()=>{let e=this.assignedGuest();return this.guestService.getGuestName(e)});openReservation(){this.close(),this.router.navigate(["../../../edit",this.reservation()?._id],{relativeTo:this.route})}roomCheckIn=p(()=>this.roomAssignment()?.stayPeriod?.from||this.reservation()?.checkInDate);roomCheckOut=p(()=>this.roomAssignment()?.stayPeriod?.to||this.reservation()?.checkOutDate);roomTypeName=p(()=>{let i=this.roomAssignment()?.room?.roomType;return typeof i=="object"&&i?.name?i.name:"\u2014"});roomNumber=p(()=>this.roomAssignment()?.room?.roomNumber||"\u2014");roomName=p(()=>this.roomAssignment()?.room?.name||"\u2014");roomGuestsCount=p(()=>{let i=this.roomAssignment()?.guests||{},t=Number(i.adults||0),n=Number(i.children||0);return t+n||1});roomTotal=p(()=>this.roomAssignment()?.pricing?.total||0);amountPaid=p(()=>this.reservation()?.pricing?.paid||0);balanceAmount=p(()=>Math.max(0,this.roomTotal()-this.amountPaid()));bookingTotal=p(()=>this.reservation()?.pricing?.total||0);bookingSource=p(()=>this.reservation()?.bookingSource||"\u2014");reservationType=p(()=>this.reservation()?.bookingType||this.reservation()?.reservationType||"\u2014");confirmationNumber=p(()=>this.reservation()?.confirmationNumber||this.reservation()?._id||"\u2014");paymentMethod=p(()=>this.reservation()?.paymentInfo?.method||"\u2014");close(){this.dialogRef.close()}statusLabel=p(()=>(this.reservation()?.status||"reserved").replace("_"," "));statusClass=p(()=>{let e=this.reservation()?.status||"reserved";return{pending:"bg-yellow-100 text-yellow-800 border border-yellow-200",confirmed:"bg-blue-100 text-blue-800 border border-blue-200",checked_in:"bg-green-100 text-green-800 border border-green-200",checked_out:"bg-gray-100 text-gray-800 border border-gray-200",cancelled:"bg-red-100 text-red-800 border border-red-200",no_show:"bg-orange-100 text-orange-800 border border-orange-200",reserved:"bg-indigo-100 text-indigo-800 border border-indigo-200"}[e]||"bg-gray-100 text-gray-800 border border-gray-200"});static \u0275fac=function(i){return new(i||d)};static \u0275cmp=A({type:d,selectors:[["app-reservation-preview-dialog"]],decls:76,vars:36,consts:[["mat-dialog-title","",1,"flex","items-center","justify-between"],["color","primary",1,"capitalize"],[1,"capitalize"],["mat-subheader",""],["matListItemMeta",""],["matListItemMeta","",1,"capitalize"],["matListItemMeta","",1,"font-semibold"],["align","end",1,"gap-2"],["matButton","outlined",3,"click","routerLink"],["matButton","outlined",3,"click"]],template:function(i,t){if(i&1&&(o(0,"h2",0),a(1),s(),o(2,"mat-dialog-content")(3,"mat-chip-set")(4,"mat-chip",1),a(5),s(),o(6,"mat-chip",2),a(7),s(),o(8,"mat-chip"),a(9),s()(),o(10,"mat-list")(11,"div",3),a(12,"Stay"),s(),o(13,"mat-list-item"),a(14," Check-in "),o(15,"span",4),a(16),w(17,"date"),s()(),o(18,"mat-list-item"),a(19," Check-out "),o(20,"span",4),a(21),w(22,"date"),s()(),o(23,"mat-list-item"),a(24," Source "),o(25,"span",5),a(26),s()()(),I(27,"mat-divider"),o(28,"mat-list")(29,"div",3),a(30,"Room"),s(),o(31,"mat-list-item"),a(32," Room Type "),o(33,"span",4),a(34),s()(),o(35,"mat-list-item"),a(36," Room Number "),o(37,"span",4),a(38),s()(),o(39,"mat-list-item"),a(40," Room Name "),o(41,"span",4),a(42),s()()(),I(43,"mat-divider"),o(44,"mat-list")(45,"div",3),a(46,"Payment"),s(),o(47,"mat-list-item"),a(48," Payment Mode "),o(49,"span",5),a(50),s()(),o(51,"mat-list-item"),a(52," Total "),o(53,"span",4),a(54),w(55,"currency"),s()(),o(56,"mat-list-item"),a(57," Amount Paid "),o(58,"span",4),a(59),w(60,"currency"),s()(),o(61,"mat-list-item"),a(62," Balance "),o(63,"span",4),a(64),w(65,"currency"),s()(),o(66,"mat-list-item"),a(67," Booking Total "),o(68,"span",6),a(69),w(70,"currency"),s()()()(),o(71,"mat-dialog-actions",7)(72,"a",8),f("click",function(){return t.close()}),a(73,"View"),s(),o(74,"button",9),f("click",function(){return t.close()}),a(75,"Close"),s()()),i&2){let n,r,l,u;m(),N(" ",t.guestName(),`
`),m(4),g(t.statusLabel()),m(2),g(t.reservationType()),m(2),g(t.confirmationNumber()),m(7),g(P(17,16,t.roomCheckIn(),"dd/MM/yyyy")),m(5),g(P(22,19,t.roomCheckOut(),"dd/MM/yyyy")),m(5),g(t.bookingSource()),m(8),g(t.roomTypeName()),m(4),g(t.roomNumber()),m(4),g(t.roomName()),m(8),g(t.paymentMethod()),m(4),g(P(55,22,t.roomTotal(),(n=t.storeStore.selectedStore())==null?null:n.currency)),m(5),g(P(60,25,t.amountPaid(),(r=t.storeStore.selectedStore())==null?null:r.currency)),m(5),g(P(65,28,t.balanceAmount(),(l=t.storeStore.selectedStore())==null?null:l.currency)),m(5),g(P(70,31,t.bookingTotal(),(u=t.storeStore.selectedStore())==null?null:u.currency)),m(3),T("routerLink",de(34,Xe,t.reservation()._id))}},dependencies:[G,q,Oe,$e,Ve,j,Q,z,ye,_e,He,Ae,Be,Ce,xe,Se,we,De,ve,ge,pe],encapsulation:2})};var ie=(d,e)=>e.key;function Ze(d,e){if(d&1){let i=O();o(0,"button",20),f("click",function(){let n=_(i).$implicit,r=v();return y(r.onStatusChange(n))}),a(1),w(2,"titlecase"),s()}if(d&2){let i=e.$implicit;m(),g($(2,1,i))}}function et(d,e){d&1&&(o(0,"div",26),I(1,"mat-progress-spinner",35),s())}function tt(d,e){if(d&1&&(o(0,"div",31),I(1,"span",36),o(2,"span",37),a(3),w(4,"titlecase"),s()()),d&2){let i=e.$implicit,t=v();m(),T("ngClass",t.getStatusColorClass(i)),m(2),g($(4,2,i))}}function it(d,e){if(d&1&&(o(0,"th",38)(1,"p",39),a(2),s(),o(3,"p",40),a(4),s()()),d&2){let i=e.$implicit,t=v();V("width",t.cellWidthPx(),"px"),m(2),g(i.dayName),m(2),g(i.day)}}function nt(d,e){if(d&1&&I(0,"td",45),d&2){let i=v(3);V("width",i.cellWidthPx(),"px")}}function ot(d,e){if(d&1&&(o(0,"tr")(1,"td",42)(2,"span",43),a(3),s()(),R(4,nt,1,2,"td",44,ie),s()),d&2){let i=v().$implicit,t=v();m(3),g(i.roomTypeName),m(),k(t.dateRange())}}function rt(d,e){if(d&1){let i=O();o(0,"div",50),f("click",function(n){_(i);let r=v().$implicit,l=v(3).$implicit;return v().openReservationPreview(r.reservation,l),y(n.stopPropagation())})("mousedown",function(n){return _(i),y(n.stopPropagation())}),o(1,"div",51),a(2),s()()}if(d&2){let i=v().$implicit,t=v().$implicit,n=v(2).$implicit,r=v();V("top",r.getReservationTopPercent(n.reservations,t,i),"%")("height",r.getReservationHeightPercent(n.reservations,t),"%")("width",r.getReservationWidth(i,t),"px"),T("ngClass",r.getReservationStyle(i))("matTooltip",r.getReservationTooltip(i,n.roomName)),m(2),N("",r.getReservationBlockLabel(i)," ")}}function at(d,e){if(d&1&&B(0,rt,3,9,"div",49),d&2){let i=e.$implicit,t=v().$implicit,n=v(3);H(n.isReservationStartingOnDate(i,t)?0:-1)}}function st(d,e){if(d&1){let i=O();o(0,"td",48),f("mousedown",function(n){let r=_(i).$implicit,l=v(2).$implicit,u=v();return y(u.onCellMouseDown(n,r,l))})("mouseenter",function(){let n=_(i).$implicit,r=v(2).$implicit,l=v();return y(l.onCellMouseEnter(n,r))})("mouseup",function(){_(i);let n=v(3);return y(n.onCellMouseUp())}),R(1,at,1,1,null,null,X),s()}if(d&2){let i=e.$implicit,t=v(2).$implicit,n=v();V("width",n.cellWidthPx(),"px"),me("bg-blue-100",n.isCellInSelection(i,t)&&!n.dragSelection().hasConflict)("bg-red-100",n.isCellInSelection(i,t)&&n.dragSelection().hasConflict)("cursor-pointer",!n.hasReservationOnDate(t.roomId,i.date))("cursor-not-allowed",n.hasReservationOnDate(t.roomId,i.date)),m(),k(t.reservations)}}function lt(d,e){if(d&1&&(o(0,"tr",41)(1,"td",46),a(2),s(),R(3,st,3,10,"td",47,ie),s()),d&2){let i=v().$implicit,t=v();m(2),N(" ",i.roomName," "),m(),k(t.dateRange())}}function mt(d,e){if(d&1&&B(0,ot,6,1,"tr")(1,lt,5,1,"tr",41),d&2){let i=e.$implicit;H(i.isGroup?0:1)}}var Qe=class d{storeStore=x(Y);reservationService=x(Le);roomService=x(Ge);router=x(W);route=x(L);dialog=x(Fe);viewMode=E("monthly");startDate=E(new Date);selectedStatus=E("all");dragSelection=E({isSelecting:!1,startDate:null,endDate:null,roomId:null,roomName:null,roomTypeId:null,roomTypeName:null,hasConflict:!1});reservationStatuses=["pending","confirmed","checked_in","checked_out","cancelled","no_show","reserved"];statusColorMap={pending:"bg-yellow-500",confirmed:"bg-blue-600",checked_in:"bg-green-600",checked_out:"bg-gray-500",cancelled:"bg-red-600",no_show:"bg-orange-600",reserved:"bg-indigo-600"};dateRange=p(()=>{let e=[],i=this.viewMode(),t=this.alignStartOfPeriod(this.startDate(),i);if(i==="weekly")for(let n=0;n<7;n++){let r=new Date(t);r.setDate(r.getDate()+n),e.push({key:r.toISOString().slice(0,10),day:r.getDate(),dayName:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][r.getDay()],date:new Date(r)})}else{let n=t.getFullYear(),r=t.getMonth(),l=new Date(n,r+1,0).getDate();for(let u=0;u<l;u++){let h=new Date(n,r,u+1);e.push({key:h.toISOString().slice(0,10),day:h.getDate(),dayName:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][h.getDay()],date:new Date(h)})}}return e});rooms=U({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.roomService.getRooms(e.storeId)});reservations=U({params:()=>{let e=this.storeStore.selectedStore()?._id,i=this.viewMode(),t=this.alignStartOfPeriod(this.startDate(),i),{dateFrom:n,dateTo:r}=this.getPeriodDateRangeStrings(t,i),l=this.selectedStatus();return{storeId:e,dateFrom:n,dateTo:r,status:l==="all"?void 0:l}},stream:({params:e})=>this.reservationService.getReservations({storeId:e.storeId,dateFrom:e.dateFrom,dateTo:e.dateTo,status:e.status})});roomTypes=U({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.roomService.getRoomTypes(e.storeId)});roomsWithReservations=p(()=>{let e=this.rooms.value()||[],i=this.roomTypes.value()||[],t=this.reservations.value(),n=Array.isArray(t)?t:t?.reservations||[],r=new Map;for(let c of i)c&&c._id&&r.set(c._id,c.name||"Room");let l=new Map;for(let c of e){let S,b="Room";typeof c.roomType=="string"?(S=c.roomType,b=r.get(c.roomType)||c.roomType):c.roomType&&(S=c.roomType._id,b=c.roomType.name||"Room");let M=S||b;l.has(M)||l.set(M,{typeName:b,rooms:[]}),l.get(M).rooms.push(c)}let u=[];for(let c of i)c&&c._id&&l.has(c._id)&&u.push(c._id);for(let c of l.keys())u.includes(c)||u.push(c);let h=[];for(let c of u){let S=l.get(c);if(S){h.push({isGroup:!0,roomTypeName:S.typeName});for(let b of S.rooms){let M=[];for(let D of n){if(!D?.rooms)continue;let K=D.rooms.filter(C=>C?.room?._id===b._id);if(K?.length)for(let C of K){let F=C?.stayPeriod?.from||D.checkInDate,je=C?.stayPeriod?.to||D.checkOutDate,Ye=C?.assignedGuest||D.guest;M.push({reservationId:D._id,roomAssignmentId:C?._id,checkInDate:F,checkOutDate:je,guest:Ye,status:D.status,bookingType:D.bookingType,confirmationNumber:D.confirmationNumber,reservation:D})}}h.push({isGroup:!1,roomId:b._id,roomName:`${b.name} ${b.roomNumber??""}`,roomTypeId:typeof b.roomType=="string"?b.roomType:b.roomType?._id,roomTypeName:S.typeName,capacity:b.capacity||2,reservations:M})}}}return h});confirmedCount=p(()=>this.reservations.value()?.reservations.filter(e=>e.status==="confirmed").length);checkedInCount=p(()=>this.reservations.value()?.reservations.filter(e=>e.status==="checked_in").length);pendingCount=p(()=>this.reservations.value()?.reservations.filter(e=>e.status==="pending").length);cancelledCount=p(()=>this.reservations.value()?.reservations.filter(e=>e.status==="cancelled").length);totalRevenue=p(()=>this.reservations.value()?.reservations.reduce((e,i)=>e+this.getEffectiveTotal(i),0));getEffectiveTotal(e){return e.pricing?.total||0}ngOnInit(){let e=new Date,i=new Date(e.getFullYear(),e.getMonth(),1);this.startDate.set(i)}reloadData(){this.reservations.reload()}clearFilters(){this.viewMode.set("monthly"),this.selectedStatus.set("all");let e=new Date,i=new Date(e.getFullYear(),e.getMonth(),1);this.startDate.set(i)}createReservation(){this.dialog.open(te,{width:"600px",disableClose:!1}).afterClosed().subscribe(i=>{i&&this.router.navigate(["../create"],{relativeTo:this.route.parent,queryParams:{quickReservation:JSON.stringify(i)}})})}getPeriodLabel(){let e=this.viewMode(),i=this.alignStartOfPeriod(this.startDate(),e),t=new Date(i);e==="weekly"?t.setDate(t.getDate()+6):(t=new Date(i.getFullYear(),i.getMonth()+1,0),t.setHours(0,0,0,0));let n=new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric"});return`${n.format(i)} \u2013 ${n.format(t)}`}isReservationOnDate(e,i){let t=new Date(e.checkInDate),n=new Date(e.checkOutDate);t.setHours(0,0,0,0),n.setHours(0,0,0,0);let r=new Date(i.date);return r.setHours(0,0,0,0),r>=t&&r<n}isReservationStartingOnDate(e,i){let t=new Date(e.checkInDate);t.setHours(0,0,0,0);let n=new Date(i.date);return n.setHours(0,0,0,0),n.getTime()===t.getTime()}getReservationWidth(e,i){let t=new Date(e.checkInDate),n=new Date(e.checkOutDate),r=this.cellWidthPx(),l=this.cellGapPx();t.setHours(0,0,0,0),n.setHours(0,0,0,0);let u=new Date(i.date);if(u.setHours(0,0,0,0),u<t)return 0;let h=u>t?u:t,c=this.dateRange(),S=n;if(Array.isArray(c)&&c.length>0){let C=new Date(c[c.length-1].date);C.setHours(0,0,0,0);let F=new Date(C);F.setDate(F.getDate()+1),S=S<F?S:F}let b=1e3*60*60*24,M=(S.getTime()-h.getTime())/b,D=Math.max(0,Math.ceil(M));return D<=0?0:D*r+(D-1)*l}getReservationStyle(e){let i=e?.status||"reserved";return this.statusColorMap[i]||"bg-gray-500"}getStatusColorClass(e){return this.statusColorMap[e]||"bg-gray-500"}previousWeek(){let e=this.viewMode(),i=new Date(this.startDate());e==="weekly"?i.setDate(i.getDate()-7):i.setMonth(i.getMonth()-1),this.startDate.set(this.alignStartOfPeriod(i,e))}nextWeek(){let e=this.viewMode(),i=new Date(this.startDate());e==="weekly"?i.setDate(i.getDate()+7):i.setMonth(i.getMonth()+1),this.startDate.set(this.alignStartOfPeriod(i,e))}goToToday(){let e=new Date;this.startDate.set(this.alignStartOfPeriod(e,this.viewMode()))}onViewModeChange(e){this.viewMode.set(e),this.goToToday()}onStatusChange(e){this.selectedStatus.set(e)}alignStartOfPeriod(e,i){let t=new Date(e);return i==="weekly"?(t.setHours(0,0,0,0),t):new Date(t.getFullYear(),t.getMonth(),1)}getPeriodDateRangeStrings(e,i){let t=new Date(e);t.setHours(0,0,0,0);let n=new Date(t);i==="weekly"?n.setDate(n.getDate()+6):(n=new Date(t.getFullYear(),t.getMonth()+1,0),n.setHours(0,0,0,0));let r=t.toISOString().split("T")[0],l=n.toISOString().split("T")[0];return{dateFrom:r,dateTo:l}}getReservationTooltip(e,i){let t=e.guest?.firstName&&e.guest?.lastName?`${e.guest.firstName} ${e.guest.lastName}`:e.guestName||"Guest",n=i||"Room",r=new Date(e.checkInDate),l=new Date(e.checkOutDate),u={year:"numeric",month:"short",day:"2-digit"},h=r.toLocaleDateString(void 0,u),c=l.toLocaleDateString(void 0,u);return`${n} | ${t} | Check-in: ${h} | Check-out: ${c}`}cellWidthPx(){return this.viewMode()==="weekly"?160:80}cellGapPx(){return this.viewMode()==="weekly"?4:2}getCellReservationsCount(e,i){return(e||[]).filter(t=>this.isReservationStartingOnDate(t,i)).length}getCellStackIndex(e,i,t){let r=(e||[]).filter(l=>this.isReservationStartingOnDate(l,i)).findIndex(l=>l===t||l.roomAssignmentId&&t.roomAssignmentId&&l.roomAssignmentId===t.roomAssignmentId||l.reservationId&&t.reservationId&&l.reservationId===t.reservationId);return r>=0?r:0}getReservationTopPercent(e,i,t){let n=this.getCellReservationsCount(e,i);return n<=1?0:this.getCellStackIndex(e,i,t)*(100/n)}getReservationHeightPercent(e,i){return 100/(this.getCellReservationsCount(e,i)||1)}isGroupReservation(e){if(!e)return!1;let i=e;return i.reservationType==="group"||i.bookingType==="group"||i.groupReservation===!0||i.guest?.type==="group"||i.guest?.guestType==="group"||!!i.guest?.companyName}getReservationBlockLabel(e){let i=e?.guest||{},t=`${i.firstName||""} ${i.lastName||""}`.trim()||"Guest";return`${this.isGroupReservation(e)?"(G)":""} ${t}`}openReservationPreview(e,i){e&&this.dialog.open(J,{width:"700px",data:{reservation:e,room:{name:i?.roomName,id:i?.roomId}}})}hasReservationOnDate(e,i){let n=this.roomsWithReservations().find(l=>!l.isGroup&&l.roomId===e);if(!n||!n.reservations)return!1;let r=new Date(i);return r.setHours(0,0,0,0),n.reservations.some(l=>{let u=new Date(l.checkInDate),h=new Date(l.checkOutDate);return u.setHours(0,0,0,0),h.setHours(0,0,0,0),r>=u&&r<h})}hasConflictInRange(e,i,t){let n=new Date(Math.min(i.getTime(),t.getTime())),r=new Date(Math.max(i.getTime(),t.getTime()));n.setHours(0,0,0,0),r.setHours(0,0,0,0);let l=new Date(n);for(;l<=r;){if(this.hasReservationOnDate(e,l))return!0;l.setDate(l.getDate()+1)}return!1}onCellMouseDown(e,i,t){if(t.isGroup)return;e.preventDefault();let n=new Date(i.date),r=new Date(i.date);r.setDate(r.getDate()+1);let l=this.hasReservationOnDate(t.roomId,n)||this.hasReservationOnDate(t.roomId,r);this.dragSelection.set({isSelecting:!0,startDate:new Date(i.date),endDate:new Date(i.date),roomId:t.roomId,roomName:t.roomName,roomTypeId:t.roomTypeId||null,roomTypeName:t.roomTypeName||null,hasConflict:l})}onCellMouseEnter(e,i){let t=this.dragSelection();if(!t.isSelecting||i.roomId!==t.roomId)return;let n=new Date(e.date),r=this.hasConflictInRange(t.roomId,t.startDate,n);this.dragSelection.update(l=>oe(ne({},l),{endDate:n,hasConflict:r}))}onCellMouseUp(){let e=this.dragSelection();if(e.isSelecting){if(!e.hasConflict&&e.startDate&&e.endDate&&e.roomId){let i=new Date(Math.min(e.startDate.getTime(),e.endDate.getTime())),t=new Date(Math.max(e.startDate.getTime(),e.endDate.getTime())),n=new Date(t);i.getTime()===t.getTime()&&n.setDate(n.getDate()+1),console.log("Check-in:",i,"Check-out:",n),this.openQuickReservationWithDates(i,n,e.roomId,e.roomName,e.roomTypeId,e.roomTypeName)}this.resetDragSelection()}}resetDragSelection(){this.dragSelection.set({isSelecting:!1,startDate:null,endDate:null,roomId:null,roomName:null,roomTypeId:null,roomTypeName:null,hasConflict:!1})}isCellInSelection(e,i){let t=this.dragSelection();if(!t.isSelecting||!t.startDate||!t.endDate||i.isGroup||i.roomId!==t.roomId)return!1;let n=new Date(e.date);n.setHours(0,0,0,0);let r=new Date(Math.min(t.startDate.getTime(),t.endDate.getTime())),l=new Date(Math.max(t.startDate.getTime(),t.endDate.getTime()));return r.setHours(0,0,0,0),l.setHours(0,0,0,0),r.getTime()===l.getTime()&&(l=new Date(l),l.setDate(l.getDate()+1)),n>=r&&n<=l}openQuickReservationWithDates(e,i,t,n,r,l){let u={checkInDate:e,checkOutDate:i,preselectedRoomId:t,preselectedRoomName:n??void 0,preselectedRoomTypeId:r??void 0,preselectedRoomTypeName:l??void 0};this.dialog.open(te,{width:"600px",data:u}).afterClosed().subscribe(c=>{c&&c&&this.router.navigate(["../create"],{relativeTo:this.route.parent,queryParams:{quickReservation:JSON.stringify(c)}})})}onDocumentMouseUp(){this.dragSelection().isSelecting&&this.onCellMouseUp()}static \u0275fac=function(i){return new(i||d)};static \u0275cmp=A({type:d,selectors:[["app-reservations-calendar"]],hostBindings:function(i,t){i&1&&f("mouseup",function(){return t.onDocumentMouseUp()},re)},decls:108,vars:17,consts:[["viewMenu","matMenu"],["statusMenu","matMenu"],["title","Reservations","subtitle","Manage hotel reservations and guest bookings","viewToggleRoute","/menu/hms/front-desk/reservations/view",3,"showViewToggle"],["actions",""],["matButton","outlined",3,"click"],[1,"mr-1"],["matButton","filled",3,"click"],[1,"min-h-screen","flex","flex-col"],[1,"border-b","border-gray-200","py-4"],[1,"flex","justify-between","items-center"],[1,"flex","flex-wrap","gap-4","mt-2"],[1,"flex","items-center","gap-2","text-sm","text-gray-600"],[1,"text-base"],[1,"text-base","text-green-600"],[1,"text-base","text-purple-600"],[1,"text-base","text-orange-600"],[1,"text-base","text-red-600"],[1,"flex","gap-3","items-center"],["mat-stroked-button","",3,"matMenuTriggerFor"],[1,"ml-1"],["mat-menu-item","",3,"click"],["mat-menu-item",""],["matButton","tonal",3,"click"],["matButton","","color","warn"],[1,"flex-1","overflow-hidden","flex","flex-col","min-h-96"],[1,"overflow-auto","flex-1","relative","min-h-80"],[1,"absolute","inset-0","z-50","flex","items-center","justify-center","bg-white/60"],[1,"w-full","border-collapse","overflow-hidden"],[1,"sticky","left-0","z-10","w-48","border","border-gray-200","bg-white"],[1,"border","border-gray-200","bg-white","px-4","py-2"],[1,"flex","flex-wrap","items-center","gap-4"],[1,"flex","items-center","gap-2"],[1,"sticky","left-0","top-0","z-30","w-48","bg-white","border","border-gray-200","text-center"],[1,"text-xs","font-semibold","text-gray-700","uppercase"],[1,"sticky","top-0","z-20","bg-white","border","border-gray-200","text-center",3,"width"],["diameter","40","mode","indeterminate"],[1,"inline-block","w-3","h-3","rounded-sm",3,"ngClass"],[1,"text-xs","text-gray-700"],[1,"sticky","top-0","z-20","bg-white","border","border-gray-200","text-center"],[1,"text-xs","font-semibold","text-gray-600"],[1,"text-sm","font-bold","text-gray-900"],[1,"h-12"],[1,"sticky","left-0","z-10","w-48","border","border-gray-200","px-4","py-2","text-left","bg-gray-100"],[1,"text-xs","font-semibold","text-gray-800"],[1,"border","border-gray-200","bg-gray-100",3,"width"],[1,"border","border-gray-200","bg-gray-100"],[1,"sticky","left-0","z-10","w-48","border","border-gray-200","px-4","bg-gray-50","text-xs"],[1,"border","border-gray-200","relative","overflow-visible","select-none",3,"bg-blue-100","bg-red-100","cursor-pointer","cursor-not-allowed","width"],[1,"border","border-gray-200","relative","overflow-visible","select-none",3,"mousedown","mouseenter","mouseup"],["matTooltipPosition","above",1,"absolute","left-0.5","right-0.5","border","flex","items-center","text-white","text-xs","font-semibold","overflow-hidden","z-10","cursor-pointer",3,"ngClass","top","height","width","matTooltip"],["matTooltipPosition","above",1,"absolute","left-0.5","right-0.5","border","flex","items-center","text-white","text-xs","font-semibold","overflow-hidden","z-10","cursor-pointer",3,"click","mousedown","ngClass","matTooltip"],[1,"truncate","px-1"]],template:function(i,t){if(i&1){let n=O();o(0,"app-page-header",2),se(1,3),o(2,"button",4),f("click",function(){return _(n),y(t.clearFilters())}),o(3,"mat-icon"),a(4,"clear"),s(),a(5," Clear Filters "),s(),o(6,"button",4),f("click",function(){return _(n),y(t.reloadData())}),o(7,"mat-icon",5),a(8,"redo"),s(),a(9," Reload "),s(),o(10,"button",6),f("click",function(){return _(n),y(t.createReservation())}),o(11,"mat-icon",5),a(12,"add"),s(),a(13," Create Reservation "),s(),le(),s(),o(14,"div",7)(15,"div",8)(16,"div",9)(17,"div")(18,"div",10)(19,"div",11)(20,"mat-icon",12),a(21,"hotel"),s(),o(22,"span"),a(23,"Total: "),o(24,"strong"),a(25),s()()(),o(26,"div",11)(27,"mat-icon",13),a(28,"check_circle"),s(),o(29,"span"),a(30,"Confirmed: "),o(31,"strong"),a(32),s()()(),o(33,"div",11)(34,"mat-icon",14),a(35,"person"),s(),o(36,"span"),a(37,"Checked In: "),o(38,"strong"),a(39),s()()(),o(40,"div",11)(41,"mat-icon",15),a(42,"schedule"),s(),o(43,"span"),a(44,"Pending: "),o(45,"strong"),a(46),s()()(),o(47,"div",11)(48,"mat-icon",16),a(49,"cancel"),s(),o(50,"span"),a(51,"Cancelled: "),o(52,"strong"),a(53),s()()()()(),o(54,"div",17)(55,"button",18),a(56),w(57,"titlecase"),o(58,"mat-icon",19),a(59,"expand_more"),s()(),o(60,"mat-menu",null,0)(62,"button",20),f("click",function(){return _(n),y(t.onViewModeChange("weekly"))}),a(63,"Weekly"),s(),o(64,"button",20),f("click",function(){return _(n),y(t.onViewModeChange("monthly"))}),a(65,"Monthly"),s()(),o(66,"button",18),a(67),w(68,"titlecase"),o(69,"mat-icon",19),a(70,"expand_more"),s()(),o(71,"mat-menu",null,1)(73,"button",20),f("click",function(){return _(n),y(t.onStatusChange("all"))}),a(74,"All"),s(),R(75,Ze,3,3,"button",21,Z),s(),o(77,"button",22),f("click",function(){return _(n),y(t.previousWeek())}),o(78,"mat-icon",5),a(79,"chevron_left"),s(),a(80," Previous "),s(),o(81,"button",23),a(82),s(),o(83,"button",22),f("click",function(){return _(n),y(t.nextWeek())}),a(84," Next "),o(85,"mat-icon",19),a(86,"chevron_right"),s()()()()(),o(87,"div",24)(88,"div",25),B(89,et,2,0,"div",26),o(90,"table",27)(91,"tfoot")(92,"tr"),I(93,"td",28),o(94,"td",29)(95,"div",30),R(96,tt,5,4,"div",31,Z),s()()()(),o(98,"thead")(99,"tr")(100,"th",32)(101,"span",33),a(102,"Rooms"),s()(),R(103,it,5,4,"th",34,ie),s()(),o(105,"tbody"),R(106,mt,2,1,null,null,X),s()()()()()}if(i&2){let n,r=ee(61),l=ee(72);T("showViewToggle",!0),m(25),g(((n=t.reservations.value())==null||n.reservations==null?null:n.reservations.length)||0),m(7),g(t.confirmedCount()||0),m(7),g(t.checkedInCount()||0),m(7),g(t.pendingCount()||0),m(7),g(t.cancelledCount()||0),m(2),T("matMenuTriggerFor",r),m(),N(" ",$(57,13,t.viewMode())," "),m(10),T("matMenuTriggerFor",l),m(),N(" Status: ",$(68,15,t.selectedStatus())," "),m(8),k(t.reservationStatuses),m(7),N(" ",t.getPeriodLabel()," "),m(7),H(t.reservations.isLoading()?89:-1),m(5),ae("colspan",t.dateRange().length),m(2),k(t.reservationStatuses),m(7),k(t.dateRange()),m(3),k(t.roomsWithReservations())}},dependencies:[G,ce,Q,z,j,he,Te,Re,Me,ke,be,fe,Ne,Ie,q,We,ue],encapsulation:2})};export{Qe as ReservationsCalendar};
