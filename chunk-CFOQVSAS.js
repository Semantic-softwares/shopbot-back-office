import{a as We}from"./chunk-RRQ5ZGRF.js";import{a as Qe}from"./chunk-G6HLSBRZ.js";import{a as $e,b as qe,c as Le,d as Oe,e as Ge,f as He,g as je,h as Ue,i as ze,j as Je,k as Ke}from"./chunk-YF6BVSFU.js";import{a as G}from"./chunk-T25PAPY7.js";import{a as Me,b as O}from"./chunk-P2VEYFPL.js";import{d as ee}from"./chunk-T75DEOG5.js";import{a as q,b as L}from"./chunk-KR7TMRYR.js";import{b as V,c as xe,d as he}from"./chunk-IKP7S2Y7.js";import{a as P,b as te}from"./chunk-7QB7BEGO.js";import{c as Be}from"./chunk-ZD2MQVCP.js";import{a as ke,b as Fe,c as Re,d as Ie,e as Ne,f as Pe,g as Ve,h as j}from"./chunk-ZOYXPNSX.js";import{a as ve,b as be}from"./chunk-P2NXASYZ.js";import{a as Ae}from"./chunk-A2NM27HC.js";import{a as Te}from"./chunk-ZXGSCOR2.js";import{a as Ee,b as ye,c as De,d as we}from"./chunk-CXPTKSLY.js";import{a as Se}from"./chunk-EUHZN2UI.js";import"./chunk-M5357V7P.js";import{d as H}from"./chunk-2WBLSBPP.js";import"./chunk-SY26FGZT.js";import"./chunk-XYJ5R6BC.js";import"./chunk-YEWYHM4L.js";import{a as fe,g as pe}from"./chunk-PZG5LZPC.js";import{a as ue,b as _e,e as ge,h as Ce}from"./chunk-GY37C2FD.js";import{C as se,D as de,E as ce,b as ne,d as M,g as ae,h as oe,m as re,s as le,t as me}from"./chunk-2UT4NYMV.js";import"./chunk-S2P5547C.js";import{a as B,b as $}from"./chunk-MNFAJ2ZP.js";import{a as ie}from"./chunk-56TSQ6HG.js";import"./chunk-AGG277FR.js";import"./chunk-N3VBTGB6.js";import"./chunk-4KLRET2M.js";import{X as R,Y as I,_ as N}from"./chunk-KSQJ4KAT.js";import"./chunk-RDMIWI4X.js";import"./chunk-AGZJ637K.js";import{d as Y,i as Z}from"./chunk-LTDPQFG4.js";import"./chunk-VYX7HJYX.js";import{r as X}from"./chunk-FORATDN3.js";import{Eb as d,Fb as c,Ib as K,Jb as Q,Kb as u,Lb as n,Mb as a,Nb as _,Rb as v,Sb as b,Ub as y,Yb as g,Za as l,_b as s,ca as p,ha as C,ia as x,ic as W,mb as F,mc as U,nc as o,oc as E,pc as h,sb as S,ta as k}from"./chunk-53XJD7JZ.js";import{a as z,b as J}from"./chunk-EQDQRRRY.js";var nt=(t,i)=>i._id;function at(t,i){t&1&&(n(0,"mat-error"),o(1,"Name is required"),a())}function ot(t,i){t&1&&(n(0,"mat-error"),o(1,"Email is required"),a())}function rt(t,i){t&1&&(n(0,"mat-error"),o(1,"Please enter a valid email"),a())}function lt(t,i){t&1&&(n(0,"mat-error"),o(1,"Phone number is required"),a())}function mt(t,i){t&1&&(n(0,"mat-error"),o(1,"Password is required"),a())}function st(t,i){t&1&&(n(0,"mat-error"),o(1,"Password must be at least 6 characters"),a())}function dt(t,i){if(t&1){let e=y();n(0,"mat-form-field",3)(1,"mat-label"),o(2,"Password"),a(),_(3,"input",18),n(4,"button",19),g("click",function(){C(e);let m=s();return x(m.hidePassword.set(!m.hidePassword()))}),n(5,"mat-icon"),o(6),a()(),d(7,mt,2,0,"mat-error"),d(8,st,2,0,"mat-error"),a()}if(t&2){let e,r,m=s();l(3),u("type",m.hidePassword()?"password":"text"),l(3),E(m.hidePassword()?"visibility_off":"visibility"),l(),c((e=m.staffForm.get("password"))!=null&&e.hasError("required")&&((e=m.staffForm.get("password"))!=null&&e.touched)?7:-1),l(),c((r=m.staffForm.get("password"))!=null&&r.hasError("minlength")&&((r=m.staffForm.get("password"))!=null&&r.touched)?8:-1)}}function ct(t,i){t&1&&(n(0,"mat-option",13),o(1,"Loading roles..."),a())}function ft(t,i){if(t&1&&(n(0,"mat-option",20)(1,"div",21)(2,"span"),o(3),a()()()),t&2){let e=i.$implicit;u("value",e._id),l(3),E(e.name)}}function pt(t,i){if(t&1&&K(0,ft,4,2,"mat-option",20,nt),t&2){let e=s();Q(e.rolesResource.value())}}function ut(t,i){t&1&&(n(0,"mat-error"),o(1,"Role is required"),a())}function _t(t,i){t&1&&_(0,"mat-spinner",17)}var D=class t{fb=p(se);rolesService=p(ie);userService=p(G);dialogRef=p(ke);snackBar=p(P);data=p(Fe);staffForm;saving=k(!1);hidePassword=k(!0);rolesResource=H({params:()=>({storeId:this.data.storeId}),stream:({params:i})=>this.rolesService.getAllRolesForStore(i.storeId)});isEditMode=k(!1);ngOnInit(){this.isEditMode.set(!!this.data.staff);let i=this.data.staff?.role?typeof this.data.staff.role=="string"?this.data.staff.role:this.data.staff.role._id:"";this.staffForm=this.fb.group({name:[this.data.staff?.name||"",M.required],email:[this.data.staff?.email||"",[M.required,M.email]],phoneNumber:[this.data.staff?.phoneNumber||"",M.required],gender:[this.data.staff?.gender||""],password:["",this.isEditMode()?[]:[M.required,M.minLength(6)]],role:[i,M.required]}),this.isEditMode()&&this.staffForm.removeControl("password")}getRoleIcon(i){let e=i.name.toLowerCase();return e.includes("admin")||e.includes("owner")?"admin_panel_settings":e.includes("manager")?"manage_accounts":e.includes("front desk")||e.includes("receptionist")?"support_agent":e.includes("housekeeper")||e.includes("housekeeping")?"cleaning_services":e.includes("accountant")||e.includes("finance")?"account_balance":"person"}saveStaff(){if(this.staffForm.invalid)return;this.saving.set(!0);let i=J(z({},this.staffForm.value),{stores:[this.data.storeId],pin:this.generatePin()});this.isEditMode()?this.userService.updateMerchant(this.data.staff._id,i).subscribe({next:e=>{this.saving.set(!1),this.snackBar.open("Staff member updated successfully!","Close",{duration:3e3}),this.dialogRef.close(e)},error:e=>{this.saving.set(!1),this.snackBar.open(e.error?.message||"Failed to update staff member","Close",{duration:5e3})}}):this.userService.createMerchant(i).subscribe({next:e=>{this.saving.set(!1),this.snackBar.open("Staff member created successfully!","Close",{duration:3e3}),this.dialogRef.close(e)},error:e=>{this.saving.set(!1),this.snackBar.open(e.error?.message||"Failed to create staff member","Close",{duration:5e3})}})}generatePin(){return Math.floor(1e3+Math.random()*9e3).toString()}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=F({type:t,selectors:[["app-staff-dialog"]],decls:54,vars:13,consts:[["mat-dialog-title","",1,"!m-0","!p-6","!pb-4"],[1,"!px-6","!py-0"],[1,"flex","flex-col","gap-4",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter full name"],["matSuffix",""],["matInput","","formControlName","email","type","email","placeholder","Enter email address"],["matInput","","formControlName","phoneNumber","placeholder","Enter phone number"],["formControlName","gender"],["value","male"],["value","female"],["value","other"],["formControlName","role"],["disabled",""],["align","end",1,"!px-6","!py-4"],["mat-button","","mat-dialog-close","",3,"disabled"],["mat-flat-button","","color","primary",3,"click","disabled"],["diameter","20",1,"inline-block","mr-2"],["matInput","","formControlName","password","placeholder","Enter password",3,"type"],["mat-icon-button","","matSuffix","","type","button",3,"click"],[3,"value"],[1,"flex","items-center","gap-2"]],template:function(e,r){if(e&1&&(n(0,"h2",0),o(1),a(),n(2,"mat-dialog-content",1)(3,"form",2)(4,"mat-form-field",3)(5,"mat-label"),o(6,"Full Name"),a(),_(7,"input",4),n(8,"mat-icon",5),o(9,"person"),a(),d(10,at,2,0,"mat-error"),a(),n(11,"mat-form-field",3)(12,"mat-label"),o(13,"Email Address"),a(),_(14,"input",6),n(15,"mat-icon",5),o(16,"email"),a(),d(17,ot,2,0,"mat-error"),d(18,rt,2,0,"mat-error"),a(),n(19,"mat-form-field",3)(20,"mat-label"),o(21,"Phone Number"),a(),_(22,"input",7),n(23,"mat-icon",5),o(24,"phone"),a(),d(25,lt,2,0,"mat-error"),a(),n(26,"mat-form-field",3)(27,"mat-label"),o(28,"Gender"),a(),n(29,"mat-select",8)(30,"mat-option",9),o(31,"Male"),a(),n(32,"mat-option",10),o(33,"Female"),a(),n(34,"mat-option",11),o(35,"Other"),a()(),n(36,"mat-icon",5),o(37,"wc"),a()(),d(38,dt,9,4,"mat-form-field",3),n(39,"mat-form-field",3)(40,"mat-label"),o(41,"Role"),a(),n(42,"mat-select",12),d(43,ct,2,0,"mat-option",13)(44,pt,2,0),a(),n(45,"mat-icon",5),o(46,"admin_panel_settings"),a(),d(47,ut,2,0,"mat-error"),a()()(),n(48,"mat-dialog-actions",14)(49,"button",15),o(50,"Cancel"),a(),n(51,"button",16),g("click",function(){return r.saveStaff()}),d(52,_t,1,0,"mat-spinner",17),o(53),a()()),e&2){let m,f,w,T,A;l(),h(" ",r.isEditMode()?"Edit Staff Member":"Add Staff Member"," "),l(2),u("formGroup",r.staffForm),l(7),c((m=r.staffForm.get("name"))!=null&&m.hasError("required")&&((m=r.staffForm.get("name"))!=null&&m.touched)?10:-1),l(7),c((f=r.staffForm.get("email"))!=null&&f.hasError("required")&&((f=r.staffForm.get("email"))!=null&&f.touched)?17:-1),l(),c((w=r.staffForm.get("email"))!=null&&w.hasError("email")&&((w=r.staffForm.get("email"))!=null&&w.touched)?18:-1),l(7),c((T=r.staffForm.get("phoneNumber"))!=null&&T.hasError("required")&&((T=r.staffForm.get("phoneNumber"))!=null&&T.touched)?25:-1),l(13),c(r.isEditMode()?-1:38),l(5),c(r.rolesResource.isLoading()?43:44),l(4),c((A=r.staffForm.get("role"))!=null&&A.hasError("required")&&((A=r.staffForm.get("role"))!=null&&A.touched)?47:-1),l(2),u("disabled",r.saving()),l(2),u("disabled",r.staffForm.invalid||r.saving()),l(),c(r.saving()?52:-1),l(),h(" ",r.isEditMode()?"Update":"Create"," ")}},dependencies:[ce,re,ne,ae,oe,me,le,j,Ie,Ne,Ve,Pe,N,I,R,V,Ce,ue,_e,ge,he,xe,$,B,O,Me,ee,L,q,te],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})};function gt(t,i){t&1&&(n(0,"div",2),_(1,"mat-spinner",3),n(2,"span",4),o(3,"Loading staff..."),a()())}function Ct(t,i){t&1&&(n(0,"th",27),o(1,"Name"),a())}function xt(t,i){if(t&1&&(n(0,"td",28)(1,"div",29)(2,"div",30)(3,"span",31),o(4),a()(),n(5,"span",32),o(6),a()()()),t&2){let e=i.$implicit;l(4),h(" ",e.name.charAt(0).toUpperCase()," "),l(2),E(e.name)}}function ht(t,i){t&1&&(n(0,"th",27),o(1,"Email"),a())}function St(t,i){if(t&1&&(n(0,"td",33),o(1),a()),t&2){let e=i.$implicit;l(),h(" ",e.email," ")}}function Mt(t,i){t&1&&(n(0,"th",27),o(1,"Phone"),a())}function vt(t,i){if(t&1&&(n(0,"td",33),o(1),a()),t&2){let e=i.$implicit;l(),h(" ",e.phoneNumber," ")}}function bt(t,i){t&1&&(n(0,"th",27),o(1,"Role"),a())}function Et(t,i){if(t&1&&(n(0,"span",36),o(1),a()),t&2){let e=s().$implicit,r=s(3);U(r.getRoleColor(e.role)),l(),h(" ",e.role.name," ")}}function yt(t,i){t&1&&(n(0,"span",35),o(1," No Role "),a())}function Dt(t,i){if(t&1&&(n(0,"td",28),d(1,Et,2,3,"span",34)(2,yt,2,0,"span",35),a()),t&2){let e=i.$implicit;l(),c(e.role?1:2)}}function wt(t,i){t&1&&(n(0,"th",27),o(1,"Status"),a())}function Tt(t,i){if(t&1&&(n(0,"td",28)(1,"span",36),o(2),a()()),t&2){let e=i.$implicit,r=s(3);l(),U(r.getStatusColor(e)),l(),h(" ",r.getStatusText(e)," ")}}function At(t,i){t&1&&(n(0,"th",37),o(1,"Actions"),a())}function kt(t,i){if(t&1){let e=y();n(0,"td",38)(1,"button",39)(2,"mat-icon"),o(3,"more_vert"),a()(),n(4,"mat-menu",null,0)(6,"button",40),g("click",function(){let m=C(e).$implicit,f=s(3);return x(f.openEditMerchantDialog(m))}),n(7,"mat-icon"),o(8,"edit"),a(),n(9,"span"),o(10,"Edit Details"),a()(),n(11,"button",40),g("click",function(){let m=C(e).$implicit,f=s(3);return x(f.openAssignRoleDialog(m))}),n(12,"mat-icon"),o(13,"admin_panel_settings"),a(),n(14,"span"),o(15,"Assign Role"),a()(),n(16,"button",40),g("click",function(){let m=C(e).$implicit,f=s(3);return x(f.toggleMerchantStatus(m))}),n(17,"mat-icon"),o(18),a(),n(19,"span"),o(20),a()(),_(21,"mat-divider"),n(22,"button",41),g("click",function(){let m=C(e).$implicit,f=s(3);return x(f.deleteMerchant(m))}),n(23,"mat-icon",42),o(24,"delete"),a(),n(25,"span"),o(26,"Delete"),a()()()()}if(t&2){let e=i.$implicit,r=W(5);l(),u("matMenuTriggerFor",r),l(17),E(e.deactivate?"toggle_on":"toggle_off"),l(2),E(e.deactivate?"Activate":"Deactivate")}}function Ft(t,i){t&1&&_(0,"tr",43)}function Rt(t,i){t&1&&_(0,"tr",44)}function It(t,i){if(t&1){let e=y();n(0,"mat-card",5)(1,"div",7)(2,"div")(3,"h2",8),o(4,"Staff & Merchants"),a(),n(5,"p",9),o(6,"Manage your hotel staff accounts and their role permissions"),a()(),n(7,"div",10)(8,"button",11)(9,"mat-icon"),o(10,"admin_panel_settings"),a(),o(11," Manage Roles "),a(),n(12,"button",12),g("click",function(){C(e);let m=s(2);return x(m.openAddMerchantDialog())}),n(13,"mat-icon"),o(14,"person_add"),a(),o(15," Add Staff "),a()()(),n(16,"table",13),v(17,14),S(18,Ct,2,0,"th",15)(19,xt,7,2,"td",16),b(),v(20,17),S(21,ht,2,0,"th",15)(22,St,2,1,"td",18),b(),v(23,19),S(24,Mt,2,0,"th",15)(25,vt,2,1,"td",18),b(),v(26,20),S(27,bt,2,0,"th",15)(28,Dt,3,1,"td",16),b(),v(29,21),S(30,wt,2,0,"th",15)(31,Tt,3,3,"td",16),b(),v(32,22),S(33,At,2,0,"th",23)(34,kt,27,3,"td",24),b(),S(35,Ft,1,0,"tr",25)(36,Rt,1,0,"tr",26),a()()}if(t&2){let e=s(2);l(8),u("routerLink","../roles"),l(8),u("dataSource",e.merchants.value()),l(19),u("matHeaderRowDef",e.displayedColumns),l(),u("matRowDefColumns",e.displayedColumns)}}function Nt(t,i){if(t&1){let e=y();n(0,"app-no-record",6)(1,"button",12),g("click",function(){C(e);let m=s(2);return x(m.openAddMerchantDialog())}),n(2,"mat-icon"),o(3,"person_add"),a(),o(4," Add Staff Member "),a()()}}function Pt(t,i){if(t&1&&d(0,It,37,4,"mat-card",5)(1,Nt,5,0,"app-no-record",6),t&2){let e=s();c(e.merchants.value().length>0?0:1)}}var Xe=class t{snackBar=p(P);dialog=p(Re);storeStore=p(Se);userService=p(G);merchants=H({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:i})=>this.userService.getStoreMerchants(i.storeId)});displayedColumns=["name","email","phone","role","status","actions"];getRoleColor(i){if(!i)return"bg-gray-100 text-gray-700";let e=i.name.toLowerCase();return e.includes("admin")||e.includes("owner")?"bg-purple-100 text-purple-700":e.includes("manager")?"bg-blue-100 text-blue-700":e.includes("front desk")||e.includes("receptionist")?"bg-green-100 text-green-700":e.includes("housekeeper")||e.includes("housekeeping")?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}getStatusColor(i){return i.deactivate?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}getStatusText(i){return i.deactivate?"Inactive":"Active"}openAddMerchantDialog(){let i=this.storeStore.selectedStore()?._id;if(!i)return;this.dialog.open(D,{width:"500px",data:{storeId:i}}).afterClosed().subscribe(r=>{r&&this.merchants.reload()})}openEditMerchantDialog(i){let e=this.storeStore.selectedStore()?._id;if(!e)return;this.dialog.open(D,{width:"500px",data:{storeId:e,staff:i}}).afterClosed().subscribe(m=>{m&&this.merchants.reload()})}openAssignRoleDialog(i){this.openEditMerchantDialog(i)}toggleMerchantStatus(i){let e=!i.deactivate;this.userService.updateMerchant(i._id,{deactivate:e}).subscribe({next:()=>{this.snackBar.open(`${i.name} ${e?"deactivated":"activated"}`,"Close",{duration:3e3}),this.merchants.reload()},error:r=>{this.snackBar.open(r.error?.message||"Failed to update status","Close",{duration:5e3})}})}deleteMerchant(i){this.dialog.open(We,{width:"400px",data:{title:"Delete Staff Member",message:`Are you sure you want to delete ${i.name}? This action cannot be undone.`}}).afterClosed().subscribe(r=>{r&&this.userService.deleteMerchant(i._id).subscribe({next:()=>{this.snackBar.open(`${i.name} deleted`,"Close",{duration:3e3}),this.merchants.reload()},error:m=>{this.snackBar.open(m.error?.message||"Failed to delete staff member","Close",{duration:5e3})}})})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=F({type:t,selectors:[["app-staff-account"]],decls:3,vars:1,consts:[["menu","matMenu"],[1,"py-6"],[1,"flex","justify-center","items-center","py-12"],["diameter","40"],[1,"ml-3","text-gray-600"],["appearance","outlined",1,"py-3"],["icon","people_outline","title","No Staff Members","message","Add your first staff member to get started"],[1,"flex","p-3","flex-col","sm:flex-row","justify-between","items-start","sm:items-center","gap-4","mb-6"],[1,"text-xl","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"flex","gap-3"],["mat-stroked-button","","color","primary",3,"routerLink"],["mat-flat-button","","color","primary",3,"click"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","class","!py-4 !px-6 !font-semibold",4,"matHeaderCellDef"],["mat-cell","","class","!py-4 !px-6",4,"matCellDef"],["matColumnDef","email"],["mat-cell","","class","!py-4 !px-6 text-gray-600",4,"matCellDef"],["matColumnDef","phone"],["matColumnDef","role"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-cell","","class","!py-4 !px-6 !font-semibold text-right",4,"matHeaderCellDef"],["mat-cell","","class","!py-4 !px-6 text-right",4,"matCellDef"],["mat-header-row","","class","bg-gray-50",4,"matHeaderRowDef"],["mat-row","","class","hover:bg-gray-50",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"!py-4","!px-6","!font-semibold"],["mat-cell","",1,"!py-4","!px-6"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","bg-blue-100","rounded-full","flex","items-center","justify-center"],[1,"text-blue-600","font-medium"],[1,"font-medium","text-gray-900"],["mat-cell","",1,"!py-4","!px-6","text-gray-600"],[1,"px-3","py-1","rounded-full","text-sm","font-medium",3,"class"],[1,"px-3","py-1","rounded-full","text-sm","font-medium","bg-gray-100","text-gray-500"],[1,"px-3","py-1","rounded-full","text-sm","font-medium"],["mat-header-cell","",1,"!py-4","!px-6","!font-semibold","text-right"],["mat-cell","",1,"!py-4","!px-6","text-right"],["mat-icon-button","","matTooltip","More actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",1,"!text-red-600",3,"click"],[1,"!text-red-600"],["mat-header-row","",1,"bg-gray-50"],["mat-row","",1,"hover:bg-gray-50"]],template:function(e,r){e&1&&(n(0,"div",1),d(1,gt,4,0,"div",2)(2,Pt,2,1),a()),e&2&&(l(),c(r.merchants.isLoading()?1:r.merchants.hasValue()?2:-1))},dependencies:[X,de,pe,fe,N,I,R,$,B,Ke,$e,Le,je,Oe,qe,Ue,Ge,He,ze,Je,Be,we,ye,Ee,De,j,L,q,Ae,Te,O,V,be,ve,Qe,Z,Y],styles:["[_nghost-%COMP%]{display:block}"]})};export{Xe as StaffAccount};
