import{a as De}from"./chunk-VRW2HZGF.js";import{a as Te}from"./chunk-LQU32KS7.js";import{b as he,f as Q}from"./chunk-4L4VWXIM.js";import{a as Se}from"./chunk-YZQZHEMG.js";import{d as ve,e as fe,f as be,h as Ce,i as ke,j as ye,k as Ee}from"./chunk-XSZYAESL.js";import"./chunk-LCNY3JPX.js";import{a as xe}from"./chunk-HOFFRLAS.js";import"./chunk-OFQMF3WN.js";import{a as le,b as re,c as me,g as de}from"./chunk-GE7CTSB3.js";import{a as ce,b as _e,c as pe,f as ue,g as ge,l as J}from"./chunk-T7LGKL43.js";import{a as se,b as K}from"./chunk-E4PTFC5Z.js";import{a as $t,b as Ot,c as Vt,d as jt,e as Gt,f as Ut}from"./chunk-F5YHHFYE.js";import{d as zt}from"./chunk-4P4GBQE7.js";import{i as At}from"./chunk-ZKQYDJ5W.js";import{a as oe,b as ae}from"./chunk-LCF3SYDV.js";import{d as Rt}from"./chunk-ZLVLWRZH.js";import{d as lt}from"./chunk-HJGFVW6K.js";import"./chunk-TVH27JLT.js";import"./chunk-G4CZ6LK2.js";import"./chunk-I564X6SI.js";import"./chunk-VTDH2LYT.js";import{b as ie,d as ne}from"./chunk-63HT37SK.js";import{a as Zt,b as te,h as ee}from"./chunk-YJCGHVXK.js";import"./chunk-UHBDKNKX.js";import{a as W,b as Y}from"./chunk-3ZLH5HUN.js";import{B as Xt,d as Ht,g as qt,h as Wt,m as Yt,s as Kt,t as Jt,z as Qt}from"./chunk-O5GCTPYR.js";import"./chunk-EGLRIU4H.js";import{a as Ft}from"./chunk-5TL46KBL.js";import"./chunk-53AK2UWQ.js";import"./chunk-BFT2MTJY.js";import{a as H,b as wt,c as Nt,f as Pt,h as q}from"./chunk-JONI64R4.js";import"./chunk-H7INH462.js";import"./chunk-OOL2KACG.js";import"./chunk-KZJMNFJ3.js";import{b as U,c as z}from"./chunk-G6I3OKXX.js";import{_ as j,ba as G}from"./chunk-4Z2XUZY2.js";import{e as Bt,g as Lt}from"./chunk-F436VINI.js";import{g as St,l as ht,m as Tt,p as Dt,s as It,t as Mt,u as V}from"./chunk-H22US2IH.js";import{Ec as at,Gc as kt,Ib as c,Jb as _,Kb as vt,Mb as b,Mc as y,Nb as C,Nc as T,Ob as k,Oc as yt,Pb as o,Pc as Et,Qb as i,Rb as S,Vb as ft,Wb as bt,Wc as D,Ya as it,Yb as R,ac as h,bb as r,cc as s,fa as f,ka as B,la as L,m as xt,qb as O,rc as l,sc as p,tc as g,uc as ot,wa as E,wb as nt,wc as Ct}from"./chunk-P5WOETP4.js";import"./chunk-GAL4ENT6.js";var $e=()=>[],Ie=(e,n)=>n._id;function Oe(e,n){e&1&&(o(0,"div",3),S(1,"mat-spinner",9),i())}function Ve(e,n){e&1&&(o(0,"div",4)(1,"mat-icon",10),l(2,"no_rooms"),i(),o(3,"p"),l(4,"No available rooms found"),i()())}function je(e,n){e&1&&(o(0,"mat-option",23),l(1,"No available rooms"),i())}function Ge(e,n){if(e&1&&(o(0,"mat-option",24)(1,"span",25),l(2),i(),o(3,"span",26),l(4),i()()),e&2){let t=n.$implicit;k("value",t._id),r(2),p(t.roomNumber),r(2),g("- ",(t.roomType==null?null:t.roomType.name)||"Standard")}}function Ue(e,n){if(e&1&&b(0,Ge,5,3,"mat-option",24,Ie),e&2){let t=s().$implicit,a=s(2);C(a.getAvailableRoomsForType(t==null?null:t.room_type_id))}}function ze(e,n){e&1&&(o(0,"mat-error"),l(1,"Please select a room"),i())}function He(e,n){if(e&1&&(o(0,"div",30)(1,"span"),l(2,"Floor:"),i(),o(3,"span",29),l(4),i()()),e&2){let t=s(2).$implicit;r(4),p(t.floor)}}function qe(e,n){if(e&1&&(o(0,"div",27)(1,"div",28)(2,"span"),l(3,"Room Type:"),i(),o(4,"span",29),l(5),i()(),c(6,He,5,1,"div",30),i()),e&2){let t=s().$implicit;r(5),p(t.roomType==null?null:t.roomType.name),r(),_(t.floor?6:-1)}}function We(e,n){if(e&1&&c(0,qe,7,2,"div",27),e&2){let t,a=n.$implicit,m=s(2).$index,u=s(2);_(a._id===((t=u.assignmentForm.get("room_"+m))==null?null:t.value)?0:-1)}}function Ye(e,n){if(e&1&&b(0,We,1,1,null,null,Ie),e&2){let t=s().$implicit,a=s(2);C(a.getAvailableRoomsForType(t==null?null:t.room_type_id))}}function Ke(e,n){if(e&1&&(o(0,"mat-card",11)(1,"div",12)(2,"div",13)(3,"div",14),l(4),i(),o(5,"div")(6,"h3",15)(7,"mat-icon",16),l(8,"door_front"),i(),l(9),i(),o(10,"p",17),l(11),i()()(),o(12,"div",18)(13,"div",19),l(14,"Price"),i(),o(15,"div",20),l(16),y(17,"currency"),i()()(),o(18,"mat-form-field",21)(19,"mat-label"),l(20,"Select Available Room"),i(),o(21,"mat-select",22),c(22,je,2,0,"mat-option",23)(23,Ue,2,0),i(),c(24,ze,2,0,"mat-error"),i(),c(25,Ye,2,0),i()),e&2){let t,a,m=n.$implicit,u=n.$index,x=s(2);r(4),g(" ",u+1," "),r(5),g(" ",x.getRoomTypeName(m==null?null:m.room_type_id)," "),r(2),g(" ",x.formatGuestNames(m.guests)," "),r(5),g(" ",yt(17,8,m.amount,x.data.currency)," "),r(5),k("formControlName","room_"+u),r(),_((x.getAvailableRoomsForType(m==null?null:m.room_type_id)||kt(11,$e)).length===0?22:23),r(2),_((t=x.assignmentForm.get("room_"+u))!=null&&t.invalid&&((t=x.assignmentForm.get("room_"+u))!=null&&t.touched)?24:-1),r(),_((a=x.assignmentForm.get("room_"+u))!=null&&a.value?25:-1)}}function Je(e,n){if(e&1&&(o(0,"form",5),b(1,Ke,26,12,"mat-card",11,vt),i()),e&2){let t=s();k("formGroup",t.assignmentForm),r(),C(t.data.rooms)}}var X=class e{dialogRef=f(ve);data=f(fe);roomsService=f(Te);fb=f(Qt);loadingRooms=E(!1);availableRoomsLoading=E(!0);submitting=E(!1);availableRoomsByType=E(new Map);assignmentForm=this.fb.group({});constructor(){this.initializeForm(),this.loadAvailableRooms()}initializeForm(){let n={};this.data.rooms.forEach((t,a)=>{n[`room_${a}`]=["",Ht.required]}),this.assignmentForm=this.fb.group(n)}loadAvailableRooms(){this.availableRoomsLoading.set(!0);let n=this.data.rooms||[];if(n.length===0){this.availableRoomsLoading.set(!1);return}let t=n[0],a=t.checkin_date||new Date().toISOString(),m=t.checkout_date||new Date().toISOString();this.roomsService.getAvailableRooms({storeId:this.data.storeId,checkInDate:a,checkOutDate:m}).subscribe({next:u=>{let x=new Map;u.forEach(v=>{let I=v.roomType?.channexRoomTypeId||v.roomType?._id||v.roomTypeId;x.has(I)||x.set(I,[]),x.get(I).push(v)}),this.availableRoomsByType.set(x),this.availableRoomsLoading.set(!1)},error:u=>{console.error("Failed to load available rooms:",u),this.availableRoomsLoading.set(!1)}})}getAvailableRoomsForType(n){return this.availableRoomsByType().get(n)||[]}getRoomTypeName(n){let t=this.data.roomTypes||[];return!t||t.length===0?"Room":t.find(m=>(m.id||m.attributes?.id)===n)?.attributes?.title||"Room"}formatGuestNames(n){return!n||n.length===0?"No guest info":n.map(t=>`${t.name} ${t.surname}`.trim()).join(", ")}isFormValid(){return this.assignmentForm.valid}submit(){if(!this.isFormValid())return;this.submitting.set(!0);let n=[];this.data.rooms.forEach((t,a)=>{let m=this.assignmentForm.get(`room_${a}`)?.value;m&&n.push({otaRoomIndex:a,roomId:m,guests:t.guests||[]})}),this.roomsService.assignRoomsToBooking(this.data.bookingId,n).subscribe({next:t=>{this.submitting.set(!1),this.dialogRef.close({success:!0,assignments:n,result:t})},error:t=>{console.error("Failed to assign rooms:",t),this.submitting.set(!1)}})}cancel(){this.dialogRef.close(null)}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=O({type:e,selectors:[["app-assign-room-dialog"]],decls:13,vars:3,consts:[["mat-dialog-title","",1,"flex","items-center","gap-2"],[1,"text-blue-600"],[1,"max-h-[70vh]","overflow-y-auto"],[1,"flex","justify-center","items-center","py-12"],[1,"text-center","py-8","text-gray-600"],[1,"space-y-4",3,"formGroup"],["align","end",1,"gap-2"],["matButton","",3,"click"],["matButton","filled","color","primary",3,"click","disabled"],["diameter","40"],[1,"text-4xl!","text-gray-400","mb-2"],["appearance","outlined",1,"p-4","space-y-2"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","gap-3","flex-1"],[1,"flex","items-center","justify-center","w-8","h-8","rounded-full","bg-blue-100","text-blue-600","font-semibold","text-sm"],[1,"font-semibold","text-gray-900","flex","items-center","gap-2"],[1,"text-base","text-blue-600"],[1,"text-xs","text-gray-600","mt-1"],[1,"text-right"],[1,"text-sm","text-gray-600"],[1,"text-lg","font-semibold","text-blue-600"],["appearance","outline",1,"w-full"],[3,"formControlName"],["disabled",""],[3,"value"],[1,"font-semibold"],[1,"text-gray-600","ml-2"],[1,"mt-3","pt-3","border-t","border-gray-200","text-sm","text-gray-600"],[1,"flex","justify-between"],[1,"font-medium"],[1,"flex","justify-between","mt-1"]],template:function(t,a){t&1&&(o(0,"h2",0)(1,"mat-icon",1),l(2,"bed"),i(),l(3,` Assign Rooms to Booking
`),i(),o(4,"mat-dialog-content",2),c(5,Oe,2,0,"div",3)(6,Ve,5,0,"div",4)(7,Je,3,1,"form",5),i(),o(8,"mat-dialog-actions",6)(9,"button",7),h("click",function(){return a.cancel()}),l(10,"Cancel"),i(),o(11,"button",8),h("click",function(){return a.submit()}),l(12),i()()),t&2&&(r(5),_(a.availableRoomsLoading()?5:a.availableRoomsByType().size===0?6:7),r(6),k("disabled",!a.isFormValid()||a.submitting()),r(),g(" ",a.submitting()?"Assigning...":"Assign Rooms"," "))},dependencies:[V,Xt,Yt,qt,Wt,Jt,Kt,Ee,Ce,ye,ke,ie,ee,Zt,te,ae,oe,Rt,ne,G,j,z,U,K,J,q,H,Y,W,Q,It],styles:["[_nghost-%COMP%]{display:block}mat-card[_ngcontent-%COMP%]{margin-bottom:0}mat-form-field[_ngcontent-%COMP%]{display:block}button[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle;margin-right:8px}"]})};var Qe=(e,n)=>n.booking_room_id,Be=(e,n)=>n.key,rt=(e,n)=>n.name,Xe=(e,n)=>n.id;function Ze(e,n){if(e&1){let t=R();o(0,"button",6),h("click",function(){B(t);let m=s(2);return L(m.openAssignRoomDialog())}),o(1,"mat-icon"),l(2,"bed"),i(),l(3," Assign Rooms "),i()}}function ti(e,n){if(e&1){let t=R();c(0,Ze,4,0,"button",4),o(1,"button",5),h("click",function(){B(t);let m=s();return L(m.goBack())}),o(2,"mat-icon"),l(3,"arrow_back"),i(),l(4," Back to Bookings "),i()}if(e&2){let t=s();_(t.hasUnassignedRooms()?0:-1)}}function ei(e,n){e&1&&(o(0,"div",2),S(1,"mat-spinner",7),i())}function ii(e,n){if(e&1){let t=R();o(0,"div",3)(1,"mat-card",8)(2,"mat-card-content",9)(3,"div",10)(4,"mat-icon",11),l(5,"error"),i(),o(6,"h3",12),l(7,"Failed to Load Booking"),i(),o(8,"p",13),l(9),i(),o(10,"button",14),h("click",function(){B(t);let m=s();return L(m.goBack())}),o(11,"mat-icon"),l(12,"arrow_back"),i(),l(13," Go Back "),i()()()()()}if(e&2){let t,a=s();r(9),p((t=a.bookingResource.error())==null?null:t.message)}}function ni(e,n){e&1&&(o(0,"mat-icon",54),l(1,"info"),i(),l(2," Info "))}function oi(e,n){if(e&1&&(o(0,"a",28),l(1),i()),e&2){let t,a,m=s(2);k("href",at("mailto:",(t=m.booking())==null||t.customer==null?null:t.customer.mail),it),r(),g(" ",(a=m.booking())==null||a.customer==null?null:a.customer.mail," ")}}function ai(e,n){e&1&&l(0," N/A ")}function li(e,n){if(e&1&&(o(0,"a",28),l(1),i()),e&2){let t,a,m=s(2);k("href",at("tel:",(t=m.booking())==null||t.customer==null?null:t.customer.phone),it),r(),g(" ",(a=m.booking())==null||a.customer==null?null:a.customer.phone," ")}}function ri(e,n){e&1&&l(0," N/A ")}function mi(e,n){if(e&1&&l(0),e&2){let t,a=s(2);g(" ",a.formatCurrency((t=a.booking())==null?null:t.ota_commission,(t=a.booking())==null?null:t.currency)," ")}}function di(e,n){e&1&&l(0," N/A ")}function si(e,n){e&1&&(o(0,"span",38),l(1,"OTA (Pre-paid)"),i())}function ci(e,n){e&1&&(o(0,"span",39),l(1,"Property (On arrival)"),i())}function _i(e,n){e&1&&(o(0,"span",13),l(1,"Not specified"),i())}function pi(e,n){e&1&&(o(0,"span"),l(1,"Credit Card"),i())}function ui(e,n){e&1&&(o(0,"span"),l(1,"Bank Transfer"),i())}function gi(e,n){if(e&1&&(o(0,"span"),l(1),i()),e&2){let t,a=s(3);r(),p((t=a.booking())==null?null:t.payment_type)}}function xi(e,n){if(e&1&&(o(0,"mat-list-item")(1,"span",26),l(2,"Payment Method"),i(),o(3,"span",27),c(4,pi,2,0,"span")(5,ui,2,0,"span")(6,gi,2,1,"span"),i()()),e&2){let t,a=s(2);r(4),_(((t=a.booking())==null?null:t.payment_type)==="credit_card"?4:((t=a.booking())==null?null:t.payment_type)==="bank_transfer"?5:6)}}function vi(e,n){if(e&1&&(o(0,"mat-list-item")(1,"span",26),l(2,"Payment Guarantee"),i(),o(3,"span",27),l(4),i()()),e&2){let t,a=s(2);r(4),p(((t=a.booking())==null||t.guarantee==null?null:t.guarantee.card_number)||"Card on file")}}function fi(e,n){if(e&1&&(o(0,"div")(1,"span",61),l(2,"CHILDREN AGES"),i(),o(3,"div",62),l(4),i()()),e&2){let t=s().$implicit;r(4),p(t==null||t.occupancy==null||t.occupancy.ages==null?null:t.occupancy.ages.join(", "))}}function bi(e,n){if(e&1&&(o(0,"mat-list-item")(1,"span",26),l(2),i(),o(3,"span",68),l(4),i()()),e&2){let t,a=n.$implicit,m=s(5);r(2),p(a.key),r(2),g(" ",m.formatCurrency(a.value,(t=m.booking())==null?null:t.currency)," ")}}function Ci(e,n){if(e&1&&(o(0,"div")(1,"h4",65),l(2,"Price Breakdown"),i(),o(3,"mat-list",66),b(4,bi,5,2,"mat-list-item",null,Be),y(6,"keyvalue"),S(7,"mat-divider"),o(8,"mat-list-item",57)(9,"span",26),l(10,"Subtotal"),i(),o(11,"span",67),l(12),i()()()()),e&2){let t,a=s().$implicit,m=s(3);r(4),C(T(6,1,a==null?null:a.days)),r(8),g(" ",m.formatCurrency(a==null?null:a.amount,(t=m.booking())==null?null:t.currency)," ")}}function ki(e,n){if(e&1&&(o(0,"div",63)(1,"h5",69),l(2,"Meal Plan"),i(),o(3,"p",70),l(4),i()()),e&2){let t=s().$implicit;r(4),p(t==null||t.meta==null?null:t.meta.meal_plan)}}function yi(e,n){e&1&&(o(0,"span",74),l(1,"(Included)"),i())}function Ei(e,n){e&1&&(o(0,"span",75),l(1,"(Extra)"),i())}function Si(e,n){if(e&1&&(o(0,"div",71)(1,"div")(2,"div",72),l(3),i(),o(4,"div",73),c(5,yi,2,0,"span",74)(6,Ei,2,0,"span",75),i()(),o(7,"div",76),l(8),i()()),e&2){let t,a=n.$implicit,m=s(5);r(3),p(a.name),r(2),_(a.is_inclusive?5:6),r(3),g(" ",m.formatCurrency(a.total_price,(t=m.booking())==null?null:t.currency)," ")}}function hi(e,n){if(e&1&&(o(0,"div")(1,"h5",65),l(2,"Taxes & Fees"),i(),o(3,"div",43),b(4,Si,9,3,"div",71,rt),i()()),e&2){let t=s().$implicit;r(4),C(t==null?null:t.taxes)}}function Ti(e,n){if(e&1&&(o(0,"div",79),l(1),i()),e&2){let t=n.$implicit;r(),ot(" ",t.name," ",t.surname," ")}}function Di(e,n){if(e&1&&(o(0,"div",64)(1,"h5",77),l(2,"Guests"),i(),o(3,"div",78),b(4,Ti,2,2,"div",79,rt),i()()),e&2){let t=s().$implicit;r(4),C(t==null?null:t.guests)}}function Ii(e,n){if(e&1&&(o(0,"mat-expansion-panel",25)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"div",55)(4,"div",56)(5,"mat-icon",42),l(6,"door_front"),i(),o(7,"span",57),l(8),i()(),o(9,"span",58),l(10),i()()(),o(11,"mat-panel-description"),l(12),i()(),o(13,"div",59)(14,"div",60)(15,"div")(16,"span",61),l(17,"ADULTS"),i(),o(18,"div",62),l(19),i()(),o(20,"div")(21,"span",61),l(22,"CHILDREN"),i(),o(23,"div",62),l(24),i()(),o(25,"div")(26,"span",61),l(27,"INFANTS"),i(),o(28,"div",62),l(29),i()(),c(30,fi,5,1,"div"),i(),c(31,Ci,13,3,"div"),y(32,"keyvalue"),c(33,ki,5,1,"div",63),c(34,hi,6,0,"div"),c(35,Di,6,0,"div",64),i()()),e&2){let t,a=n.$implicit,m=s(3);r(8),p(m.getRoomTypeName(a==null?null:a.room_type_id)),r(2),g(" ",m.formatCurrency(a==null?null:a.amount,(t=m.booking())==null?null:t.currency)," "),r(2),ot(" ",m.formatDate(a==null?null:a.checkin_date)," \u2192 ",m.formatDate(a==null?null:a.checkout_date)," "),r(7),p((a==null||a.occupancy==null?null:a.occupancy.adults)||0),r(5),p((a==null||a.occupancy==null?null:a.occupancy.children)||0),r(5),p((a==null||a.occupancy==null?null:a.occupancy.infants)||0),r(),_(!(a==null||a.occupancy==null)&&a.occupancy.ages&&(a==null||a.occupancy==null?null:a.occupancy.ages.length)>0?30:-1),r(),_(a!=null&&a.days&&T(32,12,a==null?null:a.days).length>0?31:-1),r(2),_(!(a==null||a.meta==null)&&a.meta.meal_plan?33:-1),r(),_(a!=null&&a.taxes&&(a==null?null:a.taxes.length)>0?34:-1),r(),_(a!=null&&a.guests&&(a==null?null:a.guests.length)>0?35:-1)}}function Mi(e,n){if(e&1&&(o(0,"mat-accordion",43),b(1,Ii,36,14,"mat-expansion-panel",25,Qe),i()),e&2){let t,a=s(2);r(),C((t=a.booking())==null?null:t.rooms)}}function Bi(e,n){e&1&&(o(0,"div",44),l(1," No room information available "),i())}function Li(e,n){if(e&1&&(o(0,"mat-list-item")(1,"span",26),l(2,"Taxes & Fees"),i(),o(3,"span",45),l(4),i()()),e&2){let t,a=s(2);r(4),g(" ",a.formatCurrency(a.getTotalTaxes(a.booking()),(t=a.booking())==null?null:t.currency)," ")}}function Ri(e,n){if(e&1&&(o(0,"mat-list-item",46)(1,"span",26),l(2,"OTA Commission"),i(),o(3,"span",45),l(4),i()()),e&2){let t,a=s(2);r(4),g(" -",a.formatCurrency((t=a.booking())==null?null:t.ota_commission,(t=a.booking())==null?null:t.currency)," ")}}function Fi(e,n){if(e&1&&(o(0,"div")(1,"h4",80)(2,"mat-icon",81),l(3,"note"),i(),l(4," Guest Notes "),i(),o(5,"div",82),l(6),i()()),e&2){let t,a=s(3);r(6),g(" ",(t=a.booking())==null?null:t.notes," ")}}function Ai(e,n){if(e&1&&(o(0,"div",84)(1,"div",85),l(2),i(),o(3,"div",86),l(4),i()()),e&2){let t,a=n.$implicit,m=s(4);r(2),p(a.name),r(2),Ct(" ",a.nights||1," night",(a.nights||1)>1?"s":""," \xD7 ",a.persons||1," person",(a.persons||1)>1?"s":""," - ",m.formatCurrency(a.total_price,(t=m.booking())==null?null:t.currency)," ")}}function wi(e,n){if(e&1&&(o(0,"div")(1,"h4",80)(2,"mat-icon",81),l(3,"room_service"),i(),l(4," Services "),i(),o(5,"div",83),b(6,Ai,5,6,"div",84,rt),i()()),e&2){let t,a=s(3);r(6),C((t=a.booking())==null?null:t.services)}}function Ni(e,n){e&1&&(o(0,"mat-list-item")(1,"span",26),l(2,"Type"),i(),o(3,"mat-chip",88),l(4,"Virtual Card"),i()())}function Pi(e,n){if(e&1&&(o(0,"div")(1,"h4",80)(2,"mat-icon",81),l(3,"credit_card"),i(),l(4," Payment Guarantee "),i(),o(5,"mat-list")(6,"mat-list-item")(7,"span",26),l(8,"Card Number"),i(),o(9,"span",87),l(10),i()(),o(11,"mat-list-item")(12,"span",26),l(13,"Card Type"),i(),o(14,"span",87),l(15),i()(),o(16,"mat-list-item")(17,"span",26),l(18,"Cardholder"),i(),o(19,"span",87),l(20),i()(),o(21,"mat-list-item")(22,"span",26),l(23,"Expiration"),i(),o(24,"span",87),l(25),i()(),c(26,Ni,5,0,"mat-list-item"),i()()),e&2){let t,a,m,u,x,v=s(3);r(10),p((t=v.booking())==null||t.guarantee==null?null:t.guarantee.card_number),r(5),p((a=v.booking())==null||a.guarantee==null?null:a.guarantee.card_type),r(5),p((m=v.booking())==null||m.guarantee==null?null:m.guarantee.cardholder_name),r(5),p((u=v.booking())==null||u.guarantee==null?null:u.guarantee.expiration_date),r(),_(!((x=v.booking())==null||x.guarantee==null)&&x.guarantee.is_virtual?26:-1)}}function $i(e,n){if(e&1&&(o(0,"mat-card",49)(1,"mat-card-header")(2,"mat-card-title"),l(3,"Additional Information"),i()(),o(4,"mat-card-content")(5,"div",29),c(6,Fi,7,1,"div"),c(7,wi,8,0,"div"),c(8,Pi,27,5,"div"),i()()()),e&2){let t,a,m,u=s(2);r(6),_((t=u.booking())!=null&&t.notes?6:-1),r(),_((a=u.booking())!=null&&a.services&&((a=u.booking())==null?null:a.services.length)>0?7:-1),r(),_((m=u.booking())!=null&&m.guarantee?8:-1)}}function Oi(e,n){e&1&&(o(0,"mat-icon",54),l(1,"timeline"),i(),l(2," Timeline "))}function Vi(e,n){e&1&&(o(0,"div",51),S(1,"mat-spinner",7),i())}function ji(e,n){e&1&&S(0,"div",93)}function Gi(e,n){if(e&1&&(o(0,"div",100),l(1),i()),e&2){let t=s(2).$implicit;r(),p(t.attributes.user_email)}}function Ui(e,n){if(e&1&&(o(0,"div",97)(1,"div"),l(2),i(),c(3,Gi,2,1,"div",100),i()),e&2){let t=s().$implicit;r(2),p(t.attributes.user_name),r(),_(t.attributes.user_email?3:-1)}}function zi(e,n){e&1&&l(0," Yes ")}function Hi(e,n){e&1&&l(0," No ")}function qi(e,n){if(e&1&&(o(0,"span",76),c(1,zi,1,0)(2,Hi,1,0),i()),e&2){let t=s().$implicit;r(),_(t.value?1:2)}}function Wi(e,n){if(e&1&&(o(0,"span",76),l(1),i()),e&2){let t=s().$implicit;r(),p(t.value)}}function Yi(e,n){if(e&1&&(o(0,"div")(1,"span",13),l(2),y(3,"titlecase"),i(),c(4,qi,3,1,"span",76)(5,Wi,2,1,"span",76),i()),e&2){let t=n.$implicit,a=s(5);r(2),g("",T(3,2,t.key),":"),r(2),_(a.isBoolean(t.value)?4:5)}}function Ki(e,n){if(e&1&&(o(0,"div",98),b(1,Yi,6,4,"div",null,Be),y(3,"keyvalue"),i()),e&2){let t=s().$implicit;r(),C(T(3,0,t.attributes.notes))}}function Ji(e,n){if(e&1&&(o(0,"div",99)(1,"mat-icon",101),l(2,"public"),i(),l(3),i()),e&2){let t=s().$implicit;r(3),g(" ",t.attributes.ip_address," ")}}function Qi(e,n){if(e&1&&(o(0,"div",89)(1,"div",90)(2,"div",91)(3,"mat-icon",92),l(4),i()(),c(5,ji,1,0,"div",93),i(),o(6,"div",94)(7,"div",95)(8,"div")(9,"h4",76),l(10),i(),o(11,"p",96),l(12),i()(),c(13,Ui,4,2,"div",97),i(),c(14,Ki,4,2,"div",98),y(15,"keyvalue"),c(16,Ji,4,1,"div",99),i()()),e&2){let t=n.$implicit,a=n.$index,m=n.$count,u=s(3);r(4),p(u.getEventIcon(t.attributes.event)),r(),_(a!==m-1?5:-1),r(5),p(u.getEventLabel(t.attributes.event)),r(2),g(" ",u.formatDateTime(t.attributes.inserted_at)," "),r(),_(t.attributes.user_name?13:-1),r(),_(t.attributes.notes&&T(15,7,t.attributes.notes).length>0?14:-1),r(2),_(t.attributes.ip_address?16:-1)}}function Xi(e,n){if(e&1&&(o(0,"div",52),b(1,Qi,17,9,"div",89,Xe),i()),e&2){let t=s(2);r(),C(t.bookingEvents())}}function Zi(e,n){e&1&&(o(0,"div",53)(1,"mat-icon",102),l(2,"history"),i(),o(3,"p"),l(4,"No events available"),i()())}function tn(e,n){if(e&1){let t=R();o(0,"div",3)(1,"div",15)(2,"h2",16),l(3),i(),o(4,"div",17)(5,"mat-chip",18),l(6),y(7,"uppercase"),i(),o(8,"mat-chip",19),l(9),i()()(),o(10,"mat-tab-group",20),h("selectedIndexChange",function(m){B(t);let u=s();return L(u.selectedTabIndex.set(m))}),o(11,"mat-tab",21),nt(12,ni,3,0,"ng-template",22),o(13,"div",23)(14,"div",24)(15,"mat-card",25)(16,"mat-card-header")(17,"mat-card-title"),l(18,"Guest Information"),i()(),o(19,"mat-card-content")(20,"mat-list")(21,"mat-list-item")(22,"span",26),l(23,"Name"),i(),o(24,"span",27),l(25),i()(),o(26,"mat-list-item")(27,"span",26),l(28,"Email"),i(),o(29,"span",27),c(30,oi,2,3,"a",28)(31,ai,1,0),i()(),o(32,"mat-list-item")(33,"span",26),l(34,"Phone"),i(),o(35,"span",27),c(36,li,2,3,"a",28)(37,ri,1,0),i()(),o(38,"mat-list-item")(39,"span",26),l(40,"Country"),i(),o(41,"span",27),l(42),i()()()()(),o(43,"div",29)(44,"mat-card",25)(45,"mat-card-header")(46,"mat-card-title"),l(47,"Stay Period"),i()(),o(48,"mat-card-content")(49,"mat-list")(50,"mat-list-item")(51,"span",26),l(52,"Check-in"),i(),o(53,"span",27),l(54),i()(),o(55,"mat-list-item")(56,"span",26),l(57,"Check-out"),i(),o(58,"span",27),l(59),i()(),o(60,"mat-list-item")(61,"span",26),l(62,"Nights"),i(),o(63,"span",30),l(64),i()()()()(),o(65,"mat-card",25)(66,"mat-card-header")(67,"mat-card-title"),l(68,"Occupancy"),i()(),o(69,"mat-card-content")(70,"div",31)(71,"div",32)(72,"div",33),l(73),i(),o(74,"div",34),l(75,"Adults"),i()(),o(76,"div",32)(77,"div",35),l(78),i(),o(79,"div",34),l(80,"Children"),i()(),o(81,"div",32)(82,"div",36),l(83),i(),o(84,"div",34),l(85,"Rooms"),i()()()()()()(),o(86,"div",24)(87,"mat-card",25)(88,"mat-card-header")(89,"mat-card-title"),l(90,"OTA Information"),i()(),o(91,"mat-card-content")(92,"mat-list")(93,"mat-list-item")(94,"span",26),l(95,"OTA Provider"),i(),o(96,"span",27),l(97),i()(),o(98,"mat-list-item")(99,"span",26),l(100,"Booking ID"),i(),o(101,"span",37),l(102),i()(),o(103,"mat-list-item")(104,"span",26),l(105,"OTA Commission"),i(),o(106,"span",27),c(107,mi,1,1)(108,di,1,0),i()(),o(109,"mat-list-item")(110,"span",26),l(111,"Received At"),i(),o(112,"span",27),l(113),y(114,"slice"),i()()()()(),o(115,"mat-card",25)(116,"mat-card-header")(117,"mat-card-title"),l(118,"Payment Information"),i()(),o(119,"mat-card-content")(120,"mat-list")(121,"mat-list-item")(122,"span",26),l(123,"Total Amount"),i(),o(124,"span",30),l(125),i()(),o(126,"mat-list-item")(127,"span",26),l(128,"Payment Collect"),i(),o(129,"span",27),c(130,si,2,0,"span",38)(131,ci,2,0,"span",39)(132,_i,2,0,"span",13),i()(),c(133,xi,7,1,"mat-list-item"),c(134,vi,5,1,"mat-list-item"),i()()()(),o(135,"mat-card",40)(136,"h3",41)(137,"mat-icon",42),l(138,"bed"),i(),l(139," Room Details "),i(),c(140,Mi,3,0,"mat-accordion",43)(141,Bi,2,0,"div",44),i(),o(142,"mat-card",25)(143,"mat-card-header")(144,"mat-card-title"),l(145,"Price Summary"),i()(),o(146,"mat-card-content")(147,"mat-list")(148,"mat-list-item")(149,"span",26),l(150,"Rooms Total"),i(),o(151,"span",45),l(152),i()(),c(153,Li,5,1,"mat-list-item"),c(154,Ri,5,1,"mat-list-item",46),S(155,"mat-divider"),o(156,"mat-list-item")(157,"span",47),l(158,"Total Amount"),i(),o(159,"span",48),l(160),i()()()()(),c(161,$i,9,3,"mat-card",49),i()(),o(162,"mat-tab",50),nt(163,Oi,3,0,"ng-template",22),o(164,"div",23),c(165,Vi,2,0,"div",51),c(166,Xi,3,0,"div",52),c(167,Zi,5,0,"div",53),i()()()()}if(e&2){let t,a,m,u,x,v,I,mt,F,Z,tt,et,dt,st,ct,A,w,N,_t,pt,P,ut,gt,$,M,d=s();r(3),p((t=d.booking())==null?null:t.unique_id),r(2),k("color",d.getStatusChip((a=d.booking())==null?null:a.status).color),r(),g(" ",T(7,33,d.getStatusChip((m=d.booking())==null?null:m.status).label)," "),r(2),k("ngClass",d.getPaymentStatus(d.booking())==="Paid"?"bg-green-100! text-green-800!":d.getPaymentStatus(d.booking())==="Prepaid"?"bg-blue-100! text-blue-800!":"bg-amber-100! text-amber-800!"),r(),g(" ",d.getPaymentStatus(d.booking())," "),r(),k("selectedIndex",d.selectedTabIndex()),r(15),p(d.customerName()),r(5),_(!((u=d.booking())==null||u.customer==null)&&u.customer.mail?30:31),r(6),_(!((x=d.booking())==null||x.customer==null)&&x.customer.phone?36:37),r(6),p(((v=d.booking())==null||v.customer==null?null:v.customer.country)||"N/A"),r(12),p(d.formatDate((I=d.booking())==null?null:I.arrival_date)||"N/A"),r(5),p(d.formatDate((mt=d.booking())==null?null:mt.departure_date)||"N/A"),r(5),g(" ",d.calculateNights((F=d.booking())==null?null:F.arrival_date,(F=d.booking())==null?null:F.departure_date)||"N/A"," "),r(9),p(((Z=d.booking())==null||Z.occupancy==null?null:Z.occupancy.adults)||0),r(5),p(((tt=d.booking())==null||tt.occupancy==null?null:tt.occupancy.children)||0),r(5),p(((et=d.booking())==null||et.rooms==null?null:et.rooms.length)||0),r(14),p(((dt=d.booking())==null?null:dt.ota_name)||"N/A"),r(5),p(((st=d.booking())==null?null:st.ota_reservation_code)||"N/A"),r(5),_((ct=d.booking())!=null&&ct.ota_commission?107:108),r(6),p((A=d.booking())!=null&&A.inserted_at?Et(114,35,(A=d.booking())==null?null:A.inserted_at,0,10):"N/A"),r(12),p(d.formatCurrency((w=d.booking())==null?null:w.amount,(w=d.booking())==null?null:w.currency)),r(5),_(((N=d.booking())==null?null:N.payment_collect)==="ota"?130:((N=d.booking())==null?null:N.payment_collect)==="property"?131:132),r(3),_((_t=d.booking())!=null&&_t.payment_type?133:-1),r(),_((pt=d.booking())!=null&&pt.guarantee?134:-1),r(6),_((P=d.booking())!=null&&P.rooms&&((P=d.booking())==null?null:P.rooms.length)>0?140:141),r(12),g(" ",d.formatCurrency(d.getTotalRoomPrice(d.booking()),(ut=d.booking())==null?null:ut.currency)," "),r(),_(d.getTotalTaxes(d.booking())>0?153:-1),r(),_((gt=d.booking())!=null&&gt.ota_commission?154:-1),r(6),g(" ",d.formatCurrency(($=d.booking())==null?null:$.amount,($=d.booking())==null?null:$.currency)," "),r(),_((M=d.booking())!=null&&M.notes||(M=d.booking())!=null&&M.services||(M=d.booking())!=null&&M.guarantee?161:-1),r(4),_(d.bookingEventsResource.isLoading()?165:-1),r(),_(!d.bookingEventsResource.isLoading()&&d.bookingEvents().length>0?166:-1),r(),_(!d.bookingEventsResource.isLoading()&&d.bookingEvents().length===0?167:-1)}}var Me=class e{route=f(Bt);router=f(Lt);bookingService=f(De);dialog=f(be);snackBar=f(Ft);storeStore=f(At);bookingId=E("");selectedTabIndex=E(0);bookingResource=lt({params:()=>{let n=this.bookingId();return n?{id:n}:null},stream:({params:n})=>{if(!n)throw new Error("No booking ID");return this.bookingService.getBookingDetails(n.id)}});bookingEventsResource=lt({params:()=>{let n=this.bookingId(),t=this.selectedTabIndex();return n&&t===1?{id:n}:null},stream:n=>{let t=n.params;return t?this.bookingService.getBookingEvents(t.id):xt({data:[]})}});booking=D(()=>{let n=this.bookingResource.value();return n?.data?n.data.attributes||n.data:null});rawData=D(()=>this.bookingResource.value()?.data);property=D(()=>{let n=this.rawData();return n?.relationships?.property?.data?n.relationships.property.data:null});roomTypes=D(()=>{let n=this.rawData();if(!n?.relationships?.room_types?.data)return[];let t=n.relationships.room_types.data;return Array.isArray(t)?t:[t]});bookingEvents=D(()=>{try{let t=this.bookingEventsResource.value();if(t?.data&&Array.isArray(t.data)&&t.data.length>0)return t.data.sort((a,m)=>{let u=new Date(a.attributes.inserted_at).getTime();return new Date(m.attributes.inserted_at).getTime()-u})}catch{}let n=this.rawData();return n?.relationships?.events?.data?n.relationships.events.data.sort((t,a)=>{let m=new Date(t.attributes.inserted_at).getTime();return new Date(a.attributes.inserted_at).getTime()-m}):[]});customerName=D(()=>{let n=this.booking();if(!n?.customer)return"N/A";let t=n.customer;return`${t.name||""} ${t.surname||""}`.trim()||"N/A"});ngOnInit(){this.route.params.subscribe(n=>{n.id&&this.bookingId.set(n.id)})}goBack(){this.router.navigate(["/menu/hms/channel-management/live-booking"])}getStatusChip(n){return{new:{color:"accent",label:"New"},modified:{color:"warn",label:"Modified"},cancelled:{color:"warn",label:"Cancelled"}}[n]||{color:"primary",label:"Unknown"}}getEventIcon(n){return{booking_created:"add_circle",booking_modified:"edit",booking_cancelled:"cancel",booking_confirmed:"check_circle",booking_webhook_sent:"send",booking_received_via_booking_find:"search",booking_received_via_booking_list:"list"}[n]||"info"}getEventLabel(n){return{booking_created:"Booking Created",booking_modified:"Booking Modified",booking_cancelled:"Booking Cancelled",booking_confirmed:"Booking Confirmed",booking_webhook_sent:"Webhook Sent",booking_received_via_booking_find:"Received via Booking Find",booking_received_via_booking_list:"Received via Booking List"}[n]||n}getPaymentStatus(n){if(!n)return"Unknown";let t=n.payment_collect||"property",a=parseFloat(n.amount||0);return t==="ota"&&a>0?"Prepaid":t==="ota"?"Paid":"Pending"}formatCurrency(n,t="USD"){try{return new Intl.NumberFormat("en-US",{style:"currency",currency:t}).format(parseFloat(n)||0)}catch{return`${t} ${n}`}}formatDate(n){try{return new Date(n).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}catch{return n}}formatDateTime(n){try{return new Date(n).toLocaleString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return n}}calculateNights(n,t){try{let a=new Date(n),m=new Date(t);return Math.ceil((m.getTime()-a.getTime())/(1e3*3600*24))}catch{return 0}}getTotalRoomPrice(n){return n?.rooms?n.rooms.reduce((t,a)=>t+parseFloat(a.amount||0),0):0}getTotalTaxes(n){return n?.rooms?n.rooms.reduce((t,a)=>a.taxes?t+a.taxes.reduce((m,u)=>m+parseFloat(u.total_price||0),0):t,0):0}getRoomTypeName(n){let t=this.roomTypes();return!t||t.length===0?"Room":t.find(m=>(m.id||m.attributes?.id)===n)?.attributes?.title||"Room"}isBoolean(n){return typeof n=="boolean"}hasUnassignedRooms(){let n=this.booking();return n?.rooms?n.rooms.some(t=>!t.room||!t.room._id):!1}openAssignRoomDialog(){let n=this.booking();if(!n||!n.rooms)return;if(!n.rooms.every(m=>!m.room||!m.room._id)){this.snackBar.open("All rooms are already assigned","Close",{duration:5e3});return}this.dialog.open(X,{width:"800px",maxWidth:"90vw",data:{bookingId:this.bookingId(),rooms:n.rooms||[],roomTypes:this.roomTypes(),currency:n.currency||"USD",storeId:this.storeStore.selectedStore()?._id||""}}).afterClosed().subscribe(m=>{m?.success&&(this.snackBar.open("Rooms assigned successfully","Close",{duration:5e3}),this.bookingResource.reload())})}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=O({type:e,selectors:[["app-live-booking-details"]],decls:6,vars:4,consts:[["title","Booking Details","subtitle","View complete booking information and guest details"],["actions",""],[1,"flex","justify-center","items-center","py-16"],[1,"container","py-8"],["matButton","tonal","color","primary"],["matButton","outlined",3,"click"],["matButton","tonal","color","primary",3,"click"],["diameter","40"],["appearance","outlined",1,"max-w-md","mx-auto"],[1,"py-12!"],[1,"flex","flex-col","items-center","text-center","gap-4"],[1,"text-red-500","text-5xl!"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-gray-600"],["matButton","outlined","color","primary",3,"click"],[1,"mb-6"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],[1,"flex","items-center","gap-2","mb-4"],["selected","",3,"color"],[3,"ngClass"],[1,"booking-tabs",3,"selectedIndexChange","selectedIndex"],["label","Info"],["mat-tab-label",""],[1,"pt-6"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","mb-6"],["appearance","outlined"],["matListItemTitle",""],["matListItemMeta",""],[1,"text-blue-600","hover:underline",3,"href"],[1,"space-y-6"],["matListItemMeta","",1,"text-lg","font-bold"],[1,"grid","grid-cols-3","gap-3"],[1,"text-center"],[1,"text-2xl","font-bold","text-purple-600"],[1,"text-xs","text-gray-600","mt-2"],[1,"text-2xl","font-bold","text-pink-600"],[1,"text-2xl","font-bold","text-amber-600"],["matListItemMeta","",1,"break-all"],[1,"text-green-600","font-semibold"],[1,"text-amber-600","font-semibold"],["appearance","outlined",1,"mb-6","p-2"],[1,"text-lg","font-semibold","text-gray-900","mb-4","flex","items-center","gap-2"],[1,"text-blue-600"],[1,"space-y-2"],[1,"text-center","py-8","text-gray-600"],["matListItemLine","",1,"text-right","font-semibold"],[1,"text-amber-700"],["matListItemTitle","",1,"text-lg","font-bold"],["matListItemLine","",1,"text-right","text-lg","font-bold","text-blue-600"],["appearance","outlined",1,"mt-6"],["label","Timeline"],[1,"flex","justify-center","items-center","py-12"],[1,"space-y-4"],[1,"text-center","py-12","text-gray-600"],[1,"mr-2"],[1,"flex","items-center","justify-between","w-full","pr-4"],[1,"flex","items-center","gap-3"],[1,"font-semibold"],[1,"text-lg","font-bold","text-blue-600"],[1,"space-y-6","py-4"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","pb-4","border-b"],[1,"text-xs","text-gray-600","font-semibold"],[1,"font-bold","text-gray-900","mt-1"],[1,"bg-green-50","rounded","p-3","border","border-green-200"],[1,"pt-2","border-t"],[1,"text-sm","font-semibold","text-gray-700","mb-3"],[1,"pricing-list"],["matListItemMeta","",1,"font-bold","text-blue-600","text-lg"],["matListItemMeta","",1,"font-semibold","text-gray-900"],[1,"text-sm","font-semibold","text-green-900","mb-2"],[1,"text-sm","text-green-800"],[1,"flex","items-center","justify-between","bg-amber-50","p-3","rounded"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-xs","text-gray-600"],[1,"text-green-600"],[1,"text-amber-600"],[1,"font-semibold","text-gray-900"],[1,"text-sm","font-semibold","text-gray-700","mb-2"],[1,"space-y-1","text-sm"],[1,"text-gray-700"],[1,"font-semibold","text-gray-900","mb-3","flex","items-center","gap-2"],[1,"text-base"],[1,"bg-gray-50","rounded","p-4","text-sm","text-gray-700","whitespace-pre-wrap"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3"],[1,"bg-purple-50","rounded","p-3","text-sm"],[1,"font-medium","text-gray-900"],[1,"text-gray-700","text-xs","mt-1"],["matListItemLine",""],["matListItemLine","",1,"bg-blue-100!","text-blue-800!"],[1,"flex","gap-4"],[1,"flex","flex-col","items-center"],[1,"rounded-full","p-2","bg-blue-100"],[1,"text-blue-600","text-base"],[1,"w-0.5","h-12","bg-gray-300","mt-2"],[1,"flex-1","pb-6"],[1,"flex","items-start","justify-between"],[1,"text-sm","text-gray-600","mt-1"],[1,"text-sm","text-gray-600","text-right"],[1,"mt-3","bg-gray-50","rounded","p-3","text-sm","space-y-2"],[1,"mt-2","text-xs","text-gray-500"],[1,"text-xs","text-gray-500"],[1,"align-text-bottom","text-base"],[1,"text-5xl!","text-gray-400","mb-4"]],template:function(t,a){t&1&&(o(0,"app-page-header",0),ft(1,1),c(2,ti,5,1),bt(),i(),c(3,ei,2,0,"div",2),c(4,ii,14,1,"div",3),c(5,tn,168,39,"div",3)),t&2&&(r(2),_(!a.bookingResource.isLoading()&&a.booking()?2:-1),r(),_(a.bookingResource.isLoading()?3:-1),r(),_(a.bookingResource.error()?4:-1),r(),_(!a.bookingResource.isLoading()&&a.booking()?5:-1))},dependencies:[V,St,q,H,Nt,Pt,wt,G,j,z,U,Q,he,K,se,Y,W,de,le,re,me,zt,xe,J,ue,ge,_e,ce,pe,Ut,Gt,$t,Ot,jt,Vt,Se,Tt,Mt,ht,Dt],styles:["[_nghost-%COMP%]{display:block}.container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 1rem}mat-card[appearance=outlined][_ngcontent-%COMP%]{--mdc-theme-surface: rgb(255, 255, 255)}mat-card-header[_ngcontent-%COMP%]{margin-bottom:1rem}.loading-container[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1rem;min-height:300px}@media(max-width:768px){.container[_ngcontent-%COMP%]{padding:0 .5rem}mat-card-content[_ngcontent-%COMP%]{padding:1rem!important}.grid[_ngcontent-%COMP%]{gap:1rem}}"],changeDetection:0})};export{Me as LiveBookingDetails};
