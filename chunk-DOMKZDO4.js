import{a as c}from"./chunk-AGZJ637K.js";import{x as n,y as b}from"./chunk-ETP2OZKZ.js";import{V as a,Z as R,ba as d,d as u,r as m,ta as l}from"./chunk-KGWH6IHP.js";import{a as g,b as h}from"./chunk-EQDQRRRY.js";var y=class p{constructor(e){this.http=e}baseUrl=c.apiUrl;roomsSignal=l([]);roomTypesSignal=l([]);loadingSignal=l(!1);errorSignal=l(null);rooms=this.roomsSignal.asReadonly();roomTypes=this.roomTypesSignal.asReadonly();loading=this.loadingSignal.asReadonly();error=this.errorSignal.asReadonly();getRooms(e,t){this.loadingSignal.set(!0),this.errorSignal.set(null);let o=new n;return t&&(t.status?.length&&(o=o.set("status",t.status.join(","))),t.housekeepingStatus?.length&&(o=o.set("housekeepingStatus",t.housekeepingStatus.join(","))),t.roomType?.length&&(o=o.set("roomType",t.roomType.join(","))),t.floor?.length&&(o=o.set("floor",t.floor.join(","))),t.search&&(o=o.set("search",t.search))),this.http.get(`${this.baseUrl}/rooms/${e}/store`,{params:o}).pipe(a(s=>{this.roomsSignal.set(s),this.loadingSignal.set(!1)}),m(s=>s))}getRoomsByFloor(e){return this.http.get(`${this.baseUrl}/rooms/${e}/by-floor`)}getRoom(e){return this.http.get(`${this.baseUrl}/rooms/${e}`)}getRoomsByIds(e){if(!e||e.length===0)return new u(o=>{o.next([]),o.complete()});let t=new n().set("ids",e.join(","));return this.http.get(`${this.baseUrl}/rooms/batch`,{params:t})}createRoom(e,t){let o=h(g({},t),{store:e});return this.http.post(`${this.baseUrl}/rooms`,o).pipe(a(s=>{let r=this.roomsSignal();this.roomsSignal.set([...r,s])}))}updateRoom(e,t){return this.http.put(`${this.baseUrl}/rooms/${e}`,t).pipe(a(o=>{let s=this.roomsSignal(),r=s.findIndex(i=>i._id===e||i.id===e);if(r!==-1){let i=[...s];i[r]=o,this.roomsSignal.set(i)}}))}updateRoomStatus(e,t,o){let s={status:t,notes:o};return this.http.put(`${this.baseUrl}/rooms/${e}/status`,s)}updateHousekeepingStatus(e,t,o){let s={housekeepingStatus:t,notes:o};return this.http.put(`${this.baseUrl}/rooms/${e}/housekeeping`,s)}deleteRoom(e){return this.http.delete(`${this.baseUrl}/rooms/${e}`).pipe(a(()=>{let t=this.roomsSignal();this.roomsSignal.set(t.filter(o=>o._id!==e&&o.id!==e))}))}getAvailableRooms(e){let t=new n().set("checkIn",e.checkInDate).set("checkOut",e.checkOutDate);return e.roomTypeId&&(t=t.set("roomTypeId",e.roomTypeId)),e.excludeReservationId&&(t=t.set("excludeReservationId",e.excludeReservationId)),this.http.get(`${this.baseUrl}/rooms/${e.storeId}/availability`,{params:t}).pipe(m(o=>o.data||[]))}getRoomStats(e){return this.http.get(`${this.baseUrl}/rooms/${e}/stats`)}getMaintenanceRooms(e){return this.http.get(`${this.baseUrl}/rooms/${e}/maintenance`)}bulkUpdateRoomStatus(e,t,o){let s={roomIds:e,status:t,notes:o};return this.http.put(`${this.baseUrl}/rooms/bulk/status`,s)}getRoomTypes(e,t){this.loadingSignal.set(!0),this.errorSignal.set(null);let o=new n;return t&&(t.active!==void 0&&(o=o.set("active",t.active.toString())),t.minPrice!==void 0&&(o=o.set("minPrice",t.minPrice.toString())),t.maxPrice!==void 0&&(o=o.set("maxPrice",t.maxPrice.toString())),t.amenities?.length&&(o=o.set("amenities",t.amenities.join(","))),t.search&&(o=o.set("search",t.search))),this.http.get(`${this.baseUrl}/room-types/${e}/store`,{params:o}).pipe(a(s=>{this.roomTypesSignal.set(s),this.loadingSignal.set(!1)}),m(s=>s))}getRoomType(e){return this.http.get(`${this.baseUrl}/room-types/${e}`)}createRoomType(e,t){let o=h(g({},t),{store:e});return this.http.post(`${this.baseUrl}/room-types`,o).pipe(a(s=>{let r=this.roomTypesSignal();this.roomTypesSignal.set([...r,s])}))}updateRoomType(e,t){return this.http.put(`${this.baseUrl}/room-types/${e}`,t).pipe(a(o=>{let s=this.roomTypesSignal(),r=s.findIndex(i=>i._id===e||i.id===e);if(r!==-1){let i=[...s];i[r]=o,this.roomTypesSignal.set(i)}}))}deleteRoomType(e){return this.http.delete(`${this.baseUrl}/room-types/${e}`).pipe(a(()=>{let t=this.roomTypesSignal();this.roomTypesSignal.set(t.filter(o=>o._id!==e&&o.id!==e))}))}getAvailableRoomTypes(e,t,o){let s=new n().set("checkIn",t).set("checkOut",o);return this.http.get(`${this.baseUrl}/room-types/${e}/availability`,{params:s})}updateRoomTypesSortOrder(e,t){return this.http.put(`${this.baseUrl}/room-types/${e}/sort-order`,t)}getRoomTypeStats(e){return this.http.get(`${this.baseUrl}/room-types/${e}/stats`)}clearState(){this.roomsSignal.set([]),this.roomTypesSignal.set([]),this.errorSignal.set(null),this.loadingSignal.set(!1)}setLoading(e){this.loadingSignal.set(e)}setError(e){this.errorSignal.set(e)}static \u0275fac=function(t){return new(t||p)(d(b))};static \u0275prov=R({token:p,factory:p.\u0275fac,providedIn:"root"})};export{y as a};
