import{a as O,b as it,c as ot}from"./chunk-V6Q2J3ZF.js";import{a as nt}from"./chunk-LO5LXT4F.js";import{d as Xe,e as Ze,f as et,h as tt,k as H}from"./chunk-XSZYAESL.js";import{a as Je}from"./chunk-4QMHOUIB.js";import{a as A,b as Ye}from"./chunk-5NCGVO7F.js";import"./chunk-HOFFRLAS.js";import"./chunk-OFQMF3WN.js";import{a as Ve,b as Ae,c as He,d as Oe,e as $e,f as Ge,g as je,h as Qe,i as ze,j as We,k as Ue,l as Ke}from"./chunk-BAU4EBFS.js";import{a as ye,b as he,c as Se,d as Me}from"./chunk-4P4GBQE7.js";import{i as T}from"./chunk-ZKQYDJ5W.js";import{a as V}from"./chunk-6IOSO6X2.js";import{a as Fe,b as qe}from"./chunk-LCF3SYDV.js";import{d as de}from"./chunk-ZLVLWRZH.js";import{d as Be}from"./chunk-HJGFVW6K.js";import"./chunk-TVH27JLT.js";import"./chunk-G4CZ6LK2.js";import"./chunk-I564X6SI.js";import"./chunk-VTDH2LYT.js";import{b as R,c as k,d as F}from"./chunk-63HT37SK.js";import{a as N,b as Pe,c as Re,d as ke,h as P}from"./chunk-YJCGHVXK.js";import"./chunk-UHBDKNKX.js";import{a as q,b as B}from"./chunk-3ZLH5HUN.js";import{A as Ie,B as Ne,b as L,d as _,g as I,h as be,l as ve,m as xe,s as De,t as we,y as Te,z as Le}from"./chunk-O5GCTPYR.js";import"./chunk-EGLRIU4H.js";import{a as w,b as ce}from"./chunk-5TL46KBL.js";import{a as ue}from"./chunk-53AK2UWQ.js";import"./chunk-BFT2MTJY.js";import{a as Ce,c as ge,h as Ee}from"./chunk-JONI64R4.js";import"./chunk-H7INH462.js";import"./chunk-OOL2KACG.js";import"./chunk-KZJMNFJ3.js";import{b as fe,c as _e}from"./chunk-G6I3OKXX.js";import{Z as se,_ as x,ba as D}from"./chunk-4Z2XUZY2.js";import"./chunk-H22US2IH.js";import{Gc as pe,Ib as d,Jb as s,Lb as j,Mb as Q,Nb as z,Ob as f,Pb as o,Qb as i,Rb as c,Vb as y,Wb as h,Y as ie,Yb as ne,ac as E,bb as l,cc as v,fa as p,gc as W,hc as U,ic as K,ka as $,la as G,mc as ae,qb as b,rc as r,sc as C,tc as Y,wa as oe,wb as g,xc as re,yc as le,zc as me}from"./chunk-P5WOETP4.js";import"./chunk-GAL4ENT6.js";function ct(e,t){e&1&&(o(0,"mat-error"),r(1," Name is required "),i())}function ut(e,t){if(e&1&&(o(0,"mat-option",8),r(1),i()),e&2){let a=t.$implicit;f("value",a),l(),C(a)}}function ft(e,t){e&1&&(o(0,"mat-error"),r(1," Gender is required "),i())}function _t(e,t){if(e&1&&(o(0,"mat-option",8),r(1),i()),e&2){let a=t.$implicit;f("value",a),l(),C(a)}}function Ct(e,t){e&1&&(o(0,"mat-error"),r(1," Role is required "),i())}function gt(e,t){e&1&&(o(0,"mat-hint"),r(1,"Role cannot be changed for owners"),i())}function Et(e,t){e&1&&(o(0,"mat-error"),r(1," Email is required "),i())}function yt(e,t){e&1&&(o(0,"mat-error"),r(1," Please enter a valid email address "),i())}function ht(e,t){e&1&&(o(0,"mat-error"),r(1," Phone number is required "),i())}function St(e,t){e&1&&(o(0,"mat-error"),r(1," PIN is required "),i())}function Mt(e,t){e&1&&(o(0,"mat-error"),r(1," PIN must be exactly 4 digits "),i())}function bt(e,t){e&1&&c(0,"mat-spinner",16)}var S=class e{storeStore=p(T);fb=p(Le);userService=p(V);snackBar=p(w);dialogRef=p(Xe);data=p(Ze);sessionStorage=p(ue);isSubmitting=oe(!1);roles=["Owner","Cashier","Waiter","Admin","Courier","Kitchen"];genders=["Male","Female"];isEdit=this.data.isEdit;form=this.fb.group({name:["",[_.required]],gender:["",[_.required]],email:["",[_.required,_.email]],phoneNumber:["",[_.required]],pin:["",[_.required,_.minLength(4),_.maxLength(4)]],role:[{value:"",disabled:this.isRoleDisabled()},[_.required]],store:[this.storeStore.selectedStore()?._id,_.required]});isRoleDisabled(){return this.isEdit&&this.data.employee?.role==="Owner"}ngOnInit(){this.isEdit&&this.data.employee&&this.form.patchValue(this.data.employee)}onSubmit(){if(this.form.valid){this.isSubmitting.set(!0);let t=this.form.getRawValue();(this.isEdit?this.userService.updateMerchant(this.data.employee._id,t):this.userService.createMerchant(t)).subscribe({next:n=>{if(n?.err?.code===11e3&&n?.err?.keyPattern){let m="Error creating/updating employee";n.err.keyPattern.email?m="Email already exists":n.err.keyPattern.phoneNumber&&(m="Phone number already exists"),this.snackBar.open(m,"Close",{duration:3e3}),this.isSubmitting.set(!1);return}this.snackBar.open(`Employee ${this.isEdit?"updated":"created"} successfully`,"Close",{duration:3e3}),this.dialogRef.close(!0)},error:n=>{this.snackBar.open(`Error ${this.isEdit?"updating":"creating"} employee`,"Close",{duration:3e3}),this.isSubmitting.set(!1)}})}}onCancel(){this.dialogRef.close()}static \u0275fac=function(a){return new(a||e)};static \u0275cmp=b({type:e,selectors:[["app-employee-dialog"]],decls:50,vars:15,consts:[[1,"p-6"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter employee name"],[1,"grid","grid-cols-2","gap-4"],["formControlName","gender"],[3,"value"],["formControlName","role"],["matInput","","formControlName","email","type","email","placeholder","Enter email address"],["matInput","","formControlName","phoneNumber","placeholder","Enter phone number"],["matInput","","formControlName","pin","type","password","maxlength","4","placeholder","Enter 4-digit PIN"],[1,"flex","justify-end","space-x-2","mt-6","pt-4","border-t","border-gray-200"],["mat-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",1,"mr-2"]],template:function(a,n){if(a&1&&(o(0,"div",0)(1,"h2",1),r(2),i(),o(3,"form",2),E("ngSubmit",function(){return n.onSubmit()}),o(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),r(7,"Name"),i(),c(8,"input",5),d(9,ct,2,0,"mat-error"),i(),o(10,"div",6)(11,"mat-form-field",4)(12,"mat-label"),r(13,"Gender"),i(),o(14,"mat-select",7),Q(15,ut,2,2,"mat-option",8,j),i(),d(17,ft,2,0,"mat-error"),i(),o(18,"mat-form-field",4)(19,"mat-label"),r(20,"Role"),i(),o(21,"mat-select",9),Q(22,_t,2,2,"mat-option",8,j),i(),d(24,Ct,2,0,"mat-error"),d(25,gt,2,0,"mat-hint"),i()(),o(26,"mat-form-field",4)(27,"mat-label"),r(28,"Email"),i(),c(29,"input",10),d(30,Et,2,0,"mat-error"),d(31,yt,2,0,"mat-error"),i(),o(32,"div",6)(33,"mat-form-field",4)(34,"mat-label"),r(35,"Phone Number"),i(),c(36,"input",11),d(37,ht,2,0,"mat-error"),i(),o(38,"mat-form-field",4)(39,"mat-label"),r(40,"PIN"),i(),c(41,"input",12),d(42,St,2,0,"mat-error"),d(43,Mt,2,0,"mat-error"),i()()(),o(44,"div",13)(45,"button",14),E("click",function(){return n.onCancel()}),r(46,"Cancel"),i(),o(47,"button",15),d(48,bt,1,0,"mat-spinner",16),r(49),i()()()()),a&2){let m,u,J,X,Z,ee,te,M;l(2),Y(" ",n.isEdit?"Edit Employee":"Create New Employee"," "),l(),f("formGroup",n.form),l(6),s((m=n.form.get("name"))!=null&&m.hasError("required")?9:-1),l(6),z(n.genders),l(2),s((u=n.form.get("gender"))!=null&&u.hasError("required")?17:-1),l(5),z(n.roles),l(2),s((J=n.form.get("role"))!=null&&J.hasError("required")?24:-1),l(),s(n.isRoleDisabled()?25:-1),l(5),s((X=n.form.get("email"))!=null&&X.hasError("required")?30:-1),l(),s((Z=n.form.get("email"))!=null&&Z.hasError("email")?31:-1),l(6),s((ee=n.form.get("phoneNumber"))!=null&&ee.hasError("required")?37:-1),l(5),s((te=n.form.get("pin"))!=null&&te.hasError("required")?42:-1),l(),s((M=n.form.get("pin"))!=null&&M.hasError("minlength")||(M=n.form.get("pin"))!=null&&M.hasError("maxlength")?43:-1),l(2),f("disabled",n.isSubmitting()),l(2),f("disabled",!n.form.valid||n.isSubmitting()),l(),s(n.isSubmitting()?48:-1),l(),Y(" ",n.isEdit?"Update":"Create"," ")}},dependencies:[H,tt,D,x,R,P,N,Re,Pe,F,k,qe,Fe,de,Ne,xe,L,I,be,Te,we,De,B,q],encapsulation:2})};var vt=()=>[5,10,25,100];function xt(e,t){e&1&&(o(0,"div",10),c(1,"mat-spinner",14),i())}function Dt(e,t){e&1&&c(0,"app-no-record",11)}function wt(e,t){e&1&&c(0,"app-no-record",12)}function Tt(e,t){e&1&&(o(0,"th",28),r(1,"Name"),i())}function Lt(e,t){if(e&1&&(o(0,"td",29),r(1),i()),e&2){let a=t.$implicit;l(),C(a.name)}}function It(e,t){e&1&&(o(0,"th",28),r(1,"Gender"),i())}function Nt(e,t){if(e&1&&(o(0,"td",29),r(1),i()),e&2){let a=t.$implicit;l(),C(a.gender)}}function Pt(e,t){e&1&&(o(0,"th",28),r(1,"Email"),i())}function Rt(e,t){if(e&1&&(o(0,"td",29),r(1),i()),e&2){let a=t.$implicit;l(),C(a.email)}}function kt(e,t){e&1&&(o(0,"th",28),r(1,"Phone"),i())}function Ft(e,t){if(e&1&&(o(0,"td",29),r(1),i()),e&2){let a=t.$implicit;l(),C(a.phoneNumber)}}function qt(e,t){e&1&&(o(0,"th",28),r(1,"Role"),i())}function Bt(e,t){if(e&1&&(o(0,"td",29),r(1),i()),e&2){let a=t.$implicit;l(),C(a.role)}}function Vt(e,t){e&1&&(o(0,"th",30),r(1,"Actions"),i())}function At(e,t){if(e&1){let a=ne();o(0,"td",29)(1,"button",31)(2,"mat-icon"),r(3,"more_vert"),i()(),o(4,"mat-menu",null,0)(6,"button",32),E("click",function(){let m=$(a).$implicit,u=v(2);return G(u.editEmployee(m))}),o(7,"mat-icon"),r(8,"edit"),i(),o(9,"span"),r(10,"Edit"),i()(),o(11,"button",32),E("click",function(){let m=$(a).$implicit,u=v(2);return G(u.deleteEmployee(m))}),o(12,"mat-icon"),r(13,"delete"),i(),o(14,"span"),r(15,"Delete"),i()()()()}if(e&2){let a=ae(5);l(),f("matMenuTriggerFor",a)}}function Ht(e,t){e&1&&c(0,"tr",33)}function Ot(e,t){e&1&&c(0,"tr",34)}function $t(e,t){if(e&1&&(o(0,"div",13)(1,"table",15),y(2,16),g(3,Tt,2,0,"th",17)(4,Lt,2,1,"td",18),h(),y(5,19),g(6,It,2,0,"th",17)(7,Nt,2,1,"td",18),h(),y(8,20),g(9,Pt,2,0,"th",17)(10,Rt,2,1,"td",18),h(),y(11,21),g(12,kt,2,0,"th",17)(13,Ft,2,1,"td",18),h(),y(14,22),g(15,qt,2,0,"th",17)(16,Bt,2,1,"td",18),h(),y(17,23),g(18,Vt,2,0,"th",24)(19,At,16,1,"td",18),h(),g(20,Ht,1,0,"tr",25)(21,Ot,1,0,"tr",26),i(),c(22,"mat-paginator",27),i()),e&2){let a=v();l(),f("dataSource",a.dataSource),l(19),f("matHeaderRowDef",a.displayedColumns),l(),f("matRowDefColumns",a.displayedColumns),l(),f("pageSizeOptions",pe(4,vt))}}var at=class e{dialog=p(et);snackBar=p(w);userService=p(V);storeStore=p(T);displayedColumns=["name","gender","email","phoneNumber","role","actions"];dataSource;searchText="";paginator;sort;employees=Be({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:t})=>this.userService.getStoreMerchants(t.storeId).pipe(ie(a=>{this.dataSource=new Ke(a),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}))});applyFilter(t){let a=t.target.value;this.dataSource.filter=a.trim().toLowerCase()}openDialog(){this.dialog.open(S,{width:"800px",data:{isEdit:!1}}).afterClosed().subscribe(a=>{a&&this.employees.reload()})}editEmployee(t){this.dialog.open(S,{width:"800px",data:{isEdit:!0,employee:t}}).afterClosed().subscribe(n=>{n&&this.employees.reload()})}deleteEmployee(t){if(t.role==="Owner"){this.snackBar.open("Cannot delete an owner","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"});return}this.dialog.open(nt,{width:"350px",data:{message:`Are you sure you want to delete ${t.name}?`}}).afterClosed().subscribe(n=>{n&&this.userService.deleteMerchant(t._id).subscribe({next:()=>{this.snackBar.open("Employee deleted successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.employees.reload()},error:()=>{this.snackBar.open("Error deleting employee","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})})}static \u0275fac=function(a){return new(a||e)};static \u0275cmp=b({type:e,selectors:[["app-list-employees"]],viewQuery:function(a,n){if(a&1&&(W(A,5),W(O,5)),a&2){let m;U(m=K())&&(n.paginator=m.first),U(m=K())&&(n.sort=m.first)}},decls:19,vars:2,consts:[["menu","matMenu"],[1,"employees-container","!bg-white"],[1,"!bg-white"],[1,"flex","flex-col","md:flex-row","justify-between","gap-4","p-4"],[1,"flex","flex-col","sm:flex-row","gap-4","flex-grow"],["appearance","outline",1,"w-full","sm:w-48","md:w-72","lg:w-96"],["matPrefix",""],["matInput","","placeholder","Search employees",3,"keyup","ngModelChange","ngModel"],[1,"flex","gap-3","justify-end"],["mat-raised-button","","color","primary",3,"click"],[1,"flex","items-center","justify-center","min-h-[300px]"],["icon","people","title","No Employees","message","No employees found matching your criteria."],["icon","error","title","Error","message","An error occurred while fetching employees. Please try again later."],[1,"table-container","!bg-white"],["diameter","40"],["mat-table","","matSort","",1,"!bg-white",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","gender"],["matColumnDef","email"],["matColumnDef","phoneNumber"],["matColumnDef","role"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of employees",1,"!bg-white",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","aria-label","Employee actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(a,n){a&1&&(o(0,"mat-card",1)(1,"mat-card-content",2)(2,"div",3)(3,"div",4)(4,"mat-form-field",5)(5,"mat-label"),r(6,"Search"),i(),o(7,"mat-icon",6),r(8,"search"),i(),o(9,"input",7),E("keyup",function(u){return n.applyFilter(u)}),me("ngModelChange",function(u){return le(n.searchText,u)||(n.searchText=u),u}),i()()(),o(10,"div",8)(11,"button",9),E("click",function(){return n.openDialog()}),o(12,"mat-icon"),r(13,"add"),i(),r(14," ADD EMPLOYEE "),i()()(),d(15,xt,2,0,"div",10)(16,Dt,1,0,"app-no-record",11)(17,wt,1,0,"app-no-record",12)(18,$t,23,5,"div",13),i()()),a&2&&(l(9),re("ngModel",n.searchText),l(6),s(n.employees.isLoading()?15:n.employees.hasValue()&&n.dataSource.data.length===0?16:n.employees.error()?17:n.employees.hasValue()?18:-1))},dependencies:[Ue,Ve,He,je,Oe,Ae,Qe,$e,Ge,ze,We,Ye,A,ot,O,it,Ee,Ce,ge,R,P,N,ke,F,k,D,x,se,_e,fe,Me,he,ye,Se,B,q,Je,H,ce,Ie,L,I,ve],encapsulation:2})};export{at as EmployeeListComponent};
