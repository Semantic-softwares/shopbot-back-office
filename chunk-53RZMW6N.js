import{a as ne,b as ae,e as le,h as me}from"./chunk-XNNKKASY.js";import{i as $}from"./chunk-QC7H4KPM.js";import{a as re,b as ie}from"./chunk-WZDQ5XTC.js";import{d as q}from"./chunk-R6JGHN2R.js";import{d as oe}from"./chunk-BXJEGH2V.js";import{a as B}from"./chunk-XLZTIYSF.js";import{b as W,c as X,d as Y}from"./chunk-UMV4DCPT.js";import{a as J,b as K,h as Q}from"./chunk-G3VZM262.js";import{a as ee,b as te}from"./chunk-6I3AJKA7.js";import{B as H,b as R,d as m,g as V,h as A,m as G,s as j,t as Z,z}from"./chunk-W7NMJLMQ.js";import{a as L}from"./chunk-4UBDYPTG.js";import{a as O}from"./chunk-BFT2MTJY.js";import{_ as k,ba as w}from"./chunk-3LDCGXHW.js";import{y as I}from"./chunk-6PFJHDFS.js";import{Fc as U,Ib as u,Jb as d,Kb as P,Mb as T,Nb as F,Ob as f,Pb as n,Qb as i,Rb as p,aa as N,ac as C,bb as l,fa as s,qb as x,rc as a,tc as g,wa as v}from"./chunk-J2AK4FW5.js";var b=class e{http=s(I);hostServer=O.apiUrl;validateEmailAndPhoneNumber({email:t,phoneNumber:r}){return this.http.post(`${this.hostServer}/auth/validate-email-and-phone?userType=merchant`,{email:t,phoneNumber:r})}createCustomer(t){return this.http.post(`${this.hostServer}/users`,t)}getStoreCustomers(t){return this.http.get(`${this.hostServer}/users/stores/${t}/users`)}deleteCustomer(t){return this.http.delete(`${this.hostServer}/users/${t}`)}updateCustomer(t,r){return this.http.put(`${this.hostServer}/users/${t}`,r)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=N({token:e,factory:e.\u0275fac,providedIn:"root"})};var de=()=>[];function pe(e,t){e&1&&(n(0,"mat-error"),a(1," Name is required "),i())}function ce(e,t){e&1&&(n(0,"mat-error"),a(1," Name must be at least 2 characters "),i())}function fe(e,t){e&1&&(n(0,"mat-error"),a(1," Email is required "),i())}function he(e,t){e&1&&(n(0,"mat-error"),a(1," Please enter a valid email address "),i())}function Ce(e,t){e&1&&(n(0,"mat-error"),a(1," Email must be lowercase "),i())}function ge(e,t){e&1&&(n(0,"mat-error"),a(1," Phone number is required "),i())}function be(e,t){e&1&&(n(0,"mat-error"),a(1," Phone number must be at least 6 digits "),i())}function ve(e,t){if(e&1&&(n(0,"mat-option",9),a(1),i()),e&2){let r=t.$implicit;f("value",r.country),l(),g(" ",r.country," ")}}function _e(e,t){e&1&&(n(0,"mat-error"),a(1," Country is required "),i())}function Se(e,t){e&1&&p(0,"mat-spinner",14)}function Ee(e){if(e.value){let t=e.value.toLowerCase();if(t!==e.value)return{lowercaseEmail:t}}return null}var se=class e{storeStore=s($);fb=s(z);customerService=s(b);snackBar=s(L);dialogRef=s(ne);data=s(ae);storeService=s(B);isSubmitting=v(!1);genders=["Male","Female"];isEdit=this.data.isEdit;form=this.fb.group({name:["",[m.required,m.minLength(2)]],email:["",[m.required,m.email,Ee]],phoneNumber:["",[m.required,m.minLength(6)]],country:["",m.required],currency:["",m.required],notes:[""],store:[this.storeStore.selectedStore()?._id,m.required],password:["123456",m.required]});isLoading=v(!1);deliveryZones=oe({stream:()=>this.storeService.getDeliveryZonesFromServer()});ngOnInit(){this.isEdit&&this.data.customer&&this.form.patchValue(this.data.customer)}selectCountry(t){let r=this.deliveryZones.value().find(o=>o.country===t);r&&this.form.patchValue({currency:r.currency})}onSubmit(){if(this.form.valid){this.isSubmitting.set(!0);let t=this.form.getRawValue();this.isEdit?this.customerService.updateCustomer(this.data.customer._id,t).subscribe(r=>{this.dialogRef.close(!0)},r=>{this.isLoading.set(!1),this.snackBar.open("Server or internet error please try again","Close",{duration:3e3})}):this.customerService.createCustomer(t).subscribe(r=>{r.status==401||r?.err?r.err.keyPattern.hasOwnProperty("email")?(this.isLoading.set(!1),this.snackBar.open("Email has already been used.","Close",{duration:3e3})):r.err.keyPattern.hasOwnProperty("phoneNumber")&&(this.isLoading.set(!1),this.snackBar.open("Phone number has already been used.","Close",{duration:3e3})):this.dialogRef.close(!0)},r=>{this.isLoading.set(!1),this.snackBar.open("Server or internet error please try again","Close",{duration:3e3})})}}onCancel(){this.dialogRef.close()}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=x({type:e,selectors:[["app-customer-dialog"]],decls:41,vars:15,consts:[[1,"p-6"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter customer name"],["matInput","","formControlName","email","type","email","placeholder","Enter email address"],["matInput","","formControlName","phoneNumber","placeholder","Enter phone number"],["formControlName","country","placeholder","Select country",3,"selectionChange"],[3,"value"],["matInput","","formControlName","notes","placeholder","Enter any additional notes"],[1,"flex","justify-end","space-x-2","mt-6","pt-4","border-t","border-gray-200"],["mat-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",1,"mr-2"]],template:function(r,o){if(r&1&&(n(0,"div",0)(1,"h2",1),a(2),i(),n(3,"form",2),C("ngSubmit",function(){return o.onSubmit()}),n(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),a(7,"Name"),i(),p(8,"input",5),u(9,pe,2,0,"mat-error"),u(10,ce,2,0,"mat-error"),i(),n(11,"mat-form-field",4)(12,"mat-label"),a(13,"Email"),i(),p(14,"input",6),u(15,fe,2,0,"mat-error"),u(16,he,2,0,"mat-error"),u(17,Ce,2,0,"mat-error"),i(),n(18,"mat-form-field",4)(19,"mat-label"),a(20,"Phone Number"),i(),p(21,"input",7),u(22,ge,2,0,"mat-error"),u(23,be,2,0,"mat-error"),i(),n(24,"mat-form-field",4)(25,"mat-label"),a(26,"Country"),i(),n(27,"mat-select",8),C("selectionChange",function(h){return o.selectCountry(h.value)}),T(28,ve,2,2,"mat-option",9,P),i(),u(30,_e,2,0,"mat-error"),i(),n(31,"mat-form-field",4)(32,"mat-label"),a(33,"Notes"),i(),p(34,"textarea",10),i()(),n(35,"div",11)(36,"button",12),C("click",function(){return o.onCancel()}),a(37,"Cancel"),i(),n(38,"button",13),u(39,Se,1,0,"mat-spinner",14),a(40),i()()()()),r&2){let c,h,_,S,E,y,D,M;l(2),g(" ",o.isEdit?"Edit Customer":"Create New Customer"," "),l(),f("formGroup",o.form),l(6),d((c=o.form.get("name"))!=null&&c.hasError("required")?9:-1),l(),d((h=o.form.get("name"))!=null&&h.hasError("minlength")?10:-1),l(5),d((_=o.form.get("email"))!=null&&_.hasError("required")?15:-1),l(),d((S=o.form.get("email"))!=null&&S.hasError("email")?16:-1),l(),d((E=o.form.get("email"))!=null&&E.hasError("lowercase")?17:-1),l(5),d((y=o.form.get("phoneNumber"))!=null&&y.hasError("required")?22:-1),l(),d((D=o.form.get("phoneNumber"))!=null&&D.hasError("minlength")?23:-1),l(5),F(o.deliveryZones.value()||U(14,de)),l(2),d((M=o.form.get("country"))!=null&&M.hasError("required")?30:-1),l(6),f("disabled",o.isSubmitting()),l(2),f("disabled",!o.form.valid||o.isSubmitting()),l(),d(o.isSubmitting()?39:-1),l(),g(" ",o.isEdit?"Update":"Create"," ")}},dependencies:[me,le,w,k,W,Q,J,K,Y,X,ie,re,q,H,G,R,V,A,Z,j,te,ee],encapsulation:2})};export{b as a,se as b};
