import{a as Gt}from"./chunk-SBP5BLOD.js";import{a as qt}from"./chunk-52EMKFJP.js";import{a as Ut}from"./chunk-2NKDIV7A.js";import"./chunk-RTDQ4NOX.js";import{a as B}from"./chunk-N4WB6XHF.js";import"./chunk-KONCWWBY.js";import{a as Rt,b as jt,c as j,d as Bt,g as Ot}from"./chunk-273NEODF.js";import{a as R}from"./chunk-XISJ3OTQ.js";import"./chunk-MS4AQ6UA.js";import{a as $t,b as Dt}from"./chunk-IZ3CMLEE.js";import{a as $,b as D}from"./chunk-E5GOXSYX.js";import"./chunk-U3ROV4NJ.js";import"./chunk-BGOXKF75.js";import"./chunk-W3I56YZS.js";import{c as dt}from"./chunk-LQHE4KOT.js";import{c as Vt,j as wt,k as It,l as Ft,m as Lt}from"./chunk-45WBWQMH.js";import{a as xt,b as Et,c as Mt,d as Pt,e as kt}from"./chunk-2OS3A6OW.js";import{a as pt}from"./chunk-I5AGE2YJ.js";import"./chunk-L3V4XNTA.js";import{j as Tt,l as At,m as Nt}from"./chunk-3INXVFYI.js";import"./chunk-YEVPAQY6.js";import{c as x}from"./chunk-45N66JJF.js";import"./chunk-JMDTRE27.js";import{b as ft,d as f,g as vt,h as gt,m as ht,n as St,o as bt,q as Ct,u as _t,w as yt}from"./chunk-7VZONRG3.js";import{a as T,b as A}from"./chunk-USY657EX.js";import{O as N,i as ct,j as F,k as L}from"./chunk-SZQEISYT.js";import{I as ut}from"./chunk-V6BWQRYA.js";import{a as at,c as lt,d as st,g as mt}from"./chunk-B5BMUNHO.js";import{o as ot,p as I,v as nt}from"./chunk-2NDSKVKU.js";import{$ as Y,Bb as C,Cb as _,Db as W,Eb as X,Ec as w,Fb as v,Gb as g,Hb as p,Ib as r,Jb as i,Kb as m,Ob as Q,Sb as u,Tb as h,Wa as K,Xb as Z,Yb as tt,Za as l,Zb as et,cb as y,ea as c,gc as a,hc as k,ic as S,jb as P,jc as V,ka as G,la as U,ma as z,na as J,r as M,ua as b,vc as it,xc as rt}from"./chunk-EV5SF5GC.js";import{f as H}from"./chunk-EQDQRRRY.js";var O=class n{orders;hostServer=ut.apiUrl;_httpClient=c(nt);createStation(e){return this._httpClient.post(`${this.hostServer}/stations`,e)}getStations(e){return this._httpClient.get(`${this.hostServer}/stations`)}getStation(e){return this._httpClient.get(`${this.hostServer}/stations/${e}`)}updateStation(e,t){return this._httpClient.put(`${this.hostServer}/stations/${e}`,t)}deleteStation(e){return this._httpClient.delete(`${this.hostServer}/stations/${e}`)}getStoreStations(e){return this._httpClient.get(`${this.hostServer}/stations/store/${e}/stations`)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Y({token:n,factory:n.\u0275fac,providedIn:"root"})};var Zt=["variantList"],te=(n,e)=>e._id;function ee(n,e){n&1&&(r(0,"div",6),m(1,"mat-spinner",13),i())}function ie(n,e){n&1&&(r(0,"p",7),a(1,"Error loading variants"),i())}function re(n,e){n&1&&m(0,"app-no-record",8)}function oe(n,e){if(n&1&&(r(0,"mat-list-option",14),a(1),r(2,"div",15),a(3),i()()),n&2){let t=e.$implicit,o=h(2);p("value",t)("selected",o.isSelected(t._id))("checkboxPosition","before"),l(),S(" ",t.name," "),l(2),V(" At least: ",t.atLeast," | At most: ",t.atMost," ")}}function ne(n,e){if(n&1&&(r(0,"mat-selection-list",9,0),v(2,oe,4,6,"mat-list-option",14,te),i()),n&2){let t=h();p("multiple",!0),l(2),g(t.variants.value())}}var q=class n{constructor(e,t){this.dialogRef=e;this.data=t}variantList;dialog=c(j);productService=c(B);storeStore=c(N);variants=x({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.productService.getStoreGroupOption(e.storeId)});isSelected(e){return this.data.selectedVariants.includes(e)}onCancel(){this.dialogRef.close()}onSave(e){let t=e.map(o=>o.value);this.dialogRef.close(t)}createNewVariant(){this.dialog.open(Ut,{width:"500px",data:{isEdit:!1}}).afterClosed().subscribe(t=>{t&&this.variants.reload()})}static \u0275fac=function(t){return new(t||n)(y(Rt),y(jt))};static \u0275cmp=P({type:n,selectors:[["app-add-variants-list"]],viewQuery:function(t,o){if(t&1&&Z(Zt,5),t&2){let s;tt(s=et())&&(o.variantList=s.first)}},decls:17,vars:2,consts:[["variantList",""],[1,"p-6"],[1,"flex","items-center","justify-between","mb-4"],["mat-dialog-title","",1,"text-xl","font-bold"],["mat-stroked-button","","color","primary",3,"click"],[1,"mr-2"],[1,"flex","items-center","justify-center","min-h-[200px]"],[1,"text-red-500"],["icon","tune","title","No Variants Available","message","Create your first variant to customize product options like sizes, colors, or flavors."],[3,"multiple"],[1,"flex","justify-end","space-x-2","mt-6","pt-4","border-t","border-gray-200"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],["diameter","40"],[3,"value","selected","checkboxPosition"],[1,"text-sm","text-gray-500"]],template:function(t,o){t&1&&(r(0,"div",1)(1,"div",2)(2,"h2",3),a(3,"Select Variants"),i(),r(4,"button",4),u("click",function(){return o.createNewVariant()}),r(5,"mat-icon",5),a(6,"add"),i(),a(7," New Variant "),i()(),C(8,ee,2,0,"div",6)(9,ie,2,0,"p",7)(10,re,1,0,"app-no-record",8)(11,ne,4,1,"mat-selection-list",9),r(12,"div",10)(13,"button",11),u("click",function(){return o.onCancel()}),a(14,"Cancel"),i(),r(15,"button",12),u("click",function(){return o.onSave(o.variantList.selectedOptions.selected)}),a(16," Save "),i()()()),t&2&&(l(8),_(o.variants.isLoading()?8:o.variants.error()?9:o.variants.hasValue()&&o.variants.value().length===0?10:o.variants.hasValue()?11:-1),l(7),p("disabled",!o.variants.hasValue()||o.variants.value().length===0))},dependencies:[I,Ot,Bt,L,F,Nt,At,Tt,D,$,A,T,R],encapsulation:2})};var Qt=(n,e)=>e.value,ae=(n,e)=>e.url,le=(n,e)=>e._id;function se(n,e){if(n&1&&(r(0,"mat-option",9),a(1),i()),n&2){let t=e.$implicit;p("value",t._id),l(),S(" ",t.name," ")}}function me(n,e){if(n&1&&(r(0,"mat-option",9),a(1),i()),n&2){let t=e.$implicit;p("value",t.value),l(),S(" ",t.viewValue," ")}}function de(n,e){if(n&1&&(r(0,"mat-option",9),a(1),i()),n&2){let t=e.$implicit;p("value",t._id),l(),S(" ",t.name," ")}}function ce(n,e){if(n&1){let t=Q();r(0,"div",54),m(1,"img",55),r(2,"button",56),u("click",function(){let s=G(t).$index,d=h(2);return U(d.removeImage(s))}),z(),r(3,"svg",57),m(4,"path",58),i()()()}if(n&2){let t=e.$implicit;l(),p("src",t.url,K)}}function pe(n,e){if(n&1&&(r(0,"div",27),v(1,ce,5,1,"div",54,ae),i()),n&2){let t=h();l(),g(t.selectedImages)}}function ue(n,e){if(n&1&&(r(0,"mat-option",9),a(1),i()),n&2){let t=e.$implicit;p("value",t.value),l(),S(" ",t.viewValue," ")}}function fe(n,e){if(n&1){let t=Q();r(0,"div",59)(1,"div")(2,"span"),a(3),i(),r(4,"span",60),a(5),i()(),r(6,"button",61),u("click",function(){let s=G(t).$implicit,d=h(2);return U(d.removeVariant(s))}),r(7,"mat-icon"),a(8,"close"),i()()()}if(n&2){let t=e.$implicit;l(3),k(t.name),l(2),V(" At least: ",t.atLeast," | At most: ",t.atMost," ")}}function ve(n,e){if(n&1&&(r(0,"div",47),v(1,fe,9,3,"div",59,le),i()),n&2){let t=h();l(),g(t.selectedVariants)}}function ge(n,e){n&1&&m(0,"app-no-record",48)}function he(n,e){n&1&&m(0,"mat-spinner",52)}var Ht=class n{constructor(e){this.fb=e;this.productForm=this.fb.group({menu:["",f.required],name:["",f.required],description:[""],units:["",f.required],store:[this.storeStore.selectedStore()?._id,f.required],station:[""],price:["",f.required],costPrice:["",f.required],quantity:["",f.required],initialStock:["",f.required],criticalStock:["",f.required],sku:[""],barcode:[""],stockLevelAlert:[!1],inStock:[""],images:[[]],profit:[0],active:[!0],options:[[]]}),this.productForm.get("price")?.valueChanges.subscribe(t=>{this.price.set(Number(t)||0),this.updateProfit()}),this.productForm.get("costPrice")?.valueChanges.subscribe(t=>{this.costPrice.set(Number(t)||0),this.updateProfit()})}route=c(at);router=c(lt);productService=c(B);stationService=c(O);categoryService=c(qt);storeStore=c(N);snackBar=c(pt);dialog=c(j);isSubmitting=b(!1);categories=x({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.categoryService.getStoreMenus(e.storeId)});stations=x({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.stationService.getStations(e.storeId)});productForm;newCategory="";productUnits=[{value:"slice",viewValue:"Slice"},{value:"crate",viewValue:"Crate"},{value:"amps",viewValue:"Amps"},{value:"plates",viewValue:"Plates"},{value:"trays",viewValue:"Trays"}];stockLevelAlertOptions=[{value:!0,viewValue:"Yes"},{value:!1,viewValue:"No"}];price=b(0);costPrice=b(0);profit=w(()=>this.price()-this.costPrice());selectedImages=[];selectedVariants=[];updateProfit(){let e=this.profit();this.productForm.patchValue({profit:e},{emitEvent:!1})}addCategory(){}openCategoryModal(e){e.stopPropagation(),this.dialog.open(Gt,{width:"500px",data:{isEdit:!1}}).afterClosed().subscribe(o=>{o&&(console.log("Category created:",o),this.productForm.patchValue({menu:o._id}),this.categories.reload())})}openVariantsDialog(){this.dialog.open(q,{width:"500px",data:{selectedVariants:this.selectedVariants.map(t=>t._id)}}).afterClosed().subscribe(t=>{t&&(this.selectedVariants=t,this.productForm.patchValue({options:t.map(o=>o._id)}))})}onFileSelected(e){let t=e.target;if(t.files){let o=Array.from(t.files),s=5;if(this.selectedImages.length+o.length>s){alert(`You can only upload up to ${s} images`);return}o.forEach(d=>{if(d.type.match(/image\/*/)&&d.size<5e6){let E=new FileReader;E.onload=Yt=>{this.selectedImages.push({url:Yt.target?.result,file:d})},E.readAsDataURL(d)}})}}removeImage(e){this.selectedImages.splice(e,1)}isEditMode=b(!1);productId=b(null);pageTitle=w(()=>this.isEditMode()?"Edit Product":"Create Product");submitButtonText=w(()=>this.isEditMode()?"Update Product":"Create Product");ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e&&(this.isEditMode.set(!0),this.productId.set(e),this.loadProduct(e))}loadProduct(e){this.productService.getProduct(e).subscribe({next:t=>{this.productForm.patchValue({menu:t.menu,name:t.name,description:t.description,units:t.units,station:t.station,price:t.price,costPrice:t.costPrice,quantity:t.quantity,initialStock:t.initialStock,criticalStock:t.criticalStockLevel,sku:t.sku,barcode:t.barcode,stockLevelAlert:t.stockLevelAlert,inStock:t.activate}),t.photos?.length&&(this.selectedImages=t.photos.map(o=>({url:o,file:null}))),t.options?.length&&(this.selectedVariants=t.options,this.productForm.patchValue({options:t.options.map(o=>o._id)}))},error:t=>{this.snackBar.open("Error loading product","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})}onSubmit(){return H(this,null,function*(){if(this.productForm.valid){this.isSubmitting.set(!0);let e=this.productForm.getRawValue(),t=this.productId();try{let o=yield M(this.isEditMode()?this.productService.saveProduct(e,t):this.productService.addProduct(e));e.options&&e.options.length>0&&(yield Promise.all(e.options.map(d=>M(this.productService.addProductIdToVariant(d,{productId:this.isEditMode()?t:o._id})))));let s=this.selectedImages.filter(d=>d.file);if(s.length>0){let d=new FormData;s.forEach(E=>{d.append("files",E.file)}),yield M(this.productService.uploadPhoto(d,this.isEditMode()?t:o._id))}this.showSuccessMessage()}catch(o){console.error("Error saving product:",o),this.snackBar.open(`Error ${this.isEditMode()?"updating":"creating"} product`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}finally{this.isSubmitting.set(!1)}}})}showSuccessMessage(){this.snackBar.open(`Product ${this.isEditMode()?"updated":"created"} successfully`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isEditMode()?this.router.navigate(["/dashboard/items/products"]):this.resetForm(),this.isSubmitting.set(!1)}resetForm(){this.productForm.reset({store:this.storeStore.selectedStore()?._id,stockLevelAlert:!1,images:[]}),this.selectedImages=[],Object.keys(this.productForm.controls).forEach(e=>{let t=this.productForm.get(e);t?.setErrors(null),t?.markAsUntouched()})}removeVariant(e){this.selectedVariants=this.selectedVariants.filter(t=>t._id!==e._id),this.productForm.patchValue({options:this.selectedVariants.map(t=>t._id)})}static \u0275fac=function(t){return new(t||n)(y(_t))};static \u0275cmp=P({type:n,selectors:[["app-create-product"]],decls:120,vars:11,consts:[[1,"m-5","max-w-7xl","mx-auto","bg-white","!mb-6"],[1,"!p-4","mb-6","border-b","border-gray-200"],[1,"text-xl","font-medium"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8","mb-8"],[1,"space-y-4"],[1,"text-lg","font-medium","text-gray-900","mb-5"],["appearance","outline",1,"w-full"],["formControlName","menu"],[3,"value"],[1,"!text-primary",3,"click"],[1,"align-middle","mr-2"],["matInput","","formControlName","name"],["matInput","","formControlName","description","rows","4",1,"min-h-[100px]"],["formControlName","units"],["formControlName","station"],[1,"w-full","p-4","bg-gray-50","rounded-lg"],[1,"text-base","font-medium","text-gray-900","mb-4"],[1,"flex","items-center","justify-center","w-full"],[1,"flex","flex-col","items-center","justify-center","w-full","h-32","border-2","border-gray-300","border-dashed","rounded-lg","cursor-pointer","bg-white","hover:bg-gray-50"],[1,"flex","flex-col","items-center","justify-center","pt-5","pb-6"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-8","h-8","mb-4","text-gray-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"],[1,"mb-2","text-sm","text-gray-500"],[1,"font-semibold"],[1,"text-xs","text-gray-500"],["type","file","accept","image/*","multiple","",1,"hidden",3,"change"],[1,"grid","grid-cols-2","sm:grid-cols-3","md:grid-cols-4","gap-4","mt-4"],[1,"space-y-6"],[1,"bg-gray-50","p-4","rounded-lg","space-y-4"],["matInput","","type","number","formControlName","price"],["matInput","","type","number","formControlName","costPrice"],[1,"flex","justify-between","items-center","bg-green-50","p-4","rounded"],[1,"font-medium","text-gray-900"],[1,"text-lg","font-medium","text-green-700"],["type","hidden","formControlName","profit"],["matInput","","type","number","formControlName","quantity"],["matInput","","type","number","formControlName","initialStock"],["matInput","","type","number","formControlName","criticalStock"],["formControlName","stockLevelAlert"],["matInput","","formControlName","sku"],["matInput","","formControlName","barcode"],[1,"bg-gray-50","p-4","rounded-lg"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-base","font-medium","text-gray-900"],["mat-stroked-button","","color","primary","type","button",3,"click"],[1,"mr-2"],[1,"space-y-2"],["icon","tune","title","No Variants Added","message","Variants allow you to create different versions of your product (e.g., sizes, flavors). Click 'Add Variants' to customize your product options."],[1,"flex","justify-end","gap-4","pt-6","border-t","border-gray-200"],["mat-stroked-button","","type","button","routerLink","/dashboard/items/products"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",1,"mr-2"],[1,"mb-8","pb-6"],[1,"relative","group"],["alt","Preview",1,"h-24","w-24","object-cover","rounded-lg","border","border-gray-200",3,"src"],["type","button",1,"absolute","top-1","right-1","bg-red-500","text-white","rounded-full","p-1","opacity-0","group-hover:opacity-100","transition-opacity",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex","items-center","justify-between","p-2","bg-white","rounded","border","border-gray-200"],[1,"text-sm","text-gray-500","ml-2"],["mat-icon-button","","type","button","color","warn",3,"click"]],template:function(t,o){if(t&1&&(r(0,"mat-card",0)(1,"mat-card-header",1)(2,"mat-card-title",2),a(3),i()(),r(4,"mat-card-content")(5,"form",3),u("ngSubmit",function(){return o.onSubmit()}),r(6,"div",4)(7,"div",5)(8,"h3",6),a(9,"Basic Information"),i(),r(10,"mat-form-field",7)(11,"mat-label"),a(12,"Category"),i(),r(13,"mat-select",8),v(14,se,2,2,"mat-option",9,X),r(16,"mat-option",10),u("click",function(d){return o.openCategoryModal(d)}),r(17,"mat-icon",11),a(18,"add"),i(),a(19," Add New Category "),i()()(),r(20,"mat-form-field",7)(21,"mat-label"),a(22,"Product Name"),i(),m(23,"input",12),i(),r(24,"mat-form-field",7)(25,"mat-label"),a(26,"Description"),i(),m(27,"textarea",13),i(),r(28,"mat-form-field",7)(29,"mat-label"),a(30,"Unit"),i(),r(31,"mat-select",14),v(32,me,2,2,"mat-option",9,Qt),i()(),r(34,"mat-form-field",7)(35,"mat-label"),a(36,"Station"),i(),r(37,"mat-select",15),v(38,de,2,2,"mat-option",9,W),i()(),r(40,"div",16)(41,"h4",17),a(42,"Product Images"),i(),r(43,"div",18)(44,"label",19)(45,"div",20),z(),r(46,"svg",21),m(47,"path",22),i(),J(),r(48,"p",23)(49,"span",24),a(50,"Click to upload"),i(),a(51," or drag and drop "),i(),r(52,"p",25),a(53,"PNG, JPG, GIF up to 5MB"),i()(),r(54,"input",26),u("change",function(d){return o.onFileSelected(d)}),i()()(),C(55,pe,3,0,"div",27),i()(),r(56,"div",28)(57,"h3",6),a(58,"Pricing & Stock Information"),i(),r(59,"div",29)(60,"mat-form-field",7)(61,"mat-label"),a(62,"Selling Price"),i(),m(63,"input",30),i(),r(64,"mat-form-field",7)(65,"mat-label"),a(66,"Cost Price"),i(),m(67,"input",31),i(),r(68,"div",32)(69,"span",33),a(70,"Profit:"),i(),r(71,"span",34),a(72),it(73,"currency"),i(),m(74,"input",35),i()(),r(75,"div",29)(76,"mat-form-field",7)(77,"mat-label"),a(78,"Quantity"),i(),m(79,"input",36),i(),r(80,"mat-form-field",7)(81,"mat-label"),a(82,"Initial Stock"),i(),m(83,"input",37),i(),r(84,"mat-form-field",7)(85,"mat-label"),a(86,"Critical Stock"),i(),m(87,"input",38),i(),r(88,"mat-form-field",7)(89,"mat-label"),a(90,"Stock Level Alert"),i(),r(91,"mat-select",39),v(92,ue,2,2,"mat-option",9,Qt),i()()(),r(94,"div",29)(95,"mat-form-field",7)(96,"mat-label"),a(97,"SKU"),i(),m(98,"input",40),i(),r(99,"mat-form-field",7)(100,"mat-label"),a(101,"Barcode"),i(),m(102,"input",41),i()(),r(103,"div",42)(104,"div",43)(105,"h4",44),a(106,"Variants"),i(),r(107,"button",45),u("click",function(){return o.openVariantsDialog()}),r(108,"mat-icon",46),a(109,"add"),i(),a(110," Add Variants "),i()(),C(111,ve,3,0,"div",47)(112,ge,1,0,"app-no-record",48),i()()(),r(113,"div",49)(114,"button",50),a(115,"Cancel"),i(),r(116,"button",51),C(117,he,1,0,"mat-spinner",52),a(118),i()()()()(),m(119,"div",53)),t&2){let s;l(3),k(o.pageTitle()),l(2),p("formGroup",o.productForm),l(9),g(o.categories.value()),l(18),g(o.productUnits),l(6),g(o.stations.value()),l(17),_(o.selectedImages.length>0?55:-1),l(17),k(rt(73,8,o.profit(),(s=o.storeStore.selectedStore())==null?null:s.currency)),l(20),g(o.stockLevelAlertOptions),l(19),_(o.selectedVariants.length>0?111:112),l(5),p("disabled",!o.productForm.valid||o.isSubmitting()),l(),_(o.isSubmitting()?117:-1),l(),S(" ",o.submitButtonText()," ")}},dependencies:[I,ot,kt,xt,Mt,Pt,Et,It,wt,Vt,Lt,Ft,Dt,$t,dt,L,F,ct,A,T,yt,ht,ft,St,vt,gt,bt,Ct,D,$,mt,st,R],styles:[".mat-mdc-form-field-subscript-wrapper{display:none}  .mat-mdc-form-field .mat-mdc-text-field-wrapper{background-color:#fff}"]})};export{Ht as CreateProductComponent};
