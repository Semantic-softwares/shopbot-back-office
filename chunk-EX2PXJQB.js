import{a as X}from"./chunk-GRQWNA4F.js";import{a as at}from"./chunk-M7CDMT4F.js";import{a as J,b as Je,c as Ke}from"./chunk-GYR27UWT.js";import{a as K,b as W}from"./chunk-4FCLVNHT.js";import{a as We,b as Xe,c as Ye,e as Ze,f as et,g as tt,h as it}from"./chunk-GS72R6E5.js";import{a as Ue}from"./chunk-ONWZVE76.js";import{a as U,b as Qe}from"./chunk-SLNANJBJ.js";import{a as Q,b as Ne,c as $e,d as Be,e as Ge,f as Ve,g as Ae,h as qe,i as He,j as je,k as ze}from"./chunk-SNJMCTTD.js";import"./chunk-GGOIOYKP.js";import"./chunk-LXK533WH.js";import{a as Ie,b as Fe,c as ke,d as Re}from"./chunk-EMC432UM.js";import"./chunk-YCI4GSMN.js";import{a as B}from"./chunk-NWQQ2VP3.js";import{a as j,b as z}from"./chunk-M54QIQPD.js";import"./chunk-ZXNLXZXA.js";import{d as k}from"./chunk-2NVE2BM3.js";import"./chunk-KAQLA7HR.js";import"./chunk-Y7XAAAUB.js";import{d as M}from"./chunk-USTUFZ7V.js";import"./chunk-DXWLW3LX.js";import{b as A,c as q,d as H}from"./chunk-7JNU3RG5.js";import{a as G,b as Ee,d as we,h as V}from"./chunk-3SKQMCZR.js";import"./chunk-UJ5WOJLI.js";import{a as Me,c as xe,g as ye}from"./chunk-X7SU23UW.js";import{a as Le,b as De}from"./chunk-W6FIBOPD.js";import{C as ve,E as Se,b as be,d as T,g as fe,h as ge,m as _e,n as Ce,s as he,t as Te}from"./chunk-EQD33MW2.js";import"./chunk-3R2L4BJM.js";import{a as $}from"./chunk-GGWIF4RR.js";import"./chunk-Y4VWLT32.js";import"./chunk-CDKFCYZ5.js";import{b as Pe,c as Oe}from"./chunk-2HLT5ZQQ.js";import{X as pe,Y as R,_ as N}from"./chunk-UUZHPQZB.js";import"./chunk-CQ6SLR32.js";import{a as ue}from"./chunk-BFT2MTJY.js";import{g as ce}from"./chunk-QAO3BBZ5.js";import"./chunk-KTA4MFBX.js";import{A as de}from"./chunk-HUSU2JWO.js";import{Bc as me,Eb as p,Fb as u,Gb as re,Ib as P,Jb as O,Kb as c,Lb as n,Mb as a,Nb as b,Rb as C,Rc as se,Sb as h,Ub as Z,Yb as f,Z as oe,Za as l,_b as v,ca as s,cc as L,dc as D,ec as I,ha as y,ia as E,ic as le,mb as w,nc as r,oc as F,pc as _,sb as g,ta as Y}from"./chunk-HCNG3XRF.js";import"./chunk-EQDQRRRY.js";var S=class t{http=s(de);baseUrl=ue.apiUrl;getStoreTables(e){return this.http.get(`${this.baseUrl}/tables/store/${e}`)}createTable(e){return this.http.post(`${this.baseUrl}/tables`,e)}updateTable(e,i){return this.http.put(`${this.baseUrl}/tables/${e}`,i)}deleteTable(e){return this.http.delete(`${this.baseUrl}/tables/${e}`)}getTableById(e){return this.http.get(`${this.baseUrl}/tables/${e}`)}static \u0275fac=function(i){return new(i||t)};static \u0275prov=oe({token:t,factory:t.\u0275fac,providedIn:"root"})};var ct=(t,e)=>e._id;function pt(t,e){t&1&&(n(0,"mat-error"),r(1," Table name is required "),a())}function ut(t,e){t&1&&(n(0,"mat-error"),r(1," Table name must be at least 2 characters "),a())}function bt(t,e){if(t&1&&(n(0,"mat-option",7),r(1),a()),t&2){let i=e.$implicit;c("value",i._id),l(),_(" ",i.name," ")}}function ft(t,e){t&1&&(n(0,"mat-error"),r(1," Category is required "),a())}function gt(t,e){t&1&&(n(0,"mat-error"),r(1," Number of guests is required "),a())}function _t(t,e){t&1&&(n(0,"mat-error"),r(1," Minimum 1 guest required "),a())}function Ct(t,e){t&1&&(n(0,"mat-error"),r(1," Maximum 20 guests allowed "),a())}var x=class t{fb=s(ve);tableService=s(S);tableCategoryService=s(X);storeStore=s(B);snackBar=s($);dialogRef=s(We);data=s(Xe);tableForm;isEdit=!1;isLoading=!1;categories=M({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.tableCategoryService.getStoreTableCategories(e.storeId)});ngOnInit(){this.isEdit=this.data?.mode==="edit",this.initForm(),this.isEdit&&this.data.table&&this.populateForm(this.data.table)}initForm(){this.tableForm=this.fb.group({name:["",[T.required,T.minLength(2)]],category:["",T.required],numberOfGuest:[1,[T.required,T.min(1),T.max(20)]],active:[!0],store:[this.storeStore.selectedStore()?._id]})}populateForm(e){this.tableForm.patchValue({name:e.name,category:typeof e.category=="object"?e.category._id:e.category,numberOfGuest:e.numberOfGuest,active:e.active,storeId:e.storeId})}onSubmit(){if(this.tableForm.valid){this.isLoading=!0;let e=this.tableForm.value;this.isEdit?this.tableService.updateTable(this.data.table._id,e).subscribe({next:()=>{this.snackBar.open("Table updated successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dialogRef.close(!0)},error:i=>{console.error("Error updating table:",i),this.snackBar.open("Error updating table","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isLoading=!1}}):this.tableService.createTable(e).subscribe({next:()=>{this.snackBar.open("Table created successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dialogRef.close(!0)},error:i=>{console.error("Error creating table:",i),this.snackBar.open("Error creating table","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isLoading=!1}})}}onCancel(){this.dialogRef.close(!1)}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=w({type:t,selectors:[["app-create-table"]],decls:35,vars:12,consts:[[1,"dialog-container"],["mat-dialog-title","",1,"text-xl","font-semibold","text-gray-900","mb-4"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter table name"],["formControlName","category"],[3,"value"],["matInput","","type","number","formControlName","numberOfGuest","placeholder","Maximum number of guests"],[1,"flex","items-center","gap-3"],["formControlName","active","color","primary"],[1,"text-sm","text-gray-600"],[1,"flex","justify-end","gap-3","pt-4"],["mat-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(i,o){if(i&1&&(n(0,"div",0)(1,"h2",1),r(2),a(),n(3,"form",2),f("ngSubmit",function(){return o.onSubmit()}),n(4,"mat-dialog-content",3)(5,"mat-form-field",4)(6,"mat-label"),r(7,"Table Name"),a(),b(8,"input",5),p(9,pt,2,0,"mat-error"),p(10,ut,2,0,"mat-error"),a(),n(11,"mat-form-field",4)(12,"mat-label"),r(13,"Category"),a(),n(14,"mat-select",6),P(15,bt,2,2,"mat-option",7,ct),a(),p(17,ft,2,0,"mat-error"),a(),n(18,"mat-form-field",4)(19,"mat-label"),r(20,"Number of Guests"),a(),b(21,"input",8),p(22,gt,2,0,"mat-error"),p(23,_t,2,0,"mat-error"),p(24,Ct,2,0,"mat-error"),a(),n(25,"div",9)(26,"mat-slide-toggle",10),r(27," Active "),a(),n(28,"span",11),r(29),a()()(),n(30,"mat-dialog-actions",12)(31,"button",13),f("click",function(){return o.onCancel()}),r(32," Cancel "),a(),n(33,"button",14),r(34),a()()()()),i&2){let m,d,ee,te,ie,ae,ne;l(2),_(" ",o.isEdit?"Edit Table":"Create New Table"," "),l(),c("formGroup",o.tableForm),l(6),u((m=o.tableForm.get("name"))!=null&&m.hasError("required")?9:-1),l(),u((d=o.tableForm.get("name"))!=null&&d.hasError("minlength")?10:-1),l(5),O(o.categories.value()),l(2),u((ee=o.tableForm.get("category"))!=null&&ee.hasError("required")?17:-1),l(5),u((te=o.tableForm.get("numberOfGuest"))!=null&&te.hasError("required")?22:-1),l(),u((ie=o.tableForm.get("numberOfGuest"))!=null&&ie.hasError("min")?23:-1),l(),u((ae=o.tableForm.get("numberOfGuest"))!=null&&ae.hasError("max")?24:-1),l(5),_(" ",(ne=o.tableForm.get("active"))!=null&&ne.value?"Table is active and available":"Table is inactive"," "),l(2),c("disabled",o.isLoading),l(2),c("disabled",o.tableForm.invalid||o.isLoading),l(),_(" ",o.isLoading?"Saving...":o.isEdit?"Update Table":"Create Table"," ")}},dependencies:[Se,_e,be,Ce,fe,ge,Te,he,it,Ze,tt,et,A,V,G,Ee,H,q,z,j,k,N,R,W,K],styles:[".dialog-container[_ngcontent-%COMP%]{min-width:400px}.dialog-container[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-form-field-subscript-wrapper[_ngcontent-%COMP%]{display:none}.dialog-container[_ngcontent-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{max-height:60vh;overflow-y:auto}.dialog-container[_ngcontent-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{--mdc-switch-selected-track-color: #1976d2;--mdc-switch-selected-handle-color: #1976d2}"]})};var ht=()=>[5,10,25,100];function Tt(t,e){if(t&1&&(n(0,"mat-option",8),r(1),a()),t&2){let i=e.$implicit;c("value",i._id),l(),_(" ",i.name," ")}}function vt(t,e){t&1&&(n(0,"div",14),b(1,"mat-spinner",18),a())}function St(t,e){t&1&&b(0,"app-no-record",15)}function Mt(t,e){t&1&&(n(0,"th",33),r(1,"Table Name"),a())}function xt(t,e){if(t&1&&(n(0,"td",34),r(1),a()),t&2){let i=e.$implicit;l(),F(i.name)}}function yt(t,e){t&1&&(n(0,"th",33),r(1,"Category"),a())}function Et(t,e){if(t&1&&(n(0,"td",35),r(1),a()),t&2){let i=e.$implicit;l(),F((i==null||i.category==null?null:i.category.name)||"No Category")}}function wt(t,e){t&1&&(n(0,"th",33),r(1,"Max Guests"),a())}function Pt(t,e){if(t&1&&(n(0,"td",35),r(1),a()),t&2){let i=e.$implicit;l(),F(i.numberOfGuest)}}function Ot(t,e){t&1&&(n(0,"th",36),r(1,"Current Order"),a())}function Lt(t,e){if(t&1&&(n(0,"span",37),r(1),a()),t&2){let i=v().$implicit;l(),_(" Order #",i.order._id==null?null:i.order._id.slice(-6)," ")}}function Dt(t,e){t&1&&(n(0,"span",38),r(1," Available "),a())}function It(t,e){if(t&1&&(n(0,"td",35),p(1,Lt,2,1,"span",37)(2,Dt,2,0,"span",38),a()),t&2){let i=e.$implicit;l(),u(i.order?1:2)}}function Ft(t,e){t&1&&(n(0,"th",36),r(1,"Status"),a())}function kt(t,e){if(t&1){let i=Z();n(0,"td",35)(1,"mat-slide-toggle",39),f("change",function(){let m=y(i).$implicit,d=v(2);return E(d.toggleTableStatus(m))}),a()()}if(t&2){let i=e.$implicit;l(),c("checked",i.active)}}function Rt(t,e){t&1&&(n(0,"th",36),r(1,"Actions"),a())}function Nt(t,e){if(t&1){let i=Z();n(0,"td",35)(1,"button",40)(2,"mat-icon"),r(3,"more_vert"),a()(),n(4,"mat-menu",null,0)(6,"button",41),f("click",function(){let m=y(i).$implicit,d=v(2);return E(d.editTable(m))}),n(7,"mat-icon"),r(8,"edit"),a(),n(9,"span"),r(10,"Edit"),a()(),n(11,"button",41),f("click",function(){let m=y(i).$implicit,d=v(2);return E(d.deleteTable(m))}),n(12,"mat-icon"),r(13,"delete"),a(),n(14,"span"),r(15,"Delete"),a()()()()}if(t&2){let i=le(5);l(),c("matMenuTriggerFor",i)}}function $t(t,e){t&1&&b(0,"tr",42)}function Bt(t,e){t&1&&b(0,"tr",43)}function Gt(t,e){if(t&1&&(n(0,"div",16)(1,"table",19),C(2,20),g(3,Mt,2,0,"th",21)(4,xt,2,1,"td",22),h(),C(5,23),g(6,yt,2,0,"th",21)(7,Et,2,1,"td",24),h(),C(8,25),g(9,wt,2,0,"th",21)(10,Pt,2,1,"td",24),h(),C(11,26),g(12,Ot,2,0,"th",27)(13,It,3,1,"td",24),h(),C(14,28),g(15,Ft,2,0,"th",27)(16,kt,2,1,"td",24),h(),C(17,29),g(18,Rt,2,0,"th",27)(19,Nt,16,1,"td",24),h(),g(20,$t,1,0,"tr",30)(21,Bt,1,0,"tr",31),a(),b(22,"mat-paginator",32),a()),t&2){let i=v();l(),c("dataSource",i.filteredTables()),l(19),c("matHeaderRowDef",i.displayedColumns),l(),c("matRowDefColumns",i.displayedColumns),l(),c("pageSizeOptions",me(4,ht))}}function Vt(t,e){t&1&&b(0,"app-no-record",17)}var ot=class t{tableService=s(S);tableCategoryService=s(X);storeStore=s(B);router=s(ce);dialog=s(Ye);snackBar=s($);searchTerm=Y("");selectedCategory=Y("all");displayedColumns=["name","category","numberOfGuest","order","active","actions"];dataSource=M({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.tableService.getStoreTables(e.storeId)});categories=M({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.tableCategoryService.getStoreTableCategories(e.storeId)});filteredTables=se(()=>{let e=this.searchTerm().toLowerCase(),i=this.selectedCategory();return this.dataSource.value()?.filter(o=>{let m=o.name.toLowerCase().includes(e),d=i==="all"||o?.category?._id===i;return m&&d})??[]});paginator;sort;table;onSearch(e){let i=e.target;this.searchTerm.set(i.value)}onCategoryChange(e){this.selectedCategory.set(e)}addTable(){this.dialog.open(x,{width:"500px",data:{mode:"create"}}).afterClosed().subscribe(i=>{i&&this.dataSource.reload()})}editTable(e){this.dialog.open(x,{width:"500px",data:{mode:"edit",table:e}}).afterClosed().subscribe(o=>{o&&this.dataSource.reload()})}deleteTable(e){this.dialog.open(at,{width:"400px",data:{message:`Are you sure you want to delete ${e.name}?`}}).afterClosed().subscribe(o=>{o&&this.tableService.deleteTable(e._id).subscribe({next:()=>{this.snackBar.open("Table deleted successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dataSource.reload()},error:m=>{console.error("Error deleting table:",m),this.snackBar.open("Error deleting table","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})})}toggleTableStatus(e){let i={active:!e.active};this.tableService.updateTable(e._id,i).subscribe({next:()=>{this.snackBar.open("Table status updated successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dataSource.reload()},error:()=>{this.snackBar.open("Error updating table status","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=w({type:t,selectors:[["app-list-tables"]],viewQuery:function(i,o){if(i&1&&(L(U,5),L(J,5),L(Q,5)),i&2){let m;D(m=I())&&(o.paginator=m.first),D(m=I())&&(o.sort=m.first),D(m=I())&&(o.table=m.first)}},decls:27,vars:1,consts:[["menu","matMenu"],[1,"tables-container","!bg-white","!rounded-xl","!shadow-lg","border","border-gray-100"],[1,"!bg-white"],[1,"flex","flex-col","md:flex-row","justify-between","gap-4","p-4","border-b"],[1,"flex","flex-col","sm:flex-row","gap-4","flex-grow"],["appearance","outline",1,"w-full","sm:w-48"],[3,"selectionChange"],["value","all"],[3,"value"],["appearance","outline",1,"w-full","sm:w-48","md:w-72","lg:w-96"],["matPrefix",""],["matInput","","placeholder","Search tables",3,"input"],[1,"flex","gap-3","justify-end"],["mat-raised-button","","color","primary",3,"click"],[1,"flex","items-center","justify-center","min-h-[300px]"],["icon","table_restaurant","title","No Tables","message","No tables found matching your criteria."],[1,"table-container","rounded-lg","overflow-x-auto","mt-4"],["icon","error","title","Error","message","An error occurred while fetching the data. Please try again later."],["diameter","40"],["mat-table","","matSort","",1,"!bg-white","min-w-full","rounded-lg",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","","class","bg-gray-50",4,"matHeaderCellDef"],["mat-cell","","class","font-semibold",4,"matCellDef"],["matColumnDef","category"],["mat-cell","",4,"matCellDef"],["matColumnDef","numberOfGuest"],["matColumnDef","order"],["mat-header-cell","","class","bg-gray-50",4,"matHeaderCellDef"],["matColumnDef","active"],["matColumnDef","actions"],["mat-header-row","","class","bg-gray-50",4,"matHeaderRowDef"],["mat-row","","class","hover:bg-gray-50 transition",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of tables",1,"!bg-white",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header","",1,"bg-gray-50"],["mat-cell","",1,"font-semibold"],["mat-cell",""],["mat-header-cell","",1,"bg-gray-50"],[1,"px-2","py-1","bg-orange-100","text-orange-800","rounded-full","text-xs"],[1,"px-2","py-1","bg-green-100","text-green-800","rounded-full","text-xs"],["color","primary",3,"change","checked"],["mat-icon-button","","aria-label","Table actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row","",1,"bg-gray-50"],["mat-row","",1,"hover:bg-gray-50","transition"]],template:function(i,o){i&1&&(n(0,"mat-card",1)(1,"mat-card-content",2)(2,"div",3)(3,"div",4)(4,"mat-form-field",5)(5,"mat-label"),r(6,"Category"),a(),n(7,"mat-select",6),f("selectionChange",function(d){return o.onCategoryChange(d.value)}),n(8,"mat-option",7),r(9,"All Categories"),a(),P(10,Tt,2,2,"mat-option",8,re),a()(),n(12,"mat-form-field",9)(13,"mat-label"),r(14,"Search"),a(),n(15,"mat-icon",10),r(16,"search"),a(),n(17,"input",11),f("input",function(d){return o.onSearch(d)}),a()()(),n(18,"div",12)(19,"button",13),f("click",function(){return o.addTable()}),n(20,"mat-icon"),r(21,"add"),a(),r(22," ADD TABLE "),a()()(),p(23,vt,2,0,"div",14)(24,St,1,0,"app-no-record",15)(25,Gt,23,5,"div",16)(26,Vt,1,0,"app-no-record",17),a()()),i&2&&(l(10),O(o.categories.value()),l(13),u(o.dataSource.isLoading()?23:o.dataSource.hasValue()&&o.filteredTables().length===0?24:o.dataSource.hasValue()?25:o.dataSource.error()?26:-1))},dependencies:[ze,Q,$e,Ae,Be,Ne,qe,Ge,Ve,He,je,Qe,U,Ke,J,Je,A,V,G,we,H,q,z,j,k,N,R,pe,ye,Me,xe,Re,Fe,Ie,ke,Oe,Pe,De,Le,W,K,Ue],styles:[".tables-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .mat-mdc-table[_ngcontent-%COMP%]{border-radius:8px}.tables-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .mat-mdc-table[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#374151;background-color:#f9fafb}.tables-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .mat-mdc-table[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]:hover{background-color:#f9fafb}.mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-form-field-subscript-wrapper[_ngcontent-%COMP%]{display:none}.mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}"]})};export{ot as ListTablesComponent};
