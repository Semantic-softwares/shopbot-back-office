import{a as se}from"./chunk-TYH3Z7BF.js";import{a as ae,b as le}from"./chunk-VCE2LHCK.js";import"./chunk-HFTRPIKU.js";import{a as ne,b as re}from"./chunk-P2VEYFPL.js";import{d as w}from"./chunk-T75DEOG5.js";import{b as ee}from"./chunk-KR7TMRYR.js";import{b as J,c as K,d as X}from"./chunk-IKP7S2Y7.js";import{a as B}from"./chunk-7QB7BEGO.js";import{c as oe}from"./chunk-ZD2MQVCP.js";import{a as ie}from"./chunk-EUHZN2UI.js";import"./chunk-M5357V7P.js";import"./chunk-SY26FGZT.js";import"./chunk-XYJ5R6BC.js";import{a as te}from"./chunk-YEWYHM4L.js";import{g as H}from"./chunk-PZG5LZPC.js";import{a as R,e as $,h as W}from"./chunk-GY37C2FD.js";import{C as U,E as j,b as I,d as m,g as V,h as L,m as D,n as O,s as Q,t as q,x as A,y as G}from"./chunk-2UT4NYMV.js";import"./chunk-S2P5547C.js";import{a as Y,b as Z}from"./chunk-MNFAJ2ZP.js";import"./chunk-AGG277FR.js";import"./chunk-N3VBTGB6.js";import"./chunk-4KLRET2M.js";import{Y as z,_ as N}from"./chunk-KSQJ4KAT.js";import"./chunk-RDMIWI4X.js";import"./chunk-AGZJ637K.js";import"./chunk-VYX7HJYX.js";import"./chunk-FORATDN3.js";import{Eb as C,Fb as _,Ib as y,Jb as P,Kb as h,Lb as t,Mb as e,Nb as g,Ub as E,Yb as c,Za as s,_b as d,ca as S,ha as p,ia as u,ic as F,mb as M,nc as i,oc as b,ta as x}from"./chunk-53XJD7JZ.js";import{a as T,b as k,f}from"./chunk-EQDQRRRY.js";var me=(a,n)=>n.value;function de(a,n){if(a&1){let r=E();t(0,"div",8)(1,"div",34)(2,"mat-icon",35),i(3,"check_circle"),e()(),t(4,"h4",36),i(5,"Printer Connected"),e(),t(6,"p",37),i(7),e(),t(8,"div",38)(9,"button",39),c("click",function(){p(r);let o=d();return u(o.testPrint())}),t(10,"mat-icon",40),i(11,"print"),e(),i(12," Test Print "),e(),t(13,"button",41),c("click",function(){p(r);let o=d();return u(o.testPaperUtilization())}),t(14,"mat-icon",40),i(15,"straighten"),e(),i(16," Test Paper Width "),e(),t(17,"div",42)(18,"input",43,0),c("change",function(o){p(r);let v=d();return u(v.uploadLogo(o))}),e(),t(20,"button",39),c("click",function(){p(r);let o=F(19);return u(o.click())}),t(21,"mat-icon",40),i(22,"image"),e(),i(23," Upload Logo "),e()(),t(24,"button",44),c("click",function(){p(r);let o=d();return u(o.disconnectPrinter())}),t(25,"mat-icon",40),i(26,"bluetooth_disabled"),e(),i(27," Disconnect "),e()()()}if(a&2){let r,l=d();s(7),b((r=l.connectedPrinter())==null?null:r.name)}}function pe(a,n){a&1&&(t(0,"mat-icon",48),i(1,"refresh"),e(),i(2," Connecting... "))}function ue(a,n){a&1&&(t(0,"mat-icon",40),i(1,"bluetooth"),e(),i(2," Connect Printer "))}function ge(a,n){if(a&1){let r=E();t(0,"div",8)(1,"div",45)(2,"mat-icon",46),i(3,"print_disabled"),e()(),t(4,"h4",36),i(5,"No Printer Connected"),e(),t(6,"p",37),i(7,"Connect a Bluetooth printer to enable receipt printing"),e(),t(8,"button",47),c("click",function(){p(r);let o=d();return u(o.connectPrinter())}),C(9,pe,3,0)(10,ue,3,0),e()()}if(a&2){let r=d();s(8),h("disabled",r.printerConnecting()),s(),_(r.printerConnecting()?9:10)}}function fe(a,n){if(a&1&&(t(0,"mat-option",18),i(1),e()),a&2){let r=n.$implicit;h("value",r.value),s(),b(r.label)}}function Se(a,n){if(a&1&&(t(0,"mat-option",18),i(1),e()),a&2){let r=n.$implicit;h("value",r.value),s(),b(r.label)}}function xe(a,n){a&1&&(t(0,"mat-icon",48),i(1,"refresh"),e(),i(2," Saving... "))}function he(a,n){a&1&&(t(0,"mat-icon",40),i(1,"save"),e(),i(2," Save Printer Settings "))}var ce=class a{fb=S(U);snackBar=S(B);storeService=S(te);printerService=S(se);storeStore=S(ie);loading=x(!1);saving=x(!1);printerConnecting=x(!1);printerConnected=x(!1);connectedPrinter=x(null);printerSettingsForm;paperSizeOptions=[{value:"58mm",label:"58mm (2.3 inches)"},{value:"80mm",label:"80mm (3.1 inches)"},{value:"112mm",label:"112mm (4.4 inches)"}];printQualityOptions=[{value:"draft",label:"Draft (Fast)"},{value:"normal",label:"Normal"},{value:"high",label:"High Quality"}];ngOnInit(){this.initializeForm(),this.loadSettings(),this.checkPrinterStatus()}initializeForm(){this.printerSettingsForm=this.fb.group({paperSize:["80mm",m.required],printQuality:["normal",m.required],autocut:[!0],headerText:[""],footerText:["Thank you for your stay!"],includeLogo:[!0],fontSize:[12,[m.required,m.min(8),m.max(20)]],lineSpacing:[1.2,[m.required,m.min(1),m.max(3)]]})}loadSettings(){this.loading.set(!0);let n=this.storeStore.selectedStore();n?.hotelSettings?.printerConfiguration&&this.printerSettingsForm.patchValue(n.hotelSettings.printerConfiguration),this.loading.set(!1)}checkPrinterStatus(){let n=this.printerService.getConnectedDeviceInfo();n&&(this.connectedPrinter.set(n),this.printerConnected.set(!0))}connectPrinter(){return f(this,null,function*(){this.printerConnecting.set(!0);try{yield this.printerService.connectToPrinter();let n=this.printerService.getConnectedDeviceInfo();n&&(this.connectedPrinter.set(n),this.printerConnected.set(!0),this.snackBar.open("Printer connected successfully!","Close",{duration:3e3}))}catch(n){console.error("Error connecting to printer:",n),this.snackBar.open("Failed to connect to printer.","Close",{duration:5e3})}finally{this.printerConnecting.set(!1)}})}disconnectPrinter(){this.printerService.disconnectPrinter(),this.connectedPrinter.set(null),this.printerConnected.set(!1),this.snackBar.open("Printer disconnected","Close",{duration:3e3})}getCurrentPrinterConfiguration(){let r=this.storeStore.selectedStore()?.hotelSettings?.printerConfiguration;return{paperSize:this.printerSettingsForm.get("paperSize")?.value||r?.paperSize||"80mm",printQuality:this.printerSettingsForm.get("printQuality")?.value||r?.printQuality||"normal",autocut:this.printerSettingsForm.get("autocut")?.value??r?.autocut??!0,headerText:this.printerSettingsForm.get("headerText")?.value||r?.headerText||"",footerText:this.printerSettingsForm.get("footerText")?.value||r?.footerText||"Thank you for your stay!",includeLogo:this.printerSettingsForm.get("includeLogo")?.value??r?.includeLogo??!0,fontSize:this.printerSettingsForm.get("fontSize")?.value||r?.fontSize||12,lineSpacing:this.printerSettingsForm.get("lineSpacing")?.value||r?.lineSpacing||1.2}}testPrint(){return f(this,null,function*(){try{let n=this.getCurrentPrinterConfiguration();yield this.printerService.testPrint(n),this.snackBar.open("Test print sent successfully!","Close",{duration:3e3})}catch(n){console.error("Error during test print:",n),this.snackBar.open("Test print failed.","Close",{duration:5e3})}})}testPaperUtilization(){return f(this,null,function*(){try{let n=this.getCurrentPrinterConfiguration();yield this.printerService.testPaperUtilization(n),this.snackBar.open("Paper utilization test sent!","Close",{duration:3e3})}catch(n){console.error("Error during paper utilization test:",n),this.snackBar.open("Paper utilization test failed.","Close",{duration:5e3})}})}uploadLogo(n){return f(this,null,function*(){let r=n.target;if(r.files&&r.files[0]){let l=r.files[0];try{let o=new FileReader;o.onload=v=>f(this,null,function*(){v.target?.result&&(yield this.printerService.uploadLogo(v.target.result),this.snackBar.open("Logo uploaded successfully!","Close",{duration:3e3}))}),o.readAsArrayBuffer(l)}catch(o){console.error("Error uploading logo:",o),this.snackBar.open("Failed to upload logo.","Close",{duration:5e3})}}})}savePrinterSettings(){if(this.printerSettingsForm.valid&&this.storeStore.selectedStore()){this.saving.set(!0);let n=this.storeStore.selectedStore(),r=this.printerSettingsForm.value,l={hotelSettings:k(T({},n.hotelSettings),{printerConfiguration:r})};this.storeService.updateStore(n._id,l).subscribe({next:()=>{this.storeService.getStore(n._id).subscribe({next:o=>{this.storeStore.updateStore(o),this.storeService.saveStoreLocally(o),this.saving.set(!1),this.snackBar.open("Printer settings saved successfully!","Close",{duration:3e3})},error:o=>{console.error("Error fetching updated store:",o),this.saving.set(!1),this.snackBar.open("Settings saved but failed to update local data.","Close",{duration:5e3})}})},error:o=>{console.error("Error saving printer settings:",o),this.saving.set(!1),this.snackBar.open("Failed to save printer settings.","Close",{duration:5e3})}})}}static \u0275fac=function(r){return new(r||a)};static \u0275cmp=M({type:a,selectors:[["app-printer-settings"]],decls:89,vars:4,consts:[["logoInput",""],[1,"py-6"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","overflow-hidden"],[1,"bg-gradient-to-r","from-gray-50","to-gray-100","px-6","py-4","border-b","border-gray-200"],[1,"text-lg","font-semibold","text-gray-900","flex","items-center","gap-2"],[1,"text-green-600"],[1,"p-6"],[1,"text-center","py-4"],[1,"mt-6","p-4","bg-blue-50","border","border-blue-200","rounded-lg"],[1,"font-semibold","text-blue-900","mb-2","flex","items-center","gap-2"],[1,"text-blue-600"],[1,"text-sm","text-blue-800","space-y-1"],[1,"text-purple-600"],[3,"ngSubmit","formGroup"],[1,"space-y-6"],["appearance","outline",1,"w-full"],["formControlName","paperSize"],[3,"value"],["matSuffix",""],["formControlName","printQuality"],[1,"grid","grid-cols-2","gap-4"],["appearance","outline"],["matInput","","type","number","formControlName","fontSize","min","8","max","20"],["matInput","","type","number","formControlName","lineSpacing","min","1","max","3","step","0.1"],["matInput","","formControlName","headerText","placeholder","Welcome to our hotel"],["matInput","","formControlName","footerText","placeholder","Thank you for your stay!"],[1,"space-y-4"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-gray-700"],[1,"text-xs","text-gray-500"],["formControlName","autocut","color","primary"],["formControlName","includeLogo","color","primary"],["type","submit","mat-raised-button","","color","primary",1,"w-full",3,"disabled"],[1,"w-16","h-16","bg-green-100","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],[1,"text-4xl","text-green-600"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600","mb-4"],[1,"flex","flex-col","gap-3"],["mat-stroked-button","","color","primary",1,"w-full",3,"click"],[1,"mr-2"],["mat-stroked-button","","color","accent",1,"w-full",3,"click"],[1,"w-full"],["type","file","accept","image/*",1,"hidden",3,"change"],["mat-stroked-button","","color","warn",1,"w-full",3,"click"],[1,"w-16","h-16","bg-gray-100","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],[1,"text-4xl","text-gray-400"],["mat-raised-button","","color","primary",1,"w-full",3,"click","disabled"],[1,"animate-spin","mr-2"]],template:function(r,l){r&1&&(t(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h3",5)(5,"mat-icon",6),i(6,"bluetooth"),e(),i(7," Printer Connection "),e()(),t(8,"div",7),C(9,de,28,1,"div",8)(10,ge,11,2,"div",8),t(11,"div",9)(12,"h5",10)(13,"mat-icon",11),i(14,"info"),e(),i(15," Printer Requirements "),e(),t(16,"ul",12)(17,"li"),i(18,"\u2022 ESC/POS compatible Bluetooth printer"),e(),t(19,"li"),i(20,"\u2022 Chrome browser (version 56+)"),e(),t(21,"li"),i(22,"\u2022 HTTPS connection required"),e(),t(23,"li"),i(24,"\u2022 Supported brands: EPSON, Star, Citizen, Bixolon"),e()()()()(),t(25,"div",3)(26,"div",4)(27,"h3",5)(28,"mat-icon",13),i(29,"tune"),e(),i(30," Print Configuration "),e()(),t(31,"div",7)(32,"form",14),c("ngSubmit",function(){return l.savePrinterSettings()}),t(33,"div",15)(34,"mat-form-field",16)(35,"mat-label"),i(36,"Paper Size"),e(),t(37,"mat-select",17),y(38,fe,2,2,"mat-option",18,me),e(),t(40,"mat-icon",19),i(41,"straighten"),e()(),t(42,"mat-form-field",16)(43,"mat-label"),i(44,"Print Quality"),e(),t(45,"mat-select",20),y(46,Se,2,2,"mat-option",18,me),e(),t(48,"mat-icon",19),i(49,"high_quality"),e()(),t(50,"div",21)(51,"mat-form-field",22)(52,"mat-label"),i(53,"Font Size"),e(),g(54,"input",23),t(55,"span",19),i(56,"px"),e()(),t(57,"mat-form-field",22)(58,"mat-label"),i(59,"Line Spacing"),e(),g(60,"input",24),t(61,"span",19),i(62,"x"),e()()(),t(63,"mat-form-field",16)(64,"mat-label"),i(65,"Header Text (Optional)"),e(),g(66,"input",25),e(),t(67,"mat-form-field",16)(68,"mat-label"),i(69,"Footer Text"),e(),g(70,"input",26),e(),t(71,"div",27)(72,"div",28)(73,"div")(74,"label",29),i(75,"Auto Cut Paper"),e(),t(76,"p",30),i(77,"Automatically cut paper after printing"),e()(),g(78,"mat-slide-toggle",31),e(),t(79,"div",28)(80,"div")(81,"label",29),i(82,"Include Logo"),e(),t(83,"p",30),i(84,"Print hotel logo on receipts"),e()(),g(85,"mat-slide-toggle",32),e()(),t(86,"button",33),C(87,xe,3,0)(88,he,3,0),e()()()()()()()),r&2&&(s(9),_(l.printerConnected()?9:10),s(23),h("formGroup",l.printerSettingsForm),s(6),P(l.paperSizeOptions),s(8),P(l.printQualityOptions),s(40),h("disabled",l.printerSettingsForm.invalid||l.saving()),s(),_(l.saving()?87:88))},dependencies:[j,D,I,O,V,L,G,A,q,Q,H,N,z,Z,Y,J,W,R,$,X,K,re,ne,w,le,ae,ee,oe],styles:["[_nghost-%COMP%]{display:block}"]})};export{ce as PrinterSettings};
