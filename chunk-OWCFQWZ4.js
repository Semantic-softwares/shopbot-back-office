import{a as Le,b as We,c as ze}from"./chunk-67365OOW.js";import{a as je,b as Ge}from"./chunk-RLGREP2S.js";import{a as $e}from"./chunk-P5XCBOGO.js";import{a as we,b as Ae,c as Ve,h as De}from"./chunk-DOHPGGLS.js";import"./chunk-MS4AQ6UA.js";import{a as Te,b as qe}from"./chunk-YVYCFWPM.js";import"./chunk-3RK6DDJD.js";import{a as Oe,b as Be}from"./chunk-LIUA42FM.js";import{a as X}from"./chunk-QC5ECH45.js";import"./chunk-CZ2MIGG7.js";import"./chunk-JQGESV5S.js";import"./chunk-IX32NZKS.js";import{d as K}from"./chunk-XQNDMVIO.js";import{b as Ee,c as Me,d as Ie}from"./chunk-3632TDEK.js";import"./chunk-EEQKDLYL.js";import{d as Ne}from"./chunk-NGGCDKIH.js";import"./chunk-JTD73F4Y.js";import{a as Se,b as _e,e as ke,h as Ce}from"./chunk-JGZ2V5AL.js";import{B as fe,D as ve,b as ie,d as s,g as re,h as ne,m as oe,n as ae,p as me,q as le,r as ce,s as se,w as de,x as ue,y as pe}from"./chunk-CXVWFC6J.js";import"./chunk-JTLCVARK.js";import{a as he,b as xe,c as ye,f as be,g as ge}from"./chunk-HA7VDR7W.js";import{a as Pe,b as Re}from"./chunk-7C3RSL2D.js";import"./chunk-OHZSVTBE.js";import"./chunk-VIOSJ367.js";import"./chunk-TEL7Y7UN.js";import{o as Z,p as ee,q as te}from"./chunk-FSA22CPB.js";import{b as Fe}from"./chunk-TS4O77IX.js";import"./chunk-M2YK6UF7.js";import"./chunk-BVQK7CK4.js";import"./chunk-AGZJ637K.js";import{a as H,c as Q,d as Y,h as J}from"./chunk-LXXDR6CV.js";import"./chunk-TQDHD3WD.js";import{n as W,s as z,t as U}from"./chunk-DWCYWQVU.js";import{Cc as x,Db as f,Dc as L,Eb as v,Fb as $,Fc as g,Hb as I,Ib as P,Jb as d,Kb as i,Lb as t,Mb as u,Mc as S,Qb as A,Ub as E,V as q,Vb as h,Xa as w,_a as l,d as T,db as b,dc as R,fa as O,ic as n,jc as p,kb as B,kc as M,la as _,lc as j,ma as k,n as N,va as C,wc as G}from"./chunk-5AECHVKR.js";import{a as V,b as D}from"./chunk-EQDQRRRY.js";var Qe=()=>[".."],Ue=(m,r)=>r._id;function Ye(m,r){if(m&1&&(i(0,"mat-option",15),n(1),t()),m&2){let e=r.$implicit;d("value",e._id),l(),p(e.name)}}function Je(m,r){m&1&&(i(0,"mat-error"),n(1,"Supplier is required"),t())}function Ke(m,r){m&1&&(i(0,"mat-error"),n(1,"Invoice number is required"),t())}function Xe(m,r){if(m&1&&u(0,"img",32),m&2){let e=h().$implicit;d("src",e.photos[0],w)("alt",e.name)}}function Ze(m,r){m&1&&(i(0,"div",33)(1,"mat-icon",36),n(2,"image"),t()())}function et(m,r){if(m&1&&(i(0,"mat-option",15)(1,"div",31),f(2,Xe,1,2,"img",32)(3,Ze,3,0,"div",33),i(4,"div")(5,"div",34),n(6),t(),i(7,"div",35),n(8),x(9,"currency"),t()()()()),m&2){let e=r.$implicit,o=h();d("value",e),l(2),v((e.photos==null?null:e.photos.length)>0?2:3),l(4),p(e.name),l(2),j(" Current Qty: ",e.qty||0," | Cost: ",g(9,5,e.costPrice,o.currency(),"symbol","1.2-2")," ")}}function tt(m,r){m&1&&(i(0,"div",25)(1,"mat-icon",37),n(2,"search"),t(),i(3,"p"),n(4,"Search and add products to restock"),t()())}function it(m,r){if(m&1&&u(0,"img",44),m&2){let e=h().$implicit;d("src",e.value.product.photos[0],w)("alt",e.value.product.name)}}function rt(m,r){if(m&1){let e=A();i(0,"tr",41)(1,"td",42)(2,"div",43),f(3,it,1,2,"img",44),i(4,"div")(5,"div",34),n(6),t(),i(7,"div",35),n(8),t()()()(),i(9,"td",42)(10,"mat-form-field",45),u(11,"input",46),t()(),i(12,"td",42)(13,"mat-form-field",47),u(14,"input",48),t()(),i(15,"td",42)(16,"mat-form-field",47),u(17,"input",49),t()(),i(18,"td",42)(19,"mat-form-field",50),u(20,"input",51)(21,"mat-datepicker-toggle",19)(22,"mat-datepicker",null,3),t()(),i(24,"td",42)(25,"span",34),n(26),x(27,"currency"),t()(),i(28,"td",42)(29,"button",52),E("click",function(){let a=_(e).$index,c=h(2);return k(c.removeItem(a))}),i(30,"mat-icon"),n(31,"delete"),t()()()()}if(m&2){let e=r.$implicit,o=r.$index,a=R(23),c=h(2);d("formGroupName",o),l(3),v((e.value.product==null||e.value.product.photos==null?null:e.value.product.photos.length)>0?3:-1),l(3),p(e.value.product==null?null:e.value.product.name),l(2),p(e.value.product==null?null:e.value.product.sku),l(12),d("matDatepicker",a),l(),d("for",a),l(5),M(" ",g(27,7,(e.value.quantity||0)*(e.value.costPrice||0),c.currency(),"symbol","1.2-2")," ")}}function nt(m,r){if(m&1&&(i(0,"div",26)(1,"table",38)(2,"thead")(3,"tr",39)(4,"th",40),n(5,"Product"),t(),i(6,"th",40),n(7,"Quantity"),t(),i(8,"th",40),n(9,"Cost Price"),t(),i(10,"th",40),n(11,"Selling Price"),t(),i(12,"th",40),n(13,"Expiry Date"),t(),i(14,"th",40),n(15,"Total"),t(),i(16,"th",40),n(17,"Actions"),t()()(),i(18,"tbody"),I(19,rt,32,12,"tr",41,$),t()()()),m&2){let e=h();l(19),P(e.itemsArray.controls)}}function ot(m,r){if(m&1&&(i(0,"mat-card",10)(1,"mat-card-header")(2,"mat-card-title"),n(3,"Summary"),t()(),i(4,"mat-card-content",11)(5,"div",53)(6,"mat-form-field",13)(7,"mat-label"),n(8,"Discount (%)"),t(),u(9,"input",54),t(),i(10,"mat-form-field",13)(11,"mat-label"),n(12,"VAT (%)"),t(),u(13,"input",55),t(),i(14,"div",56)(15,"div",57)(16,"span"),n(17,"Subtotal:"),t(),i(18,"span",34),n(19),x(20,"currency"),t()(),i(21,"div",57)(22,"span"),n(23,"Discount:"),t(),i(24,"span",34),n(25),x(26,"currency"),t()(),i(27,"div",57)(28,"span"),n(29,"VAT:"),t(),i(30,"span",34),n(31),x(32,"currency"),t()(),i(33,"div",58)(34,"span"),n(35,"Total:"),t(),i(36,"span"),n(37),x(38,"currency"),t()()()(),i(39,"div",59)(40,"mat-form-field",13)(41,"mat-label"),n(42,"Amount Paid"),t(),u(43,"input",60),t(),i(44,"mat-form-field",13)(45,"mat-label"),n(46,"Payment Method"),t(),i(47,"mat-select",61)(48,"mat-option",62),n(49,"Cash"),t(),i(50,"mat-option",63),n(51,"Bank Transfer"),t(),i(52,"mat-option",64),n(53,"Check"),t(),i(54,"mat-option",65),n(55,"Credit"),t()()()(),i(56,"mat-form-field",66)(57,"mat-label"),n(58,"Notes"),t(),u(59,"textarea",67),t()()()),m&2){let e=h();l(19),p(g(20,4,e.subtotal(),e.currency(),"symbol","1.2-2")),l(6),p(g(26,9,e.discountAmount(),e.currency(),"symbol","1.2-2")),l(6),p(g(32,14,e.vatAmount(),e.currency(),"symbol","1.2-2")),l(6),p(g(38,19,e.total(),e.currency(),"symbol","1.2-2"))}}function at(m,r){m&1&&u(0,"mat-spinner",30)}var He=class m{constructor(r,e,o,a,c,y){this.fb=r;this.restockService=e;this.productService=o;this.suppliersService=a;this.router=c;this.route=y;this.restockForm=this.fb.group({supplier:["",s.required],invoiceNumber:["",s.required],orderNumber:[""],invoiceDate:[new Date,s.required],items:this.fb.array([]),discount:[0],vat:[0],amountPaid:[0],paymentMethod:["cash"],notes:[""]}),this.restockForm.valueChanges.pipe(q(this.restockForm.value)).subscribe(F=>{this.formValue.set(F)})}storeStore=O(Fe);isSubmitting=C(!1);isEditMode=C(!1);restockId=C(null);currentRestock=C(null);selectedStore=S(()=>this.storeStore.selectedStore());currency=S(()=>this.selectedStore()?.currency||"NGN");restockForm;filteredProducts$=N([]);formValue=C({});suppliers=Ne({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:r})=>r.storeId?this.suppliersService.getSuppliersByStore(r.storeId):new T(e=>{e.next([]),e.complete()})});goToRestock(){this.router.navigate(["/dashboard/inventories/restock"])}ngOnInit(){let r=this.route.snapshot.paramMap.get("id");r?(this.isEditMode.set(!0),this.restockId.set(r),this.loadRestockForEdit(r)):this.generateInvoiceNumber()}loadRestockForEdit(r){this.restockService.findOne(r).subscribe({next:e=>{this.currentRestock.set(e),this.populateFormWithRestock(e)},error:e=>{console.error("Error loading restock:",e),this.router.navigate(["dashboard","inventories","restock"])}})}populateFormWithRestock(r){this.restockForm.patchValue({supplier:r.supplier,invoiceNumber:r.invoiceNumber,orderNumber:r.orderNumber,invoiceDate:new Date(r.invoiceDate),discount:r.discount||0,vat:r.vat||0,amountPaid:r.amountPaid||0,paymentMethod:r.paymentMethod||"cash",notes:r.notes||""});let e=this.itemsArray;e.clear(),r.items.forEach(o=>{let a={_id:typeof o.product=="string"?o.product:o.product?._id,name:o.productName,sku:o.product?.sku||"",photos:o.product?.photos||[],price:o.sellingPrice,costPrice:o.costPrice},c=this.fb.group({product:[a],quantity:[o.quantity,[s.required,s.min(1)]],costPrice:[o.costPrice,[s.required,s.min(0)]],sellingPrice:[o.sellingPrice,[s.required,s.min(0)]],expiryDate:[o.expiryDate?new Date(o.expiryDate):null]});c.valueChanges.subscribe(()=>{this.formValue.set(this.restockForm.value)}),e.push(c)}),this.formValue.set(this.restockForm.value)}get itemsArray(){return this.restockForm.get("items")}generateInvoiceNumber(){let e=`INV-${Date.now()}`;this.restockForm.patchValue({invoiceNumber:e})}onSearchInputChange(r){let o=r.target.value;if(o.length<2){this.filteredProducts$=N([]);return}let a=this.itemsArray.value.map(c=>c.product._id);this.filteredProducts$=this.productService.searchForAutocomplete(this.storeStore.selectedStore()?._id||"",o,a)}displayProduct(r){return r?r.name:""}addProductToRestock(r){let e=this.fb.group({product:[r],quantity:[1,[s.required,s.min(1)]],costPrice:[r.costPrice||0,[s.required,s.min(0)]],sellingPrice:[r.price||0,[s.required,s.min(0)]],expiryDate:[r.expiryDate||null]});e.valueChanges.subscribe(()=>{this.formValue.set(this.restockForm.value)}),this.itemsArray.push(e),this.formValue.set(this.restockForm.value);let o=document.querySelector("input[matInput]");o&&(o.value="")}removeItem(r){this.itemsArray.removeAt(r),this.formValue.set(this.restockForm.value)}subtotal=S(()=>(this.formValue().items||[]).reduce((o,a)=>o+(a.quantity||0)*(a.costPrice||0),0));discountAmount=S(()=>{let e=this.formValue().discount||0;return this.subtotal()*e/100});vatAmount=S(()=>{let e=this.formValue().vat||0;return(this.subtotal()-this.discountAmount())*e/100});total=S(()=>this.subtotal()-this.discountAmount()+this.vatAmount());onSubmit(){if(this.restockForm.valid&&this.itemsArray.length>0){this.isSubmitting.set(!0);let r=this.restockForm.value,e=D(V({},r),{subtotal:this.subtotal(),discountAmount:this.discountAmount(),vatAmount:this.vatAmount(),total:this.total(),outstandingBalance:this.total()-(r.amountPaid||0),status:"completed",items:r.items.map(a=>({product:a.product._id,productName:a.product.name,quantity:a.quantity,costPrice:a.costPrice,sellingPrice:a.sellingPrice,expiryDate:a.expiryDate,totalCost:a.quantity*a.costPrice}))});(this.isEditMode()?this.restockService.update(this.restockId(),e):this.restockService.create(e)).subscribe({next:a=>{console.log(`Restock ${this.isEditMode()?"updated":"saved"}:`,a),this.goToRestock()},error:a=>{console.error(`Error ${this.isEditMode()?"updating":"saving"} restock:`,a),this.isSubmitting.set(!1)}})}}static \u0275fac=function(e){return new(e||m)(b(fe),b(je),b($e),b(Ge),b(Q),b(H))};static \u0275cmp=B({type:m,selectors:[["app-add-restock"]],decls:67,vars:18,consts:[["datePicker",""],["searchInput",""],["auto","matAutocomplete"],["expiryPicker",""],[1,"p-6","max-w-4xl","mx-auto"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600","mt-1"],["mat-button","",1,"text-gray-600",3,"click"],[3,"ngSubmit","formGroup"],[1,"mb-6"],[1,"p-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["appearance","outline"],["formControlName","supplier","required",""],[3,"value"],["matInput","","formControlName","invoiceNumber","required",""],["matInput","","formControlName","orderNumber"],["matInput","","formControlName","invoiceDate","required","",3,"matDatepicker"],["matIconSuffix","",3,"for"],[1,"mb-4"],["appearance","outline",1,"w-full"],["matInput","","placeholder","Search by product name or barcode",3,"input","matAutocomplete"],[3,"optionSelected","displayWith"],["formArrayName","items"],[1,"text-center","py-8","text-gray-500"],[1,"overflow-x-auto"],[1,"flex","justify-end","space-x-4"],["type","button","mat-button","",3,"routerLink"],["type","submit","mat-raised-button","","color","primary",3,"disabled"],["diameter","20",1,"mr-2"],[1,"flex","items-center","space-x-3"],[1,"w-8","h-8","rounded","object-cover",3,"src","alt"],[1,"w-8","h-8","bg-gray-200","rounded","flex","items-center","justify-center"],[1,"font-medium"],[1,"text-sm","text-gray-500"],[1,"text-gray-400","text-sm"],[1,"text-4xl","mb-2"],[1,"w-full"],[1,"border-b","border-gray-200"],[1,"text-left","py-2"],[1,"border-b","border-gray-100",3,"formGroupName"],[1,"py-3"],[1,"flex","items-center","space-x-2"],[1,"w-10","h-10","rounded","object-cover",3,"src","alt"],["appearance","outline",1,"w-20"],["matInput","","type","number","formControlName","quantity","min","1"],["appearance","outline",1,"w-24"],["matInput","","type","number","formControlName","costPrice","min","0","step","0.01"],["matInput","","type","number","formControlName","sellingPrice","min","0","step","0.01"],["appearance","outline",1,"w-32"],["matInput","","formControlName","expiryDate",3,"matDatepicker"],["type","button","mat-icon-button","","color","warn",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["matInput","","type","number","formControlName","discount","min","0","max","100","step","0.01"],["matInput","","type","number","formControlName","vat","min","0","max","100","step","0.01"],[1,"flex","flex-col","space-y-2","justify-end"],[1,"flex","justify-between"],[1,"flex","justify-between","text-lg","font-bold","border-t","pt-2"],[1,"mt-6","grid","grid-cols-1","md:grid-cols-2","gap-6"],["matInput","","type","number","formControlName","amountPaid","min","0","step","0.01"],["formControlName","paymentMethod"],["value","cash"],["value","bank_transfer"],["value","check"],["value","credit"],["appearance","outline",1,"w-full","mt-4"],["matInput","","formControlName","notes","rows","3"]],template:function(e,o){if(e&1){let a=A();i(0,"div",4)(1,"div",5)(2,"div")(3,"h1",6),n(4),t(),i(5,"p",7),n(6),t()(),i(7,"button",8),E("click",function(){return _(a),k(o.goToRestock())}),i(8,"mat-icon"),n(9,"arrow_back"),t(),n(10," Back to List "),t()(),i(11,"form",9),E("ngSubmit",function(){return _(a),k(o.onSubmit())}),i(12,"mat-card",10)(13,"mat-card-header")(14,"mat-card-title"),n(15,"Restock Information"),t()(),i(16,"mat-card-content",11)(17,"div",12)(18,"mat-form-field",13)(19,"mat-label"),n(20,"Supplier *"),t(),i(21,"mat-select",14),I(22,Ye,2,2,"mat-option",15,Ue),t(),f(24,Je,2,0,"mat-error"),t(),i(25,"mat-form-field",13)(26,"mat-label"),n(27,"Invoice Number *"),t(),u(28,"input",16),f(29,Ke,2,0,"mat-error"),t(),i(30,"mat-form-field",13)(31,"mat-label"),n(32,"Order Number"),t(),u(33,"input",17),t(),i(34,"mat-form-field",13)(35,"mat-label"),n(36,"Invoice Date *"),t(),u(37,"input",18)(38,"mat-datepicker-toggle",19)(39,"mat-datepicker",null,0),t()()()(),i(41,"mat-card",10)(42,"mat-card-header")(43,"mat-card-title"),n(44,"Products"),t()(),i(45,"mat-card-content",11)(46,"div",20)(47,"mat-form-field",21)(48,"mat-label"),n(49,"Search and add product"),t(),i(50,"input",22,1),E("input",function(y){return _(a),k(o.onSearchInputChange(y))}),t(),i(52,"mat-autocomplete",23,2),E("optionSelected",function(y){return _(a),k(o.addProductToRestock(y.option.value))}),I(54,et,10,10,"mat-option",15,Ue),x(56,"async"),t()()(),i(57,"div",24),f(58,tt,5,0,"div",25)(59,nt,21,0,"div",26),t()()(),f(60,ot,60,24,"mat-card",10),i(61,"div",27)(62,"button",28),n(63,"Cancel"),t(),i(64,"button",29),f(65,at,1,0,"mat-spinner",30),n(66),t()()()()}if(e&2){let a,c,y=R(40),F=R(53);l(4),M(" ",o.isEditMode()?"Edit Stock Entry":"Add Stock"," "),l(2),M(" ",o.isEditMode()?"Update existing inventory record":"Record new inventory received from suppliers"," "),l(5),d("formGroup",o.restockForm),l(11),P(o.suppliers.value()),l(2),v((a=o.restockForm.get("supplier"))!=null&&a.invalid&&((a=o.restockForm.get("supplier"))!=null&&a.touched)?24:-1),l(5),v((c=o.restockForm.get("invoiceNumber"))!=null&&c.invalid&&((c=o.restockForm.get("invoiceNumber"))!=null&&c.touched)?29:-1),l(8),d("matDatepicker",y),l(),d("for",y),l(12),d("matAutocomplete",F),l(2),d("displayWith",o.displayProduct),l(2),P(L(56,15,o.filteredProducts$)),l(4),v(o.itemsArray.length===0?58:59),l(2),v(o.itemsArray.length>0?60:-1),l(2),d("routerLink",G(17,Qe)),l(2),d("disabled",o.restockForm.invalid||o.isSubmitting()),l(),v(o.isSubmitting()?65:-1),l(),M(" ",o.isEditMode()?"Update Restock":"Save Restock"," ")}},dependencies:[U,W,z,ve,oe,ie,ae,re,ne,pe,ue,de,me,se,le,ce,ge,he,ye,be,xe,Ee,Ce,Se,_e,ke,Ie,Me,qe,Te,K,te,ee,Z,Re,Pe,De,we,Ae,Ve,X,ze,Le,We,Be,Oe,J,Y],styles:[".restock-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.product-card[_ngcontent-%COMP%]{transition:all .2s ease-in-out}.product-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 8px #0000001a}.products-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:1rem;max-height:300px;overflow-y:auto}.restock-table[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{height:40px}.price-summary-card[_ngcontent-%COMP%]   .summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem 0}.price-summary-card[_ngcontent-%COMP%]   .summary-row.total-row[_ngcontent-%COMP%]{border-top:1px solid #e5e7eb;font-weight:600;font-size:1.1rem;padding-top:1rem;margin-top:1rem}  .success-snackbar{background-color:#10b981;color:#fff}  .warn-snackbar{background-color:#f59e0b;color:#fff}  .mat-mdc-form-field-appearance-outline .mat-mdc-form-field-outline-thick{color:#0000001f}  .mat-mdc-checkbox{margin-right:.5rem}@media (max-width: 768px){.restock-table[_ngcontent-%COMP%]   .mat-table[_ngcontent-%COMP%]{font-size:.875rem}.products-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(200px,1fr))}}"]})};export{He as RestockComponent};
