import{a as ut}from"./chunk-R3ZJJYBP.js";import{a as j,b as lt,c as st}from"./chunk-6ZHKYW4R.js";import{a as mt}from"./chunk-43L7VVFN.js";import"./chunk-MS4AQ6UA.js";import{a as q,b as at}from"./chunk-BDBUP5RW.js";import{a as ze,b as Qe,c as Ze,d as We,e as Je,f as Ke,g as Xe,h as Ye,i as et,j as tt,k as it,l as rt}from"./chunk-LGKRDPY2.js";import{a as ot,b as nt}from"./chunk-5W5E6AGV.js";import"./chunk-3RK6DDJD.js";import{a as V,b as H}from"./chunk-57GZGP3R.js";import{d as ge}from"./chunk-FNFXBZOZ.js";import{b as R,c as B,d as U}from"./chunk-AQ3KQLE6.js";import{a as I,b as be}from"./chunk-4WFQ5GOX.js";import{a as Ve,b as He,c as je,d as Ge,g as $}from"./chunk-DGYQUDOC.js";import"./chunk-KLIJEHXY.js";import"./chunk-ETOXAU7Y.js";import{a as Ae,c as Oe,d as $e,e as qe}from"./chunk-OTA24DIU.js";import{d as O}from"./chunk-NGGCDKIH.js";import"./chunk-5LES5XKI.js";import{a as k,b as ke,d as Fe,h as F}from"./chunk-QMUPRLKR.js";import{B as Te,C as we,D as Le,b as P,d as f,g as N,h as Me,l as ye,m as Ee,p as xe,s as De}from"./chunk-CXVWFC6J.js";import"./chunk-JTLCVARK.js";import{a as Ie,c as Pe,g as Ne}from"./chunk-UOL4Y3DN.js";import{a as Re,b as Be}from"./chunk-MCIFQNRK.js";import"./chunk-OHZSVTBE.js";import{a as A}from"./chunk-P7SQXTVL.js";import"./chunk-IKGBOHBU.js";import"./chunk-SIHSJGX2.js";import{W as Se,X as w,Y as L}from"./chunk-BPRDVRQX.js";import{a as Ue}from"./chunk-KP7TGH7C.js";import"./chunk-M2YK6UF7.js";import{a as ve}from"./chunk-AGZJ637K.js";import"./chunk-TQDHD3WD.js";import{B as he,k as Ce,s as _e,t as T}from"./chunk-DWCYWQVU.js";import{$b as J,Cc as K,Db as y,Eb as E,Ec as X,Fb as me,Hb as le,Ib as se,Jb as s,Kb as o,Lb as r,Mb as c,Nb as C,Ob as _,Qb as ue,Ub as h,Vb as S,Z as ne,Zb as Z,_a as m,_b as W,aa as ae,dc as pe,fa as p,ic as a,jc as g,kb as M,kc as x,la as G,ma as z,nc as de,oc as ce,pc as fe,qb as u,va as Q,wc as D}from"./chunk-5AECHVKR.js";import"./chunk-EQDQRRRY.js";var b=class e{http=p(he);hostServer=ve.apiUrl;validateEmailAndPhoneNumber({email:t,phoneNumber:i}){return this.http.post(`${this.hostServer}/auth/validate-email-and-phone?userType=merchant`,{email:t,phoneNumber:i})}createCustomer(t){return this.http.post(`${this.hostServer}/users`,t)}getStoreCustomers(t){return this.http.get(`${this.hostServer}/users/stores/${t}/users`)}deleteCustomer(t){return this.http.delete(`${this.hostServer}/users/${t}`)}updateCustomer(t,i){return this.http.put(`${this.hostServer}/users/${t}`,i)}static \u0275fac=function(i){return new(i||e)};static \u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})};var St=()=>[];function bt(e,t){e&1&&(o(0,"mat-error"),a(1," Name is required "),r())}function vt(e,t){e&1&&(o(0,"mat-error"),a(1," Name must be at least 2 characters "),r())}function Mt(e,t){e&1&&(o(0,"mat-error"),a(1," Email is required "),r())}function yt(e,t){e&1&&(o(0,"mat-error"),a(1," Please enter a valid email address "),r())}function Et(e,t){e&1&&(o(0,"mat-error"),a(1," Email must be lowercase "),r())}function xt(e,t){e&1&&(o(0,"mat-error"),a(1," Phone number is required "),r())}function Dt(e,t){e&1&&(o(0,"mat-error"),a(1," Phone number must be at least 6 digits "),r())}function Tt(e,t){if(e&1&&(o(0,"mat-option",10),a(1),r()),e&2){let i=t.$implicit;s("value",i.country),m(),x(" ",i.country," ")}}function wt(e,t){e&1&&(o(0,"mat-error"),a(1," Country is required "),r())}function Lt(e,t){e&1&&c(0,"mat-spinner",15)}function It(e){if(e.value){let t=e.value.toLowerCase();if(t!==e.value)return{lowercaseEmail:t}}return null}var v=class e{storeStore=p(A);fb=p(Te);customerService=p(b);snackBar=p(I);dialogRef=p(Ve);data=p(He);storeService=p(Ue);isSubmitting=Q(!1);genders=["Male","Female"];isEdit=this.data.isEdit;form=this.fb.group({name:["",[f.required,f.minLength(2)]],email:["",[f.required,f.email,It]],phoneNumber:["",[f.required,f.minLength(6)]],country:["",f.required],currency:["",f.required],notes:[""],store:[this.storeStore.selectedStore()?._id,f.required],password:["123456",f.required]});isLoading=Q(!1);deliveryZones=O({stream:()=>this.storeService.getDeliveryZonesFromServer()});ngOnInit(){this.isEdit&&this.data.customer&&this.form.patchValue(this.data.customer)}selectCountry(t){let i=this.deliveryZones.value().find(n=>n.country===t);i&&this.form.patchValue({currency:i.currency})}onSubmit(){if(this.form.valid){this.isSubmitting.set(!0);let t=this.form.getRawValue();this.isEdit?this.customerService.updateCustomer(this.data.customer._id,t).subscribe(i=>{this.dialogRef.close(!0)},i=>{this.isLoading.set(!1),this.snackBar.open("Server or internet error please try again","Close",{duration:3e3})}):this.customerService.createCustomer(t).subscribe(i=>{i.status==401||i?.err?i.err.keyPattern.hasOwnProperty("email")?(this.isLoading.set(!1),this.snackBar.open("Email has already been used.","Close",{duration:3e3})):i.err.keyPattern.hasOwnProperty("phoneNumber")&&(this.isLoading.set(!1),this.snackBar.open("Phone number has already been used.","Close",{duration:3e3})):this.dialogRef.close(!0)},i=>{this.isLoading.set(!1),this.snackBar.open("Server or internet error please try again","Close",{duration:3e3})})}}onCancel(){this.dialogRef.close()}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=M({type:e,selectors:[["app-customer-dialog"]],decls:41,vars:15,consts:[[1,"p-6"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter customer name"],[4,"ngIf"],["matInput","","formControlName","email","type","email","placeholder","Enter email address"],["matInput","","formControlName","phoneNumber","placeholder","Enter phone number"],["formControlName","country","placeholder","Select country",3,"selectionChange"],[3,"value"],["matInput","","formControlName","notes","placeholder","Enter any additional notes"],[1,"flex","justify-end","space-x-2","mt-6","pt-4","border-t","border-gray-200"],["mat-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",1,"mr-2"]],template:function(i,n){if(i&1&&(o(0,"div",0)(1,"h2",1),a(2),r(),o(3,"form",2),h("ngSubmit",function(){return n.onSubmit()}),o(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),a(7,"Name"),r(),c(8,"input",5),u(9,bt,2,0,"mat-error",6)(10,vt,2,0,"mat-error",6),r(),o(11,"mat-form-field",4)(12,"mat-label"),a(13,"Email"),r(),c(14,"input",7),u(15,Mt,2,0,"mat-error",6)(16,yt,2,0,"mat-error",6)(17,Et,2,0,"mat-error",6),r(),o(18,"mat-form-field",4)(19,"mat-label"),a(20,"Phone Number"),r(),c(21,"input",8),u(22,xt,2,0,"mat-error",6)(23,Dt,2,0,"mat-error",6),r(),o(24,"mat-form-field",4)(25,"mat-label"),a(26,"Country"),r(),o(27,"mat-select",9),h("selectionChange",function(d){return n.selectCountry(d.value)}),le(28,Tt,2,2,"mat-option",10,me),r(),u(30,wt,2,0,"mat-error",6),r(),o(31,"mat-form-field",4)(32,"mat-label"),a(33,"Notes"),r(),c(34,"textarea",11),r()(),o(35,"div",12)(36,"button",13),h("click",function(){return n.onCancel()}),a(37,"Cancel"),r(),o(38,"button",14),y(39,Lt,1,0,"mat-spinner",15),a(40),r()()()()),i&2){let l,d,Y,ee,te,ie,re,oe;m(2),x(" ",n.isEdit?"Edit Customer":"Create New Customer"," "),m(),s("formGroup",n.form),m(6),s("ngIf",(l=n.form.get("name"))==null?null:l.hasError("required")),m(),s("ngIf",(d=n.form.get("name"))==null?null:d.hasError("minlength")),m(5),s("ngIf",(Y=n.form.get("email"))==null?null:Y.hasError("required")),m(),s("ngIf",(ee=n.form.get("email"))==null?null:ee.hasError("email")),m(),s("ngIf",(te=n.form.get("email"))==null?null:te.hasError("lowercase")),m(5),s("ngIf",(ie=n.form.get("phoneNumber"))==null?null:ie.hasError("required")),m(),s("ngIf",(re=n.form.get("phoneNumber"))==null?null:re.hasError("minlength")),m(5),se(n.deliveryZones.value()||D(14,St)),m(2),s("ngIf",(oe=n.form.get("country"))==null?null:oe.hasError("required")),m(6),s("disabled",n.isSubmitting()),m(2),s("disabled",!n.form.valid||n.isSubmitting()),m(),E(n.isSubmitting()?39:-1),m(),x(" ",n.isEdit?"Update":"Create"," ")}},dependencies:[T,Ce,$,Ge,L,w,R,F,k,ke,U,B,nt,ot,ge,Le,Ee,P,N,Me,xe,De,H,V],encapsulation:2})};var Pt=()=>[5,10,25,100];function Nt(e,t){e&1&&(o(0,"div",10),c(1,"mat-spinner",14),r())}function kt(e,t){e&1&&c(0,"app-no-record",11)}function Ft(e,t){e&1&&c(0,"app-no-record",12)}function Rt(e,t){e&1&&(o(0,"th",31),a(1,"Name"),r())}function Bt(e,t){if(e&1&&(o(0,"td",32),a(1),r()),e&2){let i=t.$implicit;m(),g(i.name)}}function Ut(e,t){e&1&&(o(0,"th",31),a(1,"Gender"),r())}function At(e,t){if(e&1&&(o(0,"td",32),a(1),r()),e&2){let i=t.$implicit;m(),g(i.gender)}}function Ot(e,t){e&1&&(o(0,"th",31),a(1,"Email"),r())}function $t(e,t){if(e&1&&(o(0,"td",32),a(1),r()),e&2){let i=t.$implicit;m(),g(i.email)}}function qt(e,t){e&1&&(o(0,"th",31),a(1,"Phone"),r())}function Vt(e,t){if(e&1&&(o(0,"td",32),a(1),r()),e&2){let i=t.$implicit;m(),g(i.phoneNumber)}}function Ht(e,t){e&1&&(o(0,"th",31),a(1,"Country"),r())}function jt(e,t){if(e&1&&(o(0,"td",32),a(1),r()),e&2){let i=t.$implicit;m(),g(i.country)}}function Gt(e,t){e&1&&(o(0,"th",31),a(1,"Total Amount Spent"),r())}function zt(e,t){if(e&1&&(o(0,"td",32),a(1),K(2,"currency"),r()),e&2){let i,n=t.$implicit,l=S(2);m(),g(X(2,1,n.totalAmountSpent||0,(i=l.storeStore.selectedStore())==null?null:i.currency))}}function Qt(e,t){e&1&&(o(0,"th",31),a(1,"Avg Amount Spent"),r())}function Zt(e,t){if(e&1&&(o(0,"td",32),a(1),K(2,"currency"),r()),e&2){let i,n=t.$implicit,l=S(2);m(),g(X(2,1,n.avgAmountSpent||0,(i=l.storeStore.selectedStore())==null?null:i.currency))}}function Wt(e,t){e&1&&(o(0,"th",31),a(1,"Total Orders"),r())}function Jt(e,t){if(e&1&&(o(0,"td",32),a(1),r()),e&2){let i=t.$implicit;m(),g(i.totalOrders||0)}}function Kt(e,t){e&1&&(o(0,"th",33),a(1,"Actions"),r())}function Xt(e,t){if(e&1){let i=ue();o(0,"td",32)(1,"button",34)(2,"mat-icon"),a(3,"more_vert"),r()(),o(4,"mat-menu",null,0)(6,"button",35),h("click",function(){let l=G(i).$implicit,d=S(2);return z(d.editCustomer(l))}),o(7,"mat-icon"),a(8,"edit"),r(),o(9,"span"),a(10,"Edit"),r()(),o(11,"button",35),h("click",function(){let l=G(i).$implicit,d=S(2);return z(d.deleteCustomer(l))}),o(12,"mat-icon"),a(13,"delete"),r(),o(14,"span"),a(15,"Delete"),r()()()()}if(e&2){let i=pe(5);m(),s("matMenuTriggerFor",i)}}function Yt(e,t){e&1&&c(0,"tr",36)}function ei(e,t){e&1&&c(0,"tr",37)}function ti(e,t){if(e&1&&(o(0,"div",13)(1,"table",15),C(2,16),u(3,Rt,2,0,"th",17)(4,Bt,2,1,"td",18),_(),C(5,19),u(6,Ut,2,0,"th",17)(7,At,2,1,"td",18),_(),C(8,20),u(9,Ot,2,0,"th",17)(10,$t,2,1,"td",18),_(),C(11,21),u(12,qt,2,0,"th",17)(13,Vt,2,1,"td",18),_(),C(14,22),u(15,Ht,2,0,"th",17)(16,jt,2,1,"td",18),_(),C(17,23),u(18,Gt,2,0,"th",17)(19,zt,3,4,"td",18),_(),C(20,24),u(21,Qt,2,0,"th",17)(22,Zt,3,4,"td",18),_(),C(23,25),u(24,Wt,2,0,"th",17)(25,Jt,2,1,"td",18),_(),C(26,26),u(27,Kt,2,0,"th",27)(28,Xt,16,1,"td",18),_(),u(29,Yt,1,0,"tr",28)(30,ei,1,0,"tr",29),r(),c(31,"mat-paginator",30),r()),e&2){let i=S();m(),s("dataSource",i.dataSource),m(28),s("matHeaderRowDef",i.displayedColumns),m(),s("matRowDefColumns",i.displayedColumns),m(),s("pageSizeOptions",D(4,Pt))}}var dt=class e{dialog=p(je);snackBar=p(I);customerService=p(b);storeStore=p(A);displayedColumns=["name","email","phoneNumber","totalAmountSpent","totalOrders","avgAmountSpent","country","actions"];dataSource;searchText="";paginator;sort;customers=O({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:t})=>this.customerService.getStoreCustomers(t.storeId).pipe(ne(i=>{this.dataSource=new rt(i),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}))});applyFilter(t){let i=t.target.value;this.dataSource.filter=i.trim().toLowerCase()}openDialog(){this.dialog.open(v,{width:"800px",data:{isEdit:!1}}).afterClosed().subscribe(i=>{i&&this.customers.reload()})}editCustomer(t){this.dialog.open(v,{width:"800px",data:{isEdit:!0,customer:t}}).afterClosed().subscribe(n=>{n&&this.customers.reload()})}deleteCustomer(t){if(t.role==="Owner"){this.snackBar.open("Cannot delete an owner","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"});return}this.dialog.open(ut,{width:"350px",data:{message:`Are you sure you want to delete ${t.name}?`}}).afterClosed().subscribe(n=>{n&&this.customerService.deleteCustomer(t._id).subscribe({next:()=>{this.snackBar.open("Customer deleted successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.customers.reload()},error:()=>{this.snackBar.open("Error deleting customer","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})})}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=M({type:e,selectors:[["app-list-customers"]],viewQuery:function(i,n){if(i&1&&(Z(q,5),Z(j,5)),i&2){let l;W(l=J())&&(n.paginator=l.first),W(l=J())&&(n.sort=l.first)}},decls:19,vars:2,consts:[["menu","matMenu"],[1,"Customers-container","!bg-white"],[1,"!bg-white"],[1,"flex","flex-col","md:flex-row","justify-between","gap-4","p-4"],[1,"flex","flex-col","sm:flex-row","gap-4","flex-grow"],["appearance","outline",1,"w-full","sm:w-48","md:w-72","lg:w-96"],["matPrefix",""],["matInput","","placeholder","Search Customers",3,"keyup","ngModelChange","ngModel"],[1,"flex","gap-3","justify-end"],["mat-raised-button","","color","primary",3,"click"],[1,"flex","items-center","justify-center","min-h-[300px]"],["icon","people","title","No Customers","message","No Customers found matching your criteria."],["icon","error","title","Error","message","An error occurred while fetching Customers. Please try again later."],[1,"table-container","!bg-white"],["diameter","40"],["mat-table","","matSort","",1,"!bg-white",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","gender"],["matColumnDef","email"],["matColumnDef","phoneNumber"],["matColumnDef","country"],["matColumnDef","totalAmountSpent"],["matColumnDef","avgAmountSpent"],["matColumnDef","totalOrders"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of Customers",1,"!bg-white",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","aria-label","Customer actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,n){i&1&&(o(0,"mat-card",1)(1,"mat-card-content",2)(2,"div",3)(3,"div",4)(4,"mat-form-field",5)(5,"mat-label"),a(6,"Search"),r(),o(7,"mat-icon",6),a(8,"search"),r(),o(9,"input",7),h("keyup",function(d){return n.applyFilter(d)}),fe("ngModelChange",function(d){return ce(n.searchText,d)||(n.searchText=d),d}),r()()(),o(10,"div",8)(11,"button",9),h("click",function(){return n.openDialog()}),o(12,"mat-icon"),a(13,"add"),r(),a(14," ADD Customer "),r()()(),y(15,Nt,2,0,"div",10)(16,kt,1,0,"app-no-record",11)(17,Ft,1,0,"app-no-record",12)(18,ti,32,5,"div",13),r()()),i&2&&(m(9),de("ngModel",n.searchText),m(6),E(n.customers.isLoading()?15:n.customers.hasValue()&&n.dataSource.data.length===0?16:n.customers.error()?17:n.customers.hasValue()?18:-1))},dependencies:[T,_e,it,ze,Ze,Xe,We,Qe,Ye,Je,Ke,et,tt,at,q,st,j,lt,Ne,Ie,Pe,R,F,k,Fe,U,B,L,w,Se,Be,Re,qe,Oe,Ae,$e,H,V,mt,$,be,we,P,N,ye],encapsulation:2})};export{dt as CustomerListComponent};
