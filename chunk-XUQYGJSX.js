import{a as J}from"./chunk-2PZQGA77.js";import{a as q}from"./chunk-DOMKZDO4.js";import{a as L,b as K}from"./chunk-DB3A7P3M.js";import{d as $}from"./chunk-SWNYNPHN.js";import{b as A}from"./chunk-3BP5U2AG.js";import"./chunk-K6UY4OSY.js";import{d as S}from"./chunk-ZBSG24BC.js";import"./chunk-GXR3VSCN.js";import{a as j}from"./chunk-7ZRYRFA4.js";import"./chunk-OJWZ6ZD7.js";import{a as B,h as z}from"./chunk-27T6VRU4.js";import"./chunk-LM7FYRY4.js";import"./chunk-ZENMOCFL.js";import{a as V,b as Y}from"./chunk-EDESGICS.js";import"./chunk-7KAGHLPR.js";import"./chunk-JRF7K3G5.js";import"./chunk-HRGWPEEQ.js";import{Y as H,Z as G}from"./chunk-BVLPFG4Z.js";import"./chunk-LYY57WCE.js";import"./chunk-AGZJ637K.js";import"./chunk-S3JL7UCS.js";import{i as W,r as P}from"./chunk-ETP2OZKZ.js";import{Bb as F,Db as k,Eb as M,Fb as R,Hb as v,Ib as x,Jb as T,Kb as s,Lb as l,Oc as I,Xb as _,Ya as u,Zb as p,ca as D,ic as w,lb as N,mc as d,nc as b,oc as E,pc as O,ta as C}from"./chunk-KGWH6IHP.js";import"./chunk-EQDQRRRY.js";var U=(i,e)=>e.key;function Z(i,e){if(i&1&&(s(0,"th",20)(1,"p",21),d(2),l(),s(3,"p",22),d(4),l()()),i&2){let t=e.$implicit,n=p();w("width",n.cellWidthPx(),"px"),u(2),b(t.dayName),u(2),b(t.day)}}function ee(i,e){if(i&1&&(s(0,"tr")(1,"td",24)(2,"span",25),d(3),l()()()),i&2){let t=p().$implicit,n=p();u(),F("colspan",1+n.dateRange().length),u(2),b(t.roomTypeName)}}function te(i,e){if(i&1&&(s(0,"div",30)(1,"div",31),d(2),l()()),i&2){let t=p(),n=t.$implicit,o=t.$index,r=p().$implicit,c=p(3);w("top",o*50,"%")("height",50,"%")("width",c.getReservationWidth(n,r),"px"),T("ngClass",c.getReservationStyle(n)),u(2),O("",n.guest==null?null:n.guest.firstName," ",n.guest==null?null:n.guest.lastName)}}function ne(i,e){if(i&1&&k(0,te,3,9,"div",29),i&2){let t=e.$implicit,n=p().$implicit,o=p(3);M(o.isReservationStartingOnDate(t,n)?0:-1)}}function oe(i,e){if(i&1&&(s(0,"td",28),v(1,ne,1,1,null,null,R),l()),i&2){let t=p(2).$implicit,n=p();w("width",n.cellWidthPx(),"px"),u(),x(t.reservations)}}function ie(i,e){if(i&1&&(s(0,"tr",23)(1,"td",26),d(2),l(),v(3,oe,3,2,"td",27,U),l()),i&2){let t=p().$implicit,n=p();u(2),E(" ",t.roomName," "),u(),x(n.dateRange())}}function ae(i,e){if(i&1&&k(0,ee,4,2,"tr")(1,ie,5,1,"tr",23),i&2){let t=e.$implicit;M(t.isGroup?0:1)}}var Q=class i{storeStore=D(j);reservationService=D(J);roomService=D(q);viewMode=C("monthly");startDate=C(new Date);dateRange=I(()=>{let e=[],t=this.viewMode(),n=this.alignStartOfPeriod(this.startDate(),t);if(t==="daily"){let o=new Date(n);e.push({key:o.toISOString().slice(0,10),day:o.getDate(),dayName:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][o.getDay()],date:new Date(o)})}else if(t==="weekly")for(let o=0;o<7;o++){let r=new Date(n);r.setDate(r.getDate()+o),e.push({key:r.toISOString().slice(0,10),day:r.getDate(),dayName:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][r.getDay()],date:new Date(r)})}else{let o=n.getFullYear(),r=n.getMonth(),c=new Date(o,r+1,0).getDate();for(let m=0;m<c;m++){let g=new Date(o,r,m+1);e.push({key:g.toISOString().slice(0,10),day:g.getDate(),dayName:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][g.getDay()],date:new Date(g)})}}return e});rooms=S({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.roomService.getRooms(e.storeId)});reservations=S({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.reservationService.getReservations({storeId:e.storeId})});roomTypes=S({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.roomService.getRoomTypes(e.storeId)});roomsWithReservations=I(()=>{let e=this.rooms.value()||[],t=this.roomTypes.value()||[],n=this.reservations.value(),o=Array.isArray(n)?n:n?.reservations||[],r=new Map;for(let a of t)a&&a._id&&r.set(a._id,a.name||"Room");let c=new Map;for(let a of e){let y,h="Room";typeof a.roomType=="string"?(y=a.roomType,h=r.get(a.roomType)||a.roomType):a.roomType&&(y=a.roomType._id,h=a.roomType.name||"Room");let f=y||h;c.has(f)||c.set(f,{typeName:h,rooms:[]}),c.get(f).rooms.push(a)}let m=[];for(let a of t)a&&a._id&&c.has(a._id)&&m.push(a._id);for(let a of c.keys())m.includes(a)||m.push(a);let g=[];for(let a of m){let y=c.get(a);if(y){g.push({isGroup:!0,roomTypeName:y.typeName});for(let h of y.rooms)g.push({isGroup:!1,roomId:h._id,roomName:`${h.roomNumber??""}`,capacity:h.capacity||2,reservations:o.filter(f=>f.rooms&&f.rooms.some(X=>X.room._id===h._id))})}}return g});ngOnInit(){let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1);this.startDate.set(t)}isReservationOnDate(e,t){let n=new Date(e.checkInDate),o=new Date(e.checkOutDate);n.setHours(0,0,0,0),o.setHours(0,0,0,0);let r=new Date(t.date);return r.setHours(0,0,0,0),r>=n&&r<o}isReservationStartingOnDate(e,t){let n=new Date(e.checkInDate);n.setHours(0,0,0,0);let o=new Date(t.date);return o.setHours(0,0,0,0),o.getTime()===n.getTime()}getReservationWidth(e,t){let n=new Date(e.checkInDate),o=new Date(e.checkOutDate),r=this.cellWidthPx(),c=this.cellGapPx();n.setHours(0,0,0,0),o.setHours(0,0,0,0);let m=new Date(t.date);if(m.setHours(0,0,0,0),m<n)return 0;let g=m>n?m:n,y=Math.ceil((o.getTime()-g.getTime())/(1e3*60*60*24));return y*r+(y-1)*c}getReservationStyle(e){let t=["bg-blue-700","bg-green-700","bg-purple-700","bg-pink-700","bg-indigo-700","bg-orange-700","bg-red-700"],o=(e.guest?.firstName||e.guestName||"").charCodeAt(0)%t.length;return t[o]}previousWeek(){let e=this.viewMode(),t=new Date(this.startDate());e==="daily"?t.setDate(t.getDate()-1):e==="weekly"?t.setDate(t.getDate()-7):t.setMonth(t.getMonth()-1),this.startDate.set(this.alignStartOfPeriod(t,e))}nextWeek(){let e=this.viewMode(),t=new Date(this.startDate());e==="daily"?t.setDate(t.getDate()+1):e==="weekly"?t.setDate(t.getDate()+7):t.setMonth(t.getMonth()+1),this.startDate.set(this.alignStartOfPeriod(t,e))}goToToday(){let e=new Date;this.startDate.set(this.alignStartOfPeriod(e,this.viewMode()))}onViewModeChange(e){this.viewMode.set(e),this.goToToday()}alignStartOfPeriod(e,t){let n=new Date(e);if(t==="daily")return n.setHours(0,0,0,0),n;if(t==="weekly"){let o=n.getDay();return n.setDate(n.getDate()-o),n.setHours(0,0,0,0),n}return new Date(n.getFullYear(),n.getMonth(),1)}cellWidthPx(){let e=this.viewMode();return e==="daily"?256:e==="weekly"?128:40}cellGapPx(){let e=this.viewMode();return e==="daily"?8:e==="weekly"?4:2}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=N({type:i,selectors:[["app-reservations-calendar"]],decls:42,vars:1,consts:[[1,"h-screen","flex","flex-col","bg-gray-50"],[1,"bg-white","border-b","border-gray-200","px-6","py-4","shadow-sm"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-600","mt-1"],[1,"flex","gap-3","items-center"],["appearance","outline",1,"w-36"],[3,"selectionChange","value"],["value","daily"],["value","weekly"],["value","monthly"],["mat-stroked-button","",3,"click"],[1,"mr-1"],[1,"ml-1"],[1,"flex-1","overflow-hidden","flex","flex-col"],[1,"overflow-auto","flex-1"],[1,"w-full","border-collapse"],[1,"sticky","left-0","z-10","w-48","bg-white","border","text-center"],[1,"text-xs","font-semibold","text-gray-700","uppercase"],[1,"border","text-center",3,"width"],[1,"border","text-center"],[1,"text-xs","font-semibold","text-gray-600"],[1,"text-sm","font-bold","text-gray-900"],[1,"h-16"],[1,"bg-gray-100","border","px-4","py-2","text-left"],[1,"text-sm","font-semibold","text-gray-800"],[1,"sticky","left-0","z-10","w-48","border","px-4","bg-gray-50"],[1,"border","relative","overflow-visible",3,"width"],[1,"border","relative","overflow-visible"],[1,"absolute","left-0.5","right-0.5","border","text-white","text-xs","font-semibold","overflow-hidden","z-10",3,"ngClass","top","height","width"],[1,"absolute","left-0.5","right-0.5","border","text-white","text-xs","font-semibold","overflow-hidden","z-10",3,"ngClass"],[1,"truncate","px-1"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),d(5,"Reservation Calendar"),l(),s(6,"p",4),d(7,"View all reservations by room and date"),l()(),s(8,"div",5)(9,"mat-form-field",6)(10,"mat-label"),d(11,"View"),l(),s(12,"mat-select",7),_("selectionChange",function(r){return n.onViewModeChange(r.value)}),s(13,"mat-option",8),d(14,"Daily"),l(),s(15,"mat-option",9),d(16,"Weekly"),l(),s(17,"mat-option",10),d(18,"Monthly"),l()()(),s(19,"button",11),_("click",function(){return n.previousWeek()}),s(20,"mat-icon",12),d(21,"chevron_left"),l(),d(22," Previous "),l(),s(23,"button",11),_("click",function(){return n.goToToday()}),d(24,"Today"),l(),s(25,"button",11),_("click",function(){return n.nextWeek()}),d(26," Next "),s(27,"mat-icon",13),d(28,"chevron_right"),l()()()()(),s(29,"div",14)(30,"div",15)(31,"table",16)(32,"thead")(33,"tr")(34,"th",17)(35,"span",18),d(36,"Rooms"),l()(),v(37,Z,5,4,"th",19,U),l()(),s(39,"tbody"),v(40,ae,2,1,null,null,R),l()()()()()),t&2&&(u(12),T("value",n.viewMode()),u(25),x(n.dateRange()),u(3),x(n.roomsWithReservations()))},dependencies:[P,W,G,H,Y,V,A,z,B,K,L,$],encapsulation:2})};export{Q as ReservationsCalendar};
