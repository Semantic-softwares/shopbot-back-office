import{a as nt,b as rt}from"./chunk-KZJU4FZP.js";import{a as ot}from"./chunk-HPPCX3V7.js";import{a as it}from"./chunk-WZNGYR2D.js";import{a as at}from"./chunk-JJIO3ERO.js";import"./chunk-KJFNPXES.js";import{a as tt}from"./chunk-W5COJMSM.js";import"./chunk-LQPRTGPJ.js";import{a as Ye,c as et}from"./chunk-PFBPZS4P.js";import{c as Ke}from"./chunk-GYR27UWT.js";import{c as Xe}from"./chunk-GS72R6E5.js";import"./chunk-QY54KGVM.js";import{c as ze,d as Ue,e as je,f as He,g as qe,h as Qe}from"./chunk-3UMN7V3H.js";import{a as Je,b as Ze}from"./chunk-SLNANJBJ.js";import{a as Te,b as Ie,c as Ne,d as Pe,e as Le,f as Oe,g as Ve,h as Be,i as Ae,j as $e,k as Ge}from"./chunk-SNJMCTTD.js";import{a as We}from"./chunk-GGOIOYKP.js";import"./chunk-LXK533WH.js";import"./chunk-TKDVIZGU.js";import{a as De,b as Ee}from"./chunk-CRWXVOET.js";import{a as we,b as ye,c as Me,d as Fe}from"./chunk-EMC432UM.js";import"./chunk-BTIPWJHT.js";import"./chunk-AR7G356Q.js";import"./chunk-YCI4GSMN.js";import"./chunk-BA3SXM5W.js";import{a as Y}from"./chunk-NWQQ2VP3.js";import{a as Re,b as be}from"./chunk-M54QIQPD.js";import"./chunk-ZXNLXZXA.js";import{d as W}from"./chunk-2NVE2BM3.js";import"./chunk-KAQLA7HR.js";import"./chunk-Y7XAAAUB.js";import{d as ke}from"./chunk-USTUFZ7V.js";import"./chunk-DXWLW3LX.js";import{c as he,d as ve}from"./chunk-7JNU3RG5.js";import{a as ue,d as pe,e as _e,h as ge}from"./chunk-3SKQMCZR.js";import"./chunk-UJ5WOJLI.js";import{a as le,c as ce,e as de,g as me}from"./chunk-X7SU23UW.js";import{a as xe,b as Se}from"./chunk-W6FIBOPD.js";import{C as re,E as se,b as ee,g as te,h as ie,m as ne,s as oe,t as ae}from"./chunk-EQD33MW2.js";import"./chunk-3R2L4BJM.js";import{a as X}from"./chunk-GGWIF4RR.js";import"./chunk-VVXEDJF7.js";import"./chunk-CUQFI5AX.js";import"./chunk-Y4VWLT32.js";import"./chunk-CDKFCYZ5.js";import{b as fe,c as Ce}from"./chunk-2HLT5ZQQ.js";import{X as J,Y as Z,_ as K}from"./chunk-UUZHPQZB.js";import"./chunk-CQ6SLR32.js";import"./chunk-BFT2MTJY.js";import{e as q,g as Q}from"./chunk-QAO3BBZ5.js";import"./chunk-KTA4MFBX.js";import{i as G,n as z,o as U,r as j,t as H}from"./chunk-HUSU2JWO.js";import{Bc as $,Eb as E,F as P,Fb as w,Hc as D,Ib as V,Ic as I,J as L,Jb as B,Jc as y,Kb as u,Lb as n,Mb as o,Nb as R,Rb as v,Rc as k,Sb as f,Ub as C,Yb as m,Za as l,_b as d,ca as S,ha as p,ia as _,ic as T,mb as O,nc as r,oc as x,pc as b,qc as A,sb as h,ta as g}from"./chunk-HCNG3XRF.js";import{f as F}from"./chunk-EQDQRRRY.js";var lt=()=>[5,10,25,50,100],ct=(a,e)=>e.value;function dt(a,e){a&1&&(n(0,"div",7),R(1,"mat-spinner",9),o())}function mt(a,e){if(a&1&&(n(0,"mat-option",25)(1,"span",51),R(2,"span",52),r(3),o()()),a&2){let t=e.$implicit;u("value",t.value),l(2),u("ngClass","bg-"+t.color+"-500 ring-"+t.color+"-200"),l(),b(" ",t.label," ")}}function ut(a,e){a&1&&(n(0,"th",53),r(1,"Confirmation #"),o())}function pt(a,e){if(a&1){let t=C();n(0,"td",54)(1,"mat-chip",55),m("click",function(s){let c=p(t).$implicit,M=d(3);return s.stopPropagation(),_(M.viewReservation(c))}),r(2),o()()}if(a&2){let t=e.$implicit;l(2),b(" ",t.confirmationNumber," ")}}function _t(a,e){a&1&&(n(0,"th",53),r(1,"Guest Information"),o())}function gt(a,e){if(a&1&&(n(0,"td",54),r(1),D(2,"getGuestName"),o()),a&2){let t=e.$implicit;l(),b(" ",I(2,1,t.guest)," ")}}function ht(a,e){a&1&&(n(0,"th",53),r(1,"Room Details"),o())}function vt(a,e){if(a&1&&(n(0,"td",54),r(1),o()),a&2){let t=e.$implicit;l(),b(" ",t.rooms.length," Room(s) ")}}function ft(a,e){a&1&&(n(0,"th",53),r(1,"Stay Period"),o())}function Ct(a,e){if(a&1&&(n(0,"td",54),r(1),D(2,"date"),D(3,"date"),o()),a&2){let t=e.$implicit;l(),A(" ",y(2,2,t.checkInDate,"MMM dd, yyyy")," - ",y(3,5,t.checkOutDate,"MMM dd, yyyy")," ")}}function xt(a,e){a&1&&(n(0,"th",53),r(1,"Nights"),o())}function St(a,e){if(a&1&&(n(0,"td",54),r(1),o()),a&2){let t=e.$implicit;l(),b(" ",t.numberOfNights," ")}}function Rt(a,e){a&1&&(n(0,"th",53),r(1,"Status"),o())}function bt(a,e){if(a&1&&(n(0,"td",54)(1,"mat-chip",56),r(2),D(3,"titlecase"),o()()),a&2){let t=e.$implicit,i=d(3);l(),u("ngClass",i.getStatusChipClass(t.status)),l(),b(" ",I(3,2,t.status)," ")}}function kt(a,e){a&1&&(n(0,"th",53),r(1,"Total Amount"),o())}function Dt(a,e){if(a&1&&(n(0,"td",54)(1,"div",57),r(2),D(3,"currency"),o()()),a&2){let t,i=e.$implicit,s=d(3);l(2),x(y(3,1,i.pricing==null?null:i.pricing.total,(t=s.storeStore.selectedStore())==null?null:t.currency))}}function Et(a,e){a&1&&(n(0,"th",53),r(1,"Actions"),o())}function wt(a,e){if(a&1){let t=C();n(0,"button",59),m("click",function(){p(t);let s=d().$implicit,c=d(3);return _(c.editReservation(s))}),n(1,"mat-icon"),r(2,"edit"),o(),n(3,"span"),r(4,"Edit"),o()()}}function yt(a,e){if(a&1){let t=C();n(0,"button",59),m("click",function(){p(t);let s=d().$implicit,c=d(3);return _(c.openRoomChangeDialog(s))}),n(1,"mat-icon"),r(2,"swap_horiz"),o(),n(3,"span"),r(4,"Change Room"),o()()}}function Mt(a,e){if(a&1){let t=C();R(0,"mat-divider"),n(1,"button",59),m("click",function(){p(t);let s=d().$implicit,c=d(3);return _(c.deleteReservation(s))}),n(2,"mat-icon",61),r(3,"delete"),o(),n(4,"span"),r(5,"Delete Reservation"),o()()}}function Ft(a,e){if(a&1){let t=C();n(0,"td",54)(1,"button",58),m("click",function(s){return p(t),_(s.stopPropagation())}),n(2,"mat-icon"),r(3,"more_vert"),o()(),n(4,"mat-menu",null,1)(6,"button",59),m("click",function(){let s=p(t).$implicit,c=d(3);return _(c.viewReservation(s))}),n(7,"mat-icon"),r(8,"visibility"),o(),n(9,"span"),r(10,"View Details"),o()(),E(11,wt,5,0,"button",60),E(12,yt,5,0,"button",60),E(13,Mt,6,0),o()()}if(a&2){let t=e.$implicit,i=T(5),s=d(3);l(),u("matMenuTriggerFor",i),l(10),w(s.canEdit(t)?11:-1),l(),w(s.canChangeRooms(t)?12:-1),l(),w(s.canDelete(t)?13:-1)}}function Tt(a,e){a&1&&R(0,"tr",62)}function It(a,e){if(a&1){let t=C();n(0,"tr",63),m("click",function(){let s=p(t).$implicit,c=d(3);return _(c.viewReservation(s))}),o()}}function Nt(a,e){if(a&1){let t=C();n(0,"mat-card",12)(1,"div",17)(2,"form",18)(3,"div",19)(4,"div",20)(5,"mat-form-field",21)(6,"mat-label"),r(7,"Search reservations..."),o(),n(8,"mat-icon",22),r(9,"search"),o(),R(10,"input",23),o()(),n(11,"div")(12,"mat-form-field",21)(13,"mat-label"),r(14,"Status"),o(),n(15,"mat-select",24),V(16,mt,4,3,"mat-option",25,ct),o()()(),n(18,"div",20)(19,"mat-form-field",21)(20,"mat-label"),r(21,"Check-in date range"),o(),n(22,"mat-date-range-input",26),R(23,"input",27)(24,"input",28),o(),R(25,"mat-datepicker-toggle",29)(26,"mat-date-range-picker",null,0),o()(),n(28,"div")(29,"mat-form-field",21)(30,"mat-label"),r(31,"Sort by"),o(),n(32,"mat-select",30)(33,"mat-option",31),r(34,"Created Date"),o(),n(35,"mat-option",32),r(36,"Check-in Date"),o(),n(37,"mat-option",33),r(38,"Check-out Date"),o(),n(39,"mat-option",34),r(40,"Total Amount"),o(),n(41,"mat-option",35),r(42,"Guest Name"),o()()()()()()(),n(43,"table",36),v(44,37),h(45,ut,2,0,"th",38)(46,pt,3,1,"td",39),f(),v(47,40),h(48,_t,2,0,"th",38)(49,gt,3,3,"td",39),f(),v(50,41),h(51,ht,2,0,"th",38)(52,vt,2,1,"td",39),f(),v(53,42),h(54,ft,2,0,"th",38)(55,Ct,4,8,"td",39),f(),v(56,43),h(57,xt,2,0,"th",38)(58,St,2,1,"td",39),f(),v(59,44),h(60,Rt,2,0,"th",38)(61,bt,4,4,"td",39),f(),v(62,45),h(63,kt,2,0,"th",38)(64,Dt,4,4,"td",39),f(),v(65,46),h(66,Et,2,0,"th",38)(67,Ft,14,4,"td",39),f(),h(68,Tt,1,0,"tr",47)(69,It,1,0,"tr",48),o(),n(70,"mat-card-actions",49)(71,"mat-paginator",50),m("page",function(s){p(t);let c=d(2);return _(c.onPageChange(s))}),o()()()}if(a&2){let t=T(27),i=d(2);l(2),u("formGroup",i.filterForm),l(14),B(i.statusOptions),l(6),u("formGroup",i.filterForm.controls.dateRange)("rangePicker",t),l(3),u("for",t),l(18),u("dataSource",i.reservations.value().reservations),l(25),u("matHeaderRowDef",i.displayedColumns),l(),u("matRowDefColumns",i.displayedColumns),l(2),u("length",i.totalReservations())("pageSize",i.pageSize())("pageSizeOptions",$(11,lt))("pageIndex",i.currentPage()-1)}}function Pt(a,e){if(a&1){let t=C();n(0,"div",16)(1,"div",64)(2,"mat-icon",65),r(3,"hotel"),o()(),n(4,"h3",66),r(5,"No reservations found"),o(),n(6,"p",67),r(7),o(),n(8,"button",68),m("click",function(){p(t);let s=d(2);return _(s.createReservation())}),n(9,"mat-icon"),r(10,"add"),o(),r(11," Create New Reservation "),o()()}if(a&2){let t,i=d(2);l(7),b(" ",(t=i.filterForm.get("search"))!=null&&t.value||(t=i.filterForm.get("status"))!=null&&t.value?"Try adjusting your filters or search terms to find matching reservations.":"Get started by creating your first reservation to begin managing your hotel bookings."," ")}}function Lt(a,e){if(a&1&&(n(0,"div",10)(1,"div",11)(2,"mat-card",12)(3,"mat-card-content",13)(4,"div",14),r(5,"Total"),o(),n(6,"div",15),r(7),o()()(),n(8,"mat-card",12)(9,"mat-card-content",13)(10,"div",14),r(11,"Confirmed"),o(),n(12,"div",15),r(13),o()()(),n(14,"mat-card",12)(15,"mat-card-content",13)(16,"div",14),r(17,"Checked In"),o(),n(18,"div",15),r(19),o()()(),n(20,"mat-card",12)(21,"mat-card-content",13)(22,"div",14),r(23,"Pending"),o(),n(24,"div",15),r(25),o()()(),n(26,"mat-card",12)(27,"mat-card-content",13)(28,"div",14),r(29,"Cancelled"),o(),n(30,"div",15),r(31),o()()(),n(32,"mat-card",12)(33,"mat-card-content",13)(34,"div",14),r(35,"Revenue"),o(),n(36,"div",15),r(37),D(38,"currency"),o()()()()(),E(39,Nt,72,12,"mat-card",12)(40,Pt,12,1,"div",16)),a&2){let t,i=d();l(7),x(i.reservations.value().reservations.length),l(6),x(i.confirmedCount()),l(6),x(i.checkedInCount()),l(6),x(i.pendingCount()),l(6),x(i.cancelledCount()),l(6),x(y(38,7,i.totalRevenue(),(t=i.storeStore.selectedStore())==null?null:t.currency)),l(2),w(i.reservations.value().reservations.length>0?39:40)}}function Ot(a,e){if(a&1){let t=C();n(0,"div",8)(1,"div",69)(2,"mat-icon",70),r(3,"error"),o(),n(4,"div")(5,"h3",71),r(6,"Error loading reservations"),o(),n(7,"p",72),r(8),o(),n(9,"div",73)(10,"button",74),m("click",function(){p(t);let s=d();return _(s.refreshReservations())}),n(11,"mat-icon",5),r(12,"refresh"),o(),r(13," Retry "),o(),n(14,"button",75),m("click",function(){p(t);let s=d();return _(s.clearError())}),r(15,"Dismiss"),o()()()()()}if(a&2){let t=d();l(8),x(t.reservations.error())}}var st=class a{router=S(Q);route=S(q);fb=S(re);reservationService=S(tt);storeStore=S(Y);snackBar=S(X);dialog=S(Xe);currentPage=g(1);pageSize=g(10);statusUpdating=g(new Set);searchFilter=g("");statusFilter=g("");dateFromFilter=g(null);dateToFilter=g(null);sortByFilter=g("createdAt");sortOrderFilter=g("desc");filterForm=this.fb.group({search:[""],status:[""],dateRange:this.fb.group({start:[null],end:[null]}),sortBy:["createdAt"],sortOrder:["desc"]});confirmedCount=k(()=>this.reservations.value()?.reservations.filter(e=>e.status==="confirmed").length);checkedInCount=k(()=>this.reservations.value()?.reservations.filter(e=>e.status==="checked_in").length);pendingCount=k(()=>this.reservations.value()?.reservations.filter(e=>e.status==="pending").length);cancelledCount=k(()=>this.reservations.value()?.reservations.filter(e=>e.status==="cancelled").length);totalRevenue=k(()=>this.reservations.value()?.reservations.reduce((e,t)=>e+this.getEffectiveTotal(t),0));totalReservations=k(()=>this.reservations.value()?.total||0);filterParams=k(()=>{let t={storeId:this.storeStore.selectedStore()?._id,page:this.currentPage(),limit:this.pageSize(),sortBy:this.sortByFilter(),sortOrder:this.sortOrderFilter()};return this.searchFilter()&&this.searchFilter().trim()&&(t.search=this.searchFilter().trim()),this.statusFilter()&&this.statusFilter().trim()&&(t.status=this.statusFilter().trim()),this.dateFromFilter()&&(t.dateFrom=new Date(this.dateFromFilter()).toISOString().split("T")[0]),this.dateToFilter()&&(t.dateTo=new Date(this.dateToFilter()).toISOString().split("T")[0]),t});displayedColumns=["confirmationNumber","guest","rooms","stayPeriod","nights","status","total","actions"];statusOptions=[{value:"",label:"All Statuses",color:"gray"},{value:"pending",label:"Pending",color:"orange"},{value:"confirmed",label:"Confirmed",color:"blue"},{value:"checked_in",label:"Checked In",color:"green"},{value:"checked_out",label:"Checked Out",color:"purple"},{value:"cancelled",label:"Cancelled",color:"red"},{value:"no_show",label:"No Show",color:"gray"}];constructor(){this.filterForm.valueChanges.pipe(P(300),L()).subscribe(e=>{console.log("Form values changed:",e),this.currentPage.set(1),this.searchFilter.set(e.search||""),this.statusFilter.set(e.status||""),this.dateFromFilter.set(e.dateRange?.start||null),this.dateToFilter.set(e.dateRange?.end||null),this.sortByFilter.set(e.sortBy||"createdAt"),this.sortOrderFilter.set(e.sortOrder||"desc")})}reservations=ke({params:()=>({params:this.filterParams()}),stream:({params:e})=>this.reservationService.getReservations(e.params)});loadReservations(){}onPageChange(e){this.currentPage.set(e.pageIndex+1),this.pageSize.set(e.pageSize),this.loadReservations()}clearFilters(){this.filterForm.reset({search:"",status:"",dateRange:{start:null,end:null},sortBy:"createdAt",sortOrder:"desc"}),this.searchFilter.set(""),this.statusFilter.set(""),this.dateFromFilter.set(null),this.dateToFilter.set(null),this.sortByFilter.set("createdAt"),this.sortOrderFilter.set("desc"),this.currentPage.set(1)}refreshReservations(){this.loadReservations()}getStatusColor(e){return this.statusOptions.find(i=>i.value===e)?.color||"gray"}getStatusChipClass(e){return{pending:"bg-yellow-500! text-white!",confirmed:"bg-blue-600! text-white!",checked_in:"bg-green-600! text-white!",checked_out:"bg-gray-500! text-white!",cancelled:"bg-red-600! text-white!",no_show:"bg-orange-600! text-white!",reserved:"bg-indigo-600! text-white!"}[e]||"bg-gray-500! text-white!"}getGuestName(e){return typeof e.guest=="object"&&e.guest!==null?e.guest.firstName+" "+e.guest.lastName:String(e.guest)}getRoomNumbers(e){return e.rooms.map(t=>typeof t.room=="string"?t.room:t.room.roomNumber).join(", ")}reloadData(){this.reservations.reload()}createReservation(){this.dialog.open(ot,{width:"600px",disableClose:!1}).afterClosed().subscribe(t=>{t&&this.router.navigate(["../create"],{relativeTo:this.route.parent,queryParams:{quickReservation:JSON.stringify(t)}})})}viewReservation(e){this.router.navigate(["../edit",e._id],{relativeTo:this.route.parent})}editReservation(e){this.router.navigate(["../edit",e._id],{relativeTo:this.route.parent})}checkInReservation(e){e.status==="confirmed"&&this.reservationService.checkInReservation(e._id).subscribe({next:()=>{this.refreshReservations()},error:t=>{console.error("Error checking in reservation:",t)}})}checkOutReservation(e){e.status==="checked_in"&&this.reservationService.checkOutReservation(e._id).subscribe({next:()=>{this.refreshReservations()},error:t=>{console.error("Error checking out reservation:",t)}})}cancelReservation(e){let t=prompt("Please provide a reason for cancellation:");t&&this.reservationService.cancelReservation(e._id,t).subscribe({next:()=>{this.refreshReservations()},error:i=>{console.error("Error cancelling reservation:",i)}})}canCheckIn(e){return e.status==="confirmed"&&new Date(e.checkInDate)<=new Date}canCheckOut(e){return e.status==="checked_in"}canCancel(e){return["pending","confirmed"].includes(e.status)}canEdit(e){return e.status!=="cancelled"&&e.status!=="checked_out"&&e.status!=="no_show"&&e.status!=="checked_in"&&!e.actualCheckInDate}canChangeRooms(e){return e.status!=="cancelled"&&e.status!=="checked_out"&&e.status!=="no_show"}openRoomChangeDialog(e){return F(this,null,function*(){if(!this.canChangeRooms(e)){this.snackBar.open("Cannot change rooms for this reservation","Close",{duration:3e3});return}this.dialog.open(at,{width:"500px",maxWidth:"95vw",disableClose:!0,data:{reservationId:e._id,currentRooms:e.rooms,checkInDate:new Date(e.checkInDate).toISOString(),checkOutDate:new Date(e.checkOutDate).toISOString(),numberOfNights:e.numberOfNights,currency:this.storeStore.selectedStore()?.currency||"USD",actualCheckInDate:e.actualCheckInDate?new Date(e.actualCheckInDate).toISOString():void 0,reservationStatus:e.status}}).afterClosed().subscribe(i=>F(this,null,function*(){if(i)try{(yield this.reservationService.changeRooms(e._id,i).toPromise())?.success&&(this.snackBar.open("Room changed successfully","Close",{duration:3e3}),this.reloadData())}catch(s){console.error("Error changing rooms:",s);let c=s?.error?.error||s?.error?.message||s?.message||"Failed to change rooms";this.snackBar.open(c,"Close",{duration:5e3})}}))})}canDelete(e){return["pending","cancelled","no_show"].includes(e.status)}deleteReservation(e){let t=this.storeStore.selectedStore();if(!t?._id){this.snackBar.open("No store selected","Close",{duration:3e3});return}let i={storeId:t._id,actionDescription:`delete reservation ${e.confirmationNumber}`,reservationId:e._id};this.dialog.open(nt,{data:i,width:"500px",maxWidth:"90vw",disableClose:!0}).afterClosed().subscribe(c=>{c?.authorized&&c.pin&&this.performReservationDeletion(e,c.pin)})}performReservationDeletion(e,t){let i=new Set(this.statusUpdating());i.add(e._id),this.statusUpdating.set(i),this.reservationService.deleteReservationWithPin(e._id,t).subscribe({next:s=>{let M=(this.reservations.value()?.reservations||[]).filter(N=>N._id!==e._id);this.snackBar.open(`Reservation ${e.confirmationNumber} deleted successfully`,"Close",{duration:5e3})},error:s=>{console.error("Error deleting reservation:",s),this.snackBar.open(s.message||"Failed to delete reservation","Close",{duration:5e3,panelClass:["error-snackbar"]})},complete:()=>{let s=new Set(this.statusUpdating());s.delete(e._id),this.statusUpdating.set(s)}})}allStatusOptions=[{value:"pending",label:"Pending",icon:"schedule",color:"#f59e0b"},{value:"confirmed",label:"Confirmed",icon:"check_circle",color:"#10b981"},{value:"checked_in",label:"Checked In",icon:"login",color:"#3b82f6"},{value:"checked_out",label:"Checked Out",icon:"logout",color:"#6b7280"},{value:"cancelled",label:"Cancelled",icon:"cancel",color:"#ef4444"},{value:"no_show",label:"No Show",icon:"person_off",color:"#f97316"}];isValidStatusTransition(e,t){return{pending:["confirmed","cancelled","no_show"],confirmed:["checked_in","cancelled","no_show"],checked_in:["checked_out"],checked_out:[],cancelled:[],no_show:[]}[e]?.includes(t)||!1}getStatusTransitionError(e,t){switch(t){case"checked_in":return'Guests can only be checked in when reservation status is "Confirmed"';case"checked_out":return'Guests can only be checked out when reservation status is "Checked In"';case"confirmed":return e==="checked_in"?"Cannot change back to confirmed after check-in":e==="checked_out"?"Cannot change back to confirmed after check-out":"Invalid status transition";default:return`Cannot change status from "${e}" to "${t}"`}}requiresPaymentBeforeCheckout(e){let t=e.pricing.balance>0,i=e.paymentInfo?.status!=="paid";return t&&i}isStatusUpdating(e){return this.statusUpdating().has(e)}getStatusColorHex(e){return{pending:"#f59e0b",confirmed:"#10b981",checked_in:"#3b82f6",checked_out:"#6b7280",cancelled:"#ef4444",no_show:"#f97316"}[e]||"#6b7280"}getStatusIcon(e){return{pending:"schedule",confirmed:"check_circle",checked_in:"login",checked_out:"logout",cancelled:"cancel",no_show:"person_off"}[e]||"help"}clearError(){this.loadReservations()}exportReservations(){try{let e=this.generateCSV(),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(i.download!==void 0){let s=URL.createObjectURL(t);i.setAttribute("href",s),i.setAttribute("download",this.generateExportFilename()),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),this.snackBar.open("Reservations exported successfully","Close",{duration:3e3})}}catch(e){console.error("Error exporting reservations:",e),this.snackBar.open("Failed to export reservations","Close",{duration:5e3,panelClass:["error-snackbar"]})}}generateCSV(){let t=[["Confirmation Number","Guest Name","Email","Phone","Room Numbers","Check-in Date","Check-out Date","Check-in Time","Check-out Time","Status","Adults","Children","Nights","Subtotal","Taxes","Total","Balance","Payment Status","Created Date","Special Requests/Notes"].join(",")];return this.reservations.value()?.reservations.forEach(i=>{let s=[this.escapeCsvField(i.confirmationNumber||""),this.escapeCsvField(this.getGuestName(i)),this.escapeCsvField(typeof i.guest!="string"&&i.guest?.email||""),this.escapeCsvField(typeof i.guest!="string"&&i.guest?.phone||""),this.escapeCsvField(this.getRoomNumbers(i)),this.formatDateForCSV(i.checkInDate),this.formatDateForCSV(this.getEffectiveCheckOutDate(i)),this.escapeCsvField(i.expectedCheckInTime||""),this.escapeCsvField(i.expectedCheckOutTime||""),this.escapeCsvField(i.status||""),i.numberOfNights||0,i.pricing?.subtotal||0,i.pricing?.taxes||0,this.getEffectiveTotal(i),i.pricing?.balance||0,this.escapeCsvField(i.paymentInfo?.status||"pending"),this.formatDateForCSV(i.createdAt),this.escapeCsvField(i.specialRequests||i.internalNotes||"")];t.push(s.join(","))}),t.join(`
`)}escapeCsvField(e){if(e==null)return"";let t=String(e);return t.includes(",")||t.includes('"')||t.includes(`
`)?`"${t.replace(/"/g,'""')}"`:t}formatDateForCSV(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}):""}generateExportFilename(){let e=new Date,t=e.toISOString().split("T")[0],i=e.toTimeString().split(" ")[0].replace(/:/g,"-"),s=`reservations_${t}_${i}`,c=this.filterForm.value;return c.search&&(s+=`_search-${c.search.replace(/[^a-zA-Z0-9]/g,"")}`),c.status&&(s+=`_${c.status}`),(c.dateRange?.start||c.dateRange?.end)&&(s+="_filtered"),`${s}.csv`}hasApprovedExtensions(e){return!!(e.extensions&&e.extensions.some(t=>t.status==="approved"))}getEffectiveCheckOutDate(e){if(this.hasApprovedExtensions(e)){let t=e.extensions?.filter(i=>i.status==="approved")||[];if(t.length>0)return t.reduce((s,c)=>{let M=new Date(s.newCheckOutDate);return new Date(c.newCheckOutDate)>M?c:s}).newCheckOutDate}return e.checkOutDate}getExtensionNights(e){return e.extensions?e.extensions.filter(i=>i.status==="approved").reduce((i,s)=>i+(s.additionalNights||0),0):0}getApprovedExtensionCost(e){return e.extensions?e.extensions.filter(i=>i.status==="approved").reduce((i,s)=>i+(s.additionalCost||0),0):0}getEffectiveTotal(e){return e.pricing?.total||0}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=O({type:a,selectors:[["app-reservations-list"]],decls:21,vars:2,consts:[["dateRangePicker",""],["actionMenu","matMenu"],["title","Reservations","subtitle","Manage hotel reservations and guest bookings","viewToggleRoute","/menu/hms/front-desk/reservations/view",3,"showViewToggle"],["actions",""],["matButton","outlined",3,"click"],[1,"mr-1"],["matButton","filled",3,"click"],[1,"flex","justify-center","items-center"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","m-4"],["diameter","40"],[1,"max-w-12xl","py-6"],[1,"grid","grid-cols-2","md:grid-cols-3","lg:grid-cols-6","gap-4"],["appearance","outlined"],[1,"p-4!"],[1,"text-sm","text-gray-600"],[1,"text-2xl","font-bold"],[1,"py-20","text-center"],[1,"p-3"],[3,"formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","xl:grid-cols-6","gap-4","mb-4"],[1,"lg:col-span-2"],["appearance","outline",1,"w-full"],["matPrefix","",1,"text-gray-400"],["matInput","","placeholder","Guest name or confirmation #","formControlName","search"],["formControlName","status"],[3,"value"],[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date"],["matIconSuffix","",3,"for"],["formControlName","sortBy"],["value","createdAt"],["value","checkInDate"],["value","checkOutDate"],["value","total"],["value","guestName"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","confirmationNumber"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","guest"],["matColumnDef","rooms"],["matColumnDef","stayPeriod"],["matColumnDef","nights"],["matColumnDef","status"],["matColumnDef","total"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","cursor-pointer",3,"click",4,"matRowDef","matRowDefColumns"],[1,"flex","justify-end"],["showFirstLastButtons","",3,"page","length","pageSize","pageSizeOptions","pageIndex"],[1,"flex","items-center"],[1,"w-3","h-3","rounded-full","mr-3","ring-2",3,"ngClass"],["mat-header-cell",""],["mat-cell",""],[3,"click"],[3,"ngClass"],[1,"font-bold"],["mat-icon-button","",3,"click","matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item",""],["color","warn"],["mat-header-row",""],["mat-row","",1,"cursor-pointer",3,"click"],[1,"w-16","h-16","bg-gray-200","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],[1,"text-4xl","text-gray-400"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-500","mb-6"],["matButton","filled","color","primary",3,"click"],[1,"flex"],[1,"text-red-500","mr-2"],[1,"text-red-800","font-medium"],[1,"text-red-700","text-sm","mt-1"],[1,"mt-3","flex","space-x-3"],["mat-button","","color","warn",1,"!text-red-600",3,"click"],["mat-button","",1,"!text-gray-600",3,"click"]],template:function(t,i){t&1&&(n(0,"app-page-header",2),v(1,3),n(2,"button",4),m("click",function(){return i.clearFilters()}),n(3,"mat-icon"),r(4,"clear"),o(),r(5," Clear Filters "),o(),n(6,"button",4),m("click",function(){return i.reloadData()}),n(7,"mat-icon",5),r(8,"redo"),o(),r(9," Reload "),o(),n(10,"button",4),m("click",function(){return i.exportReservations()}),n(11,"mat-icon",5),r(12,"download"),o(),r(13," Export "),o(),n(14,"button",6),m("click",function(){return i.createReservation()}),n(15,"mat-icon",5),r(16,"add"),o(),r(17," Create Reservation "),o(),f(),o(),E(18,dt,2,0,"div",7)(19,Lt,41,10)(20,Ot,16,1,"div",8)),t&2&&(u("showViewToggle",!0),l(18),w(i.reservations.isLoading()?18:i.reservations.hasValue()?19:i.reservations.error()?20:-1))},dependencies:[H,G,se,ne,ee,te,ie,ae,oe,Ge,Te,Ne,Ve,Pe,Ie,Be,Le,Oe,Ae,$e,Ze,Je,Ke,ve,he,ge,ue,pe,_e,be,Re,W,K,Z,J,Ce,fe,et,Ye,me,le,de,ce,Fe,ye,we,Me,We,Qe,ze,Ue,je,He,qe,Se,xe,Ee,De,it,z,j,U,rt],encapsulation:2})};export{st as ReservationsListComponent};
