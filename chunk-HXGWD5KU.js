import{a as W}from"./chunk-LJSEVW7O.js";import{w as H,x as F}from"./chunk-5PWABXJE.js";import{E as P,Gc as w,Hc as E,Ic as $,M as A,W as N,Z as _,aa as b,b as D,c as k,fa as f,g as K,ka as x,l as U,p as L,pa as T,ra as j,ua as I,va as Y}from"./chunk-FR2FBSQW.js";import{a as n,b as p}from"./chunk-EQDQRRRY.js";var R=class t{CURRENT_USER_KEY="currentUser";AUTH_TOKEN_KEY="auth_token";STORES_KEY="store";constructor(){}setCurrentUser(e){localStorage.setItem(this.CURRENT_USER_KEY,JSON.stringify(e))}getCurrentUser(){let e=localStorage.getItem(this.CURRENT_USER_KEY);return e?JSON.parse(e):null}removeCurrentUser(){localStorage.removeItem(this.CURRENT_USER_KEY)}clearAll(){localStorage.clear()}setAuthToken(e){localStorage.setItem(this.AUTH_TOKEN_KEY,e)}getAuthToken(){return localStorage.getItem(this.AUTH_TOKEN_KEY)}removeAuthToken(){localStorage.removeItem(this.AUTH_TOKEN_KEY)}setItem(e,r){try{localStorage.setItem(e,JSON.stringify(r))}catch(o){console.error("Error saving to sessionStorage:",o)}}getItem(e){try{let r=localStorage.getItem(e);return r?JSON.parse(r):null}catch(r){return console.error("Error reading from sessionStorage:",r),null}}removeItem(e){localStorage.removeItem(e)}clear(){localStorage.clear()}setStore(e){localStorage.setItem(this.STORES_KEY,JSON.stringify(e))}setStores(e){localStorage.setItem("stores",JSON.stringify(e))}getStores(){let e=localStorage.getItem("stores");return e?JSON.parse(e):null}removeStores(){localStorage.removeItem("stores")}getStore(){let e=localStorage.getItem(this.STORES_KEY);return e?JSON.parse(e):null}removeStore(){localStorage.removeItem(this.STORES_KEY)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=b({token:t,factory:t.\u0275fac,providedIn:"root"})};var O=class t{hostServer=W.apiUrl;_httpClient=f(F);sessionStorageService=f(R);createStore(e){return this._httpClient.post(`${this.hostServer}/stores/web`,e)}getStoreCategories(){return this._httpClient.get(`${this.hostServer}/categories`)}deliveryZones(){return this._httpClient.get(`${this.hostServer}/delivery-zones`)}getMerchantStore(e){return this._httpClient.get(`${this.hostServer}/stores/merchant/${e}`)}getMerchantStores(e){return this._httpClient.get(`${this.hostServer}/stores/${e}/vendors`)}updateStore(e,r){return this._httpClient.put(`${this.hostServer}/stores/${e}`,r)}get getStoreLocally(){return this.sessionStorageService.getStore()}get getStoresLocally(){return this.sessionStorageService.getStores()}saveStoresLocally(e){this.sessionStorageService.setStores(e)}saveStoreLocally(e){this.sessionStorageService.setStore(e)}deleteStoreLocally(){this.sessionStorageService.removeStore()}getStore(e){return this._httpClient.get(`${this.hostServer}/stores/${e}`)}addStore(e){return this._httpClient.post(`${this.hostServer}/stores`,e)}getStoreOrders(e){return this._httpClient.get(`${this.hostServer}/orders/store/${e}/orders`)}deleteStoreOrders(e){return this._httpClient.delete(`${this.hostServer}/orders/${e}`)}updateOrderStatus(e,r,o){return this._httpClient.put(`${this.hostServer}/orders/${e}/status/${r}`,o)}uploadLogo(e,r){return this._httpClient.post(`${this.hostServer}/stores/upload/${r}/logo`,e)}uploadBanner(e,r){return this._httpClient.post(`${this.hostServer}/stores/upload/${r}/banner`,e)}getOrderStat(e){let r=new H({fromObject:e});return this._httpClient.get(`${this.hostServer}/dashboard/total-store-sales?${r.toString()}`)}getIncompleteData(e){return this._httpClient.get(`${this.hostServer}/stores/in-complete-data/${e}`)}getDeliveryZonesFromServer(){return this._httpClient.get(`${this.hostServer}/delivery-zones`)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=b({token:t,factory:t.\u0275fac,providedIn:"root"})};function J(t){let e=w(()=>t());return te(e)?new Proxy(t,{get(r,o){return o in e?(I(r[o])||Object.defineProperty(r,o,{value:E(()=>r()[o]),configurable:!0}),J(r[o])):r[o]}}):t}var ee=[WeakSet,WeakMap,Promise,Date,Error,RegExp,ArrayBuffer,DataView,Function];function te(t){if(t===null||typeof t!="object"||re(t))return!1;let e=Object.getPrototypeOf(t);if(e===Object.prototype)return!0;for(;e&&e!==Object.prototype;){if(ee.includes(e.constructor))return!1;e=Object.getPrototypeOf(e)}return e===Object.prototype}function re(t){return typeof t?.[Symbol.iterator]=="function"}var oe=new WeakMap,c=Symbol("STATE_SOURCE");function l(t,...e){t[c].update(r=>e.reduce((o,a)=>n(n({},o),typeof a=="function"?a(o):a),r)),se(t)}function ne(t){return t[c]()}function ie(t){return oe.get(t[c])||[]}function se(t){let e=ie(t);for(let r of e){let o=w(()=>ne(t));r(o)}}function Z(...t){let e=[...t],r=typeof e[0]=="function"?{}:e.shift(),o=e;return(()=>{class s{constructor(){let S=o.reduce((g,X)=>X(g),ae()),{stateSignals:h,props:m,methods:y,hooks:i}=S,d=n(n(n({},h),m),y);this[c]=S[c];for(let g of Reflect.ownKeys(d))this[g]=d[g];let{onInit:v,onDestroy:C}=i;v&&v(),C&&f(j).onDestroy(C)}static \u0275fac=function(h){return new(h||s)};static \u0275prov=b({token:s,factory:s.\u0275fac,providedIn:r.providedIn||null})}return s})()}function ae(){return{[c]:Y({}),stateSignals:{},props:{},methods:{},hooks:{}}}function ce(t){return e=>{let r=t(n(n(n({[c]:e[c]},e.stateSignals),e.props),e.methods));return Reflect.ownKeys(r),p(n({},e),{props:n(n({},e.props),r)})}}function B(t){return ce(t)}function q(t){return e=>{let r=n(n(n({[c]:e[c]},e.stateSignals),e.props),e.methods),o=typeof t=="function"?t(r):t,a=s=>{let u=o[s],S=e.hooks[s];return u?()=>{S&&S(),u(r)}:S};return p(n({},e),{hooks:{onInit:a("onInit"),onDestroy:a("onDestroy")}})}}function V(t){return e=>{let r=t(n(n(n({[c]:e[c]},e.stateSignals),e.props),e.methods));return Reflect.ownKeys(r),p(n({},e),{methods:n(n({},e.methods),r)})}}function G(t){return e=>{let r=typeof t=="function"?t():t,o=Reflect.ownKeys(r);e[c].update(s=>n(n({},s),r));let a=o.reduce((s,u)=>{let S=E(()=>e[c]()[u]);return p(n({},s),{[u]:J(S)})},{});return p(n({},e),{stateSignals:n(n({},e.stateSignals),a)})}}function Q(t,e,r){let o=typeof t=="function"?{next:t,error:e,complete:r}:t;return a=>a.pipe(_({next:o.next,complete:o.complete}),P(s=>(o.error(s),U)),o.finalize?A(o.finalize):s=>s)}function M(t,e){e?.injector||x(M);let r=e?.injector??f(T),o=new K,a=t(o).subscribe();r.get(j).onDestroy(()=>a.unsubscribe());let s=(u,S)=>{if(le(u))return o.next(u),{destroy:D};let h=ue(),m=S?.injector??h??r;if(I(u)){let i=$(()=>{let d=u();w(()=>o.next(d))},{injector:m});return a.add({unsubscribe:()=>i.destroy()}),i}let y=u.subscribe(i=>o.next(i));return a.add(y),m!==r&&m.get(j).onDestroy(()=>y.unsubscribe()),{destroy:()=>y.unsubscribe()}};return s.destroy=a.unsubscribe.bind(a),s}function le(t){return!I(t)&&!L(t)}function ue(){try{return f(T)}catch{return}}var Se={stores:[],isLoading:!1,selectedStore:null,error:null,logoPath:null,bannerPath:null},Ae=Z({providedIn:"root"},G(Se),B(({stores:t})=>({storesCount:E(()=>t().length)})),V((t,e=f(O))=>{function r(i){l(t,{isLoading:i})}function o(i){e.saveStoreLocally(i),l(t,{selectedStore:i})}function a(i){e.saveStoresLocally(i),l(t,{stores:i})}function s(){l(t,{stores:[]})}function u(){let i=e.getStoreLocally;i&&l(t,{selectedStore:i})}function S(i,d){let v=t.selectedStore();if(v){let C=v.staffs.map(g=>g._id===i?n(n({},g),d):g);l(t,{selectedStore:p(n({},v),{staffs:C})})}}function h(i){let d=t.selectedStore();d&&l(t,{selectedStore:p(n(n({},d),i),{_id:d._id})})}function m(i){l(t,{logoPath:i})}let y=M(k(_(()=>l(t,{isLoading:!0,error:null})),N(i=>e.updateStore(t.selectedStore()._id,i).pipe(Q({next(d){l(t,{isLoading:!1,error:null,logoPath:null,bannerPath:null}),h(i)},error(d){l(t,{isLoading:!1,error:d})}})))));return{setSelectedStores:a,clearStores:s,updateStore$:y,updateStore:h,updateStoreStaffs:S,setSelectedStore:o,initializeFromStorage:u,updateLogoPath:m,setLoadingState:r}}),q({onInit(t,e=f(O)){let r=e.getStoresLocally,o=e.getStoreLocally;r&&r.length>0&&l(t,{stores:r}),o&&l(t,{selectedStore:o})}}));export{R as a,O as b,Ae as c};
