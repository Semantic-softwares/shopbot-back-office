import{a as ve,b as xe}from"./chunk-S35VCKTJ.js";import{a as pe,b as ue,d as ge,e as _e,f as fe,g as he,h as Ce}from"./chunk-XNNKKASY.js";import{a as re,b as se,e as ae,h as le,i as me,k as ce,l as de}from"./chunk-S5GZV54O.js";import{a as oe,b as ne}from"./chunk-4XV2UKEU.js";import{d as ie}from"./chunk-BXJEGH2V.js";import{b as X,c as Y,d as Z}from"./chunk-UMV4DCPT.js";import{a as K,b as Q,h as W}from"./chunk-G3VZM262.js";import{a as ee,b as te}from"./chunk-6I3AJKA7.js";import{B as J,b as j,d as A,g as B,h as $,m as z,s as q,t as H,z as U}from"./chunk-W7NMJLMQ.js";import{a as G,b as N}from"./chunk-4UBDYPTG.js";import{a as V}from"./chunk-UVV7QZRX.js";import{b as L,c as O}from"./chunk-JPRPNQOM.js";import{_ as w,ba as T}from"./chunk-3LDCGXHW.js";import{Ib as v,Jb as x,Lb as k,Mb as b,Nb as P,Ob as p,Pb as r,Qb as n,Rb as C,Vc as M,Yb as S,ac as u,bb as a,cc as d,fa as _,ka as f,la as h,qb as E,qc as I,rc as m,sc as g,tc as R,uc as F,wa as D}from"./chunk-J2AK4FW5.js";var be=(s,o)=>o.code;function Pe(s,o){s&1&&(r(0,"mat-error"),m(1,"Role name is required"),n())}function Se(s,o){s&1&&(r(0,"div",10),C(1,"mat-spinner",16),n())}function ye(s,o){if(s&1&&(r(0,"div",27),m(1),n()),s&2){let e=d().$implicit;a(),g(e.description)}}function De(s,o){if(s&1){let e=S();r(0,"mat-list-option",24),u("selectedChange",function(i){let l=f(e).$implicit,c=d(4);return h(c.togglePermission(l.code,i))}),r(1,"mat-icon",25),m(2),n(),r(3,"div",26),m(4),n(),v(5,ye,2,1,"div",27),n()}if(s&2){let e=o.$implicit,t=d(4);p("selected",t.selectedPermissions().has(e.code)),a(2),g(t.selectedPermissions().has(e.code)?"check_circle":"radio_button_unchecked"),a(2),g(e.name),a(),x(e.description?5:-1)}}function ke(s,o){if(s&1){let e=S();r(0,"div",22)(1,"mat-checkbox",19),u("click",function(i){return f(e),h(i.stopPropagation())})("change",function(i){let l=f(e).$implicit,c=d().$implicit,y=d(2);return h(y.toggleGroup(c,l,i.checked))}),n(),r(2,"span",6),m(3),n()(),b(4,De,6,4,"mat-list-option",23,be),C(6,"mat-divider")}if(s&2){let e=o.$implicit,t=d().$implicit,i=d(2);a(),p("checked",i.isGroupFullySelected(t,e))("indeterminate",i.isGroupPartiallySelected(t,e)),a(2),g(e),a(),P(i.groupedPermissions()[t][e])}}function Re(s,o){if(s&1){let e=S();r(0,"div",18)(1,"mat-checkbox",19),u("click",function(i){return f(e),h(i.stopPropagation())})("change",function(i){let l=f(e).$implicit,c=d(2);return h(c.toggleModule(l,i.checked))}),n(),r(2,"mat-icon"),m(3),n(),r(4,"span",20),m(5),n(),r(6,"span",21),m(7),n()(),b(8,ke,7,3,null,null,k)}if(s&2){let e=o.$implicit,t=d(2);a(),p("checked",t.isModuleFullySelected(e))("indeterminate",t.isModulePartiallySelected(e)),a(),I(t.getModuleColor(e)),a(),g(t.getModuleIcon(e)),a(2),g(e),a(2),F(" ",t.getSelectedModuleCount(e)," / ",t.getTotalModulePermissions(e)," "),a(),P(t.getGroupsForModule(e))}}function Fe(s,o){if(s&1&&(r(0,"div",11)(1,"mat-selection-list",17),b(2,Re,10,8,null,null,k),n()()),s&2){let e=d();a(),p("multiple",!0),a(),P(e.modules())}}function Ee(s,o){s&1&&C(0,"mat-spinner",15)}var Me=class s{fb=_(U);rolesService=_(V);dialogRef=_(pe);snackBar=_(G);data=_(ue);roleForm;saving=D(!1);selectedPermissions=D(new Set);permissionsResource=ie({params:()=>({}),stream:()=>this.rolesService.getGroupedPermissions()});groupedPermissions=M(()=>this.permissionsResource.value()||{});allPermissions=M(()=>{let o=this.groupedPermissions(),e=[];for(let t of Object.keys(o))for(let i of Object.keys(o[t]))e.push(...o[t][i]);return e});modules=M(()=>Object.keys(this.groupedPermissions()));isEditMode=M(()=>!!this.data.role);ngOnInit(){if(this.roleForm=this.fb.group({name:[this.data.role?.name||"",A.required],description:[this.data.role?.description||""]}),this.data.role?.permissions){let o=new Set(this.data.role.permissions.map(e=>e.code));this.selectedPermissions.set(o)}}togglePermission(o,e){let t=new Set(this.selectedPermissions());e?t.add(o):t.delete(o),this.selectedPermissions.set(t)}toggleGroup(o,e,t){let i=this.groupedPermissions()[o]?.[e]||[],l=new Set(this.selectedPermissions());for(let c of i)t?l.add(c.code):l.delete(c.code);this.selectedPermissions.set(l)}toggleModule(o,e){let t=this.groupedPermissions()[o]||{},i=new Set(this.selectedPermissions());for(let l of Object.values(t))for(let c of l)e?i.add(c.code):i.delete(c.code);this.selectedPermissions.set(i)}selectAll(){let o=new Set(this.allPermissions().map(e=>e.code));this.selectedPermissions.set(o)}deselectAll(){this.selectedPermissions.set(new Set)}isModuleFullySelected(o){let e=this.groupedPermissions()[o]||{},t=this.selectedPermissions();for(let i of Object.values(e))for(let l of i)if(!t.has(l.code))return!1;return Object.keys(e).length>0}isModulePartiallySelected(o){let e=this.groupedPermissions()[o]||{},t=this.selectedPermissions(),i=!1,l=!1;for(let c of Object.values(e))for(let y of c)t.has(y.code)?i=!0:l=!0;return i&&l}isGroupFullySelected(o,e){let t=this.groupedPermissions()[o]?.[e]||[],i=this.selectedPermissions();return t.length>0&&t.every(l=>i.has(l.code))}isGroupPartiallySelected(o,e){let t=this.groupedPermissions()[o]?.[e]||[],i=this.selectedPermissions(),l=t.filter(c=>i.has(c.code)).length;return l>0&&l<t.length}getSelectedModuleCount(o){let e=this.groupedPermissions()[o]||{},t=this.selectedPermissions(),i=0;for(let l of Object.values(e))for(let c of l)t.has(c.code)&&i++;return i}getTotalModulePermissions(o){let e=this.groupedPermissions()[o];return e?Object.values(e).reduce((t,i)=>t+i.length,0):0}getGroupsForModule(o){return Object.keys(this.groupedPermissions()[o]||{})}getModuleIcon(o){switch(o){case"Hotel Management":return"hotel";case"ERP":return"inventory_2";case"Finance":return"payments";case"Settings":return"settings";default:return"folder"}}getModuleColor(o){switch(o){case"Hotel Management":return"text-blue-600";case"ERP":return"text-green-600";case"Finance":return"text-purple-600";case"Settings":return"text-gray-600";default:return"text-gray-500"}}saveRole(){if(this.roleForm.invalid||this.selectedPermissions().size===0)return;this.saving.set(!0);let o=this.selectedPermissions(),e=this.allPermissions().filter(i=>o.has(i.code)).map(i=>i._id),t={name:this.roleForm.get("name")?.value,description:this.roleForm.get("description")?.value,store:this.data.storeId,permissions:e};this.isEditMode()?this.rolesService.updateRole(this.data.role._id,t).subscribe({next:i=>{this.saving.set(!1),this.snackBar.open("Role updated successfully!","Close",{duration:3e3}),this.dialogRef.close(i)},error:i=>{this.saving.set(!1),this.snackBar.open(i.error?.message||"Failed to update role","Close",{duration:5e3})}}):this.rolesService.createRole(t).subscribe({next:i=>{this.saving.set(!1),this.snackBar.open("Role created successfully!","Close",{duration:3e3}),this.dialogRef.close(i)},error:i=>{this.saving.set(!1),this.snackBar.open(i.error?.message||"Failed to create role","Close",{duration:5e3})}})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=E({type:s,selectors:[["app-create-role-dialog"]],decls:36,vars:9,consts:[["mat-dialog-title",""],[1,"space-y-4",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","e.g., Night Shift Manager"],["matInput","","formControlName","description","rows","2","placeholder","Describe what this role is for..."],[1,"flex","items-center","justify-between","p-4"],[1,"font-medium","text-gray-700"],[1,"flex","gap-2"],["mat-stroked-button","","type","button",1,"!text-sm",3,"click"],[1,"text-sm","text-gray-500","px-4","py-2"],[1,"flex","justify-center","p-8"],[1,"max-h-[400px]","overflow-y-auto"],["align","end",1,"p-4"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click","disabled"],["diameter","20",1,"inline-block","mr-2"],["diameter","32"],[3,"multiple"],["mat-subheader","",1,"flex","items-center","gap-2","!h-auto","!py-2","bg-gray-100","sticky","top-0","z-10"],[3,"click","change","checked","indeterminate"],[1,"font-semibold"],[1,"text-sm","text-gray-500","ml-auto"],["mat-subheader","",1,"flex","items-center","gap-2","!h-auto","!py-1","bg-gray-50"],[3,"selected"],[3,"selectedChange","selected"],["matListItemIcon",""],["matListItemTitle",""],["matListItemLine","",1,"text-gray-500"]],template:function(e,t){if(e&1&&(r(0,"h2",0),m(1),n(),r(2,"mat-dialog-content")(3,"form",1)(4,"mat-form-field",2)(5,"mat-label"),m(6,"Role Name"),n(),C(7,"input",3),v(8,Pe,2,0,"mat-error"),n(),r(9,"mat-form-field",2)(10,"mat-label"),m(11,"Description"),n(),C(12,"textarea",4),n(),r(13,"div")(14,"div",5)(15,"h3",6),m(16,"Permissions"),n(),r(17,"div",7)(18,"button",8),u("click",function(){return t.selectAll()}),r(19,"mat-icon"),m(20,"check_box"),n(),m(21," Select All "),n(),r(22,"button",8),u("click",function(){return t.deselectAll()}),r(23,"mat-icon"),m(24,"check_box_outline_blank"),n(),m(25," Deselect All "),n()()(),r(26,"div",9),m(27),n(),v(28,Se,2,0,"div",10)(29,Fe,4,1,"div",11),n()()(),r(30,"mat-dialog-actions",12)(31,"button",13),m(32,"Cancel"),n(),r(33,"button",14),u("click",function(){return t.saveRole()}),v(34,Ee,1,0,"mat-spinner",15),m(35),n()()),e&2){let i;a(),R(" ",t.isEditMode()?"Edit Role":"Create Custom Role",`
`),a(2),p("formGroup",t.roleForm),a(5),x((i=t.roleForm.get("name"))!=null&&i.hasError("required")?8:-1),a(19),F(" Selected: ",t.selectedPermissions().size," / ",t.allPermissions().length," permissions "),a(),x(t.permissionsResource.isLoading()?28:29),a(5),p("disabled",t.roleForm.invalid||t.saving()||t.selectedPermissions().size===0),a(),x(t.saving()?34:-1),a(),R(" ",t.isEditMode()?"Update Role":"Create Role"," ")}},dependencies:[J,z,j,B,$,H,q,Ce,ge,_e,he,fe,T,w,X,W,K,Q,Z,Y,O,L,xe,ve,de,ce,le,ae,me,oe,se,re,ne,te,ee,N],encapsulation:2,changeDetection:0})};export{Me as a};
