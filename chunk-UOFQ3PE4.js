import{a as _e,b as fe,c as he,d as Te}from"./chunk-A6CFPM4N.js";import{e as ye,g as Se}from"./chunk-CUXCECGE.js";import"./chunk-H3PMPS6B.js";import"./chunk-JRHYUNXY.js";import"./chunk-CQRXSTAL.js";import{c as ge,e as ue,f as Ce}from"./chunk-CU623SSI.js";import{f as be}from"./chunk-Y6EIGA75.js";import{a as ce,b as pe,c as me}from"./chunk-HJ3KAQ7K.js";import{k as de}from"./chunk-2UZI5XAB.js";import"./chunk-4XV2UKEU.js";import"./chunk-Q4U6FYZ3.js";import{a as n,b as Y,c as Z,d as ee,e as te,f as re,g as x,h as M,i as I}from"./chunk-QC7H4KPM.js";import"./chunk-TIVXUJ22.js";import"./chunk-WAHSRZAW.js";import"./chunk-XLZTIYSF.js";import{b as ne,d as se}from"./chunk-UMV4DCPT.js";import"./chunk-G3VZM262.js";import"./chunk-BCE7WRWQ.js";import"./chunk-6I3AJKA7.js";import{A as le}from"./chunk-W7NMJLMQ.js";import"./chunk-F5SZ3AU3.js";import"./chunk-4UBDYPTG.js";import"./chunk-TILT22SG.js";import{a as X}from"./chunk-BFT2MTJY.js";import{h as ie}from"./chunk-3E3PJ7Q7.js";import"./chunk-FO4KTVQ3.js";import"./chunk-TRZH7NMW.js";import"./chunk-GXTELBJV.js";import{b as ae,c as oe}from"./chunk-JPRPNQOM.js";import{ba as W}from"./chunk-3LDCGXHW.js";import{e as J,g as K}from"./chunk-ZLVQTB5B.js";import{s as q,y as z}from"./chunk-6PFJHDFS.js";import{Ib as A,Jb as j,Mb as $,Nb as D,Ob as h,Pb as c,Qb as d,V as S,Vc as U,Y as v,Yb as O,aa as R,ac as T,bb as g,c as y,cc as C,fa as p,gc as B,hc as H,ic as G,ka as m,la as b,qb as Q,rc as u,tc as w,wa as L}from"./chunk-J2AK4FW5.js";import{a as E}from"./chunk-GAL4ENT6.js";var F=class t{hostServer=X.apiUrl;_httpClient=p(z);getStoreTableCategories(e){return this._httpClient.get(`${this.hostServer}/table-categories/store/${e}`)}deleteTableCategory(e){return this._httpClient.delete(`${this.hostServer}/table-categories/${e}`)}createTableCategory(e){return this._httpClient.post(`${this.hostServer}/table-categories`,e)}updateTableCategory(e,r){return this._httpClient.put(`${this.hostServer}/table-categories/${e}`,r)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=R({token:t,factory:t.\u0275fac,providedIn:"root"})};var Ie={tableCategories:[],selectedTableCategory:null,isLoading:!1,error:null},ve=Y({providedIn:"root"},re(Ie),Z(({tableCategories:t})=>({tablesCategoryCount:U(()=>t().length)})),te((t,e=p(F))=>{let r=i=>{n(t,{selectedTableCategory:i})},a=()=>{n(t,{selectedTableCategory:null})},o=(i,s)=>{let V=t.tableCategories().map(k=>k._id===i?E(E({},k),s):k);n(t,{tableCategories:V})},l=i=>{n(t,{tableCategories:[...t.tableCategories(),i]})},_=i=>{let s=t.tableCategories().filter(V=>V._id!==i);n(t,{tableCategories:s})},f=M(y(v(()=>n(t,{isLoading:!0,error:null,tableCategories:[]})),S(i=>e.getStoreTableCategories(i).pipe(x({next(s){n(t,{isLoading:!1,error:null,tableCategories:s,selectedTableCategory:null})},error(s){n(t,{isLoading:!1,error:String(s)})}}))))),P=M(y(v(()=>n(t,{isLoading:!0,error:null})),S(i=>e.createTableCategory(i.tableParams).pipe(x({next(s){n(t,{isLoading:!1,error:null}),l(s),i?.modalParams&&i.modalParams.closeCallback()},error(s){n(t,{isLoading:!1,error:String(s)})}}))))),N=M(y(v(()=>n(t,{isLoading:!0,error:null})),S(i=>e.updateTableCategory(i.tableId,i.tableParams).pipe(x({next(s){n(t,{isLoading:!1,error:null}),o(i.tableId,i.tableParams),i?.modalParams&&i.modalParams.closeCallback()},error(s){n(t,{isLoading:!1,error:String(s)})}}))))),Me=M(y(v(()=>n(t,{isLoading:!0,error:null})),S(i=>e.deleteTableCategory(i).pipe(x({next(s){n(t,{isLoading:!1,error:null}),_(i)},error(s){n(t,{isLoading:!1,error:String(s)})}})))));return{selectTableCategory:r,clearSelectedTableCategory:a,updateTableParams:o,createTableCategory:l,deleteTableCategory:_,getTablesCategories$:f,createTableCategory$:P,updateTableCategory$:N,deleteTableCategory$:Me}}),ee({onInit(t){let r=p(I).selectedStore();r?._id&&t.getTablesCategories$(r._id)}}));var Fe=["searchComponent"],we=(t,e)=>e._id;function Pe(t,e){if(t&1){let r=O();c(0,"mat-chip-option",16),T("click",function(){let o=m(r).$implicit,l=C();return b(l.onCategorySelect(o))}),u(1),d()}if(t&2){let r,a=e.$implicit,o=C();h("selected",((r=o.tableCategoryStore.selectedTableCategory())==null?null:r._id)===a._id),g(),w(" ",a.name," ")}}function Ve(t,e){if(t&1){let r=O();c(0,"app-table-card",21),T("addNewOrder",function(o){m(r);let l=C();return b(l.onAddNewOrder(o))})("viewOrder",function(o){m(r);let l=C();return b(l.viewOrder(o))})("completeOrder",function(o){m(r);let l=C();return b(l.completeOrder(o))})("clearOrder",function(o){m(r);let l=C();return b(l.onClearOrder(o))})("tableClick",function(o){m(r);let l=C();return b(l.onTableClick(o))}),d()}if(t&2){let r=e.$implicit;h("table",r)}}function ke(t,e){t&1&&(c(0,"div",20)(1,"mat-icon",22),u(2,"table_restaurant"),d(),c(3,"p"),u(4,"No tables found"),d()())}var xe=class t{searchFilter="";tableStore=p(Te);tableCategoryStore=p(ve);saleTypeStore=p(ye);orderStore=p(Se);storeStore=p(I);dialog=p(be);router=p(K);route=p(J);viewMode=L("grid");searchQuery=L("");searchComponent;displayedColumns=["name","seats","category","status"];onSearchChange(e){this.searchQuery.set(e),this.tableStore.updateSearchQuery(e)}clearSearch(){this.searchQuery.set(""),this.searchComponent.clearFilter()}onStatusFilterChange(e){this.tableStore.updateStatusFilter(e)}onCategorySelect(e){this.tableCategoryStore.selectTableCategory(e),this.tableStore.updateSearchFilter(e)}clearCategoryFilter(){this.tableCategoryStore.clearSelectedTableCategory(),this.tableStore.updateSearchFilter(null)}onTableClick(e){this.tableStore.selectTable(e._id)}onAddNewOrder(e){this.tableStore.selectTable(e._id),this.saleTypeStore.setSelectedSaleType("table"),this.router.navigate(["checkout"],{relativeTo:this.route})}onClearOrder(e){e.orderId&&(this.tableStore.updateTable(e._id,{orderId:null,order:null}),this.tableStore.updateTableOrderSync(e._id,{orderId:null}),console.log("Order cleared from table:",e.name))}completeOrder(e){console.log("Completing order for table:",e);let r=e.orderId?._id,a=e.orderId?.total||0,o=this.storeStore.selectedStore()?.currency||"\u20A6";if(!r){console.error("No order found for this table");return}let l={totalAmount:a,currency:o};this.dialog.open(he,{width:"450px",data:l}).afterClosed().subscribe(f=>{if(f){let P=f.action==="confirm"&&f.paymentMethod?f.paymentMethod.name:"Cash";this.orderStore.completeOrder(r,P).then(N=>{this.tableStore.updateTable(e._id,{orderId:null,order:null}),this.tableStore.updateTableOrderSync(e._id,{orderId:null}),this.orderStore.deleteSelectedOrder(),this.tableStore.clearSelectedTable(),this.saleTypeStore.setDefaultSaleType()})}})}viewOrder(e){e.orderId?._id&&this.router.navigate(["/menu/pos/orders",e.orderId._id,"details"])}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=Q({type:t,selectors:[["app-tables"]],viewQuery:function(r,a){if(r&1&&B(Fe,5),r&2){let o;H(o=G())&&(a.searchComponent=o.first)}},decls:34,vars:8,consts:[["searchComponent",""],[1,"min-h-full"],[1,"p-4","border-b","border-outline-variant"],[1,"flex","items-center","gap-3"],[1,"flex-1"],["searchText","Search by table name...",3,"filterChange","rightTap","filter","showRightIcon"],[1,"hidden","md:flex","items-center","gap-2","shrink-0"],[1,"w-full","sm:w-auto",3,"change","value"],["value","all",1,"flex-1","sm:flex-initial"],[1,"hidden","sm:inline"],[1,"sm:hidden"],["value","free",1,"flex-1","sm:flex-initial"],["value","occupied",1,"flex-1","sm:flex-initial"],[1,"px-4","py-3","border-b","border-outline-variant","mb-4"],[1,"flex","items-center","gap-3","overflow-x-auto","scrollbar-hide"],["aria-label","Select a table category",1,"flex-nowrap"],[1,"cursor-pointer",3,"click","selected"],[1,"cursor-pointer",3,"selected"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","px-4","gap-4"],[3,"table"],[1,"text-center","py-12","text-gray-500"],[3,"addNewOrder","viewOrder","completeOrder","clearOrder","tableClick","table"],[1,"text-6xl","mb-4"]],template:function(r,a){if(r&1){let o=O();c(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"app-search",5,0),T("filterChange",function(_){return m(o),b(a.onSearchChange(_))})("rightTap",function(){return m(o),b(a.clearSearch())}),d()(),c(6,"div",6)(7,"mat-button-toggle-group",7),T("change",function(_){return m(o),b(a.onStatusFilterChange(_.value))}),c(8,"mat-button-toggle",8)(9,"span",9),u(10),d(),c(11,"span",10),u(12,"All"),d()(),c(13,"mat-button-toggle",11)(14,"span",9),u(15),d(),c(16,"span",10),u(17,"Free"),d()(),c(18,"mat-button-toggle",12)(19,"span",9),u(20),d(),c(21,"span",10),u(22,"Occ."),d()()()()()(),c(23,"div",13)(24,"div",14)(25,"mat-chip-listbox",15)(26,"mat-chip-option",16),T("click",function(){return m(o),b(a.clearCategoryFilter())}),u(27," All Categories "),d(),$(28,Pe,2,2,"mat-chip-option",17,we),d()()(),c(30,"div",18),$(31,Ve,1,1,"app-table-card",19,we),d(),A(33,ke,5,0,"div",20),d()}r&2&&(g(4),h("filter",a.searchFilter)("showRightIcon",!0),g(3),h("value",a.tableStore.statusFilter()),g(3),w("All (",a.tableStore.tablesCount(),")"),g(5),w("Free (",a.tableStore.freeTableCount(),")"),g(5),w("Occupied (",a.tableStore.occupiedTableCount(),")"),g(6),h("selected",!a.tableCategoryStore.selectedTableCategory()),g(2),D(a.tableCategoryStore.tableCategories()),g(3),D(a.tableStore.filteredTables()),g(2),j(a.tableStore.filteredTables().length===0?33:-1))},dependencies:[q,ie,de,Ce,ue,ge,W,oe,ae,ne,se,me,ce,pe,le,fe,_e],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto}.scrollbar-hide[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.scrollbar-hide[_ngcontent-%COMP%]{-ms-overflow-style:none;scrollbar-width:none}mat-chip-listbox[_ngcontent-%COMP%]     .mdc-evolution-chip-set__chips{flex-wrap:nowrap}"]})};export{xe as Tables};
