import{c as Ge,d as je}from"./chunk-GKESQVDG.js";import{a as Ue,b as Ye,c as qe}from"./chunk-42J4MRPK.js";import{a as Qe}from"./chunk-YDGM7OK2.js";import{b as ze,f as He}from"./chunk-LQE4FJGA.js";import{a as Ne,b as $e,c as Be}from"./chunk-OECSTR6G.js";import{a as Ae}from"./chunk-2MXILDTK.js";import{c as Te,d as Le,e as Ie,f as ke,g as Pe,h as Ve}from"./chunk-VZJV7FAI.js";import{a as Fe,b as Re}from"./chunk-SYBKQTIU.js";import"./chunk-H3VCUIUM.js";import"./chunk-FB5OTQCF.js";import{a as ve,b as Ce,c as he,d as xe,e as ye,f as Ee,g as Me,h as be,i as Oe,j as De,k as we}from"./chunk-OALZQOYE.js";import{a as G}from"./chunk-HY4LTOAV.js";import"./chunk-4G2PTLMY.js";import"./chunk-EIZRJIIE.js";import"./chunk-R4SEO7WU.js";import{a as te,b as ie,c as re,d as ne}from"./chunk-U2JZUY6D.js";import{i as J}from"./chunk-U4YSNMIZ.js";import{a as fe,b as ge}from"./chunk-3IQG3KHZ.js";import{d as Q}from"./chunk-YK4A772F.js";import"./chunk-HXICWX3M.js";import"./chunk-4YIJHWNC.js";import{d as Se}from"./chunk-EPNSEEH4.js";import"./chunk-MMNFDWV7.js";import"./chunk-CGDRKYIW.js";import{b as me,c as ce,d as pe}from"./chunk-IS37LNAK.js";import{a as oe,d as le,e as se,h as de}from"./chunk-QJ2P7YZL.js";import"./chunk-LXD47U2C.js";import{a as ue,b as _e}from"./chunk-ZG44B3L4.js";import{A as ae}from"./chunk-SZWYIW32.js";import"./chunk-CTT4BYCX.js";import{a as q}from"./chunk-T4ACDKLD.js";import"./chunk-5QCN73SK.js";import"./chunk-NQRUH5DO.js";import{a as X,c as Z,h as ee}from"./chunk-MESJBQC5.js";import"./chunk-QEF3JOQ3.js";import"./chunk-LSROOOYO.js";import"./chunk-7NDZPDVA.js";import{b as K,c as W}from"./chunk-OWLRGWNJ.js";import{$ as Y,Y as j,Z as U}from"./chunk-OS2CYUJN.js";import{g as z,l as H}from"./chunk-WFEXX4HI.js";import{m as $,p as B,r as A}from"./chunk-U2P6GFP5.js";import{$a as l,Dc as N,Gb as E,Hb as M,Jc as w,Kb as T,Lb as L,Lc as P,Mb as p,Nb as i,Nc as V,Ob as n,Pb as b,Tb as C,Tc as k,Ub as h,Wb as O,_b as u,ac as _,ea as x,ja as m,ka as c,kc as I,mc as R,ob as F,oc as D,pc as o,qc as f,rc as y,ub as v,va as S}from"./chunk-IQSYHSID.js";import"./chunk-EQDQRRRY.js";var We=()=>[10,25,50,100],Je=(r,e)=>e.value,Xe=(r,e)=>e._id;function Ze(r,e){if(r&1&&(i(0,"mat-option",18),o(1),n()),r&2){let t=e.$implicit;p("value",t.value),l(),f(t.label)}}function et(r,e){if(r&1&&(i(0,"mat-option",18),o(1),n()),r&2){let t=e.$implicit;p("value",t.value),l(),f(t.label)}}function tt(r,e){r&1&&(i(0,"div",24),b(1,"mat-spinner",28),n())}function it(r,e){if(r&1){let t=O();i(0,"app-no-record",25)(1,"button",29),u("click",function(){m(t);let s=_();return c(s.reloadData())}),o(2," Retry "),n()()}if(r&2){let t=_();p("message",t.ordersResource.error())}}function rt(r,e){r&1&&b(0,"app-no-record",26)}function nt(r,e){r&1&&(i(0,"th",45),o(1,"Order ID & Name"),n())}function at(r,e){if(r&1&&(i(0,"td",46)(1,"div",47)(2,"span",48),o(3),n(),i(4,"span",49),o(5),n()()()),r&2){let t=e.$implicit;l(3),y("#",t.reference),l(2),f((t.user==null?null:t.user.name)||(t.user==null?null:t.user.email)||"Guest")}}function ot(r,e){r&1&&(i(0,"th",45),o(1,"Total"),n())}function lt(r,e){if(r&1&&(i(0,"td",46)(1,"span",50),o(2),w(3,"currency"),n()()),r&2){let t=e.$implicit,a=_(2);l(2),f(V(3,1,t.total,a.currency(),"symbol","1.2-2"))}}function st(r,e){r&1&&(i(0,"th",45),o(1,"Status"),n())}function dt(r,e){if(r&1&&(i(0,"td",46)(1,"mat-chip"),o(2),n()()),r&2){let t=e.$implicit,a=_(2);l(),D(a.getStatusColor(t.category)),l(),y(" ",t.category," ")}}function mt(r,e){r&1&&(i(0,"th",45),o(1,"Payment Method"),n())}function ct(r,e){if(r&1&&(i(0,"td",46)(1,"span",51),o(2),n()()),r&2){let t=e.$implicit;l(2),f(t.payment||"N/A")}}function pt(r,e){r&1&&(i(0,"th",45),o(1,"Payment Status"),n())}function ut(r,e){if(r&1&&(i(0,"td",46)(1,"mat-chip",52),o(2),n()()),r&2){let t=e.$implicit,a=_(2);l(),D(a.getPaymentStatusColor(t.paymentStatus)),l(),y(" ",t.paymentStatus," ")}}function _t(r,e){r&1&&(i(0,"th",45),o(1,"Location"),n())}function ft(r,e){if(r&1&&(i(0,"td",46)(1,"span",51),o(2),n()()),r&2){let t=e.$implicit,a=_(2);l(2),f(a.getLocationInfo(t))}}function gt(r,e){r&1&&(i(0,"th",45),o(1,"Date"),n())}function St(r,e){if(r&1&&(i(0,"td",46)(1,"span",51),o(2),w(3,"date"),n()()),r&2){let t=e.$implicit;l(2),f(P(3,1,t.createdAt,"short"))}}function vt(r,e){r&1&&(i(0,"th",45),o(1,"Actions"),n())}function Ct(r,e){if(r&1){let t=O();i(0,"td",46)(1,"button",53)(2,"mat-icon"),o(3,"more_vert"),n()(),i(4,"mat-menu",null,1)(6,"button",54),u("click",function(){let s=m(t).$implicit,d=_(2);return c(d.viewOrder(s))}),i(7,"mat-icon"),o(8,"visibility"),n(),i(9,"span"),o(10,"View"),n()(),i(11,"button",54),u("click",function(){let s=m(t).$implicit,d=_(2);return c(d.printOrder(s))}),i(12,"mat-icon"),o(13,"print"),n(),i(14,"span"),o(15,"Print"),n()(),i(16,"button",54),u("click",function(){let s=m(t).$implicit,d=_(2);return c(d.editOrder(s))}),i(17,"mat-icon"),o(18,"edit"),n(),i(19,"span"),o(20,"Edit"),n()()()()}if(r&2){let t=I(5);l(),p("matMenuTriggerFor",t)}}function ht(r,e){r&1&&b(0,"tr",55)}function xt(r,e){r&1&&b(0,"tr",56)}function yt(r,e){if(r&1){let t=O();i(0,"div",30)(1,"table",31),C(2,32),v(3,nt,2,0,"th",33)(4,at,6,2,"td",34),h(),C(5,35),v(6,ot,2,0,"th",33)(7,lt,4,6,"td",34),h(),C(8,36),v(9,st,2,0,"th",33)(10,dt,3,3,"td",34),h(),C(11,37),v(12,mt,2,0,"th",33)(13,ct,3,1,"td",34),h(),C(14,38),v(15,pt,2,0,"th",33)(16,ut,3,3,"td",34),h(),C(17,39),v(18,_t,2,0,"th",33)(19,ft,3,1,"td",34),h(),C(20,40),v(21,gt,2,0,"th",33)(22,St,4,4,"td",34),h(),C(23,41),v(24,vt,2,0,"th",33)(25,Ct,21,1,"td",34),h(),v(26,ht,1,0,"tr",42)(27,xt,1,0,"tr",43),n()(),i(28,"mat-paginator",44),u("page",function(s){m(t);let d=_();return c(d.onPageChange(s))}),n()}if(r&2){let t=_();l(),p("dataSource",t.filteredOrders()),l(25),p("matHeaderRowDef",t.displayedColumns),l(),p("matRowDefColumns",t.displayedColumns),l(),p("length",t.totalOrders())("pageSize",t.pageSize())("pageIndex",t.pageIndex())("pageSizeOptions",N(7,We))}}function Et(r,e){if(r&1){let t=O();i(0,"mat-card",57)(1,"mat-card-content",58)(2,"div",59)(3,"div",60)(4,"h3",61),o(5),n(),i(6,"p",49),o(7),n()(),i(8,"button",53)(9,"mat-icon"),o(10,"more_vert"),n()(),i(11,"mat-menu",null,2)(13,"button",54),u("click",function(){let s=m(t).$implicit,d=_(2);return c(d.viewOrder(s))}),i(14,"mat-icon"),o(15,"visibility"),n(),i(16,"span"),o(17,"View"),n()(),i(18,"button",54),u("click",function(){let s=m(t).$implicit,d=_(2);return c(d.printOrder(s))}),i(19,"mat-icon"),o(20,"print"),n(),i(21,"span"),o(22,"Print"),n()(),i(23,"button",54),u("click",function(){let s=m(t).$implicit,d=_(2);return c(d.editOrder(s))}),i(24,"mat-icon"),o(25,"edit"),n(),i(26,"span"),o(27,"Edit"),n()()()(),i(28,"div",62)(29,"span",63),o(30),w(31,"currency"),n()(),i(32,"div",64)(33,"mat-chip",52),o(34),n(),i(35,"mat-chip",52),o(36),n()(),i(37,"div",65)(38,"div",66)(39,"mat-icon",67),o(40,"payment"),n(),i(41,"span"),o(42),n()(),i(43,"div",66)(44,"mat-icon",67),o(45,"location_on"),n(),i(46,"span"),o(47),n()(),i(48,"div",66)(49,"mat-icon",67),o(50,"schedule"),n(),i(51,"span"),o(52),w(53,"date"),n()()()()()}if(r&2){let t=e.$implicit,a=I(12),s=_(2);l(5),y("#",t.reference),l(2),f((t.user==null?null:t.user.name)||(t.user==null?null:t.user.email)||"Guest"),l(),p("matMenuTriggerFor",a),l(22),f(V(31,13,t.total,s.currency(),"symbol","1.2-2")),l(3),D(s.getStatusColor(t.category)),l(),y(" ",t.category," "),l(),D(s.getPaymentStatusColor(t.paymentStatus)),l(),y(" ",t.paymentStatus," "),l(6),f(t.payment||"N/A"),l(5),f(s.getLocationInfo(t)),l(5),f(P(53,18,t.createdAt,"short"))}}function Mt(r,e){if(r&1&&(i(0,"div",27),T(1,Et,54,21,"mat-card",57,Xe),n()),r&2){let t=_();l(),L(t.filteredOrders())}}var Ke=class r{ordersService=x(Ye);authService=x(q);storeStore=x(J);cartStore=x(Ge);cartService=x(je);orderStore=x(qe);router=x(z);saleTypeStore=x(Ue);searchQuery=S("");statusFilter=S("");paymentFilter=S("");staffFilter=S(this.authService.currentUserValue?._id||"");startDate=S(new Date(new Date().setHours(0,0,0,0)));endDate=S(new Date(new Date().setHours(23,59,59,999)));tempStartDate=null;tempEndDate=null;viewMode=S("table");pageSize=S(15);pageIndex=S(0);totalOrders=S(0);displayedColumns=["reference","total","status","payment","paymentStatus","location","date","actions"];filterParams=k(()=>{let e={storeId:this.storeStore.selectedStore()?._id,limit:this.pageSize(),skip:this.pageIndex()*this.pageSize(),salesChannel:"Point of Sale"};this.statusFilter()&&(e.status=this.statusFilter()),this.paymentFilter()&&(e.payment=this.paymentFilter()),this.staffFilter()&&(e.staff=this.staffFilter());let t=this.startDate(),a=this.endDate();return t&&a&&(e.startDate=t.toISOString(),e.endDate=a.toISOString()),e});ordersResource=Se({params:()=>this.filterParams(),stream:({params:e})=>{if(!e.storeId)throw new Error("Store not selected");return this.ordersService.getStoreOrders(e.storeId,e)}});filteredOrders=k(()=>{let e=this.ordersResource.value()||[],t=this.searchQuery().toLowerCase();return t?e.filter(a=>a.reference?.toLowerCase().includes(t)||a.user?.name?.toLowerCase().includes(t)||a.user?.email?.toLowerCase().includes(t)):e});currency=k(()=>this.storeStore.selectedStore()?.currency||"\u20A6");statusOptions=[{value:"",label:"All Statuses"},{value:"Processing",label:"Processing"},{value:"Ready",label:"Ready"},{value:"Complete",label:"Complete"},{value:"Cancel",label:"Cancelled"}];paymentOptions=[{value:"",label:"All Payments"},{value:"Cash",label:"Cash"},{value:"POS Terminal",label:"POS Terminal"},{value:"Pay Online",label:"Pay Online"}];reloadData(){this.ordersResource.reload()}startNewSale(){this.router.navigate(["/menu/pos/checkout"])}clearFilters(){this.searchQuery.set(""),this.statusFilter.set(""),this.paymentFilter.set(""),this.staffFilter.set(this.authService.currentUserValue?._id||""),this.startDate.set(null),this.endDate.set(null),this.pageIndex.set(0)}onPageChange(e){this.pageIndex.set(e.pageIndex),this.pageSize.set(e.pageSize)}onStartDateChange(e){this.tempStartDate=e}onEndDateChange(e){this.tempEndDate=e}onDateRangeClosed(){this.tempStartDate&&this.tempEndDate&&(this.startDate.set(this.tempStartDate),this.endDate.set(this.tempEndDate))}getStatusColor(e){return{Processing:"bg-blue-100 text-blue-800",Ready:"bg-purple-100 text-purple-800",Complete:"bg-green-100 text-green-800",Cancel:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800"}getPaymentStatusColor(e){return e==="Paid"?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}getLocationInfo(e){return e.table?`Table: ${e.table.name}`:e.shippingFee&&e.shippingFee>0?"Delivery":"Quick Sale"}viewOrder(e){this.router.navigate(["/menu/pos/orders",e._id,"details"])}printOrder(e){console.log("Print order:",e)}editOrder(e){if(console.log("Editing order:",e),!e.cart?._id){console.error("Invalid cart data");return}if(this.cartStore.carts().length>0){this.cartStore.selectCart(e.cart._id);let a=this.cartStore.selectedCart();if(a){console.log("Using cart from store:",a),this.orderStore.selectOrder(e),this.saleTypeStore.setSelectedSaleType(e.type,!0),this.saleTypeStore.startEditing(),this.router.navigate(["/menu/pos/checkout"]);return}}this.cartService.getCartByIdRestructured(e.cart._id).subscribe({next:a=>{let s=[...this.cartStore.carts(),a];this.cartStore.updateCarts(s),this.cartStore.setCart(a),this.orderStore.selectOrder(e),this.saleTypeStore.setSelectedSaleType(e.type,!0),this.saleTypeStore.startEditing(),this.router.navigate(["/menu/pos/checkout"])},error:a=>{this.saleTypeStore.stopEditing(),console.error("Error fetching cart:",a)}})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=F({type:r,selectors:[["app-list-orders"]],decls:56,vars:16,consts:[["dateRangePicker",""],["menu","matMenu"],["cardMenu","matMenu"],["title","Orders","subtitle","Manage and track all your orders"],["actions",""],[1,"hidden","md:flex",3,"change","value"],["value","table"],["value","grid"],["mat-stroked-button","",3,"click"],["matButton","outlined",3,"click","disabled"],["matButton","filled","color","primary",3,"click"],[1,"max-w-12xl","py-6","px-4"],["appearance","outlined",1,"py-4"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4","px-4","mb-4"],["appearance","outline"],["matInput","","placeholder","Order ID, customer name...",3,"input","value"],["matPrefix",""],[3,"selectionChange","value"],[3,"value"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"dateChange","value"],["matEndDate","","placeholder","End date",3,"dateChange","value"],["matIconSuffix","",3,"for"],[3,"closed"],[1,"flex","items-center","justify-center","py-12"],["icon","error_outline","title","Failed to Load Orders",3,"message"],["icon","receipt_long","title","No Orders Found","message","No orders match your current filters. Try adjusting your search criteria."],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4","px-4"],["diameter","50"],["mat-flat-button","","color","primary",3,"click"],[1,"overflow-x-auto","hidden","md:block"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","reference"],["mat-header-cell","","class","font-semibold",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","total"],["matColumnDef","status"],["matColumnDef","payment"],["matColumnDef","paymentStatus"],["matColumnDef","location"],["matColumnDef","date"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"page","length","pageSize","pageIndex","pageSizeOptions"],["mat-header-cell","",1,"font-semibold"],["mat-cell",""],[1,"flex","flex-col"],[1,"font-medium"],[1,"text-sm","text-gray-600"],[1,"font-semibold"],[1,"text-sm"],[1,"text-xs"],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""],["appearance","outlined",1,"cursor-pointer","hover:shadow-lg","transition-shadow"],[1,"p-4"],[1,"flex","items-start","justify-between","mb-3"],[1,"flex-1"],[1,"font-semibold","text-lg"],[1,"mb-3"],[1,"text-2xl","font-bold"],[1,"flex","gap-2","mb-3"],[1,"space-y-1","text-sm","text-gray-600"],[1,"flex","items-center","gap-2"],[1,"text-base"]],template:function(t,a){if(t&1){let s=O();i(0,"app-page-header",3),C(1,4),i(2,"mat-button-toggle-group",5),u("change",function(g){return m(s),c(a.viewMode.set(g.value))}),i(3,"mat-button-toggle",6)(4,"mat-icon"),o(5,"table_view"),n()(),i(6,"mat-button-toggle",7)(7,"mat-icon"),o(8,"grid_view"),n()()(),i(9,"button",8),u("click",function(){return m(s),c(a.clearFilters())}),i(10,"mat-icon"),o(11,"clear"),n(),o(12," Clear Filters "),n(),i(13,"button",9),u("click",function(){return m(s),c(a.reloadData())}),i(14,"mat-icon"),o(15,"refresh"),n(),o(16," Reload "),n(),i(17,"button",10),u("click",function(){return m(s),c(a.startNewSale())}),i(18,"mat-icon"),o(19,"add_shopping_cart"),n(),o(20," Start New Sale "),n(),h(),n(),i(21,"div",11)(22,"mat-card",12)(23,"div",13)(24,"mat-form-field",14)(25,"mat-label"),o(26,"Search"),n(),i(27,"input",15),u("input",function(g){return m(s),c(a.searchQuery.set(g.target.value))}),n(),i(28,"mat-icon",16),o(29,"search"),n()(),i(30,"mat-form-field",14)(31,"mat-label"),o(32,"Status"),n(),i(33,"mat-select",17),u("selectionChange",function(g){return m(s),c(a.statusFilter.set(g.value))}),T(34,Ze,2,2,"mat-option",18,Je),n()(),i(36,"mat-form-field",14)(37,"mat-label"),o(38,"Payment"),n(),i(39,"mat-select",17),u("selectionChange",function(g){return m(s),c(a.paymentFilter.set(g.value))}),T(40,et,2,2,"mat-option",18,Je),n()(),i(42,"mat-form-field",14)(43,"mat-label"),o(44,"Date Range"),n(),i(45,"mat-date-range-input",19)(46,"input",20),u("dateChange",function(g){return m(s),c(a.onStartDateChange(g.value))}),n(),i(47,"input",21),u("dateChange",function(g){return m(s),c(a.onEndDateChange(g.value))}),n()(),b(48,"mat-datepicker-toggle",22),i(49,"mat-date-range-picker",23,0),u("closed",function(){return m(s),c(a.onDateRangeClosed())}),n()()(),E(51,tt,2,0,"div",24),E(52,it,3,1,"app-no-record",25),E(53,rt,1,0,"app-no-record",26),E(54,yt,29,8),E(55,Mt,3,0,"div",27),n()()}if(t&2){let s=I(50);l(2),p("value",a.viewMode()),l(11),p("disabled",a.ordersResource.isLoading()),l(),R("animate-spin",a.ordersResource.isLoading()),l(13),p("value",a.searchQuery()),l(6),p("value",a.statusFilter()),l(),L(a.statusOptions),l(5),p("value",a.paymentFilter()),l(),L(a.paymentOptions),l(5),p("rangePicker",s),l(),p("value",a.startDate()),l(),p("value",a.endDate()),l(),p("for",s),l(3),M(a.ordersResource.isLoading()?51:-1),l(),M(a.ordersResource.error()&&!a.ordersResource.isLoading()?52:-1),l(),M(!a.ordersResource.isLoading()&&!a.ordersResource.error()&&a.filteredOrders().length===0?53:-1),l(),M(!a.ordersResource.isLoading()&&!a.ordersResource.error()&&a.filteredOrders().length>0&&a.viewMode()==="table"?54:-1),l(),M(!a.ordersResource.isLoading()&&!a.ordersResource.error()&&a.filteredOrders().length>0&&a.viewMode()==="grid"?55:-1)}},dependencies:[A,H,ae,we,ve,he,Me,xe,Ce,be,ye,Ee,Oe,De,ee,X,Z,Y,U,j,W,K,me,de,oe,le,se,pe,ce,ge,fe,Q,Ve,Te,Le,Ie,ke,Pe,G,He,ze,_e,ue,ne,ie,te,re,Re,Fe,Qe,Ae,Be,Ne,$e,B,$],styles:["[_nghost-%COMP%]{display:block}"]})};export{Ke as ListOrders};
