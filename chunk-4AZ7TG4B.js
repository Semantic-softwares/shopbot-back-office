import{a as Ii}from"./chunk-7FCHOJLW.js";import{a as Ci}from"./chunk-MKHSQPFU.js";import{a as wi,b as xi}from"./chunk-NYI7WYB6.js";import{a as gi,b as fi,d as bi,g as yi}from"./chunk-FBM4S444.js";import{a as vi,b as _i}from"./chunk-H5K5NEFK.js";import{c as ni,d as ci,j as ri,k as di,l as si,m as li}from"./chunk-5F6GZMB3.js";import{a as U}from"./chunk-6Q6X536B.js";import{b as G}from"./chunk-L3V4XNTA.js";import{f as ui}from"./chunk-ZHTE7B4O.js";import{b as $,d as l,g as Z,h as X,m as J,n as Y,o as ii,q as ti,r as ei,u as ai,w as oi,x as pi,y as hi}from"./chunk-OIGPKB3Q.js";import{E as k,M as j,N as Q,O as K,P as W,sa as mi}from"./chunk-E4MABTKS.js";import{i as N,n as H,o as q}from"./chunk-5RF4TXO5.js";import{Bb as f,Cb as b,Fb as B,Gb as P,Hb as s,Ib as a,Jb as t,Kb as p,Ob as V,Sb as h,Tb as u,Za as r,aa as D,ca as F,cb as _,ea as m,gc as o,hc as y,ic as I,jb as x,ka as A,kb as O,la as R,pb as g,ua as T,vc as L,xc as z}from"./chunk-EV5SF5GC.js";import{a as C,b as w}from"./chunk-EQDQRRRY.js";var Di=new F("mat-chips-default-options",{providedIn:"root",factory:()=>({separatorKeyCodes:[13]})});var ki=(()=>{class e{static \u0275fac=function(i){return new(i||e)};static \u0275mod=O({type:e});static \u0275inj=D({providers:[G,{provide:Di,useValue:{separatorKeyCodes:[13]}}],imports:[k,j,k]})}return e})();var Fi=(e,n)=>n._id;function Ai(e,n){e&1&&(a(0,"mat-error"),o(1," Name is required "),t())}function Ri(e,n){e&1&&(a(0,"mat-error"),o(1," At Least value is required "),t())}function Ti(e,n){e&1&&(a(0,"mat-error"),o(1," Value must be 0 or greater "),t())}function Oi(e,n){e&1&&(a(0,"mat-error"),o(1," At Most value is required "),t())}function Bi(e,n){e&1&&(a(0,"mat-error"),o(1," Value must be 0 or greater "),t())}function Pi(e,n){if(e&1){let c=V();a(0,"div",28)(1,"div")(2,"span",29),o(3),t(),a(4,"span",30),o(5),L(6,"currency"),t()(),a(7,"a",31),h("click",function(){let d=A(c).$implicit,v=u(2);return R(v.removeOption(d))}),a(8,"mat-icon"),o(9,"close"),t()()()}if(e&2){let c,i=n.$implicit,d=u(2);r(3),y(i.name),r(2),y(z(6,2,i.price,(c=d.storeStore.selectedStore())==null?null:c.currency))}}function Vi(e,n){if(e&1&&(a(0,"div",20)(1,"h4",27),o(2,"Added Options:"),t(),B(3,Pi,10,5,"div",28,Fi),t()),e&2){let c=u();r(3),P(c.selectedOptions)}}function Li(e,n){e&1&&p(0,"mat-spinner",26)}var Si=class e{constructor(n,c,i){this.fb=n;this.dialogRef=c;this.data=i;this.variantForm=this.fb.group({name:["",l.required],atLeast:[0,[l.required,l.min(0)]],atMost:[0,[l.required,l.min(0)]],enabled:[!0],store:[this.storeStore.selectedStore()?._id,l.required]}),this.newOptionForm=this.fb.group({name:["",l.required],price:[0,[l.required,l.min(0)]],inStock:[!0],store:[this.storeStore.selectedStore()?._id,l.required]}),i.isEdit&&i.variant&&(this.variantForm.patchValue(i.variant),i.variant._id&&this.productService.getGroupOptionItems(i.variant._id).subscribe({next:d=>{this.selectedOptions=d}}))}productService=m(Ci);storeStore=m(mi);snackBar=m(U);isSubmitting=T(!1);variantForm;existingOptions=ui({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:n})=>this.productService.getStoreOptions(n.storeId)});selectedOptions=[];newOptionForm;addNewOption(){if(this.newOptionForm.valid){let n=w(C({},this.newOptionForm.value),{store:this.storeStore.selectedStore()?._id,variant:this.data.variant?._id});this.productService.saveOption(n).subscribe({next:c=>{this.selectedOptions.push(c),this.newOptionForm.reset({name:"",price:0,store:this.storeStore.selectedStore()?._id,inStock:!0}),this.snackBar.open("Option added successfully","Close",{duration:3e3})},error:()=>{this.snackBar.open("Error adding option","Close",{duration:3e3})}})}}removeOption(n){let c=this.selectedOptions.findIndex(i=>i._id===n._id);c>-1&&(this.selectedOptions.splice(c,1),this.productService.deleteOptionItem(n._id).subscribe({next:()=>{this.snackBar.open("Option removed successfully","Close",{duration:3e3})},error:()=>{this.snackBar.open("Error removing option","Close",{duration:3e3})}}))}onSubmit(){if(this.variantForm.valid){this.isSubmitting.set(!0);let n=w(C({},this.variantForm.getRawValue()),{options:this.selectedOptions.map(i=>i._id)});(this.data.isEdit?this.productService.updateVariant(n,this.data.variant._id):this.productService.createVariant(n)).subscribe({next:()=>{this.snackBar.open(`Variant ${this.data.isEdit?"updated":"created"} successfully`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dialogRef.close(!0)},error:()=>{this.snackBar.open(`Error ${this.data.isEdit?"updating":"creating"} variant`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isSubmitting.set(!1)}})}}onCancel(){this.dialogRef.close()}static \u0275fac=function(c){return new(c||e)(_(ai),_(gi),_(fi))};static \u0275cmp=x({type:e,selectors:[["app-variant-dialog"]],decls:54,vars:13,consts:[[1,"p-6"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter variant name"],[4,"ngIf"],[1,"grid","grid-cols-2","gap-4"],["matInput","","type","number","formControlName","atLeast","min","0"],["matInput","","type","number","formControlName","atMost","min","0"],[1,"bg-gray-50","rounded-lg","space-y-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-lg","font-medium"],[1,"space-y-4",3,"formGroup"],["matInput","","formControlName","name","placeholder","e.g., Small, Medium, Large"],["matInput","","type","number","formControlName","price","min","0"],[1,"flex","items-center","justify-between"],["formControlName","inStock","color","primary"],["mat-stroked-button","","color","primary","type","button",3,"click","disabled"],[1,"mr-2"],[1,"mt-4","space-y-2"],[1,"flex","items-center","py-4","bg-gray-50","rounded-lg"],["formControlName","enabled","color","primary"],[1,"flex","justify-end","space-x-2","mt-6","pt-4","border-t","border-gray-200"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",1,"mr-2"],[1,"text-sm","font-medium","text-gray-700"],[1,"flex","items-center","justify-between","p-2","bg-white","rounded","border","border-gray-200"],[1,"font-medium"],[1,"ml-2","text-sm","text-gray-500"],["mat-icon-button","","color","warn",3,"click"]],template:function(c,i){if(c&1&&(a(0,"div",0)(1,"h2",1),o(2),t(),a(3,"form",2),h("ngSubmit",function(){return i.onSubmit()}),a(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),o(7,"Name"),t(),p(8,"input",5),g(9,Ai,2,0,"mat-error",6),t(),a(10,"div",7)(11,"mat-form-field",4)(12,"mat-label"),o(13,"At Least"),t(),p(14,"input",8),g(15,Ri,2,0,"mat-error",6)(16,Ti,2,0,"mat-error",6),t(),a(17,"mat-form-field",4)(18,"mat-label"),o(19,"At Most"),t(),p(20,"input",9),g(21,Oi,2,0,"mat-error",6)(22,Bi,2,0,"mat-error",6),t()(),a(23,"div",10)(24,"div",11)(25,"h3",12),o(26,"Options"),t()(),a(27,"form",13)(28,"div",7)(29,"mat-form-field",4)(30,"mat-label"),o(31,"Option Name"),t(),p(32,"input",14),t(),a(33,"mat-form-field",4)(34,"mat-label"),o(35,"Price"),t(),p(36,"input",15),t()(),a(37,"div",16)(38,"mat-slide-toggle",17),o(39," In Stock "),t(),a(40,"a",18),h("click",function(){return i.addNewOption()}),a(41,"mat-icon",19),o(42,"add"),t(),o(43," Add Option "),t()()(),f(44,Vi,5,0,"div",20),t(),a(45,"div",21)(46,"mat-slide-toggle",22),o(47," Published "),t()()(),a(48,"div",23)(49,"button",24),h("click",function(){return i.onCancel()}),o(50,"Cancel"),t(),a(51,"button",25),f(52,Li,1,0,"mat-spinner",26),o(53),t()()()()),c&2){let d,v,S,E,M;r(2),I(" ",i.data.isEdit?"Edit Variant":"Create New Variant"," "),r(),s("formGroup",i.variantForm),r(6),s("ngIf",(d=i.variantForm.get("name"))==null?null:d.hasError("required")),r(6),s("ngIf",(v=i.variantForm.get("atLeast"))==null?null:v.hasError("required")),r(),s("ngIf",(S=i.variantForm.get("atLeast"))==null?null:S.hasError("min")),r(5),s("ngIf",(E=i.variantForm.get("atMost"))==null?null:E.hasError("required")),r(),s("ngIf",(M=i.variantForm.get("atMost"))==null?null:M.hasError("min")),r(5),s("formGroup",i.newOptionForm),r(13),s("disabled",!i.newOptionForm.valid),r(4),b(i.selectedOptions.length>0?44:-1),r(7),s("disabled",!i.variantForm.valid||i.isSubmitting()),r(),b(i.isSubmitting()?52:-1),r(),I(" ",i.data.isEdit?"Update":"Create"," ")}},dependencies:[q,N,H,yi,bi,W,K,Q,di,ri,ni,ci,li,si,hi,pi,oi,J,$,Y,Z,X,ei,ii,ti,xi,wi,_i,vi,ki,Ii],encapsulation:2})};export{Si as a};
