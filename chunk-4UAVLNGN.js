import{b as _e}from"./chunk-WN4JDJ5Y.js";import{a as fe}from"./chunk-364PT26L.js";import{a as ge,b as ve}from"./chunk-4FCLVNHT.js";import{a as re,b as ae}from"./chunk-W6FIBOPD.js";import{b as ee,c as te,d as ie}from"./chunk-7JNU3RG5.js";import{a as j}from"./chunk-GGWIF4RR.js";import{c as ue}from"./chunk-PFBPZS4P.js";import{a as de,b as se,e as pe,h as ce}from"./chunk-GS72R6E5.js";import{a as le}from"./chunk-PQXLVIGM.js";import{e as me}from"./chunk-TRTRKQKZ.js";import{a as X,b as Y,h as Z}from"./chunk-3SKQMCZR.js";import{C as Q,E as W,b as L,d,g as R,h as $,m as z,n as U,s as H,t as J,y as K}from"./chunk-EQD33MW2.js";import{b as ne,c as oe}from"./chunk-2HLT5ZQQ.js";import{X as A,Y as G,_ as P}from"./chunk-UUZHPQZB.js";import{r as q,t as B}from"./chunk-HUSU2JWO.js";import{Eb as s,Fb as p,Hc as N,Ib as I,Jb as k,Jc as T,Kb as u,Lb as i,Mb as t,Nb as c,Ub as w,Yb as f,Za as l,_b as b,ca as v,gb as _,ha as O,ia as F,mb as D,nc as o,oc as h,pc as x,ta as V}from"./chunk-HCNG3XRF.js";import{a as S,b as C}from"./chunk-EQDQRRRY.js";var Se=(r,n)=>n._id;function Ce(r,n){r&1&&(i(0,"mat-error"),o(1," Name is required "),t())}function he(r,n){r&1&&(i(0,"mat-error"),o(1," At Least value is required "),t())}function xe(r,n){r&1&&(i(0,"mat-error"),o(1," Value must be 0 or greater "),t())}function Ee(r,n){r&1&&(i(0,"mat-error"),o(1," At Most value is required "),t())}function Me(r,n){r&1&&(i(0,"mat-error"),o(1," Value must be 0 or greater "),t())}function ye(r,n){if(r&1){let a=w();i(0,"div",27)(1,"div")(2,"span",28),o(3),t(),i(4,"span",29),o(5),N(6,"currency"),t()(),i(7,"a",30),f("click",function(){let m=O(a).$implicit,g=b(2);return F(g.removeOption(m))}),i(8,"mat-icon"),o(9,"close"),t()()()}if(r&2){let a,e=n.$implicit,m=b(2);l(3),h(e.name),l(2),h(T(6,2,e.price,(a=m.storeStore.selectedStore())==null?null:a.currency))}}function Oe(r,n){if(r&1&&(i(0,"div",19)(1,"h4",26),o(2,"Added Options:"),t(),I(3,ye,10,5,"div",27,Se),t()),r&2){let a=b();l(3),k(a.selectedOptions)}}function Fe(r,n){r&1&&c(0,"mat-spinner",25)}var be=class r{constructor(n,a,e){this.fb=n;this.dialogRef=a;this.data=e;this.variantForm=this.fb.group({name:["",d.required],atLeast:[0,[d.required,d.min(0)]],atMost:[0,[d.required,d.min(0)]],enabled:[!0],store:[this.storeStore.selectedStore()?._id,d.required]}),this.newOptionForm=this.fb.group({name:["",d.required],price:[0,[d.required,d.min(0)]],inStock:[!0],store:[this.storeStore.selectedStore()?._id,d.required]}),e.isEdit&&e.variant&&(this.variantForm.patchValue(e.variant),e.variant._id&&this.productService.getGroupOptionItems(e.variant._id).subscribe({next:m=>{this.selectedOptions=m}}))}productService=v(fe);storeStore=v(le);snackBar=v(j);isSubmitting=V(!1);variantForm;existingOptions=me({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:n})=>this.productService.getStoreOptions(n.storeId)});selectedOptions=[];newOptionForm;addNewOption(){if(this.newOptionForm.valid){let n=C(S({},this.newOptionForm.value),{store:this.storeStore.selectedStore()?._id,variant:this.data.variant?._id});this.productService.saveOption(n).subscribe({next:a=>{this.selectedOptions.push(a),this.newOptionForm.reset({name:"",price:0,store:this.storeStore.selectedStore()?._id,inStock:!0}),this.snackBar.open("Option added successfully","Close",{duration:3e3})},error:()=>{this.snackBar.open("Error adding option","Close",{duration:3e3})}})}}removeOption(n){let a=this.selectedOptions.findIndex(e=>e._id===n._id);a>-1&&(this.selectedOptions.splice(a,1),this.productService.deleteOptionItem(n._id).subscribe({next:()=>{this.snackBar.open("Option removed successfully","Close",{duration:3e3})},error:()=>{this.snackBar.open("Error removing option","Close",{duration:3e3})}}))}onSubmit(){if(this.variantForm.valid){this.isSubmitting.set(!0);let n=C(S({},this.variantForm.getRawValue()),{options:this.selectedOptions.map(e=>e._id)});(this.data.isEdit?this.productService.updateVariant(n,this.data.variant._id):this.productService.createVariant(n)).subscribe({next:()=>{this.snackBar.open(`Variant ${this.data.isEdit?"updated":"created"} successfully`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dialogRef.close(!0)},error:()=>{this.snackBar.open(`Error ${this.data.isEdit?"updating":"creating"} variant`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isSubmitting.set(!1)}})}}onCancel(){this.dialogRef.close()}static \u0275fac=function(a){return new(a||r)(_(Q),_(de),_(se))};static \u0275cmp=D({type:r,selectors:[["app-variant-dialog"]],decls:54,vars:13,consts:[[1,"p-6"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter variant name"],[1,"grid","grid-cols-2","gap-4"],["matInput","","type","number","formControlName","atLeast","min","0"],["matInput","","type","number","formControlName","atMost","min","0"],[1,"bg-gray-50","rounded-lg","space-y-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-lg","font-medium"],[1,"space-y-4",3,"formGroup"],["matInput","","formControlName","name","placeholder","e.g., Small, Medium, Large"],["matInput","","type","number","formControlName","price","min","0"],[1,"flex","items-center","justify-between"],["formControlName","inStock","color","primary"],["mat-stroked-button","","color","primary","type","button",3,"click","disabled"],[1,"mr-2"],[1,"mt-4","space-y-2"],[1,"flex","items-center","py-4","bg-gray-50","rounded-lg"],["formControlName","enabled","color","primary"],[1,"flex","justify-end","space-x-2","mt-6","pt-4","border-t","border-gray-200"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",1,"mr-2"],[1,"text-sm","font-medium","text-gray-700"],[1,"flex","items-center","justify-between","p-2","bg-white","rounded","border","border-gray-200"],[1,"font-medium"],[1,"ml-2","text-sm","text-gray-500"],["mat-icon-button","","color","warn",3,"click"]],template:function(a,e){if(a&1&&(i(0,"div",0)(1,"h2",1),o(2),t(),i(3,"form",2),f("ngSubmit",function(){return e.onSubmit()}),i(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),o(7,"Name"),t(),c(8,"input",5),s(9,Ce,2,0,"mat-error"),t(),i(10,"div",6)(11,"mat-form-field",4)(12,"mat-label"),o(13,"At Least"),t(),c(14,"input",7),s(15,he,2,0,"mat-error"),s(16,xe,2,0,"mat-error"),t(),i(17,"mat-form-field",4)(18,"mat-label"),o(19,"At Most"),t(),c(20,"input",8),s(21,Ee,2,0,"mat-error"),s(22,Me,2,0,"mat-error"),t()(),i(23,"div",9)(24,"div",10)(25,"h3",11),o(26,"Options"),t()(),i(27,"form",12)(28,"div",6)(29,"mat-form-field",4)(30,"mat-label"),o(31,"Option Name"),t(),c(32,"input",13),t(),i(33,"mat-form-field",4)(34,"mat-label"),o(35,"Price"),t(),c(36,"input",14),t()(),i(37,"div",15)(38,"mat-slide-toggle",16),o(39," In Stock "),t(),i(40,"a",17),f("click",function(){return e.addNewOption()}),i(41,"mat-icon",18),o(42,"add"),t(),o(43," Add Option "),t()()(),s(44,Oe,5,0,"div",19),t(),i(45,"div",20)(46,"mat-slide-toggle",21),o(47," Published "),t()()(),i(48,"div",22)(49,"button",23),f("click",function(){return e.onCancel()}),o(50,"Cancel"),t(),i(51,"button",24),s(52,Fe,1,0,"mat-spinner",25),o(53),t()()()()),a&2){let m,g,E,M,y;l(2),x(" ",e.data.isEdit?"Edit Variant":"Create New Variant"," "),l(),u("formGroup",e.variantForm),l(6),p((m=e.variantForm.get("name"))!=null&&m.hasError("required")?9:-1),l(6),p((g=e.variantForm.get("atLeast"))!=null&&g.hasError("required")?15:-1),l(),p((E=e.variantForm.get("atLeast"))!=null&&E.hasError("min")?16:-1),l(5),p((M=e.variantForm.get("atMost"))!=null&&M.hasError("required")?21:-1),l(),p((y=e.variantForm.get("atMost"))!=null&&y.hasError("min")?22:-1),l(5),u("formGroup",e.newOptionForm),l(13),u("disabled",!e.newOptionForm.valid),l(4),p(e.selectedOptions.length>0?44:-1),l(7),u("disabled",!e.variantForm.valid||e.isSubmitting()),l(),p(e.isSubmitting()?52:-1),l(),x(" ",e.data.isEdit?"Update":"Create"," ")}},dependencies:[B,ce,pe,P,G,A,ee,Z,X,Y,ie,te,oe,ne,W,z,L,U,R,$,K,J,H,ve,ge,ae,re,ue,_e,q],encapsulation:2})};export{be as a};
