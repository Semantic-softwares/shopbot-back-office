import{a as me,b as se,d as de,e as fe,f as ue,g as pe,h as ce}from"./chunk-XNNKKASY.js";import{a as re}from"./chunk-Y4YMG23Q.js";import{a as ne,b as oe}from"./chunk-WZDQ5XTC.js";import{d as P}from"./chunk-R6JGHN2R.js";import{d as le}from"./chunk-BXJEGH2V.js";import{b as Z,c as ee,d as te}from"./chunk-UMV4DCPT.js";import{a as Q,b as W,e as X,h as Y}from"./chunk-G3VZM262.js";import{a as ie,b as ae}from"./chunk-6I3AJKA7.js";import{B as K,b as V,d as p,g as j,h as U,m as $,s as z,t as H,z as J}from"./chunk-W7NMJLMQ.js";import{a as B,b as A}from"./chunk-4UBDYPTG.js";import{a as G}from"./chunk-UVV7QZRX.js";import{b as O,c as L}from"./chunk-JPRPNQOM.js";import{Z as T,_ as R,ba as q}from"./chunk-3LDCGXHW.js";import{Ib as s,Jb as d,Mb as w,Nb as I,Ob as g,Pb as a,Qb as e,Rb as h,Yb as k,ac as E,bb as m,cc as C,fa as c,ka as F,la as y,qb as N,rc as o,sc as b,tc as M,wa as v}from"./chunk-J2AK4FW5.js";import{a as x,b as D}from"./chunk-GAL4ENT6.js";var he=(i,r)=>r._id;function _e(i,r){i&1&&(a(0,"mat-error"),o(1,"Name is required"),e())}function Se(i,r){i&1&&(a(0,"mat-error"),o(1,"Email is required"),e())}function ve(i,r){i&1&&(a(0,"mat-error"),o(1,"Please enter a valid email"),e())}function Ce(i,r){i&1&&(a(0,"mat-error"),o(1,"Phone number is required"),e())}function Ee(i,r){i&1&&(a(0,"mat-error"),o(1,"Password is required"),e())}function be(i,r){i&1&&(a(0,"mat-error"),o(1,"Password must be at least 6 characters"),e())}function Me(i,r){if(i&1){let t=k();a(0,"mat-form-field",3)(1,"mat-label"),o(2,"Password"),e(),h(3,"input",18),a(4,"button",19),E("click",function(){F(t);let l=C();return y(l.hidePassword.set(!l.hidePassword()))}),a(5,"mat-icon"),o(6),e()(),s(7,Ee,2,0,"mat-error"),s(8,be,2,0,"mat-error"),e()}if(i&2){let t,n,l=C();m(3),g("type",l.hidePassword()?"password":"text"),m(3),b(l.hidePassword()?"visibility_off":"visibility"),m(),d((t=l.staffForm.get("password"))!=null&&t.hasError("required")&&((t=l.staffForm.get("password"))!=null&&t.touched)?7:-1),m(),d((n=l.staffForm.get("password"))!=null&&n.hasError("minlength")&&((n=l.staffForm.get("password"))!=null&&n.touched)?8:-1)}}function xe(i,r){i&1&&(a(0,"mat-option",13),o(1,"Loading roles..."),e())}function De(i,r){if(i&1&&(a(0,"mat-option",20)(1,"div",21)(2,"span"),o(3),e()()()),i&2){let t=r.$implicit;g("value",t._id),m(3),b(t.name)}}function Fe(i,r){if(i&1&&w(0,De,4,2,"mat-option",20,he),i&2){let t=C();I(t.rolesResource.value())}}function ye(i,r){i&1&&(a(0,"mat-error"),o(1,"Role is required"),e())}function Ne(i,r){i&1&&h(0,"mat-spinner",17)}var ge=class i{fb=c(J);rolesService=c(G);userService=c(re);dialogRef=c(me);snackBar=c(B);data=c(se);staffForm;saving=v(!1);hidePassword=v(!0);rolesResource=le({params:()=>({storeId:this.data.storeId}),stream:({params:r})=>this.rolesService.getAllRolesForStore(r.storeId)});isEditMode=v(!1);ngOnInit(){this.isEditMode.set(!!this.data.staff);let r=this.data.staff?.role?typeof this.data.staff.role=="string"?this.data.staff.role:this.data.staff.role._id:"";this.staffForm=this.fb.group({name:[this.data.staff?.name||"",p.required],email:[this.data.staff?.email||"",[p.required,p.email]],phoneNumber:[this.data.staff?.phoneNumber||"",p.required],gender:[this.data.staff?.gender||""],password:["",this.isEditMode()?[]:[p.required,p.minLength(6)]],role:[r,p.required]}),this.isEditMode()&&this.staffForm.removeControl("password")}getRoleIcon(r){let t=r.name.toLowerCase();return t.includes("admin")||t.includes("owner")?"admin_panel_settings":t.includes("manager")?"manage_accounts":t.includes("front desk")||t.includes("receptionist")?"support_agent":t.includes("housekeeper")||t.includes("housekeeping")?"cleaning_services":t.includes("accountant")||t.includes("finance")?"account_balance":"person"}saveStaff(){if(this.staffForm.invalid)return;this.saving.set(!0);let r=D(x({},this.staffForm.value),{stores:[this.data.storeId],pin:this.generatePin()});if(this.isEditMode())this.userService.updateMerchant(this.data.staff._id,r).subscribe({next:t=>{this.saving.set(!1),this.snackBar.open("Staff member updated successfully!","Close",{duration:3e3}),this.dialogRef.close(t)},error:t=>{this.saving.set(!1),this.snackBar.open(t.error?.message||"Failed to update staff member","Close",{duration:5e3})}});else{let t=this.staffForm.value.email,n=this.staffForm.value.phoneNumber;this.userService.validateEmailAndPhoneNumber({email:t,phoneNumber:n}).subscribe({next:l=>{let f=[];if(l.email||f.push("Email is already registered"),l.phoneNumber||f.push("Phone number is already registered"),f.length>0){this.saving.set(!1),this.snackBar.open(f.join(". "),"Close",{duration:5e3});return}this.userService.createMerchant(r).subscribe({next:u=>{this.saving.set(!1),this.snackBar.open("Staff member created successfully!","Close",{duration:3e3}),this.dialogRef.close(u)},error:u=>{this.saving.set(!1),this.snackBar.open(u.error?.message||"Failed to create staff member","Close",{duration:5e3})}})},error:l=>{this.saving.set(!1),this.snackBar.open("Error validating information. Please try again.","Close",{duration:5e3})}})}}generatePin(){return Math.floor(1e3+Math.random()*9e3).toString()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=N({type:i,selectors:[["app-staff-dialog"]],decls:54,vars:13,consts:[["mat-dialog-title","",1,"!m-0","!p-6","!pb-4"],[1,"!px-6","!py-0"],[1,"flex","flex-col","gap-4",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter full name"],["matSuffix",""],["matInput","","formControlName","email","type","email","placeholder","Enter email address"],["matInput","","formControlName","phoneNumber","placeholder","Enter phone number"],["formControlName","gender"],["value","male"],["value","female"],["value","other"],["formControlName","role"],["disabled",""],["align","end",1,"!px-6","!py-4"],["mat-button","","mat-dialog-close","",3,"disabled"],["mat-flat-button","","color","primary",3,"click","disabled"],["diameter","20",1,"inline-block","mr-2"],["matInput","","formControlName","password","placeholder","Enter password",3,"type"],["mat-icon-button","","matSuffix","","type","button",3,"click"],[3,"value"],[1,"flex","items-center","gap-2"]],template:function(t,n){if(t&1&&(a(0,"h2",0),o(1),e(),a(2,"mat-dialog-content",1)(3,"form",2)(4,"mat-form-field",3)(5,"mat-label"),o(6,"Full Name"),e(),h(7,"input",4),a(8,"mat-icon",5),o(9,"person"),e(),s(10,_e,2,0,"mat-error"),e(),a(11,"mat-form-field",3)(12,"mat-label"),o(13,"Email Address"),e(),h(14,"input",6),a(15,"mat-icon",5),o(16,"email"),e(),s(17,Se,2,0,"mat-error"),s(18,ve,2,0,"mat-error"),e(),a(19,"mat-form-field",3)(20,"mat-label"),o(21,"Phone Number"),e(),h(22,"input",7),a(23,"mat-icon",5),o(24,"phone"),e(),s(25,Ce,2,0,"mat-error"),e(),a(26,"mat-form-field",3)(27,"mat-label"),o(28,"Gender"),e(),a(29,"mat-select",8)(30,"mat-option",9),o(31,"Male"),e(),a(32,"mat-option",10),o(33,"Female"),e(),a(34,"mat-option",11),o(35,"Other"),e()(),a(36,"mat-icon",5),o(37,"wc"),e()(),s(38,Me,9,4,"mat-form-field",3),a(39,"mat-form-field",3)(40,"mat-label"),o(41,"Role"),e(),a(42,"mat-select",12),s(43,xe,2,0,"mat-option",13)(44,Fe,2,0),e(),a(45,"mat-icon",5),o(46,"admin_panel_settings"),e(),s(47,ye,2,0,"mat-error"),e()()(),a(48,"mat-dialog-actions",14)(49,"button",15),o(50,"Cancel"),e(),a(51,"button",16),E("click",function(){return n.saveStaff()}),s(52,Ne,1,0,"mat-spinner",17),o(53),e()()),t&2){let l,f,u,_,S;m(),M(" ",n.isEditMode()?"Edit Staff Member":"Add Staff Member"," "),m(2),g("formGroup",n.staffForm),m(7),d((l=n.staffForm.get("name"))!=null&&l.hasError("required")&&((l=n.staffForm.get("name"))!=null&&l.touched)?10:-1),m(7),d((f=n.staffForm.get("email"))!=null&&f.hasError("required")&&((f=n.staffForm.get("email"))!=null&&f.touched)?17:-1),m(),d((u=n.staffForm.get("email"))!=null&&u.hasError("email")&&((u=n.staffForm.get("email"))!=null&&u.touched)?18:-1),m(7),d((_=n.staffForm.get("phoneNumber"))!=null&&_.hasError("required")&&((_=n.staffForm.get("phoneNumber"))!=null&&_.touched)?25:-1),m(13),d(n.isEditMode()?-1:38),m(5),d(n.rolesResource.isLoading()?43:44),m(4),d((S=n.staffForm.get("role"))!=null&&S.hasError("required")&&((S=n.staffForm.get("role"))!=null&&S.touched)?47:-1),m(2),g("disabled",n.saving()),m(2),g("disabled",n.staffForm.invalid||n.saving()),m(),d(n.saving()?52:-1),m(),M(" ",n.isEditMode()?"Update":"Create"," ")}},dependencies:[K,$,V,j,U,H,z,ce,de,fe,pe,ue,q,R,T,Z,Y,Q,W,X,te,ee,L,O,oe,ne,P,ae,ie,A],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})};export{ge as a};
