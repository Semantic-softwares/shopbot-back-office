import{a as At,b as L}from"./chunk-53RZMW6N.js";import{a as x,b as Pt,c as Rt}from"./chunk-7FQZXLFT.js";import{a as kt}from"./chunk-37MPZNQ6.js";import{c as Dt,h as It}from"./chunk-XNNKKASY.js";import{a as Lt}from"./chunk-5HSGNHP2.js";import{a as g,b as bt}from"./chunk-LCP7K4QH.js";import"./chunk-JZKRHT5H.js";import"./chunk-O4OM35BU.js";import{a as _t,b as ft,c as ht,d as St,e as gt,f as xt,g as Mt,h as wt,i as Et,j as yt,k as Tt,l as vt}from"./chunk-2UZI5XAB.js";import{a as Y,b as Z,c as tt,d as et}from"./chunk-Q4U6FYZ3.js";import{i as W}from"./chunk-QC7H4KPM.js";import"./chunk-WZDQ5XTC.js";import"./chunk-R6JGHN2R.js";import{d as Ct}from"./chunk-BXJEGH2V.js";import"./chunk-64WHNS37.js";import"./chunk-TIVXUJ22.js";import"./chunk-WAHSRZAW.js";import"./chunk-XLZTIYSF.js";import{b as st,c as dt,d as pt}from"./chunk-UMV4DCPT.js";import{a as rt,d as mt,h as lt}from"./chunk-G3VZM262.js";import"./chunk-BCE7WRWQ.js";import{a as ut,b as ct}from"./chunk-6I3AJKA7.js";import{A as at,b as it,g as nt,l as ot}from"./chunk-W7NMJLMQ.js";import"./chunk-F5SZ3AU3.js";import{a as j,b as U}from"./chunk-4UBDYPTG.js";import"./chunk-TILT22SG.js";import"./chunk-BFT2MTJY.js";import{a as J,c as K,h as X}from"./chunk-3E3PJ7Q7.js";import"./chunk-FO4KTVQ3.js";import"./chunk-TRZH7NMW.js";import"./chunk-GXTELBJV.js";import{b as q,c as G}from"./chunk-JPRPNQOM.js";import{Z as O,_ as Q,ba as z}from"./chunk-3LDCGXHW.js";import{q as V,s as $}from"./chunk-6PFJHDFS.js";import{Fc as H,Ib as P,Jb as R,Lc as v,Nc as b,Ob as _,Pb as n,Qb as o,Rb as C,Vb as d,Wb as p,Y as D,Yb as k,ac as S,bb as m,cc as f,fa as h,gc as E,hc as y,ic as T,ka as M,la as w,mc as A,qb as I,rc as a,sc as c,wb as s,wc as B,xc as F,yc as N}from"./chunk-J2AK4FW5.js";import"./chunk-GAL4ENT6.js";var Ft=()=>[5,10,25,100];function Nt(t,e){t&1&&(n(0,"div",10),C(1,"mat-spinner",14),o())}function Ht(t,e){t&1&&C(0,"app-no-record",11)}function Vt(t,e){t&1&&C(0,"app-no-record",12)}function $t(t,e){t&1&&(n(0,"th",31),a(1,"Name"),o())}function Ot(t,e){if(t&1&&(n(0,"td",32),a(1),o()),t&2){let i=e.$implicit;m(),c(i.name)}}function Qt(t,e){t&1&&(n(0,"th",31),a(1,"Gender"),o())}function zt(t,e){if(t&1&&(n(0,"td",32),a(1),o()),t&2){let i=e.$implicit;m(),c(i.gender)}}function jt(t,e){t&1&&(n(0,"th",31),a(1,"Email"),o())}function Ut(t,e){if(t&1&&(n(0,"td",32),a(1),o()),t&2){let i=e.$implicit;m(),c(i.email)}}function Wt(t,e){t&1&&(n(0,"th",31),a(1,"Phone"),o())}function qt(t,e){if(t&1&&(n(0,"td",32),a(1),o()),t&2){let i=e.$implicit;m(),c(i.phoneNumber)}}function Gt(t,e){t&1&&(n(0,"th",31),a(1,"Country"),o())}function Jt(t,e){if(t&1&&(n(0,"td",32),a(1),o()),t&2){let i=e.$implicit;m(),c(i.country)}}function Kt(t,e){t&1&&(n(0,"th",31),a(1,"Total Amount Spent"),o())}function Xt(t,e){if(t&1&&(n(0,"td",32),a(1),v(2,"currency"),o()),t&2){let i,r=e.$implicit,l=f(2);m(),c(b(2,1,r.totalAmountSpent||0,(i=l.storeStore.selectedStore())==null?null:i.currency))}}function Yt(t,e){t&1&&(n(0,"th",31),a(1,"Avg Amount Spent"),o())}function Zt(t,e){if(t&1&&(n(0,"td",32),a(1),v(2,"currency"),o()),t&2){let i,r=e.$implicit,l=f(2);m(),c(b(2,1,r.avgAmountSpent||0,(i=l.storeStore.selectedStore())==null?null:i.currency))}}function te(t,e){t&1&&(n(0,"th",31),a(1,"Total Orders"),o())}function ee(t,e){if(t&1&&(n(0,"td",32),a(1),o()),t&2){let i=e.$implicit;m(),c(i.totalOrders||0)}}function ie(t,e){t&1&&(n(0,"th",33),a(1,"Actions"),o())}function ne(t,e){if(t&1){let i=k();n(0,"td",32)(1,"button",34)(2,"mat-icon"),a(3,"more_vert"),o()(),n(4,"mat-menu",null,0)(6,"button",35),S("click",function(){let l=M(i).$implicit,u=f(2);return w(u.editCustomer(l))}),n(7,"mat-icon"),a(8,"edit"),o(),n(9,"span"),a(10,"Edit"),o()(),n(11,"button",35),S("click",function(){let l=M(i).$implicit,u=f(2);return w(u.deleteCustomer(l))}),n(12,"mat-icon"),a(13,"delete"),o(),n(14,"span"),a(15,"Delete"),o()()()()}if(t&2){let i=A(5);m(),_("matMenuTriggerFor",i)}}function oe(t,e){t&1&&C(0,"tr",36)}function ae(t,e){t&1&&C(0,"tr",37)}function re(t,e){if(t&1&&(n(0,"div",13)(1,"table",15),d(2,16),s(3,$t,2,0,"th",17)(4,Ot,2,1,"td",18),p(),d(5,19),s(6,Qt,2,0,"th",17)(7,zt,2,1,"td",18),p(),d(8,20),s(9,jt,2,0,"th",17)(10,Ut,2,1,"td",18),p(),d(11,21),s(12,Wt,2,0,"th",17)(13,qt,2,1,"td",18),p(),d(14,22),s(15,Gt,2,0,"th",17)(16,Jt,2,1,"td",18),p(),d(17,23),s(18,Kt,2,0,"th",17)(19,Xt,3,4,"td",18),p(),d(20,24),s(21,Yt,2,0,"th",17)(22,Zt,3,4,"td",18),p(),d(23,25),s(24,te,2,0,"th",17)(25,ee,2,1,"td",18),p(),d(26,26),s(27,ie,2,0,"th",27)(28,ne,16,1,"td",18),p(),s(29,oe,1,0,"tr",28)(30,ae,1,0,"tr",29),o(),C(31,"mat-paginator",30),o()),t&2){let i=f();m(),_("dataSource",i.dataSource),m(28),_("matHeaderRowDef",i.displayedColumns),m(),_("matRowDefColumns",i.displayedColumns),m(),_("pageSizeOptions",H(4,Ft))}}var Bt=class t{dialog=h(Dt);snackBar=h(j);customerService=h(At);storeStore=h(W);displayedColumns=["name","email","phoneNumber","totalAmountSpent","totalOrders","avgAmountSpent","country","actions"];dataSource;searchText="";paginator;sort;customers=Ct({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.customerService.getStoreCustomers(e.storeId).pipe(D(i=>{this.dataSource=new vt(i),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}))});applyFilter(e){let i=e.target.value;this.dataSource.filter=i.trim().toLowerCase()}openDialog(){this.dialog.open(L,{width:"800px",data:{isEdit:!1}}).afterClosed().subscribe(i=>{i&&this.customers.reload()})}editCustomer(e){this.dialog.open(L,{width:"800px",data:{isEdit:!0,customer:e}}).afterClosed().subscribe(r=>{r&&this.customers.reload()})}deleteCustomer(e){if(e.role?.name==="Owner"){this.snackBar.open("Cannot delete an owner","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"});return}this.dialog.open(kt,{width:"350px",data:{message:`Are you sure you want to delete ${e.name}?`}}).afterClosed().subscribe(r=>{r&&this.customerService.deleteCustomer(e._id).subscribe({next:()=>{this.snackBar.open("Customer deleted successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.customers.reload()},error:()=>{this.snackBar.open("Error deleting customer","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})})}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=I({type:t,selectors:[["app-list-customers"]],viewQuery:function(i,r){if(i&1&&(E(g,5),E(x,5)),i&2){let l;y(l=T())&&(r.paginator=l.first),y(l=T())&&(r.sort=l.first)}},decls:19,vars:2,consts:[["menu","matMenu"],[1,"Customers-container","!bg-white"],[1,"!bg-white"],[1,"flex","flex-col","md:flex-row","justify-between","gap-4","p-4"],[1,"flex","flex-col","sm:flex-row","gap-4","flex-grow"],["appearance","outline",1,"w-full","sm:w-48","md:w-72","lg:w-96"],["matPrefix",""],["matInput","","placeholder","Search Customers",3,"keyup","ngModelChange","ngModel"],[1,"flex","gap-3","justify-end"],["mat-raised-button","","color","primary",3,"click"],[1,"flex","items-center","justify-center","min-h-[300px]"],["icon","people","title","No Customers","message","No Customers found matching your criteria."],["icon","error","title","Error","message","An error occurred while fetching Customers. Please try again later."],[1,"table-container","!bg-white"],["diameter","40"],["mat-table","","matSort","",1,"!bg-white",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","gender"],["matColumnDef","email"],["matColumnDef","phoneNumber"],["matColumnDef","country"],["matColumnDef","totalAmountSpent"],["matColumnDef","avgAmountSpent"],["matColumnDef","totalOrders"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of Customers",1,"!bg-white",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","aria-label","Customer actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,r){i&1&&(n(0,"mat-card",1)(1,"mat-card-content",2)(2,"div",3)(3,"div",4)(4,"mat-form-field",5)(5,"mat-label"),a(6,"Search"),o(),n(7,"mat-icon",6),a(8,"search"),o(),n(9,"input",7),S("keyup",function(u){return r.applyFilter(u)}),N("ngModelChange",function(u){return F(r.searchText,u)||(r.searchText=u),u}),o()()(),n(10,"div",8)(11,"button",9),S("click",function(){return r.openDialog()}),n(12,"mat-icon"),a(13,"add"),o(),a(14," ADD Customer "),o()()(),P(15,Nt,2,0,"div",10)(16,Ht,1,0,"app-no-record",11)(17,Vt,1,0,"app-no-record",12)(18,re,32,5,"div",13),o()()),i&2&&(m(9),B("ngModel",r.searchText),m(6),R(r.customers.isLoading()?15:r.customers.hasValue()&&r.dataSource.data.length===0?16:r.customers.error()?17:r.customers.hasValue()?18:-1))},dependencies:[$,Tt,_t,ht,Mt,St,ft,wt,gt,xt,Et,yt,bt,g,Rt,x,Pt,X,J,K,st,lt,rt,mt,pt,dt,z,Q,O,G,q,et,Z,Y,tt,ct,ut,Lt,It,U,at,it,nt,ot,V],encapsulation:2})};export{Bt as CustomerListComponent};
