import{a as Be,b as Ue}from"./chunk-4RGGWYHT.js";import{a as Le}from"./chunk-CZXVBKZM.js";import"./chunk-OC53S64Y.js";import"./chunk-24SFQJLQ.js";import{c as Oe}from"./chunk-VL5A6MKX.js";import{a as Re,b as Ee,c as Fe,h as Te}from"./chunk-DOHPGGLS.js";import"./chunk-MS4AQ6UA.js";import{a as Me,b as Pe}from"./chunk-A233OVEX.js";import{k as we}from"./chunk-BWWYPHKT.js";import{a as Ie,b as De}from"./chunk-YVYCFWPM.js";import"./chunk-3RK6DDJD.js";import{a as Ne,b as Ve}from"./chunk-LIUA42FM.js";import"./chunk-JQGESV5S.js";import"./chunk-IX32NZKS.js";import{d as Z}from"./chunk-XQNDMVIO.js";import{c as ue,d as pe}from"./chunk-3632TDEK.js";import{a as Q}from"./chunk-I24LUS2H.js";import"./chunk-F5X5MWHG.js";import{c as ke}from"./chunk-DSRTAZMJ.js";import{c as Se}from"./chunk-H55FNLX4.js";import{a as fe,b as xe,c as _e,d as be,e as Ce}from"./chunk-5XJCC6NP.js";import{b as ye}from"./chunk-LPJWQZ4I.js";import"./chunk-EEQKDLYL.js";import"./chunk-JTD73F4Y.js";import{a as le,d as de,e as ce,h as me}from"./chunk-JGZ2V5AL.js";import{B as oe,D as ae,b as X,g as ee,h as te,m as ie,p as ne,s as re}from"./chunk-CXVWFC6J.js";import"./chunk-JTLCVARK.js";import{g as se}from"./chunk-HA7VDR7W.js";import{a as ge,b as he}from"./chunk-7C3RSL2D.js";import"./chunk-OHZSVTBE.js";import"./chunk-VIOSJ367.js";import"./chunk-TEL7Y7UN.js";import{p as J,q as K}from"./chunk-FSA22CPB.js";import{b as ve}from"./chunk-JTAKXPWP.js";import"./chunk-M2YK6UF7.js";import"./chunk-BVQK7CK4.js";import"./chunk-LJSEVW7O.js";import{a as H,c as Y}from"./chunk-7EKHSXIM.js";import"./chunk-TQDHD3WD.js";import{i as $,o as j,p as z,q as W,t as q}from"./chunk-DWCYWQVU.js";import{Cc as R,Db as f,Dc as A,Eb as x,Ec as T,G as N,Hb as D,Ib as M,Jb as _,Kb as n,L as V,Lb as r,Mb as w,Mc as E,Nc as G,Qb as C,Ub as p,Vb as c,_a as s,dc as I,ec as P,fa as S,ic as a,jc as b,kb as O,kc as v,la as m,lc as F,ma as u,qb as L,va as h,wc as B,xc as U}from"./chunk-5AECHVKR.js";import{f as k}from"./chunk-EQDQRRRY.js";var $e=()=>[5,10,25,50,100],je=l=>({reservation:l}),Ge=(l,t)=>t.value,ze=(l,t)=>t._id;function We(l,t){if(l&1&&(n(0,"mat-option",37)(1,"span",57),w(2,"span",58),a(3),r()()),l&2){let e=t.$implicit;_("value",e.value),s(2),_("ngClass","bg-"+e.color+"-500 ring-"+e.color+"-200"),s(),v(" ",e.label," ")}}function qe(l,t){l&1&&(n(0,"div",52),w(1,"mat-spinner",59),n(2,"span",60),a(3,"Loading reservations..."),r()())}function He(l,t){if(l&1){let e=C();n(0,"div",53)(1,"div",61)(2,"mat-icon",62),a(3,"error"),r(),n(4,"div")(5,"h3",63),a(6,"Error loading reservations"),r(),n(7,"p",64),a(8),r(),n(9,"div",65)(10,"button",66),p("click",function(){m(e);let o=c();return u(o.refreshReservations())}),n(11,"mat-icon",67),a(12,"refresh"),r(),a(13," Retry "),r(),n(14,"button",68),p("click",function(){m(e);let o=c();return u(o.clearError())}),a(15,"Dismiss"),r()()()()()}if(l&2){let e=c();s(8),b(e.error())}}function Ye(l,t){if(l&1){let e=C();n(0,"div",69)(1,"div",70)(2,"mat-icon",71),a(3,"hotel"),r()(),n(4,"h3",72),a(5,"No reservations found"),r(),n(6,"p",73),a(7),r(),n(8,"button",74),p("click",function(){m(e);let o=c(2);return u(o.createReservation())}),n(9,"mat-icon",49),a(10,"add"),r(),a(11," Create New Reservation "),r()()}if(l&2){let e,i=c(2);s(7),v(" ",(e=i.filterForm.get("search"))!=null&&e.value||(e=i.filterForm.get("status"))!=null&&e.value?"Try adjusting your filters or search terms to find matching reservations.":"Get started by creating your first reservation to begin managing your hotel bookings."," ")}}function Ze(l,t){l&1&&(n(0,"mat-icon",100),a(1,"refresh"),r())}function Je(l,t){if(l&1&&w(0,"span",113),l&2){let e=c().$implicit,i=c(3);P("background-color",i.getStatusColorHex(e.status))}}function Ke(l,t){l&1&&(n(0,"mat-icon",102),a(1,"expand_more"),r())}function Qe(l,t){if(l&1){let e=C();n(0,"button",114),p("click",function(){m(e);let o=c().$implicit,d=c(3);return u(d.editReservation(o))}),n(1,"mat-icon",115),a(2,"edit"),r(),n(3,"span"),a(4,"Edit"),r()()}}function Xe(l,t){if(l&1){let e=C();n(0,"tr",85),p("click",function(){let o=m(e).$implicit,d=c(3);return u(d.viewReservation(o))}),n(1,"td",86)(2,"div",87),p("click",function(o){let d=m(e).$implicit,g=c(3);return o.stopPropagation(),u(g.viewReservation(d))}),a(3),r()(),n(4,"td",86)(5,"div",57)(6,"div",88)(7,"div",89)(8,"span"),a(9),r()()(),n(10,"div",90)(11,"div",91),a(12),r(),n(13,"div",8),a(14),r(),n(15,"div",92),a(16),r()()()(),n(17,"td",86)(18,"div",93)(19,"mat-icon",94),a(20,"hotel"),r(),n(21,"div")(22,"div",95),a(23),r(),n(24,"div",8),a(25),r()()()(),n(26,"td",86)(27,"div",93)(28,"mat-icon",96),a(29,"login"),r(),n(30,"div")(31,"div",95),a(32),R(33,"date"),r(),n(34,"div",8),a(35),r()()()(),n(36,"td",86)(37,"div",93)(38,"mat-icon",97),a(39,"logout"),r(),n(40,"div")(41,"div",95),a(42),R(43,"date"),r(),n(44,"div",8),a(45),r()()()(),n(46,"td",86)(47,"div",98)(48,"button",99),p("click",function(o){return m(e),u(o.stopPropagation())}),f(49,Ze,2,0,"mat-icon",100)(50,Je,1,2,"span",101),a(51),R(52,"titlecase"),f(53,Ke,2,0,"mat-icon",102),r()()(),n(54,"td",86)(55,"div",103),a(56),R(57,"number"),r(),n(58,"div",8),a(59),r(),n(60,"div",104),a(61),R(62,"number"),r()(),n(63,"td",105)(64,"div",106)(65,"div",107)(66,"button",108),p("click",function(o){return m(e),u(o.stopPropagation())}),n(67,"mat-icon",49),a(68,"more_vert"),r()(),n(69,"mat-menu",109,3)(71,"button",110),p("click",function(){let o=m(e).$implicit,d=c(3);return u(d.viewReservation(o))}),n(72,"mat-icon",111),a(73,"visibility"),r(),n(74,"span"),a(75,"View Details"),r()(),f(76,Qe,5,0,"button",112),r()()()()()}if(l&2){let e=t.$implicit,i=I(70),o=c(3),d=I(146);s(3),v(" ",e.confirmationNumber," "),s(6),b(o.getGuestName(e).charAt(0).toUpperCase()||"G"),s(3),v(" ",o.getGuestName(e)," "),s(2),v(" ",e.guestDetails.primaryGuest.email||"No email"," "),s(2),v(" ",e.guestDetails.primaryGuest.phone||"No phone"," "),s(7),v(" ",o.getRoomNumbers(e)," "),s(2),F(" ",e.rooms.length," room",e.rooms.length!==1?"s":""," "),s(7),v(" ",T(33,34,e.checkInDate,"MMM dd, yyyy")," "),s(3),v(" ",e.expectedCheckInTime||"15:00"," "),s(7),v(" ",T(43,37,e.checkOutDate,"MMM dd, yyyy")," "),s(3),v(" ",e.expectedCheckOutTime||"11:00"," "),s(3),P("background-color",o.getStatusColorHex(e.status)+"20")("color",o.getStatusColorHex(e.status))("border-color",o.getStatusColorHex(e.status)+"40")("focus:ring-color",o.getStatusColorHex(e.status)+"60"),_("matMenuTriggerFor",d)("matMenuTriggerData",U(48,je,e))("disabled",o.isStatusUpdating(e._id)),s(),x(o.isStatusUpdating(e._id)?49:50),s(2),v(" ",A(52,40,e.status)," "),s(2),x(!o.isStatusUpdating(e._id)&&o.getAvailableStatusOptions(e).length>0?53:-1),s(3),F(" ",o.currency,"",T(57,42,e.pricing.total,"1.2-2")," "),s(3),F(" ",e.numberOfNights," night",e.numberOfNights!==1?"s":""," "),s(2),F(" ",o.currency,"",T(62,45,(e.pricing.total||0)/(e.numberOfNights||1),"1.2-2"),"/night "),s(5),_("matMenuTriggerFor",i),s(10),x(o.canEdit(e)?76:-1)}}function et(l,t){if(l&1){let e=C();n(0,"div",69)(1,"div",70)(2,"mat-icon",71),a(3,"hotel"),r()(),n(4,"h3",72),a(5,"No reservations found"),r(),n(6,"p",73),a(7,"Try adjusting your filters or create a new reservation."),r(),n(8,"button",74),p("click",function(){m(e);let o=c(3);return u(o.createReservation())}),n(9,"mat-icon",49),a(10,"add"),r(),a(11," New Reservation "),r()()}}function tt(l,t){if(l&1){let e=C();n(0,"div",75)(1,"div",76)(2,"table",77)(3,"thead",78)(4,"tr")(5,"th",79),a(6," Confirmation # "),r(),n(7,"th",79),a(8," Guest Information "),r(),n(9,"th",79),a(10," Room Details "),r(),n(11,"th",79),a(12," Check-in "),r(),n(13,"th",79),a(14," Check-out "),r(),n(15,"th",79),a(16," Status "),r(),n(17,"th",79),a(18," Total Amount "),r(),n(19,"th",80),a(20," Actions "),r()()(),n(21,"tbody",81),D(22,Xe,77,50,"tr",82,ze),r()()(),f(24,et,12,0,"div",69),r(),n(25,"div",83)(26,"mat-paginator",84),p("page",function(o){m(e);let d=c(2);return u(d.onPageChange(o))}),r()()}if(l&2){let e=c(2);s(22),M(e.reservations()),s(2),x(e.reservations().length===0&&!e.loading()?24:-1),s(2),_("length",e.totalReservations())("pageSize",e.pageSize())("pageSizeOptions",B(5,$e))("pageIndex",e.currentPage()-1)}}function it(l,t){if(l&1&&(n(0,"div",54),f(1,Ye,12,1,"div",69),f(2,tt,27,6),r()),l&2){let e=c();s(),x(!e.loading()&&e.reservations().length===0?1:-1),s(),x(!e.loading()&&e.reservations().length>0?2:-1)}}function nt(l,t){l&1&&(n(0,"div",117),a(1," No status changes available "),r())}function rt(l,t){if(l&1){let e=C();n(0,"button",121),p("click",function(){let o=m(e).$implicit,d=c().reservation,g=c();return u(g.updateReservationStatus(d,o.value))}),n(1,"mat-icon",122),a(2),r(),n(3,"span"),a(4),r()()}if(l&2){let e=t.$implicit;s(),P("color",e.color),s(),b(e.icon),s(2),b(e.label)}}function ot(l,t){l&1&&(n(0,"div",119),a(1," \u{1F4A1} Confirm reservation before check-in "),r())}function at(l,t){l&1&&(n(0,"div",120),a(1," \u{1F4A1} Ready for check-in "),r())}function st(l,t){if(l&1&&(n(0,"div",116),a(1," Change Status "),r(),f(2,nt,2,0,"div",117),D(3,rt,5,4,"button",118,Ge),f(5,ot,2,0,"div",119),f(6,at,2,0,"div",120)),l&2){let e=t.reservation,i=c();s(2),x(i.getAvailableStatusOptions(e).length===0?2:-1),s(),M(i.getAvailableStatusOptions(e)),s(2),x(e.status==="pending"?5:-1),s(),x(e.status==="confirmed"?6:-1)}}var Ae=class l{router=S(Y);route=S(H);fb=S(oe);reservationService=S(Le);storeStore=S(ve);snackBar=S(Q);dialog=S(Se);reservations=h([]);loading=h(!1);error=h(null);currentPage=h(1);pageSize=h(10);totalReservations=h(0);statusUpdating=h(new Set);searchFilter=h("");statusFilter=h("");dateFromFilter=h(null);dateToFilter=h(null);sortByFilter=h("createdAt");sortOrderFilter=h("desc");filterForm=this.fb.group({search:[""],status:[""],dateFrom:[null],dateTo:[null],sortBy:["createdAt"],sortOrder:["desc"]});confirmedCount=E(()=>this.reservations().filter(t=>t.status==="confirmed").length);checkedInCount=E(()=>this.reservations().filter(t=>t.status==="checked_in").length);pendingCount=E(()=>this.reservations().filter(t=>t.status==="pending").length);cancelledCount=E(()=>this.reservations().filter(t=>t.status==="cancelled").length);totalRevenue=E(()=>this.reservations().reduce((t,e)=>t+(e.pricing?.total||0),0));filterParams=E(()=>{let e={storeId:this.storeStore.selectedStore()?._id,page:this.currentPage(),limit:this.pageSize(),sortBy:this.sortByFilter(),sortOrder:this.sortOrderFilter()};return this.searchFilter()&&this.searchFilter().trim()&&(e.search=this.searchFilter().trim()),this.statusFilter()&&this.statusFilter().trim()&&(e.status=this.statusFilter().trim()),this.dateFromFilter()&&(e.dateFrom=new Date(this.dateFromFilter()).toISOString().split("T")[0]),this.dateToFilter()&&(e.dateTo=new Date(this.dateToFilter()).toISOString().split("T")[0]),e});displayedColumns=["confirmationNumber","guest","rooms","checkIn","checkOut","status","total","actions"];statusOptions=[{value:"",label:"All Statuses",color:"gray"},{value:"pending",label:"Pending",color:"orange"},{value:"confirmed",label:"Confirmed",color:"blue"},{value:"checked_in",label:"Checked In",color:"green"},{value:"checked_out",label:"Checked Out",color:"purple"},{value:"cancelled",label:"Cancelled",color:"red"},{value:"no_show",label:"No Show",color:"gray"}];constructor(){G(()=>{let t=this.filterParams();if(console.log("Filter params changed, loading reservations:",t),!t.storeId){console.log("No store selected, skipping load");return}this.loadReservationsInternal()}),this.filterForm.valueChanges.pipe(N(300),V()).subscribe(t=>{console.log("Form values changed:",t),this.currentPage.set(1),this.searchFilter.set(t.search||""),this.statusFilter.set(t.status||""),this.dateFromFilter.set(t.dateFrom||null),this.dateToFilter.set(t.dateTo||null),this.sortByFilter.set(t.sortBy||"createdAt"),this.sortOrderFilter.set(t.sortOrder||"desc")})}loadReservationsInternal(){this.loading.set(!0),this.error.set(null);let t=this.filterParams();console.log("Loading reservations with params:",t),this.reservationService.getReservations(t).subscribe({next:e=>{console.log("Reservations response:",e),this.reservations.set(e.reservations),this.totalReservations.set(e.total),this.loading.set(!1)},error:e=>{console.error("Error loading reservations:",e),this.error.set(e.message||"Failed to load reservations"),this.loading.set(!1),this.reservations.set([]),this.totalReservations.set(0)}})}loadReservations(){this.loadReservationsInternal()}onPageChange(t){this.currentPage.set(t.pageIndex+1),this.pageSize.set(t.pageSize),this.loadReservations()}clearFilters(){this.filterForm.reset({search:"",status:"",dateFrom:null,dateTo:null,sortBy:"createdAt",sortOrder:"desc"}),this.searchFilter.set(""),this.statusFilter.set(""),this.dateFromFilter.set(null),this.dateToFilter.set(null),this.sortByFilter.set("createdAt"),this.sortOrderFilter.set("desc"),this.currentPage.set(1)}refreshReservations(){this.loadReservations()}getStatusColor(t){return this.statusOptions.find(i=>i.value===t)?.color||"gray"}getGuestName(t){return typeof t.guest=="string"?t.guestDetails.primaryGuest.firstName+" "+t.guestDetails.primaryGuest.lastName:t.guest.firstName+" "+t.guest.lastName}getRoomNumbers(t){return t.rooms.map(e=>typeof e.room=="string"?e.room:e.room.roomNumber).join(", ")}get currency(){return this.storeStore.selectedStore()?.currencyCode||this.storeStore.selectedStore()?.currency||"$"}createReservation(){this.router.navigate(["../create"],{relativeTo:this.route})}viewReservation(t){this.router.navigate(["../details",t._id],{relativeTo:this.route})}editReservation(t){this.router.navigate(["../edit",t._id],{relativeTo:this.route})}checkInReservation(t){t.status==="confirmed"&&this.reservationService.checkInReservation(t._id).subscribe({next:()=>{this.refreshReservations()},error:e=>{console.error("Error checking in reservation:",e)}})}checkOutReservation(t){t.status==="checked_in"&&this.reservationService.checkOutReservation(t._id).subscribe({next:()=>{this.refreshReservations()},error:e=>{console.error("Error checking out reservation:",e)}})}cancelReservation(t){let e=prompt("Please provide a reason for cancellation:");e&&this.reservationService.cancelReservation(t._id,e).subscribe({next:()=>{this.refreshReservations()},error:i=>{console.error("Error cancelling reservation:",i)}})}canCheckIn(t){return t.status==="confirmed"&&new Date(t.checkInDate)<=new Date}canCheckOut(t){return t.status==="checked_in"}canCancel(t){return["pending","confirmed"].includes(t.status)}canEdit(t){return t.status!=="cancelled"&&t.status!=="checked_out"&&t.status!=="no_show"&&t.status!=="checked_in"&&!t.actualCheckInDate}allStatusOptions=[{value:"pending",label:"Pending",icon:"schedule",color:"#f59e0b"},{value:"confirmed",label:"Confirmed",icon:"check_circle",color:"#10b981"},{value:"checked_in",label:"Checked In",icon:"login",color:"#3b82f6"},{value:"checked_out",label:"Checked Out",icon:"logout",color:"#6b7280"},{value:"cancelled",label:"Cancelled",icon:"cancel",color:"#ef4444"},{value:"no_show",label:"No Show",icon:"person_off",color:"#f97316"}];isValidStatusTransition(t,e){return{pending:["confirmed","cancelled","no_show"],confirmed:["checked_in","cancelled","no_show"],checked_in:["checked_out"],checked_out:[],cancelled:[],no_show:[]}[t]?.includes(e)||!1}getStatusTransitionError(t,e){switch(e){case"checked_in":return'Guests can only be checked in when reservation status is "Confirmed"';case"checked_out":return'Guests can only be checked out when reservation status is "Checked In"';case"confirmed":return t==="checked_in"?"Cannot change back to confirmed after check-in":t==="checked_out"?"Cannot change back to confirmed after check-out":"Invalid status transition";default:return`Cannot change status from "${t}" to "${e}"`}}getAvailableStatusOptions(t){let e=t.status;return this.allStatusOptions.filter(i=>i.value!==e&&this.isValidStatusTransition(e,i.value))}updateReservationStatus(t,e){return k(this,null,function*(){if(t.status!==e){if(e==="checked_in"){this.showCheckInDialog(t);return}if(e==="checked_out"){yield this.performCheckOut(t);return}if(!this.isValidStatusTransition(t.status,e)){this.snackBar.open(this.getStatusTransitionError(t.status,e),"Close",{duration:5e3,panelClass:["error-snackbar"]});return}(e==="cancelled"||e==="no_show")&&!confirm(`Are you sure you want to change the status to ${e}?`)||(yield this.performStatusUpdate(t,e))}})}showCheckInDialog(t){let e={reservation:t};this.dialog.open(Be,{data:e,width:"600px",maxWidth:"90vw",disableClose:!0}).afterClosed().subscribe(o=>{o?.confirmed&&this.performCheckIn(t,o)})}performCheckIn(t,e){return k(this,null,function*(){let i=new Set(this.statusUpdating());i.add(t._id),this.statusUpdating.set(i);try{let o=yield this.reservationService.checkInReservationWithRooms(t._id).toPromise();if(o){let g=this.reservations().map(y=>y._id===t._id?o:y);this.reservations.set(g),this.snackBar.open("Guest checked in successfully! Room status updated to occupied.","Close",{duration:5e3})}}catch(o){console.error("Error during check-in:",o);let d=o instanceof Error?o.message:"Failed to check in guest";this.snackBar.open(d,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{let o=new Set(this.statusUpdating());o.delete(t._id),this.statusUpdating.set(o)}})}performCheckOut(t){return k(this,null,function*(){if(this.requiresPaymentBeforeCheckout(t)){this.showPaymentRequiredDialog(t);return}let e=new Set(this.statusUpdating());e.add(t._id),this.statusUpdating.set(e);try{let i=yield this.reservationService.checkOutReservationWithRooms(t._id).toPromise();if(i){let d=this.reservations().map(g=>g._id===t._id?i:g);this.reservations.set(d),this.snackBar.open("Guest checked out successfully! Room status updated to cleaning.","Close",{duration:5e3})}}catch(i){console.error("Error during check-out:",i);let o=i instanceof Error?i.message:"Failed to check out guest";this.snackBar.open(o,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{let i=new Set(this.statusUpdating());i.delete(t._id),this.statusUpdating.set(i)}})}requiresPaymentBeforeCheckout(t){let e=t.pricing.balance>0,i=t.paymentInfo?.status!=="paid";return e&&i}showPaymentRequiredDialog(t){let e={reservation:t,isCheckoutFlow:!0};this.dialog.open(Ue,{data:e,width:"600px",maxWidth:"90vw",disableClose:!0}).afterClosed().subscribe(o=>{o?.confirmed&&o.paymentData&&this.processPaymentAndCheckout(t,o.paymentData)})}processPaymentAndCheckout(t,e){return k(this,null,function*(){let i=new Set(this.statusUpdating());i.add(t._id),this.statusUpdating.set(i);try{yield this.reservationService.processPayment(t._id,{amount:e.amount,method:e.method,reference:e.reference||`PAY-${Date.now()}`}).toPromise();let o=yield this.reservationService.getReservationById(t._id).toPromise();if(o){let g=this.reservations().map(y=>y._id===t._id?o:y);this.reservations.set(g),this.snackBar.open(`Payment of ${this.formatCurrency(e.amount)} recorded successfully`,"Close",{duration:3e3}),o.pricing.balance<=0||o.paymentInfo?.status==="paid"?setTimeout(()=>{this.proceedWithCheckout(o)},1500):this.snackBar.open("Payment recorded, but outstanding balance remains. Please complete payment before checkout.","Close",{duration:5e3,panelClass:["warning-snackbar"]})}}catch(o){console.error("Error processing payment for checkout:",o);let d=o instanceof Error?o.message:"Failed to process payment";this.snackBar.open(d,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{let o=new Set(this.statusUpdating());o.delete(t._id),this.statusUpdating.set(o)}})}proceedWithCheckout(t){return k(this,null,function*(){let e=new Set(this.statusUpdating());e.add(t._id),this.statusUpdating.set(e);try{let i=yield this.reservationService.checkOutReservationWithRooms(t._id).toPromise();if(i){let d=this.reservations().map(g=>g._id===t._id?i:g);this.reservations.set(d),this.snackBar.open("Guest checked out successfully! Room status updated to cleaning.","Close",{duration:5e3})}}catch(i){console.error("Error during checkout after payment:",i);let o=i instanceof Error?i.message:"Failed to complete checkout";this.snackBar.open(o,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{let i=new Set(this.statusUpdating());i.delete(t._id),this.statusUpdating.set(i)}})}formatCurrency(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:this.storeStore.selectedStore()?.currencyCode||"USD"}).format(t)}performStatusUpdate(t,e){return k(this,null,function*(){let i=new Set(this.statusUpdating());i.add(t._id),this.statusUpdating.set(i);try{let o=yield this.reservationService.updateReservationStatus(t._id,e).toPromise();if(o){let g=this.reservations().map(y=>y._id===t._id?o:y);this.reservations.set(g),this.snackBar.open(`Status updated to ${e}`,"Close",{duration:3e3})}}catch(o){console.error("Error updating reservation status:",o);let d=o instanceof Error?o.message:"Failed to update status";this.snackBar.open(d,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{let o=new Set(this.statusUpdating());o.delete(t._id),this.statusUpdating.set(o)}})}isStatusUpdating(t){return this.statusUpdating().has(t)}getStatusColorHex(t){return{pending:"#f59e0b",confirmed:"#10b981",checked_in:"#3b82f6",checked_out:"#6b7280",cancelled:"#ef4444",no_show:"#f97316"}[t]||"#6b7280"}getStatusIcon(t){return{pending:"schedule",confirmed:"check_circle",checked_in:"login",checked_out:"logout",cancelled:"cancel",no_show:"person_off"}[t]||"help"}clearError(){this.error.set(null),this.loadReservations()}exportReservations(){try{let t=this.generateCSV(),e=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(i.download!==void 0){let o=URL.createObjectURL(e);i.setAttribute("href",o),i.setAttribute("download",this.generateExportFilename()),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),this.snackBar.open("Reservations exported successfully","Close",{duration:3e3})}}catch(t){console.error("Error exporting reservations:",t),this.snackBar.open("Failed to export reservations","Close",{duration:5e3,panelClass:["error-snackbar"]})}}generateCSV(){let e=[["Confirmation Number","Guest Name","Email","Phone","Room Numbers","Check-in Date","Check-out Date","Check-in Time","Check-out Time","Status","Adults","Children","Nights","Subtotal","Taxes","Total","Balance","Payment Status","Created Date","Special Requests/Notes"].join(",")];return this.reservations().forEach(i=>{let o=[this.escapeCsvField(i.confirmationNumber||""),this.escapeCsvField(this.getGuestName(i)),this.escapeCsvField(i.guestDetails?.primaryGuest?.email||""),this.escapeCsvField(i.guestDetails?.primaryGuest?.phone||""),this.escapeCsvField(this.getRoomNumbers(i)),this.formatDateForCSV(i.checkInDate),this.formatDateForCSV(i.checkOutDate),this.escapeCsvField(i.expectedCheckInTime||""),this.escapeCsvField(i.expectedCheckOutTime||""),this.escapeCsvField(i.status||""),i.guestDetails?.totalAdults||0,i.guestDetails?.totalChildren||0,i.numberOfNights||0,i.pricing?.subtotal||0,i.pricing?.taxes||0,i.pricing?.total||0,i.pricing?.balance||0,this.escapeCsvField(i.paymentInfo?.status||"pending"),this.formatDateForCSV(i.createdAt),this.escapeCsvField(i.specialRequests||i.internalNotes||"")];e.push(o.join(","))}),e.join(`
`)}escapeCsvField(t){if(t==null)return"";let e=String(t);return e.includes(",")||e.includes('"')||e.includes(`
`)?`"${e.replace(/"/g,'""')}"`:e}formatDateForCSV(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}):""}generateExportFilename(){let t=new Date,e=t.toISOString().split("T")[0],i=t.toTimeString().split(" ")[0].replace(/:/g,"-"),o=`reservations_${e}_${i}`,d=this.filterForm.value;return d.search&&(o+=`_search-${d.search.replace(/[^a-zA-Z0-9]/g,"")}`),d.status&&(o+=`_${d.status}`),(d.dateFrom||d.dateTo)&&(o+="_filtered"),`${o}.csv`}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=O({type:l,selectors:[["app-reservations-list"]],decls:148,vars:20,consts:[["dateFromPicker",""],["dateToPicker",""],["statusMenu","matMenu"],["actionMenu","matMenu"],[1,"bg-gradient-to-r","from-blue-50","to-indigo-50","border-b","border-blue-100"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"flex","justify-between","items-center","py-6"],[1,"text-3xl","font-bold","text-gray-900","mb-1"],[1,"text-sm","text-gray-600"],["mat-raised-button","","color","primary",1,"!bg-gradient-to-r","!from-blue-600","!to-blue-700","hover:!from-blue-700","hover:!to-blue-800","!text-white","px-6","py-3","rounded-lg","font-medium","transition-all","duration-200","shadow-lg","hover:shadow-xl","transform","hover:scale-105",3,"click"],[1,"mr-2"],[1,"bg-white","shadow-sm","border-b","border-gray-100"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-6"],[1,"grid","grid-cols-2","md:grid-cols-3","lg:grid-cols-6","gap-4"],[1,"bg-gradient-to-br","from-blue-50","to-blue-100","rounded-xl","border","border-blue-200","p-4","shadow-sm","hover:shadow-md","transition-all","duration-200"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","bg-gradient-to-r","from-blue-500","to-blue-600","rounded-full","flex","items-center","justify-center","shadow-lg"],[1,"text-white","text-xl"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-sm","font-medium","text-gray-600"],[1,"bg-gradient-to-br","from-green-50","to-green-100","rounded-xl","border","border-green-200","p-4","shadow-sm","hover:shadow-md","transition-all","duration-200"],[1,"w-12","h-12","bg-gradient-to-r","from-green-500","to-green-600","rounded-full","flex","items-center","justify-center","shadow-lg"],[1,"bg-gradient-to-br","from-purple-50","to-purple-100","rounded-xl","border","border-purple-200","p-4","shadow-sm","hover:shadow-md","transition-all","duration-200"],[1,"w-12","h-12","bg-gradient-to-r","from-purple-500","to-purple-600","rounded-full","flex","items-center","justify-center","shadow-lg"],[1,"bg-gradient-to-br","from-orange-50","to-orange-100","rounded-xl","border","border-orange-200","p-4","shadow-sm","hover:shadow-md","transition-all","duration-200"],[1,"w-12","h-12","bg-gradient-to-r","from-orange-500","to-orange-600","rounded-full","flex","items-center","justify-center","shadow-lg"],[1,"bg-gradient-to-br","from-red-50","to-red-100","rounded-xl","border","border-red-200","p-4","shadow-sm","hover:shadow-md","transition-all","duration-200"],[1,"w-12","h-12","bg-gradient-to-r","from-red-500","to-red-600","rounded-full","flex","items-center","justify-center","shadow-lg"],[1,"bg-gradient-to-br","from-cyan-50","to-cyan-100","rounded-xl","border","border-cyan-200","p-4","shadow-sm","hover:shadow-md","transition-all","duration-200"],[1,"w-12","h-12","bg-gradient-to-r","from-cyan-500","to-cyan-600","rounded-full","flex","items-center","justify-center","shadow-lg"],[3,"formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","xl:grid-cols-6","gap-4","mb-4"],[1,"lg:col-span-2"],["appearance","outline",1,"w-full","[&_.mdc-text-field--outlined]:!bg-gray-50","[&_.mdc-text-field--outlined]:!border-gray-200","hover:[&_.mdc-text-field--outlined]:!border-blue-300","[&_.mdc-text-field--focused_.mdc-text-field--outlined]:!border-blue-500"],["matPrefix","",1,"text-gray-400"],["matInput","","placeholder","Guest name or confirmation #","formControlName","search",1,"!bg-gray-50"],["formControlName","status"],[3,"value"],["matInput","","formControlName","dateFrom",1,"!bg-gray-50",3,"matDatepicker"],["matSuffix","",1,"text-gray-400",3,"for"],["matInput","","formControlName","dateTo",1,"!bg-gray-50",3,"matDatepicker"],["formControlName","sortBy"],["value","createdAt"],["value","checkInDate"],["value","checkOutDate"],["value","total"],["value","guestName"],[1,"flex","items-center","justify-between"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-gray-700","bg-white","border","border-gray-300","rounded-lg","hover:bg-gray-50","hover:border-gray-400","transition-all","duration-200","flex","items-center","gap-2",3,"click"],[1,"text-lg"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-white","bg-green-600","border","border-green-600","rounded-lg","hover:bg-green-700","hover:border-green-700","transition-all","duration-200","flex","items-center","gap-2","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:bg-green-600",3,"click","disabled"],[1,"flex","items-center","text-sm","text-gray-600"],[1,"flex","justify-center","items-center","py-12","bg-white"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","m-4"],[1,"py-6"],[1,"!shadow-xl","!border","!border-gray-200","!rounded-lg"],["matMenuContent",""],[1,"flex","items-center"],[1,"w-3","h-3","rounded-full","mr-3","ring-2",3,"ngClass"],["diameter","40",1,"!text-blue-600"],[1,"ml-3","text-gray-600"],[1,"flex"],[1,"text-red-500","mr-2"],[1,"text-red-800","font-medium"],[1,"text-red-700","text-sm","mt-1"],[1,"mt-3","flex","space-x-3"],["mat-button","","color","warn",1,"!text-red-600",3,"click"],[1,"mr-1"],["mat-button","",1,"!text-gray-600",3,"click"],[1,"py-20","bg-gradient-to-br","from-gray-50","to-white","text-center"],[1,"w-16","h-16","bg-gray-200","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],[1,"text-4xl","text-gray-400"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-500","mb-6"],[1,"!bg-gradient-to-r","!from-blue-600","!to-blue-700","hover:!from-blue-700","hover:!to-blue-800","!text-white","px-6","py-3","rounded-lg","font-medium","transition-all","duration-200","shadow-lg","hover:shadow-xl","transform","hover:scale-105","inline-flex","items-center","gap-2",3,"click"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","overflow-hidden","mb-6"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gradient-to-r","from-gray-50","to-gray-100"],[1,"px-6","py-4","text-left","text-xs","font-semibold","text-gray-700","uppercase","tracking-wider","border-b-2","border-gray-200"],[1,"px-6","py-4","text-right","text-xs","font-semibold","text-gray-700","uppercase","tracking-wider","border-b-2","border-gray-200"],[1,"bg-white","divide-y","divide-gray-100"],[1,"hover:bg-gray-50","transition-colors","duration-200","cursor-pointer"],[1,"bg-white","px-4","py-3","border-t","border-gray-200","sm:px-6","rounded-b-lg"],["showFirstLastButtons","",1,"!border-0","!bg-white","[&_.mat-mdc-paginator-range-label]:!text-gray-600",3,"page","length","pageSize","pageSizeOptions","pageIndex"],[1,"hover:bg-gray-50","transition-colors","duration-200","cursor-pointer",3,"click"],[1,"px-6","py-4","whitespace-nowrap","border-b","border-gray-100"],[1,"text-sm","font-bold","text-blue-600","hover:text-blue-800","cursor-pointer","transition-colors","bg-blue-50","px-3","py-1","rounded-full","border","border-blue-200",3,"click"],[1,"flex-shrink-0","h-12","w-12"],[1,"h-12","w-12","rounded-full","bg-gradient-to-br","from-blue-500","to-blue-600","flex","items-center","justify-center","text-white","font-bold","text-lg","shadow-md","ring-2","ring-blue-200"],[1,"ml-4"],[1,"text-sm","font-semibold","text-gray-900"],[1,"text-xs","text-gray-500","font-medium"],[1,"flex","items-center","space-x-2"],[1,"text-purple-600","text-lg"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-green-600","text-lg"],[1,"text-red-600","text-lg"],[1,"relative"],[1,"inline-flex","items-center","px-3","py-2","text-xs","font-bold","rounded-full","shadow-sm","ring-2","hover:opacity-80","transition-all","duration-200","disabled:opacity-50","disabled:cursor-not-allowed","focus:outline-none","focus:ring-2","focus:ring-offset-2",3,"click","matMenuTriggerFor","matMenuTriggerData","disabled"],[1,"w-2","h-2","mr-2","animate-spin","text-xs"],[1,"w-2","h-2","rounded-full","mr-2",3,"background-color"],[1,"ml-1","text-xs","opacity-60"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-xs","text-gray-500"],[1,"px-6","py-4","whitespace-nowrap","text-right","text-sm","font-medium","border-b","border-gray-100"],[1,"flex","items-center","justify-end"],[1,"relative","inline-block","text-left"],["title","More Actions",1,"text-gray-600","hover:text-gray-900","p-2","rounded-lg","hover:bg-gray-100","transition-all","duration-200",3,"click","matMenuTriggerFor"],[1,"[&_.mat-mdc-menu-panel]:!shadow-xl","[&_.mat-mdc-menu-panel]:!border","[&_.mat-mdc-menu-panel]:!border-gray-200","[&_.mat-mdc-menu-panel]:!rounded-lg"],["mat-menu-item","",1,"!text-gray-700","hover:!bg-blue-50","hover:!text-blue-700","!transition-colors",3,"click"],[1,"mr-3","!text-blue-600"],["mat-menu-item","",1,"!text-gray-700","hover:!bg-green-50","hover:!text-green-700","!transition-colors"],[1,"w-2","h-2","rounded-full","mr-2"],["mat-menu-item","",1,"!text-gray-700","hover:!bg-green-50","hover:!text-green-700","!transition-colors",3,"click"],[1,"mr-3","!text-green-600"],[1,"px-3","py-2","text-xs","font-medium","text-gray-500","border-b","border-gray-100"],[1,"px-3","py-2","text-xs","text-gray-400","italic"],["mat-menu-item","",1,"!text-gray-700","hover:!bg-gray-50","!transition-colors"],[1,"px-3","py-2","text-xs","text-amber-600","bg-amber-50","border-t","border-amber-100","mt-1"],[1,"px-3","py-2","text-xs","text-blue-600","bg-blue-50","border-t","border-blue-100","mt-1"],["mat-menu-item","",1,"!text-gray-700","hover:!bg-gray-50","!transition-colors",3,"click"],[1,"mr-3","!text-base"]],template:function(e,i){if(e&1){let o=C();n(0,"div",4)(1,"div",5)(2,"div",6)(3,"div")(4,"h1",7),a(5,"Reservations"),r(),n(6,"p",8),a(7,"Manage hotel reservations and guest bookings"),r()(),n(8,"button",9),p("click",function(){return m(o),u(i.createReservation())}),n(9,"mat-icon",10),a(10,"add"),r(),a(11," New Reservation "),r()()()(),n(12,"div",11)(13,"div",12)(14,"div",13)(15,"div",14)(16,"div",15)(17,"div",16)(18,"mat-icon",17),a(19,"hotel"),r()(),n(20,"div")(21,"div",18),a(22),r(),n(23,"div",19),a(24,"Total"),r()()()(),n(25,"div",20)(26,"div",15)(27,"div",21)(28,"mat-icon",17),a(29,"check_circle"),r()(),n(30,"div")(31,"div",18),a(32),r(),n(33,"div",19),a(34,"Confirmed"),r()()()(),n(35,"div",22)(36,"div",15)(37,"div",23)(38,"mat-icon",17),a(39,"person"),r()(),n(40,"div")(41,"div",18),a(42),r(),n(43,"div",19),a(44,"Checked In"),r()()()(),n(45,"div",24)(46,"div",15)(47,"div",25)(48,"mat-icon",17),a(49,"schedule"),r()(),n(50,"div")(51,"div",18),a(52),r(),n(53,"div",19),a(54,"Pending"),r()()()(),n(55,"div",26)(56,"div",15)(57,"div",27)(58,"mat-icon",17),a(59,"cancel"),r()(),n(60,"div")(61,"div",18),a(62),r(),n(63,"div",19),a(64,"Cancelled"),r()()()(),n(65,"div",28)(66,"div",15)(67,"div",29)(68,"mat-icon",17),a(69,"attach_money"),r()(),n(70,"div")(71,"div",18),a(72),R(73,"number"),r(),n(74,"div",19),a(75,"Revenue"),r()()()()()()(),n(76,"div",11)(77,"div",12)(78,"form",30)(79,"div",31)(80,"div",32)(81,"mat-form-field",33)(82,"mat-label"),a(83,"Search reservations..."),r(),n(84,"mat-icon",34),a(85,"search"),r(),w(86,"input",35),r()(),n(87,"div")(88,"mat-form-field",33)(89,"mat-label"),a(90,"Status"),r(),n(91,"mat-select",36),D(92,We,4,3,"mat-option",37,Ge),r()()(),n(94,"div")(95,"mat-form-field",33)(96,"mat-label"),a(97,"Check-in from"),r(),w(98,"input",38)(99,"mat-datepicker-toggle",39)(100,"mat-datepicker",null,0),r()(),n(102,"div")(103,"mat-form-field",33)(104,"mat-label"),a(105,"Check-in to"),r(),w(106,"input",40)(107,"mat-datepicker-toggle",39)(108,"mat-datepicker",null,1),r()(),n(110,"div")(111,"mat-form-field",33)(112,"mat-label"),a(113,"Sort by"),r(),n(114,"mat-select",41)(115,"mat-option",42),a(116,"Created Date"),r(),n(117,"mat-option",43),a(118,"Check-in Date"),r(),n(119,"mat-option",44),a(120,"Check-out Date"),r(),n(121,"mat-option",45),a(122,"Total Amount"),r(),n(123,"mat-option",46),a(124,"Guest Name"),r()()()()(),n(125,"div",47)(126,"div",15)(127,"button",48),p("click",function(){return m(o),u(i.clearFilters())}),n(128,"mat-icon",49),a(129,"clear"),r(),a(130," Clear Filters "),r(),n(131,"button",48),p("click",function(){return m(o),u(i.refreshReservations())}),n(132,"mat-icon",49),a(133,"refresh"),r(),a(134," Refresh "),r(),n(135,"button",50),p("click",function(){return m(o),u(i.exportReservations())}),n(136,"mat-icon",49),a(137,"download"),r(),a(138," Export CSV "),r()(),n(139,"div",51)(140,"span"),a(141),r()()()()()(),f(142,qe,4,0,"div",52),f(143,He,16,1,"div",53),f(144,it,3,2,"div",54),n(145,"mat-menu",55,2),L(147,st,7,3,"ng-template",56),r()}if(e&2){let o=I(101),d=I(109);s(22),b(i.reservations().length),s(10),b(i.confirmedCount()),s(10),b(i.checkedInCount()),s(10),b(i.pendingCount()),s(10),b(i.cancelledCount()),s(10),F("",i.currency,"",T(73,17,i.totalRevenue(),"1.2-2")),s(6),_("formGroup",i.filterForm),s(14),M(i.statusOptions),s(6),_("matDatepicker",o),s(),_("for",o),s(7),_("matDatepicker",d),s(),_("for",d),s(28),_("disabled",i.reservations().length===0||i.loading()),s(6),v("Showing ",i.reservations().length," reservations"),s(),x(i.loading()?142:-1),s(),x(i.error()&&!i.loading()?143:-1),s(),x(!i.loading()&&!i.error()?144:-1)}},dependencies:[q,$,W,j,z,ae,ie,X,ee,te,ne,re,we,Pe,Me,Oe,pe,ue,me,le,de,ce,De,Ie,Z,K,J,he,ge,ke,se,Ce,_e,fe,xe,be,ye,Te,Re,Ee,Fe,Ve,Ne],encapsulation:2})};export{Ae as ReservationsListComponent};
