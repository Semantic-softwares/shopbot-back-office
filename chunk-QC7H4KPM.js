import{a as K}from"./chunk-XLZTIYSF.js";import{Aa as w,F as T,M as A,V as O,Vc as D,Y as x,aa as W,b as k,c as P,f as L,fa as h,k as E,o as C,oa as I,qa as v,wa as F,za as R,zb as j}from"./chunk-J2AK4FW5.js";import{a as r,b as p}from"./chunk-GAL4ENT6.js";var U=Symbol("DEEP_SIGNAL");function z(t){return new Proxy(t,{has(e,n){return!!this.get(e,n,void 0)},get(e,n){let o=w(e);return!Q(o)||!(n in o)?(j(e[n])&&e[n][U]&&delete e[n],e[n]):(j(e[n])||(Object.defineProperty(e,n,{value:D(()=>e()[n]),configurable:!0}),e[n][U]=!0),z(e[n]))}})}var N=[WeakSet,WeakMap,Promise,Date,Error,RegExp,ArrayBuffer,DataView,Function];function Q(t){if(t===null||typeof t!="object"||X(t))return!1;let e=Object.getPrototypeOf(t);if(e===Object.prototype)return!0;for(;e&&e!==Object.prototype;){if(N.includes(e.constructor))return!1;e=Object.getPrototypeOf(e)}return e===Object.prototype}function X(t){return typeof t?.[Symbol.iterator]=="function"}var Z=new WeakMap,u=Symbol("STATE_SOURCE");function f(t,...e){let n=w(()=>q(t)),o=e.reduce((c,l)=>r(r({},c),typeof l=="function"?l(c):l),n),a=t[u],i=Reflect.ownKeys(t[u]);for(let c of Reflect.ownKeys(o))if(i.includes(c)){let l=c;n[l]!==o[l]&&a[l].set(o[l])}te(t)}function q(t){let e=t[u];return Reflect.ownKeys(t[u]).reduce((n,o)=>{let a=e[o]();return p(r({},n),{[o]:a})},{})}function ee(t){return Z.get(t[u])||[]}function te(t){let e=ee(t);for(let n of e){let o=w(()=>q(t));n(o)}}function _(...t){let e=[...t],n=typeof e[0]=="function"?{}:e.shift(),o=e;return(()=>{class i{constructor(){let l=o.reduce((y,J)=>J(y),ne()),{stateSignals:S,props:m,methods:b,hooks:s}=l,d=r(r(r({},S),m),b);this[u]=l[u];for(let y of Reflect.ownKeys(d))this[y]=d[y];let{onInit:g,onDestroy:M}=s;g&&g(),M&&h(v).onDestroy(M)}static \u0275fac=function(S){return new(S||i)};static \u0275prov=W({token:i,factory:i.\u0275fac,providedIn:n.providedIn||null})}return i})()}function ne(){return{[u]:{},stateSignals:{},props:{},methods:{},hooks:{}}}function oe(t){return e=>{let n=t(r(r(r({[u]:e[u]},e.stateSignals),e.props),e.methods));return p(r({},e),{props:r(r({},e.props),n)})}}function $(t){return oe(e=>{let n=t(e);return Reflect.ownKeys(n).reduce((a,i)=>{let c=n[i];return p(r({},a),{[i]:j(c)?c:D(c)})},{})})}function G(t){return e=>{let n=r(r(r({[u]:e[u]},e.stateSignals),e.props),e.methods),o=typeof t=="function"?t(n):t,a=(i,c)=>c?()=>{i&&i(),c(n)}:i;return p(r({},e),{hooks:{onInit:a(e.hooks.onInit,o.onInit),onDestroy:a(e.hooks.onDestroy,o.onDestroy)}})}}function H(t){return e=>{let n=t(r(r(r({[u]:e[u]},e.stateSignals),e.props),e.methods));return p(r({},e),{methods:r(r({},e.methods),n)})}}function B(t){return e=>{let n=typeof t=="function"?t():t,o=Reflect.ownKeys(n),a=e[u],i={};for(let c of o)a[c]=F(n[c]),i[c]=z(a[c]);return p(r({},e),{stateSignals:r(r({},e.stateSignals),i)})}}function V(t,e,n){let o=typeof t=="function"?{next:t,error:e,complete:n}:t;return a=>a.pipe(x({next:o.next,complete:o.complete}),T(i=>(o.error(i),E)),o.finalize?A(o.finalize):i=>i)}function Y(t,e){let n=e?.injector??h(I),o=new L,a=t(o).subscribe();n.get(v).onDestroy(()=>a.unsubscribe());let i=(c,l)=>{if(re(c))return o.next(c),{destroy:k};let S=ie(),m=l?.injector??S??n;if(j(c)){let s=R(()=>{let d=c();w(()=>o.next(d))},{injector:m});return a.add({unsubscribe:()=>s.destroy()}),s}let b=c.subscribe(s=>o.next(s));return a.add(b),m!==n&&m.get(v).onDestroy(()=>b.unsubscribe()),{destroy:()=>b.unsubscribe()}};return i.destroy=a.unsubscribe.bind(a),i}function re(t){return!j(t)&&!C(t)}function ie(){try{return h(I)}catch{return}}var se={stores:[],isLoading:!1,selectedStore:null,error:null,logoPath:null,bannerPath:null},Le=_({providedIn:"root"},B(se),$(({stores:t})=>({storesCount:D(()=>t().length)})),H((t,e=h(K))=>{function n(s){f(t,{isLoading:s})}function o(s){e.saveStoreLocally(s),f(t,{selectedStore:s})}function a(s){e.saveStoresLocally(s),f(t,{stores:s})}function i(){f(t,{stores:[]})}function c(){let s=e.getStoreLocally;s&&f(t,{selectedStore:s})}function l(s,d){let g=t.selectedStore();if(g){let M=g.staffs.map(y=>y._id===s?r(r({},y),d):y);f(t,{selectedStore:p(r({},g),{staffs:M})})}}function S(s){let d=t.selectedStore();if(!d)return;let g=p(r(r({},d),s),{_id:d._id});try{e.saveStoreLocally(g)}catch{}f(t,{selectedStore:g})}function m(s){f(t,{logoPath:s})}let b=Y(P(x(()=>f(t,{isLoading:!0,error:null})),O(s=>e.updateStore(t.selectedStore()._id,s).pipe(V({next(d){f(t,{isLoading:!1,error:null,logoPath:null,bannerPath:null}),S(s)},error(d){f(t,{isLoading:!1,error:d})}})))));return{setSelectedStores:a,clearStores:i,updateStore$:b,updateStore:S,updateStoreStaffs:l,setSelectedStore:o,initializeFromStorage:c,updateLogoPath:m,setLoadingState:n}}),G({onInit(t,e=h(K)){let n=e.getStoresLocally,o=e.getStoreLocally;n&&n.length>0&&f(t,{stores:n}),o&&f(t,{selectedStore:o})}}));export{f as a,_ as b,$ as c,G as d,H as e,B as f,V as g,Y as h,Le as i};
