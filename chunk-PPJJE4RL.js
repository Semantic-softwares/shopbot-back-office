import{a as Oe}from"./chunk-QS3AL2H2.js";import{b as xe,f as he}from"./chunk-VQA5W3EJ.js";import{a as Me,b as ve,e as Se,f as Pe,g as ke,h as we}from"./chunk-5PPPFRRH.js";import{a as _e,b as Te,c as ye}from"./chunk-L7BDTWLS.js";import{a as fe,b as be,c as ge,d as Ce}from"./chunk-Q24JN32N.js";import{a as c,b as oe,c as re,d as le,e as de,f as me,g as L,h as A,i as G}from"./chunk-WFQLSX5X.js";import{a as ce,c as se,e as pe,h as ue}from"./chunk-GI3DA2RF.js";import{b as Q,c as q}from"./chunk-5P5QATX2.js";import{$ as j,Y as ae,Z as $}from"./chunk-LG6YQHRU.js";import{n as ne,p as ie,r as R}from"./chunk-6BQAOBQP.js";import{$a as s,Gb as x,Hb as h,Jc as V,Kb as U,Lb as W,Lc as ee,Mb as O,Nb as o,Nc as te,Ob as a,Pb as X,Tc as C,U as S,Wb as N,X as P,Yc as E,Zc as z,_b as b,ac as T,c as v,ea as _,ja as k,ka as w,kc as Y,ob as F,pc as d,qc as I,rc as D,sc as Z,va as K}from"./chunk-H33Y42PP.js";import{a as B,b as J}from"./chunk-GAL4ENT6.js";function Qe(e,n){if(e&1&&(o(0,"span",4),d(1),a()),e&2){let t=T();s(),D(" ",t.table().category.name," ")}}function qe(e,n){e&1&&X(0,"span")}function ze(e,n){if(e&1){let t=N();o(0,"button",11),b("click",function(r){return k(t),w(r.stopPropagation())}),o(1,"mat-icon"),d(2,"more_vert"),a()(),o(3,"mat-menu",null,0)(5,"button",12)(6,"mat-icon"),d(7,"receipt_long"),a(),o(8,"span"),d(9,"View Bill"),a()(),o(10,"button",13),b("click",function(r){k(t);let p=T();return w(p.onClearOrder(r))}),o(11,"mat-icon"),d(12,"clear"),a(),o(13,"span"),d(14,"Clear Order"),a()()()}if(e&2){let t=Y(4);O("matMenuTriggerFor",t)}}function He(e,n){if(e&1&&(o(0,"span",9),d(1),V(2,"currency"),a()),e&2){let t=T();s(),D(" ",te(2,1,t.table().orderId.total,t.currency(),"symbol","1.2-2")," ")}}function Je(e,n){if(e&1){let t=N();o(0,"button",19),b("click",function(r){k(t);let p=T(3);return w(p.onCompleteOrder(r))}),o(1,"mat-icon",17),d(2,"check_circle"),a(),d(3," Complete "),a()}}function Ke(e,n){if(e&1&&(o(0,"div",14)(1,"button",16)(2,"mat-icon",17),d(3,"visibility"),a(),d(4," View Order "),a(),x(5,Je,4,0,"button",18),a()),e&2){let t=T(2);s(5),h(t.isOrderCompleted?-1:5)}}function Ue(e,n){if(e&1){let t=N();o(0,"button",20),b("click",function(){k(t);let r=T(2);return w(r.onAddNewOrder())}),o(1,"mat-icon"),d(2,"add"),a(),d(3," Add new order "),a()}}function We(e,n){if(e&1&&(o(0,"mat-card-actions",10),x(1,Ke,6,1,"div",14)(2,Ue,4,0,"button",15),a()),e&2){let t=T();s(),h(t.table().orderId?1:2)}}var Ie=class e{storeStore=_(G);table=z.required();hideActions=z(!1);tableClick=E();addNewOrder=E();completeOrder=E();clearOrder=E();currency=C(()=>this.storeStore.selectedStore()?.currency||"\u20A6");get isOrderCompleted(){return this.table().orderId?.category==="Complete"}onTableClick(){this.tableClick.emit(this.table())}onAddNewOrder(){this.addNewOrder.emit(this.table())}onCompleteOrder(n){n.stopPropagation(),this.completeOrder.emit(this.table())}onClearOrder(n){n.stopPropagation(),this.clearOrder.emit(this.table())}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=F({type:e,selectors:[["app-table-card"]],inputs:{table:[1,"table"],hideActions:[1,"hideActions"]},outputs:{tableClick:"tableClick",addNewOrder:"addNewOrder",completeOrder:"completeOrder",clearOrder:"clearOrder"},decls:15,vars:7,consts:[["menu","matMenu"],["appearance","outlined",1,"relative","cursor-pointer","transition-all","duration-300","hover:shadow-xl","hover:-translate-y-1",3,"click"],[1,"p-4"],[1,"flex","items-center","justify-between","mb-4"],[1,"px-2","py-1","bg-gray-100","text-gray-700","text-xs","font-medium","rounded-full"],[1,"flex","flex-col","items-center","justify-center","py-4"],[1,"!text-sm","mb-3"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-xs","text-gray-600","mt-1"],[1,"text-sm","font-semibold","mt-2",2,"color","var(--mat-sys-primary)"],[1,"mt-4","border-t","border-outline-variant"],["matIconButton","",3,"click","matMenuTriggerFor"],["mat-menu-item",""],["mat-menu-item","",3,"click"],[1,"flex","gap-2","w-full"],["matButton","filled","color","primary",1,"w-full"],["mat-stroked-button","","color","primary",1,"flex-1","w-full"],[1,"mr-2","!text-base"],["mat-flat-button","","color","primary",1,"flex-1","w-full"],["mat-flat-button","","color","primary",1,"flex-1","w-full",3,"click"],["matButton","filled","color","primary",1,"w-full",3,"click"]],template:function(t,l){t&1&&(o(0,"mat-card",1),b("click",function(){return l.onTableClick()}),o(1,"mat-card-content",2)(2,"div",3),x(3,Qe,2,1,"span",4)(4,qe,1,0,"span"),x(5,ze,15,1),a(),o(6,"div",5)(7,"mat-chip",6),d(8),a(),o(9,"h3",7),d(10),a(),o(11,"span",8),d(12),a(),x(13,He,3,6,"span",9),a()(),x(14,We,3,1,"mat-card-actions",10),a()),t&2&&(s(3),h(l.table().category?3:4),s(2),h(l.table().orderId?5:-1),s(3),D(" ",l.table().orderId?"Occupied":"Free"," "),s(2),I(l.table().name),s(2),D("",l.table().numberOfGuest," seats"),s(),h(l.table().orderId?13:-1),s(),h(l.hideActions()?-1:14))},dependencies:[R,ue,ce,pe,se,q,Q,j,$,ae,Ce,be,fe,ge,he,xe,ie],styles:["[_nghost-%COMP%]{display:block}"]})};var Xe=(e,n)=>n.id;function Ye(e,n){if(e&1&&(o(0,"mat-button-toggle",5)(1,"mat-icon"),d(2),a(),o(3,"span"),d(4),a()()),e&2){let t=n.$implicit;O("value",t.id),s(2),I(t.icon),s(2),I(t.name)}}var De=class e{dialogRef=_(Me);data=_(ve);selectedPaymentMethod=K("cash");paymentMethods=[{id:"POS",name:"POS Terminal",icon:"credit_card"},{id:"Transfer",name:"Transfer",icon:"swap_horizontal_circle"},{id:"Cash",name:"Cash",icon:"payments"}];onPaymentMethodChange(n){this.selectedPaymentMethod.set(n)}onConfirmPayment(){let n=this.paymentMethods.find(l=>l.id===this.selectedPaymentMethod()),t={action:"confirm",paymentMethod:n?{name:n.name,id:n.id}:void 0};this.dialogRef.close(t)}onSkipPayment(){let n={action:"skip"};this.dialogRef.close(n)}onCancel(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=F({type:e,selectors:[["app-payment-dialog"]],decls:18,vars:6,consts:[["mat-dialog-title",""],[1,"rounded-lg","p-6","mb-6","text-center"],[1,"text-sm","text-gray-600","mb-2"],[1,"text-3xl","font-bold","text-gray-900"],[3,"change","value"],[3,"value"],["align","end",1,"border-2","border-outline-variant"],["matButton","outlined","color","primary",3,"click"],["matButton","filled","color","primary",3,"click"]],template:function(t,l){t&1&&(o(0,"h2",0),d(1,"Payment"),a(),o(2,"mat-dialog-content")(3,"div",1)(4,"p",2),d(5,"Total Amount:"),a(),o(6,"p",3),d(7),V(8,"number"),a()(),o(9,"div")(10,"mat-button-toggle-group",4),b("change",function(p){return l.onPaymentMethodChange(p.value)}),U(11,Ye,5,3,"mat-button-toggle",5,Xe),a()()(),o(13,"mat-dialog-actions",6)(14,"button",7),b("click",function(){return l.onSkipPayment()}),d(15," Skip Payment "),a(),o(16,"button",8),b("click",function(){return l.onConfirmPayment()}),d(17," Confirm Payment "),a()()),t&2&&(s(7),Z(" ",l.data.currency," ",ee(8,3,l.data.totalAmount,"1.2-2")," "),s(3),O("value",l.selectedPaymentMethod()),s(),W(l.paymentMethods))},dependencies:[R,we,Se,ke,Pe,j,$,q,Q,ye,_e,Te,ne],encapsulation:2})};var Ze={tables:[],selectedTable:null,isLoading:!1,searchQuery:"",searchFilters:null,statusFilter:"all",error:null},At=oe({providedIn:"root"},me(Ze),re(({tables:e,searchQuery:n,searchFilters:t,statusFilter:l})=>({tablesCount:C(()=>e().length),freeTableCount:C(()=>e().filter(r=>!r.orderId).length),totalSeatCount:C(()=>e().reduce((r,p)=>r+p.numberOfGuest,0)),totalFreeSeats:C(()=>e().filter(r=>r.orderId).reduce((r,p)=>r+p.numberOfGuest,0)),occupiedTableCount:C(()=>e().filter(r=>r.orderId).length),filteredTables:C(()=>{let r=n()?.toLowerCase(),p=t(),M=l(),u=e();return r&&r.length>0&&(u=u.filter(g=>g.name?.toLowerCase().includes(r))),p&&(u=u.filter(g=>g.category?._id===p._id)),console.log(M),M==="free"?u=u.filter(g=>!g.orderId):M==="occupied"&&(u=u.filter(g=>g.orderId)),u})})),de((e,n=_(Oe))=>{function t(i){let m=e.tables().find(f=>f._id===i)||null;c(e,{selectedTable:m})}function l(){c(e,{selectedTable:null})}function r(i,m){let f=e.tables().map(y=>y._id===i?B(B({},y),m):y);c(e,{tables:f})}function p(i,m){let f=e.tables().map(y=>y._id===i?J(B({},y),{order:m}):y);c(e,{tables:f})}function M(i,m){n.updateTable(i,m).subscribe({next:f=>{console.log("Table updated on server:",f)},error:f=>{console.error("Failed to update table on server:",f)}})}function u(i){c(e,{searchFilters:i})}function g(i){c(e,{searchQuery:i})}function Ee(i){c(e,{statusFilter:i})}function H(i){c(e,{tables:[...e.tables(),i]})}function Le(i){let m=e.tables().filter(f=>f._id!==i);c(e,{tables:m})}let Ae=A(v(P(()=>c(e,{isLoading:!0,error:null,tables:[]})),S(i=>n.getStoreTables(i).pipe(L({next(m){c(e,{isLoading:!1,error:null,tables:m})},error(m){c(e,{isLoading:!1,error:String(m)})}}))))),Be=A(v(P(()=>c(e,{isLoading:!0,error:null})),S(i=>n.createTable(i.tableParams).pipe(L({next(m){c(e,{isLoading:!1,error:null}),H(m),i?.modalParams&&i.modalParams.closeCallback()},error(m){c(e,{isLoading:!1,error:String(m)})}}))))),Fe=A(v(P(()=>c(e,{isLoading:!0,error:null})),S(i=>n.updateTable(i.tableId,i.tableParams).pipe(L({next(m){c(e,{isLoading:!1,error:null}),r(i.tableId,i.tableParams),i?.modalParams&&i.modalParams.closeCallback()},error(m){c(e,{isLoading:!1,error:String(m)})}}))))),Ne=A(v(P(()=>c(e,{isLoading:!0,error:null})),S(i=>n.deleteTable(i).pipe(L({next(m){c(e,{isLoading:!1,error:null})},error(m){c(e,{isLoading:!1,error:String(m)})}})))));return{selectTable:t,clearSelectedTable:l,updateTable:r,updateTableOrder:p,updateSearchFilter:u,updateSearchQuery:g,updateStatusFilter:Ee,createTable:H,deleteTable:Le,getTables$:Ae,createTable$:Be,updateTable$:Fe,deleteTable$:Ne,updateTableOrderSync:M}}),le({onInit(e){let t=_(G).selectedStore();t?._id&&e.getTables$(t._id)}}));export{Ie as a,De as b,At as c};
