import{a as A,b as ot,c as rt,d as pt}from"./chunk-D54P5HEE.js";import{a as nt,b as at,c as lt,d as mt,g as H}from"./chunk-HDWLNSMT.js";import{a as it}from"./chunk-XISJ3OTQ.js";import"./chunk-MS4AQ6UA.js";import{a as Ae,b as He,c as je,d as Ge,e as Ue,f as Qe,g as ze,h as We,i as Ke,j as Ye,k as Je,l as Xe,m as B,n as tt}from"./chunk-553G7WQ4.js";import{a as Ze,b as et}from"./chunk-UDNOIW3J.js";import{a as O,b as V}from"./chunk-E5GOXSYX.js";import{c as fe}from"./chunk-Q3BO6IZX.js";import{c as N,d as Le,e as Ne,f as Re,j as R,k,l as F,m as q}from"./chunk-JURQBM4X.js";import{a as Te,c as Ie,e as Pe}from"./chunk-2OS3A6OW.js";import{a as I,b as _e}from"./chunk-UHZERJ3B.js";import"./chunk-L3V4XNTA.js";import{a as qe,b as $e,c as Be,d as Oe}from"./chunk-DU2I3CEK.js";import"./chunk-URU65OXG.js";import{c as Ve}from"./chunk-45N66JJF.js";import"./chunk-JMDTRE27.js";import{b as P,d as f,g as L,h as Ee,l as Ce,m as Se,o as be,q as Me,t as ve,u as xe,v as De,w as we}from"./chunk-7VZONRG3.js";import{a as ke,b as Fe}from"./chunk-USY657EX.js";import{M as ge,O as $,i as he,j as w,k as T}from"./chunk-FG3IKYWR.js";import{I as ye}from"./chunk-V6BWQRYA.js";import{i as ue,p as D,v as ce}from"./chunk-2NDSKVKU.js";import{$ as re,Bb as C,Cb as S,Eb as U,Fb as Q,Gb as z,Hb as p,Ib as r,Jb as i,Kb as u,Lb as y,Mb as g,Ob as ae,Sb as _,Tb as x,Xb as W,Y as oe,Yb as K,Za as l,Zb as Y,bc as le,ea as s,gc as a,hc as h,ic as J,jb as v,ka as j,kc as me,la as G,lc as pe,mc as se,pb as d,qc as de,ua as ne}from"./chunk-EV5SF5GC.js";import"./chunk-EQDQRRRY.js";var E=class e{http=s(ce);hostServer=ye.apiUrl;resetPassword(t){return this.http.post(`${this.hostServer}/auth/rest-password?userType=merchant`,t)}verifyCode(t){return this.http.post(`${this.hostServer}/auth/verify-code?userType=merchant`,t)}changePassword(t){return this.http.post(`${this.hostServer}/auth/update-password?userType=merchant`,t)}validateEmailAndPhoneNumber({email:t,phoneNumber:o}){return this.http.post(`${this.hostServer}/auth/validate-email-and-phone?userType=merchant`,{email:t,phoneNumber:o})}createMerchant(t){return this.http.post(`${this.hostServer}/merchants`,t)}getStoreMerchants(t){return this.http.get(`${this.hostServer}/merchants/find-by-store/${t}`)}deleteMerchant(t){return this.http.delete(`${this.hostServer}/merchants/${t}`)}updateMerchant(t,o){return this.http.put(`${this.hostServer}/merchants/${t}`,o)}register(t){return this.http.post(`${this.hostServer}/staffs`,t)}updatePassword(t){return this.http.post(`${this.hostServer}/staffs/update/password`,t)}static \u0275fac=function(o){return new(o||e)};static \u0275prov=re({token:e,factory:e.\u0275fac,providedIn:"root"})};function yt(e,t){e&1&&(r(0,"mat-error"),a(1," Name is required "),i())}function gt(e,t){if(e&1&&(r(0,"mat-option",9),a(1),i()),e&2){let o=t.$implicit;p("value",o),l(),h(o)}}function Et(e,t){e&1&&(r(0,"mat-error"),a(1," Gender is required "),i())}function Ct(e,t){if(e&1&&(r(0,"mat-option",9),a(1),i()),e&2){let o=t.$implicit;p("value",o),l(),h(o)}}function St(e,t){e&1&&(r(0,"mat-error"),a(1," Role is required "),i())}function bt(e,t){e&1&&(r(0,"mat-hint"),a(1,"Role cannot be changed for owners"),i())}function Mt(e,t){e&1&&(r(0,"mat-error"),a(1," Email is required "),i())}function vt(e,t){e&1&&(r(0,"mat-error"),a(1," Please enter a valid email address "),i())}function xt(e,t){e&1&&(r(0,"mat-error"),a(1," Phone number is required "),i())}function Dt(e,t){e&1&&(r(0,"mat-error"),a(1," PIN is required "),i())}function wt(e,t){e&1&&(r(0,"mat-error"),a(1," PIN must be exactly 4 digits "),i())}function Tt(e,t){e&1&&u(0,"mat-spinner",17)}var b=class e{storeStore=s($);fb=s(xe);userService=s(E);snackBar=s(I);dialogRef=s(nt);data=s(at);sessionStorage=s(ge);isSubmitting=ne(!1);roles=["Owner","Cashier","Waiter","Admin","Courier","Kitchen"];genders=["Male","Female"];isEdit=this.data.isEdit;form=this.fb.group({name:["",[f.required]],gender:["",[f.required]],email:["",[f.required,f.email]],phoneNumber:["",[f.required]],pin:["",[f.required,f.minLength(4),f.maxLength(4)]],role:[{value:"",disabled:this.isRoleDisabled()},[f.required]],store:[this.storeStore.selectedStore()?._id,f.required]});isRoleDisabled(){return this.isEdit&&this.data.employee?.role==="Owner"}ngOnInit(){this.isEdit&&this.data.employee&&this.form.patchValue(this.data.employee)}onSubmit(){if(this.form.valid){this.isSubmitting.set(!0);let t=this.form.getRawValue();(this.isEdit?this.userService.updateMerchant(this.data.employee._id,t):this.userService.createMerchant(t)).subscribe({next:n=>{if(n?.err?.code===11e3&&n?.err?.keyPattern){let m="Error creating/updating employee";n.err.keyPattern.email?m="Email already exists":n.err.keyPattern.phoneNumber&&(m="Phone number already exists"),this.snackBar.open(m,"Close",{duration:3e3}),this.isSubmitting.set(!1);return}this.snackBar.open(`Employee ${this.isEdit?"updated":"created"} successfully`,"Close",{duration:3e3}),this.dialogRef.close(!0)},error:n=>{this.snackBar.open(`Error ${this.isEdit?"updating":"creating"} employee`,"Close",{duration:3e3}),this.isSubmitting.set(!1)}})}}onCancel(){this.dialogRef.close()}static \u0275fac=function(o){return new(o||e)};static \u0275cmp=v({type:e,selectors:[["app-employee-dialog"]],decls:50,vars:15,consts:[[1,"p-6"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter employee name"],[4,"ngIf"],[1,"grid","grid-cols-2","gap-4"],["formControlName","gender"],[3,"value"],["formControlName","role"],["matInput","","formControlName","email","type","email","placeholder","Enter email address"],["matInput","","formControlName","phoneNumber","placeholder","Enter phone number"],["matInput","","formControlName","pin","type","password","maxlength","4","placeholder","Enter 4-digit PIN"],[1,"flex","justify-end","space-x-2","mt-6","pt-4","border-t","border-gray-200"],["mat-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",1,"mr-2"]],template:function(o,n){if(o&1&&(r(0,"div",0)(1,"h2",1),a(2),i(),r(3,"form",2),_("ngSubmit",function(){return n.onSubmit()}),r(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),a(7,"Name"),i(),u(8,"input",5),d(9,yt,2,0,"mat-error",6),i(),r(10,"div",7)(11,"mat-form-field",4)(12,"mat-label"),a(13,"Gender"),i(),r(14,"mat-select",8),Q(15,gt,2,2,"mat-option",9,U),i(),d(17,Et,2,0,"mat-error",6),i(),r(18,"mat-form-field",4)(19,"mat-label"),a(20,"Role"),i(),r(21,"mat-select",10),Q(22,Ct,2,2,"mat-option",9,U),i(),d(24,St,2,0,"mat-error",6),C(25,bt,2,0,"mat-hint"),i()(),r(26,"mat-form-field",4)(27,"mat-label"),a(28,"Email"),i(),u(29,"input",11),d(30,Mt,2,0,"mat-error",6)(31,vt,2,0,"mat-error",6),i(),r(32,"div",7)(33,"mat-form-field",4)(34,"mat-label"),a(35,"Phone Number"),i(),u(36,"input",12),d(37,xt,2,0,"mat-error",6),i(),r(38,"mat-form-field",4)(39,"mat-label"),a(40,"PIN"),i(),u(41,"input",13),d(42,Dt,2,0,"mat-error",6)(43,wt,2,0,"mat-error",6),i()()(),r(44,"div",14)(45,"button",15),_("click",function(){return n.onCancel()}),a(46,"Cancel"),i(),r(47,"button",16),C(48,Tt,1,0,"mat-spinner",17),a(49),i()()()()),o&2){let m,c,X,Z,ee,te,ie,M;l(2),J(" ",n.isEdit?"Edit Employee":"Create New Employee"," "),l(),p("formGroup",n.form),l(6),p("ngIf",(m=n.form.get("name"))==null?null:m.hasError("required")),l(6),z(n.genders),l(2),p("ngIf",(c=n.form.get("gender"))==null?null:c.hasError("required")),l(5),z(n.roles),l(2),p("ngIf",(X=n.form.get("role"))==null?null:X.hasError("required")),l(),S(n.isRoleDisabled()?25:-1),l(5),p("ngIf",(Z=n.form.get("email"))==null?null:Z.hasError("required")),l(),p("ngIf",(ee=n.form.get("email"))==null?null:ee.hasError("email")),l(6),p("ngIf",(te=n.form.get("phoneNumber"))==null?null:te.hasError("required")),l(5),p("ngIf",(ie=n.form.get("pin"))==null?null:ie.hasError("required")),l(),p("ngIf",((M=n.form.get("pin"))==null?null:M.hasError("minlength"))||((M=n.form.get("pin"))==null?null:M.hasError("maxlength"))),l(2),p("disabled",n.isSubmitting()),l(2),p("disabled",!n.form.valid||n.isSubmitting()),l(),S(n.isSubmitting()?48:-1),l(),J(" ",n.isEdit?"Update":"Create"," ")}},dependencies:[D,ue,H,mt,T,w,k,R,N,Ne,Le,q,F,et,Ze,fe,we,Se,P,L,Ee,ve,be,Me,V,O],encapsulation:2})};var It=()=>[5,10,25,100];function Pt(e,t){e&1&&(r(0,"div",10),u(1,"mat-spinner",14),i())}function Lt(e,t){e&1&&u(0,"app-no-record",11)}function Nt(e,t){e&1&&u(0,"app-no-record",12)}function Rt(e,t){e&1&&(r(0,"th",28),a(1,"Name"),i())}function kt(e,t){if(e&1&&(r(0,"td",29),a(1),i()),e&2){let o=t.$implicit;l(),h(o.name)}}function Ft(e,t){e&1&&(r(0,"th",28),a(1,"Gender"),i())}function qt(e,t){if(e&1&&(r(0,"td",29),a(1),i()),e&2){let o=t.$implicit;l(),h(o.gender)}}function $t(e,t){e&1&&(r(0,"th",28),a(1,"Email"),i())}function Bt(e,t){if(e&1&&(r(0,"td",29),a(1),i()),e&2){let o=t.$implicit;l(),h(o.email)}}function Ot(e,t){e&1&&(r(0,"th",28),a(1,"Phone"),i())}function Vt(e,t){if(e&1&&(r(0,"td",29),a(1),i()),e&2){let o=t.$implicit;l(),h(o.phoneNumber)}}function At(e,t){e&1&&(r(0,"th",28),a(1,"Role"),i())}function Ht(e,t){if(e&1&&(r(0,"td",29),a(1),i()),e&2){let o=t.$implicit;l(),h(o.role)}}function jt(e,t){e&1&&(r(0,"th",30),a(1,"Actions"),i())}function Gt(e,t){if(e&1){let o=ae();r(0,"td",29)(1,"button",31)(2,"mat-icon"),a(3,"more_vert"),i()(),r(4,"mat-menu",null,0)(6,"button",32),_("click",function(){let m=j(o).$implicit,c=x(2);return G(c.editEmployee(m))}),r(7,"mat-icon"),a(8,"edit"),i(),r(9,"span"),a(10,"Edit"),i()(),r(11,"button",32),_("click",function(){let m=j(o).$implicit,c=x(2);return G(c.deleteEmployee(m))}),r(12,"mat-icon"),a(13,"delete"),i(),r(14,"span"),a(15,"Delete"),i()()()()}if(e&2){let o=le(5);l(),p("matMenuTriggerFor",o)}}function Ut(e,t){e&1&&u(0,"tr",33)}function Qt(e,t){e&1&&u(0,"tr",34)}function zt(e,t){if(e&1&&(r(0,"div",13)(1,"table",15),y(2,16),d(3,Rt,2,0,"th",17)(4,kt,2,1,"td",18),g(),y(5,19),d(6,Ft,2,0,"th",17)(7,qt,2,1,"td",18),g(),y(8,20),d(9,$t,2,0,"th",17)(10,Bt,2,1,"td",18),g(),y(11,21),d(12,Ot,2,0,"th",17)(13,Vt,2,1,"td",18),g(),y(14,22),d(15,At,2,0,"th",17)(16,Ht,2,1,"td",18),g(),y(17,23),d(18,jt,2,0,"th",24)(19,Gt,16,1,"td",18),g(),d(20,Ut,1,0,"tr",25)(21,Qt,1,0,"tr",26),i(),u(22,"mat-paginator",27),i()),e&2){let o=x();l(),p("dataSource",o.dataSource),l(19),p("matHeaderRowDef",o.displayedColumns),l(),p("matRowDefColumns",o.displayedColumns),l(),p("pageSizeOptions",de(4,It))}}var dt=class e{dialog=s(lt);snackBar=s(I);userService=s(E);storeStore=s($);displayedColumns=["name","gender","email","phoneNumber","role","actions"];dataSource;searchText="";paginator;sort;employees=Ve({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:t})=>this.userService.getStoreMerchants(t.storeId).pipe(oe(o=>{this.dataSource=new Xe(o),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}))});applyFilter(t){let o=t.target.value;this.dataSource.filter=o.trim().toLowerCase()}openDialog(){this.dialog.open(b,{width:"800px",data:{isEdit:!1}}).afterClosed().subscribe(o=>{o&&this.employees.reload()})}editEmployee(t){this.dialog.open(b,{width:"800px",data:{isEdit:!0,employee:t}}).afterClosed().subscribe(n=>{n&&this.employees.reload()})}deleteEmployee(t){if(t.role==="Owner"){this.snackBar.open("Cannot delete an owner","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"});return}this.dialog.open(pt,{width:"350px",data:{message:`Are you sure you want to delete ${t.name}?`}}).afterClosed().subscribe(n=>{n&&this.userService.deleteMerchant(t._id).subscribe({next:()=>{this.snackBar.open("Employee deleted successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.employees.reload()},error:()=>{this.snackBar.open("Error deleting employee","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})})}static \u0275fac=function(o){return new(o||e)};static \u0275cmp=v({type:e,selectors:[["app-list-employees"]],viewQuery:function(o,n){if(o&1&&(W(B,5),W(A,5)),o&2){let m;K(m=Y())&&(n.paginator=m.first),K(m=Y())&&(n.sort=m.first)}},decls:19,vars:2,consts:[["menu","matMenu"],[1,"employees-container","!bg-white"],[1,"!bg-white"],[1,"flex","flex-col","md:flex-row","justify-between","gap-4","p-4"],[1,"flex","flex-col","sm:flex-row","gap-4","flex-grow"],["appearance","outline",1,"w-full","sm:w-48","md:w-72","lg:w-96"],["matPrefix",""],["matInput","","placeholder","Search employees",3,"keyup","ngModelChange","ngModel"],[1,"flex","gap-3","justify-end"],["mat-raised-button","","color","primary",3,"click"],[1,"flex","items-center","justify-center","min-h-[300px]"],["icon","people","title","No Employees","message","No employees found matching your criteria."],["icon","error","title","Error","message","An error occurred while fetching employees. Please try again later."],[1,"table-container","!bg-white"],["diameter","40"],["mat-table","","matSort","",1,"!bg-white",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","gender"],["matColumnDef","email"],["matColumnDef","phoneNumber"],["matColumnDef","role"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of employees",1,"!bg-white",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","aria-label","Employee actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(o,n){o&1&&(r(0,"mat-card",1)(1,"mat-card-content",2)(2,"div",3)(3,"div",4)(4,"mat-form-field",5)(5,"mat-label"),a(6,"Search"),i(),r(7,"mat-icon",6),a(8,"search"),i(),r(9,"input",7),_("keyup",function(c){return n.applyFilter(c)}),se("ngModelChange",function(c){return pe(n.searchText,c)||(n.searchText=c),c}),i()()(),r(10,"div",8)(11,"button",9),_("click",function(){return n.openDialog()}),r(12,"mat-icon"),a(13,"add"),i(),a(14," ADD EMPLOYEE "),i()()(),C(15,Pt,2,0,"div",10)(16,Lt,1,0,"app-no-record",11)(17,Nt,1,0,"app-no-record",12)(18,zt,23,5,"div",13),i()()),o&2&&(l(9),me("ngModel",n.searchText),l(6),S(n.employees.isLoading()?15:n.employees.hasValue()&&n.dataSource.data.length===0?16:n.employees.error()?17:n.employees.hasValue()?18:-1))},dependencies:[D,Je,Ae,je,ze,Ge,He,We,Ue,Qe,Ke,Ye,tt,B,rt,A,ot,Pe,Te,Ie,k,R,N,Re,q,F,T,w,he,Fe,ke,Oe,$e,qe,Be,V,O,it,H,_e,De,P,L,Ce],encapsulation:2})};export{dt as EmployeeListComponent};
