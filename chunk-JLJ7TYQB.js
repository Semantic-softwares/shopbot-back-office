import{a as Vt}from"./chunk-IN25C6KR.js";import{a as $t}from"./chunk-P5XCBOGO.js";import{a as Rt}from"./chunk-E4DU7SZS.js";import{a as E,b as It,c as kt}from"./chunk-VL5A6MKX.js";import{a as Ht,b as Bt}from"./chunk-BTXZK3DD.js";import{a as Dt}from"./chunk-Q2TL7UZ2.js";import"./chunk-MS4AQ6UA.js";import{a as b,b as Et}from"./chunk-A233OVEX.js";import{a as y,b as _t,c as ft,d as Ct,e as gt,f as ht,g as St,h as Pt,i as xt,j as Mt,k as vt}from"./chunk-BWWYPHKT.js";import{a as yt,b as bt}from"./chunk-YVYCFWPM.js";import"./chunk-3RK6DDJD.js";import{a as wt,b as Tt}from"./chunk-LIUA42FM.js";import"./chunk-JQGESV5S.js";import{d as U}from"./chunk-XQNDMVIO.js";import{b as nt,c as ot,d as rt}from"./chunk-3632TDEK.js";import{a as W}from"./chunk-I24LUS2H.js";import{c as pt}from"./chunk-H55FNLX4.js";import{a as ct,c as dt,d as st,e as ut}from"./chunk-5XJCC6NP.js";import"./chunk-LPJWQZ4I.js";import"./chunk-EEQKDLYL.js";import{d as I}from"./chunk-NGGCDKIH.js";import"./chunk-JTD73F4Y.js";import{a as tt,d as et,h as it}from"./chunk-JGZ2V5AL.js";import"./chunk-CXVWFC6J.js";import"./chunk-JTLCVARK.js";import{a as X,c as Y,g as Z}from"./chunk-HA7VDR7W.js";import{a as at,b as lt}from"./chunk-7C3RSL2D.js";import"./chunk-OHZSVTBE.js";import"./chunk-VIOSJ367.js";import"./chunk-TEL7Y7UN.js";import{o as G,p as J,q as K}from"./chunk-FSA22CPB.js";import{b as mt}from"./chunk-TS4O77IX.js";import"./chunk-M2YK6UF7.js";import"./chunk-BVQK7CK4.js";import"./chunk-AGZJ637K.js";import{c as O}from"./chunk-7EKHSXIM.js";import"./chunk-TQDHD3WD.js";import{s as A,t as N}from"./chunk-DWCYWQVU.js";import{$b as v,Cc as q,Db as $,Eb as V,Ec as j,Fb as H,Hb as B,Ib as F,Jb as p,Kb as n,Lb as o,Mb as _,Mc as z,Nb as s,Ob as u,Qb as T,Ub as C,Vb as h,Xa as k,Zb as x,_a as m,_b as M,dc as L,fa as f,ic as r,jc as g,kb as R,kc as D,la as S,ma as P,qb as c,va as w,wc as Q}from"./chunk-5AECHVKR.js";import"./chunk-EQDQRRRY.js";var Lt=()=>[5,10,25,100];function Qt(t,e){if(t&1&&(n(0,"mat-option",8),r(1),o()),t&2){let i=e.$implicit;p("value",i._id),m(),D(" ",i.name," ")}}function qt(t,e){t&1&&(n(0,"div",14),_(1,"mat-spinner",18),o())}function jt(t,e){t&1&&_(0,"app-no-record",15)}function zt(t,e){t&1&&(n(0,"th",37),r(1,"Photo"),o())}function At(t,e){if(t&1&&(n(0,"td",38),_(1,"img",39),o()),t&2){let i=e.$implicit;m(),p("src",i.photos==null?null:i.photos[0],k)}}function Nt(t,e){t&1&&(n(0,"th",40),r(1,"Item name"),o())}function Ot(t,e){if(t&1&&(n(0,"td",41),r(1),o()),t&2){let i=e.$implicit;m(),g(i.name)}}function Ut(t,e){t&1&&(n(0,"th",40),r(1,"Category"),o())}function Gt(t,e){if(t&1&&(n(0,"td",38),r(1),o()),t&2){let i=e.$implicit;m(),g(i==null||i.menu==null?null:i.menu.name)}}function Jt(t,e){t&1&&(n(0,"th",40),r(1,"Price"),o())}function Kt(t,e){if(t&1&&(n(0,"td",38)(1,"span",42),r(2),q(3,"currency"),o()()),t&2){let i,a=e.$implicit,l=h(2);m(2),D(" ",j(3,1,a.price,(i=l.storeStore.selectedStore())==null?null:i.currency)," ")}}function Wt(t,e){t&1&&(n(0,"th",40),r(1,"Cost Price"),o())}function Xt(t,e){if(t&1&&(n(0,"td",38),r(1),o()),t&2){let i=e.$implicit;m(),g(i.costPrice)}}function Yt(t,e){t&1&&(n(0,"th",40),r(1,"Initial Stock"),o())}function Zt(t,e){if(t&1&&(n(0,"td",38),r(1),o()),t&2){let i=e.$implicit;m(),g(i.initialStock||0)}}function te(t,e){t&1&&(n(0,"th",40),r(1,"Critical Level"),o())}function ee(t,e){if(t&1&&(n(0,"td",38),r(1),o()),t&2){let i=e.$implicit;m(),g(i.criticalStockLevel||0)}}function ie(t,e){t&1&&(n(0,"th",40),r(1,"Quantity"),o())}function ne(t,e){if(t&1&&(n(0,"td",38),r(1),o()),t&2){let i=e.$implicit;m(),g(i.qty||0)}}function oe(t,e){t&1&&(n(0,"th",37),r(1,"Status"),o())}function re(t,e){if(t&1){let i=T();n(0,"td",38)(1,"mat-slide-toggle",43),C("change",function(){let l=S(i).$implicit,d=h(2);return P(d.toggleProductStatus(l))}),o()()}if(t&2){let i=e.$implicit;m(),p("checked",i.active)}}function ae(t,e){t&1&&(n(0,"th",37),r(1,"Actions"),o())}function le(t,e){if(t&1){let i=T();n(0,"td",38)(1,"button",44)(2,"mat-icon"),r(3,"more_vert"),o()(),n(4,"mat-menu",null,0)(6,"button",45),C("click",function(){let l=S(i).$implicit,d=h(2);return P(d.onEditProduct(l._id))}),n(7,"mat-icon"),r(8,"edit"),o(),n(9,"span"),r(10,"Edit"),o()(),n(11,"button",45),C("click",function(){let l=S(i).$implicit,d=h(2);return P(d.deleteProduct(l))}),n(12,"mat-icon"),r(13,"delete"),o(),n(14,"span"),r(15,"Delete"),o()()()()}if(t&2){let i=L(5);m(),p("matMenuTriggerFor",i)}}function me(t,e){t&1&&_(0,"tr",46)}function ce(t,e){t&1&&_(0,"tr",47)}function de(t,e){if(t&1&&(n(0,"div",16)(1,"table",19),s(2,20),c(3,zt,2,0,"th",21)(4,At,2,1,"td",22),u(),s(5,23),c(6,Nt,2,0,"th",24)(7,Ot,2,1,"td",25),u(),s(8,26),c(9,Ut,2,0,"th",24)(10,Gt,2,1,"td",22),u(),s(11,27),c(12,Jt,2,0,"th",24)(13,Kt,4,4,"td",22),u(),s(14,28),c(15,Wt,2,0,"th",24)(16,Xt,2,1,"td",22),u(),s(17,29),c(18,Yt,2,0,"th",24)(19,Zt,2,1,"td",22),u(),s(20,30),c(21,te,2,0,"th",24)(22,ee,2,1,"td",22),u(),s(23,31),c(24,ie,2,0,"th",24)(25,ne,2,1,"td",22),u(),s(26,32),c(27,oe,2,0,"th",21)(28,re,2,1,"td",22),u(),s(29,33),c(30,ae,2,0,"th",21)(31,le,16,1,"td",22),u(),c(32,me,1,0,"tr",34)(33,ce,1,0,"tr",35),o(),_(34,"mat-paginator",36),o()),t&2){let i=h();m(),p("dataSource",i.filteredProducts()),m(31),p("matHeaderRowDef",i.displayedColumns),m(),p("matRowDefColumns",i.displayedColumns),m(),p("pageSizeOptions",Q(4,Lt))}}function se(t,e){t&1&&_(0,"app-no-record",17)}var Ft=class t{productService=f($t);categoryService=f(Vt);storeStore=f(mt);router=f(O);dialog=f(pt);snackBar=f(W);searchTerm=w("");selectedCategory=w("all");displayedColumns=["photo","name","category","price","cost","initialStock","criticalStockLevel","qty","active","actions"];dataSource=I({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.productService.getStoreProducts(e.storeId)});categories=I({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.categoryService.getStoreMenus(e.storeId)});filteredProducts=z(()=>{let e=this.searchTerm().toLowerCase(),i=this.selectedCategory();return this.dataSource.value()?.filter(a=>{let l=a.name.toLowerCase().includes(e),d=i==="all"||a?.menu?._id===i;return l&&d})??[]});paginator;sort;table;onSearch(e){let i=e.target;this.searchTerm.set(i.value)}onCategoryChange(e){this.selectedCategory.set(e)}addItem(){this.router.navigate(["/dashboard/items/create-product"])}editProduct(e){console.log("Edit product:",e)}onEditProduct(e){this.router.navigate(["/dashboard/items/edit-product",e])}deleteProduct(e){this.dialog.open(Rt,{width:"400px",data:{message:`Are you sure you want to delete ${e.name}?`}}).afterClosed().subscribe(a=>{a&&this.productService.deleteProduct(e._id).subscribe({next:()=>{console.log("Product deleted successfully"),this.dataSource.reload()},error:l=>{console.error("Error deleting product:",l)}})})}toggleProductStatus(e){let i={active:!e.active};this.productService.saveProduct(i,e._id).subscribe({next:()=>{this.snackBar.open("Product status updated successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})},error:()=>{this.snackBar.open("Error updating product status","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=R({type:t,selectors:[["app-products"]],viewQuery:function(i,a){if(i&1&&(x(b,5),x(E,5),x(y,5)),i&2){let l;M(l=v())&&(a.paginator=l.first),M(l=v())&&(a.sort=l.first),M(l=v())&&(a.table=l.first)}},decls:27,vars:1,consts:[["menu","matMenu"],[1,"products-container","!bg-white","!rounded-xl","!shadow-lg","border","border-gray-100"],[1,"!bg-white"],[1,"flex","flex-col","md:flex-row","justify-between","gap-4","p-4","border-b"],[1,"flex","flex-col","sm:flex-row","gap-4","flex-grow"],["appearance","outline",1,"w-full","sm:w-48"],[3,"selectionChange"],["value","all"],[3,"value"],["appearance","outline",1,"w-full","sm:w-48","md:w-72","lg:w-96"],["matPrefix",""],["matInput","","placeholder","Search items",3,"input"],[1,"flex","gap-3","justify-end"],["mat-raised-button","","color","primary",3,"click"],[1,"flex","items-center","justify-center","min-h-[300px]"],["icon","inventory_2","title","No Products","message","No products found matching your criteria."],[1,"table-container","rounded-lg","overflow-x-auto","mt-4"],["icon","error","title","Error","message","An error occurred while fetching the data. Please try again later."],["diameter","40"],["mat-table","","matSort","",1,"!bg-white","min-w-full","rounded-lg",3,"dataSource"],["matColumnDef","photo"],["mat-header-cell","","class","bg-gray-50",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","","class","bg-gray-50",4,"matHeaderCellDef"],["mat-cell","","class","font-semibold",4,"matCellDef"],["matColumnDef","category"],["matColumnDef","price"],["matColumnDef","cost"],["matColumnDef","initialStock"],["matColumnDef","criticalStockLevel"],["matColumnDef","qty"],["matColumnDef","active"],["matColumnDef","actions"],["mat-header-row","","class","bg-gray-50",4,"matHeaderRowDef"],["mat-row","","class","hover:bg-gray-50 transition",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of products",1,"!bg-white",3,"pageSizeOptions"],["mat-header-cell","",1,"bg-gray-50"],["mat-cell",""],["alt","product",1,"w-10","h-10","object-cover","rounded-full","border","shadow",3,"src"],["mat-header-cell","","mat-sort-header","",1,"bg-gray-50"],["mat-cell","",1,"font-semibold"],[1,"font-semibold","text-primary"],["color","primary",3,"change","checked"],["mat-icon-button","","aria-label","Product actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-header-row","",1,"bg-gray-50"],["mat-row","",1,"hover:bg-gray-50","transition"]],template:function(i,a){i&1&&(n(0,"mat-card",1)(1,"mat-card-content",2)(2,"div",3)(3,"div",4)(4,"mat-form-field",5)(5,"mat-label"),r(6,"Category"),o(),n(7,"mat-select",6),C("selectionChange",function(d){return a.onCategoryChange(d.value)}),n(8,"mat-option",7),r(9,"All Categories"),o(),B(10,Qt,2,2,"mat-option",8,H),o()(),n(12,"mat-form-field",9)(13,"mat-label"),r(14,"Search"),o(),n(15,"mat-icon",10),r(16,"search"),o(),n(17,"input",11),C("input",function(d){return a.onSearch(d)}),o()()(),n(18,"div",12)(19,"button",13),C("click",function(){return a.addItem()}),n(20,"mat-icon"),r(21,"add"),o(),r(22," ADD ITEM "),o()()(),$(23,qt,2,0,"div",14)(24,jt,1,0,"app-no-record",15)(25,de,35,5,"div",16)(26,se,1,0,"app-no-record",17),o()()),i&2&&(m(10),F(a.categories.value()),m(13),V(a.dataSource.isLoading()?23:a.dataSource.hasValue()&&a.filteredProducts().length===0?24:a.dataSource.hasValue()?25:a.dataSource.error()?26:-1))},dependencies:[N,A,vt,y,ft,St,Ct,_t,Pt,gt,ht,xt,Mt,Et,b,kt,E,It,nt,it,tt,et,rt,ot,bt,yt,U,K,J,G,Z,X,Y,ut,dt,ct,st,lt,at,Tt,wt,Bt,Ht,Dt],encapsulation:2})};export{Ft as ProductsComponent};
