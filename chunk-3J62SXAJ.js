import{a as ge}from"./chunk-YJQXVE5X.js";import{f as de}from"./chunk-LQE4FJGA.js";import{a as pe,b as ue}from"./chunk-U7ARI6ZS.js";import"./chunk-EIZRJIIE.js";import{i as D}from"./chunk-U4YSNMIZ.js";import{a as me,b as ce}from"./chunk-3IQG3KHZ.js";import{d as B}from"./chunk-YK4A772F.js";import"./chunk-HXICWX3M.js";import"./chunk-4YIJHWNC.js";import"./chunk-MMNFDWV7.js";import{a as V}from"./chunk-CGDRKYIW.js";import{b as oe,c as ae,d as le}from"./chunk-IS37LNAK.js";import{a as ie,e as ne,h as re}from"./chunk-QJ2P7YZL.js";import"./chunk-LXD47U2C.js";import{b as se}from"./chunk-ZG44B3L4.js";import{B as te,b as U,d as m,g as R,h as $,m as W,n as J,s as K,t as X,u as Y,v as Z,z as ee}from"./chunk-SZWYIW32.js";import"./chunk-CTT4BYCX.js";import{a as N}from"./chunk-V7ZBVJLR.js";import"./chunk-NQRUH5DO.js";import{a as Q,b as q,c as A,f as j,g as G,h as H}from"./chunk-MESJBQC5.js";import"./chunk-QEF3JOQ3.js";import"./chunk-LSROOOYO.js";import"./chunk-7NDZPDVA.js";import{b as L,c as O}from"./chunk-OWLRGWNJ.js";import{$ as z,Z as I}from"./chunk-OS2CYUJN.js";import"./chunk-U2P6GFP5.js";import{$a as s,Gb as T,Hb as F,Kb as b,Lb as _,Mb as h,Nb as t,Ob as e,Pb as g,Wb as y,_b as c,ac as d,ea as S,ja as p,ka as u,kc as w,ob as k,pc as i,qc as C,rc as P,va as x}from"./chunk-IQSYHSID.js";import{a as E,b as M,f}from"./chunk-EQDQRRRY.js";var fe=(l,r)=>r.value;function xe(l,r){if(l&1){let n=y();t(0,"div",6)(1,"div",32)(2,"mat-icon",33),i(3,"check_circle"),e()(),t(4,"h4",34),i(5,"Printer Connected"),e(),t(6,"p",35),i(7),e(),t(8,"div",36)(9,"button",37),c("click",function(){p(n);let o=d();return u(o.testPrint())}),t(10,"mat-icon",38),i(11,"print"),e(),i(12," Test Print "),e(),t(13,"button",39),c("click",function(){p(n);let o=d();return u(o.testPaperUtilization())}),t(14,"mat-icon",38),i(15,"straighten"),e(),i(16," Test Paper Width "),e(),t(17,"div",40)(18,"input",41,0),c("change",function(o){p(n);let v=d();return u(v.uploadLogo(o))}),e(),t(20,"button",37),c("click",function(){p(n);let o=w(19);return u(o.click())}),t(21,"mat-icon",38),i(22,"image"),e(),i(23," Upload Logo "),e()(),t(24,"button",42),c("click",function(){p(n);let o=d();return u(o.disconnectPrinter())}),t(25,"mat-icon",38),i(26,"bluetooth_disabled"),e(),i(27," Disconnect "),e()()()}if(l&2){let n,a=d();s(7),C((n=a.connectedPrinter())==null?null:n.name)}}function he(l,r){if(l&1){let n=y();t(0,"div",6)(1,"div",43)(2,"mat-icon",44),i(3,"print_disabled"),e()(),t(4,"h4",34),i(5,"No Printer Connected"),e(),t(6,"p",35),i(7,"Connect a Bluetooth printer to enable receipt printing"),e(),t(8,"button",45),c("click",function(){p(n);let o=d();return u(o.connectPrinter())}),i(9),e()()}if(l&2){let n=d();s(8),h("disabled",n.printerConnecting()),s(),P(" ",n.printerConnecting()?"Connecting...":"Connect Printer"," ")}}function ve(l,r){if(l&1&&(t(0,"mat-option",16),i(1),e()),l&2){let n=r.$implicit;h("value",n.value),s(),C(n.label)}}function Ce(l,r){if(l&1&&(t(0,"mat-option",16),i(1),e()),l&2){let n=r.$implicit;h("value",n.value),s(),C(n.label)}}var Se=class l{fb=S(ee);snackBar=S(N);storeService=S(V);printerService=S(ge);storeStore=S(D);loading=x(!1);saving=x(!1);printerConnecting=x(!1);printerConnected=x(!1);connectedPrinter=x(null);printerSettingsForm;paperSizeOptions=[{value:"58mm",label:"58mm (2.3 inches)"},{value:"80mm",label:"80mm (3.1 inches)"},{value:"112mm",label:"112mm (4.4 inches)"}];printQualityOptions=[{value:"draft",label:"Draft (Fast)"},{value:"normal",label:"Normal"},{value:"high",label:"High Quality"}];ngOnInit(){this.initializeForm(),this.loadSettings(),this.checkPrinterStatus()}initializeForm(){this.printerSettingsForm=this.fb.group({paperSize:["80mm",m.required],printQuality:["normal",m.required],autocut:[!0],headerText:[""],footerText:["Thank you for your stay!"],includeLogo:[!0],fontSize:[12,[m.required,m.min(8),m.max(20)]],lineSpacing:[1.2,[m.required,m.min(1),m.max(3)]]})}loadSettings(){this.loading.set(!0);let r=this.storeStore.selectedStore();r?.hotelSettings?.printerConfiguration&&this.printerSettingsForm.patchValue(r.hotelSettings.printerConfiguration),this.loading.set(!1)}checkPrinterStatus(){let r=this.printerService.getConnectedDeviceInfo();r&&(this.connectedPrinter.set(r),this.printerConnected.set(!0))}connectPrinter(){return f(this,null,function*(){this.printerConnecting.set(!0);try{yield this.printerService.connectToPrinter();let r=this.printerService.getConnectedDeviceInfo();r&&(this.connectedPrinter.set(r),this.printerConnected.set(!0),this.snackBar.open("Printer connected successfully!","Close",{duration:3e3}))}catch(r){console.error("Error connecting to printer:",r),this.snackBar.open("Failed to connect to printer.","Close",{duration:5e3})}finally{this.printerConnecting.set(!1)}})}disconnectPrinter(){this.printerService.disconnectPrinter(),this.connectedPrinter.set(null),this.printerConnected.set(!1),this.snackBar.open("Printer disconnected","Close",{duration:3e3})}getCurrentPrinterConfiguration(){let n=this.storeStore.selectedStore()?.hotelSettings?.printerConfiguration;return{paperSize:this.printerSettingsForm.get("paperSize")?.value||n?.paperSize||"80mm",printQuality:this.printerSettingsForm.get("printQuality")?.value||n?.printQuality||"normal",autocut:this.printerSettingsForm.get("autocut")?.value??n?.autocut??!0,headerText:this.printerSettingsForm.get("headerText")?.value||n?.headerText||"",footerText:this.printerSettingsForm.get("footerText")?.value||n?.footerText||"Thank you for your stay!",includeLogo:this.printerSettingsForm.get("includeLogo")?.value??n?.includeLogo??!0,fontSize:this.printerSettingsForm.get("fontSize")?.value||n?.fontSize||12,lineSpacing:this.printerSettingsForm.get("lineSpacing")?.value||n?.lineSpacing||1.2}}testPrint(){return f(this,null,function*(){try{let r=this.getCurrentPrinterConfiguration();yield this.printerService.testPrint(r),this.snackBar.open("Test print sent successfully!","Close",{duration:3e3})}catch(r){console.error("Error during test print:",r),this.snackBar.open("Test print failed.","Close",{duration:5e3})}})}testPaperUtilization(){return f(this,null,function*(){try{let r=this.getCurrentPrinterConfiguration();yield this.printerService.testPaperUtilization(r),this.snackBar.open("Paper utilization test sent!","Close",{duration:3e3})}catch(r){console.error("Error during paper utilization test:",r),this.snackBar.open("Paper utilization test failed.","Close",{duration:5e3})}})}uploadLogo(r){return f(this,null,function*(){let n=r.target;if(n.files&&n.files[0]){let a=n.files[0];try{let o=new FileReader;o.onload=v=>f(this,null,function*(){v.target?.result&&(yield this.printerService.uploadLogo(v.target.result),this.snackBar.open("Logo uploaded successfully!","Close",{duration:3e3}))}),o.readAsArrayBuffer(a)}catch(o){console.error("Error uploading logo:",o),this.snackBar.open("Failed to upload logo.","Close",{duration:5e3})}}})}savePrinterSettings(){if(this.printerSettingsForm.valid&&this.storeStore.selectedStore()){this.saving.set(!0);let r=this.storeStore.selectedStore(),n=this.printerSettingsForm.value,a={hotelSettings:M(E({},r.hotelSettings),{printerConfiguration:n})};this.storeService.updateStore(r._id,a).subscribe({next:()=>{this.storeService.getStore(r._id).subscribe({next:o=>{this.storeStore.updateStore(o),this.storeService.saveStoreLocally(o),this.saving.set(!1),this.snackBar.open("Printer settings saved successfully!","Close",{duration:3e3})},error:o=>{console.error("Error fetching updated store:",o),this.saving.set(!1),this.snackBar.open("Settings saved but failed to update local data.","Close",{duration:5e3})}})},error:o=>{console.error("Error saving printer settings:",o),this.saving.set(!1),this.snackBar.open("Failed to save printer settings.","Close",{duration:5e3})}})}}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=k({type:l,selectors:[["app-printer-settings"]],decls:88,vars:4,consts:[["logoInput",""],[1,"py-6"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8"],["appearance","outlined"],["mat-card-avatar","",1,"text-green-600","!flex","!items-center","!justify-center"],[1,"pt-4"],[1,"text-center","py-4"],[1,"mt-6","p-4","bg-blue-50","border","border-blue-200","rounded-lg"],[1,"font-semibold","text-blue-900","mb-2","flex","items-center","gap-2"],[1,"text-blue-600"],[1,"text-sm","text-blue-800","space-y-1"],["mat-card-avatar","",1,"text-purple-600","!flex","!items-center","!justify-center"],[3,"ngSubmit","formGroup"],[1,"space-y-6"],["appearance","outline",1,"w-full"],["formControlName","paperSize"],[3,"value"],["matSuffix",""],["formControlName","printQuality"],[1,"grid","grid-cols-2","gap-4"],["appearance","outline"],["matInput","","type","number","formControlName","fontSize","min","8","max","20"],["matInput","","type","number","formControlName","lineSpacing","min","1","max","3","step","0.1"],["matInput","","formControlName","headerText","placeholder","Welcome to our hotel"],["matInput","","formControlName","footerText","placeholder","Thank you for your stay!"],[1,"space-y-4"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-gray-700"],[1,"text-xs","text-gray-500"],["formControlName","autocut","color","primary"],["formControlName","includeLogo","color","primary"],["type","submit","matButton","filled","color","primary",1,"w-full",3,"disabled"],[1,"w-16","h-16","bg-green-100","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],[1,"text-4xl","text-green-600"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600","mb-4"],[1,"flex","flex-col","gap-3"],["mat-stroked-button","","color","primary",1,"w-full",3,"click"],[1,"mr-2"],["mat-stroked-button","","color","accent",1,"w-full",3,"click"],[1,"w-full"],["type","file","accept","image/*",1,"hidden",3,"change"],["mat-stroked-button","","color","warn",1,"w-full",3,"click"],[1,"w-16","h-16","bg-gray-100","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],[1,"text-4xl","text-gray-400"],["matButton","outlined","color","primary",1,"w-full",3,"click","disabled"]],template:function(n,a){n&1&&(t(0,"div",1)(1,"div",2)(2,"mat-card",3)(3,"mat-card-header")(4,"mat-icon",4),i(5,"bluetooth"),e(),t(6,"mat-card-title"),i(7,"Printer Connection"),e()(),t(8,"mat-card-content",5),T(9,xe,28,1,"div",6)(10,he,10,2,"div",6),t(11,"div",7)(12,"h5",8)(13,"mat-icon",9),i(14,"info"),e(),i(15," Printer Requirements "),e(),t(16,"ul",10)(17,"li"),i(18,"\u2022 ESC/POS compatible Bluetooth printer"),e(),t(19,"li"),i(20,"\u2022 Chrome browser (version 56+)"),e(),t(21,"li"),i(22,"\u2022 HTTPS connection required"),e(),t(23,"li"),i(24,"\u2022 Supported brands: EPSON, Star, Citizen, Bixolon"),e()()()()(),t(25,"mat-card",3)(26,"mat-card-header")(27,"mat-icon",11),i(28,"tune"),e(),t(29,"mat-card-title"),i(30,"Print Configuration"),e()(),t(31,"mat-card-content",5)(32,"form",12),c("ngSubmit",function(){return a.savePrinterSettings()}),t(33,"div",13)(34,"mat-form-field",14)(35,"mat-label"),i(36,"Paper Size"),e(),t(37,"mat-select",15),b(38,ve,2,2,"mat-option",16,fe),e(),t(40,"mat-icon",17),i(41,"straighten"),e()(),t(42,"mat-form-field",14)(43,"mat-label"),i(44,"Print Quality"),e(),t(45,"mat-select",18),b(46,Ce,2,2,"mat-option",16,fe),e(),t(48,"mat-icon",17),i(49,"high_quality"),e()(),t(50,"div",19)(51,"mat-form-field",20)(52,"mat-label"),i(53,"Font Size"),e(),g(54,"input",21),t(55,"span",17),i(56,"px"),e()(),t(57,"mat-form-field",20)(58,"mat-label"),i(59,"Line Spacing"),e(),g(60,"input",22),t(61,"span",17),i(62,"x"),e()()(),t(63,"mat-form-field",14)(64,"mat-label"),i(65,"Header Text (Optional)"),e(),g(66,"input",23),e(),t(67,"mat-form-field",14)(68,"mat-label"),i(69,"Footer Text"),e(),g(70,"input",24),e(),t(71,"div",25)(72,"div",26)(73,"div")(74,"label",27),i(75,"Auto Cut Paper"),e(),t(76,"p",28),i(77,"Automatically cut paper after printing"),e()(),g(78,"mat-slide-toggle",29),e(),t(79,"div",26)(80,"div")(81,"label",27),i(82,"Include Logo"),e(),t(83,"p",28),i(84,"Print hotel logo on receipts"),e()(),g(85,"mat-slide-toggle",30),e()(),t(86,"button",31),i(87),e()()()()()()()),n&2&&(s(9),F(a.printerConnected()?9:10),s(23),h("formGroup",a.printerSettingsForm),s(6),_(a.paperSizeOptions),s(8),_(a.printQualityOptions),s(40),h("disabled",a.printerSettingsForm.invalid||a.saving()),s(),P(" ",a.saving()?"Saving...":"Save Printer Settings"," "))},dependencies:[te,W,U,J,R,$,Z,Y,X,K,H,Q,G,A,j,q,z,I,O,L,oe,re,ie,ne,le,ae,ce,me,B,ue,pe,se,de],styles:["[_nghost-%COMP%]{display:block}"]})};export{Se as PrinterSettings};
