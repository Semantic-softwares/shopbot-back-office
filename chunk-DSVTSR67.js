import{a as Ae,b as $e,c as Ge}from"./chunk-ELEDOZ6W.js";import{a as Ue}from"./chunk-5UWICUNS.js";import"./chunk-HJ3IDALV.js";import"./chunk-24SFQJLQ.js";import{c as Be}from"./chunk-VL5A6MKX.js";import{a as Fe,b as De,c as Te,h as Ie}from"./chunk-DOHPGGLS.js";import"./chunk-MS4AQ6UA.js";import{a as Ne,b as Ve}from"./chunk-A233OVEX.js";import{k as Ee}from"./chunk-BWWYPHKT.js";import{a as Me,b as Pe}from"./chunk-YVYCFWPM.js";import"./chunk-3RK6DDJD.js";import{a as Oe,b as Le}from"./chunk-LIUA42FM.js";import"./chunk-JQGESV5S.js";import"./chunk-IX32NZKS.js";import{d as Z}from"./chunk-XQNDMVIO.js";import{c as ue,d as pe}from"./chunk-3632TDEK.js";import{a as Q}from"./chunk-I24LUS2H.js";import"./chunk-F5X5MWHG.js";import{c as we}from"./chunk-DSRTAZMJ.js";import{c as Re}from"./chunk-H55FNLX4.js";import{a as fe,b as _e}from"./chunk-H476YUNT.js";import{a as xe,b as be,c as Ce,d as Se,e as ye}from"./chunk-5XJCC6NP.js";import{b as ke}from"./chunk-LPJWQZ4I.js";import"./chunk-EEQKDLYL.js";import"./chunk-JTD73F4Y.js";import{a as le,d as de,e as ce,h as me}from"./chunk-JGZ2V5AL.js";import{B as oe,D as ae,b as X,g as ee,h as te,m as ie,p as ne,s as re}from"./chunk-CXVWFC6J.js";import"./chunk-JTLCVARK.js";import{g as se}from"./chunk-HA7VDR7W.js";import{a as ge,b as he}from"./chunk-7C3RSL2D.js";import"./chunk-OHZSVTBE.js";import"./chunk-VIOSJ367.js";import"./chunk-TEL7Y7UN.js";import{p as J,q as K}from"./chunk-FSA22CPB.js";import{b as ve}from"./chunk-TS4O77IX.js";import"./chunk-M2YK6UF7.js";import"./chunk-BVQK7CK4.js";import"./chunk-AGZJ637K.js";import{a as H,c as Y}from"./chunk-7EKHSXIM.js";import"./chunk-TQDHD3WD.js";import{i as G,o as j,p as z,q as W,t as q}from"./chunk-DWCYWQVU.js";import{Cc as w,Db as v,Dc as A,Eb as f,Ec as D,G as N,Hb as I,Ib as M,Jb as x,Kb as r,L as V,Lb as o,Mb as k,Mc as E,Nc as $,Qb as C,Ub as p,Vb as c,_a as s,dc as T,ec as P,fa as y,ic as a,jc as S,kb as O,kc as _,la as m,lc as F,ma as u,qb as L,va as h,wc as B,xc as U}from"./chunk-5AECHVKR.js";import{f as R}from"./chunk-EQDQRRRY.js";var We=()=>[5,10,25,50,100],qe=l=>({reservation:l}),ze=(l,e)=>e.value,He=(l,e)=>e._id;function Ye(l,e){if(l&1&&(r(0,"mat-option",37)(1,"span",57),k(2,"span",58),a(3),o()()),l&2){let t=e.$implicit;x("value",t.value),s(2),x("ngClass","bg-"+t.color+"-500 ring-"+t.color+"-200"),s(),_(" ",t.label," ")}}function Ze(l,e){l&1&&(r(0,"div",52),k(1,"mat-spinner",59),r(2,"span",60),a(3,"Loading reservations..."),o()())}function Je(l,e){if(l&1){let t=C();r(0,"div",53)(1,"div",61)(2,"mat-icon",62),a(3,"error"),o(),r(4,"div")(5,"h3",63),a(6,"Error loading reservations"),o(),r(7,"p",64),a(8),o(),r(9,"div",65)(10,"button",66),p("click",function(){m(t);let n=c();return u(n.refreshReservations())}),r(11,"mat-icon",67),a(12,"refresh"),o(),a(13," Retry "),o(),r(14,"button",68),p("click",function(){m(t);let n=c();return u(n.clearError())}),a(15,"Dismiss"),o()()()()()}if(l&2){let t=c();s(8),S(t.error())}}function Ke(l,e){if(l&1){let t=C();r(0,"div",69)(1,"div",70)(2,"mat-icon",71),a(3,"hotel"),o()(),r(4,"h3",72),a(5,"No reservations found"),o(),r(6,"p",73),a(7),o(),r(8,"button",74),p("click",function(){m(t);let n=c(2);return u(n.createReservation())}),r(9,"mat-icon",49),a(10,"add"),o(),a(11," Create New Reservation "),o()()}if(l&2){let t,i=c(2);s(7),_(" ",(t=i.filterForm.get("search"))!=null&&t.value||(t=i.filterForm.get("status"))!=null&&t.value?"Try adjusting your filters or search terms to find matching reservations.":"Get started by creating your first reservation to begin managing your hotel bookings."," ")}}function Qe(l,e){l&1&&(r(0,"mat-icon",100),a(1,"refresh"),o())}function Xe(l,e){if(l&1&&k(0,"span",113),l&2){let t=c().$implicit,i=c(3);P("background-color",i.getStatusColorHex(t.status))}}function et(l,e){l&1&&(r(0,"mat-icon",102),a(1,"expand_more"),o())}function tt(l,e){if(l&1){let t=C();r(0,"button",114),p("click",function(){m(t);let n=c().$implicit,d=c(3);return u(d.editReservation(n))}),r(1,"mat-icon",115),a(2,"edit"),o(),r(3,"span"),a(4,"Edit"),o()()}}function it(l,e){if(l&1){let t=C();k(0,"mat-divider",116),r(1,"button",117),p("click",function(){m(t);let n=c().$implicit,d=c(3);return u(d.deleteReservation(n))}),r(2,"mat-icon",118),a(3,"delete"),o(),r(4,"span"),a(5,"Delete Reservation"),o()()}}function nt(l,e){if(l&1){let t=C();r(0,"tr",85),p("click",function(){let n=m(t).$implicit,d=c(3);return u(d.viewReservation(n))}),r(1,"td",86)(2,"div",87),p("click",function(n){let d=m(t).$implicit,g=c(3);return n.stopPropagation(),u(g.viewReservation(d))}),a(3),o()(),r(4,"td",86)(5,"div",57)(6,"div",88)(7,"div",89)(8,"span"),a(9),o()()(),r(10,"div",90)(11,"div",91),a(12),o(),r(13,"div",8),a(14),o(),r(15,"div",92),a(16),o()()()(),r(17,"td",86)(18,"div",93)(19,"mat-icon",94),a(20,"hotel"),o(),r(21,"div")(22,"div",95),a(23),o(),r(24,"div",8),a(25),o()()()(),r(26,"td",86)(27,"div",93)(28,"mat-icon",96),a(29,"login"),o(),r(30,"div")(31,"div",95),a(32),w(33,"date"),o(),r(34,"div",8),a(35),o()()()(),r(36,"td",86)(37,"div",93)(38,"mat-icon",97),a(39,"logout"),o(),r(40,"div")(41,"div",95),a(42),w(43,"date"),o(),r(44,"div",8),a(45),o()()()(),r(46,"td",86)(47,"div",98)(48,"button",99),p("click",function(n){return m(t),u(n.stopPropagation())}),v(49,Qe,2,0,"mat-icon",100)(50,Xe,1,2,"span",101),a(51),w(52,"titlecase"),v(53,et,2,0,"mat-icon",102),o()()(),r(54,"td",86)(55,"div",103),a(56),w(57,"number"),o(),r(58,"div",8),a(59),o(),r(60,"div",104),a(61),w(62,"number"),o()(),r(63,"td",105)(64,"div",106)(65,"div",107)(66,"button",108),p("click",function(n){return m(t),u(n.stopPropagation())}),r(67,"mat-icon",49),a(68,"more_vert"),o()(),r(69,"mat-menu",109,3)(71,"button",110),p("click",function(){let n=m(t).$implicit,d=c(3);return u(d.viewReservation(n))}),r(72,"mat-icon",111),a(73,"visibility"),o(),r(74,"span"),a(75,"View Details"),o()(),v(76,tt,5,0,"button",112),v(77,it,6,0),o()()()()()}if(l&2){let t=e.$implicit,i=T(70),n=c(3),d=T(146);s(3),_(" ",t.confirmationNumber," "),s(6),S(n.getGuestName(t).charAt(0).toUpperCase()||"G"),s(3),_(" ",n.getGuestName(t)," "),s(2),_(" ",t.guestDetails.primaryGuest.email||"No email"," "),s(2),_(" ",t.guestDetails.primaryGuest.phone||"No phone"," "),s(7),_(" ",n.getRoomNumbers(t)," "),s(2),F(" ",t.rooms.length," room",t.rooms.length!==1?"s":""," "),s(7),_(" ",D(33,35,t.checkInDate,"MMM dd, yyyy")," "),s(3),_(" ",t.expectedCheckInTime||"15:00"," "),s(7),_(" ",D(43,38,t.checkOutDate,"MMM dd, yyyy")," "),s(3),_(" ",t.expectedCheckOutTime||"11:00"," "),s(3),P("background-color",n.getStatusColorHex(t.status)+"20")("color",n.getStatusColorHex(t.status))("border-color",n.getStatusColorHex(t.status)+"40")("focus:ring-color",n.getStatusColorHex(t.status)+"60"),x("matMenuTriggerFor",d)("matMenuTriggerData",U(49,qe,t))("disabled",n.isStatusUpdating(t._id)),s(),f(n.isStatusUpdating(t._id)?49:50),s(2),_(" ",A(52,41,t.status)," "),s(2),f(!n.isStatusUpdating(t._id)&&n.getAvailableStatusOptions(t).length>0?53:-1),s(3),F(" ",n.currency,"",D(57,43,t.pricing.total,"1.2-2")," "),s(3),F(" ",t.numberOfNights," night",t.numberOfNights!==1?"s":""," "),s(2),F(" ",n.currency,"",D(62,46,(t.pricing.total||0)/(t.numberOfNights||1),"1.2-2"),"/night "),s(5),x("matMenuTriggerFor",i),s(10),f(n.canEdit(t)?76:-1),s(),f(n.canDelete(t)?77:-1)}}function rt(l,e){if(l&1){let t=C();r(0,"div",69)(1,"div",70)(2,"mat-icon",71),a(3,"hotel"),o()(),r(4,"h3",72),a(5,"No reservations found"),o(),r(6,"p",73),a(7,"Try adjusting your filters or create a new reservation."),o(),r(8,"button",74),p("click",function(){m(t);let n=c(3);return u(n.createReservation())}),r(9,"mat-icon",49),a(10,"add"),o(),a(11," New Reservation "),o()()}}function ot(l,e){if(l&1){let t=C();r(0,"div",75)(1,"div",76)(2,"table",77)(3,"thead",78)(4,"tr")(5,"th",79),a(6," Confirmation # "),o(),r(7,"th",79),a(8," Guest Information "),o(),r(9,"th",79),a(10," Room Details "),o(),r(11,"th",79),a(12," Check-in "),o(),r(13,"th",79),a(14," Check-out "),o(),r(15,"th",79),a(16," Status "),o(),r(17,"th",79),a(18," Total Amount "),o(),r(19,"th",80),a(20," Actions "),o()()(),r(21,"tbody",81),I(22,nt,78,51,"tr",82,He),o()()(),v(24,rt,12,0,"div",69),o(),r(25,"div",83)(26,"mat-paginator",84),p("page",function(n){m(t);let d=c(2);return u(d.onPageChange(n))}),o()()}if(l&2){let t=c(2);s(22),M(t.reservations()),s(2),f(t.reservations().length===0&&!t.loading()?24:-1),s(2),x("length",t.totalReservations())("pageSize",t.pageSize())("pageSizeOptions",B(5,We))("pageIndex",t.currentPage()-1)}}function at(l,e){if(l&1&&(r(0,"div",54),v(1,Ke,12,1,"div",69),v(2,ot,27,6),o()),l&2){let t=c();s(),f(!t.loading()&&t.reservations().length===0?1:-1),s(),f(!t.loading()&&t.reservations().length>0?2:-1)}}function st(l,e){l&1&&(r(0,"div",120),a(1," No status changes available "),o())}function lt(l,e){if(l&1){let t=C();r(0,"button",124),p("click",function(){let n=m(t).$implicit,d=c().reservation,g=c();return u(g.updateReservationStatus(d,n.value))}),r(1,"mat-icon",125),a(2),o(),r(3,"span"),a(4),o()()}if(l&2){let t=e.$implicit;s(),P("color",t.color),s(),S(t.icon),s(2),S(t.label)}}function dt(l,e){l&1&&(r(0,"div",122),a(1," \u{1F4A1} Confirm reservation before check-in "),o())}function ct(l,e){l&1&&(r(0,"div",123),a(1," \u{1F4A1} Ready for check-in "),o())}function mt(l,e){if(l&1&&(r(0,"div",119),a(1," Change Status "),o(),v(2,st,2,0,"div",120),I(3,lt,5,4,"button",121,ze),v(5,dt,2,0,"div",122),v(6,ct,2,0,"div",123)),l&2){let t=e.reservation,i=c();s(2),f(i.getAvailableStatusOptions(t).length===0?2:-1),s(),M(i.getAvailableStatusOptions(t)),s(2),f(t.status==="pending"?5:-1),s(),f(t.status==="confirmed"?6:-1)}}var je=class l{router=y(Y);route=y(H);fb=y(oe);reservationService=y(Ue);storeStore=y(ve);snackBar=y(Q);dialog=y(Re);reservations=h([]);loading=h(!1);error=h(null);currentPage=h(1);pageSize=h(10);totalReservations=h(0);statusUpdating=h(new Set);searchFilter=h("");statusFilter=h("");dateFromFilter=h(null);dateToFilter=h(null);sortByFilter=h("createdAt");sortOrderFilter=h("desc");filterForm=this.fb.group({search:[""],status:[""],dateFrom:[null],dateTo:[null],sortBy:["createdAt"],sortOrder:["desc"]});confirmedCount=E(()=>this.reservations().filter(e=>e.status==="confirmed").length);checkedInCount=E(()=>this.reservations().filter(e=>e.status==="checked_in").length);pendingCount=E(()=>this.reservations().filter(e=>e.status==="pending").length);cancelledCount=E(()=>this.reservations().filter(e=>e.status==="cancelled").length);totalRevenue=E(()=>this.reservations().reduce((e,t)=>e+(t.pricing?.total||0),0));filterParams=E(()=>{let t={storeId:this.storeStore.selectedStore()?._id,page:this.currentPage(),limit:this.pageSize(),sortBy:this.sortByFilter(),sortOrder:this.sortOrderFilter()};return this.searchFilter()&&this.searchFilter().trim()&&(t.search=this.searchFilter().trim()),this.statusFilter()&&this.statusFilter().trim()&&(t.status=this.statusFilter().trim()),this.dateFromFilter()&&(t.dateFrom=new Date(this.dateFromFilter()).toISOString().split("T")[0]),this.dateToFilter()&&(t.dateTo=new Date(this.dateToFilter()).toISOString().split("T")[0]),t});displayedColumns=["confirmationNumber","guest","rooms","checkIn","checkOut","status","total","actions"];statusOptions=[{value:"",label:"All Statuses",color:"gray"},{value:"pending",label:"Pending",color:"orange"},{value:"confirmed",label:"Confirmed",color:"blue"},{value:"checked_in",label:"Checked In",color:"green"},{value:"checked_out",label:"Checked Out",color:"purple"},{value:"cancelled",label:"Cancelled",color:"red"},{value:"no_show",label:"No Show",color:"gray"}];constructor(){$(()=>{let e=this.filterParams();if(console.log("Filter params changed, loading reservations:",e),!e.storeId){console.log("No store selected, skipping load");return}this.loadReservationsInternal()}),this.filterForm.valueChanges.pipe(N(300),V()).subscribe(e=>{console.log("Form values changed:",e),this.currentPage.set(1),this.searchFilter.set(e.search||""),this.statusFilter.set(e.status||""),this.dateFromFilter.set(e.dateFrom||null),this.dateToFilter.set(e.dateTo||null),this.sortByFilter.set(e.sortBy||"createdAt"),this.sortOrderFilter.set(e.sortOrder||"desc")})}loadReservationsInternal(){this.loading.set(!0),this.error.set(null);let e=this.filterParams();console.log("Loading reservations with params:",e),this.reservationService.getReservations(e).subscribe({next:t=>{console.log("Reservations response:",t),this.reservations.set(t.reservations),this.totalReservations.set(t.total),this.loading.set(!1)},error:t=>{console.error("Error loading reservations:",t),this.error.set(t.message||"Failed to load reservations"),this.loading.set(!1),this.reservations.set([]),this.totalReservations.set(0)}})}loadReservations(){this.loadReservationsInternal()}onPageChange(e){this.currentPage.set(e.pageIndex+1),this.pageSize.set(e.pageSize),this.loadReservations()}clearFilters(){this.filterForm.reset({search:"",status:"",dateFrom:null,dateTo:null,sortBy:"createdAt",sortOrder:"desc"}),this.searchFilter.set(""),this.statusFilter.set(""),this.dateFromFilter.set(null),this.dateToFilter.set(null),this.sortByFilter.set("createdAt"),this.sortOrderFilter.set("desc"),this.currentPage.set(1)}refreshReservations(){this.loadReservations()}getStatusColor(e){return this.statusOptions.find(i=>i.value===e)?.color||"gray"}getGuestName(e){return typeof e.guest=="string"?e.guestDetails.primaryGuest.firstName+" "+e.guestDetails.primaryGuest.lastName:e.guest.firstName+" "+e.guest.lastName}getRoomNumbers(e){return e.rooms.map(t=>typeof t.room=="string"?t.room:t.room.roomNumber).join(", ")}get currency(){return this.storeStore.selectedStore()?.currencyCode||this.storeStore.selectedStore()?.currency||"$"}createReservation(){this.router.navigate(["../create"],{relativeTo:this.route})}viewReservation(e){this.router.navigate(["../details",e._id],{relativeTo:this.route})}editReservation(e){this.router.navigate(["../edit",e._id],{relativeTo:this.route})}checkInReservation(e){e.status==="confirmed"&&this.reservationService.checkInReservation(e._id).subscribe({next:()=>{this.refreshReservations()},error:t=>{console.error("Error checking in reservation:",t)}})}checkOutReservation(e){e.status==="checked_in"&&this.reservationService.checkOutReservation(e._id).subscribe({next:()=>{this.refreshReservations()},error:t=>{console.error("Error checking out reservation:",t)}})}cancelReservation(e){let t=prompt("Please provide a reason for cancellation:");t&&this.reservationService.cancelReservation(e._id,t).subscribe({next:()=>{this.refreshReservations()},error:i=>{console.error("Error cancelling reservation:",i)}})}canCheckIn(e){return e.status==="confirmed"&&new Date(e.checkInDate)<=new Date}canCheckOut(e){return e.status==="checked_in"}canCancel(e){return["pending","confirmed"].includes(e.status)}canEdit(e){return e.status!=="cancelled"&&e.status!=="checked_out"&&e.status!=="no_show"&&e.status!=="checked_in"&&!e.actualCheckInDate}canDelete(e){return["pending","cancelled","no_show"].includes(e.status)}deleteReservation(e){let t=this.storeStore.selectedStore();if(!t?._id){this.snackBar.open("No store selected","Close",{duration:3e3});return}let i={storeId:t._id,actionDescription:`delete reservation ${e.confirmationNumber}`,reservationId:e._id};this.dialog.open(Ge,{data:i,width:"500px",maxWidth:"90vw",disableClose:!0}).afterClosed().subscribe(d=>{d?.authorized&&d.pin&&this.performReservationDeletion(e,d.pin)})}performReservationDeletion(e,t){let i=new Set(this.statusUpdating());i.add(e._id),this.statusUpdating.set(i),this.reservationService.deleteReservationWithPin(e._id,t).subscribe({next:n=>{let g=this.reservations().filter(b=>b._id!==e._id);this.reservations.set(g),this.totalReservations.set(this.totalReservations()-1),this.snackBar.open(`Reservation ${e.confirmationNumber} deleted successfully`,"Close",{duration:5e3})},error:n=>{console.error("Error deleting reservation:",n),this.snackBar.open(n.message||"Failed to delete reservation","Close",{duration:5e3,panelClass:["error-snackbar"]})},complete:()=>{let n=new Set(this.statusUpdating());n.delete(e._id),this.statusUpdating.set(n)}})}allStatusOptions=[{value:"pending",label:"Pending",icon:"schedule",color:"#f59e0b"},{value:"confirmed",label:"Confirmed",icon:"check_circle",color:"#10b981"},{value:"checked_in",label:"Checked In",icon:"login",color:"#3b82f6"},{value:"checked_out",label:"Checked Out",icon:"logout",color:"#6b7280"},{value:"cancelled",label:"Cancelled",icon:"cancel",color:"#ef4444"},{value:"no_show",label:"No Show",icon:"person_off",color:"#f97316"}];isValidStatusTransition(e,t){return{pending:["confirmed","cancelled","no_show"],confirmed:["checked_in","cancelled","no_show"],checked_in:["checked_out"],checked_out:[],cancelled:[],no_show:[]}[e]?.includes(t)||!1}getStatusTransitionError(e,t){switch(t){case"checked_in":return'Guests can only be checked in when reservation status is "Confirmed"';case"checked_out":return'Guests can only be checked out when reservation status is "Checked In"';case"confirmed":return e==="checked_in"?"Cannot change back to confirmed after check-in":e==="checked_out"?"Cannot change back to confirmed after check-out":"Invalid status transition";default:return`Cannot change status from "${e}" to "${t}"`}}getAvailableStatusOptions(e){let t=e.status;return this.allStatusOptions.filter(i=>i.value!==t&&this.isValidStatusTransition(t,i.value))}updateReservationStatus(e,t){return R(this,null,function*(){if(e.status!==t){if(t==="checked_in"){this.showCheckInDialog(e);return}if(t==="checked_out"){yield this.performCheckOut(e);return}if(!this.isValidStatusTransition(e.status,t)){this.snackBar.open(this.getStatusTransitionError(e.status,t),"Close",{duration:5e3,panelClass:["error-snackbar"]});return}(t==="cancelled"||t==="no_show")&&!confirm(`Are you sure you want to change the status to ${t}?`)||(yield this.performStatusUpdate(e,t))}})}showCheckInDialog(e){let t={reservation:e};this.dialog.open(Ae,{data:t,width:"600px",maxWidth:"90vw",disableClose:!0}).afterClosed().subscribe(n=>{n?.confirmed&&this.performCheckIn(e,n)})}performCheckIn(e,t){return R(this,null,function*(){let i=new Set(this.statusUpdating());i.add(e._id),this.statusUpdating.set(i);try{let n=yield this.reservationService.checkInReservationWithRooms(e._id).toPromise();if(n){let g=this.reservations().map(b=>b._id===e._id?n:b);this.reservations.set(g),this.snackBar.open("Guest checked in successfully! Room status updated to occupied.","Close",{duration:5e3})}}catch(n){console.error("Error during check-in:",n);let d=n instanceof Error?n.message:"Failed to check in guest";this.snackBar.open(d,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{let n=new Set(this.statusUpdating());n.delete(e._id),this.statusUpdating.set(n)}})}performCheckOut(e){return R(this,null,function*(){if(this.requiresPaymentBeforeCheckout(e)){this.showPaymentRequiredDialog(e);return}let t=new Set(this.statusUpdating());t.add(e._id),this.statusUpdating.set(t);try{let i=yield this.reservationService.checkOutReservationWithRooms(e._id).toPromise();if(i){let d=this.reservations().map(g=>g._id===e._id?i:g);this.reservations.set(d),this.snackBar.open("Guest checked out successfully! Room status updated to cleaning.","Close",{duration:5e3})}}catch(i){console.error("Error during check-out:",i);let n=i instanceof Error?i.message:"Failed to check out guest";this.snackBar.open(n,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{let i=new Set(this.statusUpdating());i.delete(e._id),this.statusUpdating.set(i)}})}requiresPaymentBeforeCheckout(e){let t=e.pricing.balance>0,i=e.paymentInfo?.status!=="paid";return t&&i}showPaymentRequiredDialog(e){let t={reservation:e,isCheckoutFlow:!0};this.dialog.open($e,{data:t,width:"600px",maxWidth:"90vw",disableClose:!0}).afterClosed().subscribe(n=>{n?.confirmed&&n.paymentData&&this.processPaymentAndCheckout(e,n.paymentData)})}processPaymentAndCheckout(e,t){return R(this,null,function*(){let i=new Set(this.statusUpdating());i.add(e._id),this.statusUpdating.set(i);try{yield this.reservationService.processPayment(e._id,{amount:t.amount,method:t.method,reference:t.reference||`PAY-${Date.now()}`}).toPromise();let n=yield this.reservationService.getReservationById(e._id).toPromise();if(n){let g=this.reservations().map(b=>b._id===e._id?n:b);this.reservations.set(g),this.snackBar.open(`Payment of ${this.formatCurrency(t.amount)} recorded successfully`,"Close",{duration:3e3}),n.pricing.balance<=0||n.paymentInfo?.status==="paid"?setTimeout(()=>{this.proceedWithCheckout(n)},1500):this.snackBar.open("Payment recorded, but outstanding balance remains. Please complete payment before checkout.","Close",{duration:5e3,panelClass:["warning-snackbar"]})}}catch(n){console.error("Error processing payment for checkout:",n);let d=n instanceof Error?n.message:"Failed to process payment";this.snackBar.open(d,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{let n=new Set(this.statusUpdating());n.delete(e._id),this.statusUpdating.set(n)}})}proceedWithCheckout(e){return R(this,null,function*(){let t=new Set(this.statusUpdating());t.add(e._id),this.statusUpdating.set(t);try{let i=yield this.reservationService.checkOutReservationWithRooms(e._id).toPromise();if(i){let d=this.reservations().map(g=>g._id===e._id?i:g);this.reservations.set(d),this.snackBar.open("Guest checked out successfully! Room status updated to cleaning.","Close",{duration:5e3})}}catch(i){console.error("Error during checkout after payment:",i);let n=i instanceof Error?i.message:"Failed to complete checkout";this.snackBar.open(n,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{let i=new Set(this.statusUpdating());i.delete(e._id),this.statusUpdating.set(i)}})}formatCurrency(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:this.storeStore.selectedStore()?.currencyCode||"USD"}).format(e)}performStatusUpdate(e,t){return R(this,null,function*(){let i=new Set(this.statusUpdating());i.add(e._id),this.statusUpdating.set(i);try{let n=yield this.reservationService.updateReservationStatus(e._id,t).toPromise();if(n){let g=this.reservations().map(b=>b._id===e._id?n:b);this.reservations.set(g),this.snackBar.open(`Status updated to ${t}`,"Close",{duration:3e3})}}catch(n){console.error("Error updating reservation status:",n);let d=n instanceof Error?n.message:"Failed to update status";this.snackBar.open(d,"Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{let n=new Set(this.statusUpdating());n.delete(e._id),this.statusUpdating.set(n)}})}isStatusUpdating(e){return this.statusUpdating().has(e)}getStatusColorHex(e){return{pending:"#f59e0b",confirmed:"#10b981",checked_in:"#3b82f6",checked_out:"#6b7280",cancelled:"#ef4444",no_show:"#f97316"}[e]||"#6b7280"}getStatusIcon(e){return{pending:"schedule",confirmed:"check_circle",checked_in:"login",checked_out:"logout",cancelled:"cancel",no_show:"person_off"}[e]||"help"}clearError(){this.error.set(null),this.loadReservations()}exportReservations(){try{let e=this.generateCSV(),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(i.download!==void 0){let n=URL.createObjectURL(t);i.setAttribute("href",n),i.setAttribute("download",this.generateExportFilename()),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),this.snackBar.open("Reservations exported successfully","Close",{duration:3e3})}}catch(e){console.error("Error exporting reservations:",e),this.snackBar.open("Failed to export reservations","Close",{duration:5e3,panelClass:["error-snackbar"]})}}generateCSV(){let t=[["Confirmation Number","Guest Name","Email","Phone","Room Numbers","Check-in Date","Check-out Date","Check-in Time","Check-out Time","Status","Adults","Children","Nights","Subtotal","Taxes","Total","Balance","Payment Status","Created Date","Special Requests/Notes"].join(",")];return this.reservations().forEach(i=>{let n=[this.escapeCsvField(i.confirmationNumber||""),this.escapeCsvField(this.getGuestName(i)),this.escapeCsvField(i.guestDetails?.primaryGuest?.email||""),this.escapeCsvField(i.guestDetails?.primaryGuest?.phone||""),this.escapeCsvField(this.getRoomNumbers(i)),this.formatDateForCSV(i.checkInDate),this.formatDateForCSV(i.checkOutDate),this.escapeCsvField(i.expectedCheckInTime||""),this.escapeCsvField(i.expectedCheckOutTime||""),this.escapeCsvField(i.status||""),i.guestDetails?.totalAdults||0,i.guestDetails?.totalChildren||0,i.numberOfNights||0,i.pricing?.subtotal||0,i.pricing?.taxes||0,i.pricing?.total||0,i.pricing?.balance||0,this.escapeCsvField(i.paymentInfo?.status||"pending"),this.formatDateForCSV(i.createdAt),this.escapeCsvField(i.specialRequests||i.internalNotes||"")];t.push(n.join(","))}),t.join(`
`)}escapeCsvField(e){if(e==null)return"";let t=String(e);return t.includes(",")||t.includes('"')||t.includes(`
`)?`"${t.replace(/"/g,'""')}"`:t}formatDateForCSV(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}):""}generateExportFilename(){let e=new Date,t=e.toISOString().split("T")[0],i=e.toTimeString().split(" ")[0].replace(/:/g,"-"),n=`reservations_${t}_${i}`,d=this.filterForm.value;return d.search&&(n+=`_search-${d.search.replace(/[^a-zA-Z0-9]/g,"")}`),d.status&&(n+=`_${d.status}`),(d.dateFrom||d.dateTo)&&(n+="_filtered"),`${n}.csv`}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=O({type:l,selectors:[["app-reservations-list"]],decls:148,vars:20,consts:[["dateFromPicker",""],["dateToPicker",""],["statusMenu","matMenu"],["actionMenu","matMenu"],[1,"bg-gradient-to-r","from-blue-50","to-indigo-50","border-b","border-blue-100"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"flex","justify-between","items-center","py-6"],[1,"text-3xl","font-bold","text-gray-900","mb-1"],[1,"text-sm","text-gray-600"],["mat-raised-button","","color","primary",1,"!bg-gradient-to-r","!from-blue-600","!to-blue-700","hover:!from-blue-700","hover:!to-blue-800","!text-white","px-6","py-3","rounded-lg","font-medium","transition-all","duration-200","shadow-lg","hover:shadow-xl","transform","hover:scale-105",3,"click"],[1,"mr-2"],[1,"bg-white","shadow-sm","border-b","border-gray-100"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-6"],[1,"grid","grid-cols-2","md:grid-cols-3","lg:grid-cols-6","gap-4"],[1,"bg-gradient-to-br","from-blue-50","to-blue-100","rounded-xl","border","border-blue-200","p-4","shadow-sm","hover:shadow-md","transition-all","duration-200"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","bg-gradient-to-r","from-blue-500","to-blue-600","rounded-full","flex","items-center","justify-center","shadow-lg"],[1,"text-white","text-xl"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-sm","font-medium","text-gray-600"],[1,"bg-gradient-to-br","from-green-50","to-green-100","rounded-xl","border","border-green-200","p-4","shadow-sm","hover:shadow-md","transition-all","duration-200"],[1,"w-12","h-12","bg-gradient-to-r","from-green-500","to-green-600","rounded-full","flex","items-center","justify-center","shadow-lg"],[1,"bg-gradient-to-br","from-purple-50","to-purple-100","rounded-xl","border","border-purple-200","p-4","shadow-sm","hover:shadow-md","transition-all","duration-200"],[1,"w-12","h-12","bg-gradient-to-r","from-purple-500","to-purple-600","rounded-full","flex","items-center","justify-center","shadow-lg"],[1,"bg-gradient-to-br","from-orange-50","to-orange-100","rounded-xl","border","border-orange-200","p-4","shadow-sm","hover:shadow-md","transition-all","duration-200"],[1,"w-12","h-12","bg-gradient-to-r","from-orange-500","to-orange-600","rounded-full","flex","items-center","justify-center","shadow-lg"],[1,"bg-gradient-to-br","from-red-50","to-red-100","rounded-xl","border","border-red-200","p-4","shadow-sm","hover:shadow-md","transition-all","duration-200"],[1,"w-12","h-12","bg-gradient-to-r","from-red-500","to-red-600","rounded-full","flex","items-center","justify-center","shadow-lg"],[1,"bg-gradient-to-br","from-cyan-50","to-cyan-100","rounded-xl","border","border-cyan-200","p-4","shadow-sm","hover:shadow-md","transition-all","duration-200"],[1,"w-12","h-12","bg-gradient-to-r","from-cyan-500","to-cyan-600","rounded-full","flex","items-center","justify-center","shadow-lg"],[3,"formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","xl:grid-cols-6","gap-4","mb-4"],[1,"lg:col-span-2"],["appearance","outline",1,"w-full","[&_.mdc-text-field--outlined]:!bg-gray-50","[&_.mdc-text-field--outlined]:!border-gray-200","hover:[&_.mdc-text-field--outlined]:!border-blue-300","[&_.mdc-text-field--focused_.mdc-text-field--outlined]:!border-blue-500"],["matPrefix","",1,"text-gray-400"],["matInput","","placeholder","Guest name or confirmation #","formControlName","search",1,"!bg-gray-50"],["formControlName","status"],[3,"value"],["matInput","","formControlName","dateFrom",1,"!bg-gray-50",3,"matDatepicker"],["matSuffix","",1,"text-gray-400",3,"for"],["matInput","","formControlName","dateTo",1,"!bg-gray-50",3,"matDatepicker"],["formControlName","sortBy"],["value","createdAt"],["value","checkInDate"],["value","checkOutDate"],["value","total"],["value","guestName"],[1,"flex","items-center","justify-between"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-gray-700","bg-white","border","border-gray-300","rounded-lg","hover:bg-gray-50","hover:border-gray-400","transition-all","duration-200","flex","items-center","gap-2",3,"click"],[1,"text-lg"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-white","bg-green-600","border","border-green-600","rounded-lg","hover:bg-green-700","hover:border-green-700","transition-all","duration-200","flex","items-center","gap-2","disabled:opacity-50","disabled:cursor-not-allowed","disabled:hover:bg-green-600",3,"click","disabled"],[1,"flex","items-center","text-sm","text-gray-600"],[1,"flex","justify-center","items-center","py-12","bg-white"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","m-4"],[1,"py-6"],[1,"!shadow-xl","!border","!border-gray-200","!rounded-lg"],["matMenuContent",""],[1,"flex","items-center"],[1,"w-3","h-3","rounded-full","mr-3","ring-2",3,"ngClass"],["diameter","40",1,"!text-blue-600"],[1,"ml-3","text-gray-600"],[1,"flex"],[1,"text-red-500","mr-2"],[1,"text-red-800","font-medium"],[1,"text-red-700","text-sm","mt-1"],[1,"mt-3","flex","space-x-3"],["mat-button","","color","warn",1,"!text-red-600",3,"click"],[1,"mr-1"],["mat-button","",1,"!text-gray-600",3,"click"],[1,"py-20","bg-gradient-to-br","from-gray-50","to-white","text-center"],[1,"w-16","h-16","bg-gray-200","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],[1,"text-4xl","text-gray-400"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-500","mb-6"],[1,"!bg-gradient-to-r","!from-blue-600","!to-blue-700","hover:!from-blue-700","hover:!to-blue-800","!text-white","px-6","py-3","rounded-lg","font-medium","transition-all","duration-200","shadow-lg","hover:shadow-xl","transform","hover:scale-105","inline-flex","items-center","gap-2",3,"click"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","overflow-hidden","mb-6"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gradient-to-r","from-gray-50","to-gray-100"],[1,"px-6","py-4","text-left","text-xs","font-semibold","text-gray-700","uppercase","tracking-wider","border-b-2","border-gray-200"],[1,"px-6","py-4","text-right","text-xs","font-semibold","text-gray-700","uppercase","tracking-wider","border-b-2","border-gray-200"],[1,"bg-white","divide-y","divide-gray-100"],[1,"hover:bg-gray-50","transition-colors","duration-200","cursor-pointer"],[1,"bg-white","px-4","py-3","border-t","border-gray-200","sm:px-6","rounded-b-lg"],["showFirstLastButtons","",1,"!border-0","!bg-white","[&_.mat-mdc-paginator-range-label]:!text-gray-600",3,"page","length","pageSize","pageSizeOptions","pageIndex"],[1,"hover:bg-gray-50","transition-colors","duration-200","cursor-pointer",3,"click"],[1,"px-6","py-4","whitespace-nowrap","border-b","border-gray-100"],[1,"text-sm","font-bold","text-blue-600","hover:text-blue-800","cursor-pointer","transition-colors","bg-blue-50","px-3","py-1","rounded-full","border","border-blue-200",3,"click"],[1,"flex-shrink-0","h-12","w-12"],[1,"h-12","w-12","rounded-full","bg-gradient-to-br","from-blue-500","to-blue-600","flex","items-center","justify-center","text-white","font-bold","text-lg","shadow-md","ring-2","ring-blue-200"],[1,"ml-4"],[1,"text-sm","font-semibold","text-gray-900"],[1,"text-xs","text-gray-500","font-medium"],[1,"flex","items-center","space-x-2"],[1,"text-purple-600","text-lg"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-green-600","text-lg"],[1,"text-red-600","text-lg"],[1,"relative"],[1,"inline-flex","items-center","px-3","py-2","text-xs","font-bold","rounded-full","shadow-sm","ring-2","hover:opacity-80","transition-all","duration-200","disabled:opacity-50","disabled:cursor-not-allowed","focus:outline-none","focus:ring-2","focus:ring-offset-2",3,"click","matMenuTriggerFor","matMenuTriggerData","disabled"],[1,"w-2","h-2","mr-2","animate-spin","text-xs"],[1,"w-2","h-2","rounded-full","mr-2",3,"background-color"],[1,"ml-1","text-xs","opacity-60"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-xs","text-gray-500"],[1,"px-6","py-4","whitespace-nowrap","text-right","text-sm","font-medium","border-b","border-gray-100"],[1,"flex","items-center","justify-end"],[1,"relative","inline-block","text-left"],["title","More Actions",1,"text-gray-600","hover:text-gray-900","p-2","rounded-lg","hover:bg-gray-100","transition-all","duration-200",3,"click","matMenuTriggerFor"],[1,"[&_.mat-mdc-menu-panel]:!shadow-xl","[&_.mat-mdc-menu-panel]:!border","[&_.mat-mdc-menu-panel]:!border-gray-200","[&_.mat-mdc-menu-panel]:!rounded-lg"],["mat-menu-item","",1,"!text-gray-700","hover:!bg-blue-50","hover:!text-blue-700","!transition-colors",3,"click"],[1,"mr-3","!text-blue-600"],["mat-menu-item","",1,"!text-gray-700","hover:!bg-green-50","hover:!text-green-700","!transition-colors"],[1,"w-2","h-2","rounded-full","mr-2"],["mat-menu-item","",1,"!text-gray-700","hover:!bg-green-50","hover:!text-green-700","!transition-colors",3,"click"],[1,"mr-3","!text-green-600"],[1,"!border-gray-200","my-1"],["mat-menu-item","",1,"!text-gray-700","hover:!bg-red-50","hover:!text-red-700","!transition-colors",3,"click"],[1,"mr-3","!text-red-600"],[1,"px-3","py-2","text-xs","font-medium","text-gray-500","border-b","border-gray-100"],[1,"px-3","py-2","text-xs","text-gray-400","italic"],["mat-menu-item","",1,"!text-gray-700","hover:!bg-gray-50","!transition-colors"],[1,"px-3","py-2","text-xs","text-amber-600","bg-amber-50","border-t","border-amber-100","mt-1"],[1,"px-3","py-2","text-xs","text-blue-600","bg-blue-50","border-t","border-blue-100","mt-1"],["mat-menu-item","",1,"!text-gray-700","hover:!bg-gray-50","!transition-colors",3,"click"],[1,"mr-3","!text-base"]],template:function(t,i){if(t&1){let n=C();r(0,"div",4)(1,"div",5)(2,"div",6)(3,"div")(4,"h1",7),a(5,"Reservations"),o(),r(6,"p",8),a(7,"Manage hotel reservations and guest bookings"),o()(),r(8,"button",9),p("click",function(){return m(n),u(i.createReservation())}),r(9,"mat-icon",10),a(10,"add"),o(),a(11," New Reservation "),o()()()(),r(12,"div",11)(13,"div",12)(14,"div",13)(15,"div",14)(16,"div",15)(17,"div",16)(18,"mat-icon",17),a(19,"hotel"),o()(),r(20,"div")(21,"div",18),a(22),o(),r(23,"div",19),a(24,"Total"),o()()()(),r(25,"div",20)(26,"div",15)(27,"div",21)(28,"mat-icon",17),a(29,"check_circle"),o()(),r(30,"div")(31,"div",18),a(32),o(),r(33,"div",19),a(34,"Confirmed"),o()()()(),r(35,"div",22)(36,"div",15)(37,"div",23)(38,"mat-icon",17),a(39,"person"),o()(),r(40,"div")(41,"div",18),a(42),o(),r(43,"div",19),a(44,"Checked In"),o()()()(),r(45,"div",24)(46,"div",15)(47,"div",25)(48,"mat-icon",17),a(49,"schedule"),o()(),r(50,"div")(51,"div",18),a(52),o(),r(53,"div",19),a(54,"Pending"),o()()()(),r(55,"div",26)(56,"div",15)(57,"div",27)(58,"mat-icon",17),a(59,"cancel"),o()(),r(60,"div")(61,"div",18),a(62),o(),r(63,"div",19),a(64,"Cancelled"),o()()()(),r(65,"div",28)(66,"div",15)(67,"div",29)(68,"mat-icon",17),a(69,"attach_money"),o()(),r(70,"div")(71,"div",18),a(72),w(73,"number"),o(),r(74,"div",19),a(75,"Revenue"),o()()()()()()(),r(76,"div",11)(77,"div",12)(78,"form",30)(79,"div",31)(80,"div",32)(81,"mat-form-field",33)(82,"mat-label"),a(83,"Search reservations..."),o(),r(84,"mat-icon",34),a(85,"search"),o(),k(86,"input",35),o()(),r(87,"div")(88,"mat-form-field",33)(89,"mat-label"),a(90,"Status"),o(),r(91,"mat-select",36),I(92,Ye,4,3,"mat-option",37,ze),o()()(),r(94,"div")(95,"mat-form-field",33)(96,"mat-label"),a(97,"Check-in from"),o(),k(98,"input",38)(99,"mat-datepicker-toggle",39)(100,"mat-datepicker",null,0),o()(),r(102,"div")(103,"mat-form-field",33)(104,"mat-label"),a(105,"Check-in to"),o(),k(106,"input",40)(107,"mat-datepicker-toggle",39)(108,"mat-datepicker",null,1),o()(),r(110,"div")(111,"mat-form-field",33)(112,"mat-label"),a(113,"Sort by"),o(),r(114,"mat-select",41)(115,"mat-option",42),a(116,"Created Date"),o(),r(117,"mat-option",43),a(118,"Check-in Date"),o(),r(119,"mat-option",44),a(120,"Check-out Date"),o(),r(121,"mat-option",45),a(122,"Total Amount"),o(),r(123,"mat-option",46),a(124,"Guest Name"),o()()()()(),r(125,"div",47)(126,"div",15)(127,"button",48),p("click",function(){return m(n),u(i.clearFilters())}),r(128,"mat-icon",49),a(129,"clear"),o(),a(130," Clear Filters "),o(),r(131,"button",48),p("click",function(){return m(n),u(i.refreshReservations())}),r(132,"mat-icon",49),a(133,"refresh"),o(),a(134," Refresh "),o(),r(135,"button",50),p("click",function(){return m(n),u(i.exportReservations())}),r(136,"mat-icon",49),a(137,"download"),o(),a(138," Export CSV "),o()(),r(139,"div",51)(140,"span"),a(141),o()()()()()(),v(142,Ze,4,0,"div",52),v(143,Je,16,1,"div",53),v(144,at,3,2,"div",54),r(145,"mat-menu",55,2),L(147,mt,7,3,"ng-template",56),o()}if(t&2){let n=T(101),d=T(109);s(22),S(i.reservations().length),s(10),S(i.confirmedCount()),s(10),S(i.checkedInCount()),s(10),S(i.pendingCount()),s(10),S(i.cancelledCount()),s(10),F("",i.currency,"",D(73,17,i.totalRevenue(),"1.2-2")),s(6),x("formGroup",i.filterForm),s(14),M(i.statusOptions),s(6),x("matDatepicker",n),s(),x("for",n),s(7),x("matDatepicker",d),s(),x("for",d),s(28),x("disabled",i.reservations().length===0||i.loading()),s(6),_("Showing ",i.reservations().length," reservations"),s(),f(i.loading()?142:-1),s(),f(i.error()&&!i.loading()?143:-1),s(),f(!i.loading()&&!i.error()?144:-1)}},dependencies:[q,G,W,j,z,ae,ie,X,ee,te,ne,re,Ee,Ve,Ne,Be,pe,ue,me,le,de,ce,Pe,Me,Z,K,J,he,ge,we,se,ye,Ce,xe,be,Se,ke,Ie,Fe,De,Te,Le,Oe,_e,fe],encapsulation:2})};export{je as ReservationsListComponent};
