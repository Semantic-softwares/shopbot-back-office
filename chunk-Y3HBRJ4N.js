import{a as ue}from"./chunk-T25PAPY7.js";import{a as Tt}from"./chunk-W6IANKE5.js";import{a as pe,b as ht,c as bt}from"./chunk-WIQQZYJV.js";import{a as Ct}from"./chunk-LK6YOFLR.js";import{h as se}from"./chunk-LLLAI5OH.js";import{a as de,b as gt}from"./chunk-FJFZ7FWG.js";import{a as le,b as ot,c as rt,d as mt,e as lt,f as st,g as ct,h as dt,i as pt,j as ut,k as ft}from"./chunk-XKLFH3FF.js";import{a as _t,b as ce}from"./chunk-46P5YEBT.js";import{a as z}from"./chunk-A2P3GH4G.js";import"./chunk-J7O4JBGR.js";import"./chunk-HFTRPIKU.js";import"./chunk-SDXYS6W7.js";import{d as Oe}from"./chunk-6KQFCX5X.js";import{a as oe,b as re}from"./chunk-KVX2H4A7.js";import{b as ee,c as He,d as te}from"./chunk-GYNGZAKB.js";import{a as Q}from"./chunk-GI4SSOPO.js";import{a as nt,c as at}from"./chunk-DX5KEI4P.js";import{a as Ye,b as Je,c as Ke,e as Ze,f as et,g as tt,h as it}from"./chunk-BTSYCNWJ.js";import{b as qe}from"./chunk-WRXDGLET.js";import"./chunk-QGGN4OMJ.js";import"./chunk-IG3JOGNL.js";import{a as Ge,b as Qe,c as We,d as Xe}from"./chunk-BPPWALS2.js";import"./chunk-JXNS4S7R.js";import{d as me}from"./chunk-2WBLSBPP.js";import"./chunk-XVOW2NM6.js";import{a as ae}from"./chunk-GIZLGNET.js";import"./chunk-NXTZK4C5.js";import{a as K,b as Ae,c as Ue,g as Z}from"./chunk-J3TXHOEY.js";import{a as Ve,b as je,h as ze}from"./chunk-YLKT6R4Z.js";import{C as Y,E as J,b as we,d as P,g as Ie,h as Fe,i as W,m as De,o as X,q as Le,r as $e,s as Be,t as Re,z as Ne}from"./chunk-2UT4NYMV.js";import"./chunk-S2P5547C.js";import{a as ie,b as ne}from"./chunk-J5JAEWDO.js";import"./chunk-AGG277FR.js";import"./chunk-7KULNFHZ.js";import"./chunk-5M2ITBTB.js";import{X as H,Y as q,Z as G}from"./chunk-D3B3XJ53.js";import"./chunk-RDMIWI4X.js";import{a as Pe}from"./chunk-AGZJ637K.js";import"./chunk-VYX7HJYX.js";import{m as Me,n as ke,r as ye,x as F,y as Ee}from"./chunk-FORATDN3.js";import{Bc as ve,Eb as d,Fb as p,Gb as N,Hc as I,Ib as k,Ic as Se,Jb as y,Jc as j,Kb as f,Lb as o,Mb as a,Nb as _,Rb as T,Sb as x,Ub as O,Yb as C,Z as he,Za as s,_b as c,ca as u,cc as A,dc as U,ec as V,ha as v,ia as S,ic as fe,mb as R,mc as be,nc as m,oc as M,pc as h,qc as Te,r as Ce,sb as b,ta as E,zc as xe}from"./chunk-53XJD7JZ.js";import{a as B,b as ge}from"./chunk-EQDQRRRY.js";var w=class i{http=u(Ee);baseUrl=Pe.apiUrl;clockIn(e){let t={staff:e.staff,store:e.store,clockInTime:e.clockInTime,clockOutTime:e.clockOutTime||null,totalHours:0,date:e.date,status:e.status||"clocked-in",notes:e.notes||"",breaks:e.breaks||[],totalBreakTime:0,workingHours:0,approved:!1,approvedBy:null,approvedAt:null};return this.http.post(`${this.baseUrl}/timesheets/clock-in`,t)}clockOut(e){return this.http.post(`${this.baseUrl}/timesheets/clock-out`,{location:e})}startBreak(e,t){return this.http.post(`${this.baseUrl}/timesheets/break/start`,{type:e,notes:t})}endBreak(){return this.http.post(`${this.baseUrl}/timesheets/break/end`,{})}getTimesheetStatus(e,t){return this.http.get(`${this.baseUrl}/timesheets/status/${e}/${t}`)}getMerchantTimesheets(e,t){let n=new F;return t&&Object.keys(t).forEach(r=>{let l=t[r];l!=null&&(l instanceof Date?n=n.set(r,l.toISOString()):n=n.set(r,l.toString()))}),this.http.get(`${this.baseUrl}/timesheets/merchant/${e}`,{params:n})}getStoreTimesheets(e,t){let n=new F;return t&&Object.keys(t).forEach(r=>{let l=t[r];l!=null&&(l instanceof Date?n=n.set(r,l.toISOString()):n=n.set(r,l.toString()))}),this.http.get(`${this.baseUrl}/timesheets/store/${e}`,{params:n}).pipe(Ce(r=>r.data.map(l=>ge(B({},l),{employee:l.staff}))))}getTimesheetSummary(e,t,n){let r=new F;return t&&(r=r.set("startDate",t.toISOString())),n&&(r=r.set("endDate",n.toISOString())),this.http.get(`${this.baseUrl}/timesheets/summary/${e}`,{params:r})}getTimesheetById(e){return this.http.get(`${this.baseUrl}/timesheets/${e}`)}approveTimesheet(e){return this.http.put(`${this.baseUrl}/timesheets/${e}/approve`,{})}updateTimesheet(e,t){return this.http.put(`${this.baseUrl}/timesheets/${e}`,t)}deleteTimesheet(e){return this.http.delete(`${this.baseUrl}/timesheets/${e}`)}exportTimesheets(e,t="csv",n){let r=new F().set("format",t);return n&&Object.keys(n).forEach(l=>{let g=n[l];g!=null&&(g instanceof Date?r=r.set(l,g.toISOString()):r=r.set(l,g.toString()))}),this.http.get(`${this.baseUrl}/timesheets/store/${e}/export`,{params:r,responseType:"blob"})}static \u0275fac=function(t){return new(t||i)};static \u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})};var vt=(i,e)=>e.value,Pt=(i,e)=>e._id;function wt(i,e){if(i&1&&(o(0,"mat-option",18),m(1),a()),i&2){let t=e.$implicit;f("value",t._id),s(),h(" ",t.name," ")}}function It(i,e){i&1&&k(0,wt,2,2,"mat-option",18,Pt),i&2&&y(e)}function Ft(i,e){if(i&1&&(o(0,"mat-error"),m(1),a()),i&2){let t=c();s(),M(t.getFieldError("staff"))}}function Dt(i,e){if(i&1&&(o(0,"mat-error"),m(1),a()),i&2){let t=c();s(),M(t.getFieldError("clockInTime"))}}function Lt(i,e){i&1&&(o(0,"mat-error"),m(1,"Clock-in time must be before clock-out time"),a())}function $t(i,e){i&1&&(o(0,"mat-error"),m(1,"Clock-out time must be after clock-in time"),a())}function Bt(i,e){if(i&1&&(o(0,"mat-option",18),m(1),a()),i&2){let t=e.$implicit;f("value",t.value),s(),M(t.label)}}function Rt(i,e){i&1&&(o(0,"mat-error"),m(1,"Start time must be before end time"),a())}function Nt(i,e){i&1&&(o(0,"mat-error"),m(1,"End time must be after start time"),a())}function At(i,e){if(i&1){let t=O();o(0,"div",15)(1,"div",24)(2,"h5",25),m(3),a(),o(4,"button",26),C("click",function(){let r=v(t).$index,l=c();return S(l.removeBreak(r))}),o(5,"mat-icon"),m(6,"delete"),a()()(),o(7,"div",27)(8,"mat-form-field",5)(9,"mat-label"),m(10,"Break Type"),a(),o(11,"mat-select",28),k(12,Bt,2,2,"mat-option",18,vt),a()(),o(14,"mat-form-field",5)(15,"mat-label"),m(16,"Start Time"),a(),_(17,"input",29),d(18,Rt,2,0,"mat-error"),a(),o(19,"mat-form-field",5)(20,"mat-label"),m(21,"End Time"),a(),_(22,"input",30),d(23,Nt,2,0,"mat-error"),a()(),o(24,"mat-form-field",31)(25,"mat-label"),m(26,"Notes"),a(),_(27,"textarea",32),a()()}if(i&2){let t,n,r=e.$index,l=c();f("formGroupName",r),s(3),h("Break ",r+1),s(9),y(l.breakTypes),s(6),p(l.breaksArray.at(r).hasError("invalidBreakTimeRange")&&((t=l.breaksArray.at(r).get("breakStart"))!=null&&t.touched)?18:-1),s(5),p(l.breaksArray.at(r).hasError("invalidBreakTimeRange")&&((n=l.breaksArray.at(r).get("breakEnd"))!=null&&n.touched)?23:-1)}}function Ut(i,e){i&1&&(o(0,"div",16)(1,"mat-icon",33),m(2,"schedule"),a(),o(3,"p"),m(4,"No breaks added yet"),a()())}function Vt(i,e){if(i&1&&(o(0,"mat-option",18),m(1),a()),i&2){let t=e.$implicit;f("value",t.value),s(),M(t.label)}}function jt(i,e){if(i&1&&(o(0,"mat-error"),m(1),a()),i&2){let t=c();s(),M(t.getFieldError("status"))}}function zt(i,e){i&1&&_(0,"mat-spinner",23)}function Ht(){return i=>{let e=i.get("clockInTime")?.value,t=i.get("clockOutTime")?.value;if(!e||!t)return null;let n=new Date(e),r=new Date(t);return n>=r?{invalidTimeRange:!0}:null}}function qt(){return i=>{let e=i.get("breakStart")?.value,t=i.get("breakEnd")?.value;if(!e||!t)return null;let n=new Date(e),r=new Date(t);return n>=r?{invalidBreakTimeRange:!0}:null}}var D=class i{fb=u(Y);timesheetService=u(w);userService=u(ue);storeStore=u(ae);snackBar=u(Q);dialogRef=u(Ye);data=u(Je);isLoading=E(!1);isEdit=!1;timecardForm;employees=me({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.userService.getStoreMerchants(e.storeId)});breakTypes=[{value:"lunch",label:"Lunch Break"},{value:"short",label:"Short Break"},{value:"other",label:"Other"}];statusOptions=[{value:"clocked-in",label:"Clocked In"},{value:"clocked-out",label:"Clocked Out"},{value:"incomplete",label:"Incomplete"}];ngOnInit(){this.isEdit=this.data?.mode==="edit",this.initForm(),this.isEdit&&this.data.timesheet&&this.populateForm(this.data.timesheet)}initForm(){this.timecardForm=this.fb.group({staff:["",P.required],clockInTime:["",P.required],clockOutTime:[""],breaks:this.fb.array([]),status:["clocked-out",P.required],notes:[""],store:[this.storeStore.selectedStore()?._id]},{validators:Ht()})}formatDateForInput(e){if(!e)return"";let t=new Date(e);if(isNaN(t.getTime()))return"";let n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0"),g=String(t.getHours()).padStart(2,"0"),L=String(t.getMinutes()).padStart(2,"0");return`${n}-${r}-${l}T${g}:${L}`}get breaksArray(){return this.timecardForm.get("breaks")}populateForm(e){this.timecardForm.patchValue({staff:typeof e.employee=="object"?e.employee._id:e.employee,clockInTime:this.formatDateForInput(e.clockInTime),clockOutTime:this.formatDateForInput(e.clockOutTime),status:e.status,notes:e.notes,store:typeof e.store=="object"?e.store._id:e.store}),e.breaks&&e.breaks.length>0&&e.breaks.forEach(t=>{this.addBreak(t)})}addBreak(e){let t=this.fb.group({breakType:[e?.breakType||"short",P.required],breakStart:[e?.breakStart?this.formatDateForInput(e.breakStart):"",P.required],breakEnd:[e?.breakEnd?this.formatDateForInput(e.breakEnd):""],notes:[e?.notes||""]},{validators:qt()});this.breaksArray.push(t)}removeBreak(e){this.breaksArray.removeAt(e)}onSubmit(){if(!this.timecardForm.valid){this.markFormGroupTouched(this.timecardForm);return}this.isLoading.set(!0);let e=this.timecardForm.value;e.breaks&&e.breaks.length>0&&(e.breaks=e.breaks.map(t=>{let n=B({},t);if(n.breakStart&&n.breakEnd){let r=new Date(n.breakStart),l=new Date(n.breakEnd);n.breakDuration=Math.round((l.getTime()-r.getTime())/(1e3*60))}else n.breakDuration=0;return n.breakStart&&(n.breakStart=new Date(n.breakStart).toISOString()),n.breakEnd&&(n.breakEnd=new Date(n.breakEnd).toISOString()),n})),this.isEdit&&this.data.timesheet?this.updateTimecard(e):this.createTimecard(e)}createTimecard(e){let t=this.storeStore.selectedStore()?._id;if(!t){this.snackBar.open("No store selected","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isLoading.set(!1);return}if(!e.staff){this.snackBar.open("Employee selection is required","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isLoading.set(!1);return}let n=e.clockInTime?new Date(e.clockInTime):new Date,r={staff:e.staff,store:t,clockInTime:n.toISOString(),clockOutTime:e.clockOutTime?new Date(e.clockOutTime).toISOString():void 0,date:n.toISOString().split("T")[0],status:e.status||(e.clockOutTime?"clocked-out":"clocked-in"),notes:e.notes||"",breaks:e.breaks||[]};this.timesheetService.clockIn(r).subscribe({next:l=>{this.snackBar.open("Timecard created successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dialogRef.close(l)},error:l=>{console.error("Error creating timecard:",l);let g=l.status===401?"Unauthorized: Please check your permissions.":l.status===400?"Bad request: Invalid data provided.":l.status===409?"Employee already has an active timecard.":"Error creating timecard";this.snackBar.open(g,"Close",{duration:5e3,horizontalPosition:"end",verticalPosition:"top"}),this.isLoading.set(!1)}})}updateTimecard(e){this.timesheetService.updateTimesheet(this.data.timesheet._id,e).subscribe({next:t=>{this.snackBar.open("Timecard updated successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dialogRef.close(t)},error:t=>{console.error("Error updating timecard:",t),this.snackBar.open("Error updating timecard","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isLoading.set(!1)}})}onCancel(){this.dialogRef.close(!1)}markFormGroupTouched(e){e instanceof W?Object.keys(e.controls).forEach(t=>{let n=e.get(t);n&&(n.markAsTouched(),(n instanceof W||n instanceof X)&&this.markFormGroupTouched(n))}):e instanceof X&&e.controls.forEach(t=>{t.markAsTouched(),(t instanceof W||t instanceof X)&&this.markFormGroupTouched(t)})}getFieldError(e){return this.timecardForm.get(e)?.hasError("required")?`${e} is required`:this.timecardForm.hasError("invalidTimeRange")&&(e==="clockInTime"||e==="clockOutTime")?"Clock-in time must be before clock-out time":""}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=R({type:i,selectors:[["app-create-timecard"]],decls:57,vars:14,consts:[[1,"create-timecard-modal"],["mat-dialog-title","",1,"text-xl","font-semibold","text-gray-900","mb-4"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"max-h-[70vh]","overflow-y-auto"],[1,"grid","grid-cols-1","gap-4"],["appearance","outline"],["formControlName","staff",3,"disabled"],[1,"p-4"],[1,"text-base","font-medium","mb-3"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["matInput","","type","datetime-local","formControlName","clockInTime","required",""],["matInput","","type","datetime-local","formControlName","clockOutTime"],[1,"text-base","font-medium","mb-3","flex","items-center","justify-between"],["type","button","mat-raised-button","","color","primary",3,"click"],["formArrayName","breaks",1,"space-y-4"],[1,"border","border-gray-200","rounded-lg","p-4",3,"formGroupName"],[1,"text-center","py-8","text-gray-500"],["formControlName","status"],[3,"value"],["matInput","","formControlName","notes","rows","3"],["align","end",1,"border-t","pt-4","mt-6"],["mat-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",1,"mr-2"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","font-medium"],["type","button","mat-icon-button","","color","warn",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["formControlName","breakType"],["matInput","","type","datetime-local","formControlName","breakStart"],["matInput","","type","datetime-local","formControlName","breakEnd"],["appearance","outline",1,"w-full"],["matInput","","formControlName","notes","rows","2"],[1,"text-gray-400","mb-2"]],template:function(t,n){if(t&1&&(o(0,"div",0)(1,"h2",1),m(2),a(),o(3,"form",2),C("ngSubmit",function(){return n.onSubmit()}),o(4,"mat-dialog-content",3)(5,"div",4)(6,"mat-form-field",5)(7,"mat-label"),m(8,"Employee"),a(),o(9,"mat-select",6),d(10,It,2,0),a(),d(11,Ft,2,1,"mat-error"),a()(),o(12,"mat-card",7)(13,"mat-card-title",8),m(14,"Time Information"),a(),o(15,"div",9)(16,"mat-form-field",5)(17,"mat-label"),m(18,"Clock In Time"),a(),_(19,"input",10),d(20,Dt,2,1,"mat-error"),d(21,Lt,2,0,"mat-error"),a(),o(22,"mat-form-field",5)(23,"mat-label"),m(24,"Clock Out Time"),a(),_(25,"input",11),d(26,$t,2,0,"mat-error"),a()()(),o(27,"mat-card",7)(28,"mat-card-title",12)(29,"span"),m(30,"Breaks"),a(),o(31,"button",13),C("click",function(){return n.addBreak()}),o(32,"mat-icon"),m(33,"add"),a(),m(34," Add Break "),a()(),o(35,"div",14),k(36,At,28,4,"div",15,N),a(),d(38,Ut,5,0,"div",16),a(),o(39,"div",9)(40,"mat-form-field",5)(41,"mat-label"),m(42,"Status"),a(),o(43,"mat-select",17),k(44,Vt,2,2,"mat-option",18,vt),a(),d(46,jt,2,1,"mat-error"),a(),o(47,"mat-form-field",5)(48,"mat-label"),m(49,"Notes"),a(),_(50,"textarea",19),a()()(),o(51,"mat-dialog-actions",20)(52,"button",21),C("click",function(){return n.onCancel()}),m(53," Cancel "),a(),o(54,"button",22),d(55,zt,1,0,"mat-spinner",23),m(56),a()()()()),t&2){let r,l,g,L,_e,$;s(2),h(" ",n.isEdit?"Edit Timecard":"Create New Timecard"," "),s(),f("formGroup",n.timecardForm),s(6),f("disabled",n.isEdit),s(),p((r=n.employees.value())?10:-1,r),s(),p((l=n.timecardForm.get("staff"))!=null&&l.invalid&&((l=n.timecardForm.get("staff"))!=null&&l.touched)?11:-1),s(9),p((g=n.timecardForm.get("clockInTime"))!=null&&g.invalid&&((g=n.timecardForm.get("clockInTime"))!=null&&g.touched)?20:-1),s(),p(n.timecardForm.hasError("invalidTimeRange")&&((L=n.timecardForm.get("clockInTime"))!=null&&L.touched)?21:-1),s(5),p(n.timecardForm.hasError("invalidTimeRange")&&((_e=n.timecardForm.get("clockOutTime"))!=null&&_e.touched)?26:-1),s(10),y(n.breaksArray.controls),s(2),p(n.breaksArray.length===0?38:-1),s(6),y(n.statusOptions),s(2),p(($=n.timecardForm.get("status"))!=null&&$.invalid&&(($=n.timecardForm.get("status"))!=null&&$.touched)?46:-1),s(6),f("disabled",n.isLoading()),s(2),f("disabled",n.timecardForm.invalid||n.isLoading()),s(),p(n.isLoading()?55:-1),s(),h(" ",n.isEdit?"Update":"Create"," Timecard ")}},dependencies:[J,De,we,Ie,Fe,Ne,Re,Be,Le,$e,it,Ze,tt,et,ee,ze,Ve,je,te,He,ce,_t,Oe,G,q,H,se,z,ne,ie,re,oe,Z,K,Ae,qe],styles:[".create-timecard-modal[_ngcontent-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{padding:0 24px}.create-timecard-modal[_ngcontent-%COMP%]   .mat-mdc-dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;margin:0}.create-timecard-modal[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.create-timecard-modal[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#374151;margin-bottom:1rem}.create-timecard-modal[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.create-timecard-modal[_ngcontent-%COMP%]   .break-item[_ngcontent-%COMP%]{border:1px solid #e5e7eb;border-radius:8px;padding:1rem;background-color:#f9fafb}.create-timecard-modal[_ngcontent-%COMP%]   .break-item[_ngcontent-%COMP%]:hover{background-color:#f3f4f6}.create-timecard-modal[_ngcontent-%COMP%]   .break-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:.75rem}.create-timecard-modal[_ngcontent-%COMP%]   .break-header[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#374151}.create-timecard-modal[_ngcontent-%COMP%]   .no-breaks[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:#6b7280}.create-timecard-modal[_ngcontent-%COMP%]   .no-breaks[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:3rem;width:3rem;height:3rem;color:#d1d5db;margin-bottom:.5rem}.create-timecard-modal[_ngcontent-%COMP%]   .location-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#374151;margin-bottom:.5rem}.create-timecard-modal[_ngcontent-%COMP%]   .mat-mdc-raised-button[_ngcontent-%COMP%]{border-radius:6px}.create-timecard-modal[_ngcontent-%COMP%]   .mat-mdc-icon-button.mat-warn[_ngcontent-%COMP%]{color:#ef4444}.create-timecard-modal[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%]{display:grid;gap:1rem}.create-timecard-modal[_ngcontent-%COMP%]   .grid.grid-cols-1[_ngcontent-%COMP%]{grid-template-columns:repeat(1,minmax(0,1fr))}.create-timecard-modal[_ngcontent-%COMP%]   .grid.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}.create-timecard-modal[_ngcontent-%COMP%]   .grid.grid-cols-3[_ngcontent-%COMP%]{grid-template-columns:repeat(3,minmax(0,1fr))}@media(min-width:768px){.create-timecard-modal[_ngcontent-%COMP%]   .grid.md\\\\[_ngcontent-%COMP%]:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.create-timecard-modal[_ngcontent-%COMP%]   .grid.md\\\\[_ngcontent-%COMP%]:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}}.create-timecard-modal[_ngcontent-%COMP%]   .space-y-4[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:1rem}.create-timecard-modal[_ngcontent-%COMP%]   .space-y-6[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:1.5rem}.mat-mdc-dialog-content.loading[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.mat-mdc-form-field.mat-form-field-invalid[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{border-color:#ef4444}.location-captured[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{border-color:#10b981}"]})};var Gt=()=>[5,10,25,100];function Qt(i,e){i&1&&(o(0,"div",10),_(1,"mat-spinner",14),a())}function Wt(i,e){i&1&&_(0,"app-no-record",11)}function Xt(i,e){i&1&&(o(0,"th",32),m(1,"Employee"),a())}function Yt(i,e){if(i&1&&(o(0,"td",33)(1,"div",34)(2,"div",35)(3,"span",36),m(4),a()(),o(5,"span"),m(6),a()()()),i&2){let t=e.$implicit;s(4),h(" ",(typeof t.employee=="object"?t.employee.name:"Unknown")[0]," "),s(2),M(typeof t.employee=="object"?t.employee.name:"Unknown Employee")}}function Jt(i,e){i&1&&(o(0,"th",32),m(1,"Date"),a())}function Kt(i,e){if(i&1&&(o(0,"td",37),m(1),I(2,"date"),a()),i&2){let t=e.$implicit;s(),h(" ",j(2,1,t.clockInTime,"MMM dd, yyyy")," ")}}function Zt(i,e){i&1&&(o(0,"th",38),m(1,"Clock In"),a())}function ei(i,e){if(i&1&&(o(0,"td",37),m(1),I(2,"date"),a()),i&2){let t=e.$implicit;s(),h(" ",j(2,1,t.clockInTime,"shortTime")," ")}}function ti(i,e){i&1&&(o(0,"th",38),m(1,"Clock Out"),a())}function ii(i,e){if(i&1&&(m(0),I(1,"date")),i&2){let t=c().$implicit;h(" ",j(1,1,t.clockOutTime,"shortTime")," ")}}function ni(i,e){i&1&&(o(0,"span",39),m(1,"Still Active"),a())}function ai(i,e){if(i&1&&(o(0,"td",37),d(1,ii,2,4)(2,ni,2,0,"span",39),a()),i&2){let t=e.$implicit;s(),p(t.clockOutTime?1:2)}}function oi(i,e){i&1&&(o(0,"th",38),m(1,"Total Hours"),a())}function ri(i,e){if(i&1&&m(0),i&2){let t=c().$implicit,n=c(2);h(" ",n.formatDuration(t.totalHours)," ")}}function mi(i,e){i&1&&(o(0,"span",40),m(1,"-"),a())}function li(i,e){if(i&1&&(o(0,"td",37),d(1,ri,1,1)(2,mi,2,0,"span",40),a()),i&2){let t=e.$implicit;s(),p(t.totalHours?1:2)}}function si(i,e){i&1&&(o(0,"th",38),m(1,"Breaks"),a())}function ci(i,e){if(i&1&&(o(0,"mat-chip",42),m(1),a()),i&2){let t=e.$implicit,n=c(3);s(),Te(" ",t.breakType,": ",n.formatDuration(t.breakDuration||0)," ")}}function di(i,e){i&1&&(o(0,"span",40),m(1,"No breaks"),a())}function pi(i,e){if(i&1&&(o(0,"td",37)(1,"div",41),k(2,ci,2,2,"mat-chip",42,N),d(4,di,2,0,"span",40),a()()),i&2){let t=e.$implicit;s(2),y(t.breaks),s(2),p(t.breaks.length===0?4:-1)}}function ui(i,e){i&1&&(o(0,"th",38),m(1,"Overtime"),a())}function fi(i,e){if(i&1&&(o(0,"span",39),m(1),a()),i&2){let t=c().$implicit,n=c(2);s(),M(n.formatDuration(t.overtime))}}function _i(i,e){i&1&&(o(0,"span",40),m(1,"-"),a())}function gi(i,e){if(i&1&&(o(0,"td",37),d(1,fi,2,1,"span",39)(2,_i,2,0,"span",40),a()),i&2){let t=e.$implicit;s(),p(t.overtime&&t.overtime>0?1:2)}}function Ci(i,e){i&1&&(o(0,"th",38),m(1,"Status"),a())}function hi(i,e){if(i&1&&(o(0,"td",37)(1,"span"),m(2),I(3,"titlecase"),a()()),i&2){let t=e.$implicit,n=c(2);s(),be(xe("px-2 py-1 rounded-full text-xs font-medium ",n.getStatusColor(t.status))),s(),h(" ",Se(3,4,t.status)," ")}}function bi(i,e){i&1&&(o(0,"th",38),m(1,"Actions"),a())}function Ti(i,e){if(i&1){let t=O();o(0,"button",8),C("click",function(){v(t);let r=c().$implicit,l=c(2);return S(l.approveTimecard(r))}),o(1,"mat-icon"),m(2,"check_circle"),a(),o(3,"span"),m(4,"Approve"),a()()}}function xi(i,e){if(i&1){let t=O();o(0,"td",37)(1,"button",43)(2,"mat-icon"),m(3,"more_vert"),a()(),o(4,"mat-menu",null,1)(6,"button",8),C("click",function(){let r=v(t).$implicit,l=c(2);return S(l.editTimecard(r))}),o(7,"mat-icon"),m(8,"edit"),a(),o(9,"span"),m(10,"Edit"),a()(),d(11,Ti,5,0,"button",44),o(12,"button",45),C("click",function(){let r=v(t).$implicit,l=c(2);return S(l.deleteTimecard(r))}),o(13,"mat-icon"),m(14,"delete"),a(),o(15,"span"),m(16,"Delete"),a()()()()}if(i&2){let t=e.$implicit,n=fe(5);s(),f("matMenuTriggerFor",n),s(10),p(t.status==="completed"?11:-1)}}function vi(i,e){i&1&&_(0,"tr",46)}function Si(i,e){i&1&&_(0,"tr",47)}function Mi(i,e){if(i&1&&(o(0,"div",12)(1,"table",15),T(2,16),b(3,Xt,2,0,"th",17)(4,Yt,7,2,"td",18),x(),T(5,19),b(6,Jt,2,0,"th",17)(7,Kt,3,4,"td",20),x(),T(8,21),b(9,Zt,2,0,"th",22)(10,ei,3,4,"td",20),x(),T(11,23),b(12,ti,2,0,"th",22)(13,ai,3,1,"td",20),x(),T(14,24),b(15,oi,2,0,"th",22)(16,li,3,1,"td",20),x(),T(17,25),b(18,si,2,0,"th",22)(19,pi,5,1,"td",20),x(),T(20,26),b(21,ui,2,0,"th",22)(22,gi,3,1,"td",20),x(),T(23,27),b(24,Ci,2,0,"th",22)(25,hi,4,6,"td",20),x(),T(26,28),b(27,bi,2,0,"th",22)(28,xi,17,2,"td",20),x(),b(29,vi,1,0,"tr",29)(30,Si,1,0,"tr",30),a(),_(31,"mat-paginator",31),a()),i&2){let t=c();s(),f("dataSource",t.dataSource.value()),s(28),f("matHeaderRowDef",t.displayedColumns),s(),f("matRowDefColumns",t.displayedColumns),s(),f("pageSizeOptions",ve(4,Gt))}}function ki(i,e){i&1&&_(0,"app-no-record",13)}var St=class i{timesheetService=u(w);userService=u(ue);storeStore=u(ae);dialog=u(Ke);snackBar=u(Q);fb=u(Y);searchTerm=E("");selectedEmployee=E("all");selectedStatus=E("all");displayedColumns=["employee","date","clockIn","clockOut","totalHours","breaks","overtime","status","actions"];filterForm=this.fb.group({startDate:[null],endDate:[null],status:["all"],employee:["all"]});dataSource=me({params:()=>({storeId:this.storeStore.selectedStore()?._id,filters:this.buildFilters()}),stream:({params:e})=>this.timesheetService.getStoreTimesheets(e.storeId,e.filters)});paginator;sort;table;onSearch(e){let t=e.target;this.searchTerm.set(t.value)}onEmployeeChange(e){this.selectedEmployee.set(e)}onStatusChange(e){this.selectedStatus.set(e)}buildFilters(){let e=this.filterForm.value;return{startDate:e.startDate||void 0,endDate:e.endDate||void 0,status:e.status&&e.status!=="all"?e.status:void 0,employeeId:e.employee&&e.employee!=="all"?e.employee:void 0}}onFilterChange(){this.dataSource.reload()}createTimecard(){this.dialog.open(D,{width:"800px",maxWidth:"90vw",data:{mode:"create"}}).afterClosed().subscribe(t=>{t&&this.dataSource.reload()})}editTimecard(e){this.dialog.open(D,{width:"800px",maxWidth:"90vw",data:{mode:"edit",timesheet:e}}).afterClosed().subscribe(n=>{n&&this.dataSource.reload()})}approveTimecard(e){this.timesheetService.approveTimesheet(e._id).subscribe({next:()=>{this.snackBar.open("Timecard approved successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dataSource.reload()},error:t=>{console.error("Error approving timecard:",t),this.snackBar.open("Error approving timecard","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})}deleteTimecard(e){let t=typeof e.employee=="object"?e.employee.name:"Unknown Employee";this.dialog.open(Tt,{width:"400px",data:{message:`Are you sure you want to delete timecard for ${t}?`}}).afterClosed().subscribe(r=>{r&&this.timesheetService.deleteTimesheet(e._id).subscribe({next:()=>{this.snackBar.open("Timecard deleted successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dataSource.reload()},error:l=>{console.error("Error deleting timecard:",l),this.snackBar.open("Error deleting timecard","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})})}exportTimecards(e="csv"){let t=this.storeStore.selectedStore()?._id;if(!t){this.snackBar.open("No store selected","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"});return}this.timesheetService.exportTimesheets(t,e).subscribe({next:n=>{let r=window.URL.createObjectURL(n),l=document.createElement("a");l.href=r,l.download=`timecards_${new Date().getTime()}.${e==="csv"?"csv":"xlsx"}`,l.click(),window.URL.revokeObjectURL(r),this.snackBar.open("Export completed successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})},error:n=>{console.error("Error exporting timecards:",n),this.snackBar.open("Error exporting timecards","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}})}formatDuration(e){let t=Math.floor(e/60),n=e%60;return`${t}h ${n}m`}getStatusColor(e){switch(e){case"clocked-in":return"bg-blue-100 text-blue-800";case"clocked-out":return"bg-green-100 text-green-800";case"incomplete":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=R({type:i,selectors:[["app-list-timecards"]],viewQuery:function(t,n){if(t&1&&(A(de,5),A(pe,5),A(le,5)),t&2){let r;U(r=V())&&(n.paginator=r.first),U(r=V())&&(n.sort=r.first),U(r=V())&&(n.table=r.first)}},decls:30,vars:2,consts:[["exportMenu","matMenu"],["menu","matMenu"],[1,"timecards-container","!bg-white","!rounded-xl","!shadow-lg","border","border-gray-100"],[1,"!bg-white"],[1,"header-section","flex","justify-between","items-center","mb-6","p-4","border-b","border-gray-200"],[1,"text-xl","font-semibold","text-gray-900"],[1,"actions-group","flex","gap-3"],["mat-button","",1,"flex","items-center","gap-2",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-raised-button","","color","primary",1,"flex","items-center","gap-2",3,"click"],[1,"flex","items-center","justify-center","min-h-[300px]"],["icon","schedule","title","No Timecards","message","No timecards found matching your criteria."],[1,"table-container","rounded-lg","overflow-x-auto"],["icon","error","title","Error","message","An error occurred while fetching the data. Please try again later."],["diameter","40"],["mat-table","","matSort","",1,"!bg-white","min-w-full","rounded-lg",3,"dataSource"],["matColumnDef","employee"],["mat-header-cell","","mat-sort-header","","class","bg-gray-50",4,"matHeaderCellDef"],["mat-cell","","class","font-semibold",4,"matCellDef"],["matColumnDef","date"],["mat-cell","",4,"matCellDef"],["matColumnDef","clockIn"],["mat-header-cell","","class","bg-gray-50",4,"matHeaderCellDef"],["matColumnDef","clockOut"],["matColumnDef","totalHours"],["matColumnDef","breaks"],["matColumnDef","overtime"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-row","","class","bg-gray-50",4,"matHeaderRowDef"],["mat-row","","class","hover:bg-gray-50 transition",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of timecards",1,"!bg-white",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header","",1,"bg-gray-50"],["mat-cell","",1,"font-semibold"],[1,"flex","items-center","gap-2"],[1,"w-8","h-8","bg-blue-100","rounded-full","flex","items-center","justify-center"],[1,"text-xs","font-medium","text-blue-600"],["mat-cell",""],["mat-header-cell","",1,"bg-gray-50"],[1,"text-orange-600","font-medium"],[1,"text-gray-400"],[1,"flex","gap-1"],[1,"!text-xs"],["mat-icon-button","","aria-label","Timecard actions",3,"matMenuTriggerFor"],["mat-menu-item",""],["mat-menu-item","",1,"text-red-600",3,"click"],["mat-header-row","",1,"bg-gray-50"],["mat-row","",1,"hover:bg-gray-50","transition"]],template:function(t,n){if(t&1){let r=O();o(0,"mat-card",2)(1,"mat-card-content",3)(2,"div",4)(3,"h2",5),m(4,"Timecards"),a(),o(5,"div",6)(6,"button",7)(7,"mat-icon"),m(8,"download"),a(),m(9," EXPORT "),a(),o(10,"mat-menu",null,0)(12,"button",8),C("click",function(){return v(r),S(n.exportTimecards("csv"))}),o(13,"mat-icon"),m(14,"table_chart"),a(),o(15,"span"),m(16,"Export as CSV"),a()(),o(17,"button",8),C("click",function(){return v(r),S(n.exportTimecards("excel"))}),o(18,"mat-icon"),m(19,"grid_on"),a(),o(20,"span"),m(21,"Export as Excel"),a()()(),o(22,"button",9),C("click",function(){return v(r),S(n.createTimecard())}),o(23,"mat-icon"),m(24,"add"),a(),m(25," CREATE TIMECARD "),a()()(),d(26,Qt,2,0,"div",10)(27,Wt,1,0,"app-no-record",11)(28,Mi,32,5,"div",12)(29,ki,1,0,"app-no-record",13),a()()}if(t&2){let r=fe(11);s(6),f("matMenuTriggerFor",r),s(20),p(n.dataSource.isLoading()?26:n.dataSource.hasValue()&&n.dataSource.value().length===0?27:n.dataSource.hasValue()&&n.dataSource.value().length>0?28:n.dataSource.error()?29:-1)}},dependencies:[ye,ft,le,rt,ct,mt,ot,dt,lt,st,pt,ut,gt,de,bt,pe,ht,ee,te,ce,G,q,H,Z,K,Ue,Xe,Qe,Ge,We,ne,ie,re,oe,se,z,at,nt,J,Ct,Me,ke],styles:[".timecards-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]{border-bottom:1px solid #e5e7eb;margin-bottom:1.5rem;padding-bottom:1rem}.timecards-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#111827;font-weight:600;font-size:1.25rem;line-height:1.75rem}.timecards-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]   .actions-group[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:center}.timecards-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]   .actions-group[_ngcontent-%COMP%]   .mat-mdc-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.timecards-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]   .actions-group[_ngcontent-%COMP%]   .mat-mdc-raised-button[_ngcontent-%COMP%]{border-radius:6px;text-transform:none;font-weight:500}.timecards-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .mat-mdc-table[_ngcontent-%COMP%]{border-radius:8px}.timecards-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .mat-mdc-table[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#374151;background-color:#f9fafb}.timecards-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .mat-mdc-table[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]:hover{background-color:#f9fafb}.mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-form-field-subscript-wrapper[_ngcontent-%COMP%]{display:none}.mat-mdc-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.mat-mdc-chip[_ngcontent-%COMP%]{--mdc-chip-container-height: 24px;--mdc-chip-label-text-size: 12px}@media(max-width:768px){.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}}@media(max-width:640px){.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:repeat(1,minmax(0,1fr))}}"]})};export{St as ListTimecardsComponent};
