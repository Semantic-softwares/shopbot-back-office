import{a as Di}from"./chunk-ETZMAH6M.js";import{a as ki}from"./chunk-5TLA7QJ5.js";import{a as Ti,b as Pi,c as wi}from"./chunk-P7TT26EF.js";import{a as ct,b as st}from"./chunk-HBZVVBVU.js";import"./chunk-OKW2XT47.js";import{a as lt}from"./chunk-4C6TXTXM.js";import{a as Ei}from"./chunk-IN4JIQ3S.js";import{a as yi,b as Mi,c as Me,d as at}from"./chunk-GKESQVDG.js";import{a as Oi,b as Ii,c as Ri}from"./chunk-WKF5CUI3.js";import{a as Vi,c as Fi}from"./chunk-42J4MRPK.js";import"./chunk-FLBWJPK6.js";import{a as Si,b as xi}from"./chunk-263TQBY6.js";import{a as bi}from"./chunk-ISXXJD52.js";import{b as vi}from"./chunk-HTIQX262.js";import{a as fi,c as gi,e as _i,f as Ci}from"./chunk-LQE4FJGA.js";import{a as rt}from"./chunk-4QXD4TQN.js";import{a as hi}from"./chunk-UAUN2EOX.js";import{a as ie,b as oe,c as $e,d as Qe,e as ne,f as re,g as ae,h as le}from"./chunk-DCD2EY64.js";import{a as di,b as mi,c as ui}from"./chunk-OECSTR6G.js";import{a as pi}from"./chunk-2MXILDTK.js";import{h as si}from"./chunk-VZJV7FAI.js";import{a as Be}from"./chunk-H3VCUIUM.js";import{a as Le}from"./chunk-FB5OTQCF.js";import{a as Xt,b as Yt,c as Zt,g as ei}from"./chunk-KWQBTQML.js";import{a as ti,b as ii,c as oi,e as ni,f as ri,g as ai,h as li,k as ci,l as Ae}from"./chunk-T3KX74D3.js";import{b as nt}from"./chunk-FBHRMY6R.js";import{a as At}from"./chunk-HY4LTOAV.js";import"./chunk-4G2PTLMY.js";import"./chunk-EIZRJIIE.js";import"./chunk-R4SEO7WU.js";import{d as qt}from"./chunk-U2JZUY6D.js";import{a as _,b as Oe,c as Ie,d as Re,e as Pe,f as Ve,g as W,h as K,i as k}from"./chunk-U4YSNMIZ.js";import{a as Ht,b as Jt}from"./chunk-3IQG3KHZ.js";import{d as Nt}from"./chunk-YK4A772F.js";import"./chunk-HXICWX3M.js";import"./chunk-4YIJHWNC.js";import{a as Wt,d as Kt}from"./chunk-EPNSEEH4.js";import"./chunk-MMNFDWV7.js";import"./chunk-CGDRKYIW.js";import{b as X,c as fe,d as te}from"./chunk-IS37LNAK.js";import{a as ue,b as it,d as pe,e as ot,h as ee}from"./chunk-QJ2P7YZL.js";import"./chunk-LXD47U2C.js";import{a as ge,b as _e}from"./chunk-ZG44B3L4.js";import{A as Z,B as Ne,b as Fe,d as we,g as Ge,h as Xe,k as jt,l as Ut,m as Ye,n as zt,s as Ze,t as et,z as tt}from"./chunk-SZWYIW32.js";import"./chunk-CTT4BYCX.js";import{a as Lt}from"./chunk-V7ZBVJLR.js";import{a as Bt}from"./chunk-T4ACDKLD.js";import"./chunk-5QCN73SK.js";import"./chunk-NQRUH5DO.js";import{a as We,c as $t,e as Qt,h as Ke}from"./chunk-MESJBQC5.js";import"./chunk-QEF3JOQ3.js";import"./chunk-LSROOOYO.js";import"./chunk-7NDZPDVA.js";import{b as A,c as F}from"./chunk-OWLRGWNJ.js";import{$ as N,Y as me,Z as U,_ as Ee}from"./chunk-OS2CYUJN.js";import{l as Gt,p as ye,r as G}from"./chunk-U2P6GFP5.js";import{$a as c,Ec as Je,G as kt,Gb as f,Hb as g,Ib as Te,Jc as B,Kb as z,Kc as Dt,Lb as H,Lc as Tt,Mb as v,Nb as n,Nc as Y,Ob as r,Pb as I,Qb as se,Rb as de,Tc as M,U as j,Wb as S,X as xe,Xa as He,Yc as q,Zc as $,_b as u,ac as d,bd as Ft,c as J,ea as m,f as wt,ja as C,ka as h,m as ze,mc as ke,ob as V,pc as l,qc as y,rc as T,sc as Ot,ub as Mt,uc as It,va as P,vc as Rt,wc as Vt,ya as Et}from"./chunk-IQSYHSID.js";import{a as w,b as L}from"./chunk-EQDQRRRY.js";var qe=class{name;activate;position;color;icon;items;store;foods;constructor(t){this.name=t.name||"",this.activate=t.activate??!0,this.position=t.position||0,this.color=t.color||"#CFDDDB",this.icon=t.icon||"lunch_dining",this.items=t.items||0,this.store=t.store||"",this.foods=t.foods||[]}};var $i={categories:[],selectedCategory:null,isLoading:!1,error:null},dt=Oe({providedIn:"root"},Ve($i),Ie(({categories:o})=>({categoryCount:M(()=>o().length)})),Pe((o,t=m(hi))=>{function e(b){_(o,{selectedCategory:b})}function i(b){let D=new qe(b);_(o,{categories:[D,...o.categories()]})}function a(b,D){let E=o.categories().findIndex(x=>x._id===b);if(E!==-1){let x=[...o.categories()];x[E]=w(w({},x[E]),D),_(o,{categories:x})}else console.error(`Category with ID ${b} not found`)}function s(b){let D=o.categories().filter(E=>E._id!==b);_(o,{categories:D})}let p=K(J(xe(()=>_(o,{isLoading:!0,error:null,categories:[]})),j(b=>t.getStoreMenus(b).pipe(W({next(D){e(D[0]),_(o,{isLoading:!1,error:D,categories:D})},error(D){_(o,{isLoading:!1,error:D,categories:[]})}}))))),O=K(J(xe(()=>_(o,{isLoading:!0,error:null})),j(b=>{let D=new qe(b);return t.createMenu(D).pipe(W({next(E){_(o,{isLoading:!1,error:null,categories:[E,...o.categories()]})},error(E){_(o,{isLoading:!1,error:E})}}))}))),Q=K(J(j(b=>t.deleteMenu(b).pipe(W({next(D){_(o,{isLoading:!1,error:null})},error(D){_(o,{isLoading:!1,error:D})}}))))),ce=K(J(j(({category:b,categoryId:D,reload:E=!0})=>(_(o,{isLoading:E,error:null}),t.updateMenu(D,b).pipe(W({next(x){_(o,{isLoading:!1,error:null}),a(D,x)},error(x){_(o,{isLoading:!1,error:x})}}))))));return{createCategory:i,updateCategory:a,deleteCategory:s,selectCategory:e,createCategory$:O,getCategories$:p,deleteCategory$:Q,updateCategory$:ce}}),Re({onInit(o){let e=m(k).selectedStore();e?._id&&o.getCategories$(e._id)}}));var Qi={products:[],error:null,isLoading:!1,searchQuery:"",changedPhotoOnEdit:!1,attachedFiles:[]},mt=Oe({providedIn:"root"},Ve(Qi),Ie(o=>{let t=m(dt),e=M(()=>{let i=t.selectedCategory(),a=o.searchQuery().toLowerCase();return a.length>0?o.products().filter(s=>s.name?.toLowerCase().includes(a)||s.description?.toLowerCase().includes(a)||s.barcode?.toLowerCase().includes(a)):i?o.products().filter(s=>s?.menu?._id===i?._id):[]});return{productCount:M(()=>o.products().length),filteredProducts:e,filterProductCount:M(()=>e().length)}}),Pe(o=>{function t(b){_(o,{searchQuery:b})}function e(b){return o.products().find(D=>D?.barcode===b)}function i(b){_(o,{changedPhotoOnEdit:b})}function a(b){_(o,{attachedFiles:b})}function s(){_(o,{searchQuery:""})}function p(b){let D=o.products().map(E=>E._id===b?L(w({},E),{quantity:E.quantity+1}):E);_(o,{products:D})}function O(b){let D=o.products().map(E=>E._id===b?L(w({},E),{quantity:Math.max(0,E.quantity-1)}):E);_(o,{products:D})}function Q(b){_(o,{products:[b,...o.products()]})}function ce(b){let D=o.products().filter(E=>E._id!==b);_(o,{products:D})}return{updateSearchQuery:t,clearSearchQuery:s,deleteProduct:ce,searchByBarcode:e,createProduct:Q,decrementQuantity:O,incrementQuantity:p,updateChangedPhotoOnEdit:i,updateAttachedFiles:a}}),Pe((o,t=m(rt))=>{let e=K(J(xe(()=>_(o,{isLoading:!0,error:null,products:[]})),j(s=>t.getStoreProducts(s).pipe(W({next(p){_(o,{isLoading:!1,error:null,products:p})},error(p){_(o,{isLoading:!1,error:p,products:[]})}})))));function i(s,p){let O=o.products().findIndex(Q=>Q._id===s);if(O!==-1){let Q=[...o.products()];Q[O]=w(w({},Q[O]),p),_(o,{products:Q})}else console.error(`Product with ID ${s} not found`)}let a=K(J(j(s=>t.deleteProduct(s).pipe(W({next(p){_(o,{isLoading:!1,error:null})},error(p){_(o,{isLoading:!1,error:p})}})))));return{updateProduct:i,getStoreProducts:e,deleteProducts$:a}}),Re({onInit(o){let e=m(k).selectedStore();e?._id&&o.getStoreProducts(e._id)}}));function qi(o,t){if(o&1){let e=S();n(0,"button",4),u("click",function(a){C(e);let s=d();return h(s.onLeftTap(a))}),n(1,"mat-icon"),l(2),r()()}if(o&2){let e=d();c(2),y(e.leftIcon())}}function ji(o,t){if(o&1){let e=S();n(0,"button",5),u("click",function(a){C(e);let s=d();return s.onRightTap(a),h(s.clearFilter())}),n(1,"mat-icon"),l(2),r()()}if(o&2){let e=d();c(2),y(e.rightIcon())}}var ut=class o{filter=Ft("");searchText=$("Search...");leftIcon=$("search");rightIcon=$("close");showRightIcon=$(!0);showLeftIcon=$(!0);leftTap=q();rightTap=q();onLeftTap(t){this.leftTap.emit(t)}onRightTap(t){this.rightTap.emit(t)}clearFilter(){this.filter.set("")}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-search"]],inputs:{filter:[1,"filter"],searchText:[1,"searchText"],leftIcon:[1,"leftIcon"],rightIcon:[1,"rightIcon"],showRightIcon:[1,"showRightIcon"],showLeftIcon:[1,"showLeftIcon"]},outputs:{filter:"filterChange",leftTap:"leftTap",rightTap:"rightTap"},decls:4,vars:4,consts:[["appearance","outline",1,"w-full"],["mat-icon-button","","matPrefix",""],["matInput","","type","text",3,"ngModelChange","placeholder","ngModel"],["mat-icon-button","","matSuffix",""],["mat-icon-button","","matPrefix","",3,"click"],["mat-icon-button","","matSuffix","",3,"click"]],template:function(e,i){e&1&&(n(0,"mat-form-field",0),f(1,qi,3,1,"button",1),n(2,"input",2),Vt("ngModelChange",function(s){return Rt(i.filter,s)||(i.filter=s),s}),r(),f(3,ji,3,1,"button",3),r()),e&2&&(c(),g(i.showLeftIcon()?1:-1),c(),v("placeholder",i.searchText()),It("ngModel",i.filter),c(),g(i.showRightIcon()&&i.filter().length>0?3:-1))},dependencies:[Z,Fe,Ge,Ut,X,ee,pe,ot,te,fe,F,A,N,me],styles:["[_nghost-%COMP%]{display:block;width:100%}mat-form-field[_ngcontent-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}mat-form-field[_ngcontent-%COMP%]     .mdc-notched-outline__leading, mat-form-field[_ngcontent-%COMP%]     .mdc-notched-outline__notch, mat-form-field[_ngcontent-%COMP%]     .mdc-notched-outline__trailing{border-color:#0000001f}mat-form-field[_ngcontent-%COMP%]     .mat-mdc-form-field-flex{align-items:center}"]})};var Ui={variants:[],error:null,isLoading:!1,selectedVariant:null,selectedVariants:[]},pt=Oe({providedIn:"root"},Ve(Ui),Ie(({variants:o})=>({menuCount:M(()=>o().length)})),Pe((o,t=m(rt))=>{function e(x){_(o,{selectedVariant:x})}function i(x){_(o,{variants:[...o.variants(),x]}),e(x)}function a(x,R){let ve=o.variants().findIndex(Se=>Se._id===x);if(ve!==-1){let Se=[...o.variants()];Se[ve]=w(w({},Se[ve]),R),_(o,{variants:Se})}else console.error(`Category with ID ${x} not found`)}function s(x){let R=o.variants().filter(ve=>ve._id!==x);_(o,{variants:R})}function p(x){_(o,{selectedVariants:x})}function O(x){let R=o.variants().filter(ve=>ve.products.includes(x));console.log("Filtered variants for product:",R),_(o,{selectedVariants:R})}let Q=K(J(xe(()=>_(o,{isLoading:!0,error:null,variants:[]})),j(x=>t.getStoreGroupOption(x).pipe(W({next(R){_(o,{isLoading:!1,error:null,variants:R})},error(R){_(o,{isLoading:!1,error:R,variants:[]})}}))))),ce=K(J(xe(()=>_(o,{isLoading:!0,error:null})),j(x=>t.createVariant(x).pipe(W({next(R){_(o,{isLoading:!1,error:null,variants:[x,...o.variants()]})},error(R){_(o,{isLoading:!1,error:R})}}))))),b=K(J(j(({variant:x,variantId:R,reload:ve=!0})=>(_(o,{isLoading:ve,error:null}),t.updateVariant(x,R).pipe(W({next(Se){a(R,x),_(o,{isLoading:!1,error:null})},error(Se){_(o,{isLoading:!1,error:Se})}})))))),D=K(J(j(x=>t.deleteVariant(x).pipe(W({next(R){_(o,{isLoading:!1,error:null})},error(R){_(o,{isLoading:!1,error:R})}}))))),E=K(J(j(x=>t.removeProductIdFromVariant(x.variantId,x.productId).pipe(W({next(R){_(o,{isLoading:!1,error:null})},error(R){_(o,{isLoading:!1,error:R})}})))));return{setSelectedVariant:e,createVariant:i,updateVariant:a,deleteVariant:s,updateSelectedVariants:p,getProductVariants:O,loadVariants:Q,createVariant$:ce,updateVariant$:b,deleteVariant$:D,removeProductIds$:E}}),Re({onInit(o){let e=m(k).selectedStore()?._id;e&&o.loadVariants(e)}}));function Hi(o,t){o&1&&(n(0,"span",22),l(1,"Out of stock"),r())}function Ji(o,t){if(o&1){let e=S();n(0,"div",23)(1,"button",25),u("click",function(a){C(e);let s=d(2).$index,p=d().$index;return d(2).decrease(p,s),h(a.stopPropagation())}),n(2,"mat-icon"),l(3,"remove"),r()(),n(4,"span",26),l(5),r(),n(6,"button",27),u("click",function(a){C(e);let s=d(2).$index,p=d().$index;return d(2).increase(p,s),h(a.stopPropagation())}),n(7,"mat-icon"),l(8,"add"),r()()()}if(o&2){let e=d(2).$implicit;c(),v("disabled",e.quantity<=1),c(4),y(e.quantity)}}function Wi(o,t){if(o&1&&(n(0,"div",23)(1,"span",24),l(2),B(3,"currency"),r(),f(4,Ji,9,2,"div",23),r()),o&2){let e=d().$implicit,i=d(3);c(2),T(" +",Tt(3,2,e.price,i.product.store==null?null:i.product.store.currency)," "),c(2),g(e.selected?4:-1)}}function Ki(o,t){if(o&1){let e=S();n(0,"mat-list-option",19),u("selectedChange",function(a){let s=C(e).$index,p=d().$index,O=d(2);return h(O.checkedChange(p,s,a))}),n(1,"div",20)(2,"div")(3,"span",21),l(4),B(5,"titlecase"),r(),f(6,Hi,2,0,"span",22),r(),f(7,Wi,5,5,"div",23),r()()}if(o&2){let e=t.$implicit;v("selected",e.selected)("disabled",!e.inStock),c(4),y(Dt(5,5,e.name)),c(2),g(e.inStock?-1:6),c(),g(e.inStock?7:-1)}}function Xi(o,t){if(o&1&&(n(0,"div",2)(1,"div",13)(2,"div")(3,"h3",14),l(4),B(5,"titlecase"),r(),n(6,"p",15),l(7),r()(),n(8,"span",16),l(9),r()(),n(10,"mat-selection-list",17),z(11,Ki,8,7,"mat-list-option",18,Te),r()()),o&2){let e=t.$implicit;c(4),y(Dt(5,16,e.name)),c(3),T(" Choose ",e.atLeast===e.atMost?e.atLeast:"between "+e.atLeast+" and "+e.atMost," "),c(),ke("bg-red-100",e.atLeast>0&&e.invalid)("text-red-700",e.atLeast>0&&e.invalid)("bg-green-100",!e.invalid)("text-green-700",!e.invalid)("bg-gray-100",e.atLeast===0&&e.invalid)("text-gray-600",e.atLeast===0&&e.invalid),c(),T(" ",e.atLeast>0?"Required":"Optional"," "),c(),v("multiple",!0),c(),H(e.options)}}function Yi(o,t){if(o&1&&z(0,Xi,13,18,"div",2,Te),o&2){let e=d();H(e.variantStore.selectedVariants())}}function Zi(o,t){o&1&&(n(0,"div",5),I(1,"mat-spinner",28),n(2,"p",29),l(3,"Loading options..."),r()())}var ft=class o{dialogRef=m(ie);dialogData=m(oe);isActivity=M(()=>this.storeStore.selectedStore()?.category==="Activities");product=this.dialogData.product;isEditing=P(this.dialogData?.isEditing??!1);productStore=m(mt);variantStore=m(pt);storeStore=m(k);quantity=P(this.product?.quantity||1);minDate=P(new Date);activityForm=new jt;variant=Et(()=>{console.log("Selected variants updated:",this.variantStore.selectedVariants()),this.variantStore.selectedVariants()});updateAreAllVariantsValid=M(()=>this.variantStore.selectedVariants().every(e=>!e.invalid));ngOnInit(){if(this.isEditing()&&this.product.options&&this.product.options.length>0){let t=JSON.parse(JSON.stringify(this.product.options));this.variantStore.updateSelectedVariants(t)}this.activityForm.valueChanges.subscribe(t=>{t&&(this.product=L(w({},this.product),{activityDateTime:t}))})}closeModal(){this.variant.destroy(),this.dialogRef.close()}submit(){if(this.isActivity()&&!this.product.activityDateTime){alert("Please select activity date and time");return}this.variant.destroy();let e=this.variantStore.selectedVariants().map(i=>L(w({},i),{options:i.options.filter(a=>a.selected)}));this.product.quantity=this.quantity(),this.dialogRef.close(L(w({},this.product),{options:e,activityDateTime:this.isActivity()?this.product.activityDateTime:void 0}))}updateQuantityTotal(t){t==="up"?this.quantity.update(e=>e+1):this.quantity.update(e=>Math.max(1,e-1))}increase(t,e){let i=this.variantStore.selectedVariants(),a=L(w({},i[t].options[e]),{quantity:i[t].options[e].quantity+1}),s=[...i[t].options.slice(0,e),a,...i[t].options.slice(e+1)],p=L(w({},i[t]),{options:s}),O=[...i.slice(0,t),p,...i.slice(t+1)];this.variantStore.updateSelectedVariants(O)}decrease(t,e){let i=this.variantStore.selectedVariants(),a=Math.max(1,i[t].options[e].quantity-1),s=L(w({},i[t].options[e]),{quantity:a}),p=[...i[t].options.slice(0,e),s,...i[t].options.slice(e+1)],O=L(w({},i[t]),{options:p}),Q=[...i.slice(0,t),O,...i.slice(t+1)];this.variantStore.updateSelectedVariants(Q)}checkedChange(t,e,i){let s=this.deepClone(this.variantStore.selectedVariants()).map((p,O)=>{if(O===t){let Q=p.options.map((b,D)=>D===e?L(w({},b),{selected:i}):b),ce=Q.filter(b=>b.selected===!0);return L(w({},p),{options:Q,invalid:!(ce.length>=p.atLeast&&ce.length<=p.atMost)})}return p});this.variantStore.updateSelectedVariants(s)}deepClone(t){return JSON.parse(JSON.stringify(t))}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-product-options"]],decls:25,vars:11,consts:[["mat-dialog-title",""],[1,"!pt-0"],[1,"mb-4"],[1,"text-sm","text-gray-500","mb-2"],[1,"text-lg","font-semibold","text-primary"],[1,"flex","flex-col","items-center","justify-center","py-8","gap-4"],["align","end",1,"!px-6","!py-4","border-t","border-outline-variant"],[1,"flex","items-center","gap-2","mr-auto"],["mat-mini-fab","","color","primary",3,"click","disabled"],[1,"w-10","text-center","text-xl","font-semibold"],["mat-mini-fab","","color","primary",3,"click"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"flex","items-start","justify-between","mb-2"],[1,"text-base","font-medium"],[1,"text-xs","text-gray-500"],[1,"px-2","py-0.5","text-xs","font-medium","rounded-full"],[1,"!py-0",3,"multiple"],[1,"!h-auto","!py-2",3,"selected","disabled"],[1,"!h-auto","!py-2",3,"selectedChange","selected","disabled"],[1,"flex","items-center","justify-between","w-full"],[1,"text-sm"],[1,"block","text-xs","text-red-500"],[1,"flex","items-center","gap-2"],[1,"text-sm","text-gray-600"],["matIconButton","","color","warn",3,"click","disabled"],[1,"w-8","text-center","text-lg","font-semibold"],["matIconButton","","color","primary",3,"click"],["diameter","40"],[1,"text-gray-500"]],template:function(e,i){e&1&&(n(0,"h2",0),l(1),r(),n(2,"mat-dialog-content",1)(3,"div",2)(4,"p",3),l(5),r(),n(6,"span",4),l(7),B(8,"currency"),r()(),f(9,Yi,2,0)(10,Zi,4,0,"div",5),r(),n(11,"mat-dialog-actions",6)(12,"div",7)(13,"button",8),u("click",function(){return i.updateQuantityTotal("down")}),n(14,"mat-icon"),l(15,"remove"),r()(),n(16,"span",9),l(17),r(),n(18,"button",10),u("click",function(){return i.updateQuantityTotal("up")}),n(19,"mat-icon"),l(20,"add"),r()()(),n(21,"button",11),l(22,"Cancel"),r(),n(23,"button",12),u("click",function(){return i.submit()}),l(24),r()()),e&2&&(c(),y(i.product.name),c(4),y(i.product.description),c(2),T(" ",Tt(8,8,i.product.price,(i.product.store==null?null:i.product.store.currency)||"USD")," "),c(2),g(i.variantStore.isLoading()?10:9),c(4),v("disabled",i.quantity()<=1),c(4),y(i.quantity()),c(6),v("disabled",!i.updateAreAllVariantsValid()),c(),T(" ",i.isEditing()?"Update":"Add to Order"," "))},dependencies:[G,Ne,le,Qe,ne,ae,re,N,U,Ee,me,F,A,vi,_e,ge,X,te,si,At,Ae,ci,li,Gt,ye],styles:["[_nghost-%COMP%]{display:block}.text-primary[_ngcontent-%COMP%]{color:#1976d2}mat-selection-list[_ngcontent-%COMP%]   .mat-mdc-list-item[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.06)}mat-selection-list[_ngcontent-%COMP%]   .mat-mdc-list-item[_ngcontent-%COMP%]:last-child{border-bottom:none}"]})};function to(o,t){if(o&1&&I(0,"img",2),o&2){let e=d();v("src",e.product().photos[0],He)("alt",e.product().name)}}function io(o,t){o&1&&(n(0,"div",3)(1,"mat-icon",13),l(2,"image"),r()())}function oo(o,t){o&1&&(n(0,"div",4),l(1," Out of stock "),r())}function no(o,t){if(o&1&&(n(0,"div",5),l(1),r()),o&2){let e=d();c(),T(" Low: ",e.product().qty," ")}}function ro(o,t){if(o&1&&(n(0,"span",10),l(1),B(2,"currency"),r()),o&2){let e=d();c(),T(" ",Y(2,1,e.product().costPrice,e.currency(),"symbol","1.0-0")," ")}}function ao(o,t){if(o&1){let e=S();n(0,"div",14)(1,"button",16),u("click",function(){C(e);let a=d(2);return h(a.removeOrDeleteProduct(a.product()))}),n(2,"mat-icon",17),l(3,"remove"),r()(),n(4,"span",18),l(5),r(),n(6,"button",19),u("click",function(a){C(e);let s=d(2);return h(s.onAddToCart(a))}),n(7,"mat-icon",17),l(8,"add"),r()()()}if(o&2){let e=d(2);c(5),T(" ",e.productQuantity()," ")}}function lo(o,t){if(o&1){let e=S();n(0,"button",20),u("click",function(a){C(e);let s=d(2);return h(s.onAddToCart(a))}),n(1,"mat-icon"),l(2,"add_shopping_cart"),r(),l(3," Add "),r()}if(o&2){let e=d(2);v("disabled",e.isOutOfStock())}}function co(o,t){if(o&1&&f(0,ao,9,1,"div",14)(1,lo,4,1,"button",15),o&2){let e=d();g(e.isProductInCart()?0:1)}}function so(o,t){if(o&1){let e=S();n(0,"button",21),u("click",function(a){C(e);let s=d();return h(s.onOpenOptions(a))}),n(1,"mat-icon"),l(2,"tune"),r(),l(3," Options "),r()}if(o&2){let e=d();v("disabled",e.isOutOfStock())}}var _t=class o{storeStore=m(k);cartStore=m(Me);variantStore=m(pt);dialog=m($e);product=$.required();cartQuantity=$(0);addToCart=q();increment=q();decrement=q();openOptions=q();currency=M(()=>this.storeStore.selectedStore()?.currency||"\u20A6");hasOptions=M(()=>{let t=this.product();return t.options&&t.options.length>0});isProductInCart=M(()=>{let t=this.cartStore.selectedCart();return t?t.products.find(e=>e._id===this.product()._id):!1});productQuantity=M(()=>{let t=this.cartStore.selectedCart();if(t){let e=t.products.find(i=>i._id===this.product()._id);return e?e.quantity:0}return 0});isOutOfStock=M(()=>!this.product().active);isLowStock=M(()=>{let t=this.product();return t.active&&t.qty!==void 0&&t.qty<=5});onAddToCart(t){t.stopPropagation(),this.addToCart.emit(this.product())}removeOrDeleteProduct(t){this.productQuantity()>1?this.cartStore.decrementProductQuantity(t._id):(this.cartStore.updateCartAction("delete"),this.cartStore.removeFromCart(this.cartStore.selectedCart()._id,t._id))}onOpenOptions(t){t.stopPropagation(),this.openProductOptionsDialog()}openProductOptionsDialog(){this.variantStore.getProductVariants(this.product()._id);let t=this.cartStore.selectedCart(),e=null,i=!1;t&&(e=t.products.find(p=>p._id===this.product()._id)||null,i=!!e);let a={product:e||this.product(),isEditing:i};this.dialog.open(ft,{width:"100%",maxWidth:"500px",maxHeight:"90vh",panelClass:"product-options-dialog-panel",data:a}).afterClosed().subscribe(p=>{p&&(this.cartStore.updateCartAction(i?"edit":"add"),this.cartStore.selectedCart()||this.cartStore.createCart(),this.cartStore.addToCart(this.cartStore.selectedCart()._id,p,i))})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-product-card"]],inputs:{product:[1,"product"],cartQuantity:[1,"cartQuantity"]},outputs:{addToCart:"addToCart",increment:"increment",decrement:"decrement",openOptions:"openOptions"},decls:17,vars:11,consts:[["appearance","outlined",1,"overflow-hidden","hover:shadow-lg","transition-shadow","duration-200","cursor-pointer","h-full","flex","flex-col"],[1,"relative","aspect-square","bg-gray-100","overflow-hidden"],[1,"w-full","h-full","object-cover","hover:scale-105","transition-transform","duration-300",3,"src","alt"],[1,"w-full","h-full","flex","items-center","justify-center","bg-gray-50"],[1,"absolute","top-2","right-2","px-2","py-0.5","text-xs","font-medium","rounded-full","bg-red-100","text-red-700"],[1,"absolute","top-2","right-2","px-2","py-0.5","text-xs","font-medium","rounded-full","bg-amber-100","text-amber-700"],[1,"p-4","flex-1","flex","flex-col"],[1,"font-medium","text-gray-900","text-sm","line-clamp-2","mt-2","min-h-[2.5rem]","leading-5"],[1,"flex","items-center","gap-2"],[1,"primary-text","font-bold","text-lg"],[1,"text-gray-400","primary-text","text-sm","line-through"],[1,"p-2","border-t","border-outline-variant"],["matButton","outlined","color","accent",1,"w-full",3,"disabled"],[1,"!text-5xl","!w-12","!h-12","text-gray-300"],[1,"flex","items-center","gap-1","w-full","justify-between"],["matButton","outlined","color","primary",1,"w-full",3,"disabled"],["mat-mini-fab","","color","warn",1,"!w-8","!h-8","!min-w-0",3,"click"],[1,"!text-lg"],[1,"w-8","text-center","font-semibold","text-gray-900"],["mat-mini-fab","","color","primary",1,"!w-8","!h-8","!min-w-0",3,"click"],["matButton","outlined","color","primary",1,"w-full",3,"click","disabled"],["matButton","outlined","color","accent",1,"w-full",3,"click","disabled"]],template:function(e,i){e&1&&(n(0,"mat-card",0)(1,"div",1),f(2,to,1,2,"img",2)(3,io,3,0,"div",3),f(4,oo,2,0,"div",4)(5,no,2,1,"div",5),r(),n(6,"mat-card-content",6)(7,"h3",7),l(8),r(),n(9,"div",8)(10,"span",9),l(11),B(12,"currency"),r(),f(13,ro,3,6,"span",10),r()(),n(14,"mat-card-actions",11),f(15,co,2,1)(16,so,4,1,"button",12),r()()),e&2&&(c(2),g(i.product().photos&&i.product().photos.length>0?2:3),c(2),g(i.isOutOfStock()?4:i.isLowStock()?5:-1),c(4),T(" ",i.product().name," "),c(3),T(" ",Y(12,6,i.product().price,i.currency(),"symbol","1.0-0")," "),c(2),g(i.product().costPrice&&i.product().costPrice>i.product().price?13:-1),c(2),g(i.hasOptions()?16:15))},dependencies:[G,Ke,We,Qt,$t,N,U,Ee,F,A,ye],styles:["[_nghost-%COMP%]{display:block}.primary-text[_ngcontent-%COMP%]{color:var(--mat-sys-primary-color)}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}"]})};function mo(o,t){if(o&1&&(se(0,"div",2)(1,"span",3),l(2),de(),se(3,"span",4),l(4),B(5,"currency"),de()()),o&2){let e,i=d();c(2),T("Tax (",(e=i.storeStore.selectedStore())==null?null:e.tax,"%)"),c(2),y(Y(5,2,i.cartTotals().tax,i.currency(),"symbol","1.0-0"))}}var Ct=class o{storeStore=m(k);cartStore=m(Me);cartService=m(at);cartSummary=q();cart=$();isActivity=M(()=>this.storeStore.selectedStore()?.category==="683fd24cca109bb62f6b3bd4");cartTotals=M(()=>{let t=this.cartStore.selectedCart()||this.cart(),e=this.cartService.generateCartSummary(t,this.storeStore.selectedStore());return this.cartSummary.emit(e),e});subtotal=$(0);taxRate=$(0);disabled=$(!0);checkoutLabel=$("Checkout");checkout=q();currency=M(()=>this.storeStore.selectedStore()?.currency||"\u20A6");onCheckout(){this.checkout.emit()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-checkout-summary"]],inputs:{cart:[1,"cart"],subtotal:[1,"subtotal"],taxRate:[1,"taxRate"],disabled:[1,"disabled"],checkoutLabel:[1,"checkoutLabel"]},outputs:{cartSummary:"cartSummary",checkout:"checkout"},decls:27,vars:25,consts:[[1,"p-4","border-t","border-outline-variant"],[1,"space-y-2","mb-4"],[1,"flex","justify-between","text-sm"],[1,"text-on-surface-variant"],[1,"font-medium"],[1,"flex","justify-between","text-lg","font-bold","pt-3","border-t","border-outline-variant"],[1,"primary-text"]],template:function(e,i){if(e&1&&(se(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),l(4,"Delivery Fee"),de(),se(5,"span",4),l(6),B(7,"currency"),de()(),se(8,"div",2)(9,"span",3),l(10,"Discount"),de(),se(11,"span",4),l(12),B(13,"currency"),de()(),se(14,"div",2)(15,"span",3),l(16,"Subtotal"),de(),se(17,"span",4),l(18),B(19,"currency"),de()(),f(20,mo,6,7,"div",2),se(21,"div",5)(22,"span"),l(23,"Total"),de(),se(24,"span",6),l(25),B(26,"currency"),de()()()()),e&2){let a;c(6),y(Y(7,5,i.cartTotals().deliveryFee,i.currency(),"symbol","1.0-0")),c(6),y(Y(13,10,i.cartTotals().discount,i.currency(),"symbol","1.0-0")),c(6),y(Y(19,15,i.cartTotals().subtotal,i.currency(),"symbol","1.0-0")),c(2),g(((a=i.storeStore.selectedStore())==null?null:a.tax)>0?20:-1),c(5),y(Y(26,20,i.cartTotals().totalCost,i.currency(),"symbol","1.0-0"))}},dependencies:[G,N,F,ye],styles:["[_nghost-%COMP%]{display:block}.primary-text[_ngcontent-%COMP%]{color:var(--mat-sys-primary)}.text-on-surface-variant[_ngcontent-%COMP%]{color:var(--mat-sys-on-surface-variant)}.border-outline-variant[_ngcontent-%COMP%]{border-color:var(--mat-sys-outline-variant)}"]})};var Ai=(o,t)=>t._id;function uo(o,t){o&1&&(n(0,"mat-icon",14),l(1,"search"),r(),l(2," Search Guest "))}function po(o,t){o&1&&(n(0,"mat-icon",14),l(1,"hotel"),r(),l(2," Select by Room "))}function fo(o,t){o&1&&(n(0,"mat-option",8)(1,"div",15),I(2,"mat-spinner",16),n(3,"span"),l(4,"Loading rooms..."),r()()())}function go(o,t){o&1&&(n(0,"mat-option",8),l(1,"No occupied rooms found"),r())}function _o(o,t){if(o&1&&(n(0,"span",20),l(1),r()),o&2){let e=d().$implicit,i=d(2);c(),T(" - ",i.getRoomGuestName(e)," ")}}function Co(o,t){if(o&1&&(n(0,"mat-option",17)(1,"div",15)(2,"mat-icon",18),l(3,"door_front"),r(),n(4,"span",19),l(5),r(),f(6,_o,2,1,"span",20),r()()),o&2){let e=t.$implicit;v("value",e),c(5),T("Room ",e.roomNumber),c(),g(e.currentGuest?6:-1)}}function ho(o,t){if(o&1&&z(0,Co,7,3,"mat-option",17,Ai),o&2){let e=d();H(e.occupiedRooms())}}function vo(o,t){o&1&&(n(0,"div",22)(1,"mat-icon",24),l(2,"person_off"),r(),n(3,"p",25),l(4,"No guest information available for this room"),r()())}function bo(o,t){if(o&1&&(n(0,"mat-radio-button",27)(1,"div",28)(2,"mat-icon",29),l(3,"person"),r(),n(4,"div")(5,"div",19),l(6),r(),n(7,"div",20),l(8),r()()()()),o&2){let e=t.$implicit,i=d(3);v("value",e),c(6),y(i.guestService.getGuestName(e)),c(2),T(" ",e.email||e.phone||"No contact info"," ")}}function So(o,t){if(o&1){let e=S();n(0,"mat-radio-group",26),u("change",function(a){C(e);let s=d(2);return h(s.onRoomGuestSelected(a.value))}),z(1,bo,9,3,"mat-radio-button",27,Ai),r()}if(o&2){let e=d(2);v("value",e.selectedGuest()),c(),H(e.availableRoomGuests())}}function xo(o,t){if(o&1&&(n(0,"div",9)(1,"h4",21),l(2),r(),f(3,vo,5,0,"div",22)(4,So,3,1,"mat-radio-group",23),r()),o&2){let e,i=d();c(2),T(" Guests in Room ",(e=i.selectedRoom())==null?null:e.roomNumber," "),c(),g(i.availableRoomGuests().length===0?3:4)}}function yo(o,t){if(o&1){let e=S();n(0,"div",10)(1,"div",30)(2,"div",31)(3,"mat-icon",32),l(4,"check_circle"),r(),n(5,"div")(6,"div",33),l(7),r(),n(8,"div",34),l(9),r()()(),n(10,"button",35),u("click",function(){C(e);let a=d();return h(a.removeGuest())}),n(11,"mat-icon"),l(12,"close"),r()()()()}if(o&2){let e,i=d();c(7),y(i.guestService.getGuestName(i.selectedGuest())),c(2),T(" ",((e=i.selectedGuest())==null?null:e.email)||((e=i.selectedGuest())==null?null:e.phone)||"No contact info"," ")}}function Mo(o,t){if(o&1){let e=S();n(0,"button",36),u("click",function(){C(e);let a=d();return h(a.confirmSelection())}),l(1," Confirm "),r()}}var ht=class o{dialogRef=m(ie);dialogData=m(oe);guestService=m(lt);roomsService=m(Ei);storeStore=m(k);selectedGuest=P(this.dialogData?.selectedGuest||null);selectionMode=P("search");occupiedRooms=P([]);loadingRooms=P(!1);selectedRoom=P(null);roomGuests=P([]);availableRoomGuests=M(()=>{let t=this.selectedRoom();if(!t)return[];let e=[];if(t.currentReservation&&typeof t.currentReservation=="object"){let i=t.currentReservation;if(i.rooms&&Array.isArray(i.rooms)){let a=i.rooms.find(s=>(typeof s.room=="object"?s.room._id:s.room)===t._id);a?.assignedGuest&&typeof a.assignedGuest=="object"&&e.push(a.assignedGuest)}}return e.length===0&&t.currentGuest&&typeof t.currentGuest=="object"&&e.push(t.currentGuest),e});ngOnInit(){this.loadOccupiedRooms()}loadOccupiedRooms(){let t=this.storeStore.selectedStore()?._id;t&&(this.loadingRooms.set(!0),this.roomsService.getRooms(t,{status:["occupied"]}).subscribe({next:e=>{this.occupiedRooms.set(e),this.loadingRooms.set(!1)},error:()=>{this.loadingRooms.set(!1)}}))}onRoomSelected(t){this.selectedRoom.set(t),this.selectionMode()==="room"&&this.selectedGuest.set(null)}onRoomGuestSelected(t){this.selectedGuest.set(t)}onGuestSelected(t){this.selectedGuest.set(t)}removeGuest(){this.selectedGuest.set(null),this.dialogRef.close({guest:null,action:"remove"})}confirmSelection(){this.dialogRef.close({guest:this.selectedGuest(),action:"select"})}onTabChange(t){this.selectionMode.set(t===0?"search":"room"),this.selectedGuest.set(null),this.selectedRoom.set(null)}getRoomGuestName(t){return t.currentGuest?typeof t.currentGuest=="string"?t.currentGuest:this.guestService.getGuestName(t.currentGuest):""}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-guest-selection-dialog"]],decls:24,vars:4,consts:[["mat-dialog-title",""],[1,"min-w-[450px]"],[1,"guest-tabs",3,"selectedTabChange"],["mat-tab-label",""],[1,"pt-4"],["label","Search Guest","placeholder","Search by name, email or phone...",3,"guestSelected"],["appearance","outline",1,"w-full"],[3,"selectionChange"],["disabled",""],[1,"mt-4"],[1,"mt-4","p-3","bg-green-50","border","border-green-200","rounded-lg"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary"],[1,"mr-2"],[1,"flex","items-center","gap-2"],["diameter","20"],[3,"value"],[1,"text-primary"],[1,"font-medium"],[1,"text-gray-500","text-sm"],[1,"text-sm","font-medium","text-gray-600","mb-2"],[1,"text-gray-500","text-sm","p-4","bg-gray-50","rounded-lg","text-center"],[1,"flex","flex-col","gap-2",3,"value"],[1,"text-gray-400"],[1,"mt-2"],[1,"flex","flex-col","gap-2",3,"change","value"],[1,"guest-radio-option",3,"value"],[1,"flex","items-center","gap-3","py-2"],[1,"text-gray-500"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"text-green-600"],[1,"font-medium","text-green-800"],[1,"text-green-600","text-sm"],["mat-icon-button","","color","warn","matTooltip","Remove selection",3,"click"],["mat-flat-button","","color","primary",3,"click"]],template:function(e,i){e&1&&(n(0,"h2",0),l(1,"Select Hotel Guest"),r(),n(2,"mat-dialog-content",1)(3,"mat-tab-group",2),u("selectedTabChange",function(s){return i.onTabChange(s.index)}),n(4,"mat-tab"),Mt(5,uo,3,0,"ng-template",3),n(6,"div",4)(7,"app-guest-search",5),u("guestSelected",function(s){return i.onGuestSelected(s)}),r()()(),n(8,"mat-tab"),Mt(9,po,3,0,"ng-template",3),n(10,"div",4)(11,"mat-form-field",6)(12,"mat-label"),l(13,"Select Occupied Room"),r(),n(14,"mat-select",7),u("selectionChange",function(s){return i.onRoomSelected(s.value)}),f(15,fo,5,0,"mat-option",8)(16,go,2,0,"mat-option",8)(17,ho,2,0),r()(),f(18,xo,5,2,"div",9),r()()(),f(19,yo,13,2,"div",10),r(),n(20,"mat-dialog-actions",11)(21,"button",12),l(22,"Cancel"),r(),f(23,Mo,2,0,"button",13),r()),e&2&&(c(15),g(i.loadingRooms()?15:i.occupiedRooms().length===0?16:17),c(3),g(i.selectedRoom()?18:-1),c(),g(i.selectedGuest()?19:-1),c(4),g(i.selectedGuest()?23:-1))},dependencies:[G,le,Qe,ne,ae,re,N,U,me,F,A,Ae,nt,ei,Xt,Yt,Zt,Jt,ee,ue,Ht,Nt,X,_e,ge,wi,Ti,Pi,Be,Le,Z,ki],styles:["mat-dialog-content[_ngcontent-%COMP%]{min-width:450px;max-width:550px;max-height:70vh}.guest-radio-option[_ngcontent-%COMP%]{display:block;padding:.5rem;border-radius:.5rem;border:1px solid #e5e7eb;transition:all .2s ease}.guest-radio-option[_ngcontent-%COMP%]:hover{background-color:#f9fafb;border-color:#d1d5db}.guest-radio-option.mat-mdc-radio-checked[_ngcontent-%COMP%]{background-color:#eff6ff;border-color:#3b82f6}  .mat-mdc-radio-button .mdc-radio{margin-right:.5rem}"]})};var Do=(o,t)=>t._id;function To(o,t){o&1&&I(0,"mat-spinner",6)}function Po(o,t){o&1&&(n(0,"div",8),I(1,"mat-spinner",16),r())}function wo(o,t){if(o&1){let e=S();n(0,"div",9)(1,"mat-icon",17),l(2,"person_off"),r(),n(3,"p",18),l(4),r(),n(5,"button",19),u("click",function(){C(e);let a=d();return h(a.openCreateCustomerDialog())}),n(6,"mat-icon"),l(7,"add"),r(),l(8," Create New Customer "),r()()}if(o&2){let e=d();c(4),T('No customers found matching "',e.searchQuery(),'"')}}function ko(o,t){o&1&&(n(0,"mat-icon",25),l(1,"check_circle"),r())}function Eo(o,t){if(o&1){let e=S();n(0,"mat-list-item",21),u("click",function(){let a=C(e).$implicit,s=d(2);return h(s.onCustomerSelected(a))}),n(1,"mat-icon",22),l(2,"person"),r(),n(3,"div",23),l(4),r(),n(5,"div",24),l(6),r(),f(7,ko,2,0,"mat-icon",25),r()}if(o&2){let e,i,a,s=t.$implicit,p=d(2);ke("bg-blue-50",((e=p.selectedCustomer())==null?null:e._id)===s._id)("border-blue-300",((i=p.selectedCustomer())==null?null:i._id)===s._id),c(4),y(s.name||"No Name"),c(2),T(" ",s.email||s.phoneNumber||"No contact info"," "),c(),g(((a=p.selectedCustomer())==null?null:a._id)===s._id?7:-1)}}function Oo(o,t){if(o&1&&(n(0,"mat-list",10),z(1,Eo,8,7,"mat-list-item",20,Do),r()),o&2){let e=d();c(),H(e.filteredCustomers())}}function Io(o,t){o&1&&(n(0,"div",11),l(1," Type at least 2 characters to search "),r())}function Ro(o,t){if(o&1){let e=S();n(0,"div",12)(1,"div",26)(2,"div",27)(3,"mat-icon",28),l(4,"check_circle"),r(),n(5,"div")(6,"div",29),l(7),r(),n(8,"div",30),l(9),r()()(),n(10,"button",31),u("click",function(){C(e);let a=d();return h(a.removeCustomer())}),n(11,"mat-icon"),l(12,"close"),r()()()()}if(o&2){let e=d();c(7),y(e.getCustomerDisplayName(e.selectedCustomer())),c(2),T(" ",e.getCustomerContact(e.selectedCustomer())," ")}}function Vo(o,t){if(o&1){let e=S();n(0,"button",32),u("click",function(){C(e);let a=d();return h(a.confirmSelection())}),l(1," Confirm "),r()}}var vt=class o{dialogRef=m(ie);dialogData=m(oe);customerService=m(Si);storeStore=m(k);dialog=m($e);selectedCustomer=P(this.dialogData?.selectedCustomer||null);searchQuery=P("");customers=P([]);filteredCustomers=P([]);loading=P(!1);searchPerformed=P(!1);searchSubject=new wt;constructor(){this.searchSubject.pipe(kt(300),j(t=>{if(!t||t.length<2)return this.filteredCustomers.set([]),this.searchPerformed.set(!1),ze([]);this.loading.set(!0),this.searchPerformed.set(!0);let e=this.customers();if(e.length>0){let i=e.filter(a=>a.name?.toLowerCase().includes(t.toLowerCase())||a.email?.toLowerCase().includes(t.toLowerCase())||a.phoneNumber?.includes(t));return this.filteredCustomers.set(i),this.loading.set(!1),ze(i)}return ze([])}),Wt()).subscribe()}ngOnInit(){this.loadCustomers()}loadCustomers(){let t=this.storeStore.selectedStore()?._id;t&&(this.loading.set(!0),this.customerService.getStoreCustomers(t).subscribe({next:e=>{this.customers.set(e),this.loading.set(!1)},error:()=>{this.loading.set(!1)}}))}onSearch(t){this.searchQuery.set(t),this.searchSubject.next(t)}onCustomerSelected(t){this.selectedCustomer.set(t)}removeCustomer(){this.selectedCustomer.set(null),this.dialogRef.close({customer:null,action:"remove"})}confirmSelection(){this.dialogRef.close({customer:this.selectedCustomer(),action:"select"})}openCreateCustomerDialog(){this.dialog.open(xi,{width:"500px",data:{isEdit:!1}}).afterClosed().subscribe(e=>{e&&this.loadCustomers()})}getCustomerDisplayName(t){return t?t.name||t.email||"Unknown Customer":""}getCustomerContact(t){return t?t.email||t.phoneNumber||"No contact info":""}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-customer-selection-dialog"]],decls:25,vars:5,consts:[["mat-dialog-title","",1,"flex","items-center","justify-between"],["mat-stroked-button","","color","primary",3,"click"],[1,"min-w-[450px]"],["appearance","outline",1,"w-full"],["matPrefix","",1,"mr-2"],["matInput","","placeholder","Search by name, email or phone...","autocomplete","off",3,"input","value"],["matSuffix","","diameter","20"],[1,"customer-results","mt-2"],[1,"flex","items-center","justify-center","p-8"],[1,"text-center","p-6","bg-gray-50","rounded-lg"],[1,"customer-list"],[1,"text-center","p-4","text-gray-500","text-sm"],[1,"mt-4","p-3","bg-green-50","border","border-green-200","rounded-lg"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary"],["diameter","40"],[1,"text-gray-400","text-4xl"],[1,"text-gray-500","mt-2"],["mat-stroked-button","","color","primary",1,"mt-3",3,"click"],[1,"customer-item","cursor-pointer","hover:bg-gray-50","rounded-lg","mb-1",3,"bg-blue-50","border-blue-300"],[1,"customer-item","cursor-pointer","hover:bg-gray-50","rounded-lg","mb-1",3,"click"],["matListItemIcon","",1,"text-gray-500"],["matListItemTitle","",1,"font-medium"],["matListItemLine","",1,"text-gray-500","text-sm"],["matListItemMeta","",1,"text-blue-500"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"text-green-600"],[1,"font-medium","text-green-800"],[1,"text-green-600","text-sm"],["mat-icon-button","","color","warn","matTooltip","Remove selection",3,"click"],["mat-flat-button","","color","primary",3,"click"]],template:function(e,i){e&1&&(n(0,"h2",0)(1,"span"),l(2,"Select Customer"),r(),n(3,"button",1),u("click",function(){return i.openCreateCustomerDialog()}),n(4,"mat-icon"),l(5,"add"),r(),l(6," New Customer "),r()(),n(7,"mat-dialog-content",2)(8,"mat-form-field",3)(9,"mat-label"),l(10,"Search Customer"),r(),n(11,"mat-icon",4),l(12,"search"),r(),n(13,"input",5),u("input",function(s){return i.onSearch(s.target.value)}),r(),f(14,To,1,0,"mat-spinner",6),r(),n(15,"div",7),f(16,Po,2,0,"div",8)(17,wo,9,1,"div",9)(18,Oo,3,0,"mat-list",10)(19,Io,2,0,"div",11),r(),f(20,Ro,13,2,"div",12),r(),n(21,"mat-dialog-actions",13)(22,"button",14),l(23,"Cancel"),r(),f(24,Vo,2,0,"button",15),r()),e&2&&(c(13),v("value",i.searchQuery()),c(),g(i.loading()?14:-1),c(2),g(i.loading()&&i.customers().length===0?16:i.searchPerformed()&&i.filteredCustomers().length===0&&i.searchQuery().length>=2?17:i.filteredCustomers().length>0?18:i.searchQuery().length<2&&i.customers().length>0?19:-1),c(4),g(i.selectedCustomer()?20:-1),c(4),g(i.selectedCustomer()?24:-1))},dependencies:[G,le,Qe,ne,ae,re,N,U,me,F,A,Ae,ri,ai,ni,ii,ti,oi,nt,X,ee,ue,pe,ot,te,fe,_e,ge,Be,Le,Z],styles:["mat-dialog-content[_ngcontent-%COMP%]{min-width:450px;max-width:550px;max-height:70vh}.customer-list[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}.customer-item[_ngcontent-%COMP%]{border:1px solid transparent;transition:all .2s ease}.customer-item[_ngcontent-%COMP%]:hover{background-color:#f9fafb;border-color:#e5e7eb}.customer-item.bg-blue-50[_ngcontent-%COMP%]{border-color:#93c5fd}"]})};var Go=o=>({prefix:o});function No(o,t){if(o&1&&I(0,"input",8),o&2){let e,i=d();v("options",Je(2,Go,((e=i.storeStore.selectedStore())==null?null:e.currency)+" "))("placeholder",i.valueLabel)}}function Ao(o,t){if(o&1&&I(0,"input",9),o&2){let e=d();v("placeholder",e.valueLabel)}}function Lo(o,t){o&1&&(n(0,"mat-error"),l(1,"Value is required"),r())}function Bo(o,t){o&1&&(n(0,"mat-error"),l(1,"Value must be a positive number"),r())}function $o(o,t){if(o&1){let e=S();n(0,"button",15),u("click",function(){C(e);let a=d();return h(a.onRemoveDiscount())}),l(1," Remove Discount "),r()}}var bt=class o{dialogRef=m(ie);data=m(oe);fb=m(tt);storeStore=m(k);discountForm=this.fb.group({discountType:[this.data?.discount?.discountType||"Amount",we.required],value:[this.data?.discount?.value||"",[we.required,we.min(0)]],reference:[this.data?.discount?.reference||""]});get f(){return this.discountForm.controls}get valueLabel(){return this.f.discountType.value==="Amount"?"Enter Amount":"Enter Percentage"}get valueIcon(){return this.f.discountType.value==="Amount"?"attach_money":"percent"}onCancel(){this.dialogRef.close()}onApply(){this.discountForm.valid&&this.dialogRef.close(this.discountForm.getRawValue())}onRemoveDiscount(){this.dialogRef.close({discountType:"",value:0,reference:""})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-add-discount"]],decls:35,vars:8,consts:[["mat-dialog-title",""],[3,"formGroup"],[1,"toggle-section"],["formControlName","discountType","aria-label","Discount Type"],["value","Amount"],["value","Percentage"],["appearance","outline",1,"full-width"],["matPrefix",""],["matInput","","currencyMask","","formControlName","value",3,"options","placeholder"],["matInput","","type","number","formControlName","value",3,"placeholder"],["matInput","","type","text","formControlName","reference","placeholder","Enter reference or reason"],["align","end"],["mat-button","","color","warn"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],["mat-button","","color","warn",3,"click"]],template:function(e,i){e&1&&(n(0,"h2",0),l(1,"Apply Discount"),r(),n(2,"mat-dialog-content")(3,"form",1)(4,"div",2)(5,"mat-button-toggle-group",3)(6,"mat-button-toggle",4)(7,"mat-icon"),l(8,"attach_money"),r(),l(9," Amount "),r(),n(10,"mat-button-toggle",5)(11,"mat-icon"),l(12,"percent"),r(),l(13," Percentage "),r()()(),n(14,"mat-form-field",6)(15,"mat-label"),l(16),r(),n(17,"mat-icon",7),l(18),r(),f(19,No,1,4,"input",8)(20,Ao,1,1,"input",9),f(21,Lo,2,0,"mat-error"),f(22,Bo,2,0,"mat-error"),r(),n(23,"mat-form-field",6)(24,"mat-label"),l(25,"Reference (Optional)"),r(),n(26,"mat-icon",7),l(27,"note"),r(),I(28,"input",10),r()()(),n(29,"mat-dialog-actions",11),f(30,$o,2,0,"button",12),n(31,"button",13),u("click",function(){return i.onCancel()}),l(32,"Cancel"),r(),n(33,"button",14),u("click",function(){return i.onApply()}),l(34," Apply "),r()()),e&2&&(c(3),v("formGroup",i.discountForm),c(13),y(i.valueLabel),c(2),y(i.valueIcon),c(),g(i.f.discountType.value==="Amount"?19:20),c(2),g(i.f.value.hasError("required")&&i.f.value.touched?21:-1),c(),g(i.f.value.hasError("min")?22:-1),c(8),g(i.data.discount!=null&&i.data.discount.value?30:-1),c(3),v("disabled",i.discountForm.invalid))},dependencies:[G,Z,Ye,Fe,zt,Ge,Xe,Ne,et,Ze,le,ne,ae,re,N,U,ui,di,mi,X,ee,ue,it,pe,te,fe,F,A,st,ct],styles:[".toggle-section[_ngcontent-%COMP%]{margin-bottom:24px}.toggle-section[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}.toggle-section[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{flex:1}.toggle-section[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}"],changeDetection:0})};var Qo=o=>({prefix:o});function qo(o,t){o&1&&(n(0,"mat-error"),l(1,"Delivery fee is required"),r())}function jo(o,t){o&1&&(n(0,"mat-error"),l(1,"Delivery fee must be a positive number"),r())}function Uo(o,t){if(o&1){let e=S();n(0,"button",9),u("click",function(){C(e);let a=d();return h(a.onRemoveDelivery())}),l(1," Remove Delivery "),r()}}var St=class o{dialogRef=m(ie);data=m(oe);fb=m(tt);storeStore=m(k);deliveryForm=this.fb.group({deliveryFee:[this.data?.deliveryFee||"",[we.required,we.min(0)]]});get f(){return this.deliveryForm.controls}onCancel(){this.dialogRef.close()}onApply(){this.deliveryForm.valid&&this.dialogRef.close(this.deliveryForm.getRawValue())}onRemoveDelivery(){this.dialogRef.close({deliveryFee:0,address:""})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-add-delivery"]],decls:18,vars:8,consts:[["mat-dialog-title",""],[3,"formGroup"],["appearance","outline",1,"full-width"],["matPrefix",""],["matInput","","currencyMask","","formControlName","deliveryFee","placeholder","Enter delivery fee",3,"options"],["align","end"],["mat-button","","color","warn"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],["mat-button","","color","warn",3,"click"]],template:function(e,i){if(e&1&&(n(0,"h2",0),l(1,"Add Delivery Fee"),r(),n(2,"mat-dialog-content")(3,"form",1)(4,"mat-form-field",2)(5,"mat-label"),l(6,"Delivery Fee"),r(),n(7,"mat-icon",3),l(8,"local_shipping"),r(),I(9,"input",4),f(10,qo,2,0,"mat-error"),f(11,jo,2,0,"mat-error"),r()()(),n(12,"mat-dialog-actions",5),f(13,Uo,2,0,"button",6),n(14,"button",7),u("click",function(){return i.onCancel()}),l(15,"Cancel"),r(),n(16,"button",8),u("click",function(){return i.onApply()}),l(17," Apply "),r()()),e&2){let a;c(3),v("formGroup",i.deliveryForm),c(6),v("options",Je(6,Qo,((a=i.storeStore.selectedStore())==null?null:a.currency)+" ")),c(),g(i.f.deliveryFee.hasError("required")&&i.f.deliveryFee.touched?10:-1),c(),g(i.f.deliveryFee.hasError("min")?11:-1),c(2),g(i.data.deliveryFee?13:-1),c(3),v("disabled",i.deliveryForm.invalid)}},dependencies:[G,Z,Ye,Fe,Ge,Xe,Ne,et,Ze,le,ne,ae,re,N,U,X,ee,ue,it,pe,te,fe,F,A,st,ct],styles:[".full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}"],changeDetection:0})};function zo(o,t){o&1&&(n(0,"div",4),I(1,"mat-spinner"),r())}function Ho(o,t){o&1&&I(0,"app-no-record",5)}function Jo(o,t){if(o&1){let e=S();n(0,"div")(1,"app-table-card",12),u("tableClick",function(a){C(e);let s=d(2);return h(s.onTableSelect(a))}),r()()}if(o&2){let e=t.$implicit;ke("opacity-50",e.orderId)("pointer-events-none",e.orderId),c(),v("table",e)("hideActions",!0)}}function Wo(o,t){o&1&&I(0,"app-no-record",11)}function Ko(o,t){if(o&1&&(n(0,"div",9),z(1,Jo,2,6,"div",10,Te),r(),f(3,Wo,1,0,"app-no-record",11)),o&2){let e=d();c(),H(e.filteredTables),c(2),g(e.filteredTables.length===0?3:-1)}}function Xo(o,t){if(o&1){let e=S();n(0,"button",13),u("click",function(){C(e);let a=d();return h(a.onRemoveSelection())}),l(1," Remove Selection "),r()}}var xt=class o{dialogRef=m(ie);data=m(oe);tableService=m(bi);storeStore=m(k);searchQuery=P("");selectedTable=P(this.data?.selectedTable||null);tablesResource=Kt({params:()=>({storeId:this.storeStore.selectedStore()._id}),stream:({params:t})=>this.tableService.getStoreTables(t.storeId)});onSearchChange(t){this.searchQuery.set(t)}get filteredTables(){let t=this.tablesResource.value()||[],e=this.searchQuery().toLowerCase();return(e?t.filter(a=>a.name.toLowerCase().includes(e)):t).sort((a,s)=>{let p=!!a.orderId,O=!!s.orderId;return p===O?0:p?1:-1})}onTableSelect(t){if(t.orderId)return;let e={action:"select",table:t};this.dialogRef.close(e)}onRemoveSelection(){let t={action:"remove"};this.dialogRef.close(t)}onCancel(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-table-selection-dialog"]],decls:16,vars:5,consts:[["mat-dialog-title",""],["appearance","outline",1,"w-full","mb-4"],["matInput","","placeholder","Search by table name...",3,"input","value"],["matPrefix",""],[1,"flex","items-center","justify-center","py-12"],["icon","error_outline","title","Failed to Load Tables","message","Unable to load tables. Please try again."],["align","end"],["mat-button","","color","warn"],["mat-button","",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","max-h-[60vh]","overflow-y-auto"],[3,"opacity-50","pointer-events-none"],["icon","table_restaurant","title","No Tables Found","message","No tables match your search criteria."],[3,"tableClick","table","hideActions"],["mat-button","","color","warn",3,"click"]],template:function(e,i){e&1&&(n(0,"h2",0),l(1,"Select Table"),r(),n(2,"mat-dialog-content")(3,"mat-form-field",1)(4,"mat-label"),l(5,"Search tables"),r(),n(6,"input",2),u("input",function(s){return i.onSearchChange(s.target.value)}),r(),n(7,"mat-icon",3),l(8,"search"),r()(),f(9,zo,2,0,"div",4),f(10,Ho,1,0,"app-no-record",5),f(11,Ko,4,1),r(),n(12,"mat-dialog-actions",6),f(13,Xo,2,0,"button",7),n(14,"button",8),u("click",function(){return i.onCancel()}),l(15,"Cancel"),r()()),e&2&&(c(6),v("value",i.searchQuery()),c(3),g(i.tablesResource.isLoading()?9:-1),c(),g(i.tablesResource.error()?10:-1),c(),g(i.tablesResource.value()&&!i.tablesResource.isLoading()?11:-1),c(2),g(i.selectedTable()?13:-1))},dependencies:[G,le,ne,ae,re,N,U,F,A,X,ee,ue,pe,te,fe,_e,ge,Z,Oi,pi],styles:["[_nghost-%COMP%]{display:block}"]})};function Yo(o,t){if(o&1){let e=S();n(0,"button",21),u("click",function(){C(e);let a=d();return h(a.onSelectCustomer())}),n(1,"mat-icon"),l(2,"person"),r(),n(3,"span",22),l(4),r()()}if(o&2){let e,i,a=d();v("matTooltip",((e=a.selectedCustomer())==null?null:e.name)||((e=a.selectedCustomer())==null?null:e.email)),c(4),y(((i=a.selectedCustomer())==null?null:i.name)||"Customer")}}function Zo(o,t){if(o&1){let e=S();n(0,"button",15),u("click",function(){C(e);let a=d();return h(a.onSelectCustomer())}),n(1,"mat-icon"),l(2,"person"),r(),n(3,"span",23),l(4,"Customer"),r()()}}function en(o,t){if(o&1){let e=S();n(0,"button",21),u("click",function(){C(e);let a=d();return h(a.onSelectGuest())}),n(1,"mat-icon"),l(2,"hotel"),r(),n(3,"span",22),l(4),r()()}if(o&2){let e=d();v("matTooltip",e.guestService.getGuestName(e.selectedGuest())),c(4),y(e.guestService.getGuestName(e.selectedGuest()))}}function tn(o,t){if(o&1){let e=S();n(0,"button",15),u("click",function(){C(e);let a=d();return h(a.onSelectGuest())}),n(1,"mat-icon"),l(2,"hotel"),r(),n(3,"span",23),l(4,"Guest"),r()()}}function on(o,t){if(o&1){let e=S();n(0,"button",24),u("click",function(){C(e);let a=d();return h(a.onSelectTable())}),n(1,"mat-icon"),l(2,"table_restaurant"),r(),n(3,"span",22),l(4),r()()}if(o&2){let e,i,a=d();v("matTooltip",(e=a.tableStore.selectedTable())==null?null:e.name),c(4),y((i=a.tableStore.selectedTable())==null?null:i.name)}}function nn(o,t){if(o&1){let e=S();n(0,"button",25),u("click",function(){C(e);let a=d();return h(a.onSelectTable())}),n(1,"mat-icon"),l(2,"table_restaurant"),r(),n(3,"span",23),l(4,"Table"),r()()}}function rn(o,t){if(o&1){let e=S();n(0,"div",8)(1,"button",26),u("click",function(){C(e);let a=d();return h(a.cancelSales())}),n(2,"mat-icon"),l(3,"delete_outline"),r(),n(4,"span"),l(5,"Clear Cart"),r()()()}}function an(o,t){if(o&1&&I(0,"img",29),o&2){let e=d().$implicit;v("src",e.photos[0],He)("alt",e.name)}}function ln(o,t){o&1&&(n(0,"div",30)(1,"mat-icon",42),l(2,"image"),r()())}function cn(o,t){if(o&1&&(n(0,"p",34),l(1),r()),o&2){let e=d().$implicit,i=d();c(),T(" ",i.getOptionsDisplay(e).join(", ")," ")}}function sn(o,t){if(o&1){let e=S();n(0,"mat-card",10)(1,"div",27)(2,"div",28),f(3,an,1,2,"img",29)(4,ln,3,0,"div",30),r(),n(5,"div",31)(6,"h4",32),l(7),r(),n(8,"p",33),l(9),B(10,"currency"),r(),f(11,cn,2,1,"p",34),n(12,"div",35)(13,"div",2)(14,"button",36),u("click",function(){let a=C(e).$implicit,s=d();return h(s.removeOrDeleteProduct(a))}),n(15,"mat-icon"),l(16,"remove"),r()(),n(17,"span",37),l(18),r(),n(19,"button",38),u("click",function(a){let s=C(e).$implicit,p=d();return h(p.onAddToCart(a,s))}),n(20,"mat-icon"),l(21,"add"),r()()(),n(22,"span",39),l(23),B(24,"currency"),r()()(),n(25,"button",40),u("click",function(){let a=C(e).$implicit,s=d();return h(s.onRemoveItem(a._id))}),n(26,"mat-icon",41),l(27,"close"),r()()()()}if(o&2){let e=t.$implicit,i=d();c(3),g(e.photos&&e.photos.length>0?3:4),c(4),y(e.name),c(2),T(" ",Y(10,6,e.price,i.currency(),"symbol","1.0-0")," "),c(2),g(i.getOptionsDisplay(e).length>0?11:-1),c(7),y(e.quantity),c(5),T(" ",Y(24,11,i.getProductTotal(e),i.currency(),"symbol","1.0-0")," ")}}function dn(o,t){o&1&&(n(0,"div",11)(1,"mat-icon",43),l(2,"shopping_cart"),r(),n(3,"p",44),l(4,"Cart is empty"),r(),n(5,"p",45),l(6,"Add products to start an order"),r()())}function mn(o,t){if(o&1){let e=S();n(0,"div",12)(1,"app-checkout-summary",46),u("cartSummary",function(a){C(e);let s=d();return h(s.cartSummaryChange(a))}),r()()}}var yt=class o{storeStore=m(k);accountService=m(Bt);cartStore=m(Me);cartService=m(at);tableStore=m(Ri);guestService=m(lt);saleTypeStore=m(Vi);dialog=m($e);snackBar=m(Lt);orderStore=m(Fi);selectedUser=this.accountService.currentUserValue;cartSummary;selectedGuest=P(null);selectedCustomer=P(null);selectedBuyerName=M(()=>{let t=this.selectedGuest(),e=this.selectedCustomer();return t?this.guestService.getGuestName(t):e?e.name||e.email||"Customer":"Select Buyer"});hasSelectedBuyer=M(()=>!!this.selectedGuest()||!!this.selectedCustomer());buyerType=M(()=>this.selectedGuest()?"guest":this.selectedCustomer()?"customer":null);items=$([]);taxRate=$(0);increment=q();decrement=q();removeItem=q();clearCart=q();addToCart=q();currency=M(()=>this.storeStore.selectedStore()?.currency||"\u20A6");itemsCount=M(()=>this.cartStore.selectedCart()?.products.reduce((t,e)=>t+e.quantity,0));cartItemTap(t){(t?.options).length>0?this.openOptions(t):this.cartStore.updateCartAction("add")}openOptions(t){}isEmpty=M(()=>(console.log("Cart products length:",this.cartStore.selectedCart()),!this.cartStore.selectedCart()||this.cartStore.selectedCart()?.products.length===0));onAddToCart(t,e){t.stopPropagation(),this.addToCart.emit(e)}getProductTotal(t){let e=t.price*t.quantity;if(t.options&&t.options.length>0){let i=this.cartService.getTotalForSelectedOptions(t.options);return e+i*t.quantity}return e}removeOrDeleteProduct(t){t.quantity>1?this.cartStore.decrementProductQuantity(t._id):this.deleteProductFromCart(t._id)}deleteProductFromCart(t){this.cartStore.updateCartAction("delete"),this.cartStore.removeFromCart(this.cartStore.selectedCart()._id,t)}getOptionsDisplay(t){if(!t.options||t.options.length===0)return[];let e=[];return t.options.forEach(i=>{i.options&&i.options.forEach(a=>{a.selected&&e.push(`${a.name}${a.quantity>1?" x"+a.quantity:""}`)})}),e}onIncrement(t){this.increment.emit(t)}onDecrement(t){this.decrement.emit(t)}onRemoveItem(t){this.deleteProductFromCart(t),this.removeItem.emit(t)}resetSalesSection(){this.cartStore.removeSelectedCart(),this.saleTypeStore.setDefaultSaleType(),this.tableStore.clearSelectedTable(),this.selectedCustomer.set(null),this.selectedGuest.set(null),this.clearCart.emit()}cancelSales(){this.dialog.open(Di,{width:"400px",data:{title:"Cancel Sale",message:"Are you sure you want to cancel this sale? This action cannot be undone."}}).afterClosed().subscribe(e=>{e&&(this.snackBar.open("Sale cancelled","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"}),this.resetSalesSection())})}ngOnDestroy(){this.resetSalesSection()}onSelectCustomer(){this.openCustomerSelectionDialog()}onSelectTable(){let t={selectedTable:this.tableStore.selectedTable()};this.dialog.open(xt,{data:t}).afterClosed().subscribe(i=>{i&&(i.action==="select"&&i.table?(this.tableStore.selectTable(i.table._id),this.snackBar.open(`Table "${i.table.name}" selected`,"Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"})):i.action==="remove"&&(this.tableStore.clearSelectedTable(),this.snackBar.open("Table selection removed","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"})))})}onSelectOrderType(){console.log("Select order type")}onSelectGuest(){this.openGuestSelectionDialog()}openCustomerSelectionDialog(){let t={selectedCustomer:this.selectedCustomer()};this.dialog.open(vt,{width:"500px",maxHeight:"80vh",data:t}).afterClosed().subscribe(i=>{if(i){if(i.action==="select"&&i.customer){this.selectedGuest.set(null),this.selectedCustomer.set(i.customer);let a=this.cartStore.selectedCart();a&&this.cartStore.updateCartUser(a._id,i.customer._id),this.snackBar.open(`Customer "${i.customer.name||i.customer.email}" selected`,"Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"})}else if(i.action==="remove"){this.selectedCustomer.set(null);let a=this.cartStore.selectedCart();a&&this.cartStore.updateCartUser(a._id,""),this.snackBar.open("Customer removed","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"})}}})}openGuestSelectionDialog(){let t={selectedGuest:this.selectedGuest()};this.dialog.open(ht,{width:"500px",maxHeight:"80vh",data:t}).afterClosed().subscribe(i=>{i&&(i.action==="select"&&i.guest?(this.selectedCustomer.set(null),this.selectedGuest.set(i.guest),this.snackBar.open(`Guest "${this.guestService.getGuestName(i.guest)}" selected`,"Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"})):i.action==="remove"&&(this.selectedGuest.set(null),this.snackBar.open("Guest removed","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"})))})}onSelectBuyer(){this.selectedGuest()?this.openGuestSelectionDialog():this.selectedCustomer()&&this.openCustomerSelectionDialog()}clearBuyerSelection(){this.selectedGuest.set(null),this.selectedCustomer.set(null)}onApplyDiscount(){this.dialog.open(bt,{width:"450px",data:{discount:this.cartStore.selectedCart()?.discount}}).afterClosed().subscribe(e=>{if(e){let i=this.cartStore.selectedCart();i&&(this.cartStore.updateCartDiscount(i._id,e),e.value>0?this.snackBar.open(`Discount applied: ${e.discountType} - ${e.value}`,"Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"}):this.snackBar.open("Discount removed","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"}))}})}onApplyDelivery(){this.dialog.open(St,{width:"450px",data:{deliveryFee:this.cartStore.selectedCart()?.delivery,address:""}}).afterClosed().subscribe(e=>{if(e){let i=this.cartStore.selectedCart();i&&(this.cartStore.updateCartDelivery(i._id,e.deliveryFee),e.deliveryFee>0?this.snackBar.open(`Delivery fee applied: ${e.deliveryFee}`,"Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"}):this.snackBar.open("Delivery fee removed","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"}))}})}onGenerateBill(){console.log("Generate bill")}onPendOrder(){this.cartStore.selectedCart()&&(this.cartStore.addSelectedCartToPending(),this.cartStore.removeSelectedCart(),this.snackBar.open("Order pending","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"}))}cartSummaryChange(t){this.cartSummary=t}onCheckout(){let t={totalAmount:this.cartSummary?.totalCost||0,currency:this.currency()};this.dialog.open(Ii,{width:"450px",data:t}).afterClosed().subscribe(i=>{i&&(i.action==="confirm"&&i.paymentMethod&&this.cartStore.selectedCart()&&this.cartStore.updateSelectedCartPaymentMethod(i.paymentMethod),this.processCheckout())})}processCheckout(){this.saleTypeStore.setSelectedSaleType(this.tableStore.selectedTable()?"table":"quick",this.saleTypeStore.isEditing());let t=this.cartStore.selectedCart(),e=this.tableStore.selectedTable(),i=this.saleTypeStore.selectedSale(),a=this.storeStore.selectedStore();if(!t){this.snackBar.open("No cart selected","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"});return}if(!a){this.snackBar.open("No store selected","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"});return}if(console.log("Selected sale type:",i.id),!i){this.snackBar.open("Please select a sale type","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"});return}this.cartStore.updateCartSummary(this.cartSummary);let s=this.saleTypeStore.isEditing();if(console.log(s,"is editing sale type - before processing"),s){let O=this.orderStore.selectedOrder();if(!O){this.snackBar.open("No order selected for editing","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"});return}let ce={cart:L(w({},t),{cartSummary:this.cartSummary}),storeId:a._id,user:this.selectedCustomer()??void 0,table:e??void 0,salesType:i,type:i.id,payment:t?.paymentMethod?.name,total:this.cartSummary.totalCost,subTotal:this.cartSummary.subtotal,discount:this.cartSummary.discount,tax:this.cartSummary.tax,shippingFee:this.cartSummary.deliveryFee,paymentStatus:t?.paymentMethod?.name?"Paid":"Unpaid",note:t?.note,vendorCommissionAmount:0,orderInstruction:t?.note,staff:this.selectedUser?._id,category:t.paymentMethod?.name?"Complete":"Processing",settled:!!t.paymentMethod?.name};console.log("Updating order with payload:",ce),this.orderStore.updateOrder$({orderId:O._id,updates:ce}),this.saleTypeStore.stopEditing(),this.snackBar.open("Order updated successfully","Close",{duration:2e3})}else this.orderStore.syncOrder$({_id:yi(),cart:t,store:a,user:this.selectedCustomer()??void 0,table:e??void 0,guest:this.selectedGuest()??void 0,salesType:i,type:i.id,payment:t.paymentMethod?.name,salesChannel:"Point of Sale",total:this.cartSummary.totalCost,subTotal:this.cartSummary.subtotal,discount:this.cartSummary.discount,tax:this.cartSummary.tax,shippingFee:this.cartSummary.deliveryFee,paymentStatus:t.paymentMethod?.name?"Paid":"Unpaid",note:t.note,orderInstruction:t.note,createdAt:new Date,synced:!0,category:t.paymentMethod?.name?"Complete":"Processing",settled:!!t.paymentMethod?.name,reference:Mi(),staff:this.selectedUser?._id,storeId:a._id}),this.snackBar.open("Order Created","Print",{duration:2e3});let p=this.orderStore.selectedOrder();p&&e&&i.id==="table"&&(this.tableStore.updateTableOrder(e._id,p),this.tableStore.updateTableOrderSync(e._id,{orderId:p._id})),p&&this.orderStore.selectOrder(p),this.resetSalesSection()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-cart"]],inputs:{items:[1,"items"],taxRate:[1,"taxRate"]},outputs:{increment:"increment",decrement:"decrement",removeItem:"removeItem",clearCart:"clearCart",addToCart:"addToCart"},decls:43,vars:14,consts:[[1,"h-full","flex","flex-col"],[1,"p-4","border-b","border-outline-variant"],[1,"flex","items-center","gap-2"],["mat-stroked-button","",1,"!flex-1",3,"matTooltip"],["mat-stroked-button","",1,"!flex-1"],["matButton","outlined",1,"!flex-1",3,"matTooltip"],["matButton","outlined"],[1,"flex-1","overflow-auto","p-4"],[1,"mb-3","flex","justify-end"],[1,"space-y-3","h-full"],["appearance","outlined",1,"p-3"],[1,"flex","flex-col","items-center","justify-center","h-full","min-h-[300px]","text-gray-400"],[1,"mt-4"],[1,"border-t","border-outline-variant","bg-white"],[1,"flex","items-center","gap-2","p-3","border-b","border-gray-100"],["mat-stroked-button","",1,"!flex-1",3,"click"],[1,"ml-1"],[1,"p-3"],["mat-flat-button","","color","primary",1,"w-full","!h-12","!text-base",3,"click"],[1,"flex","items-center","gap-2","px-3","pb-3"],["mat-stroked-button","","color","warn",1,"!flex-1",3,"click","disabled"],["mat-stroked-button","",1,"!flex-1",3,"click","matTooltip"],[1,"text-xs","truncate","max-w-[60px]"],[1,"text-xs"],["matButton","outlined",1,"!flex-1",3,"click","matTooltip"],["matButton","outlined",3,"click"],["mat-button","","color","warn",3,"click"],[1,"flex","gap-3"],[1,"w-16","h-16","rounded-lg","overflow-hidden","bg-gray-100","flex-shrink-0"],[1,"w-full","h-full","object-cover",3,"src","alt"],[1,"w-full","h-full","flex","items-center","justify-center"],[1,"flex-1","min-w-0"],[1,"font-medium","text-sm","truncate"],[1,"primary-text","font-semibold","text-sm","mt-0.5"],[1,"text-xs","text-gray-500","mt-1","truncate"],[1,"flex","items-center","justify-between","mt-2"],["mat-mini-fab","","color","warn",3,"click"],[1,"w-8","text-center","font-semibold","text-lg"],["mat-mini-fab","","color","primary",3,"click"],[1,"font-semibold"],["mat-icon-button","","color","warn",1,"!w-8","!h-8","self-start",3,"click"],[1,"!text-lg"],[1,"text-gray-300"],[1,"!text-6xl","!w-16","!h-16","mb-4"],[1,"text-lg","font-medium"],[1,"text-sm"],[3,"cartSummary"]],template:function(e,i){if(e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),f(3,Yo,5,2,"button",3)(4,Zo,5,0,"button",4),f(5,en,5,2,"button",3)(6,tn,5,0,"button",4),f(7,on,5,2,"button",5)(8,nn,5,0,"button",6),r()(),n(9,"div",7),f(10,rn,6,0,"div",8),n(11,"div",9),z(12,sn,28,16,"mat-card",10,Te,!1,dn,7,0,"div",11),r(),f(15,mn,2,0,"div",12),r(),n(16,"div",13)(17,"div",14)(18,"button",15),u("click",function(){return i.onApplyDiscount()}),n(19,"mat-icon"),l(20,"local_offer"),r(),n(21,"span",16),l(22,"Discount"),r()(),n(23,"button",15),u("click",function(){return i.onApplyDelivery()}),n(24,"mat-icon"),l(25,"local_shipping"),r(),n(26,"span",16),l(27,"Delivery"),r()()(),n(28,"div",17)(29,"button",18),u("click",function(){return i.onCheckout()}),l(30),B(31,"currency"),r()(),n(32,"div",19)(33,"button",15),u("click",function(){return i.onGenerateBill()}),n(34,"mat-icon"),l(35,"receipt"),r(),n(36,"span",16),l(37,"Generate Bill"),r()(),n(38,"button",20),u("click",function(){return i.onPendOrder()}),n(39,"mat-icon"),l(40,"pause_circle"),r(),n(41,"span",16),l(42,"Pend Order"),r()()()()()),e&2){let a,s,p;c(3),g(i.selectedCustomer()?3:4),c(2),g(i.selectedGuest()?5:6),c(2),g(i.tableStore.selectedTable()?7:8),c(3),g(i.isEmpty()?-1:10),c(2),H((a=i.cartStore.selectedCart())==null?null:a.products),c(3),g(i.isEmpty()?-1:15),c(15),Ot(" Checkout ",i.itemsCount()," items (",Y(31,9,((s=i.cartStore.selectedCart())==null||s.cartSummary==null?null:s.cartSummary.totalCost)||0,i.currency(),"symbol","1.0-0"),") "),c(8),v("disabled",!i.cartStore.isSelectedCart()&&((p=i.cartStore.selectedCart())==null?null:p.products.length)<1)}},dependencies:[G,Ke,We,N,U,Ee,me,F,A,qt,Be,Le,Ct,ye],styles:["[_nghost-%COMP%]{display:block;height:100%}.primary-text[_ngcontent-%COMP%]{color:var(--mat-sys-primary)}.bg-primary[_ngcontent-%COMP%]{background-color:var(--mat-sys-primary)}.text-on-primary[_ngcontent-%COMP%]{color:var(--mat-sys-on-primary)}.text-on-surface-variant[_ngcontent-%COMP%]{color:var(--mat-sys-on-surface-variant)}.border-outline-variant[_ngcontent-%COMP%]{border-color:var(--mat-sys-outline-variant)}"]})};var Bi=(o,t)=>t._id;function un(o,t){o&1&&I(0,"mat-spinner",6)}function pn(o,t){if(o&1&&(n(0,"mat-icon",16),l(1),r()),o&2){let e=d().$implicit;c(),y(e.icon)}}function fn(o,t){if(o&1){let e=S();n(0,"mat-chip-option",15),u("click",function(){let a=C(e).$implicit,s=d(2);return h(s.selectCategory(a))}),f(1,pn,2,1,"mat-icon",16),l(2),r()}if(o&2){let e,i=t.$implicit,a=d(2);v("selected",((e=a.categoryStore.selectedCategory())==null?null:e._id)===i._id)("disabled",i.activate===!1),c(),g(i.icon?1:-1),c(),T(" ",i.name," ")}}function gn(o,t){if(o&1&&(n(0,"mat-chip-listbox",7),z(1,fn,3,4,"mat-chip-option",14,Bi),r()),o&2){let e=d();c(),H(e.categoryStore.categories())}}function _n(o,t){o&1&&(n(0,"div",9),I(1,"mat-spinner",17),r())}function Cn(o,t){o&1&&(n(0,"div",10)(1,"mat-icon",18),l(2,"inventory_2"),r(),n(3,"p",19),l(4,"No products found"),r(),n(5,"p",20),l(6,"Select a category or search for products"),r()())}function hn(o,t){if(o&1){let e=S();n(0,"app-product-card",22),u("addToCart",function(a){C(e);let s=d(2);return h(s.addToCart({product:a,isEditing:!1}))})("increment",function(a){C(e);let s=d(2);return h(s.incrementQuantity(a))})("decrement",function(a){C(e);let s=d(2);return h(s.decrementQuantity(a))})("openOptions",function(a){C(e);let s=d(2);return h(s.openOptionsDialog(a))}),r()}if(o&2){let e=t.$implicit,i=d(2);v("product",e)("cartQuantity",i.getCartQuantity(e._id))}}function vn(o,t){if(o&1&&(n(0,"div",11),z(1,hn,1,2,"app-product-card",21,Bi),r()),o&2){let e=d();c(),H(e.productStore.filteredProducts())}}var Li=class o{categoryStore=m(dt);storeStore=m(k);productStore=m(mt);cartStore=m(Me);searchFilter="";searchProduct(t){if(this.storeStore.selectedStore().useBarcodeScanner){let e=this.productStore.searchByBarcode(t),i=this.cartStore.selectedCart(),a=null,s=!1;i&&(a=i.products.find(p=>p._id===p._id),s=!!a)}else this.productStore.updateSearchQuery(t)}selectCategory(t){this.categoryStore.selectCategory(t)}clearSearch(){this.productStore.clearSearchQuery()}currencySymbol=M(()=>this.storeStore.selectedStore()?.currency||"\u20A6");formatPrice(t){return`${this.currencySymbol()}${t?.toLocaleString("en-NG",{minimumFractionDigits:0,maximumFractionDigits:0})||0}`}cartItems=P([]);taxRate=P(0);getCartQuantity(t){return this.cartItems().find(i=>i.product._id===t)?.quantity||0}addToCart(t){this.createCart(),this.cartStore.addToCart(this.cartStore.selectedCart()._id,t.product,t.isEditing)}createCart(){this.cartStore.selectedCart()||this.cartStore.createCart()}incrementQuantity(t){t.qty!==void 0&&this.getCartQuantity(t._id)>=t.qty||this.cartItems.update(e=>e.map(i=>i.product._id===t._id?L(w({},i),{quantity:i.quantity+1}):i))}decrementQuantity(t){this.getCartQuantity(t._id)<=1?this.removeFromCart(t._id):this.cartItems.update(i=>i.map(a=>a.product._id===t._id?L(w({},a),{quantity:a.quantity-1}):a))}removeFromCart(t){this.cartItems.update(e=>e.filter(i=>i.product._id!==t))}clearCart(){this.cartItems.set([])}checkout(){console.log("Checkout:",this.cartItems())}openOptionsDialog(t){console.log("Open options dialog for:",t.name)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["checkout"]],decls:14,vars:6,consts:[[1,"flex","h-[calc(100vh-64px)]"],[1,"w-[70%]","h-full","border-r","border-gray-200","flex","flex-col"],[1,"p-4","border-b","border-outline-variant"],["searchText","Search by barcode or product",3,"filterChange","rightTap","filter","showRightIcon"],[1,"px-4","py-3","border-b","border-outline-variant"],[1,"flex","items-center","gap-3","overflow-x-auto","scrollbar-hide"],["diameter","20"],["aria-label","Select a category",1,"flex-nowrap"],[1,"flex-1","p-4","overflow-auto"],[1,"flex","justify-center","items-center","h-full"],[1,"flex","flex-col","items-center","justify-center","h-full","text-gray-400"],[1,"grid","grid-cols-2","sm:grid-cols-3","lg:grid-cols-4","xl:grid-cols-5","gap-4"],[1,"w-[30%]","h-full"],[3,"increment","decrement","removeItem","clearCart","addToCart","checkout","items","taxRate"],[3,"selected","disabled"],[3,"click","selected","disabled"],["matChipAvatar",""],["diameter","40"],[1,"!text-6xl","!w-16","!h-16","mb-4"],[1,"text-lg","font-medium"],[1,"text-sm"],[3,"product","cartQuantity"],[3,"addToCart","increment","decrement","openOptions","product","cartQuantity"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-search",3),u("filterChange",function(s){return i.searchProduct(s)})("rightTap",function(){return i.clearSearch()}),r()(),n(4,"div",4)(5,"div",5),f(6,un,1,0,"mat-spinner",6)(7,gn,3,0,"mat-chip-listbox",7),r()(),n(8,"div",8),f(9,_n,2,0,"div",9)(10,Cn,7,0,"div",10)(11,vn,3,0,"div",11),r()(),n(12,"div",12)(13,"app-cart",13),u("increment",function(s){return i.incrementQuantity(s)})("decrement",function(s){return i.decrementQuantity(s)})("removeItem",function(s){return i.removeFromCart(s)})("clearCart",function(){return i.clearCart()})("addToCart",function(s){return i.addToCart({product:s,isEditing:!1})})("checkout",function(){return i.checkout()}),r()()()),e&2&&(c(3),v("filter",i.searchFilter)("showRightIcon",!0),c(3),g(i.categoryStore.isLoading()?6:7),c(3),g(i.productStore.isLoading()?9:i.productStore.filteredProducts().length===0?10:11),c(4),v("items",i.cartItems())("taxRate",i.taxRate()))},dependencies:[G,ut,_t,yt,Ci,fi,_i,gi,F,A,_e,ge],styles:["[_nghost-%COMP%]{display:block;height:100%}.scrollbar-hide[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.scrollbar-hide[_ngcontent-%COMP%]{-ms-overflow-style:none;scrollbar-width:none}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}mat-chip-listbox[_ngcontent-%COMP%]     .mdc-evolution-chip-set__chips{flex-wrap:nowrap}"]})};export{Li as Checkout};
