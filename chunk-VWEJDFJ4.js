import{a as tt,b as nt}from"./chunk-3G4LSAIG.js";import{a as it,b as ot}from"./chunk-WUDFCJBP.js";import"./chunk-Z73K3IEL.js";import{a as et}from"./chunk-BADSAPV5.js";import"./chunk-VHL4W3XE.js";import{c as Ye}from"./chunk-WIQQZYJV.js";import"./chunk-25J5LEO4.js";import{c as Ue,d as je,e as He,f as qe,g as Qe,h as We}from"./chunk-LLLAI5OH.js";import{a as Ke,b as Xe}from"./chunk-FJFZ7FWG.js";import{a as Ne,b as Ie,c as Pe,d as Le,e as Oe,f as Ve,g as Be,h as Ae,i as $e,j as Ge,k as ze}from"./chunk-XKLFH3FF.js";import{a as Je,b as Ze}from"./chunk-46P5YEBT.js";import"./chunk-A2P3GH4G.js";import"./chunk-J7O4JBGR.js";import"./chunk-HFTRPIKU.js";import"./chunk-SDXYS6W7.js";import{d as Q}from"./chunk-6KQFCX5X.js";import{a as Ce,b as xe}from"./chunk-KVX2H4A7.js";import{c as _e,d as ge}from"./chunk-GYNGZAKB.js";import{a as K}from"./chunk-GI4SSOPO.js";import{a as Fe,c as Te}from"./chunk-DX5KEI4P.js";import{c as ye}from"./chunk-BTSYCNWJ.js";import{a as Se,b as be}from"./chunk-WRXDGLET.js";import{a as Me}from"./chunk-QGGN4OMJ.js";import"./chunk-IG3JOGNL.js";import{a as Re,b as ke,c as De,d as Ee}from"./chunk-BPPWALS2.js";import"./chunk-JXNS4S7R.js";import{d as we}from"./chunk-2WBLSBPP.js";import"./chunk-XVOW2NM6.js";import{a as he}from"./chunk-GIZLGNET.js";import"./chunk-NXTZK4C5.js";import{a as ae,c as se,e as le,g as ce}from"./chunk-J3TXHOEY.js";import{a as de,d as me,e as ue,h as pe}from"./chunk-YLKT6R4Z.js";import{C as oe,E as re,b as X,g as Y,h as ee,m as te,s as ie,t as ne}from"./chunk-2UT4NYMV.js";import"./chunk-S2P5547C.js";import{a as ve,b as fe}from"./chunk-J5JAEWDO.js";import"./chunk-AGG277FR.js";import"./chunk-7KULNFHZ.js";import"./chunk-5M2ITBTB.js";import{X as W,Y as J,Z}from"./chunk-D3B3XJ53.js";import"./chunk-RDMIWI4X.js";import"./chunk-AGZJ637K.js";import{a as H,c as q}from"./chunk-LTDPQFG4.js";import"./chunk-VYX7HJYX.js";import{i as $,m as G,n as z,q as U,r as j}from"./chunk-FORATDN3.js";import{Bc as A,Eb as E,F as I,Fb as w,Hc as D,Ib as O,Ic as T,J as P,Jb as V,Jc as M,Kb as u,Lb as n,Mb as o,Nb as b,Pc as k,Rb as f,Sb as h,Ub as C,Yb as m,Za as l,_b as d,ca as S,ha as p,ia as _,ic as F,mb as L,nc as a,oc as x,pc as R,qc as B,sb as v,ta as g}from"./chunk-53XJD7JZ.js";import"./chunk-EQDQRRRY.js";var at=()=>[5,10,25,50,100],st=(r,e)=>e.value;function lt(r,e){r&1&&(n(0,"div",7),b(1,"mat-spinner",9),o())}function ct(r,e){if(r&1&&(n(0,"mat-option",25)(1,"span",51),b(2,"span",52),a(3),o()()),r&2){let t=e.$implicit;u("value",t.value),l(2),u("ngClass","bg-"+t.color+"-500 ring-"+t.color+"-200"),l(),R(" ",t.label," ")}}function dt(r,e){r&1&&(n(0,"th",53),a(1,"Confirmation #"),o())}function mt(r,e){if(r&1){let t=C();n(0,"td",54)(1,"mat-chip",55),m("click",function(s){let c=p(t).$implicit,y=d(3);return s.stopPropagation(),_(y.viewReservation(c))}),a(2),o()()}if(r&2){let t=e.$implicit;l(2),R(" ",t.confirmationNumber," ")}}function ut(r,e){r&1&&(n(0,"th",53),a(1,"Guest Information"),o())}function pt(r,e){if(r&1&&(n(0,"td",54),a(1),D(2,"getGuestName"),o()),r&2){let t=e.$implicit;l(),R(" ",T(2,1,t.guest)," ")}}function _t(r,e){r&1&&(n(0,"th",53),a(1,"Room Details"),o())}function gt(r,e){if(r&1&&(n(0,"td",54),a(1),o()),r&2){let t=e.$implicit;l(),R(" ",t.rooms.length," Room(s) ")}}function vt(r,e){r&1&&(n(0,"th",53),a(1,"Stay Period"),o())}function ft(r,e){if(r&1&&(n(0,"td",54),a(1),D(2,"date"),D(3,"date"),o()),r&2){let t=e.$implicit;l(),B(" ",M(2,2,t.checkInDate,"MMM dd, yyyy")," - ",M(3,5,t.checkInDate,"MMM dd, yyyy")," ")}}function ht(r,e){r&1&&(n(0,"th",53),a(1,"Nights"),o())}function Ct(r,e){if(r&1&&(n(0,"td",54),a(1),o()),r&2){let t=e.$implicit;l(),R(" ",t.numberOfNights," ")}}function xt(r,e){r&1&&(n(0,"th",53),a(1,"Status"),o())}function St(r,e){if(r&1&&(n(0,"td",54)(1,"mat-chip",56),a(2),D(3,"titlecase"),o()()),r&2){let t=e.$implicit,i=d(3);l(),u("ngClass",i.getStatusChipClass(t.status)),l(),R(" ",T(3,2,t.status)," ")}}function bt(r,e){r&1&&(n(0,"th",53),a(1,"Total Amount"),o())}function Rt(r,e){if(r&1&&(n(0,"td",54)(1,"div",57),a(2),D(3,"currency"),o()()),r&2){let t,i=e.$implicit,s=d(3);l(2),x(M(3,1,i.pricing==null?null:i.pricing.total,(t=s.storeStore.selectedStore())==null?null:t.currency))}}function kt(r,e){r&1&&(n(0,"th",53),a(1,"Actions"),o())}function Dt(r,e){if(r&1){let t=C();n(0,"button",59),m("click",function(){p(t);let s=d().$implicit,c=d(3);return _(c.editReservation(s))}),n(1,"mat-icon"),a(2,"edit"),o(),n(3,"span"),a(4,"Edit"),o()()}}function Et(r,e){if(r&1){let t=C();b(0,"mat-divider"),n(1,"button",59),m("click",function(){p(t);let s=d().$implicit,c=d(3);return _(c.deleteReservation(s))}),n(2,"mat-icon",61),a(3,"delete"),o(),n(4,"span"),a(5,"Delete Reservation"),o()()}}function wt(r,e){if(r&1){let t=C();n(0,"td",54)(1,"button",58),m("click",function(s){return p(t),_(s.stopPropagation())}),n(2,"mat-icon"),a(3,"more_vert"),o()(),n(4,"mat-menu",null,1)(6,"button",59),m("click",function(){let s=p(t).$implicit,c=d(3);return _(c.viewReservation(s))}),n(7,"mat-icon"),a(8,"visibility"),o(),n(9,"span"),a(10,"View Details"),o()(),E(11,Dt,5,0,"button",60),E(12,Et,6,0),o()()}if(r&2){let t=e.$implicit,i=F(5),s=d(3);l(),u("matMenuTriggerFor",i),l(10),w(s.canEdit(t)?11:-1),l(),w(s.canDelete(t)?12:-1)}}function Mt(r,e){r&1&&b(0,"tr",62)}function yt(r,e){if(r&1){let t=C();n(0,"tr",63),m("click",function(){let s=p(t).$implicit,c=d(3);return _(c.viewReservation(s))}),o()}}function Ft(r,e){if(r&1){let t=C();n(0,"mat-card",12)(1,"div",17)(2,"form",18)(3,"div",19)(4,"div",20)(5,"mat-form-field",21)(6,"mat-label"),a(7,"Search reservations..."),o(),n(8,"mat-icon",22),a(9,"search"),o(),b(10,"input",23),o()(),n(11,"div")(12,"mat-form-field",21)(13,"mat-label"),a(14,"Status"),o(),n(15,"mat-select",24),O(16,ct,4,3,"mat-option",25,st),o()()(),n(18,"div",20)(19,"mat-form-field",21)(20,"mat-label"),a(21,"Check-in date range"),o(),n(22,"mat-date-range-input",26),b(23,"input",27)(24,"input",28),o(),b(25,"mat-datepicker-toggle",29)(26,"mat-date-range-picker",null,0),o()(),n(28,"div")(29,"mat-form-field",21)(30,"mat-label"),a(31,"Sort by"),o(),n(32,"mat-select",30)(33,"mat-option",31),a(34,"Created Date"),o(),n(35,"mat-option",32),a(36,"Check-in Date"),o(),n(37,"mat-option",33),a(38,"Check-out Date"),o(),n(39,"mat-option",34),a(40,"Total Amount"),o(),n(41,"mat-option",35),a(42,"Guest Name"),o()()()()()()(),n(43,"table",36),f(44,37),v(45,dt,2,0,"th",38)(46,mt,3,1,"td",39),h(),f(47,40),v(48,ut,2,0,"th",38)(49,pt,3,3,"td",39),h(),f(50,41),v(51,_t,2,0,"th",38)(52,gt,2,1,"td",39),h(),f(53,42),v(54,vt,2,0,"th",38)(55,ft,4,8,"td",39),h(),f(56,43),v(57,ht,2,0,"th",38)(58,Ct,2,1,"td",39),h(),f(59,44),v(60,xt,2,0,"th",38)(61,St,4,4,"td",39),h(),f(62,45),v(63,bt,2,0,"th",38)(64,Rt,4,4,"td",39),h(),f(65,46),v(66,kt,2,0,"th",38)(67,wt,13,3,"td",39),h(),v(68,Mt,1,0,"tr",47)(69,yt,1,0,"tr",48),o(),n(70,"mat-card-actions",49)(71,"mat-paginator",50),m("page",function(s){p(t);let c=d(2);return _(c.onPageChange(s))}),o()()()}if(r&2){let t=F(27),i=d(2);l(2),u("formGroup",i.filterForm),l(14),V(i.statusOptions),l(6),u("formGroup",i.filterForm.controls.dateRange)("rangePicker",t),l(3),u("for",t),l(18),u("dataSource",i.reservations.value().reservations),l(25),u("matHeaderRowDef",i.displayedColumns),l(),u("matRowDefColumns",i.displayedColumns),l(2),u("length",i.totalReservations())("pageSize",i.pageSize())("pageSizeOptions",A(11,at))("pageIndex",i.currentPage()-1)}}function Tt(r,e){if(r&1){let t=C();n(0,"div",16)(1,"div",64)(2,"mat-icon",65),a(3,"hotel"),o()(),n(4,"h3",66),a(5,"No reservations found"),o(),n(6,"p",67),a(7),o(),n(8,"button",68),m("click",function(){p(t);let s=d(2);return _(s.createReservation())}),n(9,"mat-icon"),a(10,"add"),o(),a(11," Create New Reservation "),o()()}if(r&2){let t,i=d(2);l(7),R(" ",(t=i.filterForm.get("search"))!=null&&t.value||(t=i.filterForm.get("status"))!=null&&t.value?"Try adjusting your filters or search terms to find matching reservations.":"Get started by creating your first reservation to begin managing your hotel bookings."," ")}}function Nt(r,e){if(r&1&&(n(0,"div",10)(1,"div",11)(2,"mat-card",12)(3,"mat-card-content",13)(4,"div",14),a(5,"Total"),o(),n(6,"div",15),a(7),o()()(),n(8,"mat-card",12)(9,"mat-card-content",13)(10,"div",14),a(11,"Confirmed"),o(),n(12,"div",15),a(13),o()()(),n(14,"mat-card",12)(15,"mat-card-content",13)(16,"div",14),a(17,"Checked In"),o(),n(18,"div",15),a(19),o()()(),n(20,"mat-card",12)(21,"mat-card-content",13)(22,"div",14),a(23,"Pending"),o(),n(24,"div",15),a(25),o()()(),n(26,"mat-card",12)(27,"mat-card-content",13)(28,"div",14),a(29,"Cancelled"),o(),n(30,"div",15),a(31),o()()(),n(32,"mat-card",12)(33,"mat-card-content",13)(34,"div",14),a(35,"Revenue"),o(),n(36,"div",15),a(37),D(38,"currency"),o()()()()(),E(39,Ft,72,12,"mat-card",12)(40,Tt,12,1,"div",16)),r&2){let t,i=d();l(7),x(i.reservations.value().reservations.length),l(6),x(i.confirmedCount()),l(6),x(i.checkedInCount()),l(6),x(i.pendingCount()),l(6),x(i.cancelledCount()),l(6),x(M(38,7,i.totalRevenue(),(t=i.storeStore.selectedStore())==null?null:t.currency)),l(2),w(i.reservations.value().reservations.length>0?39:40)}}function It(r,e){if(r&1){let t=C();n(0,"div",8)(1,"div",69)(2,"mat-icon",70),a(3,"error"),o(),n(4,"div")(5,"h3",71),a(6,"Error loading reservations"),o(),n(7,"p",72),a(8),o(),n(9,"div",73)(10,"button",74),m("click",function(){p(t);let s=d();return _(s.refreshReservations())}),n(11,"mat-icon",5),a(12,"refresh"),o(),a(13," Retry "),o(),n(14,"button",75),m("click",function(){p(t);let s=d();return _(s.clearError())}),a(15,"Dismiss"),o()()()()()}if(r&2){let t=d();l(8),x(t.reservations.error())}}var rt=class r{router=S(q);route=S(H);fb=S(oe);reservationService=S(et);storeStore=S(he);snackBar=S(K);dialog=S(ye);currentPage=g(1);pageSize=g(10);statusUpdating=g(new Set);searchFilter=g("");statusFilter=g("");dateFromFilter=g(null);dateToFilter=g(null);sortByFilter=g("createdAt");sortOrderFilter=g("desc");filterForm=this.fb.group({search:[""],status:[""],dateRange:this.fb.group({start:[null],end:[null]}),sortBy:["createdAt"],sortOrder:["desc"]});confirmedCount=k(()=>this.reservations.value()?.reservations.filter(e=>e.status==="confirmed").length);checkedInCount=k(()=>this.reservations.value()?.reservations.filter(e=>e.status==="checked_in").length);pendingCount=k(()=>this.reservations.value()?.reservations.filter(e=>e.status==="pending").length);cancelledCount=k(()=>this.reservations.value()?.reservations.filter(e=>e.status==="cancelled").length);totalRevenue=k(()=>this.reservations.value()?.reservations.reduce((e,t)=>e+this.getEffectiveTotal(t),0));totalReservations=k(()=>this.reservations.value()?.total||0);filterParams=k(()=>{let t={storeId:this.storeStore.selectedStore()?._id,page:this.currentPage(),limit:this.pageSize(),sortBy:this.sortByFilter(),sortOrder:this.sortOrderFilter()};return this.searchFilter()&&this.searchFilter().trim()&&(t.search=this.searchFilter().trim()),this.statusFilter()&&this.statusFilter().trim()&&(t.status=this.statusFilter().trim()),this.dateFromFilter()&&(t.dateFrom=new Date(this.dateFromFilter()).toISOString().split("T")[0]),this.dateToFilter()&&(t.dateTo=new Date(this.dateToFilter()).toISOString().split("T")[0]),t});displayedColumns=["confirmationNumber","guest","rooms","stayPeriod","nights","status","total","actions"];statusOptions=[{value:"",label:"All Statuses",color:"gray"},{value:"pending",label:"Pending",color:"orange"},{value:"confirmed",label:"Confirmed",color:"blue"},{value:"checked_in",label:"Checked In",color:"green"},{value:"checked_out",label:"Checked Out",color:"purple"},{value:"cancelled",label:"Cancelled",color:"red"},{value:"no_show",label:"No Show",color:"gray"}];constructor(){this.filterForm.valueChanges.pipe(I(300),P()).subscribe(e=>{console.log("Form values changed:",e),this.currentPage.set(1),this.searchFilter.set(e.search||""),this.statusFilter.set(e.status||""),this.dateFromFilter.set(e.dateRange?.start||null),this.dateToFilter.set(e.dateRange?.end||null),this.sortByFilter.set(e.sortBy||"createdAt"),this.sortOrderFilter.set(e.sortOrder||"desc")})}reservations=we({params:()=>({params:this.filterParams()}),stream:({params:e})=>this.reservationService.getReservations(e.params)});loadReservations(){}onPageChange(e){this.currentPage.set(e.pageIndex+1),this.pageSize.set(e.pageSize),this.loadReservations()}clearFilters(){this.filterForm.reset({search:"",status:"",dateRange:{start:null,end:null},sortBy:"createdAt",sortOrder:"desc"}),this.searchFilter.set(""),this.statusFilter.set(""),this.dateFromFilter.set(null),this.dateToFilter.set(null),this.sortByFilter.set("createdAt"),this.sortOrderFilter.set("desc"),this.currentPage.set(1)}refreshReservations(){this.loadReservations()}getStatusColor(e){return this.statusOptions.find(i=>i.value===e)?.color||"gray"}getStatusChipClass(e){return{pending:"bg-yellow-500! text-white!",confirmed:"bg-blue-600! text-white!",checked_in:"bg-green-600! text-white!",checked_out:"bg-gray-500! text-white!",cancelled:"bg-red-600! text-white!",no_show:"bg-orange-600! text-white!",reserved:"bg-indigo-600! text-white!"}[e]||"bg-gray-500! text-white!"}getGuestName(e){return typeof e.guest=="object"&&e.guest!==null?e.guest.firstName+" "+e.guest.lastName:String(e.guest)}getRoomNumbers(e){return e.rooms.map(t=>typeof t.room=="string"?t.room:t.room.roomNumber).join(", ")}reloadData(){this.reservations.reload()}createReservation(){this.dialog.open(nt,{width:"600px",disableClose:!1}).afterClosed().subscribe(t=>{t&&this.router.navigate(["../create"],{relativeTo:this.route.parent,queryParams:{quickReservation:JSON.stringify(t)}})})}viewReservation(e){this.router.navigate(["../edit",e._id],{relativeTo:this.route.parent})}editReservation(e){this.router.navigate(["../edit",e._id],{relativeTo:this.route.parent})}checkInReservation(e){e.status==="confirmed"&&this.reservationService.checkInReservation(e._id).subscribe({next:()=>{this.refreshReservations()},error:t=>{console.error("Error checking in reservation:",t)}})}checkOutReservation(e){e.status==="checked_in"&&this.reservationService.checkOutReservation(e._id).subscribe({next:()=>{this.refreshReservations()},error:t=>{console.error("Error checking out reservation:",t)}})}cancelReservation(e){let t=prompt("Please provide a reason for cancellation:");t&&this.reservationService.cancelReservation(e._id,t).subscribe({next:()=>{this.refreshReservations()},error:i=>{console.error("Error cancelling reservation:",i)}})}canCheckIn(e){return e.status==="confirmed"&&new Date(e.checkInDate)<=new Date}canCheckOut(e){return e.status==="checked_in"}canCancel(e){return["pending","confirmed"].includes(e.status)}canEdit(e){return e.status!=="cancelled"&&e.status!=="checked_out"&&e.status!=="no_show"&&e.status!=="checked_in"&&!e.actualCheckInDate}canDelete(e){return["pending","cancelled","no_show"].includes(e.status)}deleteReservation(e){let t=this.storeStore.selectedStore();if(!t?._id){this.snackBar.open("No store selected","Close",{duration:3e3});return}let i={storeId:t._id,actionDescription:`delete reservation ${e.confirmationNumber}`,reservationId:e._id};this.dialog.open(it,{data:i,width:"500px",maxWidth:"90vw",disableClose:!0}).afterClosed().subscribe(c=>{c?.authorized&&c.pin&&this.performReservationDeletion(e,c.pin)})}performReservationDeletion(e,t){let i=new Set(this.statusUpdating());i.add(e._id),this.statusUpdating.set(i),this.reservationService.deleteReservationWithPin(e._id,t).subscribe({next:s=>{let y=(this.reservations.value()?.reservations||[]).filter(N=>N._id!==e._id);this.snackBar.open(`Reservation ${e.confirmationNumber} deleted successfully`,"Close",{duration:5e3})},error:s=>{console.error("Error deleting reservation:",s),this.snackBar.open(s.message||"Failed to delete reservation","Close",{duration:5e3,panelClass:["error-snackbar"]})},complete:()=>{let s=new Set(this.statusUpdating());s.delete(e._id),this.statusUpdating.set(s)}})}allStatusOptions=[{value:"pending",label:"Pending",icon:"schedule",color:"#f59e0b"},{value:"confirmed",label:"Confirmed",icon:"check_circle",color:"#10b981"},{value:"checked_in",label:"Checked In",icon:"login",color:"#3b82f6"},{value:"checked_out",label:"Checked Out",icon:"logout",color:"#6b7280"},{value:"cancelled",label:"Cancelled",icon:"cancel",color:"#ef4444"},{value:"no_show",label:"No Show",icon:"person_off",color:"#f97316"}];isValidStatusTransition(e,t){return{pending:["confirmed","cancelled","no_show"],confirmed:["checked_in","cancelled","no_show"],checked_in:["checked_out"],checked_out:[],cancelled:[],no_show:[]}[e]?.includes(t)||!1}getStatusTransitionError(e,t){switch(t){case"checked_in":return'Guests can only be checked in when reservation status is "Confirmed"';case"checked_out":return'Guests can only be checked out when reservation status is "Checked In"';case"confirmed":return e==="checked_in"?"Cannot change back to confirmed after check-in":e==="checked_out"?"Cannot change back to confirmed after check-out":"Invalid status transition";default:return`Cannot change status from "${e}" to "${t}"`}}requiresPaymentBeforeCheckout(e){let t=e.pricing.balance>0,i=e.paymentInfo?.status!=="paid";return t&&i}isStatusUpdating(e){return this.statusUpdating().has(e)}getStatusColorHex(e){return{pending:"#f59e0b",confirmed:"#10b981",checked_in:"#3b82f6",checked_out:"#6b7280",cancelled:"#ef4444",no_show:"#f97316"}[e]||"#6b7280"}getStatusIcon(e){return{pending:"schedule",confirmed:"check_circle",checked_in:"login",checked_out:"logout",cancelled:"cancel",no_show:"person_off"}[e]||"help"}clearError(){this.loadReservations()}exportReservations(){try{let e=this.generateCSV(),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(i.download!==void 0){let s=URL.createObjectURL(t);i.setAttribute("href",s),i.setAttribute("download",this.generateExportFilename()),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),this.snackBar.open("Reservations exported successfully","Close",{duration:3e3})}}catch(e){console.error("Error exporting reservations:",e),this.snackBar.open("Failed to export reservations","Close",{duration:5e3,panelClass:["error-snackbar"]})}}generateCSV(){let t=[["Confirmation Number","Guest Name","Email","Phone","Room Numbers","Check-in Date","Check-out Date","Check-in Time","Check-out Time","Status","Adults","Children","Nights","Subtotal","Taxes","Total","Balance","Payment Status","Created Date","Special Requests/Notes"].join(",")];return this.reservations.value()?.reservations.forEach(i=>{let s=[this.escapeCsvField(i.confirmationNumber||""),this.escapeCsvField(this.getGuestName(i)),this.escapeCsvField(typeof i.guest!="string"&&i.guest?.email||""),this.escapeCsvField(typeof i.guest!="string"&&i.guest?.phone||""),this.escapeCsvField(this.getRoomNumbers(i)),this.formatDateForCSV(i.checkInDate),this.formatDateForCSV(this.getEffectiveCheckOutDate(i)),this.escapeCsvField(i.expectedCheckInTime||""),this.escapeCsvField(i.expectedCheckOutTime||""),this.escapeCsvField(i.status||""),i.numberOfNights||0,i.pricing?.subtotal||0,i.pricing?.taxes||0,this.getEffectiveTotal(i),i.pricing?.balance||0,this.escapeCsvField(i.paymentInfo?.status||"pending"),this.formatDateForCSV(i.createdAt),this.escapeCsvField(i.specialRequests||i.internalNotes||"")];t.push(s.join(","))}),t.join(`
`)}escapeCsvField(e){if(e==null)return"";let t=String(e);return t.includes(",")||t.includes('"')||t.includes(`
`)?`"${t.replace(/"/g,'""')}"`:t}formatDateForCSV(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}):""}generateExportFilename(){let e=new Date,t=e.toISOString().split("T")[0],i=e.toTimeString().split(" ")[0].replace(/:/g,"-"),s=`reservations_${t}_${i}`,c=this.filterForm.value;return c.search&&(s+=`_search-${c.search.replace(/[^a-zA-Z0-9]/g,"")}`),c.status&&(s+=`_${c.status}`),(c.dateRange?.start||c.dateRange?.end)&&(s+="_filtered"),`${s}.csv`}hasApprovedExtensions(e){return!!(e.extensions&&e.extensions.some(t=>t.status==="approved"))}getEffectiveCheckOutDate(e){if(this.hasApprovedExtensions(e)){let t=e.extensions?.filter(i=>i.status==="approved")||[];if(t.length>0)return t.reduce((s,c)=>{let y=new Date(s.newCheckOutDate);return new Date(c.newCheckOutDate)>y?c:s}).newCheckOutDate}return e.checkOutDate}getExtensionNights(e){return e.extensions?e.extensions.filter(i=>i.status==="approved").reduce((i,s)=>i+(s.additionalNights||0),0):0}getApprovedExtensionCost(e){return e.extensions?e.extensions.filter(i=>i.status==="approved").reduce((i,s)=>i+(s.additionalCost||0),0):0}getEffectiveTotal(e){return e.pricing?.total||0}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=L({type:r,selectors:[["app-reservations-list"]],decls:21,vars:2,consts:[["dateRangePicker",""],["actionMenu","matMenu"],["title","Reservations","subtitle","Manage hotel reservations and guest bookings","viewToggleRoute","/menu/hms/front-desk/reservations/view",3,"showViewToggle"],["actions",""],["matButton","outlined",3,"click"],[1,"mr-1"],["matButton","filled",3,"click"],[1,"flex","justify-center","items-center"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","m-4"],["diameter","40"],[1,"max-w-12xl","py-6"],[1,"grid","grid-cols-2","md:grid-cols-3","lg:grid-cols-6","gap-4"],["appearance","outlined"],[1,"p-4!"],[1,"text-sm","text-gray-600"],[1,"text-2xl","font-bold"],[1,"py-20","text-center"],[1,"p-3"],[3,"formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","xl:grid-cols-6","gap-4","mb-4"],[1,"lg:col-span-2"],["appearance","outline",1,"w-full"],["matPrefix","",1,"text-gray-400"],["matInput","","placeholder","Guest name or confirmation #","formControlName","search"],["formControlName","status"],[3,"value"],[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date"],["matIconSuffix","",3,"for"],["formControlName","sortBy"],["value","createdAt"],["value","checkInDate"],["value","checkOutDate"],["value","total"],["value","guestName"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","confirmationNumber"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","guest"],["matColumnDef","rooms"],["matColumnDef","stayPeriod"],["matColumnDef","nights"],["matColumnDef","status"],["matColumnDef","total"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","cursor-pointer",3,"click",4,"matRowDef","matRowDefColumns"],[1,"flex","justify-end"],["showFirstLastButtons","",3,"page","length","pageSize","pageSizeOptions","pageIndex"],[1,"flex","items-center"],[1,"w-3","h-3","rounded-full","mr-3","ring-2",3,"ngClass"],["mat-header-cell",""],["mat-cell",""],[3,"click"],[3,"ngClass"],[1,"font-bold"],["mat-icon-button","",3,"click","matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item",""],["color","warn"],["mat-header-row",""],["mat-row","",1,"cursor-pointer",3,"click"],[1,"w-16","h-16","bg-gray-200","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],[1,"text-4xl","text-gray-400"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-500","mb-6"],["matButton","filled","color","primary",3,"click"],[1,"flex"],[1,"text-red-500","mr-2"],[1,"text-red-800","font-medium"],[1,"text-red-700","text-sm","mt-1"],[1,"mt-3","flex","space-x-3"],["mat-button","","color","warn",1,"!text-red-600",3,"click"],["mat-button","",1,"!text-gray-600",3,"click"]],template:function(t,i){t&1&&(n(0,"app-page-header",2),f(1,3),n(2,"button",4),m("click",function(){return i.clearFilters()}),n(3,"mat-icon"),a(4,"clear"),o(),a(5," Clear Filters "),o(),n(6,"button",4),m("click",function(){return i.reloadData()}),n(7,"mat-icon",5),a(8,"redo"),o(),a(9," Reload "),o(),n(10,"button",4),m("click",function(){return i.exportReservations()}),n(11,"mat-icon",5),a(12,"download"),o(),a(13," Export "),o(),n(14,"button",6),m("click",function(){return i.createReservation()}),n(15,"mat-icon",5),a(16,"add"),o(),a(17," Create Reservation "),o(),h(),o(),E(18,lt,2,0,"div",7)(19,Nt,41,10)(20,It,16,1,"div",8)),t&2&&(u("showViewToggle",!0),l(18),w(i.reservations.isLoading()?18:i.reservations.hasValue()?19:i.reservations.error()?20:-1))},dependencies:[j,$,re,te,X,Y,ee,ne,ie,ze,Ne,Pe,Be,Le,Ie,Ae,Oe,Ve,$e,Ge,Xe,Ke,Ye,ge,_e,pe,de,me,ue,Ze,Je,Q,Z,J,W,fe,ve,Te,Fe,ce,ae,le,se,Ee,ke,Re,De,Me,We,Ue,je,He,qe,Qe,xe,Ce,be,Se,tt,G,U,z,ot],encapsulation:2})};export{rt as ReservationsListComponent};
