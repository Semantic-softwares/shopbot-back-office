import{a as Te,b as ye,c as Se,d as ve}from"./chunk-IOL4WJQ6.js";import{e as xe,g as we}from"./chunk-BRVFHWEJ.js";import"./chunk-WE4JXOI6.js";import"./chunk-WHARIOSL.js";import"./chunk-DJWGEN5D.js";import{c as Ce,e as fe,f as he}from"./chunk-4L4VWXIM.js";import{f as _e}from"./chunk-XSZYAESL.js";import{a as me,b as be,c as ge}from"./chunk-LCNY3JPX.js";import{a as ue}from"./chunk-4QMHOUIB.js";import{k as pe}from"./chunk-BAU4EBFS.js";import"./chunk-E4PTFC5Z.js";import"./chunk-4P4GBQE7.js";import{a as n,b as Z,c as ee,d as te,e as re,f as ae,g as w,h as M,i as F}from"./chunk-ZKQYDJ5W.js";import"./chunk-G4CZ6LK2.js";import"./chunk-I564X6SI.js";import"./chunk-VTDH2LYT.js";import{b as ne,d as se}from"./chunk-63HT37SK.js";import"./chunk-YJCGHVXK.js";import"./chunk-UHBDKNKX.js";import{a as de,b as ce}from"./chunk-3ZLH5HUN.js";import{A as le}from"./chunk-O5GCTPYR.js";import"./chunk-EGLRIU4H.js";import"./chunk-5TL46KBL.js";import"./chunk-53AK2UWQ.js";import{a as Y}from"./chunk-BFT2MTJY.js";import{h as ie}from"./chunk-JONI64R4.js";import"./chunk-H7INH462.js";import"./chunk-OOL2KACG.js";import"./chunk-KZJMNFJ3.js";import{c as oe}from"./chunk-G6I3OKXX.js";import{ba as X}from"./chunk-4Z2XUZY2.js";import{e as K,g as W}from"./chunk-F436VINI.js";import{A as J,u as z}from"./chunk-H22US2IH.js";import{Ib as O,Jb as I,Mb as N,Nb as R,Ob as h,Pb as c,Qb as d,Rb as Q,V as S,Wc as q,Y as v,Yb as P,aa as j,ac as T,bb as m,c as y,cc as u,fa as p,gc as H,hc as G,ic as U,ka as b,la as g,qb as B,rc as _,tc as x,wa as D}from"./chunk-P5WOETP4.js";import{a as E}from"./chunk-GAL4ENT6.js";var V=class t{hostServer=Y.apiUrl;_httpClient=p(J);getStoreTableCategories(e){return this._httpClient.get(`${this.hostServer}/table-categories/store/${e}`)}deleteTableCategory(e){return this._httpClient.delete(`${this.hostServer}/table-categories/${e}`)}createTableCategory(e){return this._httpClient.post(`${this.hostServer}/table-categories`,e)}updateTableCategory(e,r){return this._httpClient.put(`${this.hostServer}/table-categories/${e}`,r)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=j({token:t,factory:t.\u0275fac,providedIn:"root"})};var Ve={tableCategories:[],selectedTableCategory:null,isLoading:!1,error:null},Me=Z({providedIn:"root"},ae(Ve),ee(({tableCategories:t})=>({tablesCategoryCount:q(()=>t().length)})),re((t,e=p(V))=>{let r=i=>{n(t,{selectedTableCategory:i})},a=()=>{n(t,{selectedTableCategory:null})},o=(i,s)=>{let L=t.tableCategories().map($=>$._id===i?E(E({},$),s):$);n(t,{tableCategories:L})},l=i=>{n(t,{tableCategories:[...t.tableCategories(),i]})},C=i=>{let s=t.tableCategories().filter(L=>L._id!==i);n(t,{tableCategories:s})},f=M(y(v(()=>n(t,{isLoading:!0,error:null,tableCategories:[]})),S(i=>e.getStoreTableCategories(i).pipe(w({next(s){n(t,{isLoading:!1,error:null,tableCategories:s,selectedTableCategory:null})},error(s){n(t,{isLoading:!1,error:String(s)})}}))))),k=M(y(v(()=>n(t,{isLoading:!0,error:null})),S(i=>e.createTableCategory(i.tableParams).pipe(w({next(s){n(t,{isLoading:!1,error:null}),l(s),i?.modalParams&&i.modalParams.closeCallback()},error(s){n(t,{isLoading:!1,error:String(s)})}}))))),A=M(y(v(()=>n(t,{isLoading:!0,error:null})),S(i=>e.updateTableCategory(i.tableId,i.tableParams).pipe(w({next(s){n(t,{isLoading:!1,error:null}),o(i.tableId,i.tableParams),i?.modalParams&&i.modalParams.closeCallback()},error(s){n(t,{isLoading:!1,error:String(s)})}}))))),Pe=M(y(v(()=>n(t,{isLoading:!0,error:null})),S(i=>e.deleteTableCategory(i).pipe(w({next(s){n(t,{isLoading:!1,error:null}),C(i)},error(s){n(t,{isLoading:!1,error:String(s)})}})))));return{selectTableCategory:r,clearSelectedTableCategory:a,updateTableParams:o,createTableCategory:l,deleteTableCategory:C,getTablesCategories$:f,createTableCategory$:k,updateTableCategory$:A,deleteTableCategory$:Pe}}),te({onInit(t){let r=p(F).selectedStore();r?._id&&t.getTablesCategories$(r._id)}}));var ke=["searchComponent"],Ie=(t,e)=>e._id;function Le(t,e){if(t&1){let r=P();c(0,"mat-chip-option",16),T("click",function(){let o=b(r).$implicit,l=u();return g(l.onCategorySelect(o))}),_(1),d()}if(t&2){let r,a=e.$implicit,o=u();h("selected",((r=o.tableCategoryStore.selectedTableCategory())==null?null:r._id)===a._id),m(),x(" ",a.name," ")}}function $e(t,e){t&1&&(c(0,"div",18),Q(1,"mat-spinner",19),d())}function Ee(t,e){if(t&1){let r=P();c(0,"app-table-card",23),T("addNewOrder",function(o){b(r);let l=u(2);return g(l.onAddNewOrder(o))})("viewOrder",function(o){b(r);let l=u(2);return g(l.viewOrder(o))})("completeOrder",function(o){b(r);let l=u(2);return g(l.completeOrder(o))})("clearOrder",function(o){b(r);let l=u(2);return g(l.onClearOrder(o))})("tableClick",function(o){b(r);let l=u(2);return g(l.onTableClick(o))}),d()}if(t&2){let r=e.$implicit;h("table",r)}}function De(t,e){t&1&&(c(0,"div",22),Q(1,"app-no-record",24),d())}function Ne(t,e){if(t&1&&(c(0,"div",20),N(1,Ee,1,1,"app-table-card",21,Ie),d(),O(3,De,2,0,"div",22)),t&2){let r=u();m(),R(r.tableStore.filteredTables()),m(2),I(r.tableStore.filteredTables().length===0?3:-1)}}var Oe=class t{searchFilter="";tableStore=p(ve);tableCategoryStore=p(Me);saleTypeStore=p(xe);orderStore=p(we);storeStore=p(F);dialog=p(_e);router=p(W);route=p(K);viewMode=D("grid");searchQuery=D("");searchComponent;displayedColumns=["name","seats","category","status"];ngOnInit(){let e=this.storeStore.selectedStore();e?._id&&this.tableStore.getTables$(e._id)}onSearchChange(e){this.searchQuery.set(e),this.tableStore.updateSearchQuery(e)}clearSearch(){this.searchQuery.set(""),this.searchComponent.clearFilter()}onStatusFilterChange(e){this.tableStore.updateStatusFilter(e)}onCategorySelect(e){this.tableCategoryStore.selectTableCategory(e),this.tableStore.updateSearchFilter(e)}clearCategoryFilter(){this.tableCategoryStore.clearSelectedTableCategory(),this.tableStore.updateSearchFilter(null)}onTableClick(e){this.tableStore.selectTable(e._id)}onAddNewOrder(e){this.tableStore.selectTable(e._id),this.saleTypeStore.setSelectedSaleType("table"),this.router.navigate(["checkout"],{relativeTo:this.route})}onClearOrder(e){e.orderId&&(this.tableStore.updateTable(e._id,{orderId:null,order:null}),this.tableStore.updateTableOrderSync(e._id,{orderId:null}),console.log("Order cleared from table:",e.name))}completeOrder(e){console.log("Completing order for table:",e);let r=e.orderId?._id,a=e.orderId?.total||0,o=this.storeStore.selectedStore()?.currency||"\u20A6";if(!r){console.error("No order found for this table");return}let l={totalAmount:a,currency:o};this.dialog.open(Se,{width:"450px",data:l}).afterClosed().subscribe(f=>{if(f){let k=f.action==="confirm"&&f.paymentMethod?f.paymentMethod.name:"Cash";this.orderStore.completeOrder(r,k).then(A=>{this.tableStore.updateTable(e._id,{orderId:null,order:null}),this.tableStore.updateTableOrderSync(e._id,{orderId:null}),this.orderStore.deleteSelectedOrder(),this.tableStore.clearSelectedTable(),this.saleTypeStore.setDefaultSaleType()})}})}viewOrder(e){e.orderId?._id&&this.router.navigate(["/menu/pos/orders",e.orderId._id,"details"])}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=B({type:t,selectors:[["app-tables"]],viewQuery:function(r,a){if(r&1&&H(ke,5),r&2){let o;G(o=U())&&(a.searchComponent=o.first)}},decls:32,vars:9,consts:[["searchComponent",""],[1,"min-h-full"],[1,"p-4","border-b","border-outline-variant"],[1,"flex","items-center","gap-3"],[1,"flex-1"],["searchText","Search by table name...",3,"filterChange","rightTap","filter","showRightIcon"],[1,"hidden","md:flex","items-center","gap-2","shrink-0"],[1,"w-full","sm:w-auto",3,"change","value"],["value","all",1,"flex-1","sm:flex-initial"],[1,"hidden","sm:inline"],[1,"sm:hidden"],["value","free",1,"flex-1","sm:flex-initial"],["value","occupied",1,"flex-1","sm:flex-initial"],[1,"px-4","py-3","border-b","border-outline-variant","mb-4"],[1,"flex","items-center","gap-3","overflow-x-auto","scrollbar-hide"],["aria-label","Select a table category",1,"flex-nowrap"],[1,"cursor-pointer",3,"click","selected"],[1,"cursor-pointer",3,"selected"],[1,"flex","justify-center","items-center","py-16"],["diameter","40"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","px-4","gap-4"],[3,"table"],[1,"px-4","py-8"],[3,"addNewOrder","viewOrder","completeOrder","clearOrder","tableClick","table"],["icon","table_restaurant","title","No Tables Found","message","There are no tables to display at this time."]],template:function(r,a){if(r&1){let o=P();c(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"app-search",5,0),T("filterChange",function(C){return b(o),g(a.onSearchChange(C))})("rightTap",function(){return b(o),g(a.clearSearch())}),d()(),c(6,"div",6)(7,"mat-button-toggle-group",7),T("change",function(C){return b(o),g(a.onStatusFilterChange(C.value))}),c(8,"mat-button-toggle",8)(9,"span",9),_(10),d(),c(11,"span",10),_(12,"All"),d()(),c(13,"mat-button-toggle",11)(14,"span",9),_(15),d(),c(16,"span",10),_(17,"Free"),d()(),c(18,"mat-button-toggle",12)(19,"span",9),_(20),d(),c(21,"span",10),_(22,"Occ."),d()()()()()(),c(23,"div",13)(24,"div",14)(25,"mat-chip-listbox",15)(26,"mat-chip-option",16),T("click",function(){return b(o),g(a.clearCategoryFilter())}),_(27," All Categories "),d(),N(28,Le,2,2,"mat-chip-option",17,Ie),d()()(),O(30,$e,2,0,"div",18),O(31,Ne,4,1),d()}r&2&&(m(4),h("filter",a.searchFilter)("showRightIcon",!0),m(3),h("value",a.tableStore.statusFilter()),m(3),x("All (",a.tableStore.tablesCount(),")"),m(5),x("Free (",a.tableStore.freeTableCount(),")"),m(5),x("Occupied (",a.tableStore.occupiedTableCount(),")"),m(6),h("selected",!a.tableCategoryStore.selectedTableCategory()),m(2),R(a.tableCategoryStore.tableCategories()),m(2),I(a.tableStore.isLoading()?30:-1),m(),I(a.tableStore.isLoading()?-1:31))},dependencies:[z,ie,pe,he,fe,Ce,X,oe,ne,se,ge,me,be,ce,de,le,ye,Te,ue],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto}.scrollbar-hide[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.scrollbar-hide[_ngcontent-%COMP%]{-ms-overflow-style:none;scrollbar-width:none}mat-chip-listbox[_ngcontent-%COMP%]     .mdc-evolution-chip-set__chips{flex-wrap:nowrap}"]})};export{Oe as Tables};
