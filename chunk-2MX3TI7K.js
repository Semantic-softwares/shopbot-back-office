import{a as ee,b as ie,c as ne}from"./chunk-H2NNGXHL.js";import{a as Kt,c as Zt,e as Jt,f as Qt,g as te,h as tt}from"./chunk-GS72R6E5.js";import{a as Gt}from"./chunk-ONWZVE76.js";import{a as qt,b as Yt}from"./chunk-SLNANJBJ.js";import{a as kt,b as Nt,c as Ft,d as Vt,e as zt,f as Ut,g as Ot,h as jt,i as Wt,j as Ht,k as Q}from"./chunk-SNJMCTTD.js";import{a as Xt}from"./chunk-GGOIOYKP.js";import{a as $t}from"./chunk-LXK533WH.js";import{a as Bt,b as At,f as K,g as Z,l as J}from"./chunk-TKDVIZGU.js";import{a as Pt}from"./chunk-CRWXVOET.js";import"./chunk-YCI4GSMN.js";import{a as T}from"./chunk-AIJP532J.js";import{a as Mt}from"./chunk-NWQQ2VP3.js";import"./chunk-M54QIQPD.js";import"./chunk-ZXNLXZXA.js";import"./chunk-2NVE2BM3.js";import"./chunk-KAQLA7HR.js";import"./chunk-Y7XAAAUB.js";import{d as G}from"./chunk-USTUFZ7V.js";import"./chunk-DXWLW3LX.js";import{b as X,c as Lt,d as q}from"./chunk-7JNU3RG5.js";import{a as Rt,h as wt}from"./chunk-3SKQMCZR.js";import"./chunk-UJ5WOJLI.js";import{a as F,c as Et,e as Tt,g as R}from"./chunk-X7SU23UW.js";import{a as L,b as P}from"./chunk-W6FIBOPD.js";import{D as Dt,b as ht,g as yt,l as It}from"./chunk-EQD33MW2.js";import"./chunk-3R2L4BJM.js";import{a as _t,b as vt}from"./chunk-GGWIF4RR.js";import"./chunk-Y4VWLT32.js";import"./chunk-CDKFCYZ5.js";import{b as Y,c as w}from"./chunk-2HLT5ZQQ.js";import{X as xt,Y as $,_ as M}from"./chunk-UUZHPQZB.js";import"./chunk-CQ6SLR32.js";import{a as St}from"./chunk-BFT2MTJY.js";import{g as bt,l as Ct}from"./chunk-QAO3BBZ5.js";import"./chunk-KTA4MFBX.js";import{i as H,o as N,p as ft,t as S}from"./chunk-HUSU2JWO.js";import{Bc as gt,Dc as O,Eb as p,Fb as u,Hb as pt,Hc as _,Ib as V,Jb as z,Jc as v,Kb as m,Lb as n,Mb as o,Nb as d,Rb as A,Rc as j,Sb as k,Ub as E,Xc as W,Yb as y,Za as a,_b as c,ca as C,ha as I,ia as D,jc as U,m as dt,mb as x,nc as r,oc as g,pc as b,qc as ut,sb as B,sc as lt,ta as h,tc as st,uc as mt}from"./chunk-HCNG3XRF.js";import"./chunk-EQDQRRRY.js";var ce=()=>[6,12,24];function de(i,e){i&1&&(n(0,"div",2),d(1,"mat-spinner",5),o()),i&2&&(a(),m("diameter",40))}function pe(i,e){i&1&&(n(0,"div",3)(1,"p",6),r(2,"Failed to load invoices. Please try again later."),o()())}function ue(i,e){i&1&&(n(0,"th",22),r(1," Invoice Date "),o())}function ge(i,e){if(i&1&&(n(0,"td",23)(1,"span",24),r(2),_(3,"date"),o()()),i&2){let t=e.$implicit;a(2),g(v(3,1,t.billingDate,"MMM d, y"))}}function fe(i,e){i&1&&(n(0,"th",22),r(1," Description "),o())}function be(i,e){if(i&1&&(n(0,"td",23)(1,"span",25),r(2),o()()),i&2){let t=e.$implicit;a(2),g(t.description)}}function Ce(i,e){i&1&&(n(0,"th",26),r(1," Amount "),o())}function xe(i,e){if(i&1&&(n(0,"td",27)(1,"span",28),r(2),_(3,"number"),o()()),i&2){let t=e.$implicit;a(2),ut(" ",t.currency," ",v(3,2,t.amount,"1.2-2")," ")}}function _e(i,e){i&1&&(n(0,"th",29),r(1," Status "),o())}function ve(i,e){if(i&1&&(n(0,"td",30)(1,"span",31),r(2),o()()),i&2){let t=e.$implicit,l=c(2);a(),m("ngClass",l.getStatusClass(t.status)),a(),b(" ",l.formatStatus(t.status)," ")}}function Se(i,e){i&1&&(n(0,"th",26),r(1," Actions "),o())}function Me(i,e){i&1&&d(0,"mat-spinner",5),i&2&&m("diameter",20)}function he(i,e){i&1&&(n(0,"mat-icon",33),r(1,"download"),o())}function ye(i,e){if(i&1){let t=E();n(0,"td",27)(1,"button",32),y("click",function(){let s=I(t).$implicit,f=c(2);return D(f.downloadInvoice(s))}),p(2,Me,1,1,"mat-spinner",5)(3,he,2,0,"mat-icon",33),o()()}if(i&2){let t=c(2);a(),m("disabled",t.isDownloading()),a(),u(t.isDownloading()?2:3)}}function Ie(i,e){i&1&&d(0,"tr",34)}function De(i,e){i&1&&d(0,"tr",35)}function Ee(i,e){if(i&1){let t=E();n(0,"table",7),A(1,8),B(2,ue,2,0,"th",9)(3,ge,4,4,"td",10),k(),A(4,11),B(5,fe,2,0,"th",9)(6,be,3,1,"td",10),k(),A(7,12),B(8,Ce,2,0,"th",13)(9,xe,4,5,"td",14),k(),A(10,15),B(11,_e,2,0,"th",16)(12,ve,3,2,"td",17),k(),A(13,18),B(14,Se,2,0,"th",13)(15,ye,4,2,"td",14),k(),B(16,Ie,1,0,"tr",19)(17,De,1,0,"tr",20),o(),n(18,"mat-paginator",21),y("page",function(s){I(t);let f=c();return D(f.onPageChange(s))}),o()}if(i&2){let t=c();m("dataSource",t.invoices()),a(16),m("matHeaderRowDef",t.displayedColumns),a(),m("matRowDefColumns",t.displayedColumns),a(),m("length",t.totalInvoices())("pageSize",12)("pageSizeOptions",gt(6,ce))}}function Te(i,e){i&1&&d(0,"app-no-record",4)}var et=class i{subscriptionService=C(T);storeStore=C(Mt);pageIndex=h(0);pageSize=h(12);isDownloading=h(!1);invoicesResource=G({params:()=>({pageIndex:this.pageIndex(),pageSize:this.pageSize(),storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>{if(!e.storeId)return dt({invoices:[],total:0});let t=e.pageIndex*e.pageSize;return this.subscriptionService.getInvoices(e.storeId,e.pageSize,t)}});displayedColumns=["billingDate","description","amount","status","actions"];invoices=j(()=>this.invoicesResource.value()?.invoices??[]);totalInvoices=j(()=>this.invoicesResource.value()?.total??0);chartData=j(()=>{let e=this.invoicesResource.value();if(!e?.invoices)return{labels:[],datasets:[{label:"Monthly Billing Amount",data:[],backgroundColor:"#3b82f6",borderColor:"#1e40af",borderWidth:1}]};let l=[...e.invoices].sort((s,f)=>new Date(s.billingDate).getTime()-new Date(f.billingDate).getTime()).slice(-12);return{labels:l.map(s=>this.formatMonth(s.billingDate)),datasets:[{label:"Monthly Billing Amount",data:l.map(s=>s.amount),backgroundColor:"#3b82f6",borderColor:"#1e40af",borderWidth:1}]}});chartOptions={responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!0,position:"top"},title:{display:!1}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Amount"}}}};formatMonth(e){return new Date(e).toLocaleDateString("en-US",{month:"long",year:"numeric"})}formatStatus(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}getStatusClass(e){let t=e.toLowerCase();return t==="paid"?"bg-green-100 text-green-800":t==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}onPageChange(e){this.pageIndex.set(e.pageIndex),this.pageSize.set(e.pageSize)}downloadInvoice(e){this.isDownloading.set(!0),this.subscriptionService.downloadInvoicePdf(e._id).subscribe({next:t=>{let l=window.URL.createObjectURL(t),s=document.createElement("a");s.href=l,s.download=`invoice-${e.invoiceNumber}.pdf`,s.click(),window.URL.revokeObjectURL(l),this.isDownloading.set(!1)},error:t=>{console.error("Failed to download invoice:",t),this.isDownloading.set(!1)}})}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=x({type:i,selectors:[["app-invoices"]],decls:7,vars:3,consts:[[1,"text-sm","font-semibold","text-blue-600","mb-6"],["appearance","outlined",1,"mb-12","py-2"],[1,"flex","justify-center","py-8"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","mb-4"],["icon","receipt_long","title","No Invoices","message","You don't have any invoices yet."],[3,"diameter"],[1,"text-red-800","text-sm"],["mat-table","",1,"w-full","text-sm",3,"dataSource"],["matColumnDef","billingDate"],["mat-header-cell","","class","bg-gray-50 px-6 py-3 text-left font-semibold text-gray-700",4,"matHeaderCellDef"],["mat-cell","","class","px-6 py-4",4,"matCellDef"],["matColumnDef","description"],["matColumnDef","amount"],["mat-header-cell","","class","bg-gray-50 px-6 py-3 text-right font-semibold text-gray-700",4,"matHeaderCellDef"],["mat-cell","","class","px-6 py-4 text-right",4,"matCellDef"],["matColumnDef","status"],["mat-header-cell","","class","bg-gray-50 px-6 py-3 text-center font-semibold text-gray-700",4,"matHeaderCellDef"],["mat-cell","","class","px-6 py-4 text-center",4,"matCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","","aria-label","Select page of invoices",3,"page","length","pageSize","pageSizeOptions"],["mat-header-cell","",1,"bg-gray-50","px-6","py-3","text-left","font-semibold","text-gray-700"],["mat-cell","",1,"px-6","py-4"],[1,"text-gray-900","font-medium"],[1,"text-gray-600"],["mat-header-cell","",1,"bg-gray-50","px-6","py-3","text-right","font-semibold","text-gray-700"],["mat-cell","",1,"px-6","py-4","text-right"],[1,"text-gray-900","font-semibold"],["mat-header-cell","",1,"bg-gray-50","px-6","py-3","text-center","font-semibold","text-gray-700"],["mat-cell","",1,"px-6","py-4","text-center"],[1,"inline-flex","items-center","px-3","py-1","rounded-full","text-xs","font-semibold",3,"ngClass"],["mat-icon-button","","matTooltip","Download PDF",1,"hover:bg-blue-50",3,"click","disabled"],[1,"text-blue-600"],["mat-header-row",""],["mat-row",""]],template:function(t,l){t&1&&(n(0,"h2",0),r(1,"Invoices"),o(),n(2,"mat-card",1),p(3,de,2,1,"div",2),p(4,pe,3,0,"div",3),p(5,Ee,19,7)(6,Te,1,0,"app-no-record",4),o()),t&2&&(a(3),u(l.invoicesResource.isLoading()?3:-1),a(),u(l.invoicesResource.error()?4:-1),a(),u(!l.invoicesResource.isLoading()&&l.invoices().length>0?5:l.invoicesResource.isLoading()?-1:6))},dependencies:[S,H,M,xt,w,Y,P,L,Q,kt,Ft,Ot,Vt,Nt,jt,zt,Ut,Wt,Ht,Yt,qt,Xt,$t,Gt,R,F,ft,N],styles:[".mat-mdc-table{background-color:#fff}  .mat-mdc-table .mat-mdc-header-cell{font-weight:600;color:#374151}  .mat-mdc-table .mat-mdc-cell{color:#4b5563;border-bottom:1px solid #e5e7eb}  .mat-mdc-table tr:hover{background-color:#f9fafb}  .mat-mdc-paginator{background-color:#fff;border-top:1px solid #e5e7eb}  .mat-mdc-paginator .mat-mdc-paginator-container{padding:0 16px;min-height:64px}"],changeDetection:0})};function we(i,e){if(i&1&&(n(0,"mat-card",2)(1,"mat-list")(2,"mat-list-item")(3,"span",3),r(4,"Billing Card"),o(),n(5,"span",4),r(6),o()(),d(7,"mat-divider"),n(8,"mat-list-item")(9,"span",3),r(10,"Subscription Status"),o(),n(11,"span",4),r(12),o()(),d(13,"mat-divider"),n(14,"mat-list-item")(15,"span",3),r(16,"Billing Email"),o(),n(17,"span",4),r(18),o()(),d(19,"mat-divider"),n(20,"mat-list-item")(21,"span",3),r(22,"Billing Country"),o(),n(23,"span",4),r(24),o()(),d(25,"mat-divider"),n(26,"mat-list-item")(27,"span",3),r(28,"Plan Renews"),o(),n(29,"span",4),r(30),_(31,"date"),o()()()()),i&2){let t=c(2);a(6),g(t.getCardDisplay()),a(6),g(t.getStatusLabel()),a(6),g(t.subscription().billingEmail),a(6),g(t.subscription().billingCountry),a(6),g(v(31,5,t.subscription().nextBillingDate,"MMMM d, y"))}}function Le(i,e){if(i&1&&(n(0,"mat-card",5)(1,"mat-list")(2,"mat-list-item")(3,"span",3),r(4,"Trial Started"),o(),n(5,"span",4),r(6),_(7,"date"),o()(),d(8,"mat-divider"),n(9,"mat-list-item")(10,"span",3),r(11,"Trial Expires"),o(),n(12,"span",4),r(13),_(14,"date"),o()(),d(15,"mat-divider"),n(16,"mat-list-item")(17,"span",3),r(18,"Days Remaining"),o(),n(19,"span",6),r(20),o()()()(),n(21,"mat-card",2)(22,"mat-list")(23,"mat-list-item")(24,"span",3),r(25,"Billing Email"),o(),n(26,"span",4),r(27),o()(),d(28,"mat-divider"),n(29,"mat-list-item")(30,"span",3),r(31,"Billing Country"),o(),n(32,"span",4),r(33),o()()()()),i&2){let t=c(2);a(6),g(v(7,5,t.subscription().trialStartDate,"MMMM d, y")),a(7),g(v(14,8,t.subscription().trialEndDate,"MMMM d, y")),a(7),b("",t.getTrialDaysRemaining()," days"),a(7),g(t.subscription().billingEmail),a(6),g(t.subscription().billingCountry)}}function Pe(i,e){if(i&1&&(n(0,"div",0)(1,"h2",1),r(2,"Billing Information"),o(),p(3,we,32,8,"mat-card",2),p(4,Le,34,11),o()),i&2){let t=c();a(3),u(t.subscription().status==="ACTIVE"&&t.subscription().hasPaymentMethod?3:-1),a(),u(t.subscription().status==="TRIAL"?4:-1)}}var ot=class i{subscription=W(null);getCardDisplay(){let e=this.subscription();return e&&e.cardBrand&&e.cardLast4?`${e.cardBrand.toUpperCase()} ending in ${e.cardLast4}`:"No card on file"}getCardColor(){let e=this.subscription();if(!e||!e.cardBrand)return"text-gray-600";let t=e.cardBrand.toLowerCase();return t.includes("visa")?"text-blue-600":t.includes("mastercard")?"text-red-600":t.includes("amex")?"text-green-600":"text-gray-600"}getStatusLabel(){let e=this.subscription();return e?{TRIAL:"Free Trial",ACTIVE:"Active",PAST_DUE:"Payment Required",EXPIRED:"Expired",CANCELLED:"Cancelled"}[e.status]||e.status:""}getTrialDaysRemaining(){let e=this.subscription();if(!e||e.status!=="TRIAL")return 0;let t=new Date(e.trialEndDate),l=new Date,s=Math.ceil((t.getTime()-l.getTime())/(1e3*60*60*24));return Math.max(0,s)}getTrialProgress(){let e=this.subscription();if(!e||e.status!=="TRIAL")return 0;let t=new Date(e.trialStartDate),l=new Date(e.trialEndDate),s=new Date,f=(l.getTime()-t.getTime())/(1e3*60*60*24),se=(s.getTime()-t.getTime())/(1e3*60*60*24);return Math.min(100,Math.round(se/f*100))}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=x({type:i,selectors:[["app-billing-information"]],inputs:{subscription:[1,"subscription"]},decls:1,vars:1,consts:[[1,"mb-12"],[1,"text-sm","font-semibold","text-blue-600","mb-6"],["appearance","outlined"],["matListItemTitle",""],["matListItemLine",""],["appearance","outlined",1,"mb-6"],["matListItemLine","",1,"text-blue-600","font-semibold"]],template:function(t,l){t&1&&p(0,Pe,5,2,"div",0),t&2&&u(l.subscription()?0:-1)},dependencies:[S,w,M,Q,R,F,J,K,Z,Pt,At,Bt,N],encapsulation:2,changeDetection:0})};function Be(i,e){if(i&1&&(n(0,"mat-list-item")(1,"mat-radio-button",7),r(2),o()()),i&2){let t=e.$implicit;a(),m("value",t),a(),b(" ",t," ")}}function Ae(i,e){if(i&1){let t=E();n(0,"mat-form-field",3)(1,"mat-label"),r(2,"Please tell us more"),o(),n(3,"textarea",8),mt("ngModelChange",function(s){I(t);let f=c();return st(f.reason,s)||(f.reason=s),D(s)}),o()()}if(i&2){let t=c();a(3),lt("ngModel",t.reason)}}function ke(i,e){i&1&&(d(0,"mat-spinner",9),r(1," Cancelling... "))}function Ne(i,e){i&1&&r(0," Cancel Subscription ")}var at=class i{dialogRef=C(Kt);subscriptionService=C(T);snackBar=C(_t);reason="";selectedReason="";isSubmitting=h(!1);reasons=["Too expensive","Not using the features","Found a better alternative","Business closure","Other"];onCancel(){this.dialogRef.close()}onConfirm(){let e=this.selectedReason==="Other"?this.reason:this.selectedReason;e.trim()&&(this.isSubmitting.set(!0),this.subscriptionService.cancelSubscription(e).subscribe({next:t=>{this.isSubmitting.set(!1),this.snackBar.open("Subscription cancelled successfully","Close",{duration:5e3,panelClass:["success-snackbar"],horizontalPosition:"end",verticalPosition:"bottom"}),this.dialogRef.close(e),setTimeout(()=>{window.location.reload()},500)},error:t=>{this.isSubmitting.set(!1);let l=t?.error?.message||"Failed to cancel subscription. Please try again.";this.snackBar.open(l,"Close",{duration:6e3,panelClass:["error-snackbar"],horizontalPosition:"end",verticalPosition:"bottom"})}}))}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=x({type:i,selectors:[["app-cancel-subscription-dialog"]],decls:16,vars:5,consts:[["mat-dialog-title",""],[1,"text-sm","text-gray-600","mb-6"],[1,"block","mb-4",3,"ngModelChange","ngModel"],["appearance","outline",1,"w-full","mt-4"],["align","end"],["matButton","outlined",3,"click","disabled"],["matButton","filled","color","warn",3,"click","disabled"],[3,"value"],["matInput","","placeholder","Why are you cancelling?","rows","4",3,"ngModelChange","ngModel"],["diameter","20",1,"inline-block","mr-2"]],template:function(t,l){t&1&&(n(0,"h2",0),r(1,"Cancel Subscription"),o(),n(2,"mat-dialog-content")(3,"p",1),r(4," We'd like to understand why you're cancelling. Your feedback helps us improve. "),o(),n(5,"mat-radio-group",2),mt("ngModelChange",function(f){return st(l.selectedReason,f)||(l.selectedReason=f),f}),n(6,"mat-list"),V(7,Be,3,2,"mat-list-item",null,pt),o()(),p(9,Ae,4,1,"mat-form-field",3),o(),n(10,"mat-dialog-actions",4)(11,"button",5),y("click",function(){return l.onCancel()}),r(12," Keep Subscription "),o(),n(13,"button",6),y("click",function(){return l.onConfirm()}),p(14,ke,2,0)(15,Ne,1,0),o()()),t&2&&(a(5),lt("ngModel",l.selectedReason),a(2),z(l.reasons),a(2),u(l.selectedReason==="Other"?9:-1),a(2),m("disabled",l.isSubmitting()),a(2),m("disabled",!l.selectedReason||l.selectedReason==="Other"&&!l.reason.trim()||l.isSubmitting()),a(),u(l.isSubmitting()?14:15))},dependencies:[S,Dt,ht,yt,It,tt,Jt,te,Qt,M,$,X,wt,Rt,q,Lt,ne,ee,ie,J,K,Z,P,L,vt],encapsulation:2})};var Fe=(i,e)=>({"bg-blue-100":i,"bg-green-100":e}),Ve=(i,e)=>({"text-blue-600":i,"text-green-600":e}),ze=(i,e)=>({"bg-blue-100 text-blue-700":i,"bg-green-100 text-green-700":e}),Ue=(i,e)=>e.roomRange;function Oe(i,e){if(i&1&&(r(0),_(1,"date")),i&2){let t=c(2);b(" ",v(1,1,t.subscription().trialEndDate,"MMM d, y")," ")}}function je(i,e){if(i&1&&(r(0),_(1,"date")),i&2){let t=c(2);b(" ",v(1,1,t.subscription().nextBillingDate,"MMM d, y")," ")}}function We(i,e){if(i&1){let t=E();n(0,"mat-card",2)(1,"mat-card-content",5)(2,"div",6)(3,"div",7)(4,"mat-icon",8),r(5),o()(),n(6,"div",9)(7,"div",10)(8,"p",11),r(9),o(),n(10,"span",12),r(11),o()(),n(12,"p",13),r(13),n(14,"span",14),p(15,Oe,2,4)(16,je,2,4),o()(),n(17,"p",15)(18,"span",16),r(19),o()()(),n(20,"button",17),y("click",function(){I(t);let s=c();return D(s.onActionClick())}),r(21),o()()()()}if(i&2){let t=c();a(3),m("ngClass",O(11,Fe,t.subscription().status==="TRIAL",t.subscription().status==="ACTIVE")),a(),m("ngClass",O(14,Ve,t.subscription().status==="TRIAL",t.subscription().status==="ACTIVE")),a(),b(" ",t.subscription().status==="TRIAL"?"schedule":"verified_user"," "),a(4),b(" ",t.subscription().status==="TRIAL"?"Free Trial":"Active Subscription"," "),a(),m("ngClass",O(17,ze,t.subscription().status==="TRIAL",t.subscription().status==="ACTIVE")),a(),b(" ",t.subscription().status==="TRIAL"?"TRIAL":"ACTIVE"," "),a(2),b(" ",t.subscription().status==="TRIAL"?"Expires on":"Renews on"," "),a(2),u(t.subscription().status==="TRIAL"?15:16),a(4),g(t.getRoomRangeLabel()),a(),m("color",t.subscription().status==="TRIAL"?"primary":"warn"),a(),b(" ",t.getButtonLabel()," ")}}function He(i,e){i&1&&(n(0,"div",3),d(1,"mat-spinner",18),o()),i&2&&(a(),m("diameter",40))}function $e(i,e){if(i&1){let t=E();n(0,"mat-card",19)(1,"mat-card-content",20)(2,"div",21)(3,"div",22)(4,"mat-icon",23),r(5,"home"),o()(),n(6,"div")(7,"h3",24),r(8),o(),n(9,"p",25),r(10,"Per Month"),o()()(),n(11,"div",26)(12,"p",27),r(13),n(14,"span",28),r(15),o()(),n(16,"p",29),r(17,"/month billed annually"),o()(),n(18,"div",30)(19,"div",31)(20,"mat-icon",23),r(21,"check_circle"),o(),n(22,"span"),r(23,"Unlimited users"),o()(),n(24,"div",31)(25,"mat-icon",23),r(26,"check_circle"),o(),n(27,"span"),r(28,"24/7 support"),o()(),n(29,"div",31)(30,"mat-icon",23),r(31,"check_circle"),o(),n(32,"span"),r(33,"All features"),o()()()(),n(34,"mat-card-actions",32)(35,"button",33),y("click",function(){let s=I(t).$implicit,f=c(2);return D(f.onActionClick(s))}),r(36),o()()()}if(i&2){let t=e.$implicit,l=c(2);a(8),g(t.roomRange),a(5),g(t.currency),a(2),g(t.price),a(5),U("font-size","16px"),a(5),U("font-size","16px"),a(5),U("font-size","16px"),a(5),m("disabled",l.isCurrentPlan(t.roomRange)),a(),b(" ",l.getPlanActionLabel(t.roomRange)," ")}}function Xe(i,e){if(i&1&&(n(0,"div",4),V(1,$e,37,11,"mat-card",19,Ue),o()),i&2){let t=c();a(),z(t.pricingResource.value().pricingTiers)}}var rt=class i{subscription=W(null);subscriptionService=C(T);router=C(bt);dialog=C(Zt);pricingResource=G({stream:()=>this.subscriptionService.getPricingPlans()});getButtonLabel(){let e=this.subscription();return e&&e.status==="TRIAL"?"Upgrade Plan":"Cancel Subscription"}getRoomRangeLabel(){let e=this.subscription();if(!e||e.status==="TRIAL")return"Up to 10 rooms";let t=e.roomCount||10;return t<=10?"0-10 rooms":t<=30?"11-30 rooms":t<=35?"31-35 rooms":"35+ rooms"}getNextTierRoomCount(){let e=this.subscription();if(!e||e.status==="TRIAL")return 10;let t=e.roomCount||10;return t<=10?11:t<=30?31:t<=35?36:t}getRoomCountFromRange(e){return e.includes("0-10")?10:e.includes("11-30")?30:e.includes("31-35")?35:e.includes("35+")?50:10}isCurrentPlan(e){let t=this.subscription();return this.subscriptionService.isCurrentSubscriptionPlan(t,e)}isDowngradePlan(e){let t=this.subscription();return this.subscriptionService.isDowngrade(t,e)}getPlanActionLabel(e){let t=this.subscription();return this.subscriptionService.getPlanActionLabel(t,e)}onActionClick(e){let t=this.subscription();if(t)if(t.status==="TRIAL"||e){let l=e?this.getRoomCountFromRange(e.roomRange):this.getNextTierRoomCount();this.subscriptionService.initiateUpgradePayment(l,St.paymentReturnUrl).subscribe({next:s=>{s.checkoutUrl&&(window.location.href=s.checkoutUrl)},error:s=>{console.error("Failed to initiate payment:",s)}})}else this.openCancelDialog()}openCancelDialog(){this.dialog.open(at,{width:"400px",disableClose:!1}).afterClosed().subscribe(t=>{})}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=x({type:i,selectors:[["app-current-plan"]],inputs:{subscription:[1,"subscription"]},decls:6,vars:3,consts:[[1,"mb-12"],[1,"text-sm","font-semibold","text-blue-600","mb-6"],["appearance","outlined",1,"mb-8","bg-white"],[1,"flex","justify-center","py-8"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-2","xl:grid-cols-4","gap-6"],[1,"p-0"],[1,"flex","items-center","gap-8","py-6","px-6"],[1,"flex-shrink-0","w-20","h-20","rounded-lg","flex","items-center","justify-center",3,"ngClass"],[3,"ngClass"],[1,"flex-1"],[1,"flex","items-baseline","gap-2","mb-1"],[1,"text-sm","font-semibold","text-gray-900"],[1,"text-xs","font-semibold","px-2.5","py-0.5","rounded-full",3,"ngClass"],[1,"text-sm","text-gray-500","mb-3"],[1,"font-semibold","text-gray-700"],[1,"text-sm","text-gray-600"],[1,"font-semibold"],["matButton","filled",1,"flex-shrink-0",3,"click","color"],[3,"diameter"],["appearance","outlined",1,"flex","flex-col","hover:shadow-lg","transition-all","duration-300","ease-in-out"],[1,"flex-1","p-6"],[1,"flex","items-center","gap-3","mb-4"],[1,"w-12","h-12","rounded-lg","bg-blue-100","flex","items-center","justify-center"],[1,"text-blue-600"],[1,"text-sm","font-bold","text-gray-900"],[1,"text-xs","text-gray-500"],[1,"border-t","border-gray-100","pt-4","mb-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-xl"],[1,"text-xs","text-gray-500","mt-1"],[1,"space-y-2","text-xs","text-gray-600"],[1,"flex","items-center","gap-2"],[1,"p-6","pt-0"],["matButton","filled",1,"w-full",3,"click","disabled"]],template:function(t,l){t&1&&(n(0,"div",0)(1,"h2",1),r(2,"Current Plan"),o(),p(3,We,22,20,"mat-card",2),p(4,He,2,1,"div",3),p(5,Xe,3,0,"div",4),o()),t&2&&(a(3),u(l.subscription()?3:-1),a(),u(l.pricingResource.isLoading()?4:-1),a(),u(!l.pricingResource.isLoading()&&l.pricingResource.value()?5:-1))},dependencies:[S,H,M,$,P,L,w,Y,R,F,Tt,Et,tt,X,q,N],encapsulation:2})};function qe(i,e){i&1&&(n(0,"div",2),d(1,"mat-spinner",3),o()),i&2&&(a(),m("diameter",50))}function Ye(i,e){if(i&1&&d(0,"app-current-plan",4),i&2){let t=c(2);m("subscription",t.subscription())}}function Ge(i,e){if(i&1&&(d(0,"app-billing-information",4),p(1,Ye,1,1,"app-current-plan",4),d(2,"app-invoices")),i&2){let t=c();m("subscription",t.subscription()),a(),u(t.subscription().status!=="EXPIRED"&&t.subscription().status!=="CANCELLED"?1:-1)}}var le=class i{subscriptionService=C(T);isLoading=h(!0);subscription=h(null);ngOnInit(){this.loadSubscription()}loadSubscription(){this.isLoading.set(!0),this.subscriptionService.getSubscriptionStatus().subscribe({next:e=>{this.subscription.set(e),this.isLoading.set(!1)},error:e=>{console.error("Failed to load subscription:",e),this.isLoading.set(!1)}})}getStatusLabel(e){return{TRIAL:"Free Trial",ACTIVE:"Active",PAST_DUE:"Payment Required",EXPIRED:"Expired",CANCELLED:"Cancelled"}[e]||e}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=x({type:i,selectors:[["app-billing"]],decls:4,vars:2,consts:[[1,"w-full","min-h-screen","p-8"],[1,"max-w-6xl","mx-auto"],[1,"flex","justify-center","py-16"],[3,"diameter"],[3,"subscription"]],template:function(t,l){t&1&&(n(0,"div",0)(1,"div",1),p(2,qe,2,1,"div",2),p(3,Ge,3,2),o()()),t&2&&(a(2),u(l.isLoading()?2:-1),a(),u(!l.isLoading()&&l.subscription()?3:-1))},dependencies:[Ct,S,R,w,P,L,M,et,ot,rt],styles:["[_nghost-%COMP%]{display:block}"]})};export{le as Billing};
