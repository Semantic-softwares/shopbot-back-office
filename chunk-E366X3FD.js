import{b as Re}from"./chunk-ZAOMQAJO.js";import{d as Be,e as $e,h as qe,i as Ge,j as Ve,k as Pe}from"./chunk-XSZYAESL.js";import{a as Ie,b as Ae,c as Ne}from"./chunk-LCNY3JPX.js";import{a as Se,b as ke,c as Fe,h as De}from"./chunk-MSN3EE44.js";import{a as O}from"./chunk-YHIOFNIN.js";import{a as Y,b as Z,c as ee,d as te,f as ae}from"./chunk-F5YHHFYE.js";import{a as Ce,b as Te}from"./chunk-LCF3SYDV.js";import{d as w}from"./chunk-ZLVLWRZH.js";import{a as Ee}from"./chunk-HJGFVW6K.js";import{b as he,c as ye,d as ve}from"./chunk-63HT37SK.js";import{a as fe,b as xe,e as _e,h as be}from"./chunk-YJCGHVXK.js";import{b as Me}from"./chunk-3ZLH5HUN.js";import{B as ge,b as ie,d as c,g as re,h as ne,m as le,n as oe,q as se,r as me,s as pe,t as de,y as ce,z as ue}from"./chunk-O5GCTPYR.js";import{a as H,b as J}from"./chunk-5TL46KBL.js";import{a as K}from"./chunk-BFT2MTJY.js";import{h as X}from"./chunk-JONI64R4.js";import{b as Q,c as W}from"./chunk-G6I3OKXX.js";import{Z as j,_ as L,ba as z}from"./chunk-4Z2XUZY2.js";import{A as U,u as P}from"./chunk-H22US2IH.js";import{Ib as g,Jb as f,Kb as $,Mb as q,Nb as G,Ob as d,Pb as r,Qb as a,Rb as x,Yb as V,aa as I,ac as _,bb as m,cc as C,fa as u,ka as A,la as N,mc as T,qa as R,qb as B,r as b,rc as n,tc as v,wa as h}from"./chunk-P5WOETP4.js";import{a as F,b as D}from"./chunk-GAL4ENT6.js";var M=class o{http=u(U);apiUrl=K.apiUrl;getTaxes(t,l=1,i=100){return this.http.get(`${this.apiUrl}/admin/channex/taxes?propertyId=${t}&page=${l}&limit=${i}`).pipe(b(e=>(Array.isArray(e?.data)?e.data:[]).map(p=>({id:p.id||p.attributes?.id,title:p.attributes?.title,position:p.attributes?.position,rate:p.attributes?.rate,is_inclusive:p.attributes?.is_inclusive,logic:p.attributes?.logic,type:p.attributes?.type,currency:p.attributes?.currency,max_nights:p.attributes?.max_nights,skip_nights:p.attributes?.skip_nights,applicable_date_ranges:p.attributes?.applicable_date_ranges}))))}getTax(t,l){return this.http.get(`${this.apiUrl}/admin/channex/taxes/${l}?propertyId=${t}`).pipe(b(i=>{let e=i?.data;return{id:e.id||e.attributes?.id,title:e.attributes?.title,position:e.attributes?.position,rate:e.attributes?.rate,is_inclusive:e.attributes?.is_inclusive,logic:e.attributes?.logic,type:e.attributes?.type,currency:e.attributes?.currency,max_nights:e.attributes?.max_nights,skip_nights:e.attributes?.skip_nights,applicable_date_ranges:e.attributes?.applicable_date_ranges}}))}createTax(t,l){return this.http.post(`${this.apiUrl}/admin/channex/taxes?propertyId=${t}`,l).pipe(b(i=>{let e=i?.data;return{id:e.id||e.attributes?.id,title:e.attributes?.title,position:e.attributes?.position,rate:e.attributes?.rate,is_inclusive:e.attributes?.is_inclusive,logic:e.attributes?.logic,type:e.attributes?.type,currency:e.attributes?.currency,max_nights:e.attributes?.max_nights,skip_nights:e.attributes?.skip_nights,applicable_date_ranges:e.attributes?.applicable_date_ranges}}))}updateTax(t,l,i){return this.http.put(`${this.apiUrl}/admin/channex/taxes/${l}?propertyId=${t}`,i).pipe(b(e=>{let s=e?.data;return{id:s.id||s.attributes?.id,title:s.attributes?.title,position:s.attributes?.position,rate:s.attributes?.rate,is_inclusive:s.attributes?.is_inclusive,logic:s.attributes?.logic,type:s.attributes?.type,currency:s.attributes?.currency,max_nights:s.attributes?.max_nights,skip_nights:s.attributes?.skip_nights,applicable_date_ranges:s.attributes?.applicable_date_ranges}}))}deleteTax(t,l){return this.http.delete(`${this.apiUrl}/admin/channex/taxes/${l}?propertyId=${t}`)}static \u0275fac=function(l){return new(l||o)};static \u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})};function Oe(o,t){o&1&&(r(0,"mat-error"),n(1,"Title is required"),a())}function je(o,t){o&1&&(r(0,"mat-error"),n(1,"Title must be at least 3 characters"),a())}function Le(o,t){o&1&&(r(0,"mat-error"),n(1,"Type is required"),a())}function ze(o,t){o&1&&(r(0,"mat-error"),n(1,"Currency is required"),a())}function He(o,t){o&1&&(r(0,"mat-error"),n(1,"Currency must be 3 characters"),a())}function Je(o,t){o&1&&(r(0,"mat-error"),n(1,"Rate is required"),a())}function Ke(o,t){if(o&1){let l=V();r(0,"div",28)(1,"div",32)(2,"span",33),n(3),a(),r(4,"button",34),_("click",function(){let e=A(l).$index,s=C();return N(s.removeDateRange(e))}),r(5,"mat-icon"),n(6,"delete"),a()()(),r(7,"div",35)(8,"mat-form-field",5)(9,"mat-label"),n(10,"Applicable after :"),a(),x(11,"input",36)(12,"mat-datepicker-toggle",37)(13,"mat-datepicker",null,0),a(),r(15,"mat-form-field",5)(16,"mat-label"),n(17,"Applicable before :"),a(),x(18,"input",38)(19,"mat-datepicker-toggle",37)(20,"mat-datepicker",null,1),a()()()}if(o&2){let l=t.$index,i=T(14),e=T(21);d("formGroupName",l),m(3),v("Date range ",l+1),m(8),d("matDatepicker",i),m(),d("for",i),m(6),d("matDatepicker",e),m(),d("for",e)}}function Qe(o,t){o&1&&n(0," Saving... ")}function We(o,t){if(o&1&&n(0),o&2){let l=C();v(" ",l.isEditing()?"Update Tax":"Create Tax"," ")}}var Ue=class o{fb=u(ue);taxService=u(M);snackBar=u(H);dialogRef=u(Be);destroyRef=u(R);data=u($e);taxForm;isSaving=h(!1);isEditing=h(!1);additionalInfoExpanded=h(!1);applicableDatesExpanded=h(!1);constructor(){this.initializeForm(),this.data.tax&&(this.isEditing.set(!0),this.additionalInfoExpanded.set(!0),this.applicableDatesExpanded.set(!0),this.populateForm(this.data.tax))}initializeForm(){this.taxForm=this.fb.group({title:["",[c.required,c.minLength(3)]],is_inclusive:[!1],rate:["",[c.required,c.min(0)]],logic:["percent",c.required],type:["fee",c.required],currency:["",[c.required,c.minLength(3),c.maxLength(3)]],max_nights:[""],skip_nights:[""],applicable_date_ranges:this.fb.array([])})}populateForm(t){if(this.taxForm.patchValue({title:t.title,is_inclusive:t.is_inclusive||!1,rate:t.rate||"",logic:t.logic||"percent",type:t.type||"fee",currency:t.currency||"",max_nights:t.max_nights||"",skip_nights:t.skip_nights||""}),t.applicable_date_ranges&&Array.isArray(t.applicable_date_ranges)){let l=this.taxForm.get("applicable_date_ranges");t.applicable_date_ranges.forEach(i=>{l.push(this.fb.group({after:[i.after||null],before:[i.before||null]}))})}}get dateRangesArray(){return this.taxForm.get("applicable_date_ranges")}addDateRange(){this.dateRangesArray.push(this.fb.group({after:[null],before:[null]}))}removeDateRange(t){this.dateRangesArray.removeAt(t)}saveTax(){if(!this.taxForm.valid){this.snackBar.open("Please fill in all required fields","Close",{duration:3e3});return}this.isSaving.set(!0);let t=this.taxForm.getRawValue(),l=D(F({},t),{rate:String(t.rate),max_nights:t.max_nights?String(t.max_nights):null,skip_nights:t.skip_nights?String(t.skip_nights):null,applicable_date_ranges:t.applicable_date_ranges.filter(e=>e.after||e.before)});(this.isEditing()?this.taxService.updateTax(this.data.propertyId,this.data.tax.id,l):this.taxService.createTax(this.data.propertyId,l)).pipe(Ee(this.destroyRef)).subscribe({next:e=>{this.isSaving.set(!1);let s=this.isEditing()?"Tax updated successfully":"Tax created successfully";this.snackBar.open(s,"Close",{duration:3e3}),this.dialogRef.close(e)},error:e=>{this.isSaving.set(!1);let s=e.error?.message||"Failed to save tax";this.snackBar.open(s,"Close",{duration:5e3}),console.error("Error saving tax:",e)}})}cancel(){this.dialogRef.close()}static \u0275fac=function(l){return new(l||o)};static \u0275cmp=B({type:o,selectors:[["app-channel-manager-create-tax-modal"]],decls:80,vars:14,consts:[["pickerAfter",""],["pickerBefore",""],["mat-dialog-title","",1,"m-0"],[1,"space-y-4"],[1,"space-y-4",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","title","placeholder","e.g., City Tax"],[1,"flex","items-center","gap-4"],[1,"text-sm","font-medium","text-gray-700"],["aria-label","Is inclusive option",3,"change","value"],["value","inclusive"],["value","exclusive"],["formControlName","logic"],["value","percent"],["value","absolute"],["value","per_booking"],["formControlName","type"],["value","fee"],["value","tax"],["value","city_tax"],["matInput","","formControlName","currency","placeholder","e.g., NGN","maxlength","3"],["matInput","","type","number","formControlName","rate","placeholder","e.g., 10"],[3,"expanded"],[1,"space-y-4","pt-4"],["matInput","","type","number","formControlName","max_nights","placeholder","e.g., 30"],["matInput","","type","number","formControlName","skip_nights","placeholder","e.g., 0"],["type","button","mat-icon-button","",1,"text-blue-600",3,"click"],["formArrayName","applicable_date_ranges",1,"space-y-4","pt-4"],[1,"p-4","border","border-gray-200","rounded-lg",3,"formGroupName"],[1,"flex","items-center","justify-end","gap-3","mt-6","pt-6","border-t","border-gray-200"],["matButton","",3,"click","disabled"],["matButton","filled","color","primary",3,"click","disabled"],[1,"flex","items-center","justify-between","mb-3"],[1,"font-medium","text-gray-900"],["type","button","mat-icon-button","",1,"text-red-600",3,"click"],[1,"space-y-3"],["matInput","","formControlName","after",3,"matDatepicker"],["matIconSuffix","",3,"for"],["matInput","","formControlName","before",3,"matDatepicker"]],template:function(l,i){if(l&1&&(r(0,"h2",2),n(1),a(),r(2,"mat-dialog-content",3)(3,"form",4)(4,"mat-form-field",5)(5,"mat-label"),n(6,"Title"),a(),x(7,"input",6),g(8,Oe,2,0,"mat-error"),g(9,je,2,0,"mat-error"),a(),r(10,"div",7)(11,"span",8),n(12,"Is inclusive:"),a(),r(13,"mat-button-toggle-group",9),_("change",function(s){let p;return(p=i.taxForm.get("is_inclusive"))==null?null:p.setValue(s.value==="exclusive")}),r(14,"mat-button-toggle",10),n(15,"Inclusive"),a(),r(16,"mat-button-toggle",11),n(17,"Exclusive"),a()()(),r(18,"mat-form-field",5)(19,"mat-label"),n(20,"Logic"),a(),r(21,"mat-select",12)(22,"mat-option",13),n(23,"Percent"),a(),r(24,"mat-option",14),n(25,"Absolute"),a(),r(26,"mat-option",15),n(27,"Per Booking"),a()()(),r(28,"mat-form-field",5)(29,"mat-label"),n(30,"Type"),a(),r(31,"mat-select",16)(32,"mat-option",17),n(33,"Fee"),a(),r(34,"mat-option",18),n(35,"Tax"),a(),r(36,"mat-option",19),n(37,"City Tax"),a()(),g(38,Le,2,0,"mat-error"),a(),r(39,"mat-form-field",5)(40,"mat-label"),n(41,"Currency"),a(),x(42,"input",20),g(43,ze,2,0,"mat-error"),g(44,He,2,0,"mat-error"),a(),r(45,"mat-form-field",5)(46,"mat-label"),n(47,"Rate"),a(),x(48,"input",21),g(49,Je,2,0,"mat-error"),a(),r(50,"mat-expansion-panel",22)(51,"mat-expansion-panel-header")(52,"mat-panel-title"),n(53,"Additional Information"),a()(),r(54,"div",23)(55,"mat-form-field",5)(56,"mat-label"),n(57,"Max nights"),a(),x(58,"input",24),a(),r(59,"mat-form-field",5)(60,"mat-label"),n(61,"Skip nights"),a(),x(62,"input",25),a()()(),r(63,"mat-expansion-panel",22)(64,"mat-expansion-panel-header")(65,"mat-panel-title"),n(66," Applicable Dates "),a(),r(67,"mat-panel-description")(68,"button",26),_("click",function(s){return i.addDateRange(),s.stopPropagation()}),r(69,"mat-icon"),n(70,"add_circle"),a()()()(),r(71,"div",27),q(72,Ke,22,6,"div",28,$),a()()()(),r(74,"mat-dialog-actions",29)(75,"button",30),_("click",function(){return i.cancel()}),n(76," Cancel "),a(),r(77,"button",31),_("click",function(){return i.saveTax()}),g(78,Qe,1,0)(79,We,1,1),a()()),l&2){let e,s,p,E,S,y,k;m(),v(" ",i.isEditing()?"Edit Tax":"Create Tax"," "),m(2),d("formGroup",i.taxForm),m(5),f((e=i.taxForm.get("title"))!=null&&e.hasError("required")?8:-1),m(),f((s=i.taxForm.get("title"))!=null&&s.hasError("minlength")?9:-1),m(4),d("value",(p=i.taxForm.get("is_inclusive"))!=null&&p.value?"exclusive":"inclusive"),m(25),f((E=i.taxForm.get("type"))!=null&&E.hasError("required")?38:-1),m(5),f((S=i.taxForm.get("currency"))!=null&&S.hasError("required")?43:-1),m(),f((y=i.taxForm.get("currency"))!=null&&y.hasError("minlength")||(y=i.taxForm.get("currency"))!=null&&y.hasError("maxlength")?44:-1),m(5),f((k=i.taxForm.get("rate"))!=null&&k.hasError("required")?49:-1),m(),d("expanded",i.additionalInfoExpanded()),m(13),d("expanded",i.applicableDatesExpanded()),m(9),G(i.dateRangesArray.controls),m(3),d("disabled",i.isSaving()),m(2),d("disabled",i.isSaving()||!i.taxForm.valid),m(),f(i.isSaving()?78:79)}},dependencies:[P,ge,le,ie,oe,re,ne,ce,de,pe,se,me,Pe,qe,Ve,Ge,he,be,fe,xe,_e,ve,ye,z,L,j,Te,Ce,w,Me,J,X,Re,De,Se,ke,Fe,O,W,Q,ae,Y,Z,te,ee,Ne,Ie,Ae],encapsulation:2,changeDetection:0})};export{M as a,Ue as b};
