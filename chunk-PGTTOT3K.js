import{a as wi}from"./chunk-HXX2WBS6.js";import{a as Vi}from"./chunk-N4UJV5MY.js";import{a as ki,b as Ei,c as Oi}from"./chunk-LNNO6GSB.js";import{a as st,b as dt}from"./chunk-J5WNIMVA.js";import{a as Bi,b as Li}from"./chunk-7EKGV6NO.js";import"./chunk-QBBPDKHM.js";import{a as ct}from"./chunk-3VJO7DSO.js";import{a as Ri}from"./chunk-DEWY4UEI.js";import{a as Pi,b as Ii,c as Gi,d as Fi}from"./chunk-SVFSDI6R.js";import{a as Di,b as Ti,c as De,d as lt,e as Ai,g as Ni}from"./chunk-625ICML5.js";import"./chunk-XM7KJLGN.js";import"./chunk-FUTA6TE5.js";import"./chunk-XHVZNRPI.js";import{a as yi,b as Mi}from"./chunk-FT2IR4DU.js";import{a as xi}from"./chunk-QS3AL2H2.js";import{b as bi}from"./chunk-LSNVMFZZ.js";import{a as fi,c as gi,e as _i,f as Ci}from"./chunk-LPOORG3R.js";import{a as at}from"./chunk-QWARUEJB.js";import{a as hi}from"./chunk-JLQZK5UR.js";import{a as vi,b as Si}from"./chunk-4SHNZOR7.js";import{a as W,b as ie,c as Me,d as $e,e as oe,f as ne,g as re,h as K}from"./chunk-LKRQNUDW.js";import{a as di,b as mi,c as ui}from"./chunk-3PQC2AD7.js";import{a as pi}from"./chunk-ZEC2X3UU.js";import{h as si}from"./chunk-PYMVMKZE.js";import{a as Qe}from"./chunk-34V2NAQK.js";import{a as Le}from"./chunk-JBPT7IMO.js";import{a as Kt,b as Yt,c as Zt,g as ei}from"./chunk-32W4X7QQ.js";import{a as ti,b as ii,c as oi,e as ni,f as ri,g as ai,h as li,k as ci,l as Be}from"./chunk-SALMKQAC.js";import{b as rt}from"./chunk-TEWFCVG4.js";import{a as At}from"./chunk-EHJ5MOYI.js";import"./chunk-UDYHQK5Q.js";import"./chunk-2KPMOGOH.js";import"./chunk-TRRVPZ2R.js";import{d as qt}from"./chunk-XCSZ2RSV.js";import{a as h,b as Ie,c as Ge,d as Fe,e as ke,f as Ae,g as J,h as X,i as E}from"./chunk-WFQLSX5X.js";import{a as Ht,b as Jt}from"./chunk-D2CDDOVY.js";import{d as Ft}from"./chunk-S6O7RC67.js";import{a as Xt,d as Wt}from"./chunk-WD3LGOJ6.js";import"./chunk-KQ2NF2R5.js";import"./chunk-AQTPIICF.js";import"./chunk-GZ7S2I6F.js";import"./chunk-L5R7UQHM.js";import{b as te,c as ye,d as me}from"./chunk-VN3HHLBZ.js";import{a as se,b as nt,d as xe,e as zt,h as de}from"./chunk-THLNJRLH.js";import"./chunk-GBJWJHBW.js";import{a as ue,b as pe}from"./chunk-YJKLGOC4.js";import{A as ee,B as Ne,b as Ke,d as Ee,g as Ye,h as Ze,k as jt,m as et,n as Ut,s as tt,t as it,z as ot}from"./chunk-ADPCW6JI.js";import"./chunk-UUMWQRYG.js";import{a as Bt}from"./chunk-VNGKQKTG.js";import{a as Lt}from"./chunk-RRHIWUSE.js";import"./chunk-VJNXGGOY.js";import"./chunk-UPMF7ZC6.js";import"./chunk-BFT2MTJY.js";import{a as Xe,c as Qt,e as $t,h as We}from"./chunk-EALJFX3J.js";import"./chunk-5AHC55Y5.js";import"./chunk-TVQ3FP64.js";import"./chunk-47XHPHB4.js";import{b as L,c as A}from"./chunk-IYN665YT.js";import{$ as Re,Y as be,Z as q,_ as Nt,aa as F,c as Ve,d as ge}from"./chunk-OYVOT3CA.js";import{l as Gt,p as Se,r as G}from"./chunk-6BQAOBQP.js";import{$a as c,Ec as Je,G as kt,Gb as _,Hb as C,Ib as we,Jc as B,Kb as j,Kc as Dt,Lb as U,Lc as Tt,Mb as v,Nb as n,Nc as Y,Ob as r,Pb as V,Qb as le,Rb as ce,Tc as y,U as $,Wb as b,X as ve,Xa as He,Yc as H,Zc as Z,_b as p,ac as d,c as z,ea as m,ec as Ot,f as wt,fc as Vt,gc as Rt,ja as f,ka as g,m as ze,mc as Oe,ob as I,pc as l,qc as D,rc as T,sc as It,ub as Mt,va as w,ya as Et}from"./chunk-H33Y42PP.js";import{a as k,b as N}from"./chunk-GAL4ENT6.js";var qe=class{name;activate;position;color;icon;items;store;foods;constructor(t){this.name=t.name||"",this.activate=t.activate??!0,this.position=t.position||0,this.color=t.color||"#CFDDDB",this.icon=t.icon||"lunch_dining",this.items=t.items||0,this.store=t.store||"",this.foods=t.foods||[]}};var Ui={categories:[],selectedCategory:null,isLoading:!1,error:null},mt=Ie({providedIn:"root"},Ae(Ui),Ge(({categories:o})=>({categoryCount:y(()=>o().length)})),ke((o,t=m(hi))=>{function e(S){h(o,{selectedCategory:S})}function i(S){let M=new qe(S);h(o,{categories:[M,...o.categories()]})}function a(S,M){let O=o.categories().findIndex(x=>x._id===S);if(O!==-1){let x=[...o.categories()];x[O]=k(k({},x[O]),M),h(o,{categories:x})}else console.error(`Category with ID ${S} not found`)}function s(S){let M=o.categories().filter(O=>O._id!==S);h(o,{categories:M})}let u=X(z(ve(()=>h(o,{isLoading:!0,error:null,categories:[]})),$(S=>t.getStoreMenus(S).pipe(J({next(M){e(M[0]),h(o,{isLoading:!1,error:M,categories:M})},error(M){h(o,{isLoading:!1,error:M,categories:[]})}}))))),P=X(z(ve(()=>h(o,{isLoading:!0,error:null})),$(S=>{let M=new qe(S);return t.createMenu(M).pipe(J({next(O){h(o,{isLoading:!1,error:null,categories:[O,...o.categories()]})},error(O){h(o,{isLoading:!1,error:O})}}))}))),Q=X(z($(S=>t.deleteMenu(S).pipe(J({next(M){h(o,{isLoading:!1,error:null})},error(M){h(o,{isLoading:!1,error:M})}}))))),ae=X(z($(({category:S,categoryId:M,reload:O=!0})=>(h(o,{isLoading:O,error:null}),t.updateMenu(M,S).pipe(J({next(x){h(o,{isLoading:!1,error:null}),a(M,x)},error(x){h(o,{isLoading:!1,error:x})}}))))));return{createCategory:i,updateCategory:a,deleteCategory:s,selectCategory:e,createCategory$:P,getCategories$:u,deleteCategory$:Q,updateCategory$:ae}}),Fe({onInit(o){let e=m(E).selectedStore();e?._id&&o.getCategories$(e._id)}}));var zi={products:[],error:null,isLoading:!1,searchQuery:"",changedPhotoOnEdit:!1,attachedFiles:[]},ut=Ie({providedIn:"root"},Ae(zi),Ge(o=>{let t=m(mt),e=y(()=>{let i=t.selectedCategory(),a=o.searchQuery().toLowerCase();return a.length>0?o.products().filter(s=>s.name?.toLowerCase().includes(a)||s.description?.toLowerCase().includes(a)||s.barcode?.toLowerCase().includes(a)):i?o.products().filter(s=>s?.menu?._id===i?._id):[]});return{productCount:y(()=>o.products().length),filteredProducts:e,filterProductCount:y(()=>e().length)}}),ke(o=>{function t(S){h(o,{searchQuery:S})}function e(S){return o.products().find(M=>M?.barcode===S)}function i(S){h(o,{changedPhotoOnEdit:S})}function a(S){h(o,{attachedFiles:S})}function s(){h(o,{searchQuery:""})}function u(S){let M=o.products().map(O=>O._id===S?N(k({},O),{quantity:O.quantity+1}):O);h(o,{products:M})}function P(S){let M=o.products().map(O=>O._id===S?N(k({},O),{quantity:Math.max(0,O.quantity-1)}):O);h(o,{products:M})}function Q(S){h(o,{products:[S,...o.products()]})}function ae(S){let M=o.products().filter(O=>O._id!==S);h(o,{products:M})}return{updateSearchQuery:t,clearSearchQuery:s,deleteProduct:ae,searchByBarcode:e,createProduct:Q,decrementQuantity:P,incrementQuantity:u,updateChangedPhotoOnEdit:i,updateAttachedFiles:a}}),ke((o,t=m(at))=>{let e=X(z(ve(()=>h(o,{isLoading:!0,error:null,products:[]})),$(s=>t.getStoreProducts(s).pipe(J({next(u){h(o,{isLoading:!1,error:null,products:u})},error(u){h(o,{isLoading:!1,error:u,products:[]})}})))));function i(s,u){let P=o.products().findIndex(Q=>Q._id===s);if(P!==-1){let Q=[...o.products()];Q[P]=k(k({},Q[P]),u),h(o,{products:Q})}else console.error(`Product with ID ${s} not found`)}let a=X(z($(s=>t.deleteProduct(s).pipe(J({next(u){h(o,{isLoading:!1,error:null})},error(u){h(o,{isLoading:!1,error:u})}})))));return{updateProduct:i,getStoreProducts:e,deleteProducts$:a}}),Fe({onInit(o){let e=m(E).selectedStore();e?._id&&o.getStoreProducts(e._id)}}));var Hi={variants:[],error:null,isLoading:!1,selectedVariant:null,selectedVariants:[]},pt=Ie({providedIn:"root"},Ae(Hi),Ge(({variants:o})=>({menuCount:y(()=>o().length)})),ke((o,t=m(at))=>{function e(x){h(o,{selectedVariant:x})}function i(x){h(o,{variants:[...o.variants(),x]}),e(x)}function a(x,R){let fe=o.variants().findIndex(he=>he._id===x);if(fe!==-1){let he=[...o.variants()];he[fe]=k(k({},he[fe]),R),h(o,{variants:he})}else console.error(`Category with ID ${x} not found`)}function s(x){let R=o.variants().filter(fe=>fe._id!==x);h(o,{variants:R})}function u(x){h(o,{selectedVariants:x})}function P(x){let R=o.variants().filter(fe=>fe.products.includes(x));console.log("Filtered variants for product:",R),h(o,{selectedVariants:R})}let Q=X(z(ve(()=>h(o,{isLoading:!0,error:null,variants:[]})),$(x=>t.getStoreGroupOption(x).pipe(J({next(R){h(o,{isLoading:!1,error:null,variants:R})},error(R){h(o,{isLoading:!1,error:R,variants:[]})}}))))),ae=X(z(ve(()=>h(o,{isLoading:!0,error:null})),$(x=>t.createVariant(x).pipe(J({next(R){h(o,{isLoading:!1,error:null,variants:[x,...o.variants()]})},error(R){h(o,{isLoading:!1,error:R})}}))))),S=X(z($(({variant:x,variantId:R,reload:fe=!0})=>(h(o,{isLoading:fe,error:null}),t.updateVariant(x,R).pipe(J({next(he){a(R,x),h(o,{isLoading:!1,error:null})},error(he){h(o,{isLoading:!1,error:he})}})))))),M=X(z($(x=>t.deleteVariant(x).pipe(J({next(R){h(o,{isLoading:!1,error:null})},error(R){h(o,{isLoading:!1,error:R})}}))))),O=X(z($(x=>t.removeProductIdFromVariant(x.variantId,x.productId).pipe(J({next(R){h(o,{isLoading:!1,error:null})},error(R){h(o,{isLoading:!1,error:R})}})))));return{setSelectedVariant:e,createVariant:i,updateVariant:a,deleteVariant:s,updateSelectedVariants:u,getProductVariants:P,loadVariants:Q,createVariant$:ae,updateVariant$:S,deleteVariant$:M,removeProductIds$:O}}),Fe({onInit(o){let e=m(E).selectedStore()?._id;e&&o.loadVariants(e)}}));function Xi(o,t){o&1&&(n(0,"span",22),l(1,"Out of stock"),r())}function Wi(o,t){if(o&1){let e=b();n(0,"div",23)(1,"button",25),p("click",function(a){f(e);let s=d(2).$index,u=d().$index;return d(2).decrease(u,s),g(a.stopPropagation())}),n(2,"mat-icon"),l(3,"remove"),r()(),n(4,"span",26),l(5),r(),n(6,"button",27),p("click",function(a){f(e);let s=d(2).$index,u=d().$index;return d(2).increase(u,s),g(a.stopPropagation())}),n(7,"mat-icon"),l(8,"add"),r()()()}if(o&2){let e=d(2).$implicit;c(),v("disabled",e.quantity<=1),c(4),D(e.quantity)}}function Ki(o,t){if(o&1&&(n(0,"div",23)(1,"span",24),l(2),B(3,"currency"),r(),_(4,Wi,9,2,"div",23),r()),o&2){let e=d().$implicit,i=d(3);c(2),T(" +",Tt(3,2,e.price,i.product.store==null?null:i.product.store.currency)," "),c(2),C(e.selected?4:-1)}}function Yi(o,t){if(o&1){let e=b();n(0,"mat-list-option",19),p("selectedChange",function(a){let s=f(e).$index,u=d().$index,P=d(2);return g(P.checkedChange(u,s,a))}),n(1,"div",20)(2,"div")(3,"span",21),l(4),B(5,"titlecase"),r(),_(6,Xi,2,0,"span",22),r(),_(7,Ki,5,5,"div",23),r()()}if(o&2){let e=t.$implicit;v("selected",e.selected)("disabled",!e.inStock),c(4),D(Dt(5,5,e.name)),c(2),C(e.inStock?-1:6),c(),C(e.inStock?7:-1)}}function Zi(o,t){if(o&1&&(n(0,"div",8)(1,"div",13)(2,"div")(3,"h3",14),l(4),B(5,"titlecase"),r(),n(6,"p",15),l(7),r()(),n(8,"span",16),l(9),r()(),n(10,"mat-selection-list",17),j(11,Yi,8,7,"mat-list-option",18,we),r()()),o&2){let e=t.$implicit;c(4),D(Dt(5,16,e.name)),c(3),T(" Choose ",e.atLeast===e.atMost?e.atLeast:"between "+e.atLeast+" and "+e.atMost," "),c(),Oe("bg-red-100",e.atLeast>0&&e.invalid)("text-red-700",e.atLeast>0&&e.invalid)("bg-green-100",!e.invalid)("text-green-700",!e.invalid)("bg-gray-100",e.atLeast===0&&e.invalid)("text-gray-600",e.atLeast===0&&e.invalid),c(),T(" ",e.atLeast>0?"Required":"Optional"," "),c(),v("multiple",!0),c(),U(e.options)}}function eo(o,t){if(o&1){let e=b();j(0,Zi,13,18,"div",8,we),n(2,"div",9)(3,"button",10),p("click",function(){f(e);let a=d();return g(a.updateQuantityTotal("down"))}),n(4,"mat-icon"),l(5,"remove"),r()(),n(6,"span",11),l(7),r(),n(8,"button",12),p("click",function(){f(e);let a=d();return g(a.updateQuantityTotal("up"))}),n(9,"mat-icon"),l(10,"add"),r()()()}if(o&2){let e=d();U(e.variantStore.selectedVariants()),c(3),v("disabled",e.quantity()<=1),c(4),D(e.quantity())}}function to(o,t){o&1&&(n(0,"div",4),V(1,"mat-spinner",28),n(2,"p",29),l(3,"Loading options..."),r()())}var ft=class o{dialogRef=m(W);dialogData=m(ie);isActivity=y(()=>this.storeStore.selectedStore()?.category==="Activities");product=this.dialogData.product;isEditing=w(this.dialogData?.isEditing??!1);productStore=m(ut);variantStore=m(pt);storeStore=m(E);quantity=w(this.product?.quantity||1);minDate=w(new Date);activityForm=new jt;variant=Et(()=>{console.log("Selected variants updated:",this.variantStore.selectedVariants()),this.variantStore.selectedVariants()});updateAreAllVariantsValid=y(()=>this.variantStore.selectedVariants().every(e=>!e.invalid));ngOnInit(){if(this.isEditing()&&this.product.options&&this.product.options.length>0){let t=JSON.parse(JSON.stringify(this.product.options));this.variantStore.updateSelectedVariants(t)}this.activityForm.valueChanges.subscribe(t=>{t&&(this.product=N(k({},this.product),{activityDateTime:t}))})}closeModal(){this.variant.destroy(),this.dialogRef.close()}submit(){if(this.isActivity()&&!this.product.activityDateTime){alert("Please select activity date and time");return}this.variant.destroy();let e=this.variantStore.selectedVariants().map(i=>N(k({},i),{options:i.options.filter(a=>a.selected)}));this.product.quantity=this.quantity(),this.dialogRef.close(N(k({},this.product),{options:e,activityDateTime:this.isActivity()?this.product.activityDateTime:void 0}))}updateQuantityTotal(t){t==="up"?this.quantity.update(e=>e+1):this.quantity.update(e=>Math.max(1,e-1))}increase(t,e){let i=this.variantStore.selectedVariants(),a=N(k({},i[t].options[e]),{quantity:i[t].options[e].quantity+1}),s=[...i[t].options.slice(0,e),a,...i[t].options.slice(e+1)],u=N(k({},i[t]),{options:s}),P=[...i.slice(0,t),u,...i.slice(t+1)];this.variantStore.updateSelectedVariants(P)}decrease(t,e){let i=this.variantStore.selectedVariants(),a=Math.max(1,i[t].options[e].quantity-1),s=N(k({},i[t].options[e]),{quantity:a}),u=[...i[t].options.slice(0,e),s,...i[t].options.slice(e+1)],P=N(k({},i[t]),{options:u}),Q=[...i.slice(0,t),P,...i.slice(t+1)];this.variantStore.updateSelectedVariants(Q)}checkedChange(t,e,i){let s=this.deepClone(this.variantStore.selectedVariants()).map((u,P)=>{if(P===t){let Q=u.options.map((S,M)=>M===e?N(k({},S),{selected:i}):S),ae=Q.filter(S=>S.selected===!0);return N(k({},u),{options:Q,invalid:!(ae.length>=u.atLeast&&ae.length<=u.atMost)})}return u});this.variantStore.updateSelectedVariants(s)}deepClone(t){return JSON.parse(JSON.stringify(t))}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-product-options"]],decls:16,vars:9,consts:[["mat-dialog-title",""],[1,"mb-4","pt-4"],[1,"text-sm","text-gray-500","mb-2"],[1,"text-lg","font-semibold","text-primary"],[1,"flex","flex-col","items-center","justify-center","py-8","gap-4"],["align","end",1,"border-t","border-outline-variant"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"mb-4"],[1,"flex","items-center","gap-2","mr-auto"],["mat-mini-fab","","color","primary",3,"click","disabled"],[1,"w-10","text-center","text-xl","font-semibold"],["mat-mini-fab","","color","primary",3,"click"],[1,"flex","items-start","justify-between","mb-2"],[1,"text-base","font-medium"],[1,"text-xs","text-gray-500"],[1,"px-2","py-0.5","text-xs","font-medium","rounded-full"],[1,"!py-0",3,"multiple"],[1,"!h-auto","!py-2",3,"selected","disabled"],[1,"!h-auto","!py-2",3,"selectedChange","selected","disabled"],[1,"flex","items-center","justify-between","w-full"],[1,"text-sm"],[1,"block","text-xs","text-red-500"],[1,"flex","items-center","gap-2"],[1,"text-sm","text-gray-600"],["matIconButton","","color","warn",3,"click","disabled"],[1,"w-8","text-center","text-lg","font-semibold"],["matIconButton","","color","primary",3,"click"],["diameter","40"],[1,"text-gray-500"]],template:function(e,i){e&1&&(n(0,"h2",0),l(1),r(),n(2,"mat-dialog-content")(3,"div",1)(4,"p",2),l(5),r(),n(6,"span",3),l(7),B(8,"currency"),r()(),_(9,eo,11,2)(10,to,4,0,"div",4),r(),n(11,"mat-dialog-actions",5)(12,"button",6),l(13,"Cancel"),r(),n(14,"button",7),p("click",function(){return i.submit()}),l(15),r()()),e&2&&(c(),D(i.product.name),c(4),D(i.product.description),c(2),T(" ",Tt(8,6,i.product.price,(i.product.store==null?null:i.product.store.currency)||"USD")," "),c(2),C(i.variantStore.isLoading()?10:9),c(5),v("disabled",!i.updateAreAllVariantsValid()),c(),T(" ",i.isEditing()?"Update":"Add to Order"," "))},dependencies:[G,Ne,K,$e,oe,re,ne,F,q,Re,be,A,L,bi,pe,ue,te,me,si,At,Be,ci,li,Gt,Se],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;max-height:100%}.text-primary[_ngcontent-%COMP%]{color:#1976d2}mat-selection-list[_ngcontent-%COMP%]   .mat-mdc-list-item[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.06)}mat-selection-list[_ngcontent-%COMP%]   .mat-mdc-list-item[_ngcontent-%COMP%]:last-child{border-bottom:none}"]})};function oo(o,t){if(o&1&&V(0,"img",2),o&2){let e=d();v("src",e.product().photos[0],He)("alt",e.product().name)}}function no(o,t){o&1&&(n(0,"div",3)(1,"mat-icon",13),l(2,"image"),r()())}function ro(o,t){o&1&&(n(0,"div",4),l(1," Out of stock "),r())}function ao(o,t){if(o&1&&(n(0,"div",5),l(1),r()),o&2){let e=d();c(),T(" Low: ",e.product().qty," ")}}function lo(o,t){if(o&1&&(n(0,"span",10),l(1),B(2,"currency"),r()),o&2){let e=d();c(),T(" ",Y(2,1,e.product().costPrice,e.currency(),"symbol","1.0-0")," ")}}function co(o,t){if(o&1){let e=b();n(0,"div",14)(1,"button",16),p("click",function(){f(e);let a=d(2);return g(a.removeOrDeleteProduct(a.product()))}),n(2,"mat-icon",17),l(3,"remove"),r()(),n(4,"span",18),l(5),r(),n(6,"button",19),p("click",function(a){f(e);let s=d(2);return g(s.onAddToCart(a))}),n(7,"mat-icon",17),l(8,"add"),r()()()}if(o&2){let e=d(2);c(5),T(" ",e.productQuantity()," ")}}function so(o,t){if(o&1){let e=b();n(0,"button",20),p("click",function(a){f(e);let s=d(2);return g(s.onAddToCart(a))}),n(1,"mat-icon"),l(2,"add_shopping_cart"),r(),l(3," Add "),r()}if(o&2){let e=d(2);v("disabled",e.isOutOfStock())}}function mo(o,t){if(o&1&&_(0,co,9,1,"div",14)(1,so,4,1,"button",15),o&2){let e=d();C(e.isProductInCart()?0:1)}}function uo(o,t){if(o&1){let e=b();n(0,"button",21),p("click",function(a){f(e);let s=d();return g(s.onOpenOptions(a))}),n(1,"mat-icon"),l(2,"tune"),r(),l(3," Options "),r()}if(o&2){let e=d();v("disabled",e.isOutOfStock())}}var _t=class o{storeStore=m(E);cartStore=m(De);variantStore=m(pt);dialog=m(Me);breakpointObserver=m(Ve);product=Z.required();cartQuantity=Z(0);addToCart=H();increment=H();decrement=H();openOptions=H();currency=y(()=>this.storeStore.selectedStore()?.currency||"\u20A6");hasOptions=y(()=>{let t=this.product();return t.options&&t.options.length>0});isProductInCart=y(()=>{let t=this.cartStore.selectedCart();return t?t.products.find(e=>e._id===this.product()._id):!1});productQuantity=y(()=>{let t=this.cartStore.selectedCart();if(t){let e=t.products.find(i=>i._id===this.product()._id);return e?e.quantity:0}return 0});isOutOfStock=y(()=>!this.product().active);isLowStock=y(()=>{let t=this.product();return t.active&&t.qty!==void 0&&t.qty<=5});onAddToCart(t){t.stopPropagation(),this.addToCart.emit(this.product())}removeOrDeleteProduct(t){this.productQuantity()>1?this.cartStore.decrementProductQuantity(t._id):(this.cartStore.updateCartAction("delete"),this.cartStore.removeFromCart(this.cartStore.selectedCart()._id,t._id))}onOpenOptions(t){t.stopPropagation(),this.openProductOptionsDialog()}openProductOptionsDialog(){this.variantStore.getProductVariants(this.product()._id);let t=this.cartStore.selectedCart(),e=null,i=!1;t&&(e=t.products.find(P=>P._id===this.product()._id)||null,i=!!e);let a={product:e||this.product(),isEditing:i},s=this.dialog.open(ft,{width:"100%",maxWidth:"500px",panelClass:"product-options-dialog-panel",data:a});this.breakpointObserver.isMatched([ge.XSmall,ge.Small])&&s.updateSize("100vw","100vh"),s.afterClosed().subscribe(P=>{P&&(this.cartStore.updateCartAction(i?"edit":"add"),this.cartStore.selectedCart()||this.cartStore.createCart(),this.cartStore.addToCart(this.cartStore.selectedCart()._id,P,i))})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-product-card"]],inputs:{product:[1,"product"],cartQuantity:[1,"cartQuantity"]},outputs:{addToCart:"addToCart",increment:"increment",decrement:"decrement",openOptions:"openOptions"},decls:17,vars:11,consts:[["appearance","outlined",1,"overflow-hidden","hover:shadow-lg","transition-shadow","duration-200","cursor-pointer","h-full","flex","flex-col"],[1,"relative","aspect-square","bg-gray-100","overflow-hidden"],[1,"w-full","h-full","object-cover","hover:scale-105","transition-transform","duration-300",3,"src","alt"],[1,"w-full","h-full","flex","items-center","justify-center","bg-gray-50"],[1,"absolute","top-2","right-2","px-2","py-0.5","text-xs","font-medium","rounded-full","bg-red-100","text-red-700"],[1,"absolute","top-2","right-2","px-2","py-0.5","text-xs","font-medium","rounded-full","bg-amber-100","text-amber-700"],[1,"p-4","flex-1","flex","flex-col"],[1,"font-medium","text-gray-900","text-sm","line-clamp-2","mt-2","min-h-[2.5rem]","leading-5"],[1,"flex","items-center","gap-2"],[1,"primary-text","font-bold","text-lg"],[1,"text-gray-400","primary-text","text-sm","line-through"],[1,"p-2","border-t","border-outline-variant"],["matButton","outlined","color","accent",1,"w-full",3,"disabled"],[1,"!text-5xl","!w-12","!h-12","text-gray-300"],[1,"flex","items-center","gap-1","w-full","justify-between"],["matButton","outlined","color","primary",1,"w-full",3,"disabled"],["mat-mini-fab","","color","warn",1,"!w-8","!h-8","!min-w-0",3,"click"],[1,"!text-lg"],[1,"w-8","text-center","font-semibold","text-gray-900"],["mat-mini-fab","","color","primary",1,"!w-8","!h-8","!min-w-0",3,"click"],["matButton","outlined","color","primary",1,"w-full",3,"click","disabled"],["matButton","outlined","color","accent",1,"w-full",3,"click","disabled"]],template:function(e,i){e&1&&(n(0,"mat-card",0)(1,"div",1),_(2,oo,1,2,"img",2)(3,no,3,0,"div",3),_(4,ro,2,0,"div",4)(5,ao,2,1,"div",5),r(),n(6,"mat-card-content",6)(7,"h3",7),l(8),r(),n(9,"div",8)(10,"span",9),l(11),B(12,"currency"),r(),_(13,lo,3,6,"span",10),r()(),n(14,"mat-card-actions",11),_(15,mo,2,1)(16,uo,4,1,"button",12),r()()),e&2&&(c(2),C(i.product().photos&&i.product().photos.length>0?2:3),c(2),C(i.isOutOfStock()?4:i.isLowStock()?5:-1),c(4),T(" ",i.product().name," "),c(3),T(" ",Y(12,6,i.product().price,i.currency(),"symbol","1.0-0")," "),c(2),C(i.product().costPrice&&i.product().costPrice>i.product().price?13:-1),c(2),C(i.hasOptions()?16:15))},dependencies:[G,We,Xe,$t,Qt,F,q,Re,A,L,Se],styles:["[_nghost-%COMP%]{display:block}.primary-text[_ngcontent-%COMP%]{color:var(--mat-sys-primary-color)}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}"]})};function po(o,t){if(o&1&&(le(0,"div",2)(1,"span",3),l(2),ce(),le(3,"span",4),l(4),B(5,"currency"),ce()()),o&2){let e,i=d();c(2),T("Tax (",(e=i.storeStore.selectedStore())==null?null:e.tax,"%)"),c(2),D(Y(5,2,i.cartTotals().tax,i.currency(),"symbol","1.0-0"))}}var Ct=class o{storeStore=m(E);cartStore=m(De);cartService=m(lt);cartSummary=H();cart=Z();isActivity=y(()=>this.storeStore.selectedStore()?.category==="683fd24cca109bb62f6b3bd4");cartTotals=y(()=>{let t=this.cartStore.selectedCart()||this.cart(),e=this.cartService.generateCartSummary(t,this.storeStore.selectedStore());return this.cartSummary.emit(e),e});subtotal=Z(0);taxRate=Z(0);disabled=Z(!0);checkoutLabel=Z("Checkout");checkout=H();currency=y(()=>this.storeStore.selectedStore()?.currency||"\u20A6");onCheckout(){this.checkout.emit()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-checkout-summary"]],inputs:{cart:[1,"cart"],subtotal:[1,"subtotal"],taxRate:[1,"taxRate"],disabled:[1,"disabled"],checkoutLabel:[1,"checkoutLabel"]},outputs:{cartSummary:"cartSummary",checkout:"checkout"},decls:27,vars:25,consts:[[1,"p-4","border-t","border-outline-variant"],[1,"space-y-2","mb-4"],[1,"flex","justify-between","text-sm"],[1,"text-on-surface-variant"],[1,"font-medium"],[1,"flex","justify-between","text-lg","font-bold","pt-3","border-t","border-outline-variant"],[1,"primary-text"]],template:function(e,i){if(e&1&&(le(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),l(4,"Delivery Fee"),ce(),le(5,"span",4),l(6),B(7,"currency"),ce()(),le(8,"div",2)(9,"span",3),l(10,"Discount"),ce(),le(11,"span",4),l(12),B(13,"currency"),ce()(),le(14,"div",2)(15,"span",3),l(16,"Subtotal"),ce(),le(17,"span",4),l(18),B(19,"currency"),ce()(),_(20,po,6,7,"div",2),le(21,"div",5)(22,"span"),l(23,"Total"),ce(),le(24,"span",6),l(25),B(26,"currency"),ce()()()()),e&2){let a;c(6),D(Y(7,5,i.cartTotals().deliveryFee,i.currency(),"symbol","1.0-0")),c(6),D(Y(13,10,i.cartTotals().discount,i.currency(),"symbol","1.0-0")),c(6),D(Y(19,15,i.cartTotals().subtotal,i.currency(),"symbol","1.0-0")),c(2),C(((a=i.storeStore.selectedStore())==null?null:a.tax)>0?20:-1),c(5),D(Y(26,20,i.cartTotals().totalCost,i.currency(),"symbol","1.0-0"))}},dependencies:[G,F,A,Se],styles:["[_nghost-%COMP%]{display:block}.primary-text[_ngcontent-%COMP%]{color:var(--mat-sys-primary)}.text-on-surface-variant[_ngcontent-%COMP%]{color:var(--mat-sys-on-surface-variant)}.border-outline-variant[_ngcontent-%COMP%]{border-color:var(--mat-sys-outline-variant)}"]})};var $i=(o,t)=>t._id;function fo(o,t){o&1&&(n(0,"mat-icon",13),l(1,"search"),r(),l(2," Search Guest "))}function go(o,t){o&1&&(n(0,"mat-icon",13),l(1,"hotel"),r(),l(2," Select by Room "))}function _o(o,t){o&1&&(n(0,"mat-option",7)(1,"div",14),V(2,"mat-spinner",15),n(3,"span"),l(4,"Loading rooms..."),r()()())}function Co(o,t){o&1&&(n(0,"mat-option",7),l(1,"No occupied rooms found"),r())}function ho(o,t){if(o&1&&(n(0,"span",19),l(1),r()),o&2){let e=d().$implicit,i=d(2);c(),T(" - ",i.getRoomGuestName(e)," ")}}function vo(o,t){if(o&1&&(n(0,"mat-option",16)(1,"div",14)(2,"mat-icon",17),l(3,"door_front"),r(),n(4,"span",18),l(5),r(),_(6,ho,2,1,"span",19),r()()),o&2){let e=t.$implicit;v("value",e),c(5),T("Room ",e.roomNumber),c(),C(e.currentGuest?6:-1)}}function So(o,t){if(o&1&&j(0,vo,7,3,"mat-option",16,$i),o&2){let e=d();U(e.occupiedRooms())}}function bo(o,t){o&1&&(n(0,"div",21)(1,"mat-icon",23),l(2,"person_off"),r(),n(3,"p",24),l(4,"No guest information available for this room"),r()())}function xo(o,t){if(o&1&&(n(0,"mat-radio-button",26)(1,"div",27)(2,"mat-icon",28),l(3,"person"),r(),n(4,"div")(5,"div",18),l(6),r(),n(7,"div",19),l(8),r()()()()),o&2){let e=t.$implicit,i=d(3);v("value",e),c(6),D(i.guestService.getGuestName(e)),c(2),T(" ",e.email||e.phone||"No contact info"," ")}}function yo(o,t){if(o&1){let e=b();n(0,"mat-radio-group",25),p("change",function(a){f(e);let s=d(2);return g(s.onRoomGuestSelected(a.value))}),j(1,xo,9,3,"mat-radio-button",26,$i),r()}if(o&2){let e=d(2);v("value",e.selectedGuest()),c(),U(e.availableRoomGuests())}}function Mo(o,t){if(o&1&&(n(0,"div",8)(1,"h4",20),l(2),r(),_(3,bo,5,0,"div",21)(4,yo,3,1,"mat-radio-group",22),r()),o&2){let e,i=d();c(2),T(" Guests in Room ",(e=i.selectedRoom())==null?null:e.roomNumber," "),c(),C(i.availableRoomGuests().length===0?3:4)}}function Do(o,t){if(o&1){let e=b();n(0,"div",9)(1,"div",29)(2,"div",30)(3,"mat-icon",31),l(4,"check_circle"),r(),n(5,"div")(6,"div",32),l(7),r(),n(8,"div",33),l(9),r()()(),n(10,"button",34),p("click",function(){f(e);let a=d();return g(a.removeGuest())}),n(11,"mat-icon"),l(12,"close"),r()()()()}if(o&2){let e,i=d();c(7),D(i.guestService.getGuestName(i.selectedGuest())),c(2),T(" ",((e=i.selectedGuest())==null?null:e.email)||((e=i.selectedGuest())==null?null:e.phone)||"No contact info"," ")}}function To(o,t){if(o&1){let e=b();n(0,"button",35),p("click",function(){f(e);let a=d();return g(a.confirmSelection())}),l(1," Confirm "),r()}}var ht=class o{dialogRef=m(W);dialogData=m(ie);guestService=m(ct);roomsService=m(Ri);storeStore=m(E);selectedGuest=w(this.dialogData?.selectedGuest||null);selectionMode=w("search");occupiedRooms=w([]);loadingRooms=w(!1);selectedRoom=w(null);roomGuests=w([]);availableRoomGuests=y(()=>{let t=this.selectedRoom();if(!t)return[];let e=[];if(t.currentReservation&&typeof t.currentReservation=="object"){let i=t.currentReservation;if(i.rooms&&Array.isArray(i.rooms)){let a=i.rooms.find(s=>(typeof s.room=="object"?s.room._id:s.room)===t._id);a?.assignedGuest&&typeof a.assignedGuest=="object"&&e.push(a.assignedGuest)}}return e.length===0&&t.currentGuest&&typeof t.currentGuest=="object"&&e.push(t.currentGuest),e});ngOnInit(){this.loadOccupiedRooms()}loadOccupiedRooms(){let t=this.storeStore.selectedStore()?._id;t&&(this.loadingRooms.set(!0),this.roomsService.getRooms(t,{status:["occupied"]}).subscribe({next:e=>{this.occupiedRooms.set(e),this.loadingRooms.set(!1)},error:()=>{this.loadingRooms.set(!1)}}))}onRoomSelected(t){this.selectedRoom.set(t),this.selectionMode()==="room"&&this.selectedGuest.set(null)}onRoomGuestSelected(t){this.selectedGuest.set(t)}onGuestSelected(t){this.selectedGuest.set(t)}removeGuest(){this.selectedGuest.set(null),this.dialogRef.close({guest:null,action:"remove"})}confirmSelection(){this.dialogRef.close({guest:this.selectedGuest(),action:"select"})}onTabChange(t){this.selectionMode.set(t===0?"search":"room"),this.selectedGuest.set(null),this.selectedRoom.set(null)}getRoomGuestName(t){return t.currentGuest?typeof t.currentGuest=="string"?t.currentGuest:this.guestService.getGuestName(t.currentGuest):""}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-guest-selection-dialog"]],decls:24,vars:4,consts:[["mat-dialog-title",""],[3,"selectedTabChange"],["mat-tab-label",""],[1,"pt-4"],["label","Search Guest","placeholder","Search by name, email or phone...",3,"guestSelected"],["appearance","outline",1,"w-full"],[3,"selectionChange"],["disabled",""],[1,"mt-4"],[1,"mt-4","p-3","bg-green-50","border","border-green-200","rounded-lg"],["align","end"],["mat-button","","mat-dialog-close",""],["matButton","filled","color","primary"],[1,"mr-2"],[1,"flex","items-center","gap-2"],["diameter","20"],[3,"value"],[1,"text-primary"],[1,"font-medium"],[1,"text-gray-500","text-sm"],[1,"text-sm","font-medium","text-gray-600","mb-2"],[1,"text-gray-500","text-sm","p-4","bg-gray-50","rounded-lg","text-center"],[1,"flex","flex-col","gap-2",3,"value"],[1,"text-gray-400"],[1,"mt-2"],[1,"flex","flex-col","gap-2",3,"change","value"],[1,"guest-radio-option",3,"value"],[1,"flex","items-center","gap-3","py-2"],[1,"text-gray-500"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"text-green-600"],[1,"font-medium","text-green-800"],[1,"text-green-600","text-sm"],["mat-icon-button","","color","warn","matTooltip","Remove selection",3,"click"],["matButton","filled","color","primary",3,"click"]],template:function(e,i){e&1&&(n(0,"h2",0),l(1,"Select Hotel Guest"),r(),n(2,"mat-dialog-content")(3,"mat-tab-group",1),p("selectedTabChange",function(s){return i.onTabChange(s.index)}),n(4,"mat-tab"),Mt(5,fo,3,0,"ng-template",2),n(6,"div",3)(7,"app-guest-search",4),p("guestSelected",function(s){return i.onGuestSelected(s)}),r()()(),n(8,"mat-tab"),Mt(9,go,3,0,"ng-template",2),n(10,"div",3)(11,"mat-form-field",5)(12,"mat-label"),l(13,"Select Occupied Room"),r(),n(14,"mat-select",6),p("selectionChange",function(s){return i.onRoomSelected(s.value)}),_(15,_o,5,0,"mat-option",7)(16,Co,2,0,"mat-option",7)(17,So,2,0),r()(),_(18,Mo,5,2,"div",8),r()()(),_(19,Do,13,2,"div",9),r(),n(20,"mat-dialog-actions",10)(21,"button",11),l(22,"Cancel"),r(),_(23,To,2,0,"button",12),r()),e&2&&(c(15),C(i.loadingRooms()?15:i.occupiedRooms().length===0?16:17),c(3),C(i.selectedRoom()?18:-1),c(),C(i.selectedGuest()?19:-1),c(4),C(i.selectedGuest()?23:-1))},dependencies:[G,K,$e,oe,re,ne,F,q,be,A,L,Be,rt,ei,Kt,Yt,Zt,Jt,de,se,Ht,Ft,te,pe,ue,Oi,ki,Ei,Qe,Le,ee,Vi],styles:["mat-dialog-content[_ngcontent-%COMP%]{min-width:450px;max-width:550px;max-height:70vh}.guest-radio-option[_ngcontent-%COMP%]{display:block;padding:.5rem;border-radius:.5rem;border:1px solid #e5e7eb;transition:all .2s ease}.guest-radio-option[_ngcontent-%COMP%]:hover{background-color:#f9fafb;border-color:#d1d5db}.guest-radio-option.mat-mdc-radio-checked[_ngcontent-%COMP%]{background-color:#eff6ff;border-color:#3b82f6}  .mat-mdc-radio-button .mdc-radio{margin-right:.5rem}"]})};var Po=(o,t)=>t._id;function wo(o,t){o&1&&V(0,"mat-spinner",6)}function ko(o,t){o&1&&(n(0,"div",8),V(1,"mat-spinner",16),r())}function Eo(o,t){if(o&1){let e=b();n(0,"div",9)(1,"mat-icon",17),l(2,"person_off"),r(),n(3,"p",18),l(4),r(),n(5,"button",19),p("click",function(){f(e);let a=d();return g(a.openCreateCustomerDialog())}),n(6,"mat-icon"),l(7,"add"),r(),l(8," Create New Customer "),r()()}if(o&2){let e=d();c(4),T('No customers found matching "',e.searchQuery(),'"')}}function Oo(o,t){o&1&&(n(0,"mat-icon",25),l(1,"check_circle"),r())}function Vo(o,t){if(o&1){let e=b();n(0,"mat-list-item",21),p("click",function(){let a=f(e).$implicit,s=d(2);return g(s.onCustomerSelected(a))}),n(1,"mat-icon",22),l(2,"person"),r(),n(3,"div",23),l(4),r(),n(5,"div",24),l(6),r(),_(7,Oo,2,0,"mat-icon",25),r()}if(o&2){let e,i,a,s=t.$implicit,u=d(2);Oe("bg-blue-50",((e=u.selectedCustomer())==null?null:e._id)===s._id)("border-blue-300",((i=u.selectedCustomer())==null?null:i._id)===s._id),c(4),D(s.name||"No Name"),c(2),T(" ",s.email||s.phoneNumber||"No contact info"," "),c(),C(((a=u.selectedCustomer())==null?null:a._id)===s._id?7:-1)}}function Ro(o,t){if(o&1&&(n(0,"mat-list",10),j(1,Vo,8,7,"mat-list-item",20,Po),r()),o&2){let e=d();c(),U(e.filteredCustomers())}}function Io(o,t){o&1&&(n(0,"div",11),l(1," Type at least 2 characters to search "),r())}function Go(o,t){if(o&1){let e=b();n(0,"div",12)(1,"div",26)(2,"div",27)(3,"mat-icon",28),l(4,"check_circle"),r(),n(5,"div")(6,"div",29),l(7),r(),n(8,"div",30),l(9),r()()(),n(10,"button",31),p("click",function(){f(e);let a=d();return g(a.removeCustomer())}),n(11,"mat-icon"),l(12,"close"),r()()()()}if(o&2){let e=d();c(7),D(e.getCustomerDisplayName(e.selectedCustomer())),c(2),T(" ",e.getCustomerContact(e.selectedCustomer())," ")}}function Fo(o,t){if(o&1){let e=b();n(0,"button",32),p("click",function(){f(e);let a=d();return g(a.confirmSelection())}),l(1," Confirm "),r()}}var St=class o{dialogRef=m(W);dialogData=m(ie);customerService=m(yi);storeStore=m(E);dialog=m(Me);selectedCustomer=w(this.dialogData?.selectedCustomer||null);searchQuery=w("");customers=w([]);filteredCustomers=w([]);loading=w(!1);searchPerformed=w(!1);searchSubject=new wt;constructor(){this.searchSubject.pipe(kt(300),$(t=>{if(!t||t.length<2)return this.filteredCustomers.set([]),this.searchPerformed.set(!1),ze([]);this.loading.set(!0),this.searchPerformed.set(!0);let e=this.customers();if(e.length>0){let i=e.filter(a=>a.name?.toLowerCase().includes(t.toLowerCase())||a.email?.toLowerCase().includes(t.toLowerCase())||a.phoneNumber?.includes(t));return this.filteredCustomers.set(i),this.loading.set(!1),ze(i)}return ze([])}),Xt()).subscribe()}ngOnInit(){this.loadCustomers()}loadCustomers(){let t=this.storeStore.selectedStore()?._id;t&&(this.loading.set(!0),this.customerService.getStoreCustomers(t).subscribe({next:e=>{this.customers.set(e),this.loading.set(!1)},error:()=>{this.loading.set(!1)}}))}onSearch(t){this.searchQuery.set(t),this.searchSubject.next(t)}onCustomerSelected(t){this.selectedCustomer.set(t)}removeCustomer(){this.selectedCustomer.set(null),this.dialogRef.close({customer:null,action:"remove"})}confirmSelection(){this.dialogRef.close({customer:this.selectedCustomer(),action:"select"})}openCreateCustomerDialog(){this.dialog.open(Mi,{width:"500px",data:{isEdit:!1}}).afterClosed().subscribe(e=>{e&&this.loadCustomers()})}getCustomerDisplayName(t){return t?t.name||t.email||"Unknown Customer":""}getCustomerContact(t){return t?t.email||t.phoneNumber||"No contact info":""}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-customer-selection-dialog"]],decls:25,vars:5,consts:[["mat-dialog-title","",1,"flex","items-center","justify-between"],["mat-stroked-button","","color","primary",3,"click"],[1,"min-w-[450px]"],["appearance","outline",1,"w-full"],["matPrefix","",1,"mr-2"],["matInput","","placeholder","Search by name, email or phone...","autocomplete","off",3,"input","value"],["matSuffix","","diameter","20"],[1,"customer-results","mt-2"],[1,"flex","items-center","justify-center","p-8"],[1,"text-center","p-6","bg-gray-50","rounded-lg"],[1,"customer-list"],[1,"text-center","p-4","text-gray-500","text-sm"],[1,"mt-4","p-3","bg-green-50","border","border-green-200","rounded-lg"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary"],["diameter","40"],[1,"text-gray-400","text-4xl"],[1,"text-gray-500","mt-2"],["mat-stroked-button","","color","primary",1,"mt-3",3,"click"],[1,"customer-item","cursor-pointer","hover:bg-gray-50","rounded-lg","mb-1",3,"bg-blue-50","border-blue-300"],[1,"customer-item","cursor-pointer","hover:bg-gray-50","rounded-lg","mb-1",3,"click"],["matListItemIcon","",1,"text-gray-500"],["matListItemTitle","",1,"font-medium"],["matListItemLine","",1,"text-gray-500","text-sm"],["matListItemMeta","",1,"text-blue-500"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"text-green-600"],[1,"font-medium","text-green-800"],[1,"text-green-600","text-sm"],["mat-icon-button","","color","warn","matTooltip","Remove selection",3,"click"],["mat-flat-button","","color","primary",3,"click"]],template:function(e,i){e&1&&(n(0,"h2",0)(1,"span"),l(2,"Select Customer"),r(),n(3,"button",1),p("click",function(){return i.openCreateCustomerDialog()}),n(4,"mat-icon"),l(5,"add"),r(),l(6," New Customer "),r()(),n(7,"mat-dialog-content",2)(8,"mat-form-field",3)(9,"mat-label"),l(10,"Search Customer"),r(),n(11,"mat-icon",4),l(12,"search"),r(),n(13,"input",5),p("input",function(s){return i.onSearch(s.target.value)}),r(),_(14,wo,1,0,"mat-spinner",6),r(),n(15,"div",7),_(16,ko,2,0,"div",8)(17,Eo,9,1,"div",9)(18,Ro,3,0,"mat-list",10)(19,Io,2,0,"div",11),r(),_(20,Go,13,2,"div",12),r(),n(21,"mat-dialog-actions",13)(22,"button",14),l(23,"Cancel"),r(),_(24,Fo,2,0,"button",15),r()),e&2&&(c(13),v("value",i.searchQuery()),c(),C(i.loading()?14:-1),c(2),C(i.loading()&&i.customers().length===0?16:i.searchPerformed()&&i.filteredCustomers().length===0&&i.searchQuery().length>=2?17:i.filteredCustomers().length>0?18:i.searchQuery().length<2&&i.customers().length>0?19:-1),c(4),C(i.selectedCustomer()?20:-1),c(4),C(i.selectedCustomer()?24:-1))},dependencies:[G,K,$e,oe,re,ne,F,q,be,A,L,Be,ri,ai,ni,ii,ti,oi,rt,te,de,se,xe,zt,me,ye,pe,ue,Qe,Le,ee],styles:["mat-dialog-content[_ngcontent-%COMP%]{min-width:450px;max-width:550px;max-height:70vh}.customer-list[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}.customer-item[_ngcontent-%COMP%]{border:1px solid transparent;transition:all .2s ease}.customer-item[_ngcontent-%COMP%]:hover{background-color:#f9fafb;border-color:#e5e7eb}.customer-item.bg-blue-50[_ngcontent-%COMP%]{border-color:#93c5fd}"]})};var Bo=o=>({prefix:o});function Lo(o,t){if(o&1&&V(0,"input",8),o&2){let e,i=d();v("options",Je(2,Bo,((e=i.storeStore.selectedStore())==null?null:e.currency)+" "))("placeholder",i.valueLabel)}}function Qo(o,t){if(o&1&&V(0,"input",9),o&2){let e=d();v("placeholder",e.valueLabel)}}function $o(o,t){o&1&&(n(0,"mat-error"),l(1,"Value is required"),r())}function qo(o,t){o&1&&(n(0,"mat-error"),l(1,"Value must be a positive number"),r())}function jo(o,t){if(o&1){let e=b();n(0,"button",15),p("click",function(){f(e);let a=d();return g(a.onRemoveDiscount())}),l(1," Remove Discount "),r()}}var bt=class o{dialogRef=m(W);data=m(ie);fb=m(ot);storeStore=m(E);discountForm=this.fb.group({discountType:[this.data?.discount?.discountType||"Amount",Ee.required],value:[this.data?.discount?.value||"",[Ee.required,Ee.min(0)]],reference:[this.data?.discount?.reference||""]});get f(){return this.discountForm.controls}get valueLabel(){return this.f.discountType.value==="Amount"?"Enter Amount":"Enter Percentage"}get valueIcon(){return this.f.discountType.value==="Amount"?"attach_money":"percent"}onCancel(){this.dialogRef.close()}onApply(){this.discountForm.valid&&this.dialogRef.close(this.discountForm.getRawValue())}onRemoveDiscount(){this.dialogRef.close({discountType:"",value:0,reference:""})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-add-discount"]],decls:35,vars:8,consts:[["mat-dialog-title",""],[3,"formGroup"],[1,"toggle-section"],["formControlName","discountType","aria-label","Discount Type"],["value","Amount"],["value","Percentage"],["appearance","outline",1,"full-width"],["matPrefix",""],["matInput","","currencyMask","","formControlName","value",3,"options","placeholder"],["matInput","","type","number","formControlName","value",3,"placeholder"],["matInput","","type","text","formControlName","reference","placeholder","Enter reference or reason"],["align","end"],["mat-button","","color","warn"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],["mat-button","","color","warn",3,"click"]],template:function(e,i){e&1&&(n(0,"h2",0),l(1,"Apply Discount"),r(),n(2,"mat-dialog-content")(3,"form",1)(4,"div",2)(5,"mat-button-toggle-group",3)(6,"mat-button-toggle",4)(7,"mat-icon"),l(8,"attach_money"),r(),l(9," Amount "),r(),n(10,"mat-button-toggle",5)(11,"mat-icon"),l(12,"percent"),r(),l(13," Percentage "),r()()(),n(14,"mat-form-field",6)(15,"mat-label"),l(16),r(),n(17,"mat-icon",7),l(18),r(),_(19,Lo,1,4,"input",8)(20,Qo,1,1,"input",9),_(21,$o,2,0,"mat-error"),_(22,qo,2,0,"mat-error"),r(),n(23,"mat-form-field",6)(24,"mat-label"),l(25,"Reference (Optional)"),r(),n(26,"mat-icon",7),l(27,"note"),r(),V(28,"input",10),r()()(),n(29,"mat-dialog-actions",11),_(30,jo,2,0,"button",12),n(31,"button",13),p("click",function(){return i.onCancel()}),l(32,"Cancel"),r(),n(33,"button",14),p("click",function(){return i.onApply()}),l(34," Apply "),r()()),e&2&&(c(3),v("formGroup",i.discountForm),c(13),D(i.valueLabel),c(2),D(i.valueIcon),c(),C(i.f.discountType.value==="Amount"?19:20),c(2),C(i.f.value.hasError("required")&&i.f.value.touched?21:-1),c(),C(i.f.value.hasError("min")?22:-1),c(8),C(i.data.discount!=null&&i.data.discount.value?30:-1),c(3),v("disabled",i.discountForm.invalid))},dependencies:[G,ee,et,Ke,Ut,Ye,Ze,Ne,it,tt,K,oe,re,ne,F,q,ui,di,mi,te,de,se,nt,xe,me,ye,A,L,dt,st],styles:[".toggle-section[_ngcontent-%COMP%]{margin-bottom:24px}.toggle-section[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}.toggle-section[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{flex:1}.toggle-section[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}"],changeDetection:0})};var Uo=o=>({prefix:o});function zo(o,t){o&1&&(n(0,"mat-error"),l(1,"Delivery fee is required"),r())}function Ho(o,t){o&1&&(n(0,"mat-error"),l(1,"Delivery fee must be a positive number"),r())}function Jo(o,t){if(o&1){let e=b();n(0,"button",9),p("click",function(){f(e);let a=d();return g(a.onRemoveDelivery())}),l(1," Remove Delivery "),r()}}var xt=class o{dialogRef=m(W);data=m(ie);fb=m(ot);storeStore=m(E);deliveryForm=this.fb.group({deliveryFee:[this.data?.deliveryFee||"",[Ee.required,Ee.min(0)]]});get f(){return this.deliveryForm.controls}onCancel(){this.dialogRef.close()}onApply(){this.deliveryForm.valid&&this.dialogRef.close(this.deliveryForm.getRawValue())}onRemoveDelivery(){this.dialogRef.close({deliveryFee:0,address:""})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-add-delivery"]],decls:18,vars:8,consts:[["mat-dialog-title",""],[3,"formGroup"],["appearance","outline",1,"full-width"],["matPrefix",""],["matInput","","currencyMask","","formControlName","deliveryFee","placeholder","Enter delivery fee",3,"options"],["align","end"],["mat-button","","color","warn"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],["mat-button","","color","warn",3,"click"]],template:function(e,i){if(e&1&&(n(0,"h2",0),l(1,"Add Delivery Fee"),r(),n(2,"mat-dialog-content")(3,"form",1)(4,"mat-form-field",2)(5,"mat-label"),l(6,"Delivery Fee"),r(),n(7,"mat-icon",3),l(8,"local_shipping"),r(),V(9,"input",4),_(10,zo,2,0,"mat-error"),_(11,Ho,2,0,"mat-error"),r()()(),n(12,"mat-dialog-actions",5),_(13,Jo,2,0,"button",6),n(14,"button",7),p("click",function(){return i.onCancel()}),l(15,"Cancel"),r(),n(16,"button",8),p("click",function(){return i.onApply()}),l(17," Apply "),r()()),e&2){let a;c(3),v("formGroup",i.deliveryForm),c(6),v("options",Je(6,Uo,((a=i.storeStore.selectedStore())==null?null:a.currency)+" ")),c(),C(i.f.deliveryFee.hasError("required")&&i.f.deliveryFee.touched?10:-1),c(),C(i.f.deliveryFee.hasError("min")?11:-1),c(2),C(i.data.deliveryFee?13:-1),c(3),v("disabled",i.deliveryForm.invalid)}},dependencies:[G,ee,et,Ke,Ye,Ze,Ne,it,tt,K,oe,re,ne,F,q,te,de,se,nt,xe,me,ye,A,L,dt,st],styles:[".full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}"],changeDetection:0})};function Xo(o,t){o&1&&(n(0,"div",4),V(1,"mat-spinner"),r())}function Wo(o,t){o&1&&V(0,"app-no-record",5)}function Ko(o,t){if(o&1){let e=b();n(0,"div")(1,"app-table-card",12),p("tableClick",function(a){f(e);let s=d(2);return g(s.onTableSelect(a))}),r()()}if(o&2){let e=t.$implicit;Oe("opacity-50",e.orderId)("pointer-events-none",e.orderId),c(),v("table",e)("hideActions",!0)}}function Yo(o,t){o&1&&V(0,"app-no-record",11)}function Zo(o,t){if(o&1&&(n(0,"div",9),j(1,Ko,2,6,"div",10,we),r(),_(3,Yo,1,0,"app-no-record",11)),o&2){let e=d();c(),U(e.filteredTables),c(2),C(e.filteredTables.length===0?3:-1)}}function en(o,t){if(o&1){let e=b();n(0,"button",13),p("click",function(){f(e);let a=d();return g(a.onRemoveSelection())}),l(1," Remove Selection "),r()}}var yt=class o{dialogRef=m(W);data=m(ie);tableService=m(xi);storeStore=m(E);searchQuery=w("");selectedTable=w(this.data?.selectedTable||null);tablesResource=Wt({params:()=>({storeId:this.storeStore.selectedStore()._id}),stream:({params:t})=>this.tableService.getStoreTables(t.storeId)});onSearchChange(t){this.searchQuery.set(t)}get filteredTables(){let t=this.tablesResource.value()||[],e=this.searchQuery().toLowerCase();return(e?t.filter(a=>a.name.toLowerCase().includes(e)):t).sort((a,s)=>{let u=!!a.orderId,P=!!s.orderId;return u===P?0:u?1:-1})}onTableSelect(t){if(t.orderId)return;let e={action:"select",table:t};this.dialogRef.close(e)}onRemoveSelection(){let t={action:"remove"};this.dialogRef.close(t)}onCancel(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-table-selection-dialog"]],decls:16,vars:5,consts:[["mat-dialog-title",""],["appearance","outline",1,"w-full","mb-4"],["matInput","","placeholder","Search by table name...",3,"input","value"],["matPrefix",""],[1,"flex","items-center","justify-center","py-12"],["icon","error_outline","title","Failed to Load Tables","message","Unable to load tables. Please try again."],["align","end"],["mat-button","","color","warn"],["mat-button","",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","max-h-[60vh]","overflow-y-auto"],[3,"opacity-50","pointer-events-none"],["icon","table_restaurant","title","No Tables Found","message","No tables match your search criteria."],[3,"tableClick","table","hideActions"],["mat-button","","color","warn",3,"click"]],template:function(e,i){e&1&&(n(0,"h2",0),l(1,"Select Table"),r(),n(2,"mat-dialog-content")(3,"mat-form-field",1)(4,"mat-label"),l(5,"Search tables"),r(),n(6,"input",2),p("input",function(s){return i.onSearchChange(s.target.value)}),r(),n(7,"mat-icon",3),l(8,"search"),r()(),_(9,Xo,2,0,"div",4),_(10,Wo,1,0,"app-no-record",5),_(11,Zo,4,1),r(),n(12,"mat-dialog-actions",6),_(13,en,2,0,"button",7),n(14,"button",8),p("click",function(){return i.onCancel()}),l(15,"Cancel"),r()()),e&2&&(c(6),v("value",i.searchQuery()),c(3),C(i.tablesResource.isLoading()?9:-1),c(),C(i.tablesResource.error()?10:-1),c(),C(i.tablesResource.value()&&!i.tablesResource.isLoading()?11:-1),c(2),C(i.selectedTable()?13:-1))},dependencies:[G,K,oe,re,ne,F,q,A,L,te,de,se,xe,me,ye,pe,ue,ee,Ii,pi],styles:["[_nghost-%COMP%]{display:block}"]})};function tn(o,t){if(o&1){let e=b();n(0,"button",19),p("click",function(){f(e);let a=d();return g(a.onSelectCustomer())}),n(1,"mat-icon"),l(2,"person"),r(),n(3,"span",20),l(4),r()()}if(o&2){let e,i,a=d();v("matTooltip",((e=a.selectedCustomer())==null?null:e.name)||((e=a.selectedCustomer())==null?null:e.email)),c(4),D(((i=a.selectedCustomer())==null?null:i.name)||"Customer")}}function on(o,t){if(o&1){let e=b();n(0,"button",15),p("click",function(){f(e);let a=d();return g(a.onSelectCustomer())}),n(1,"mat-icon"),l(2,"person"),r(),n(3,"span",21),l(4,"Customer"),r()()}}function nn(o,t){if(o&1){let e=b();n(0,"button",19),p("click",function(){f(e);let a=d();return g(a.onSelectGuest())}),n(1,"mat-icon"),l(2,"hotel"),r(),n(3,"span",20),l(4),r()()}if(o&2){let e=d();v("matTooltip",e.guestService.getGuestName(e.selectedGuest())),c(4),D(e.guestService.getGuestName(e.selectedGuest()))}}function rn(o,t){if(o&1){let e=b();n(0,"button",15),p("click",function(){f(e);let a=d();return g(a.onSelectGuest())}),n(1,"mat-icon"),l(2,"hotel"),r(),n(3,"span",21),l(4,"Guest"),r()()}}function an(o,t){if(o&1){let e=b();n(0,"button",22),p("click",function(){f(e);let a=d();return g(a.onSelectTable())}),n(1,"mat-icon"),l(2,"table_restaurant"),r(),n(3,"span",20),l(4),r()()}if(o&2){let e,i,a=d();v("matTooltip",(e=a.tableStore.selectedTable())==null?null:e.name),c(4),D((i=a.tableStore.selectedTable())==null?null:i.name)}}function ln(o,t){if(o&1){let e=b();n(0,"button",23),p("click",function(){f(e);let a=d();return g(a.onSelectTable())}),n(1,"mat-icon"),l(2,"table_restaurant"),r(),n(3,"span",21),l(4,"Table"),r()()}}function cn(o,t){if(o&1){let e=b();n(0,"div",8)(1,"button",24),p("click",function(){f(e);let a=d();return g(a.cancelSales())}),n(2,"mat-icon"),l(3,"delete_outline"),r(),n(4,"span"),l(5,"Clear Cart"),r()()()}}function sn(o,t){if(o&1&&V(0,"img",27),o&2){let e=d().$implicit;v("src",e.photos[0],He)("alt",e.name)}}function dn(o,t){o&1&&(n(0,"div",28)(1,"mat-icon",40),l(2,"image"),r()())}function mn(o,t){if(o&1&&(n(0,"p",32),l(1),r()),o&2){let e=d().$implicit,i=d();c(),T(" ",i.getOptionsDisplay(e).join(", ")," ")}}function un(o,t){if(o&1){let e=b();n(0,"mat-card",10)(1,"div",25)(2,"div",26),_(3,sn,1,2,"img",27)(4,dn,3,0,"div",28),r(),n(5,"div",29)(6,"h4",30),l(7),r(),n(8,"p",31),l(9),B(10,"currency"),r(),_(11,mn,2,1,"p",32),n(12,"div",33)(13,"div",2)(14,"button",34),p("click",function(){let a=f(e).$implicit,s=d();return g(s.removeOrDeleteProduct(a))}),n(15,"mat-icon"),l(16,"remove"),r()(),n(17,"span",35),l(18),r(),n(19,"button",36),p("click",function(a){let s=f(e).$implicit,u=d();return g(u.onAddToCart(a,s))}),n(20,"mat-icon"),l(21,"add"),r()()(),n(22,"span",37),l(23),B(24,"currency"),r()()(),n(25,"button",38),p("click",function(){let a=f(e).$implicit,s=d();return g(s.onRemoveItem(a._id))}),n(26,"mat-icon",39),l(27,"close"),r()()()()}if(o&2){let e=t.$implicit,i=d();c(3),C(e.photos&&e.photos.length>0?3:4),c(4),D(e.name),c(2),T(" ",Y(10,6,e.price,i.currency(),"symbol","1.0-0")," "),c(2),C(i.getOptionsDisplay(e).length>0?11:-1),c(7),D(e.quantity),c(5),T(" ",Y(24,11,i.getProductTotal(e),i.currency(),"symbol","1.0-0")," ")}}function pn(o,t){o&1&&(n(0,"div",11)(1,"mat-icon",41),l(2,"shopping_cart"),r(),n(3,"p",42),l(4,"Cart is empty"),r(),n(5,"p",43),l(6,"Add products to start an order"),r()())}function fn(o,t){if(o&1){let e=b();n(0,"div",12)(1,"app-checkout-summary",44),p("cartSummary",function(a){f(e);let s=d();return g(s.cartSummaryChange(a))}),r()()}}var Ue=class o{storeStore=m(E);accountService=m(Lt);cartStore=m(De);cartService=m(lt);tableStore=m(Fi);guestService=m(ct);saleTypeStore=m(Ai);dialog=m(Me);breakpointObserver=m(Ve);dialogRef=m(W,{optional:!0});snackBar=m(Bt);orderStore=m(Ni);selectedUser=this.accountService.currentUserValue;cartSummary=w(null);selectedGuest=w(null);selectedCustomer=w(null);selectedBuyerName=y(()=>{let t=this.selectedGuest(),e=this.selectedCustomer();return t?this.guestService.getGuestName(t):e?e.name||e.email||"Customer":"Select Buyer"});hasSelectedBuyer=y(()=>!!this.selectedGuest()||!!this.selectedCustomer());buyerType=y(()=>this.selectedGuest()?"guest":this.selectedCustomer()?"customer":null);items=Z([]);taxRate=Z(0);increment=H();decrement=H();removeItem=H();clearCart=H();addToCart=H();currency=y(()=>this.storeStore.selectedStore()?.currency||"\u20A6");itemsCount=y(()=>this.cartStore.selectedCart()?.products.reduce((t,e)=>t+e.quantity,0));cartItemTap(t){(t?.options).length>0?this.openOptions(t):this.cartStore.updateCartAction("add")}openOptions(t){}isEmpty=y(()=>(console.log("Cart products length:",this.cartStore.selectedCart()),!this.cartStore.selectedCart()||this.cartStore.selectedCart()?.products.length===0));onAddToCart(t,e){t.stopPropagation(),this.dialogRef&&this.cartStore.incrementProductQuantity(e._id),this.addToCart.emit(e)}getProductTotal(t){let e=t.price*t.quantity;if(t.options&&t.options.length>0){let i=this.cartService.getTotalForSelectedOptions(t.options);return e+i*t.quantity}return e}removeOrDeleteProduct(t){t.quantity>1?this.cartStore.decrementProductQuantity(t._id):this.deleteProductFromCart(t._id)}deleteProductFromCart(t){this.cartStore.updateCartAction("delete"),this.cartStore.removeFromCart(this.cartStore.selectedCart()._id,t)}getOptionsDisplay(t){if(!t.options||t.options.length===0)return[];let e=[];return t.options.forEach(i=>{i.options&&i.options.forEach(a=>{a.selected&&e.push(`${a.name}${a.quantity>1?" x"+a.quantity:""}`)})}),e}onIncrement(t){this.increment.emit(t)}onDecrement(t){this.decrement.emit(t)}onRemoveItem(t){this.deleteProductFromCart(t),this.removeItem.emit(t)}resetSalesSection(){this.cartStore.removeSelectedCart(),this.saleTypeStore.setDefaultSaleType(),this.tableStore.clearSelectedTable(),this.selectedCustomer.set(null),this.selectedGuest.set(null),this.clearCart.emit()}cancelSales(){this.dialog.open(wi,{width:"400px",data:{title:"Cancel Sale",message:"Are you sure you want to cancel this sale? This action cannot be undone."}}).afterClosed().subscribe(e=>{e&&(this.snackBar.open("Sale cancelled","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"}),this.resetSalesSection())})}ngOnDestroy(){!this.breakpointObserver.isMatched([ge.XSmall,ge.Small])&&!this.dialogRef&&this.resetSalesSection()}onSelectCustomer(){this.openCustomerSelectionDialog()}onSelectTable(){let t={selectedTable:this.tableStore.selectedTable()};this.dialog.open(yt,{data:t}).afterClosed().subscribe(i=>{i&&(i.action==="select"&&i.table?(this.tableStore.selectTable(i.table._id),this.snackBar.open(`Table "${i.table.name}" selected`,"Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"})):i.action==="remove"&&(this.tableStore.clearSelectedTable(),this.snackBar.open("Table selection removed","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"})))})}onSelectOrderType(){console.log("Select order type")}onSelectGuest(){this.openGuestSelectionDialog()}openCustomerSelectionDialog(){let t={selectedCustomer:this.selectedCustomer()};this.dialog.open(St,{width:"500px",maxHeight:"80vh",data:t}).afterClosed().subscribe(i=>{if(i){if(i.action==="select"&&i.customer){this.selectedGuest.set(null),this.selectedCustomer.set(i.customer);let a=this.cartStore.selectedCart();a&&this.cartStore.updateCartUser(a._id,i.customer._id),this.snackBar.open(`Customer "${i.customer.name||i.customer.email}" selected`,"Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"})}else if(i.action==="remove"){this.selectedCustomer.set(null);let a=this.cartStore.selectedCart();a&&this.cartStore.updateCartUser(a._id,""),this.snackBar.open("Customer removed","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"})}}})}openGuestSelectionDialog(){let t={selectedGuest:this.selectedGuest()};this.dialog.open(ht,{width:"500px",maxHeight:"80vh",data:t}).afterClosed().subscribe(i=>{i&&(i.action==="select"&&i.guest?(this.selectedCustomer.set(null),this.selectedGuest.set(i.guest),this.snackBar.open(`Guest "${this.guestService.getGuestName(i.guest)}" selected`,"Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"})):i.action==="remove"&&(this.selectedGuest.set(null),this.snackBar.open("Guest removed","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"})))})}onSelectBuyer(){this.selectedGuest()?this.openGuestSelectionDialog():this.selectedCustomer()&&this.openCustomerSelectionDialog()}clearBuyerSelection(){this.selectedGuest.set(null),this.selectedCustomer.set(null)}onApplyDiscount(){this.dialog.open(bt,{width:"450px",data:{discount:this.cartStore.selectedCart()?.discount}}).afterClosed().subscribe(e=>{if(e){let i=this.cartStore.selectedCart();i&&(this.cartStore.updateCartDiscount(i._id,e),e.value>0?this.snackBar.open(`Discount applied: ${e.discountType} - ${e.value}`,"Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"}):this.snackBar.open("Discount removed","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"}))}})}onApplyDelivery(){this.dialog.open(xt,{width:"450px",data:{deliveryFee:this.cartStore.selectedCart()?.delivery,address:""}}).afterClosed().subscribe(e=>{if(e){let i=this.cartStore.selectedCart();i&&(this.cartStore.updateCartDelivery(i._id,e.deliveryFee),e.deliveryFee>0?this.snackBar.open(`Delivery fee applied: ${e.deliveryFee}`,"Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"}):this.snackBar.open("Delivery fee removed","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"}))}})}onGenerateBill(){console.log("Generate bill")}onPendOrder(){this.cartStore.selectedCart()&&(this.cartStore.addSelectedCartToPending(),this.cartStore.removeSelectedCart(),this.snackBar.open("Order pending","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"}))}cartSummaryChange(t){this.cartSummary.set(t)}onCheckout(){let t={totalAmount:this.cartSummary()?.totalCost||0,currency:this.currency()};this.dialog.open(Gi,{width:"450px",data:t}).afterClosed().subscribe(i=>{i&&(i.action==="confirm"&&i.paymentMethod&&this.cartStore.selectedCart()&&this.cartStore.updateSelectedCartPaymentMethod(i.paymentMethod),this.processCheckout())})}processCheckout(){this.saleTypeStore.setSelectedSaleType(this.tableStore.selectedTable()?"table":"quick",this.saleTypeStore.isEditing());let t=this.cartStore.selectedCart(),e=this.tableStore.selectedTable(),i=this.saleTypeStore.selectedSale(),a=this.storeStore.selectedStore();if(!t){this.snackBar.open("No cart selected","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"});return}if(!a){this.snackBar.open("No store selected","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"});return}if(console.log("Selected sale type:",i.id),!i){this.snackBar.open("Please select a sale type","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"});return}this.cartStore.updateCartSummary(this.cartSummary());let s=this.saleTypeStore.isEditing();if(console.log(s,"is editing sale type - before processing"),s){let P=this.orderStore.selectedOrder();if(!P){this.snackBar.open("No order selected for editing","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom"});return}let ae={cart:N(k({},t),{cartSummary:this.cartSummary()??void 0}),storeId:a._id,user:this.selectedCustomer()??void 0,table:e??void 0,salesType:i,type:i.id,payment:t?.paymentMethod?.name,total:this.cartSummary().totalCost,subTotal:this.cartSummary().subtotal,discount:this.cartSummary().discount,tax:this.cartSummary().tax,shippingFee:this.cartSummary().deliveryFee,paymentStatus:t?.paymentMethod?.name?"Paid":"Unpaid",note:t?.note,vendorCommissionAmount:0,orderInstruction:t?.note,staff:this.selectedUser?._id,category:t.paymentMethod?.name?"Complete":"Processing",settled:!!t.paymentMethod?.name};console.log("Updating order with payload:",ae),this.orderStore.updateOrder$({orderId:P._id,updates:ae}),this.saleTypeStore.stopEditing(),this.snackBar.open("Order updated successfully","Close",{duration:2e3})}else this.orderStore.syncOrder$({_id:Di(),cart:t,store:a,user:this.selectedCustomer()??void 0,table:e??void 0,guest:this.selectedGuest()??void 0,salesType:i,type:i.id,payment:t.paymentMethod?.name,salesChannel:"Point of Sale",total:this.cartSummary().totalCost,subTotal:this.cartSummary().subtotal,discount:this.cartSummary().discount,tax:this.cartSummary().tax,shippingFee:this.cartSummary().deliveryFee,paymentStatus:t.paymentMethod?.name?"Paid":"Unpaid",note:t.note,orderInstruction:t.note,createdAt:new Date,synced:!0,category:t.paymentMethod?.name?"Complete":"Processing",settled:!!t.paymentMethod?.name,reference:Ti(),staff:this.selectedUser?._id,storeId:a._id}),this.snackBar.open("Order Created","Print",{duration:2e3});let u=this.orderStore.selectedOrder();u&&e&&i.id==="table"&&(this.tableStore.updateTableOrder(e._id,u),this.tableStore.updateTableOrderSync(e._id,{orderId:u._id})),u&&this.orderStore.selectOrder(u),this.resetSalesSection(),this.dialogRef&&this.dialogRef.close()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-cart"]],inputs:{items:[1,"items"],taxRate:[1,"taxRate"]},outputs:{increment:"increment",decrement:"decrement",removeItem:"removeItem",clearCart:"clearCart",addToCart:"addToCart"},decls:32,vars:13,consts:[[1,"h-full","flex","flex-col"],[1,"p-4","border-b","border-outline-variant"],[1,"flex","items-center","gap-2"],["mat-stroked-button","",1,"!flex-1",3,"matTooltip"],["mat-stroked-button","",1,"!flex-1"],["matButton","outlined",1,"!flex-1",3,"matTooltip"],["matButton","outlined"],[1,"flex-1","overflow-auto","p-4"],[1,"mb-3","flex","justify-end"],[1,"space-y-3","h-full"],["appearance","outlined",1,"p-3"],[1,"flex","flex-col","items-center","justify-center","h-full","min-h-[300px]","text-gray-400"],[1,"mt-4"],[1,"border-t","border-outline-variant","bg-white"],[1,"flex","items-center","gap-2","p-3","border-b","border-gray-100"],["mat-stroked-button","",1,"!flex-1",3,"click"],[1,"ml-1"],[1,"p-3"],["mat-flat-button","","color","primary",1,"w-full","!h-12","!text-base",3,"click"],["mat-stroked-button","",1,"!flex-1",3,"click","matTooltip"],[1,"text-xs","truncate","max-w-[60px]"],[1,"text-xs"],["matButton","outlined",1,"!flex-1",3,"click","matTooltip"],["matButton","outlined",3,"click"],["mat-button","","color","warn",3,"click"],[1,"flex","gap-3"],[1,"w-16","h-16","rounded-lg","overflow-hidden","bg-gray-100","flex-shrink-0"],[1,"w-full","h-full","object-cover",3,"src","alt"],[1,"w-full","h-full","flex","items-center","justify-center"],[1,"flex-1","min-w-0"],[1,"font-medium","text-sm","truncate"],[1,"primary-text","font-semibold","text-sm","mt-0.5"],[1,"text-xs","text-gray-500","mt-1","truncate"],[1,"flex","items-center","justify-between","mt-2"],["mat-mini-fab","","color","warn",3,"click"],[1,"w-8","text-center","font-semibold","text-lg"],["mat-mini-fab","","color","primary",3,"click"],[1,"font-semibold"],["mat-icon-button","","color","warn",1,"!w-8","!h-8","self-start",3,"click"],[1,"!text-lg"],[1,"text-gray-300"],[1,"!text-6xl","!w-16","!h-16","mb-4"],[1,"text-lg","font-medium"],[1,"text-sm"],[3,"cartSummary"]],template:function(e,i){if(e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),_(3,tn,5,2,"button",3)(4,on,5,0,"button",4),_(5,nn,5,2,"button",3)(6,rn,5,0,"button",4),_(7,an,5,2,"button",5)(8,ln,5,0,"button",6),r()(),n(9,"div",7),_(10,cn,6,0,"div",8),n(11,"div",9),j(12,un,28,16,"mat-card",10,we,!1,pn,7,0,"div",11),r(),_(15,fn,2,0,"div",12),r(),n(16,"div",13)(17,"div",14)(18,"button",15),p("click",function(){return i.onApplyDiscount()}),n(19,"mat-icon"),l(20,"local_offer"),r(),n(21,"span",16),l(22,"Discount"),r()(),n(23,"button",15),p("click",function(){return i.onApplyDelivery()}),n(24,"mat-icon"),l(25,"local_shipping"),r(),n(26,"span",16),l(27,"Delivery"),r()()(),n(28,"div",17)(29,"button",18),p("click",function(){return i.onCheckout()}),l(30),B(31,"currency"),r()()()()),e&2){let a,s;c(3),C(i.selectedCustomer()?3:4),c(2),C(i.selectedGuest()?5:6),c(2),C(i.tableStore.selectedTable()?7:8),c(3),C(i.isEmpty()?-1:10),c(2),U((a=i.cartStore.selectedCart())==null?null:a.products),c(3),C(i.isEmpty()?-1:15),c(15),It(" Checkout ",i.itemsCount()," items (",Y(31,8,((s=i.cartSummary())==null?null:s.totalCost)||0,i.currency(),"symbol","1.0-0"),") ")}},dependencies:[G,We,Xe,F,q,Re,be,A,L,qt,Qe,Le,Ct,Se],styles:["[_nghost-%COMP%]{display:block;height:100%}.primary-text[_ngcontent-%COMP%]{color:var(--mat-sys-primary)}.bg-primary[_ngcontent-%COMP%]{background-color:var(--mat-sys-primary)}.text-on-primary[_ngcontent-%COMP%]{color:var(--mat-sys-on-primary)}.text-on-surface-variant[_ngcontent-%COMP%]{color:var(--mat-sys-on-surface-variant)}.border-outline-variant[_ngcontent-%COMP%]{border-color:var(--mat-sys-outline-variant)}"]})};var gn=["searchComponent"],ji=(o,t)=>t._id;function _n(o,t){o&1&&V(0,"mat-spinner",12)}function Cn(o,t){if(o&1&&(n(0,"mat-icon",23),l(1),r()),o&2){let e=d().$implicit;c(),D(e.icon)}}function hn(o,t){if(o&1){let e=b();n(0,"mat-chip-option",22),p("click",function(){let a=f(e).$implicit,s=d(2);return g(s.selectCategory(a))}),_(1,Cn,2,1,"mat-icon",23),l(2),r()}if(o&2){let e,i=t.$implicit,a=d(2);v("selected",((e=a.categoryStore.selectedCategory())==null?null:e._id)===i._id)("disabled",i.activate===!1),c(),C(i.icon?1:-1),c(),T(" ",i.name," ")}}function vn(o,t){if(o&1&&(n(0,"mat-chip-listbox",13),j(1,hn,3,4,"mat-chip-option",21,ji),r()),o&2){let e=d();c(),U(e.categoryStore.categories())}}function Sn(o,t){o&1&&(n(0,"div",15),V(1,"mat-spinner",24),r())}function bn(o,t){o&1&&(n(0,"div",16)(1,"mat-icon",25),l(2,"inventory_2"),r(),n(3,"p",26),l(4,"No products found"),r(),n(5,"p",27),l(6,"Select a category or search for products"),r()())}function xn(o,t){if(o&1){let e=b();n(0,"app-product-card",29),p("addToCart",function(a){f(e);let s=d(2);return g(s.addToCart({product:a,isEditing:!1}))})("increment",function(a){f(e);let s=d(2);return g(s.incrementQuantity(a))})("decrement",function(a){f(e);let s=d(2);return g(s.decrementQuantity(a))})("openOptions",function(a){f(e);let s=d(2);return g(s.openOptionsDialog(a))}),r()}if(o&2){let e=t.$implicit,i=d(2);v("product",e)("cartQuantity",i.getCartQuantity(e._id))}}function yn(o,t){if(o&1&&(n(0,"div",17),j(1,xn,1,2,"app-product-card",28,ji),r()),o&2){let e=d();c(),U(e.productStore.filteredProducts())}}var qi=class o{categoryStore=m(mt);storeStore=m(E);productStore=m(ut);cartStore=m(De);dialog=m(Me);breakpointObserver=m(Ve);searchFilter="";searchComponent;searchProduct(t){if(this.storeStore.selectedStore()?.posSettings?.useBarcodeScanner){let e=this.productStore.searchByBarcode(t),i=this.cartStore.selectedCart(),a=null,s=!1;i&&e&&(a=i.products.find(u=>u._id===e._id),s=!!a,console.log("Barcode scan found product:",e.name,"Editing:",s)),e&&this.addToCart({product:e,isEditing:s})}else this.productStore.updateSearchQuery(t)}selectCategory(t){this.categoryStore.selectCategory(t)}clearSearch(){this.productStore.clearSearchQuery()}toggleBarcodeScanner(t){let e=this.storeStore.selectedStore();e&&this.storeStore.updateStore$({posSettings:N(k({},e.posSettings),{useBarcodeScanner:t})})}currencySymbol=y(()=>this.storeStore.selectedStore()?.currency||"\u20A6");cartItems=w([]);taxRate=w(0);getCartQuantity(t){return this.cartItems().find(i=>i.product._id===t)?.quantity||0}addToCart(t){console.log("Adding to cart:",t.product.name,"Editing:",t.isEditing),this.createCart(),this.cartStore.addToCart(this.cartStore.selectedCart()._id,t.product,t.isEditing),this.searchComponent.clearFilter()}createCart(){this.cartStore.selectedCart()||this.cartStore.createCart()}incrementQuantity(t){t.qty!==void 0&&this.getCartQuantity(t._id)>=t.qty||this.cartItems.update(e=>e.map(i=>i.product._id===t._id?N(k({},i),{quantity:i.quantity+1}):i))}decrementQuantity(t){this.getCartQuantity(t._id)<=1?this.removeFromCart(t._id):this.cartItems.update(i=>i.map(a=>a.product._id===t._id?N(k({},a),{quantity:a.quantity-1}):a))}removeFromCart(t){this.cartItems.update(e=>e.filter(i=>i.product._id!==t))}clearCart(){this.cartItems.set([])}checkout(){console.log("Checkout:",this.cartItems())}openCartModal(){let t=this.dialog.open(Ue,{width:"100%",maxWidth:"500px",maxHeight:"90vh"});this.breakpointObserver.isMatched([ge.XSmall,ge.Small])&&t.updateSize("100vw","100vh")}openOptionsDialog(t){console.log("Open options dialog for:",t.name)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["checkout"]],viewQuery:function(e,i){if(e&1&&Ot(gn,5),e&2){let a;Vt(a=Rt())&&(i.searchComponent=a.first)}},decls:24,vars:9,consts:[["searchComponent",""],[1,"flex","h-[calc(100vh-64px)]","md:h-[calc(100vh-64px)]"],[1,"w-full","md:w-[70%]","h-full","md:border-r","border-gray-200","flex","flex-col"],[1,"p-4","border-b","border-outline-variant"],[1,"flex","items-center","gap-3"],[1,"flex-1"],["searchText","Search by barcode or product",3,"filterChange","rightTap","filter","showRightIcon"],[1,"hidden","md:flex","items-center","gap-2","shrink-0"],[1,"text-sm","text-gray-600","whitespace-nowrap"],["color","primary",3,"change","checked"],[1,"px-4","py-3","border-b","border-outline-variant"],[1,"flex","items-center","gap-3","overflow-x-auto","scrollbar-hide"],["diameter","20"],["aria-label","Select a category",1,"flex-nowrap"],[1,"flex-1","p-4","overflow-auto","pb-20","md:pb-4"],[1,"flex","justify-center","items-center","h-full"],[1,"flex","flex-col","items-center","justify-center","h-full","text-gray-400"],[1,"grid","grid-cols-2","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","2xl:grid-cols-5","gap-3","md:gap-4"],[1,"hidden","md:block","md:w-[30%]","h-full"],[3,"increment","decrement","removeItem","clearCart","addToCart","checkout","items","taxRate"],["mat-fab","","color","primary","matBadgeColor","warn","matBadgeSize","large",1,"!fixed","!bottom-[88px]","!right-4","!z-[60]","md:!hidden",3,"click","matBadge","matBadgeHidden"],[3,"selected","disabled"],[3,"click","selected","disabled"],["matChipAvatar",""],["diameter","40"],[1,"!text-6xl","!w-16","!h-16","mb-4"],[1,"text-lg","font-medium"],[1,"text-sm"],[3,"product","cartQuantity"],[3,"addToCart","increment","decrement","openOptions","product","cartQuantity"]],template:function(e,i){if(e&1){let a=b();n(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"app-search",6,0),p("filterChange",function(u){return f(a),g(i.searchProduct(u))})("rightTap",function(){return f(a),g(i.clearSearch())}),r()(),n(7,"div",7)(8,"span",8),l(9,"Barcode Scanner"),r(),n(10,"mat-slide-toggle",9),p("change",function(u){return f(a),g(i.toggleBarcodeScanner(u.checked))}),r()()()(),n(11,"div",10)(12,"div",11),_(13,_n,1,0,"mat-spinner",12)(14,vn,3,0,"mat-chip-listbox",13),r()(),n(15,"div",14),_(16,Sn,2,0,"div",15)(17,bn,7,0,"div",16)(18,yn,3,0,"div",17),r()(),n(19,"div",18)(20,"app-cart",19),p("increment",function(u){return f(a),g(i.incrementQuantity(u))})("decrement",function(u){return f(a),g(i.decrementQuantity(u))})("removeItem",function(u){return f(a),g(i.removeFromCart(u))})("clearCart",function(){return f(a),g(i.clearCart())})("addToCart",function(u){return f(a),g(i.addToCart({product:u,isEditing:!1}))})("checkout",function(){return f(a),g(i.checkout())}),r()()(),n(21,"button",20),p("click",function(){return f(a),g(i.openCartModal())}),n(22,"mat-icon"),l(23,"shopping_cart"),r()()}if(e&2){let a,s,u;c(5),v("filter",i.searchFilter)("showRightIcon",!0),c(5),v("checked",((a=i.storeStore.selectedStore())==null||a.posSettings==null?null:a.posSettings.useBarcodeScanner)??!1),c(3),C(i.categoryStore.isLoading()?13:14),c(3),C(i.productStore.isLoading()?16:i.productStore.filteredProducts().length===0?17:18),c(4),v("items",i.cartItems())("taxRate",i.taxRate()),c(),v("matBadge",((s=i.cartStore.selectedCart())==null||s.products==null?null:s.products.length)||0)("matBadgeHidden",!(!((u=i.cartStore.selectedCart())==null||u.products==null)&&u.products.length))}},dependencies:[G,ee,Pi,_t,Ue,Ci,fi,_i,gi,A,L,pe,ue,Si,vi,F,Nt,Li,Bi,K],styles:["[_nghost-%COMP%]{display:block;height:100%}.scrollbar-hide[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.scrollbar-hide[_ngcontent-%COMP%]{-ms-overflow-style:none;scrollbar-width:none}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}mat-chip-listbox[_ngcontent-%COMP%]     .mdc-evolution-chip-set__chips{flex-wrap:nowrap}"]})};export{qi as Checkout};
