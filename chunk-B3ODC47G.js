import{b as mt}from"./chunk-S35VCKTJ.js";import{f as vt}from"./chunk-CU623SSI.js";import{a as gt}from"./chunk-GU4Z36JA.js";import{a as _t,b as St}from"./chunk-GZXF4TWP.js";import{a as dt,b as st,e as pt,f as ct,g as ut,h as ft}from"./chunk-XNNKKASY.js";import{i as R}from"./chunk-QC7H4KPM.js";import{d as lt}from"./chunk-BXJEGH2V.js";import{b as nt,c as ot,d as rt}from"./chunk-UMV4DCPT.js";import{a as tt,b as et,h as it}from"./chunk-G3VZM262.js";import{b as at}from"./chunk-6I3AJKA7.js";import{B as Z,b as z,d as m,g as U,h as H,m as J,n as K,s as Q,t as W,v as X,z as Y}from"./chunk-W7NMJLMQ.js";import{a as L}from"./chunk-4UBDYPTG.js";import{b as j,c as $}from"./chunk-JPRPNQOM.js";import{Z as A,_ as G,ba as P}from"./chunk-3LDCGXHW.js";import{q as B,s as q}from"./chunk-6PFJHDFS.js";import{Ib as s,Jb as p,Lc as N,Mb as k,Nb as I,Nc as T,Ob as u,Pb as i,Qb as e,Rb as c,Yb as w,ac as f,bb as l,cc as S,fa as g,ka as O,kb as _,la as y,qb as V,rc as n,sc as h,tc as E,wa as D}from"./chunk-J2AK4FW5.js";import{a as C,b}from"./chunk-GAL4ENT6.js";var bt=(r,o)=>o._id;function ht(r,o){r&1&&(i(0,"mat-error"),n(1," Name is required "),e())}function Et(r,o){r&1&&(i(0,"mat-error"),n(1," At Least value is required "),e())}function Mt(r,o){r&1&&(i(0,"mat-error"),n(1," Value must be 0 or greater "),e())}function xt(r,o){r&1&&(i(0,"mat-error"),n(1," At Most value is required "),e())}function Ft(r,o){r&1&&(i(0,"mat-error"),n(1," Value must be 0 or greater "),e())}function Ot(r,o){if(r&1){let a=w();i(0,"div",25)(1,"div")(2,"span",26),n(3),e(),i(4,"span",27),n(5),N(6,"currency"),e()(),i(7,"a",28),f("click",function(){let d=O(a).$implicit,v=S(2);return y(v.removeOption(d))}),i(8,"mat-icon"),n(9,"close"),e()()()}if(r&2){let a,t=o.$implicit,d=S(2);l(3),h(t.name),l(2),h(T(6,2,t.price,(a=d.storeStore.selectedStore())==null?null:a.currency))}}function yt(r,o){if(r&1&&(i(0,"div",18)(1,"h4",24),n(2,"Added Options:"),e(),k(3,Ot,10,5,"div",25,bt),e()),r&2){let a=S();l(3),I(a.selectedOptions)}}var Ct=class r{constructor(o,a,t){this.fb=o;this.dialogRef=a;this.data=t;this.variantForm=this.fb.group({name:["",m.required],atLeast:[0,[m.required,m.min(0)]],atMost:[0,[m.required,m.min(0)]],enabled:[!0],store:[this.storeStore.selectedStore()?._id,m.required]}),this.newOptionForm=this.fb.group({name:["",m.required],price:[0,[m.required,m.min(0)]],inStock:[!0],store:[this.storeStore.selectedStore()?._id,m.required]}),t.isEdit&&t.variant&&(this.variantForm.patchValue(t.variant),t.variant._id&&(this.selectedOptions=t.variant.options))}productService=g(gt);storeStore=g(R);snackBar=g(L);isSubmitting=D(!1);variantForm;existingOptions=lt({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:o})=>this.productService.getStoreOptions(o.storeId)});selectedOptions=[];newOptionForm;addNewOption(){if(this.newOptionForm.valid){let o=b(C({},this.newOptionForm.value),{store:this.storeStore.selectedStore()?._id,variant:this.data.variant?._id});this.productService.saveOption(o).subscribe({next:a=>{this.selectedOptions.push(a),this.newOptionForm.reset({name:"",price:0,store:this.storeStore.selectedStore()?._id,inStock:!0}),this.snackBar.open("Option added successfully","Close",{duration:3e3})},error:()=>{this.snackBar.open("Error adding option","Close",{duration:3e3})}})}}removeOption(o){let a=this.selectedOptions.findIndex(t=>t._id===o._id);a>-1&&(this.selectedOptions.splice(a,1),this.productService.deleteOptionItem(o._id).subscribe({next:()=>{this.snackBar.open("Option removed successfully","Close",{duration:3e3})},error:()=>{this.snackBar.open("Error removing option","Close",{duration:3e3})}}))}onSubmit(){if(this.variantForm.valid){this.isSubmitting.set(!0);let o=b(C({},this.variantForm.getRawValue()),{options:this.selectedOptions.map(t=>t._id)});(this.data.isEdit?this.productService.updateVariant(o,this.data.variant._id):this.productService.createVariant(o)).subscribe({next:()=>{this.snackBar.open(`Variant ${this.data.isEdit?"updated":"created"} successfully`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dialogRef.close(!0)},error:()=>{this.snackBar.open(`Error ${this.data.isEdit?"updating":"creating"} variant`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isSubmitting.set(!1)}})}}onCancel(){this.dialogRef.close()}static \u0275fac=function(a){return new(a||r)(_(Y),_(dt),_(st))};static \u0275cmp=V({type:r,selectors:[["app-variant-dialog"]],decls:53,vars:12,consts:[["mat-dialog-title","",1,"mb-4"],[3,"formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter variant name"],[1,"grid","grid-cols-2","gap-4"],["matInput","","type","number","formControlName","atLeast","min","0"],["matInput","","type","number","formControlName","atMost","min","0"],[1,"rounded-lg","space-y-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-lg","font-medium"],[1,"space-y-4",3,"formGroup"],["matInput","","formControlName","name","placeholder","e.g., Small, Medium, Large"],["matInput","","type","number","formControlName","price","min","0"],[1,"flex","items-center","justify-between"],["formControlName","inStock","color","primary"],["mat-stroked-button","","color","primary","type","button",3,"click","disabled"],[1,"mr-2"],[1,"mt-4","space-y-2"],[1,"flex","items-center","py-4","rounded-lg"],["formControlName","enabled","color","primary"],["align","end"],["matButton","",3,"click"],["matButton","filled","color","primary","type","submit",3,"click","disabled"],[1,"text-sm","font-medium","text-gray-700"],[1,"flex","items-center","justify-between","p-2","bg-white","rounded","border","border-gray-200"],[1,"font-medium"],[1,"ml-2","text-sm","text-gray-500"],["mat-icon-button","","color","warn",3,"click"]],template:function(a,t){if(a&1&&(i(0,"h2",0),n(1),e(),i(2,"mat-dialog-content")(3,"form",1)(4,"div",2)(5,"mat-form-field",3)(6,"mat-label"),n(7,"Name"),e(),c(8,"input",4),s(9,ht,2,0,"mat-error"),e(),i(10,"div",5)(11,"mat-form-field",3)(12,"mat-label"),n(13,"At Least"),e(),c(14,"input",6),s(15,Et,2,0,"mat-error"),s(16,Mt,2,0,"mat-error"),e(),i(17,"mat-form-field",3)(18,"mat-label"),n(19,"At Most"),e(),c(20,"input",7),s(21,xt,2,0,"mat-error"),s(22,Ft,2,0,"mat-error"),e()(),i(23,"div",8)(24,"div",9)(25,"h3",10),n(26,"Options"),e()(),i(27,"form",11)(28,"div",5)(29,"mat-form-field",3)(30,"mat-label"),n(31,"Option Name"),e(),c(32,"input",12),e(),i(33,"mat-form-field",3)(34,"mat-label"),n(35,"Price"),e(),c(36,"input",13),e()(),i(37,"div",14)(38,"mat-slide-toggle",15),n(39," In Stock "),e(),i(40,"a",16),f("click",function(){return t.addNewOption()}),i(41,"mat-icon",17),n(42,"add"),e(),n(43," Add Option "),e()()(),s(44,yt,5,0,"div",18),e(),i(45,"div",19)(46,"mat-slide-toggle",20),n(47," Published "),e()()()()(),i(48,"mat-dialog-actions",21)(49,"button",22),f("click",function(){return t.onCancel()}),n(50,"Cancel"),e(),i(51,"button",23),f("click",function(){return t.onSubmit()}),n(52),e()()),a&2){let d,v,M,x,F;l(),E(" ",t.data.isEdit?"Edit Variant":"Create New Variant",`
`),l(2),u("formGroup",t.variantForm),l(6),p((d=t.variantForm.get("name"))!=null&&d.hasError("required")?9:-1),l(6),p((v=t.variantForm.get("atLeast"))!=null&&v.hasError("required")?15:-1),l(),p((M=t.variantForm.get("atLeast"))!=null&&M.hasError("min")?16:-1),l(5),p((x=t.variantForm.get("atMost"))!=null&&x.hasError("required")?21:-1),l(),p((F=t.variantForm.get("atMost"))!=null&&F.hasError("min")?22:-1),l(5),u("formGroup",t.newOptionForm),l(13),u("disabled",!t.newOptionForm.valid),l(4),p(t.selectedOptions.length>0?44:-1),l(7),u("disabled",!t.variantForm.valid||t.isSubmitting()),l(),E(" ",t.data.isEdit?"Update":"Create"," ")}},dependencies:[q,ft,pt,ut,ct,P,G,A,nt,it,tt,et,rt,ot,$,j,Z,J,z,K,U,H,X,W,Q,St,_t,at,vt,mt,B],encapsulation:2})};export{Ct as a};
