import{a as re}from"./chunk-WM2Z2FEV.js";import{a as je}from"./chunk-WZNGYR2D.js";import{a as Ue}from"./chunk-QIKVM7YD.js";import{a as ee}from"./chunk-WNTRC45I.js";import{a as Qe}from"./chunk-OVEDFEGH.js";import{a as Ye}from"./chunk-NKN4KZXX.js";import"./chunk-QY54KGVM.js";import"./chunk-QOMDDN6I.js";import"./chunk-BTIPWJHT.js";import"./chunk-AR7G356Q.js";import"./chunk-YCI4GSMN.js";import"./chunk-BA3SXM5W.js";import"./chunk-XPW44I4H.js";import"./chunk-2NVE2BM3.js";import{a as xe,b as Se}from"./chunk-W6FIBOPD.js";import"./chunk-7JNU3RG5.js";import{a as ye}from"./chunk-GGWIF4RR.js";import{a as Le,b as We,c as ze}from"./chunk-PFBPZS4P.js";import{a as Be,b as Ae,c as X,e as $e,f as He,g as Ge,h as Z}from"./chunk-GS72R6E5.js";import{c as Re,f as ke,g as Me,i as Te,l as Ie}from"./chunk-TKDVIZGU.js";import{a as Ce,b as we}from"./chunk-CRWXVOET.js";import{a as Ve}from"./chunk-GGOIOYKP.js";import{a as Oe}from"./chunk-LXK533WH.js";import{a as Ne,b as Ee,c as Pe,d as Fe}from"./chunk-EMC432UM.js";import{a as J}from"./chunk-PQXLVIGM.js";import"./chunk-ZXNLXZXA.js";import"./chunk-KAQLA7HR.js";import"./chunk-Y7XAAAUB.js";import{e as K}from"./chunk-TRTRKQKZ.js";import"./chunk-5WBVJVYM.js";import"./chunk-X7SU23UW.js";import"./chunk-3SKQMCZR.js";import"./chunk-EQD33MW2.js";import"./chunk-UJ5WOJLI.js";import"./chunk-ADMJOUL4.js";import"./chunk-O4QGXHKX.js";import"./chunk-3R2L4BJM.js";import"./chunk-Y4VWLT32.js";import"./chunk-CDKFCYZ5.js";import{b as Y,c as q}from"./chunk-2HLT5ZQQ.js";import{Y as j,_ as U}from"./chunk-UUZHPQZB.js";import"./chunk-CQ6SLR32.js";import"./chunk-C3MGKPDK.js";import{e as z,g as Q,h as _e}from"./chunk-QAO3BBZ5.js";import"./chunk-KTA4MFBX.js";import{i as he,n as fe,o as be,r as De,t as W}from"./chunk-HUSU2JWO.js";import{Cb as de,Cc as ve,Eb as A,Fb as $,Gb as ne,Hb as ie,Hc as C,Ib as M,Ic as G,Jb as T,Jc as V,Kb as I,Lb as o,Mb as s,Nb as N,Rb as ue,Rc as u,Sb as ge,Ub as O,Ya as ce,Yb as y,Za as m,_b as p,ca as b,ha as D,ia as _,ic as oe,jc as H,kc as pe,mb as L,nc as a,oc as v,pc as E,ta as k}from"./chunk-HCNG3XRF.js";import{a as se,b as le,f as me}from"./chunk-EQDQRRRY.js";var ot=c=>["/menu","hms","front-desk","reservations","edit",c];function rt(c,e){if(c&1){let n=O();o(0,"button",11),y("click",function(){D(n);let i=p();return _(i.openRoomChangeDialog())}),o(1,"mat-icon"),a(2,"swap_horiz"),s(),a(3," Change Room "),s()}}var te=class c{dialogRef=b(Be);data=b(Ae);dialog=b(X);guestService=b(Ye);reservationService=b(ee);snackBar=b(ye);storeStore=b(J);router=b(Q);route=b(z);reservation=k(this.data.reservation);roomAssignment=u(()=>{let e=this.reservation()?.rooms||[];return this.data.room?.id&&e.find(n=>n?.room?._id===this.data.room?.id)||e[0]});assignedGuest=u(()=>this.roomAssignment()?.assignedGuest||this.reservation()?.guest);guestName=u(()=>{let e=this.assignedGuest();return this.guestService.getGuestName(e)});openReservation(){this.close(),this.router.navigate(["../../../edit",this.reservation()?._id],{relativeTo:this.route})}roomCheckIn=u(()=>this.roomAssignment()?.stayPeriod?.from||this.reservation()?.checkInDate);roomCheckOut=u(()=>this.roomAssignment()?.stayPeriod?.to||this.reservation()?.checkOutDate);roomTypeName=u(()=>{let n=this.roomAssignment()?.room?.roomType;return typeof n=="object"&&n?.name?n.name:"\u2014"});roomNumber=u(()=>this.roomAssignment()?.room?.roomNumber||"\u2014");roomName=u(()=>this.roomAssignment()?.room?.name||"\u2014");roomGuestsCount=u(()=>{let n=this.roomAssignment()?.guests||{},t=Number(n.adults||0),i=Number(n.children||0);return t+i||1});roomTotal=u(()=>this.roomAssignment()?.pricing?.total||0);amountPaid=u(()=>this.reservation()?.pricing?.paid||0);balanceAmount=u(()=>Math.max(0,this.roomTotal()-this.amountPaid()));bookingTotal=u(()=>this.reservation()?.pricing?.total||0);bookingSource=u(()=>this.reservation()?.bookingSource||"\u2014");reservationType=u(()=>this.reservation()?.bookingType||this.reservation()?.reservationType||"\u2014");confirmationNumber=u(()=>this.reservation()?.confirmationNumber||this.reservation()?._id||"\u2014");paymentMethod=u(()=>this.reservation()?.paymentInfo?.method||"\u2014");canChangeRooms=u(()=>{let e=this.reservation()?.status;return e&&!["checked_out","cancelled","no_show"].includes(e)});openRoomChangeDialog(){let e=this.reservation();if(!e||!this.canChangeRooms()){this.snackBar.open("Cannot change rooms for this reservation","Close",{duration:3e3});return}this.dialog.open(Ue,{width:"500px",maxWidth:"95vw",disableClose:!0,data:{reservationId:e._id,currentRooms:e.rooms,checkInDate:new Date(e.checkInDate).toISOString(),checkOutDate:new Date(e.checkOutDate).toISOString(),numberOfNights:e.numberOfNights,currency:this.storeStore.selectedStore()?.currency||"USD",actualCheckInDate:e.actualCheckInDate?new Date(e.actualCheckInDate).toISOString():void 0,reservationStatus:e.status}}).afterClosed().subscribe(t=>me(this,null,function*(){if(t)try{let i=yield this.reservationService.changeRooms(e._id,t).toPromise();i?.success&&(this.snackBar.open("Room changed successfully","Close",{duration:3e3}),this.reservation.set(i.data))}catch(i){console.error("Error changing rooms:",i);let r=i?.error?.error||i?.error?.message||i?.message||"Failed to change rooms";this.snackBar.open(r,"Close",{duration:5e3})}}))}close(){this.dialogRef.close()}statusLabel=u(()=>(this.reservation()?.status||"reserved").replace("_"," "));statusClass=u(()=>{let e=this.reservation()?.status||"reserved";return{pending:"bg-yellow-100 text-yellow-800 border border-yellow-200",confirmed:"bg-blue-100 text-blue-800 border border-blue-200",checked_in:"bg-green-100 text-green-800 border border-green-200",checked_out:"bg-gray-100 text-gray-800 border border-gray-200",cancelled:"bg-red-100 text-red-800 border border-red-200",no_show:"bg-orange-100 text-orange-800 border border-orange-200",reserved:"bg-indigo-100 text-indigo-800 border border-indigo-200"}[e]||"bg-gray-100 text-gray-800 border border-gray-200"});static \u0275fac=function(n){return new(n||c)};static \u0275cmp=L({type:c,selectors:[["app-reservation-preview-dialog"]],decls:77,vars:37,consts:[["mat-dialog-title","",1,"flex","items-center","justify-between"],["color","primary",1,"capitalize"],[1,"capitalize"],["mat-subheader",""],["matListItemMeta",""],["matListItemMeta","",1,"capitalize"],["matListItemMeta","",1,"font-semibold"],["align","end",1,"gap-2"],["matButton","tonal"],["matButton","outlined",3,"click","routerLink"],["matButton","outlined",3,"click"],["matButton","tonal",3,"click"]],template:function(n,t){if(n&1&&(o(0,"h2",0),a(1),s(),o(2,"mat-dialog-content")(3,"mat-chip-set")(4,"mat-chip",1),a(5),s(),o(6,"mat-chip",2),a(7),s(),o(8,"mat-chip"),a(9),s()(),o(10,"mat-list")(11,"div",3),a(12,"Stay"),s(),o(13,"mat-list-item"),a(14," Check-in "),o(15,"span",4),a(16),C(17,"date"),s()(),o(18,"mat-list-item"),a(19," Check-out "),o(20,"span",4),a(21),C(22,"date"),s()(),o(23,"mat-list-item"),a(24," Source "),o(25,"span",5),a(26),s()()(),N(27,"mat-divider"),o(28,"mat-list")(29,"div",3),a(30,"Room"),s(),o(31,"mat-list-item"),a(32," Room Type "),o(33,"span",4),a(34),s()(),o(35,"mat-list-item"),a(36," Room Number "),o(37,"span",4),a(38),s()(),o(39,"mat-list-item"),a(40," Room Name "),o(41,"span",4),a(42),s()()(),N(43,"mat-divider"),o(44,"mat-list")(45,"div",3),a(46,"Payment"),s(),o(47,"mat-list-item"),a(48," Payment Mode "),o(49,"span",5),a(50),s()(),o(51,"mat-list-item"),a(52," Total "),o(53,"span",4),a(54),C(55,"currency"),s()(),o(56,"mat-list-item"),a(57," Amount Paid "),o(58,"span",4),a(59),C(60,"currency"),s()(),o(61,"mat-list-item"),a(62," Balance "),o(63,"span",4),a(64),C(65,"currency"),s()(),o(66,"mat-list-item"),a(67," Booking Total "),o(68,"span",6),a(69),C(70,"currency"),s()()()(),o(71,"mat-dialog-actions",7),A(72,rt,4,0,"button",8),o(73,"a",9),y("click",function(){return t.close()}),a(74,"View"),s(),o(75,"button",10),y("click",function(){return t.close()}),a(76,"Close"),s()()),n&2){let i,r,l,d;m(),E(" ",t.guestName(),`
`),m(4),v(t.statusLabel()),m(2),v(t.reservationType()),m(2),v(t.confirmationNumber()),m(7),v(V(17,17,t.roomCheckIn(),"dd/MM/yyyy")),m(5),v(V(22,20,t.roomCheckOut(),"dd/MM/yyyy")),m(5),v(t.bookingSource()),m(8),v(t.roomTypeName()),m(4),v(t.roomNumber()),m(4),v(t.roomName()),m(8),v(t.paymentMethod()),m(4),v(V(55,23,t.roomTotal(),(i=t.storeStore.selectedStore())==null?null:i.currency)),m(5),v(V(60,26,t.amountPaid(),(r=t.storeStore.selectedStore())==null?null:r.currency)),m(5),v(V(65,29,t.balanceAmount(),(l=t.storeStore.selectedStore())==null?null:l.currency)),m(5),v(V(70,32,t.bookingTotal(),(d=t.storeStore.selectedStore())==null?null:d.currency)),m(3),$(t.canChangeRooms()?72:-1),m(),I("routerLink",ve(35,ot,t.reservation()._id))}},dependencies:[W,Z,$e,Ge,He,q,Y,U,j,we,Ce,ze,Le,We,Ie,ke,Me,Te,Re,_e,De,be],encapsulation:2})};var ae=(c,e)=>e.key;function at(c,e){if(c&1){let n=O();o(0,"button",20),y("click",function(){let i=D(n).$implicit,r=p();return _(r.onStatusChange(i))}),a(1),C(2,"titlecase"),s()}if(c&2){let n=e.$implicit;m(),v(G(2,1,n))}}function st(c,e){c&1&&(o(0,"div",26),N(1,"mat-progress-spinner",35),s())}function lt(c,e){if(c&1&&(o(0,"div",31),N(1,"span",36),o(2,"span",37),a(3),C(4,"titlecase"),s()()),c&2){let n=e.$implicit,t=p();m(),I("ngClass",t.getStatusColorClass(n)),m(2),v(G(4,2,n))}}function mt(c,e){if(c&1&&(o(0,"th",38)(1,"p",39),a(2),s(),o(3,"p",40),a(4),s()()),c&2){let n=e.$implicit,t=p();H("width",t.cellWidthPx(),"px"),m(2),v(n.dayName),m(2),v(n.day)}}function ct(c,e){if(c&1&&N(0,"td",45),c&2){let n=p(3);H("width",n.cellWidthPx(),"px")}}function dt(c,e){if(c&1&&(o(0,"tr")(1,"td",42)(2,"span",43),a(3),s()(),M(4,ct,1,2,"td",44,ae),s()),c&2){let n=p().$implicit,t=p();m(3),v(n.roomTypeName),m(),T(t.dateRange())}}function ut(c,e){if(c&1){let n=O();o(0,"div",50),y("click",function(i){D(n);let r=p().$implicit,l=p(3).$implicit;return p().openReservationPreview(r.reservation,l),_(i.stopPropagation())})("mousedown",function(i){return D(n),_(i.stopPropagation())}),o(1,"div",51),a(2),s()()}if(c&2){let n=p().$implicit,t=p().$implicit,i=p(2).$implicit,r=p();H("top",r.getReservationTopPercent(i.reservations,t,n),"%")("height",r.getReservationHeightPercent(i.reservations,t),"%")("width",r.getReservationWidth(n,t),"px"),I("ngClass",r.getReservationStyle(n))("matTooltip",r.getReservationTooltip(n,i.roomName)),m(2),E("",r.getReservationBlockLabel(n)," ")}}function gt(c,e){if(c&1&&A(0,ut,3,9,"div",49),c&2){let n=e.$implicit,t=p().$implicit,i=p(3);$(i.shouldRenderReservationFromDate(n,t)?0:-1)}}function pt(c,e){if(c&1){let n=O();o(0,"td",48),y("mousedown",function(i){let r=D(n).$implicit,l=p(2).$implicit,d=p();return _(d.onCellMouseDown(i,r,l))})("mouseenter",function(){let i=D(n).$implicit,r=p(2).$implicit,l=p();return _(l.onCellMouseEnter(i,r))})("mouseup",function(){D(n);let i=p(3);return _(i.onCellMouseUp())}),M(1,gt,1,1,null,null,ne),s()}if(c&2){let n=e.$implicit,t=p(2).$implicit,i=p();H("width",i.cellWidthPx(),"px"),pe("bg-blue-100",i.isCellInSelection(n,t)&&!i.dragSelection().hasConflict)("bg-red-100",i.isCellInSelection(n,t)&&i.dragSelection().hasConflict)("cursor-pointer",!i.hasReservationOnDate(t.roomId,n.date))("cursor-not-allowed",i.hasReservationOnDate(t.roomId,n.date)),m(),T(t.reservations)}}function vt(c,e){if(c&1&&(o(0,"tr",41)(1,"td",46),a(2),s(),M(3,pt,3,10,"td",47,ae),s()),c&2){let n=p().$implicit,t=p();m(2),E(" ",n.roomName," "),m(),T(t.dateRange())}}function ht(c,e){if(c&1&&A(0,dt,6,1,"tr")(1,vt,5,1,"tr",41),c&2){let n=e.$implicit;$(n.isGroup?0:1)}}var qe=class c{storeStore=b(J);reservationService=b(ee);roomService=b(Qe);router=b(Q);route=b(z);dialog=b(X);viewMode=k("monthly");startDate=k(new Date);selectedStatus=k("all");excludedStatuses=k(new Set(["checked_out","cancelled","no_show"]));dragSelection=k({isSelecting:!1,startDate:null,endDate:null,roomId:null,roomName:null,roomTypeId:null,roomTypeName:null,hasConflict:!1});reservationStatuses=["pending","confirmed","checked_in","checked_out","cancelled","no_show","reserved"];statusColorMap={pending:"bg-yellow-500",confirmed:"bg-blue-600",checked_in:"bg-green-600",checked_out:"bg-gray-500",cancelled:"bg-red-600",no_show:"bg-orange-600",reserved:"bg-indigo-600"};dateRange=u(()=>{let e=[],n=this.viewMode(),t=this.alignStartOfPeriod(this.startDate(),n);if(n==="weekly")for(let i=0;i<7;i++){let r=new Date(t);r.setDate(r.getDate()+i),e.push({key:r.toISOString().slice(0,10),day:r.getDate(),dayName:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][r.getDay()],date:new Date(r)})}else{let i=t.getFullYear(),r=t.getMonth(),l=new Date(i,r+1,0).getDate();for(let d=0;d<l;d++){let h=new Date(i,r,d+1);e.push({key:h.toISOString().slice(0,10),day:h.getDate(),dayName:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][h.getDay()],date:new Date(h)})}}return e});rooms=K({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.roomService.getRooms(e.storeId)});reservations=K({params:()=>{let e=this.storeStore.selectedStore()?._id,n=this.viewMode(),t=this.alignStartOfPeriod(this.startDate(),n),{dateFrom:i,dateTo:r}=this.getPeriodDateRangeStrings(t,n),l=this.selectedStatus();return{storeId:e,dateFrom:i,dateTo:r,status:l==="all"?void 0:l}},stream:({params:e})=>this.reservationService.getReservations({storeId:e.storeId,dateFrom:e.dateFrom,dateTo:e.dateTo,status:e.status})});roomTypes=K({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:e})=>this.roomService.getRoomTypes(e.storeId)});roomsWithReservations=u(()=>{let e=this.rooms.value()||[],n=this.roomTypes.value()||[],t=this.reservations.value(),i=Array.isArray(t)?t:t?.reservations||[],r=this.excludedStatuses(),l=i.filter(g=>this.selectedStatus()!=="all"?g.status===this.selectedStatus():!r.has(g.status)),d=new Map;for(let g of n)g&&g._id&&d.set(g._id,g.name||"Room");let h=new Map;for(let g of e){let w,f="Room";typeof g.roomType=="string"?(w=g.roomType,f=d.get(g.roomType)||g.roomType):g.roomType&&(w=g.roomType._id,f=g.roomType.name||"Room");let P=w||f;h.has(P)||h.set(P,{typeName:f,rooms:[]}),h.get(P).rooms.push(g)}let x=[];for(let g of n)g&&g._id&&h.has(g._id)&&x.push(g._id);for(let g of h.keys())x.includes(g)||x.push(g);let R=[];for(let g of x){let w=h.get(g);if(w){R.push({isGroup:!0,roomTypeName:w.typeName});for(let f of w.rooms){let P=[];for(let S of l){if(!S?.rooms)continue;let F=S.rooms.filter(B=>B?.room?._id===f._id);if(F?.length)for(let B of F){let Je=B?.stayPeriod?.from||S.checkInDate,Ke=B?.stayPeriod?.to||S.checkOutDate,Xe=B?.assignedGuest||S.guest;P.push({reservationId:S._id,roomAssignmentId:B?._id,checkInDate:Je,checkOutDate:Ke,guest:Xe,status:S.status,bookingType:S.bookingType,confirmationNumber:S.confirmationNumber,reservation:S})}}R.push({isGroup:!1,roomId:f._id,roomName:`${f.name} ${f.roomNumber??""}`,roomTypeId:typeof f.roomType=="string"?f.roomType:f.roomType?._id,roomTypeName:w.typeName,capacity:f.capacity||2,reservations:P})}}}return R});confirmedCount=u(()=>this.reservations.value()?.reservations.filter(e=>e.status==="confirmed").length);checkedInCount=u(()=>this.reservations.value()?.reservations.filter(e=>e.status==="checked_in").length);pendingCount=u(()=>this.reservations.value()?.reservations.filter(e=>e.status==="pending").length);cancelledCount=u(()=>this.reservations.value()?.reservations.filter(e=>e.status==="cancelled").length);totalRevenue=u(()=>this.reservations.value()?.reservations.reduce((e,n)=>e+this.getEffectiveTotal(n),0));getEffectiveTotal(e){return e.pricing?.total||0}ngOnInit(){let e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1);this.startDate.set(n)}reloadData(){this.reservations.reload()}clearFilters(){this.viewMode.set("monthly"),this.selectedStatus.set("all");let e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1);this.startDate.set(n)}createReservation(){this.dialog.open(re,{width:"600px",disableClose:!1}).afterClosed().subscribe(n=>{n&&this.router.navigate(["../create"],{relativeTo:this.route.parent,queryParams:{quickReservation:JSON.stringify(n)}})})}getPeriodLabel(){let e=this.viewMode(),n=this.alignStartOfPeriod(this.startDate(),e),t=new Date(n);e==="weekly"?t.setDate(t.getDate()+6):(t=new Date(n.getFullYear(),n.getMonth()+1,0),t.setHours(0,0,0,0));let i=new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric"});return`${i.format(n)} \u2013 ${i.format(t)}`}isReservationOnDate(e,n){let t=new Date(e.checkInDate),i=new Date(e.checkOutDate);t.setHours(0,0,0,0),i.setHours(0,0,0,0);let r=new Date(n.date);return r.setHours(0,0,0,0),r>=t&&r<i}isReservationStartingOnDate(e,n){let t=new Date(e.checkInDate);t.setHours(0,0,0,0);let i=new Date(n.date);return i.setHours(0,0,0,0),i.getTime()===t.getTime()}shouldRenderReservationFromDate(e,n){let t=new Date(e.checkInDate),i=new Date(e.checkOutDate);t.setHours(0,0,0,0),i.setHours(0,0,0,0);let r=new Date(n.date);if(r.setHours(0,0,0,0),r.getTime()===t.getTime())return!0;let l=this.dateRange();if(Array.isArray(l)&&l.length>0){let d=new Date(l[0].date);if(d.setHours(0,0,0,0),r.getTime()===d.getTime()&&r>=t&&r<i)return!0}return!1}getReservationWidth(e,n){let t=new Date(e.checkInDate),i=new Date(e.checkOutDate),r=this.cellWidthPx(),l=this.cellGapPx();t.setHours(0,0,0,0),i.setHours(0,0,0,0);let d=new Date(n.date);if(d.setHours(0,0,0,0),d<t)return 0;let h=d>t?d:t,x=this.dateRange(),R=i;if(Array.isArray(x)&&x.length>0){let S=new Date(x[x.length-1].date);S.setHours(0,0,0,0);let F=new Date(S);F.setDate(F.getDate()+1),R=R<F?R:F}let g=1e3*60*60*24,w=(R.getTime()-h.getTime())/g,f=Math.max(0,Math.ceil(w));return f<=0?0:f*r+(f-1)*l}getReservationStyle(e){let n=e?.status||"reserved";return this.statusColorMap[n]||"bg-gray-500"}getStatusColorClass(e){return this.statusColorMap[e]||"bg-gray-500"}previousWeek(){let e=this.viewMode(),n=new Date(this.startDate());e==="weekly"?n.setDate(n.getDate()-7):n.setMonth(n.getMonth()-1),this.startDate.set(this.alignStartOfPeriod(n,e))}nextWeek(){let e=this.viewMode(),n=new Date(this.startDate());e==="weekly"?n.setDate(n.getDate()+7):n.setMonth(n.getMonth()+1),this.startDate.set(this.alignStartOfPeriod(n,e))}goToToday(){let e=new Date;this.startDate.set(this.alignStartOfPeriod(e,this.viewMode()))}onViewModeChange(e){this.viewMode.set(e),this.goToToday()}onStatusChange(e){this.selectedStatus.set(e)}alignStartOfPeriod(e,n){let t=new Date(e);return n==="weekly"?(t.setHours(0,0,0,0),t):new Date(t.getFullYear(),t.getMonth(),1)}getPeriodDateRangeStrings(e,n){let t=new Date(e);t.setHours(0,0,0,0);let i=new Date(t);n==="weekly"?i.setDate(i.getDate()+6):(i=new Date(t.getFullYear(),t.getMonth()+1,0),i.setHours(0,0,0,0));let r=t.toISOString().split("T")[0],l=i.toISOString().split("T")[0];return{dateFrom:r,dateTo:l}}getReservationTooltip(e,n){let t=e.guest?.firstName&&e.guest?.lastName?`${e.guest.firstName} ${e.guest.lastName}`:e.guestName||"Guest",i=n||"Room",r=new Date(e.checkInDate),l=new Date(e.checkOutDate),d={year:"numeric",month:"short",day:"2-digit"},h=r.toLocaleDateString(void 0,d),x=l.toLocaleDateString(void 0,d);return`${i} | ${t} | Check-in: ${h} | Check-out: ${x}`}cellWidthPx(){return this.viewMode()==="weekly"?160:80}cellGapPx(){return this.viewMode()==="weekly"?4:2}getCellReservationsCount(e,n){return(e||[]).filter(t=>this.isReservationStartingOnDate(t,n)).length}getCellStackIndex(e,n,t){let r=(e||[]).filter(l=>this.isReservationStartingOnDate(l,n)).findIndex(l=>l===t||l.roomAssignmentId&&t.roomAssignmentId&&l.roomAssignmentId===t.roomAssignmentId||l.reservationId&&t.reservationId&&l.reservationId===t.reservationId);return r>=0?r:0}getReservationTopPercent(e,n,t){let i=this.getCellReservationsCount(e,n);return i<=1?0:this.getCellStackIndex(e,n,t)*(100/i)}getReservationHeightPercent(e,n){return 100/(this.getCellReservationsCount(e,n)||1)}isGroupReservation(e){if(!e)return!1;let n=e;return n.reservationType==="group"||n.bookingType==="group"||n.groupReservation===!0||n.guest?.type==="group"||n.guest?.guestType==="group"||!!n.guest?.companyName}getReservationBlockLabel(e){let n=e?.guest||{},t=`${n.firstName||""} ${n.lastName||""}`.trim()||"Guest";return`${this.isGroupReservation(e)?"(G)":""} ${t}`}openReservationPreview(e,n){e&&this.dialog.open(te,{width:"700px",data:{reservation:e,room:{name:n?.roomName,id:n?.roomId}}})}hasReservationOnDate(e,n){let i=this.roomsWithReservations().find(l=>!l.isGroup&&l.roomId===e);if(!i||!i.reservations)return!1;let r=new Date(n);return r.setHours(0,0,0,0),i.reservations.some(l=>{let d=new Date(l.checkInDate),h=new Date(l.checkOutDate);return d.setHours(0,0,0,0),h.setHours(0,0,0,0),r>=d&&r<h})}hasConflictInRange(e,n,t){let i=new Date(Math.min(n.getTime(),t.getTime())),r=new Date(Math.max(n.getTime(),t.getTime()));i.setHours(0,0,0,0),r.setHours(0,0,0,0);let l=new Date(i);for(;l<=r;){if(this.hasReservationOnDate(e,l))return!0;l.setDate(l.getDate()+1)}return!1}onCellMouseDown(e,n,t){if(t.isGroup)return;e.preventDefault();let i=new Date(n.date),r=new Date(n.date);r.setDate(r.getDate()+1);let l=this.hasReservationOnDate(t.roomId,i)||this.hasReservationOnDate(t.roomId,r);this.dragSelection.set({isSelecting:!0,startDate:new Date(n.date),endDate:new Date(n.date),roomId:t.roomId,roomName:t.roomName,roomTypeId:t.roomTypeId||null,roomTypeName:t.roomTypeName||null,hasConflict:l})}onCellMouseEnter(e,n){let t=this.dragSelection();if(!t.isSelecting||n.roomId!==t.roomId)return;let i=new Date(e.date),r=this.hasConflictInRange(t.roomId,t.startDate,i);this.dragSelection.update(l=>le(se({},l),{endDate:i,hasConflict:r}))}onCellMouseUp(){let e=this.dragSelection();if(e.isSelecting){if(!e.hasConflict&&e.startDate&&e.endDate&&e.roomId){let n=new Date(Math.min(e.startDate.getTime(),e.endDate.getTime())),t=new Date(Math.max(e.startDate.getTime(),e.endDate.getTime())),i=new Date(t);n.getTime()===t.getTime()&&i.setDate(i.getDate()+1),console.log("Check-in:",n,"Check-out:",i),this.openQuickReservationWithDates(n,i,e.roomId,e.roomName,e.roomTypeId,e.roomTypeName)}this.resetDragSelection()}}resetDragSelection(){this.dragSelection.set({isSelecting:!1,startDate:null,endDate:null,roomId:null,roomName:null,roomTypeId:null,roomTypeName:null,hasConflict:!1})}isCellInSelection(e,n){let t=this.dragSelection();if(!t.isSelecting||!t.startDate||!t.endDate||n.isGroup||n.roomId!==t.roomId)return!1;let i=new Date(e.date);i.setHours(0,0,0,0);let r=new Date(Math.min(t.startDate.getTime(),t.endDate.getTime())),l=new Date(Math.max(t.startDate.getTime(),t.endDate.getTime()));return r.setHours(0,0,0,0),l.setHours(0,0,0,0),r.getTime()===l.getTime()&&(l=new Date(l),l.setDate(l.getDate()+1)),i>=r&&i<=l}openQuickReservationWithDates(e,n,t,i,r,l){let d={checkInDate:e,checkOutDate:n,preselectedRoomId:t,preselectedRoomName:i??void 0,preselectedRoomTypeId:r??void 0,preselectedRoomTypeName:l??void 0};this.dialog.open(re,{width:"600px",data:d}).afterClosed().subscribe(x=>{x&&x&&this.router.navigate(["../create"],{relativeTo:this.route.parent,queryParams:{quickReservation:JSON.stringify(x)}})})}onDocumentMouseUp(){this.dragSelection().isSelecting&&this.onCellMouseUp()}static \u0275fac=function(n){return new(n||c)};static \u0275cmp=L({type:c,selectors:[["app-reservations-calendar"]],hostBindings:function(n,t){n&1&&y("mouseup",function(){return t.onDocumentMouseUp()},ce)},decls:108,vars:17,consts:[["viewMenu","matMenu"],["statusMenu","matMenu"],["title","Reservations","subtitle","Manage hotel reservations and guest bookings","viewToggleRoute","/menu/hms/front-desk/reservations/view",3,"showViewToggle"],["actions",""],["matButton","outlined",3,"click"],[1,"mr-1"],["matButton","filled",3,"click"],[1,"min-h-screen","flex","flex-col"],[1,"border-b","border-gray-200","py-4"],[1,"flex","justify-between","items-center"],[1,"flex","flex-wrap","gap-4","mt-2"],[1,"flex","items-center","gap-2","text-sm","text-gray-600"],[1,"text-base"],[1,"text-base","text-green-600"],[1,"text-base","text-purple-600"],[1,"text-base","text-orange-600"],[1,"text-base","text-red-600"],[1,"flex","gap-3","items-center"],["mat-stroked-button","",3,"matMenuTriggerFor"],[1,"ml-1"],["mat-menu-item","",3,"click"],["mat-menu-item",""],["matButton","tonal",3,"click"],["matButton","","color","warn"],[1,"flex-1","overflow-hidden","flex","flex-col","min-h-96"],[1,"overflow-auto","flex-1","relative","min-h-80"],[1,"absolute","inset-0","z-50","flex","items-center","justify-center","bg-white/60"],[1,"w-full","border-collapse","overflow-hidden"],[1,"sticky","left-0","z-10","w-48","border","border-gray-200","bg-white"],[1,"border","border-gray-200","bg-white","px-4","py-2"],[1,"flex","flex-wrap","items-center","gap-4"],[1,"flex","items-center","gap-2"],[1,"sticky","left-0","top-0","z-30","w-48","bg-white","border","border-gray-200","text-center"],[1,"text-xs","font-semibold","text-gray-700","uppercase"],[1,"sticky","top-0","z-20","bg-white","border","border-gray-200","text-center",3,"width"],["diameter","40","mode","indeterminate"],[1,"inline-block","w-3","h-3","rounded-sm",3,"ngClass"],[1,"text-xs","text-gray-700"],[1,"sticky","top-0","z-20","bg-white","border","border-gray-200","text-center"],[1,"text-xs","font-semibold","text-gray-600"],[1,"text-sm","font-bold","text-gray-900"],[1,"h-12"],[1,"sticky","left-0","z-10","w-48","border","border-gray-200","px-4","py-2","text-left","bg-gray-100"],[1,"text-xs","font-semibold","text-gray-800"],[1,"border","border-gray-200","bg-gray-100",3,"width"],[1,"border","border-gray-200","bg-gray-100"],[1,"sticky","left-0","z-10","w-48","border","border-gray-200","px-4","bg-gray-50","text-xs"],[1,"border","border-gray-200","relative","overflow-visible","select-none",3,"bg-blue-100","bg-red-100","cursor-pointer","cursor-not-allowed","width"],[1,"border","border-gray-200","relative","overflow-visible","select-none",3,"mousedown","mouseenter","mouseup"],["matTooltipPosition","above",1,"absolute","left-0.5","right-0.5","border","flex","items-center","text-white","text-xs","font-semibold","overflow-hidden","z-10","cursor-pointer",3,"ngClass","top","height","width","matTooltip"],["matTooltipPosition","above",1,"absolute","left-0.5","right-0.5","border","flex","items-center","text-white","text-xs","font-semibold","overflow-hidden","z-10","cursor-pointer",3,"click","mousedown","ngClass","matTooltip"],[1,"truncate","px-1"]],template:function(n,t){if(n&1){let i=O();o(0,"app-page-header",2),ue(1,3),o(2,"button",4),y("click",function(){return D(i),_(t.clearFilters())}),o(3,"mat-icon"),a(4,"clear"),s(),a(5," Clear Filters "),s(),o(6,"button",4),y("click",function(){return D(i),_(t.reloadData())}),o(7,"mat-icon",5),a(8,"redo"),s(),a(9," Reload "),s(),o(10,"button",6),y("click",function(){return D(i),_(t.createReservation())}),o(11,"mat-icon",5),a(12,"add"),s(),a(13," Create Reservation "),s(),ge(),s(),o(14,"div",7)(15,"div",8)(16,"div",9)(17,"div")(18,"div",10)(19,"div",11)(20,"mat-icon",12),a(21,"hotel"),s(),o(22,"span"),a(23,"Total: "),o(24,"strong"),a(25),s()()(),o(26,"div",11)(27,"mat-icon",13),a(28,"check_circle"),s(),o(29,"span"),a(30,"Confirmed: "),o(31,"strong"),a(32),s()()(),o(33,"div",11)(34,"mat-icon",14),a(35,"person"),s(),o(36,"span"),a(37,"Checked In: "),o(38,"strong"),a(39),s()()(),o(40,"div",11)(41,"mat-icon",15),a(42,"schedule"),s(),o(43,"span"),a(44,"Pending: "),o(45,"strong"),a(46),s()()(),o(47,"div",11)(48,"mat-icon",16),a(49,"cancel"),s(),o(50,"span"),a(51,"Cancelled: "),o(52,"strong"),a(53),s()()()()(),o(54,"div",17)(55,"button",18),a(56),C(57,"titlecase"),o(58,"mat-icon",19),a(59,"expand_more"),s()(),o(60,"mat-menu",null,0)(62,"button",20),y("click",function(){return D(i),_(t.onViewModeChange("weekly"))}),a(63,"Weekly"),s(),o(64,"button",20),y("click",function(){return D(i),_(t.onViewModeChange("monthly"))}),a(65,"Monthly"),s()(),o(66,"button",18),a(67),C(68,"titlecase"),o(69,"mat-icon",19),a(70,"expand_more"),s()(),o(71,"mat-menu",null,1)(73,"button",20),y("click",function(){return D(i),_(t.onStatusChange("all"))}),a(74,"All"),s(),M(75,at,3,3,"button",21,ie),s(),o(77,"button",22),y("click",function(){return D(i),_(t.previousWeek())}),o(78,"mat-icon",5),a(79,"chevron_left"),s(),a(80," Previous "),s(),o(81,"button",23),a(82),s(),o(83,"button",22),y("click",function(){return D(i),_(t.nextWeek())}),a(84," Next "),o(85,"mat-icon",19),a(86,"chevron_right"),s()()()()(),o(87,"div",24)(88,"div",25),A(89,st,2,0,"div",26),o(90,"table",27)(91,"tfoot")(92,"tr"),N(93,"td",28),o(94,"td",29)(95,"div",30),M(96,lt,5,4,"div",31,ie),s()()()(),o(98,"thead")(99,"tr")(100,"th",32)(101,"span",33),a(102,"Rooms"),s()(),M(103,mt,5,4,"th",34,ae),s()(),o(105,"tbody"),M(106,ht,2,1,null,null,ne),s()()()()()}if(n&2){let i,r=oe(61),l=oe(72);I("showViewToggle",!0),m(25),v(((i=t.reservations.value())==null||i.reservations==null?null:i.reservations.length)||0),m(7),v(t.confirmedCount()||0),m(7),v(t.checkedInCount()||0),m(7),v(t.pendingCount()||0),m(7),v(t.cancelledCount()||0),m(2),I("matMenuTriggerFor",r),m(),E(" ",G(57,13,t.viewMode())," "),m(10),I("matMenuTriggerFor",l),m(),E(" Status: ",G(68,15,t.selectedStatus())," "),m(8),T(t.reservationStatuses),m(7),E(" ",t.getPeriodLabel()," "),m(7),$(t.reservations.isLoading()?89:-1),m(5),de("colspan",t.dateRange().length),m(2),T(t.reservationStatuses),m(7),T(t.dateRange()),m(3),T(t.roomsWithReservations())}},dependencies:[W,he,U,j,q,Y,Fe,Ee,Ne,Pe,Se,xe,Ve,Oe,Z,je,fe],encapsulation:2})};export{qe as ReservationsCalendar};
