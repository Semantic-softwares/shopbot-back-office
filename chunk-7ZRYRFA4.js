import{a as K}from"./chunk-OJWZ6ZD7.js";import{D as T,K as A,Oc as v,S as O,V as x,Z as W,b as k,c as P,ca as S,f as E,k as L,la as I,na as M,o as C,ta as F,ub as b,wa as R,xa as w}from"./chunk-KGWH6IHP.js";import{a as r,b as p}from"./chunk-EQDQRRRY.js";var U=Symbol("DEEP_SIGNAL");function z(t){return new Proxy(t,{has(e,n){return!!this.get(e,n,void 0)},get(e,n){let o=w(e);return!Q(o)||!(n in o)?(b(e[n])&&e[n][U]&&delete e[n],e[n]):(b(e[n])||(Object.defineProperty(e,n,{value:v(()=>e()[n]),configurable:!0}),e[n][U]=!0),z(e[n]))}})}var N=[WeakSet,WeakMap,Promise,Date,Error,RegExp,ArrayBuffer,DataView,Function];function Q(t){if(t===null||typeof t!="object"||X(t))return!1;let e=Object.getPrototypeOf(t);if(e===Object.prototype)return!0;for(;e&&e!==Object.prototype;){if(N.includes(e.constructor))return!1;e=Object.getPrototypeOf(e)}return e===Object.prototype}function X(t){return typeof t?.[Symbol.iterator]=="function"}var Z=new WeakMap,u=Symbol("STATE_SOURCE");function f(t,...e){let n=w(()=>q(t)),o=e.reduce((c,l)=>r(r({},c),typeof l=="function"?l(c):l),n),a=t[u],i=Reflect.ownKeys(t[u]);for(let c of Reflect.ownKeys(o))if(i.includes(c)){let l=c;n[l]!==o[l]&&a[l].set(o[l])}te(t)}function q(t){let e=t[u];return Reflect.ownKeys(t[u]).reduce((n,o)=>{let a=e[o]();return p(r({},n),{[o]:a})},{})}function ee(t){return Z.get(t[u])||[]}function te(t){let e=ee(t);for(let n of e){let o=w(()=>q(t));n(o)}}function _(...t){let e=[...t],n=typeof e[0]=="function"?{}:e.shift(),o=e;return(()=>{class i{constructor(){let l=o.reduce((y,J)=>J(y),ne()),{stateSignals:g,props:h,methods:m,hooks:s}=l,d=r(r(r({},g),h),m);this[u]=l[u];for(let y of Reflect.ownKeys(d))this[y]=d[y];let{onInit:j,onDestroy:D}=s;j&&j(),D&&S(M).onDestroy(D)}static \u0275fac=function(g){return new(g||i)};static \u0275prov=W({token:i,factory:i.\u0275fac,providedIn:n.providedIn||null})}return i})()}function ne(){return{[u]:{},stateSignals:{},props:{},methods:{},hooks:{}}}function oe(t){return e=>{let n=t(r(r(r({[u]:e[u]},e.stateSignals),e.props),e.methods));return p(r({},e),{props:r(r({},e.props),n)})}}function $(t){return oe(e=>{let n=t(e);return Reflect.ownKeys(n).reduce((a,i)=>{let c=n[i];return p(r({},a),{[i]:b(c)?c:v(c)})},{})})}function G(t){return e=>{let n=r(r(r({[u]:e[u]},e.stateSignals),e.props),e.methods),o=typeof t=="function"?t(n):t,a=(i,c)=>c?()=>{i&&i(),c(n)}:i;return p(r({},e),{hooks:{onInit:a(e.hooks.onInit,o.onInit),onDestroy:a(e.hooks.onDestroy,o.onDestroy)}})}}function H(t){return e=>{let n=t(r(r(r({[u]:e[u]},e.stateSignals),e.props),e.methods));return p(r({},e),{methods:r(r({},e.methods),n)})}}function B(t){return e=>{let n=typeof t=="function"?t():t,o=Reflect.ownKeys(n),a=e[u],i={};for(let c of o)a[c]=F(n[c]),i[c]=z(a[c]);return p(r({},e),{stateSignals:r(r({},e.stateSignals),i)})}}function V(t,e,n){let o=typeof t=="function"?{next:t,error:e,complete:n}:t;return a=>a.pipe(x({next:o.next,complete:o.complete}),T(i=>(o.error(i),L)),o.finalize?A(o.finalize):i=>i)}function Y(t,e){let n=e?.injector??S(I),o=new E,a=t(o).subscribe();n.get(M).onDestroy(()=>a.unsubscribe());let i=(c,l)=>{if(re(c))return o.next(c),{destroy:k};let g=ie(),h=l?.injector??g??n;if(b(c)){let s=R(()=>{let d=c();w(()=>o.next(d))},{injector:h});return a.add({unsubscribe:()=>s.destroy()}),s}let m=c.subscribe(s=>o.next(s));return a.add(m),h!==n&&h.get(M).onDestroy(()=>m.unsubscribe()),{destroy:()=>m.unsubscribe()}};return i.destroy=a.unsubscribe.bind(a),i}function re(t){return!b(t)&&!C(t)}function ie(){try{return S(I)}catch{return}}var se={stores:[],isLoading:!1,selectedStore:null,error:null,logoPath:null,bannerPath:null},Ee=_({providedIn:"root"},B(se),$(({stores:t})=>({storesCount:v(()=>t().length)})),H((t,e=S(K))=>{function n(s){f(t,{isLoading:s})}function o(s){e.saveStoreLocally(s),f(t,{selectedStore:s})}function a(s){e.saveStoresLocally(s),f(t,{stores:s})}function i(){f(t,{stores:[]})}function c(){let s=e.getStoreLocally;s&&f(t,{selectedStore:s})}function l(s,d){let j=t.selectedStore();if(j){let D=j.staffs.map(y=>y._id===s?r(r({},y),d):y);f(t,{selectedStore:p(r({},j),{staffs:D})})}}function g(s){let d=t.selectedStore();d&&f(t,{selectedStore:p(r(r({},d),s),{_id:d._id})})}function h(s){f(t,{logoPath:s})}let m=Y(P(x(()=>f(t,{isLoading:!0,error:null})),O(s=>e.updateStore(t.selectedStore()._id,s).pipe(V({next(d){f(t,{isLoading:!1,error:null,logoPath:null,bannerPath:null}),g(s)},error(d){f(t,{isLoading:!1,error:d})}})))));return{setSelectedStores:a,clearStores:i,updateStore$:m,updateStore:g,updateStoreStaffs:l,setSelectedStore:o,initializeFromStorage:c,updateLogoPath:h,setLoadingState:n}}),G({onInit(t,e=S(K)){let n=e.getStoresLocally,o=e.getStoreLocally;n&&n.length>0&&f(t,{stores:n}),o&&f(t,{selectedStore:o})}}));export{Ee as a};
