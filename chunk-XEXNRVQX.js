import{a as Ze}from"./chunk-4I3AIQ7R.js";import{a as yi}from"./chunk-QGTJKOLV.js";import{a as Te}from"./chunk-AG55LGBW.js";import{a as _i}from"./chunk-MZF2CL32.js";import{a as vi}from"./chunk-LQU32KS7.js";import{b as pi,d as hi,f as fi}from"./chunk-4L4VWXIM.js";import{a as gi}from"./chunk-YZQZHEMG.js";import{d as li,e as ci,f as Ce,h as di,i as ui,j as mi,k as Re}from"./chunk-XSZYAESL.js";import"./chunk-LCNY3JPX.js";import"./chunk-MSN3EE44.js";import{a as ai}from"./chunk-HOFFRLAS.js";import{a as si}from"./chunk-OFQMF3WN.js";import{a as Jt,b as ei,c as ti,f as ii,g as ni,i as oi,l as ri}from"./chunk-T7LGKL43.js";import{a as Xt,b as qt}from"./chunk-E4PTFC5Z.js";import"./chunk-YHIOFNIN.js";import"./chunk-PYUUH7RE.js";import"./chunk-OKEXGVJ3.js";import"./chunk-O7SXWP4H.js";import{a as jt,b as Kt,c as zt,d as Yt}from"./chunk-4P4GBQE7.js";import{i as oe}from"./chunk-ZKQYDJ5W.js";import"./chunk-LCF3SYDV.js";import"./chunk-ZLVLWRZH.js";import{d as xe}from"./chunk-HJGFVW6K.js";import"./chunk-TVH27JLT.js";import"./chunk-G4CZ6LK2.js";import{a as Qe}from"./chunk-I564X6SI.js";import"./chunk-VTDH2LYT.js";import"./chunk-63HT37SK.js";import"./chunk-YJCGHVXK.js";import"./chunk-UHBDKNKX.js";import{a as Qt,b as Zt}from"./chunk-3ZLH5HUN.js";import"./chunk-O5GCTPYR.js";import"./chunk-EGLRIU4H.js";import{a as Vt}from"./chunk-5TL46KBL.js";import"./chunk-EMG7PKSI.js";import"./chunk-MNYT3JO3.js";import"./chunk-53AK2UWQ.js";import{a as Gt}from"./chunk-BFT2MTJY.js";import"./chunk-JONI64R4.js";import{b as Ht,c as je,f as Ke,h as ze,i as $t,k as Ye,o as Ut}from"./chunk-H7INH462.js";import{b as Lt}from"./chunk-OOL2KACG.js";import"./chunk-KZJMNFJ3.js";import{b as Wt,c as Se}from"./chunk-G6I3OKXX.js";import{J as We,K as F,M as Bt,_ as Me,ba as De,h as de,p as Ve,x as Ge,y as At}from"./chunk-4Z2XUZY2.js";import{e as be,g as ke}from"./chunk-F436VINI.js";import{A as Ft,g as Ot,l as Pt,n as Et,s as Nt,u as ye}from"./chunk-H22US2IH.js";import{B as ge,Ba as ft,Ca as _t,D as at,Ea as he,Fa as vt,Fc as ce,Gb as ie,H as lt,Ib as $,Ic as It,J as ct,Jb as U,Kb as Fe,Kc as He,L as dt,Lb as Ae,Mb as P,Mc as x,Nb as E,Nc as ne,Ob as A,Oc as I,Pb as a,Qb as c,Rb as K,Rc as wt,S as ut,T as mt,U as se,V as gt,Vb as St,W as T,Wb as xt,Wc as g,Ya as yt,Yb as z,Zb as Be,aa as X,ab as bt,ac as b,ba as pt,bb as u,cc as p,da as ee,f as H,fa as d,fc as Ct,hc as Rt,hd as $e,ic as Tt,jb as fe,ka as M,la as D,ld as Ue,mb as kt,mc as ve,nc as Y,oa as te,oc as Q,qb as _e,r as ot,rb as Mt,rc as l,sa as ae,sb as j,sc as _,t as rt,ta as pe,tc as q,u as st,uc as Le,vb as le,wa as y,wb as Dt,za as ht}from"./chunk-P5WOETP4.js";import{a as L,b as re,g as O}from"./chunk-GAL4ENT6.js";var Mi=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275dir=j({type:o,selectors:[["","cdkMenuGroup",""]],hostAttrs:["role","group",1,"cdk-menu-group"],exportAs:["cdkMenuGroup"],features:[ce([{provide:Qe,useClass:Qe}])]})}return o})(),et=new ee("cdk-menu"),Z=(function(o){return o[o.nextItem=0]="nextItem",o[o.previousItem=1]="previousItem",o[o.currentItem=2]="currentItem",o})(Z||{}),V=new ee("cdk-menu-stack"),Ni={provide:V,useFactory:()=>d(V,{optional:!0,skipSelf:!0})||new tt},Fi=o=>({provide:V,useFactory:()=>d(V,{optional:!0,skipSelf:!0})||tt.inline(o)}),tt=(()=>{class o{id=d(We).getId("cdk-menu-stack-");_elements=[];_close=new H;_empty=new H;_hasFocus=new H;closed=this._close;hasFocus=this._hasFocus.pipe(se(!1),lt(0),dt());emptied=this._empty;_inlineMenuOrientation=null;static inline(e){let i=new o;return i._inlineMenuOrientation=e,i}push(e){this._elements.push(e)}close(e,i){let{focusNextOnEmpty:n,focusParentTrigger:r}=L({},i);if(this._elements.indexOf(e)>=0){let s;do s=this._elements.pop(),this._close.next({item:s,focusParentTrigger:r});while(s!==e);this.isEmpty()&&this._empty.next(n)}}closeSubMenuOf(e){let i=!1;if(this._elements.indexOf(e)>=0)for(i=this.peek()!==e;this.peek()!==e;)this._close.next({item:this._elements.pop()});return i}closeAll(e){let{focusNextOnEmpty:i,focusParentTrigger:n}=L({},e);if(!this.isEmpty()){for(;!this.isEmpty();){let r=this._elements.pop();r&&this._close.next({item:r,focusParentTrigger:n})}this._empty.next(i)}}isEmpty(){return!this._elements.length}length(){return this._elements.length}peek(){return this._elements[this._elements.length-1]}hasInlineMenu(){return this._inlineMenuOrientation!=null}inlineMenuOrientation(){return this._inlineMenuOrientation}setHasFocus(e){this._hasFocus.next(e)}static \u0275fac=function(i){return new(i||o)};static \u0275prov=X({token:o,factory:o.\u0275fac})}return o})(),we=new ee("cdk-menu-trigger"),Ai=new ee("cdk-menu-scroll-strategy",{providedIn:"root",factory:()=>{let o=d(te);return()=>Ht(o)}}),Di=(()=>{class o{static _openMenuTrigger;update(e){o._openMenuTrigger!==e&&(o._openMenuTrigger?.close(),o._openMenuTrigger=e)}static \u0275fac=function(i){return new(i||o)};static \u0275prov=X({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),Si=(()=>{class o{injector=d(te);viewContainerRef=d(kt);menuStack=d(V);menuScrollStrategy=d(Ai);menuPosition;opened=new ae;closed=new ae;menuTemplateRef;menuData;overlayRef=null;destroyed=new H;stopOutsideClicksListener=ge(this.closed,this.destroyed);childMenu;_menuPortal;_childMenuInjector;ngOnDestroy(){this._destroyOverlay(),this.destroyed.next(),this.destroyed.complete()}isOpen(){return!!this.overlayRef?.hasAttached()}registerChildMenu(e){this.childMenu=e}getMenuContentPortal(){let e=this.menuTemplateRef!==this._menuPortal?.templateRef;return this.menuTemplateRef&&(!this._menuPortal||e)&&(this._menuPortal=new Lt(this.menuTemplateRef,this.viewContainerRef,this.menuData,this._getChildMenuInjector())),this._menuPortal}isElementInsideMenuStack(e){for(let i=e;i;i=i?.parentElement??null)if(i.getAttribute("data-cdk-menu-stack-id")===this.menuStack.id)return!0;return!1}_destroyOverlay(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=null)}_getChildMenuInjector(){return this._childMenuInjector=this._childMenuInjector||te.create({providers:[{provide:we,useValue:this},{provide:V,useValue:this.menuStack}],parent:this.injector}),this._childMenuInjector}static \u0275fac=function(i){return new(i||o)};static \u0275dir=j({type:o,hostVars:2,hostBindings:function(i,n){i&2&&ie("aria-controls",n.childMenu==null?null:n.childMenu.id)("data-cdk-menu-stack-id",n.menuStack.id)}})}return o})();var it=new ee("cdk-menu-aim");function xi(o,t){if(!t.isTrusted)return!1;let e=o.nativeElement,i=t.keyCode;return e.nodeName==="BUTTON"&&!e.disabled?i===13||i===32:e.nodeName==="A"?i===13:!1}var Bi=(()=>{class o extends Si{_elementRef=d(he);_ngZone=d(pe);_changeDetectorRef=d($e);_inputModalityDetector=d(Ge);_directionality=d(de,{optional:!0});_renderer=d(fe);_injector=d(te);_cleanupMouseenter;_menuTracker=d(Di);_parentMenu=d(et,{optional:!0});_menuAim=d(it,{optional:!0});constructor(){super(),this._setRole(),this._registerCloseHandler(),this._subscribeToMenuStackClosed(),this._subscribeToMouseEnter(),this._subscribeToMenuStackHasFocus(),this._setType()}toggle(){this.isOpen()?this.close():this.open()}open(){this._parentMenu||this._menuTracker.update(this),!this.isOpen()&&this.menuTemplateRef!=null&&(this.opened.next(),this.overlayRef=this.overlayRef||Ye(this._injector,this._getOverlayConfig()),this.overlayRef.attach(this.getMenuContentPortal()),this._changeDetectorRef.markForCheck(),this._subscribeToOutsideClicks())}close(){this.isOpen()&&(this.closed.next(),this.overlayRef.detach(),this._changeDetectorRef.markForCheck()),this._closeSiblingTriggers()}getMenu(){return this.childMenu}ngOnChanges(e){e.menuPosition&&this.overlayRef&&this.overlayRef.updatePositionStrategy(this._getOverlayPositionStrategy())}ngOnDestroy(){this._cleanupMouseenter(),super.ngOnDestroy()}_toggleOnKeydown(e){let i=this._parentMenu?.orientation==="vertical";switch(e.keyCode){case 32:case 13:!F(e)&&!xi(this._elementRef,e)&&(this.toggle(),this.childMenu?.focusFirstItem("keyboard"));break;case 39:F(e)||this._parentMenu&&i&&this._directionality?.value!=="rtl"&&(e.preventDefault(),this.open(),this.childMenu?.focusFirstItem("keyboard"));break;case 37:F(e)||this._parentMenu&&i&&this._directionality?.value==="rtl"&&(e.preventDefault(),this.open(),this.childMenu?.focusFirstItem("keyboard"));break;case 40:case 38:F(e)||i||(e.preventDefault(),this.open(),e.keyCode===40?this.childMenu?.focusFirstItem("keyboard"):this.childMenu?.focusLastItem("keyboard"));break}}_handleClick(){this.toggle(),this.childMenu?.focusFirstItem("mouse")}_setHasFocus(e){this._parentMenu||this.menuStack.setHasFocus(e)}_subscribeToMouseEnter(){this._cleanupMouseenter=this._ngZone.runOutsideAngular(()=>this._renderer.listen(this._elementRef.nativeElement,"mouseenter",()=>{if(this._inputModalityDetector.mostRecentModality!=="touch"&&!this.menuStack.isEmpty()&&!this.isOpen()){let e=()=>this._ngZone.run(()=>{this._closeSiblingTriggers(),this.open()});this._menuAim?this._menuAim.toggle(e):e()}}))}_closeSiblingTriggers(){this._parentMenu?!this.menuStack.closeSubMenuOf(this._parentMenu)&&this.menuStack.peek()!==this._parentMenu&&this.menuStack.closeAll():this.menuStack.closeAll()}_getOverlayConfig(){return new je({positionStrategy:this._getOverlayPositionStrategy(),scrollStrategy:this.menuScrollStrategy(),direction:this._directionality||void 0})}_getOverlayPositionStrategy(){return Ke(this._injector,this._elementRef).withLockedPosition().withFlexibleDimensions(!1).withPositions(this._getOverlayPositions())}_getOverlayPositions(){return this.menuPosition??(!this._parentMenu||this._parentMenu.orientation==="horizontal"?ze:$t)}_registerCloseHandler(){this._parentMenu||this.menuStack.closed.pipe(T(this.destroyed)).subscribe(({item:e})=>{e===this.childMenu&&this.close()})}_subscribeToOutsideClicks(){this.overlayRef&&this.overlayRef.outsidePointerEvents().pipe(T(this.stopOutsideClicksListener)).subscribe(e=>{let i=Ve(e),n=this._elementRef.nativeElement;i!==n&&!n.contains(i)&&(this.isElementInsideMenuStack(i)?this._closeSiblingTriggers():this.menuStack.closeAll())})}_subscribeToMenuStackHasFocus(){this._parentMenu||this.menuStack.hasFocus.pipe(T(this.destroyed)).subscribe(e=>{e||this.menuStack.closeAll()})}_subscribeToMenuStackClosed(){this._parentMenu||this.menuStack.closed.subscribe(({focusParentTrigger:e})=>{e&&!this.menuStack.length()&&this._elementRef.nativeElement.focus()})}_setRole(){this._parentMenu||this._elementRef.nativeElement.setAttribute("role","button")}_setType(){let e=this._elementRef.nativeElement;e.nodeName==="BUTTON"&&!e.getAttribute("type")&&e.setAttribute("type","button")}static \u0275fac=function(i){return new(i||o)};static \u0275dir=j({type:o,selectors:[["","cdkMenuTriggerFor",""]],hostAttrs:[1,"cdk-menu-trigger"],hostVars:2,hostBindings:function(i,n){i&1&&b("focusin",function(){return n._setHasFocus(!0)})("focusout",function(){return n._setHasFocus(!1)})("keydown",function(s){return n._toggleOnKeydown(s)})("click",function(){return n._handleClick()}),i&2&&ie("aria-haspopup",n.menuTemplateRef?"menu":null)("aria-expanded",n.menuTemplateRef==null?null:n.isOpen())},inputs:{menuTemplateRef:[0,"cdkMenuTriggerFor","menuTemplateRef"],menuPosition:[0,"cdkMenuPosition","menuPosition"],menuData:[0,"cdkMenuTriggerData","menuData"]},outputs:{opened:"cdkMenuOpened",closed:"cdkMenuClosed"},exportAs:["cdkMenuTriggerFor"],features:[ce([{provide:we,useExisting:o},Ni]),le,ft]})}return o})(),nt=(()=>{class o{_dir=d(de,{optional:!0});_elementRef=d(he);_ngZone=d(pe);_inputModalityDetector=d(Ge);_renderer=d(fe);_cleanupMouseEnter;_menuAim=d(it,{optional:!0});_menuStack=d(V);_parentMenu=d(et,{optional:!0});_menuTrigger=d(Bi,{optional:!0,self:!0});disabled=!1;typeaheadLabel;triggered=new ae;get hasMenu(){return this._menuTrigger?.menuTemplateRef!=null}_tabindex=-1;closeOnSpacebarTrigger=!0;destroyed=new H;constructor(){this._setupMouseEnter(),this._setType(),this._isStandaloneItem()&&(this._tabindex=0)}ngOnDestroy(){this._cleanupMouseEnter?.(),this.destroyed.next(),this.destroyed.complete()}focus(){this._elementRef.nativeElement.focus()}trigger(e){let{keepOpen:i}=L({},e);!this.disabled&&!this.hasMenu&&(this.triggered.next(),i||this._menuStack.closeAll({focusParentTrigger:!0}))}isMenuOpen(){return!!this._menuTrigger?.isOpen()}getMenu(){return this._menuTrigger?.getMenu()}getMenuTrigger(){return this._menuTrigger}getLabel(){return this.typeaheadLabel||this._elementRef.nativeElement.textContent?.trim()||""}_resetTabIndex(){this._isStandaloneItem()||(this._tabindex=-1)}_setTabIndex(e){this.disabled||(!e||!this._menuStack.isEmpty())&&(this._tabindex=0)}_handleClick(e){this.disabled?(e.preventDefault(),e.stopPropagation()):this.trigger()}_onKeydown(e){switch(e.keyCode){case 32:case 13:if(!F(e)&&!xi(this._elementRef,e)){let i=this._elementRef.nativeElement.nodeName;i!=="A"&&i!=="BUTTON"&&e.preventDefault(),this.trigger({keepOpen:e.keyCode===32&&!this.closeOnSpacebarTrigger})}break;case 39:F(e)||this._parentMenu&&this._isParentVertical()&&(this._dir?.value!=="rtl"?this._forwardArrowPressed(e):this._backArrowPressed(e));break;case 37:F(e)||this._parentMenu&&this._isParentVertical()&&(this._dir?.value!=="rtl"?this._backArrowPressed(e):this._forwardArrowPressed(e));break}}_isStandaloneItem(){return!this._parentMenu}_backArrowPressed(e){let i=this._parentMenu;(this._menuStack.hasInlineMenu()||this._menuStack.length()>1)&&(e.preventDefault(),this._menuStack.close(i,{focusNextOnEmpty:this._menuStack.inlineMenuOrientation()==="horizontal"?Z.previousItem:Z.currentItem,focusParentTrigger:!0}))}_forwardArrowPressed(e){!this.hasMenu&&this._menuStack.inlineMenuOrientation()==="horizontal"&&(e.preventDefault(),this._menuStack.closeAll({focusNextOnEmpty:Z.nextItem,focusParentTrigger:!0}))}_setupMouseEnter(){if(!this._isStandaloneItem()){let e=()=>this._ngZone.run(()=>this._menuStack.closeSubMenuOf(this._parentMenu));this._cleanupMouseEnter=this._ngZone.runOutsideAngular(()=>this._renderer.listen(this._elementRef.nativeElement,"mouseenter",()=>{this._inputModalityDetector.mostRecentModality!=="touch"&&!this._menuStack.isEmpty()&&!this.hasMenu&&(this._menuAim?this._menuAim.toggle(e):e())}))}}_isParentVertical(){return this._parentMenu?.orientation==="vertical"}_setType(){let e=this._elementRef.nativeElement;e.nodeName==="BUTTON"&&!e.getAttribute("type")&&e.setAttribute("type","button")}static \u0275fac=function(i){return new(i||o)};static \u0275dir=j({type:o,selectors:[["","cdkMenuItem",""]],hostAttrs:["role","menuitem",1,"cdk-menu-item"],hostVars:4,hostBindings:function(i,n){i&1&&b("blur",function(){return n._resetTabIndex()})("focus",function(){return n._setTabIndex()})("click",function(s){return n._handleClick(s)})("keydown",function(s){return n._onKeydown(s)}),i&2&&(Be("tabIndex",n._tabindex),ie("aria-disabled",n.disabled||null),Q("cdk-menu-item-disabled",n.disabled))},inputs:{disabled:[2,"cdkMenuItemDisabled","disabled",Ue],typeaheadLabel:[0,"cdkMenuitemTypeaheadLabel","typeaheadLabel"]},outputs:{triggered:"cdkMenuItemTriggered"},exportAs:["cdkMenuItem"]})}return o})(),Je=class{_renderer;_items;_eventCleanups;_itemsSubscription;entered=new H;exited=new H;activeElement;previousElement;constructor(t,e){this._renderer=t,this._items=e,this._bindEvents(),this.entered.subscribe(i=>this.activeElement=i),this.exited.subscribe(()=>{this.previousElement=this.activeElement,this.activeElement=void 0})}destroy(){this._cleanupEvents(),this._itemsSubscription?.unsubscribe()}_bindEvents(){this._itemsSubscription=this._items.changes.pipe(se(this._items)).subscribe(()=>{this._cleanupEvents(),this._eventCleanups=[],this._items.forEach(t=>{let e=t._elementRef.nativeElement;this._eventCleanups.push(this._renderer.listen(e,"mouseenter",()=>{this.entered.next(t)}),this._renderer.listen(e,"mouseout",()=>{this.exited.next(t)}))})})}_cleanupEvents(){this._eventCleanups?.forEach(t=>t()),this._eventCleanups=void 0}},Li=(()=>{class o extends Mi{_focusMonitor=d(At);ngZone=d(pe);_renderer=d(fe);nativeElement=d(he).nativeElement;menuStack=d(V);menuAim=d(it,{optional:!0,self:!0});dir=d(de,{optional:!0});_allItems;id=d(We).getId("cdk-menu-");items=new vt;orientation="vertical";isInline=!1;keyManager;destroyed=new H;triggerItem;pointerTracker;_menuStackHasFocus=y(!1);_tabIndexSignal=g(()=>{let e=this._menuStackHasFocus()?-1:0;return this.isInline?e:null});ngAfterContentInit(){this.isInline||this.menuStack.push(this),this._setItems(),this._setKeyManager(),this._handleFocus(),this._subscribeToMenuStackHasFocus(),this._subscribeToMenuOpen(),this._subscribeToMenuStackClosed(),this._setUpPointerTracker()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this.nativeElement),this.keyManager?.destroy(),this.destroyed.next(),this.destroyed.complete(),this.pointerTracker?.destroy()}focusFirstItem(e="program"){this.keyManager.setFocusOrigin(e),this.keyManager.setFirstItemActive()}focusLastItem(e="program"){this.keyManager.setFocusOrigin(e),this.keyManager.setLastItemActive()}setActiveMenuItem(e){this.keyManager?.setActiveItem(e)}_getTabIndex(){return this._tabIndexSignal()}closeOpenMenu(e,i){let{focusParentTrigger:n}=L({},i),r=this.keyManager,s=this.triggerItem;e===s?.getMenuTrigger()?.getMenu()&&(s?.getMenuTrigger()?.close(),n&&(s?r.setActiveItem(s):r.setFirstItemActive()))}_setItems(){this._allItems.changes.pipe(se(this._allItems),T(this.destroyed)).subscribe(e=>{this.items.reset(e.filter(i=>i._parentMenu===this)),this.items.notifyOnChanges()})}_setKeyManager(){this.keyManager=new Bt(this.items).withWrap().withTypeAhead().withHomeAndEnd().skipPredicate(()=>!1),this.orientation==="horizontal"?this.keyManager.withHorizontalOrientation(this.dir?.value||"ltr"):this.keyManager.withVerticalOrientation()}_subscribeToMenuOpen(){let e=ge(this.items.changes,this.destroyed);this.items.changes.pipe(se(this.items),rt(i=>i.filter(n=>n.hasMenu).map(n=>n.getMenuTrigger().opened.pipe(ct(n),T(e)))),st(),gt(i=>(this.triggerItem=i,i.getMenuTrigger().closed)),T(this.destroyed)).subscribe(()=>this.triggerItem=void 0)}_subscribeToMenuStackClosed(){this.menuStack.closed.pipe(T(this.destroyed)).subscribe(({item:e,focusParentTrigger:i})=>this.closeOpenMenu(e,{focusParentTrigger:i}))}_subscribeToMenuStackHasFocus(){this.isInline&&this.menuStack.hasFocus.pipe(T(this.destroyed)).subscribe(e=>{this._menuStackHasFocus.set(e)})}_setUpPointerTracker(){this.menuAim&&(this.ngZone.runOutsideAngular(()=>{this.pointerTracker=new Je(this._renderer,this.items)}),this.menuAim.initialize(this,this.pointerTracker))}_handleFocus(){this._focusMonitor.monitor(this.nativeElement,!1).pipe(T(this.destroyed)).subscribe(e=>{e!==null&&e!=="mouse"&&this.focusFirstItem(e)})}static \u0275fac=(()=>{let e;return function(n){return(e||(e=_t(o)))(n||o)}})();static \u0275dir=j({type:o,contentQueries:function(i,n,r){if(i&1&&Ct(r,nt,5),i&2){let s;Rt(s=Tt())&&(n._allItems=s)}},hostAttrs:["role","menu"],hostVars:4,hostBindings:function(i,n){i&1&&b("focusin",function(){return n.menuStack.setHasFocus(!0)})("focusout",function(){return n.menuStack.setHasFocus(!1)}),i&2&&(Be("tabIndex",n._getTabIndex())("id",n.id),ie("aria-orientation",n.orientation)("data-cdk-menu-stack-id",n.menuStack.id))},inputs:{id:"id"},features:[le]})}return o})(),Ci=(()=>{class o extends Li{_parentTrigger=d(we,{optional:!0});closed=new ae;orientation="vertical";isInline=!this._parentTrigger;constructor(){super(),this.destroyed.subscribe(this.closed),this._parentTrigger?.registerChildMenu(this)}ngAfterContentInit(){super.ngAfterContentInit(),this._subscribeToMenuStackEmptied()}ngOnDestroy(){super.ngOnDestroy(),this.closed.complete()}_handleKeyEvent(e){let i=this.keyManager;switch(e.keyCode){case 37:case 39:F(e)||(e.preventDefault(),i.setFocusOrigin("keyboard"),i.onKeydown(e));break;case 27:F(e)||(e.preventDefault(),this.menuStack.close(this,{focusNextOnEmpty:Z.currentItem,focusParentTrigger:!0}));break;case 9:F(e,"altKey","metaKey","ctrlKey")||this.menuStack.closeAll({focusParentTrigger:!0});break;default:i.onKeydown(e)}}_toggleMenuFocus(e){let i=this.keyManager;switch(e){case Z.nextItem:i.setFocusOrigin("keyboard"),i.setNextItemActive();break;case Z.previousItem:i.setFocusOrigin("keyboard"),i.setPreviousItemActive();break;case Z.currentItem:i.activeItem&&(i.setFocusOrigin("keyboard"),i.setActiveItem(i.activeItem));break}}_subscribeToMenuStackEmptied(){this.menuStack.emptied.pipe(T(this.destroyed)).subscribe(e=>this._toggleMenuFocus(e))}static \u0275fac=function(i){return new(i||o)};static \u0275dir=j({type:o,selectors:[["","cdkMenu",""]],hostAttrs:["role","menu",1,"cdk-menu"],hostVars:2,hostBindings:function(i,n){i&1&&b("keydown",function(s){return n._handleKeyEvent(s)}),i&2&&Q("cdk-menu-inline",n.isInline)},outputs:{closed:"closed"},exportAs:["cdkMenu"],features:[ce([{provide:Mi,useExisting:o},{provide:et,useExisting:o},Fi("vertical")]),le]})}return o})();var Hi=ze.map(o=>{let t=o.overlayX==="start"?2:-2,e=o.overlayY==="top"?2:-2;return re(L({},o),{offsetX:t,offsetY:e})}),Ri=(()=>{class o extends Si{_injector=d(te);_directionality=d(de,{optional:!0});_menuTracker=d(Di);_changeDetectorRef=d($e);disabled=!1;constructor(){super(),this._setMenuStackCloseListener()}open(e){this._open(null,e),this._changeDetectorRef.markForCheck()}close(){this.menuStack.closeAll()}_openOnContextMenu(e){this.disabled||(e.preventDefault(),e.stopPropagation(),this._menuTracker.update(this),this._open(e,{x:e.clientX,y:e.clientY}),e.button===2?this.childMenu?.focusFirstItem("mouse"):e.button===0?this.childMenu?.focusFirstItem("keyboard"):this.childMenu?.focusFirstItem("program"))}_getOverlayConfig(e){return new je({positionStrategy:this._getOverlayPositionStrategy(e),scrollStrategy:this.menuScrollStrategy(),direction:this._directionality||void 0})}_getOverlayPositionStrategy(e){return Ke(this._injector,e).withLockedPosition().withGrowAfterOpen().withPositions(this.menuPosition??Hi)}_setMenuStackCloseListener(){this.menuStack.closed.pipe(T(this.destroyed)).subscribe(({item:e})=>{e===this.childMenu&&this.isOpen()&&(this.closed.next(),this.overlayRef.detach(),this.childMenu=void 0,this._changeDetectorRef.markForCheck())})}_subscribeToOutsideClicks(e){if(this.overlayRef){let i=this.overlayRef.outsidePointerEvents();if(e){let[n,r]=at(i,({type:s})=>s==="auxclick");i=ge(r.pipe(mt((s,h)=>e.ctrlKey&&h===0&&s.ctrlKey)),n.pipe(ut(1)))}i.pipe(T(this.stopOutsideClicksListener)).subscribe(n=>{this.isElementInsideMenuStack(Ve(n))||this.menuStack.closeAll()})}}_open(e,i){this.disabled||(this.isOpen()?(this.menuStack.closeSubMenuOf(this.childMenu),this.overlayRef.getConfig().positionStrategy.setOrigin(i),this.overlayRef.updatePosition()):(this.opened.next(),this.overlayRef?(this.overlayRef.getConfig().positionStrategy.setOrigin(i),this.overlayRef.updatePosition()):this.overlayRef=Ye(this._injector,this._getOverlayConfig(i)),this.overlayRef.attach(this.getMenuContentPortal()),this._subscribeToOutsideClicks(e)))}static \u0275fac=function(i){return new(i||o)};static \u0275dir=j({type:o,selectors:[["","cdkContextMenuTriggerFor",""]],hostVars:1,hostBindings:function(i,n){i&1&&b("contextmenu",function(s){return n._openOnContextMenu(s)}),i&2&&ie("data-cdk-menu-stack-id",null)},inputs:{menuTemplateRef:[0,"cdkContextMenuTriggerFor","menuTemplateRef"],menuPosition:[0,"cdkContextMenuPosition","menuPosition"],menuData:[0,"cdkContextMenuTriggerData","menuData"],disabled:[2,"cdkContextMenuDisabled","disabled",Ue]},outputs:{opened:"cdkContextMenuOpened",closed:"cdkContextMenuClosed"},exportAs:["cdkContextMenuTriggerFor"],features:[ce([{provide:we,useExisting:o},{provide:V,useClass:tt}]),le]})}return o})();var Ti=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=Mt({type:o});static \u0275inj=pt({imports:[Ut]})}return o})();var Oe=class o{http=d(Ft);apiUrl=`${Gt.apiUrl}`;getHotelSettings(t){return this.http.get(`${this.apiUrl}/hotels/${t}/settings`)}updateHotelSettings(t,e){return this.http.put(`${this.apiUrl}/hotels/${t}/settings`,e)}initializeHotel(t,e){return this.http.post(`${this.apiUrl}/hotels/${t}/initialize`,e)}getDashboardStats(t){return this.http.get(`${this.apiUrl}/hotels/${t}/dashboard`)}getRoomTypes(t){return this.http.get(`${this.apiUrl}/room-types/${t}`)}createRoomType(t,e){return this.http.post(`${this.apiUrl}/room-types/${t}`,e)}updateRoomType(t,e,i){return this.http.put(`${this.apiUrl}/room-types/${t}/${e}`,i)}deleteRoomType(t,e){return this.http.delete(`${this.apiUrl}/room-types/${t}/${e}`)}getRooms(t,e){return this.http.get(`${this.apiUrl}/rooms/${t}`,{params:e})}createRoom(t,e){return this.http.post(`${this.apiUrl}/rooms/${t}`,e)}updateRoom(t,e,i){return this.http.put(`${this.apiUrl}/rooms/${t}/${e}`,i)}deleteRoom(t,e){return this.http.delete(`${this.apiUrl}/rooms/${t}/${e}`)}updateRoomStatus(t,e,i,n){return this.http.put(`${this.apiUrl}/rooms/${t}/${e}/status`,{status:i,notes:n})}getAvailableRooms(t,e,i,n){let r={checkIn:e,checkOut:i};return n&&(r.roomTypeId=n),this.http.get(`${this.apiUrl}/rooms/${t}/availability`,{params:r}).pipe(ot(s=>s.data||[]))}getGuests(t){return this.http.get(`${this.apiUrl}/guests`,{params:t})}createGuest(t){return this.http.post(`${this.apiUrl}/guests`,t)}updateGuest(t,e){return this.http.put(`${this.apiUrl}/guests/${t}`,e)}deleteGuest(t){return this.http.delete(`${this.apiUrl}/guests/${t}`)}searchGuestByPhone(t){return this.http.get(`${this.apiUrl}/guests/search/phone/${t}`)}searchGuestByEmail(t){return this.http.get(`${this.apiUrl}/guests/search/email/${t}`)}getReservations(t){return this.http.get(`${this.apiUrl}/reservations`,{params:t})}createReservation(t){return this.http.post(`${this.apiUrl}/reservations`,t)}updateReservation(t,e){return this.http.put(`${this.apiUrl}/reservations/${t}`,e)}cancelReservation(t,e,i){return this.http.put(`${this.apiUrl}/reservations/${t}/cancel`,{reason:e,refundAmount:i})}checkInReservation(t,e){return this.http.put(`${this.apiUrl}/reservations/${t}/check-in`,e||{})}checkOutReservation(t,e){return this.http.put(`${this.apiUrl}/reservations/${t}/check-out`,e||{})}getReservationCalendar(t,e,i){return this.http.get(`${this.apiUrl}/reservations/calendar/${t}`,{params:{start:e,end:i}})}checkReservationConflicts(t,e,i,n,r){let s={storeId:t,roomId:e,checkIn:i,checkOut:n};return r&&(s.excludeReservationId=r),this.http.get(`${this.apiUrl}/reservations/conflicts/check`,{params:s})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=X({token:o,factory:o.\u0275fac,providedIn:"root"})};var Pe=class o{hotelService=d(Oe);storeStore=d(oe);_hotelSettings=y(null);_hotelSettingsLoading=y(!1);_roomTypes=y([]);_roomTypesLoading=y(!1);_rooms=y([]);_roomsLoading=y(!1);_roomsTotal=y(0);_guests=y([]);_guestsLoading=y(!1);_guestsTotal=y(0);_reservations=y([]);_reservationsLoading=y(!1);_reservationsTotal=y(0);_dashboardStats=y(null);_dashboardStatsLoading=y(!1);hotelSettings=this._hotelSettings.asReadonly();hotelSettingsLoading=this._hotelSettingsLoading.asReadonly();roomTypes=this._roomTypes.asReadonly();roomTypesLoading=this._roomTypesLoading.asReadonly();rooms=this._rooms.asReadonly();roomsLoading=this._roomsLoading.asReadonly();roomsTotal=this._roomsTotal.asReadonly();guests=this._guests.asReadonly();guestsLoading=this._guestsLoading.asReadonly();guestsTotal=this._guestsTotal.asReadonly();reservations=this._reservations.asReadonly();reservationsLoading=this._reservationsLoading.asReadonly();reservationsTotal=this._reservationsTotal.asReadonly();dashboardStats=this._dashboardStats.asReadonly();dashboardStatsLoading=this._dashboardStatsLoading.asReadonly();availableRooms=g(()=>this.rooms().filter(t=>t.status==="available"));occupiedRooms=g(()=>this.rooms().filter(t=>t.status==="occupied"));maintenanceRooms=g(()=>this.rooms().filter(t=>t.status==="maintenance"||t.status==="out_of_order"));todayReservations=g(()=>{let t=new Date().toDateString();return this.reservations().filter(e=>new Date(e.checkInDate).toDateString()===t)});loadHotelSettings(){return O(this,null,function*(){let t=this.storeStore.selectedStore()?._id;if(t){this._hotelSettingsLoading.set(!0);try{let e=yield this.hotelService.getHotelSettings(t).toPromise();this._hotelSettings.set(e||null)}catch(e){console.error("Error loading hotel settings:",e),this._hotelSettings.set(null)}finally{this._hotelSettingsLoading.set(!1)}}})}updateHotelSettings(t){return O(this,null,function*(){let e=this.storeStore.selectedStore()?._id;if(e){this._hotelSettingsLoading.set(!0);try{let i=yield this.hotelService.updateHotelSettings(e,t).toPromise();return this._hotelSettings.set(i||null),i}catch(i){throw console.error("Error updating hotel settings:",i),i}finally{this._hotelSettingsLoading.set(!1)}}})}loadRoomTypes(){return O(this,null,function*(){let t=this.storeStore.selectedStore()?._id;if(t){this._roomTypesLoading.set(!0);try{let e=yield this.hotelService.getRoomTypes(t).toPromise();this._roomTypes.set(e||[])}catch(e){console.error("Error loading room types:",e),this._roomTypes.set([])}finally{this._roomTypesLoading.set(!1)}}})}createRoomType(t){return O(this,null,function*(){let e=this.storeStore.selectedStore()?._id;if(e)try{let i=yield this.hotelService.createRoomType(e,t).toPromise();return i&&this._roomTypes.update(n=>[...n,i]),i}catch(i){throw console.error("Error creating room type:",i),i}})}loadRooms(t){return O(this,null,function*(){let e=this.storeStore.selectedStore()?._id;if(e){this._roomsLoading.set(!0);try{let i=yield this.hotelService.getRooms(e,t).toPromise();this._rooms.set(i?.rooms||[]),this._roomsTotal.set(i?.total||0)}catch(i){console.error("Error loading rooms:",i),this._rooms.set([]),this._roomsTotal.set(0)}finally{this._roomsLoading.set(!1)}}})}updateRoomStatus(t,e,i){return O(this,null,function*(){let n=this.storeStore.selectedStore()?._id;if(n)try{let r=yield this.hotelService.updateRoomStatus(n,t,e,i).toPromise();return r&&this._rooms.update(s=>s.map(h=>h._id===t?r:h)),r}catch(r){throw console.error("Error updating room status:",r),r}})}loadGuests(t){return O(this,null,function*(){this._guestsLoading.set(!0);try{let e=yield this.hotelService.getGuests(t).toPromise();this._guests.set(e?.guests||[]),this._guestsTotal.set(e?.total||0)}catch(e){console.error("Error loading guests:",e),this._guests.set([]),this._guestsTotal.set(0)}finally{this._guestsLoading.set(!1)}})}loadReservations(t){return O(this,null,function*(){this._reservationsLoading.set(!0);try{let e=yield this.hotelService.getReservations(t).toPromise();this._reservations.set(e?.reservations||[]),this._reservationsTotal.set(e?.total||0)}catch(e){console.error("Error loading reservations:",e),this._reservations.set([]),this._reservationsTotal.set(0)}finally{this._reservationsLoading.set(!1)}})}loadDashboardStats(){return O(this,null,function*(){let t=this.storeStore.selectedStore()?._id;if(t){this._dashboardStatsLoading.set(!0);try{let e=yield this.hotelService.getDashboardStats(t).toPromise();this._dashboardStats.set(e)}catch(e){console.error("Error loading dashboard stats:",e),this._dashboardStats.set(null)}finally{this._dashboardStatsLoading.set(!1)}}})}reset(){this._hotelSettings.set(null),this._roomTypes.set([]),this._rooms.set([]),this._guests.set([]),this._reservations.set([]),this._dashboardStats.set(null)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=X({token:o,factory:o.\u0275fac,providedIn:"root"})};var Wi=(o,t)=>(t==null?null:t.booking_room_id)||(t==null?null:t.room_type_id)||o;function ji(o,t){if(o&1&&(a(0,"mat-list-item")(1,"span",9),l(2),c(),a(3,"span",4),l(4),x(5,"currency"),c(),a(6,"span",10),l(7),x(8,"date"),x(9,"date"),c()()),o&2){let e=t.$implicit,i=t.$index,n=p(2);u(2),_(n.getOtaRoomTypeName(e,i)),u(2),_(I(5,4,n.getOtaRoomPrice(e),n.bookingCurrency())),u(3),Le(" ",I(8,7,n.getOtaRoomCheckIn(e),"dd/MM/yyyy")," \u2192 ",I(9,10,n.getOtaRoomCheckOut(e),"dd/MM/yyyy")," ")}}function Ki(o,t){if(o&1&&P(0,ji,10,13,"mat-list-item",null,Wi),o&2){let e=p();E(e.otaRooms())}}function zi(o,t){if(o&1&&(a(0,"mat-list-item"),l(1," Room "),a(2,"span",4),l(3),c()(),a(4,"mat-list-item"),l(5," Price "),a(6,"span",4),l(7),x(8,"currency"),c()(),a(9,"mat-list-item"),l(10," Dates "),a(11,"span",4),l(12),x(13,"date"),x(14,"date"),c()()),o&2){let e=p();u(3),_(e.roomTypeName()),u(4),q(" ",I(8,4,e.hasRoomAssignment()?e.roomTotal():e.bookingAmount(),e.bookingCurrency())," "),u(5),Le(" ",I(13,7,e.roomCheckIn(),"dd/MM/yyyy")," \u2192 ",I(14,10,e.roomCheckOut(),"dd/MM/yyyy")," ")}}function Yi(o,t){if(o&1&&(a(0,"mat-list-item"),l(1," Room Total "),a(2,"span",4),l(3),x(4,"currency"),c()()),o&2){let e=p();u(3),_(I(4,1,e.roomTotal(),e.bookingCurrency()))}}var Ee=class o{dialogRef=d(li);data=d(ci);dialog=d(Ce);guestService=d(_i);reservationService=d(Te);snackBar=d(Vt);storeStore=d(oe);hotelStore=d(Pe);router=d(ke);route=d(be);reservation=y(this.data.reservation);roomTypesLoader=ht(()=>{this.hotelStore.roomTypes().length===0&&this.hotelStore.loadRoomTypes()});roomAssignment=g(()=>{let t=this.reservation()?.rooms||[];return this.data.room?.id&&t.find(e=>e?.room?._id===this.data.room?.id)||t[0]});hasRoomAssignment=g(()=>(this.reservation()?.rooms||[]).some(e=>e?.room?._id));isOtaUnassigned=g(()=>{let t=this.reservation(),e=t?.rooms||[];return t?.channex?.bookingId?e.length?e.every(i=>!i?.room?._id):!0:!1});assignedGuest=g(()=>this.roomAssignment()?.assignedGuest||this.reservation()?.guest);guestName=g(()=>{let t=this.assignedGuest();return this.guestService.getGuestName(t)});openReservation(){this.close();let e=this.reservation()?.channex?.bookingId;if(e&&this.isOtaUnassigned()){this.router.navigate(["/menu","hms","channel-management","live-booking",e,"details"]);return}this.router.navigate(["/menu","hms","front-desk","reservations","edit",this.reservation()?._id])}roomCheckIn=g(()=>this.roomAssignment()?.stayPeriod?.from||this.reservation()?.checkInDate);roomCheckOut=g(()=>this.roomAssignment()?.stayPeriod?.to||this.reservation()?.checkOutDate);roomTypeName=g(()=>{let t=this.roomAssignment(),e=t?.room?.roomType||t?.roomType;return typeof e=="object"&&e?.name?e.name:typeof e=="string"||this.isOtaUnassigned()?"Unassigned":"\u2014"});roomNumber=g(()=>this.roomAssignment()?.room?.roomNumber||(this.isOtaUnassigned()?"Unassigned":"\u2014"));roomName=g(()=>this.roomAssignment()?.room?.name||(this.isOtaUnassigned()?"Unassigned":"\u2014"));getChannexBookingPayload(){let t=this.reservation()?.channex?.rawWebhookData;return t?t?.data||t:null}otaRooms=g(()=>{let t=this.getChannexBookingPayload(),i=(t?.attributes||t?.data?.attributes||t)?.rooms||t?.rooms||[];return Array.isArray(i)?i:[]});otaRoomTypes=g(()=>{let t=this.getChannexBookingPayload(),i=(t?.relationships||t?.data?.relationships||t)?.room_types?.data||t?.room_types||[];return Array.isArray(i)?i:[i]});roomTypesById=g(()=>{let t=this.hotelStore.roomTypes(),e=new Map;for(let i of t||[])i?._id&&e.set(i._id,i.name||"Room");return e});getOtaRoomTypeName(t,e){let i=this.reservation()?.rooms?.[e]?.roomType,n=i?this.roomTypesById().get(i):void 0;if(n)return n;let r=t?.room_type_id||t?.room_type?.id||t?.room_type?.room_type_id;if(!r)return"Room";let h=this.otaRoomTypes().find(f=>(f?.id||f?.attributes?.id)===r);return h?.attributes?.title||h?.attributes?.name||"Room"}getOtaRoomPrice(t){let e=t?.amount??t?.total_price??t?.price??t?.rate??0,i=Number(e);return Number.isNaN(i)?0:i}getOtaRoomCheckIn(t){return t?.checkin_date||t?.check_in||t?.arrival_date||this.reservation()?.checkInDate}getOtaRoomCheckOut(t){return t?.checkout_date||t?.check_out||t?.departure_date||this.reservation()?.checkOutDate}getRoomTypeLabel(t){let e=t?.room?.roomType||t?.roomType;return typeof e=="object"&&e?.name?e.name:typeof e=="string"&&e.length>0?e:this.isOtaUnassigned()?"Unassigned":"\u2014"}getRoomPrice(t){let e=t?.pricing?.total??t?.pricing?.amount??t?.pricing?.price??t?.total??0,i=Number(e);return Number.isNaN(i)?0:i}getRoomCheckIn(t){return t?.stayPeriod?.from||this.reservation()?.checkInDate}getRoomCheckOut(t){return t?.stayPeriod?.to||this.reservation()?.checkOutDate}roomGuestsCount=g(()=>{let e=this.roomAssignment()?.guests||{},i=Number(e.adults||0),n=Number(e.children||0);return i+n||1});roomTotal=g(()=>this.roomAssignment()?.pricing?.total||0);amountPaid=g(()=>this.reservation()?.pricing?.paid||0);bookingCurrency=g(()=>this.reservation()?.channex?.rawWebhookData?.attributes?.currency||this.storeStore.selectedStore()?.currency||"USD");bookingAmount=g(()=>{let t=this.reservation(),e=t?.channex?.rawWebhookData?.attributes?.amount,i=e?Number(e):void 0;return typeof i=="number"&&!Number.isNaN(i)?i:t?.pricing?.total||0});bookingBalance=g(()=>Math.max(0,this.bookingAmount()-this.amountPaid()));balanceAmount=g(()=>Math.max(0,this.roomTotal()-this.amountPaid()));bookingTotal=g(()=>this.reservation()?.pricing?.total||0);bookingSource=g(()=>this.reservation()?.bookingSource||"\u2014");reservationType=g(()=>this.reservation()?.bookingType||this.reservation()?.reservationType||"\u2014");confirmationNumber=g(()=>this.reservation()?.confirmationNumber||this.reservation()?._id||"\u2014");paymentMethod=g(()=>this.reservation()?.paymentInfo?.method||"\u2014");canChangeRooms=g(()=>{let t=this.reservation()?.status;return t&&!["checked_out","cancelled","no_show"].includes(t)});openRoomChangeDialog(){let t=this.reservation();if(!t||!this.canChangeRooms()){this.snackBar.open("Cannot change rooms for this reservation","Close",{duration:3e3});return}this.dialog.open(yi,{width:"500px",maxWidth:"95vw",disableClose:!0,data:{reservationId:t._id,currentRooms:t.rooms,checkInDate:new Date(t.checkInDate).toISOString(),checkOutDate:new Date(t.checkOutDate).toISOString(),numberOfNights:t.numberOfNights,currency:this.storeStore.selectedStore()?.currency||"USD",actualCheckInDate:t.actualCheckInDate?new Date(t.actualCheckInDate).toISOString():void 0,reservationStatus:t.status}}).afterClosed().subscribe(i=>O(this,null,function*(){if(i)try{let n=yield this.reservationService.changeRooms(t._id,i).toPromise();n?.success&&(this.snackBar.open("Room changed successfully","Close",{duration:3e3}),this.reservation.set(n.data))}catch(n){console.error("Error changing rooms:",n);let r=n?.error?.error||n?.error?.message||n?.message||"Failed to change rooms";this.snackBar.open(r,"Close",{duration:5e3})}}))}close(){this.dialogRef.close()}statusLabel=g(()=>(this.reservation()?.status||"reserved").replace("_"," "));statusClass=g(()=>{let t=this.reservation()?.status||"reserved";return{pending:"bg-yellow-100 text-yellow-800 border border-yellow-200",confirmed:"bg-blue-100 text-blue-800 border border-blue-200",checked_in:"bg-green-100 text-green-800 border border-green-200",checked_out:"bg-gray-100 text-gray-800 border border-gray-200",cancelled:"bg-red-100 text-red-800 border border-red-200",no_show:"bg-orange-100 text-orange-800 border border-orange-200",reserved:"bg-indigo-100 text-indigo-800 border border-indigo-200"}[t]||"bg-gray-100 text-gray-800 border border-gray-200"});static \u0275fac=function(e){return new(e||o)};static \u0275cmp=_e({type:o,selectors:[["app-reservation-preview-dialog"]],decls:62,vars:28,consts:[["mat-dialog-title","",1,"flex","items-center","justify-between"],["color","primary",1,"capitalize"],[1,"capitalize"],["mat-subheader",""],["matListItemMeta",""],["matListItemMeta","",1,"capitalize"],["matListItemMeta","",1,"font-semibold"],["align","end",1,"gap-2"],["matButton","outlined",3,"click"],["matListItemTitle",""],["matListItemLine",""]],template:function(e,i){e&1&&(a(0,"h2",0),l(1),c(),a(2,"mat-dialog-content")(3,"mat-chip-set")(4,"mat-chip",1),l(5),c(),a(6,"mat-chip",2),l(7),c(),a(8,"mat-chip"),l(9),c()(),a(10,"mat-list")(11,"div",3),l(12,"Stay"),c(),a(13,"mat-list-item"),l(14," Check-in "),a(15,"span",4),l(16),x(17,"date"),c()(),a(18,"mat-list-item"),l(19," Check-out "),a(20,"span",4),l(21),x(22,"date"),c()(),a(23,"mat-list-item"),l(24," Source "),a(25,"span",5),l(26),c()()(),K(27,"mat-divider"),a(28,"mat-list")(29,"div",3),l(30,"Room"),c(),$(31,Ki,2,0)(32,zi,15,13),c(),K(33,"mat-divider"),a(34,"mat-list")(35,"div",3),l(36,"Payment"),c(),a(37,"mat-list-item"),l(38," Payment Mode "),a(39,"span",5),l(40),c()(),$(41,Yi,5,4,"mat-list-item"),a(42,"mat-list-item"),l(43," Booking Total "),a(44,"span",6),l(45),x(46,"currency"),c()(),a(47,"mat-list-item"),l(48," Amount Paid "),a(49,"span",4),l(50),x(51,"currency"),c()(),a(52,"mat-list-item"),l(53," Balance "),a(54,"span",4),l(55),x(56,"currency"),c()()()(),a(57,"mat-dialog-actions",7)(58,"button",8),b("click",function(){return i.openReservation()}),l(59,"View"),c(),a(60,"button",8),b("click",function(){return i.close()}),l(61,"Close"),c()()),e&2&&(u(),q(" ",i.guestName(),`
`),u(4),_(i.statusLabel()),u(2),_(i.reservationType()),u(2),_(i.confirmationNumber()),u(7),_(I(17,13,i.roomCheckIn(),"dd/MM/yyyy")),u(5),_(I(22,16,i.roomCheckOut(),"dd/MM/yyyy")),u(5),_(i.bookingSource()),u(5),U(i.isOtaUnassigned()&&i.otaRooms().length?31:32),u(9),_(i.paymentMethod()),u(),U(i.hasRoomAssignment()?41:-1),u(4),_(I(46,19,i.bookingAmount(),i.bookingCurrency())),u(5),_(I(51,22,i.amountPaid(),i.bookingCurrency())),u(5),_(I(56,25,i.bookingBalance(),i.bookingCurrency())))},dependencies:[ye,Re,di,mi,ui,Se,De,Me,qt,Xt,fi,pi,hi,ri,ii,ni,oi,ei,Jt,ti,Nt,Et],encapsulation:2})};var Qi=(o,t)=>({roomId:o,currentStatus:t}),Zi=(o,t,e,i)=>({"bg-green-100 border-l-green-500":o,"bg-amber-100 border-l-amber-500":t,"bg-blue-100 border-l-blue-500":e,"bg-red-100 border-l-red-500":i}),Xi=(o,t,e,i)=>({"text-green-600":o,"text-amber-600":t,"text-blue-600":e,"text-red-600":i}),ue=(o,t)=>t.key;function qi(o,t){if(o&1){let e=z();a(0,"button",22),b("click",function(){let n=M(e).$implicit,r=p();return D(r.onStatusChange(n))}),l(1),x(2,"titlecase"),c()}if(o&2){let e=t.$implicit;u(),_(ne(2,1,e))}}function Ji(o,t){o&1&&(a(0,"div",26),K(1,"mat-progress-spinner",39),c())}function en(o,t){if(o&1){let e=z();a(0,"div",40),b("mouseenter",function(){let n=M(e).$implicit,r=p();return D(r.hoveredDateKey.set(n.key))})("mouseleave",function(){M(e);let n=p();return D(n.hoveredDateKey.set(null))}),a(1,"p",41),l(2),c(),a(3,"p",42),l(4),c()()}if(o&2){let e=t.$implicit,i=p();Y("width",i.cellWidthPx(),"px"),Q("bg-blue-50",i.hoveredDateKey()===e.key),u(2),_(e.dayName),u(2),_(e.day)}}function tn(o,t){if(o&1){let e=z();a(0,"div",48),b("mouseenter",function(){let n=M(e).$implicit,r=p(3);return D(r.hoveredDateKey.set(n.key))})("mouseleave",function(){M(e);let n=p(3);return D(n.hoveredDateKey.set(null))}),c()}if(o&2){let e=t.$implicit,i=p(3);Y("width",i.cellWidthPx(),"px"),Q("bg-blue-100",i.hoveredDateKey()===e.key)}}function nn(o,t){if(o&1&&(a(0,"div",43)(1,"div",45)(2,"span",46),l(3),c()(),a(4,"div",32),P(5,tn,1,4,"div",47,ue),c()()),o&2){let e=p().$implicit,i=p();u(3),_(e.roomTypeName),u(),Y("width",i.dateRange().length*i.cellWidthPx(),"px"),u(),E(i.dateRange())}}function on(o,t){if(o&1&&K(0,"img",59),o&2){let e=p(2).$implicit,i=p(4);A("src",i.getBookingSourceLogoUrl(e),yt)("alt",i.getBookingSourceLabel(e))}}function rn(o,t){o&1&&(a(0,"mat-icon",60),l(1,"directions_walk"),c())}function sn(o,t){if(o&1){let e=z();a(0,"div",53),b("click",function(n){M(e);let r=p().$implicit,s=p(3).$implicit;return p().openReservationPreview(r.reservation,s),D(n.stopPropagation())})("mousedown",function(n){return M(e),D(n.stopPropagation())}),a(1,"div",54)(2,"div",55)(3,"span",56),l(4),c(),a(5,"span",57),l(6),c()(),a(7,"div",58),$(8,on,1,2,"img",59)(9,rn,2,0,"mat-icon",60),c()()()}if(o&2){let e=p().$implicit,i=p().$implicit,n=p(2).$implicit,r=p();Y("background-color",r.getBookingSourceColor(e))("top",r.getReservationTopPercent(n.reservations,i,e),"%")("height",r.getReservationHeightPercent(n.reservations,i),"%")("width",r.getReservationWidth(e,i),"px"),A("matTooltip",r.getReservationTooltip(e,n.roomName)),u(4),_(r.getReservationNightsLabel(e)),u(2),_(r.getReservationBlockLabel(e)),u(2),U(r.getBookingSourceLogoUrl(e)?8:9)}}function an(o,t){if(o&1&&$(0,sn,10,12,"div",52),o&2){let e=t.$implicit,i=p().$implicit,n=p(3);U(n.shouldRenderReservationFromDate(e,i)?0:-1)}}function ln(o,t){if(o&1){let e=z();a(0,"div",51),b("mousedown",function(n){let r=M(e).$implicit,s=p(2).$implicit,h=p();return D(h.onCellMouseDown(n,r,s))})("mouseenter",function(){let n=M(e).$implicit,r=p(2).$implicit,s=p();return s.onCellMouseEnter(n,r),D(s.hoveredDateKey.set(n.key))})("mouseleave",function(){M(e);let n=p(3);return D(n.hoveredDateKey.set(null))})("mouseup",function(){M(e);let n=p(3);return D(n.onCellMouseUp())}),P(1,an,1,1,null,null,Fe),c()}if(o&2){let e=t.$implicit,i=p(2).$implicit,n=p();Y("width",n.cellWidthPx(),"px"),Q("bg-blue-50",n.hoveredDateKey()===e.key&&!n.isCellInSelection(e,i))("bg-blue-100",n.isCellInSelection(e,i)&&!n.dragSelection().hasConflict)("bg-red-100",n.isCellInSelection(e,i)&&n.dragSelection().hasConflict)("cursor-pointer",!n.hasReservationOnDate(i.roomId,e.date))("cursor-not-allowed",n.hasReservationOnDate(i.roomId,e.date)),u(),E(i.reservations)}}function cn(o,t){if(o&1&&(a(0,"div",44)(1,"div",49),x(2,"titlecase"),a(3,"span"),l(4),c()(),a(5,"div",32),P(6,ln,3,12,"div",50,ue),c()()),o&2){let e=p().$implicit,i=p(),n=ve(114);u(),A("ngClass",i.getHousekeepingStatusClass(e.housekeepingStatus))("matTooltip","Housekeeping: "+ne(2,7,e.housekeepingStatus)+" (Right-click to change)")("cdkContextMenuTriggerFor",n)("cdkContextMenuTriggerData",It(9,Qi,e.roomId,e.housekeepingStatus)),u(3),_(e.roomName),u(),Y("width",i.dateRange().length*i.cellWidthPx(),"px"),u(),E(i.dateRange())}}function dn(o,t){if(o&1&&$(0,nn,7,3,"div",43)(1,cn,8,12,"div",44),o&2){let e=t.$implicit;U(e.isGroup?0:1)}}function un(o,t){if(o&1&&(a(0,"div",38),K(1,"span",61),a(2,"span",62),l(3),c()()),o&2){let e=t.$implicit;u(),A("ngClass",He(2,Zi,e.key==="clean",e.key==="dirty",e.key==="inspected",e.key==="out_of_order")),u(2),_(e.label)}}function mn(o,t){if(o&1&&(a(0,"div",38),K(1,"span",63),a(2,"span",62),l(3),x(4,"titlecase"),c()()),o&2){let e=t.$implicit,i=p();u(),A("ngClass",i.getStatusColorClass(e)),u(2),_(ne(4,2,e))}}function gn(o,t){o&1&&(a(0,"mat-icon",70),l(1,"check"),c())}function pn(o,t){if(o&1){let e=z();a(0,"button",68),b("cdkMenuItemTriggered",function(){let n=M(e).$implicit,r=p().roomId,s=p();return D(s.updateHousekeepingStatus(r,n.key))}),a(1,"mat-icon",69),l(2),c(),a(3,"span"),l(4),c(),$(5,gn,2,0,"mat-icon",70),c()}if(o&2){let e=t.$implicit,i=p().currentStatus,n=p();Q("bg-gray-50",i===e.key)("font-semibold",i===e.key),u(),A("ngClass",He(8,Xi,e.key==="clean",e.key==="dirty",e.key==="inspected",e.key==="out_of_order")),u(),_(n.getHousekeepingStatusIcon(e.key)),u(2),_(e.label),u(),U(i===e.key?5:-1)}}function hn(o,t){if(o&1&&(a(0,"div",64)(1,"div",65)(2,"span",66),l(3,"Update Housekeeping Status"),c()(),P(4,pn,6,13,"button",67,ue),c()),o&2){let e=p();u(4),E(e.housekeepingStatuses)}}var Ii=class o{storeStore=d(oe);reservationService=d(Te);roomService=d(vi);router=d(ke);route=d(be);dialog=d(Ce);viewMode=y("monthly");startDate=y(new Date);selectedStatus=y("all");excludedStatuses=y(new Set(["checked_out","cancelled","no_show"]));dragSelection=y({isSelecting:!1,startDate:null,endDate:null,roomId:null,roomName:null,roomTypeId:null,roomTypeName:null,hasConflict:!1});hoveredDateKey=y(null);reservationStatuses=["pending","confirmed","checked_in","checked_out","cancelled","no_show","reserved"];housekeepingStatuses=[{key:"clean",label:"Clean"},{key:"dirty",label:"Dirty"},{key:"inspected",label:"Inspected"},{key:"out_of_order",label:"Out of Order"}];statusColorMap={pending:"bg-yellow-500",confirmed:"bg-blue-600",checked_in:"bg-green-600",checked_out:"bg-gray-500",cancelled:"bg-red-600",no_show:"bg-orange-600",reserved:"bg-indigo-600"};dateRange=g(()=>{let t=[],e=this.viewMode(),i=this.alignStartOfPeriod(this.startDate(),e);if(e==="weekly")for(let n=0;n<7;n++){let r=new Date(i);r.setDate(r.getDate()+n),t.push({key:r.toISOString().slice(0,10),day:r.getDate(),dayName:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][r.getDay()],date:new Date(r)})}else{let n=i.getFullYear(),r=i.getMonth(),s=new Date(n,r+1,0).getDate();for(let h=0;h<s;h++){let f=new Date(n,r,h+1);t.push({key:f.toISOString().slice(0,10),day:f.getDate(),dayName:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][f.getDay()],date:new Date(f)})}}return t});rooms=xe({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:t})=>this.roomService.getRooms(t.storeId)});reservations=xe({params:()=>{let t=this.storeStore.selectedStore()?._id,e=this.viewMode(),i=this.alignStartOfPeriod(this.startDate(),e),{dateFrom:n,dateTo:r}=this.getPeriodDateRangeStrings(i,e),s=this.selectedStatus();return{storeId:t,dateFrom:n,dateTo:r,status:s==="all"?void 0:s}},stream:({params:t})=>this.reservationService.getReservations({storeId:t.storeId,dateFrom:t.dateFrom,dateTo:t.dateTo,status:t.status})});roomTypes=xe({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:t})=>this.roomService.getRoomTypes(t.storeId)});roomsWithReservations=g(()=>{let t=this.rooms.value()||[],e=this.roomTypes.value()||[],i=this.reservations.value(),n=Array.isArray(i)?i:i?.reservations||[],r=this.excludedStatuses(),s=n.filter(m=>this.selectedStatus()!=="all"?m.status===this.selectedStatus():!r.has(m.status)),h=s.filter(m=>!m.rooms||m.rooms.length===0?!1:m.rooms.some(v=>v?.room?._id)),f=s.filter(m=>m.channex?.bookingId?!m.rooms||m.rooms.length===0?!0:m.rooms.every(v=>!v?.room?._id):!1),C=new Map;for(let m of e)m&&m._id&&C.set(m._id,m.name||"Room");let N=new Map;for(let m of t){let v,R="Room";typeof m.roomType=="string"?(v=m.roomType,R=C.get(m.roomType)||m.roomType):m.roomType&&(v=m.roomType._id,R=m.roomType.name||"Room");let S=v||R;N.has(S)||N.set(S,{typeName:R,rooms:[]}),N.get(S).rooms.push(m)}let G=[];for(let m of e)m&&m._id&&N.has(m._id)&&G.push(m._id);for(let m of N.keys())G.includes(m)||G.push(m);let w=new Map;if(f.length>0)for(let m of f){let v=m.rooms||[];if(v.length>0)for(let R of v){let S=typeof R.roomType=="string"?R.roomType:R.roomType?._id,J=C.get(S)||"Unknown Room Type",k=`${S}`;w.has(k)||w.set(k,[]),w.get(k).findIndex(W=>W._id===m._id)===-1&&w.get(k).push(re(L({},m),{_requiredRoomTypeName:J,_requiredRoomTypeId:S}))}else w.has("unknown-ota")||w.set("unknown-ota",[]),w.get("unknown-ota").push(m)}let B=[];for(let m of G){let v=N.get(m);if(!v)continue;B.push({isGroup:!0,roomTypeName:v.typeName});for(let S of v.rooms){let J=[];for(let k of h){if(!k?.rooms)continue;let Ne=k.rooms.filter(W=>W?.room?._id===S._id);if(Ne?.length)for(let W of Ne){let wi=W?.stayPeriod?.from||k.checkInDate,Oi=W?.stayPeriod?.to||k.checkOutDate,Pi=W?.assignedGuest||k.guest;J.push({reservationId:k._id,roomAssignmentId:W?._id,checkInDate:wi,checkOutDate:Oi,guest:Pi,status:k.status,bookingType:k.bookingType,confirmationNumber:k.confirmationNumber,reservation:k})}}B.push({isGroup:!1,roomId:S._id,roomName:`${S.name} ${S.roomNumber??""}`,roomTypeId:typeof S.roomType=="string"?S.roomType:S.roomType?._id,roomTypeName:v.typeName,capacity:S.capacity||2,housekeepingStatus:S.housekeepingStatus||"clean",reservations:J})}let R=w.get(m);if(R&&R.length>0){let S=R[0]._requiredRoomTypeName||"Unknown Room Type",J=R.map(k=>({reservationId:k._id,roomAssignmentId:void 0,checkInDate:k.checkInDate,checkOutDate:k.checkOutDate,guest:k.guest,status:k.status,bookingType:k.bookingType,confirmationNumber:k.confirmationNumber,reservation:k}));B.push({isGroup:!1,roomId:`unassigned-ota-${m}`,roomName:`OTA Unassigned - ${S}`,roomTypeId:m!=="unknown-ota"?m:null,roomTypeName:`OTA - ${S}`,capacity:0,housekeepingStatus:"clean",isOTAUnassigned:!0,reservations:J})}}let me=w.get("unknown-ota");if(me&&me.length>0){B.push({isGroup:!0,roomTypeName:"OTA - Unassigned"});let m=me.map(v=>({reservationId:v._id,roomAssignmentId:void 0,checkInDate:v.checkInDate,checkOutDate:v.checkOutDate,guest:v.guest,status:v.status,bookingType:v.bookingType,confirmationNumber:v.confirmationNumber,reservation:v}));B.push({isGroup:!1,roomId:"unassigned-ota-unknown",roomName:"OTA Unassigned",roomTypeId:null,roomTypeName:"OTA - Unassigned",capacity:0,housekeepingStatus:"clean",isOTAUnassigned:!0,reservations:m})}return B});confirmedCount=g(()=>this.reservations.value()?.reservations.filter(t=>t.status==="confirmed").length);checkedInCount=g(()=>this.reservations.value()?.reservations.filter(t=>t.status==="checked_in").length);pendingCount=g(()=>this.reservations.value()?.reservations.filter(t=>t.status==="pending").length);cancelledCount=g(()=>this.reservations.value()?.reservations.filter(t=>t.status==="cancelled").length);totalRevenue=g(()=>this.reservations.value()?.reservations.reduce((t,e)=>t+this.getEffectiveTotal(e),0));getEffectiveTotal(t){return t.pricing?.total||0}ngOnInit(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.startDate.set(e)}reloadData(){this.reservations.reload()}clearFilters(){this.viewMode.set("monthly"),this.selectedStatus.set("all");let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);this.startDate.set(e)}createReservation(){this.dialog.open(Ze,{width:"600px",disableClose:!1}).afterClosed().subscribe(e=>{e&&this.router.navigate(["../create"],{relativeTo:this.route.parent,queryParams:{quickReservation:JSON.stringify(e)}})})}getPeriodLabel(){let t=this.viewMode(),e=this.alignStartOfPeriod(this.startDate(),t),i=new Date(e);t==="weekly"?i.setDate(i.getDate()+6):(i=new Date(e.getFullYear(),e.getMonth()+1,0),i.setHours(0,0,0,0));let n=new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric"});return`${n.format(e)} \u2013 ${n.format(i)}`}isReservationOnDate(t,e){let i=new Date(t.checkInDate),n=new Date(t.checkOutDate);i.setHours(0,0,0,0),n.setHours(0,0,0,0);let r=new Date(e.date);return r.setHours(0,0,0,0),r>=i&&r<n}isReservationStartingOnDate(t,e){let i=this.parseDateOnly(t.checkInDate);return this.parseDateOnly(e.date).getTime()===i.getTime()}shouldRenderReservationFromDate(t,e){let i=this.parseDateOnly(t.checkInDate),n=this.parseDateOnly(t.checkOutDate),r=this.parseDateOnly(e.date);if(r.getTime()===i.getTime())return!0;let s=this.dateRange();if(Array.isArray(s)&&s.length>0){let h=this.parseDateOnly(s[0].date);if(r.getTime()===h.getTime()&&r>=i&&r<n)return!0}return!1}parseDateOnly(t){if(t instanceof Date){let n=t.toISOString().split("T")[0],[r,s,h]=n.split("-").map(Number);return new Date(r,s-1,h)}let e=String(t);if(/^\d{4}-\d{2}-\d{2}$/.test(e)){let[n,r,s]=e.split("-").map(Number);return new Date(n,r-1,s)}if(e.includes("T")||e.includes("Z")){let n=e.split("T")[0],[r,s,h]=n.split("-").map(Number);return new Date(r,s-1,h)}let i=new Date(t);return new Date(i.getFullYear(),i.getMonth(),i.getDate())}getReservationWidth(t,e){let i=this.cellWidthPx(),n=this.parseDateOnly(t.checkInDate),r=this.parseDateOnly(t.checkOutDate),s=this.parseDateOnly(e.date);if(!this.shouldRenderReservationFromDate(t,e))return 0;let h=n,f=this.dateRange();if(Array.isArray(f)&&f.length>0){let v=this.parseDateOnly(f[0].date);n<v&&r>v&&(h=v)}let C=new Date(r),N=C;if(Array.isArray(f)&&f.length>0){let v=this.parseDateOnly(f[f.length-1].date);C>v&&(N=v)}let G=1e3*60*60*24,w=Math.floor((N.getTime()-h.getTime())/G)+1;if(w<=0)return 0;let B=8,me=1,m=w*i-B;return Math.max(m,i-B)}getReservationStyle(t){let e=t?.status||"reserved";return this.statusColorMap[e]||"bg-gray-500"}getStatusColorClass(t){return this.statusColorMap[t]||"bg-gray-500"}getHousekeepingStatusClass(t){return{clean:"bg-green-100 border-l-4 border-l-green-500",dirty:"bg-amber-100 border-l-4 border-l-amber-500",inspected:"bg-blue-100 border-l-4 border-l-blue-500",out_of_order:"bg-red-100 border-l-4 border-l-red-500"}[t]||"bg-gray-50"}getHousekeepingStatusIcon(t){return{clean:"check_circle",dirty:"warning",inspected:"verified",out_of_order:"do_not_disturb"}[t]||"help"}updateHousekeepingStatus(t,e){this.roomService.updateHousekeepingStatus(t,e).subscribe({next:()=>{this.rooms.reload()},error:i=>{console.error("Failed to update housekeeping status:",i)}})}previousWeek(){let t=this.viewMode(),e=new Date(this.startDate());t==="weekly"?e.setDate(e.getDate()-7):e.setMonth(e.getMonth()-1),this.startDate.set(this.alignStartOfPeriod(e,t))}nextWeek(){let t=this.viewMode(),e=new Date(this.startDate());t==="weekly"?e.setDate(e.getDate()+7):e.setMonth(e.getMonth()+1),this.startDate.set(this.alignStartOfPeriod(e,t))}goToToday(){let t=new Date;this.startDate.set(this.alignStartOfPeriod(t,this.viewMode()))}onViewModeChange(t){this.viewMode.set(t),this.goToToday()}onStatusChange(t){this.selectedStatus.set(t)}alignStartOfPeriod(t,e){let i=new Date(t);return e==="weekly"?(i.setHours(0,0,0,0),i):new Date(i.getFullYear(),i.getMonth(),1)}getPeriodDateRangeStrings(t,e){let i=new Date(t);i.setHours(0,0,0,0);let n=new Date(i);e==="weekly"?n.setDate(n.getDate()+6):(n=new Date(i.getFullYear(),i.getMonth()+1,0),n.setHours(0,0,0,0));let r=i.toISOString().split("T")[0],s=n.toISOString().split("T")[0];return{dateFrom:r,dateTo:s}}getReservationTooltip(t,e){let i=t.guest?.firstName&&t.guest?.lastName?`${t.guest.firstName} ${t.guest.lastName}`:t.guestName||"Guest",n=e||"Room",r=new Date(t.checkInDate),s=new Date(t.checkOutDate),h={year:"numeric",month:"short",day:"2-digit"},f=r.toLocaleDateString(void 0,h),C=s.toLocaleDateString(void 0,h);return`${n} | ${i} | Check-in: ${f} | Check-out: ${C}`}cellWidthPx(){return this.viewMode()==="weekly"?160:80}cellGapPx(){return this.viewMode()==="weekly"?4:2}getCellReservationsCount(t,e){return(t||[]).filter(i=>this.isReservationStartingOnDate(i,e)).length}getCellStackIndex(t,e,i){let r=(t||[]).filter(s=>this.isReservationStartingOnDate(s,e)).findIndex(s=>s===i||s.roomAssignmentId&&i.roomAssignmentId&&s.roomAssignmentId===i.roomAssignmentId||s.reservationId&&i.reservationId&&s.reservationId===i.reservationId);return r>=0?r:0}getReservationTopPercent(t,e,i){let n=this.getCellReservationsCount(t,e);return n<=1?0:this.getCellStackIndex(t,e,i)*(100/n)}getReservationHeightPercent(t,e){return 100/(this.getCellReservationsCount(t,e)||1)}isGroupReservation(t){if(!t)return!1;let e=t;return e.reservationType==="group"||e.bookingType==="group"||e.groupReservation===!0||e.guest?.type==="group"||e.guest?.guestType==="group"||!!e.guest?.companyName}getReservationBlockLabel(t){let e=t?.guest||{},i=`${e.firstName||""} ${e.lastName||""}`.trim()||"Guest";return`${this.isGroupReservation(t)?"(G)":""} ${i}`}getReservationNightsLabel(t){let e=this.parseDateOnly(t.checkInDate),i=this.parseDateOnly(t.checkOutDate),n=1e3*60*60*24,r=Math.max(1,Math.round((i.getTime()-e.getTime())/n));return`${r} night${r===1?"":"s"}`}getBookingSourceLabel(t){let e=String(t?.bookingSource||t?.reservation?.bookingSource||"").toLowerCase();return{"booking.com":"Booking.com",expedia:"Expedia",agoda:"Agoda",airbnb:"Airbnb",direct:"Direct",phone:"Phone",online:"Online",walk_in:"Walk-in",travel_agent:"Agent",corporate:"Corporate"}[e]||"Direct"}getBookingSourceLogoUrl(t){let e=String(t?.bookingSource||t?.reservation?.bookingSource||"").toLowerCase();return{airbnb:"https://cdn.brandfetch.io/idkuvXnjOH/w/400/h/400/theme/dark/icon.jpeg?c=1bxid64Mup7aczewSAYMX&t=1717146459610",agoda:"https://cdn.brandfetch.io/idrJbkwvG0/w/400/h/400/theme/dark/icon.jpeg?c=1bxid64Mup7aczewSAYMX&t=1724730098837",expedia:"https://cdn.brandfetch.io/idAGaivHFH/w/400/h/400/theme/dark/icon.jpeg?c=1bxid64Mup7aczewSAYMX&t=1740983477322","booking.com":"https://cdn.brandfetch.io/id9mEmLNcV/w/400/h/400/theme/dark/icon.jpeg?c=1bxid64Mup7aczewSAYMX&t=1725855381233"}[e]||null}getBookingSourceColor(t){let e=String(t?.bookingSource||t?.reservation?.bookingSource||"").toLowerCase();return{"booking.com":"#003580",expedia:"#002F6C",airbnb:"#FF5A5F",agoda:"#5C2D91",walk_in:"#16A34A",direct:"#4B5563",phone:"#0EA5E9",online:"#6366F1",travel_agent:"#7C3AED",corporate:"#334155"}[e]||"#4B5563"}openReservationPreview(t,e){t&&this.dialog.open(Ee,{width:"700px",data:{reservation:t,room:{name:e?.roomName,id:e?.roomId}}})}hasReservationOnDate(t,e){let n=this.roomsWithReservations().find(s=>!s.isGroup&&s.roomId===t);if(!n||!n.reservations)return!1;let r=this.parseDateOnly(e);return n.reservations.some(s=>{let h=this.parseDateOnly(s.checkInDate),f=this.parseDateOnly(s.checkOutDate);return r>=h&&r<f})}hasOTAUnassignedConflictInRange(t,e,i){let n=this.roomsWithReservations(),r=this.parseDateOnly(e),s=this.parseDateOnly(i),h=n.filter(f=>f.isOTAUnassigned&&f.roomTypeId===t&&f.reservations);if(h.length===0)return!1;for(let f of h)for(let C of f.reservations){let N=this.parseDateOnly(C.checkInDate),G=this.parseDateOnly(C.checkOutDate);if(r<G&&s>=N)return!0}return!1}hasConflictInRange(t,e,i){let n=new Date(Math.min(e.getTime(),i.getTime())),r=new Date(Math.max(e.getTime(),i.getTime()));n.setHours(0,0,0,0),r.setHours(0,0,0,0);let s=new Date(n);for(;s<=r;){if(this.hasReservationOnDate(t,s))return!0;s.setDate(s.getDate()+1)}let f=this.roomsWithReservations().find(C=>!C.isGroup&&C.roomId===t);return!!(f&&f.roomTypeId&&this.hasOTAUnassignedConflictInRange(f.roomTypeId,n,r))}onCellMouseDown(t,e,i){if(i.isGroup||i.isOTAUnassigned)return;t.preventDefault();let n=new Date(e.date),r=new Date(e.date);r.setDate(r.getDate()+1);let s=this.hasReservationOnDate(i.roomId,n)||this.hasReservationOnDate(i.roomId,r);this.dragSelection.set({isSelecting:!0,startDate:new Date(e.date),endDate:new Date(e.date),roomId:i.roomId,roomName:i.roomName,roomTypeId:i.roomTypeId||null,roomTypeName:i.roomTypeName||null,hasConflict:s})}onCellMouseEnter(t,e){let i=this.dragSelection();if(!i.isSelecting||e.roomId!==i.roomId)return;let n=new Date(t.date),r=this.hasConflictInRange(i.roomId,i.startDate,n);this.dragSelection.update(s=>re(L({},s),{endDate:n,hasConflict:r}))}onCellMouseUp(){let t=this.dragSelection();if(t.isSelecting){if(!t.hasConflict&&t.startDate&&t.endDate&&t.roomId){let e=new Date(Math.min(t.startDate.getTime(),t.endDate.getTime())),i=new Date(Math.max(t.startDate.getTime(),t.endDate.getTime())),n=new Date(i);e.getTime()===i.getTime()&&n.setDate(n.getDate()+1),console.log("Check-in:",e,"Check-out:",n),this.openQuickReservationWithDates(e,n,t.roomId,t.roomName,t.roomTypeId,t.roomTypeName)}this.resetDragSelection()}}resetDragSelection(){this.dragSelection.set({isSelecting:!1,startDate:null,endDate:null,roomId:null,roomName:null,roomTypeId:null,roomTypeName:null,hasConflict:!1})}isCellInSelection(t,e){let i=this.dragSelection();if(!i.isSelecting||!i.startDate||!i.endDate||e.isGroup||e.roomId!==i.roomId)return!1;let n=new Date(t.date);n.setHours(0,0,0,0);let r=new Date(Math.min(i.startDate.getTime(),i.endDate.getTime())),s=new Date(Math.max(i.startDate.getTime(),i.endDate.getTime()));return r.setHours(0,0,0,0),s.setHours(0,0,0,0),r.getTime()===s.getTime()&&(s=new Date(s),s.setDate(s.getDate()+1)),n>=r&&n<=s}openQuickReservationWithDates(t,e,i,n,r,s){let h={checkInDate:t,checkOutDate:e,preselectedRoomId:i,preselectedRoomName:n??void 0,preselectedRoomTypeId:r??void 0,preselectedRoomTypeName:s??void 0};this.dialog.open(Ze,{width:"600px",data:h}).afterClosed().subscribe(C=>{C&&C&&this.router.navigate(["../create"],{relativeTo:this.route.parent,queryParams:{quickReservation:JSON.stringify(C)}})})}onDocumentMouseUp(){this.dragSelection().isSelecting&&this.onCellMouseUp()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=_e({type:o,selectors:[["app-reservations-calendar"]],hostBindings:function(e,i){e&1&&b("mouseup",function(){return i.onDocumentMouseUp()},bt)},decls:115,vars:18,consts:[["viewMenu","matMenu"],["statusMenu","matMenu"],["housekeepingMenu",""],["title","Reservations","subtitle","Manage hotel reservations and guest bookings","viewToggleRoute","/menu/hms/front-desk/reservations/view",3,"showViewToggle"],["actions",""],["matButton","outlined",3,"click"],[1,"mr-1"],["matButton","filled",3,"click"],[1,"min-h-screen","flex","flex-col"],[1,"py-4","px-4"],[1,"flex","justify-between","items-center","gap-4"],[1,"flex-1"],[1,"flex","flex-wrap","gap-4"],[1,"flex","items-center","gap-2","text-sm","text-gray-600"],[1,"text-base"],[1,"text-base","text-green-600"],[1,"text-base","text-purple-600"],[1,"text-base","text-orange-600"],[1,"text-base","text-red-600"],[1,"flex","gap-3","items-center"],["mat-stroked-button","",3,"matMenuTriggerFor"],[1,"ml-1"],["mat-menu-item","",3,"click"],["mat-menu-item",""],["matButton","tonal",3,"click"],["matButton","","color","warn",1,"min-w-48"],[1,"absolute","inset-0","z-50","flex","items-center","justify-center","bg-white/60"],[1,"flex-1","min-h-96","relative"],[1,"calendar-scroll"],[1,"calendar-row","calendar-header"],[1,"calendar-left","calendar-cell-left","calendar-header-cell"],[1,"text-xs","font-semibold","text-gray-700","uppercase"],[1,"calendar-row-cells"],[1,"calendar-cell","calendar-cell-header",3,"width","bg-blue-50"],[1,"border-t","border-gray-200","px-4","py-3","bg-gray-50"],[1,"flex","gap-8"],[1,"text-xs","font-semibold","text-gray-600","mb-2"],[1,"flex","gap-4"],[1,"flex","items-center","gap-2"],["diameter","40","mode","indeterminate"],[1,"calendar-cell","calendar-cell-header",3,"mouseenter","mouseleave"],[1,"text-xs","font-semibold","text-gray-600"],[1,"text-sm","font-bold","text-gray-900"],[1,"calendar-row","calendar-group"],[1,"calendar-row","calendar-room"],[1,"calendar-left","calendar-cell-left","calendar-group-cell"],[1,"text-xs","font-semibold","text-gray-800"],[1,"calendar-cell","calendar-cell-group",3,"width","bg-blue-100"],[1,"calendar-cell","calendar-cell-group",3,"mouseenter","mouseleave"],["matTooltipPosition","right",1,"calendar-left","calendar-cell-left","calendar-room-cell",3,"ngClass","matTooltip","cdkContextMenuTriggerFor","cdkContextMenuTriggerData"],[1,"calendar-cell","calendar-cell-room",3,"width","bg-blue-50","bg-blue-100","bg-red-100","cursor-pointer","cursor-not-allowed"],[1,"calendar-cell","calendar-cell-room",3,"mousedown","mouseenter","mouseleave","mouseup"],["matTooltipPosition","above",1,"reservation-block",3,"backgroundColor","top","height","width","matTooltip"],["matTooltipPosition","above",1,"reservation-block",3,"click","mousedown","matTooltip"],[1,"reservation-content"],[1,"reservation-text"],[1,"reservation-nights"],[1,"reservation-name"],[1,"reservation-source"],["loading","lazy",1,"reservation-source-icon",3,"src","alt"],[1,"reservation-source-icon"],[1,"inline-block","w-3","h-3","rounded-sm","border-l-2",3,"ngClass"],[1,"text-xs","text-gray-700"],[1,"inline-block","w-3","h-3","rounded-sm",3,"ngClass"],["cdkMenu","",1,"bg-white","rounded-lg","shadow-lg","border","border-gray-200","py-2","min-w-[200px]"],[1,"px-4","py-2","border-b","border-gray-100"],[1,"text-xs","font-semibold","text-gray-500","uppercase"],["cdkMenuItem","",1,"w-full","px-4","py-2","text-left","text-sm","hover:bg-gray-100","flex","items-center","gap-3","transition-colors",3,"bg-gray-50","font-semibold"],["cdkMenuItem","",1,"w-full","px-4","py-2","text-left","text-sm","hover:bg-gray-100","flex","items-center","gap-3","transition-colors",3,"cdkMenuItemTriggered"],[1,"text-base",3,"ngClass"],[1,"ml-auto","text-base","text-green-600"]],template:function(e,i){if(e&1){let n=z();a(0,"app-page-header",3),St(1,4),a(2,"button",5),b("click",function(){return M(n),D(i.clearFilters())}),a(3,"mat-icon"),l(4,"clear"),c(),l(5," Clear Filters "),c(),a(6,"button",5),b("click",function(){return M(n),D(i.reloadData())}),a(7,"mat-icon",6),l(8,"refresh"),c(),l(9," Reload "),c(),a(10,"button",7),b("click",function(){return M(n),D(i.createReservation())}),a(11,"mat-icon",6),l(12,"add"),c(),l(13," Create Reservation "),c(),xt(),c(),a(14,"div",8)(15,"div",9)(16,"div",10)(17,"div",11)(18,"div",12)(19,"div",13)(20,"mat-icon",14),l(21,"hotel"),c(),a(22,"span"),l(23,"Total: "),a(24,"strong"),l(25),c()()(),a(26,"div",13)(27,"mat-icon",15),l(28,"check_circle"),c(),a(29,"span"),l(30,"Confirmed: "),a(31,"strong"),l(32),c()()(),a(33,"div",13)(34,"mat-icon",16),l(35,"person"),c(),a(36,"span"),l(37,"Checked In: "),a(38,"strong"),l(39),c()()(),a(40,"div",13)(41,"mat-icon",17),l(42,"schedule"),c(),a(43,"span"),l(44,"Pending: "),a(45,"strong"),l(46),c()()(),a(47,"div",13)(48,"mat-icon",18),l(49,"cancel"),c(),a(50,"span"),l(51,"Cancelled: "),a(52,"strong"),l(53),c()()()()(),a(54,"div",19)(55,"button",20),l(56),x(57,"titlecase"),a(58,"mat-icon",21),l(59,"expand_more"),c()(),a(60,"mat-menu",null,0)(62,"button",22),b("click",function(){return M(n),D(i.onViewModeChange("weekly"))}),l(63,"Weekly"),c(),a(64,"button",22),b("click",function(){return M(n),D(i.onViewModeChange("monthly"))}),l(65,"Monthly"),c()(),a(66,"button",20),l(67),x(68,"titlecase"),a(69,"mat-icon",21),l(70,"expand_more"),c()(),a(71,"mat-menu",null,1)(73,"button",22),b("click",function(){return M(n),D(i.onStatusChange("all"))}),l(74,"All"),c(),P(75,qi,3,3,"button",23,Ae),c(),a(77,"button",24),b("click",function(){return M(n),D(i.previousWeek())}),a(78,"mat-icon",6),l(79,"chevron_left"),c(),l(80," Previous "),c(),a(81,"button",25),l(82),c(),a(83,"button",24),b("click",function(){return M(n),D(i.nextWeek())}),l(84," Next "),a(85,"mat-icon",21),l(86,"chevron_right"),c()()()()(),$(87,Ji,2,0,"div",26),a(88,"div",27)(89,"div",28)(90,"div",29)(91,"div",30)(92,"span",31),l(93,"Rooms"),c()(),a(94,"div",32),P(95,en,5,6,"div",33,ue),c()(),P(97,dn,2,1,null,null,Fe),c()(),a(99,"div",34)(100,"div",35)(101,"div")(102,"p",36),l(103,"Room Status"),c(),a(104,"div",37),P(105,un,4,7,"div",38,ue),c()(),a(107,"div")(108,"p",36),l(109,"Reservation Status"),c(),a(110,"div",37),P(111,mn,5,4,"div",38,Ae),c()()()()(),Dt(113,hn,6,0,"ng-template",null,2,wt)}if(e&2){let n,r=ve(61),s=ve(72);A("showViewToggle",!0),u(25),_(((n=i.reservations.value())==null||n.reservations==null?null:n.reservations.length)||0),u(7),_(i.confirmedCount()||0),u(7),_(i.checkedInCount()||0),u(7),_(i.pendingCount()||0),u(7),_(i.cancelledCount()||0),u(2),A("matMenuTriggerFor",r),u(),q(" ",ne(57,14,i.viewMode())," "),u(10),A("matMenuTriggerFor",s),u(),q(" Status: ",ne(68,16,i.selectedStatus())," "),u(8),E(i.reservationStatuses),u(7),q(" ",i.getPeriodLabel()," "),u(5),U(i.reservations.isLoading()?87:-1),u(7),Y("width",i.dateRange().length*i.cellWidthPx(),"px"),u(),E(i.dateRange()),u(2),E(i.roomsWithReservations()),u(8),E(i.housekeepingStatuses),u(6),E(i.reservationStatuses)}},dependencies:[ye,Ot,De,Me,Se,Wt,Yt,Kt,jt,zt,Zt,Qt,ai,si,Re,Ti,Ci,nt,Ri,gi,Pt],styles:["[_nghost-%COMP%]{display:block}.calendar-scroll[_ngcontent-%COMP%]{position:relative;overflow:auto;max-height:100%}.calendar-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{height:8px;width:8px}.calendar-scroll[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}.calendar-scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888;border-radius:4px}.calendar-scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}.calendar-row[_ngcontent-%COMP%]{display:flex;align-items:stretch}.calendar-header[_ngcontent-%COMP%]{position:sticky;top:0;z-index:30;background:#fff;border-bottom:1px solid #e5e7eb}.calendar-left[_ngcontent-%COMP%]{position:sticky;left:0;z-index:25;background:#fff;border-right:1px solid #e5e7eb;min-width:12rem;max-width:12rem;display:flex;align-items:center}.calendar-cell-left[_ngcontent-%COMP%]{padding:0 1rem}.calendar-header-cell[_ngcontent-%COMP%]{height:56px}.calendar-group[_ngcontent-%COMP%], .calendar-group[_ngcontent-%COMP%]   .calendar-left[_ngcontent-%COMP%]{background:#f3f4f6}.calendar-group-cell[_ngcontent-%COMP%]{height:32px}.calendar-room-cell[_ngcontent-%COMP%]{height:48px}.calendar-row-cells[_ngcontent-%COMP%]{display:flex}.calendar-cell[_ngcontent-%COMP%]{flex:0 0 auto;border-right:1px solid #e5e7eb;border-bottom:1px solid #f1f5f9;position:relative;display:flex;align-items:center;justify-content:center}.calendar-cell-header[_ngcontent-%COMP%]{height:56px;flex-direction:column;justify-content:center;-webkit-user-select:none;user-select:none}.calendar-cell-group[_ngcontent-%COMP%]{height:32px;background:#f3f4f6}.calendar-cell-room[_ngcontent-%COMP%]{height:48px;align-items:stretch;overflow:visible}.reservation-block[_ngcontent-%COMP%]{position:absolute;left:4px;right:4px;border-radius:2px;display:flex;align-items:center;font-size:11px;font-weight:600;color:#fff;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;border:1px solid rgba(0,0,0,.1);cursor:pointer;z-index:10}.reservation-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;width:100%;padding:0 6px;overflow:hidden}.reservation-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;justify-content:center;gap:2px;min-width:0;overflow:hidden}.reservation-nights[_ngcontent-%COMP%]{font-size:10px;font-weight:700;background:#fff3;padding:0 4px;border-radius:4px;flex-shrink:0}.reservation-name[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.reservation-source[_ngcontent-%COMP%]{margin-left:auto;display:flex;align-items:center;flex-shrink:0;background:#fff3;border-radius:999px;padding:2px}.reservation-source-icon[_ngcontent-%COMP%]{width:14px;height:14px;border-radius:3px;font-size:14px;line-height:14px}.reservation-block[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #0003;z-index:20}"]})};export{Ii as ReservationsCalendar};
