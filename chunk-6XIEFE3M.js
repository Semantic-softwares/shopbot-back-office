import{a as Le}from"./chunk-BHSWFM5K.js";import{a as oi}from"./chunk-RZATRPW2.js";import{a as Me}from"./chunk-NLFI464S.js";import{a as ni}from"./chunk-3VJO7DSO.js";import{a as ri}from"./chunk-DEWY4UEI.js";import{a as qt}from"./chunk-QTGE4XNY.js";import{b as Yt,d as Qt,f as Zt}from"./chunk-VQA5W3EJ.js";import{a as Xt,b as Jt,c as be,e as ei,f as ti,g as ii,h as ke}from"./chunk-5PPPFRRH.js";import"./chunk-L7BDTWLS.js";import"./chunk-MLXMZDM2.js";import{a as zt}from"./chunk-PSH3SVZJ.js";import{a as Ut}from"./chunk-5LVVGVPB.js";import{c as Kt,f as Wt,g as $t,i as jt,l as Gt}from"./chunk-SB5BMAVW.js";import{a as Vt,b as Lt}from"./chunk-TPXN6FKM.js";import"./chunk-EHJ5MOYI.js";import"./chunk-23Y5PA5G.js";import"./chunk-2KPMOGOH.js";import"./chunk-TRRVPZ2R.js";import{a as Ft,b as Pt,c as Nt,d as At}from"./chunk-Q24JN32N.js";import{i as fe}from"./chunk-WFQLSX5X.js";import"./chunk-66RT5LSQ.js";import"./chunk-O2QR3P5A.js";import{d as ye}from"./chunk-WD3LGOJ6.js";import"./chunk-5IMEEOTN.js";import"./chunk-UATHS3SB.js";import{a as Ve}from"./chunk-GZ7S2I6F.js";import"./chunk-L5R7UQHM.js";import"./chunk-323BPMCN.js";import"./chunk-TW5XL4DD.js";import"./chunk-GBJWJHBW.js";import{a as Bt,b as Ht}from"./chunk-ZDRRUYFZ.js";import"./chunk-ADPCW6JI.js";import"./chunk-UUMWQRYG.js";import{a as Et}from"./chunk-7HFBBWIO.js";import"./chunk-RRHIWUSE.js";import"./chunk-VJNXGGOY.js";import"./chunk-UPMF7ZC6.js";import"./chunk-BFT2MTJY.js";import"./chunk-GI3DA2RF.js";import{b as wt,c as Ne,f as Ae,h as Be,i as Rt,k as He,o as Ot}from"./chunk-DDDMZQMU.js";import{b as It}from"./chunk-6NXOHEKD.js";import"./chunk-47XHPHB4.js";import{b as _e,c as ve}from"./chunk-5P5QATX2.js";import{$ as he,I as Pe,J as w,L as Tt,Z as ge,h as ie,o as Ee,w as Fe,x as St}from"./chunk-LG6YQHRU.js";import{e as me,g as pe,h as xt}from"./chunk-DWM5GR6S.js";import{g as kt,l as Mt,m as Dt,p as Ct,r as de}from"./chunk-6BQAOBQP.js";import{$ as xe,$a as d,A as oe,Aa as st,Ba as at,C as Xe,Cc as te,Da as ae,Ea as lt,Eb as L,Ec as vt,Fc as yt,G as Je,Gb as W,Hb as $,Hc as we,I as et,Ib as Se,Jb as Te,Jc as x,K as tt,Kb as R,Kc as Z,Lb as O,Lc as U,Mb as I,Nb as s,Ob as c,Oc as bt,Pb as j,R as it,S as nt,T as q,Tb as pt,Tc as p,U as rt,Ub as gt,V as C,Wb as P,Xb as Ie,_a as ct,_b as _,aa as ot,ac as m,ca as Y,dc as ht,ea as u,ed as Re,f as F,fc as ft,gc as _t,hb as le,id as Oe,ja as v,ka as y,kb as ut,kc as ue,lc as ee,mc as E,na as Q,ob as ce,pb as dt,pc as l,qb as V,qc as g,ra as X,rc as G,sa as se,t as Ze,tb as J,u as qe,ub as mt,va as T}from"./chunk-H33Y42PP.js";import{a as H,b as re,g as Qe}from"./chunk-GAL4ENT6.js";var ci=(()=>{class r{static \u0275fac=function(t){return new(t||r)};static \u0275dir=V({type:r,selectors:[["","cdkMenuGroup",""]],hostAttrs:["role","group",1,"cdk-menu-group"],exportAs:["cdkMenuGroup"],features:[te([{provide:Ve,useClass:Ve}])]})}return r})(),je=new Y("cdk-menu"),K=(function(r){return r[r.nextItem=0]="nextItem",r[r.previousItem=1]="previousItem",r[r.currentItem=2]="currentItem",r})(K||{}),N=new Y("cdk-menu-stack"),ki={provide:N,useFactory:()=>u(N,{optional:!0,skipSelf:!0})||new Ge},Mi=r=>({provide:N,useFactory:()=>u(N,{optional:!0,skipSelf:!0})||Ge.inline(r)}),Ge=(()=>{class r{id=u(Pe).getId("cdk-menu-stack-");_elements=[];_close=new F;_empty=new F;_hasFocus=new F;closed=this._close;hasFocus=this._hasFocus.pipe(q(!1),Je(0),tt());emptied=this._empty;_inlineMenuOrientation=null;static inline(e){let t=new r;return t._inlineMenuOrientation=e,t}push(e){this._elements.push(e)}close(e,t){let{focusNextOnEmpty:n,focusParentTrigger:o}=H({},t);if(this._elements.indexOf(e)>=0){let a;do a=this._elements.pop(),this._close.next({item:a,focusParentTrigger:o});while(a!==e);this.isEmpty()&&this._empty.next(n)}}closeSubMenuOf(e){let t=!1;if(this._elements.indexOf(e)>=0)for(t=this.peek()!==e;this.peek()!==e;)this._close.next({item:this._elements.pop()});return t}closeAll(e){let{focusNextOnEmpty:t,focusParentTrigger:n}=H({},e);if(!this.isEmpty()){for(;!this.isEmpty();){let o=this._elements.pop();o&&this._close.next({item:o,focusParentTrigger:n})}this._empty.next(t)}}isEmpty(){return!this._elements.length}length(){return this._elements.length}peek(){return this._elements[this._elements.length-1]}hasInlineMenu(){return this._inlineMenuOrientation!=null}inlineMenuOrientation(){return this._inlineMenuOrientation}setHasFocus(e){this._hasFocus.next(e)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=xe({token:r,factory:r.\u0275fac})}return r})(),De=new Y("cdk-menu-trigger"),Di=new Y("cdk-menu-scroll-strategy",{providedIn:"root",factory:()=>{let r=u(Q);return()=>wt(r)}}),ui=(()=>{class r{static _openMenuTrigger;update(e){r._openMenuTrigger!==e&&(r._openMenuTrigger?.close(),r._openMenuTrigger=e)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=xe({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),di=(()=>{class r{injector=u(Q);viewContainerRef=u(ut);menuStack=u(N);menuScrollStrategy=u(Di);menuPosition;opened=new X;closed=new X;menuTemplateRef;menuData;overlayRef=null;destroyed=new F;stopOutsideClicksListener=oe(this.closed,this.destroyed);childMenu;_menuPortal;_childMenuInjector;ngOnDestroy(){this._destroyOverlay(),this.destroyed.next(),this.destroyed.complete()}isOpen(){return!!this.overlayRef?.hasAttached()}registerChildMenu(e){this.childMenu=e}getMenuContentPortal(){let e=this.menuTemplateRef!==this._menuPortal?.templateRef;return this.menuTemplateRef&&(!this._menuPortal||e)&&(this._menuPortal=new It(this.menuTemplateRef,this.viewContainerRef,this.menuData,this._getChildMenuInjector())),this._menuPortal}isElementInsideMenuStack(e){for(let t=e;t;t=t?.parentElement??null)if(t.getAttribute("data-cdk-menu-stack-id")===this.menuStack.id)return!0;return!1}_destroyOverlay(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=null)}_getChildMenuInjector(){return this._childMenuInjector=this._childMenuInjector||Q.create({providers:[{provide:De,useValue:this},{provide:N,useValue:this.menuStack}],parent:this.injector}),this._childMenuInjector}static \u0275fac=function(t){return new(t||r)};static \u0275dir=V({type:r,hostVars:2,hostBindings:function(t,n){t&2&&L("aria-controls",n.childMenu==null?null:n.childMenu.id)("data-cdk-menu-stack-id",n.menuStack.id)}})}return r})();var Ue=new Y("cdk-menu-aim");function mi(r,i){if(!i.isTrusted)return!1;let e=r.nativeElement,t=i.keyCode;return e.nodeName==="BUTTON"&&!e.disabled?t===13||t===32:e.nodeName==="A"?t===13:!1}var Ci=(()=>{class r extends di{_elementRef=u(ae);_ngZone=u(se);_changeDetectorRef=u(Re);_inputModalityDetector=u(Fe);_directionality=u(ie,{optional:!0});_renderer=u(le);_injector=u(Q);_cleanupMouseenter;_menuTracker=u(ui);_parentMenu=u(je,{optional:!0});_menuAim=u(Ue,{optional:!0});constructor(){super(),this._setRole(),this._registerCloseHandler(),this._subscribeToMenuStackClosed(),this._subscribeToMouseEnter(),this._subscribeToMenuStackHasFocus(),this._setType()}toggle(){this.isOpen()?this.close():this.open()}open(){this._parentMenu||this._menuTracker.update(this),!this.isOpen()&&this.menuTemplateRef!=null&&(this.opened.next(),this.overlayRef=this.overlayRef||He(this._injector,this._getOverlayConfig()),this.overlayRef.attach(this.getMenuContentPortal()),this._changeDetectorRef.markForCheck(),this._subscribeToOutsideClicks())}close(){this.isOpen()&&(this.closed.next(),this.overlayRef.detach(),this._changeDetectorRef.markForCheck()),this._closeSiblingTriggers()}getMenu(){return this.childMenu}ngOnChanges(e){e.menuPosition&&this.overlayRef&&this.overlayRef.updatePositionStrategy(this._getOverlayPositionStrategy())}ngOnDestroy(){this._cleanupMouseenter(),super.ngOnDestroy()}_toggleOnKeydown(e){let t=this._parentMenu?.orientation==="vertical";switch(e.keyCode){case 32:case 13:!w(e)&&!mi(this._elementRef,e)&&(this.toggle(),this.childMenu?.focusFirstItem("keyboard"));break;case 39:w(e)||this._parentMenu&&t&&this._directionality?.value!=="rtl"&&(e.preventDefault(),this.open(),this.childMenu?.focusFirstItem("keyboard"));break;case 37:w(e)||this._parentMenu&&t&&this._directionality?.value==="rtl"&&(e.preventDefault(),this.open(),this.childMenu?.focusFirstItem("keyboard"));break;case 40:case 38:w(e)||t||(e.preventDefault(),this.open(),e.keyCode===40?this.childMenu?.focusFirstItem("keyboard"):this.childMenu?.focusLastItem("keyboard"));break}}_handleClick(){this.toggle(),this.childMenu?.focusFirstItem("mouse")}_setHasFocus(e){this._parentMenu||this.menuStack.setHasFocus(e)}_subscribeToMouseEnter(){this._cleanupMouseenter=this._ngZone.runOutsideAngular(()=>this._renderer.listen(this._elementRef.nativeElement,"mouseenter",()=>{if(this._inputModalityDetector.mostRecentModality!=="touch"&&!this.menuStack.isEmpty()&&!this.isOpen()){let e=()=>this._ngZone.run(()=>{this._closeSiblingTriggers(),this.open()});this._menuAim?this._menuAim.toggle(e):e()}}))}_closeSiblingTriggers(){this._parentMenu?!this.menuStack.closeSubMenuOf(this._parentMenu)&&this.menuStack.peek()!==this._parentMenu&&this.menuStack.closeAll():this.menuStack.closeAll()}_getOverlayConfig(){return new Ne({positionStrategy:this._getOverlayPositionStrategy(),scrollStrategy:this.menuScrollStrategy(),direction:this._directionality||void 0})}_getOverlayPositionStrategy(){return Ae(this._injector,this._elementRef).withLockedPosition().withFlexibleDimensions(!1).withPositions(this._getOverlayPositions())}_getOverlayPositions(){return this.menuPosition??(!this._parentMenu||this._parentMenu.orientation==="horizontal"?Be:Rt)}_registerCloseHandler(){this._parentMenu||this.menuStack.closed.pipe(C(this.destroyed)).subscribe(({item:e})=>{e===this.childMenu&&this.close()})}_subscribeToOutsideClicks(){this.overlayRef&&this.overlayRef.outsidePointerEvents().pipe(C(this.stopOutsideClicksListener)).subscribe(e=>{let t=Ee(e),n=this._elementRef.nativeElement;t!==n&&!n.contains(t)&&(this.isElementInsideMenuStack(t)?this._closeSiblingTriggers():this.menuStack.closeAll())})}_subscribeToMenuStackHasFocus(){this._parentMenu||this.menuStack.hasFocus.pipe(C(this.destroyed)).subscribe(e=>{e||this.menuStack.closeAll()})}_subscribeToMenuStackClosed(){this._parentMenu||this.menuStack.closed.subscribe(({focusParentTrigger:e})=>{e&&!this.menuStack.length()&&this._elementRef.nativeElement.focus()})}_setRole(){this._parentMenu||this._elementRef.nativeElement.setAttribute("role","button")}_setType(){let e=this._elementRef.nativeElement;e.nodeName==="BUTTON"&&!e.getAttribute("type")&&e.setAttribute("type","button")}static \u0275fac=function(t){return new(t||r)};static \u0275dir=V({type:r,selectors:[["","cdkMenuTriggerFor",""]],hostAttrs:[1,"cdk-menu-trigger"],hostVars:2,hostBindings:function(t,n){t&1&&_("focusin",function(){return n._setHasFocus(!0)})("focusout",function(){return n._setHasFocus(!1)})("keydown",function(a){return n._toggleOnKeydown(a)})("click",function(){return n._handleClick()}),t&2&&L("aria-haspopup",n.menuTemplateRef?"menu":null)("aria-expanded",n.menuTemplateRef==null?null:n.isOpen())},inputs:{menuTemplateRef:[0,"cdkMenuTriggerFor","menuTemplateRef"],menuPosition:[0,"cdkMenuPosition","menuPosition"],menuData:[0,"cdkMenuTriggerData","menuData"]},outputs:{opened:"cdkMenuOpened",closed:"cdkMenuClosed"},exportAs:["cdkMenuTriggerFor"],features:[te([{provide:De,useExisting:r},ki]),J,st]})}return r})(),ze=(()=>{class r{_dir=u(ie,{optional:!0});_elementRef=u(ae);_ngZone=u(se);_inputModalityDetector=u(Fe);_renderer=u(le);_cleanupMouseEnter;_menuAim=u(Ue,{optional:!0});_menuStack=u(N);_parentMenu=u(je,{optional:!0});_menuTrigger=u(Ci,{optional:!0,self:!0});disabled=!1;typeaheadLabel;triggered=new X;get hasMenu(){return this._menuTrigger?.menuTemplateRef!=null}_tabindex=-1;closeOnSpacebarTrigger=!0;destroyed=new F;constructor(){this._setupMouseEnter(),this._setType(),this._isStandaloneItem()&&(this._tabindex=0)}ngOnDestroy(){this._cleanupMouseEnter?.(),this.destroyed.next(),this.destroyed.complete()}focus(){this._elementRef.nativeElement.focus()}trigger(e){let{keepOpen:t}=H({},e);!this.disabled&&!this.hasMenu&&(this.triggered.next(),t||this._menuStack.closeAll({focusParentTrigger:!0}))}isMenuOpen(){return!!this._menuTrigger?.isOpen()}getMenu(){return this._menuTrigger?.getMenu()}getMenuTrigger(){return this._menuTrigger}getLabel(){return this.typeaheadLabel||this._elementRef.nativeElement.textContent?.trim()||""}_resetTabIndex(){this._isStandaloneItem()||(this._tabindex=-1)}_setTabIndex(e){this.disabled||(!e||!this._menuStack.isEmpty())&&(this._tabindex=0)}_handleClick(e){this.disabled?(e.preventDefault(),e.stopPropagation()):this.trigger()}_onKeydown(e){switch(e.keyCode){case 32:case 13:if(!w(e)&&!mi(this._elementRef,e)){let t=this._elementRef.nativeElement.nodeName;t!=="A"&&t!=="BUTTON"&&e.preventDefault(),this.trigger({keepOpen:e.keyCode===32&&!this.closeOnSpacebarTrigger})}break;case 39:w(e)||this._parentMenu&&this._isParentVertical()&&(this._dir?.value!=="rtl"?this._forwardArrowPressed(e):this._backArrowPressed(e));break;case 37:w(e)||this._parentMenu&&this._isParentVertical()&&(this._dir?.value!=="rtl"?this._backArrowPressed(e):this._forwardArrowPressed(e));break}}_isStandaloneItem(){return!this._parentMenu}_backArrowPressed(e){let t=this._parentMenu;(this._menuStack.hasInlineMenu()||this._menuStack.length()>1)&&(e.preventDefault(),this._menuStack.close(t,{focusNextOnEmpty:this._menuStack.inlineMenuOrientation()==="horizontal"?K.previousItem:K.currentItem,focusParentTrigger:!0}))}_forwardArrowPressed(e){!this.hasMenu&&this._menuStack.inlineMenuOrientation()==="horizontal"&&(e.preventDefault(),this._menuStack.closeAll({focusNextOnEmpty:K.nextItem,focusParentTrigger:!0}))}_setupMouseEnter(){if(!this._isStandaloneItem()){let e=()=>this._ngZone.run(()=>this._menuStack.closeSubMenuOf(this._parentMenu));this._cleanupMouseEnter=this._ngZone.runOutsideAngular(()=>this._renderer.listen(this._elementRef.nativeElement,"mouseenter",()=>{this._inputModalityDetector.mostRecentModality!=="touch"&&!this._menuStack.isEmpty()&&!this.hasMenu&&(this._menuAim?this._menuAim.toggle(e):e())}))}}_isParentVertical(){return this._parentMenu?.orientation==="vertical"}_setType(){let e=this._elementRef.nativeElement;e.nodeName==="BUTTON"&&!e.getAttribute("type")&&e.setAttribute("type","button")}static \u0275fac=function(t){return new(t||r)};static \u0275dir=V({type:r,selectors:[["","cdkMenuItem",""]],hostAttrs:["role","menuitem",1,"cdk-menu-item"],hostVars:4,hostBindings:function(t,n){t&1&&_("blur",function(){return n._resetTabIndex()})("focus",function(){return n._setTabIndex()})("click",function(a){return n._handleClick(a)})("keydown",function(a){return n._onKeydown(a)}),t&2&&(Ie("tabIndex",n._tabindex),L("aria-disabled",n.disabled||null),E("cdk-menu-item-disabled",n.disabled))},inputs:{disabled:[2,"cdkMenuItemDisabled","disabled",Oe],typeaheadLabel:[0,"cdkMenuitemTypeaheadLabel","typeaheadLabel"]},outputs:{triggered:"cdkMenuItemTriggered"},exportAs:["cdkMenuItem"]})}return r})(),$e=class{_renderer;_items;_eventCleanups;_itemsSubscription;entered=new F;exited=new F;activeElement;previousElement;constructor(i,e){this._renderer=i,this._items=e,this._bindEvents(),this.entered.subscribe(t=>this.activeElement=t),this.exited.subscribe(()=>{this.previousElement=this.activeElement,this.activeElement=void 0})}destroy(){this._cleanupEvents(),this._itemsSubscription?.unsubscribe()}_bindEvents(){this._itemsSubscription=this._items.changes.pipe(q(this._items)).subscribe(()=>{this._cleanupEvents(),this._eventCleanups=[],this._items.forEach(i=>{let e=i._elementRef.nativeElement;this._eventCleanups.push(this._renderer.listen(e,"mouseenter",()=>{this.entered.next(i)}),this._renderer.listen(e,"mouseout",()=>{this.exited.next(i)}))})})}_cleanupEvents(){this._eventCleanups?.forEach(i=>i()),this._eventCleanups=void 0}},xi=(()=>{class r extends ci{_focusMonitor=u(St);ngZone=u(se);_renderer=u(le);nativeElement=u(ae).nativeElement;menuStack=u(N);menuAim=u(Ue,{optional:!0,self:!0});dir=u(ie,{optional:!0});_allItems;id=u(Pe).getId("cdk-menu-");items=new lt;orientation="vertical";isInline=!1;keyManager;destroyed=new F;triggerItem;pointerTracker;_menuStackHasFocus=T(!1);_tabIndexSignal=p(()=>{let e=this._menuStackHasFocus()?-1:0;return this.isInline?e:null});ngAfterContentInit(){this.isInline||this.menuStack.push(this),this._setItems(),this._setKeyManager(),this._handleFocus(),this._subscribeToMenuStackHasFocus(),this._subscribeToMenuOpen(),this._subscribeToMenuStackClosed(),this._setUpPointerTracker()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this.nativeElement),this.keyManager?.destroy(),this.destroyed.next(),this.destroyed.complete(),this.pointerTracker?.destroy()}focusFirstItem(e="program"){this.keyManager.setFocusOrigin(e),this.keyManager.setFirstItemActive()}focusLastItem(e="program"){this.keyManager.setFocusOrigin(e),this.keyManager.setLastItemActive()}setActiveMenuItem(e){this.keyManager?.setActiveItem(e)}_getTabIndex(){return this._tabIndexSignal()}closeOpenMenu(e,t){let{focusParentTrigger:n}=H({},t),o=this.keyManager,a=this.triggerItem;e===a?.getMenuTrigger()?.getMenu()&&(a?.getMenuTrigger()?.close(),n&&(a?o.setActiveItem(a):o.setFirstItemActive()))}_setItems(){this._allItems.changes.pipe(q(this._allItems),C(this.destroyed)).subscribe(e=>{this.items.reset(e.filter(t=>t._parentMenu===this)),this.items.notifyOnChanges()})}_setKeyManager(){this.keyManager=new Tt(this.items).withWrap().withTypeAhead().withHomeAndEnd().skipPredicate(()=>!1),this.orientation==="horizontal"?this.keyManager.withHorizontalOrientation(this.dir?.value||"ltr"):this.keyManager.withVerticalOrientation()}_subscribeToMenuOpen(){let e=oe(this.items.changes,this.destroyed);this.items.changes.pipe(q(this.items),Ze(t=>t.filter(n=>n.hasMenu).map(n=>n.getMenuTrigger().opened.pipe(et(n),C(e)))),qe(),rt(t=>(this.triggerItem=t,t.getMenuTrigger().closed)),C(this.destroyed)).subscribe(()=>this.triggerItem=void 0)}_subscribeToMenuStackClosed(){this.menuStack.closed.pipe(C(this.destroyed)).subscribe(({item:e,focusParentTrigger:t})=>this.closeOpenMenu(e,{focusParentTrigger:t}))}_subscribeToMenuStackHasFocus(){this.isInline&&this.menuStack.hasFocus.pipe(C(this.destroyed)).subscribe(e=>{this._menuStackHasFocus.set(e)})}_setUpPointerTracker(){this.menuAim&&(this.ngZone.runOutsideAngular(()=>{this.pointerTracker=new $e(this._renderer,this.items)}),this.menuAim.initialize(this,this.pointerTracker))}_handleFocus(){this._focusMonitor.monitor(this.nativeElement,!1).pipe(C(this.destroyed)).subscribe(e=>{e!==null&&e!=="mouse"&&this.focusFirstItem(e)})}static \u0275fac=(()=>{let e;return function(n){return(e||(e=at(r)))(n||r)}})();static \u0275dir=V({type:r,contentQueries:function(t,n,o){if(t&1&&ht(o,ze,5),t&2){let a;ft(a=_t())&&(n._allItems=a)}},hostAttrs:["role","menu"],hostVars:4,hostBindings:function(t,n){t&1&&_("focusin",function(){return n.menuStack.setHasFocus(!0)})("focusout",function(){return n.menuStack.setHasFocus(!1)}),t&2&&(Ie("tabIndex",n._getTabIndex())("id",n.id),L("aria-orientation",n.orientation)("data-cdk-menu-stack-id",n.menuStack.id))},inputs:{id:"id"},features:[J]})}return r})(),pi=(()=>{class r extends xi{_parentTrigger=u(De,{optional:!0});closed=new X;orientation="vertical";isInline=!this._parentTrigger;constructor(){super(),this.destroyed.subscribe(this.closed),this._parentTrigger?.registerChildMenu(this)}ngAfterContentInit(){super.ngAfterContentInit(),this._subscribeToMenuStackEmptied()}ngOnDestroy(){super.ngOnDestroy(),this.closed.complete()}_handleKeyEvent(e){let t=this.keyManager;switch(e.keyCode){case 37:case 39:w(e)||(e.preventDefault(),t.setFocusOrigin("keyboard"),t.onKeydown(e));break;case 27:w(e)||(e.preventDefault(),this.menuStack.close(this,{focusNextOnEmpty:K.currentItem,focusParentTrigger:!0}));break;case 9:w(e,"altKey","metaKey","ctrlKey")||this.menuStack.closeAll({focusParentTrigger:!0});break;default:t.onKeydown(e)}}_toggleMenuFocus(e){let t=this.keyManager;switch(e){case K.nextItem:t.setFocusOrigin("keyboard"),t.setNextItemActive();break;case K.previousItem:t.setFocusOrigin("keyboard"),t.setPreviousItemActive();break;case K.currentItem:t.activeItem&&(t.setFocusOrigin("keyboard"),t.setActiveItem(t.activeItem));break}}_subscribeToMenuStackEmptied(){this.menuStack.emptied.pipe(C(this.destroyed)).subscribe(e=>this._toggleMenuFocus(e))}static \u0275fac=function(t){return new(t||r)};static \u0275dir=V({type:r,selectors:[["","cdkMenu",""]],hostAttrs:["role","menu",1,"cdk-menu"],hostVars:2,hostBindings:function(t,n){t&1&&_("keydown",function(a){return n._handleKeyEvent(a)}),t&2&&E("cdk-menu-inline",n.isInline)},outputs:{closed:"closed"},exportAs:["cdkMenu"],features:[te([{provide:ci,useExisting:r},{provide:je,useExisting:r},Mi("vertical")]),J]})}return r})();var Si=Be.map(r=>{let i=r.overlayX==="start"?2:-2,e=r.overlayY==="top"?2:-2;return re(H({},r),{offsetX:i,offsetY:e})}),gi=(()=>{class r extends di{_injector=u(Q);_directionality=u(ie,{optional:!0});_menuTracker=u(ui);_changeDetectorRef=u(Re);disabled=!1;constructor(){super(),this._setMenuStackCloseListener()}open(e){this._open(null,e),this._changeDetectorRef.markForCheck()}close(){this.menuStack.closeAll()}_openOnContextMenu(e){this.disabled||(e.preventDefault(),e.stopPropagation(),this._menuTracker.update(this),this._open(e,{x:e.clientX,y:e.clientY}),e.button===2?this.childMenu?.focusFirstItem("mouse"):e.button===0?this.childMenu?.focusFirstItem("keyboard"):this.childMenu?.focusFirstItem("program"))}_getOverlayConfig(e){return new Ne({positionStrategy:this._getOverlayPositionStrategy(e),scrollStrategy:this.menuScrollStrategy(),direction:this._directionality||void 0})}_getOverlayPositionStrategy(e){return Ae(this._injector,e).withLockedPosition().withGrowAfterOpen().withPositions(this.menuPosition??Si)}_setMenuStackCloseListener(){this.menuStack.closed.pipe(C(this.destroyed)).subscribe(({item:e})=>{e===this.childMenu&&this.isOpen()&&(this.closed.next(),this.overlayRef.detach(),this.childMenu=void 0,this._changeDetectorRef.markForCheck())})}_subscribeToOutsideClicks(e){if(this.overlayRef){let t=this.overlayRef.outsidePointerEvents();if(e){let[n,o]=Xe(t,({type:a})=>a==="auxclick");t=oe(o.pipe(nt((a,h)=>e.ctrlKey&&h===0&&a.ctrlKey)),n.pipe(it(1)))}t.pipe(C(this.stopOutsideClicksListener)).subscribe(n=>{this.isElementInsideMenuStack(Ee(n))||this.menuStack.closeAll()})}}_open(e,t){this.disabled||(this.isOpen()?(this.menuStack.closeSubMenuOf(this.childMenu),this.overlayRef.getConfig().positionStrategy.setOrigin(t),this.overlayRef.updatePosition()):(this.opened.next(),this.overlayRef?(this.overlayRef.getConfig().positionStrategy.setOrigin(t),this.overlayRef.updatePosition()):this.overlayRef=He(this._injector,this._getOverlayConfig(t)),this.overlayRef.attach(this.getMenuContentPortal()),this._subscribeToOutsideClicks(e)))}static \u0275fac=function(t){return new(t||r)};static \u0275dir=V({type:r,selectors:[["","cdkContextMenuTriggerFor",""]],hostVars:1,hostBindings:function(t,n){t&1&&_("contextmenu",function(a){return n._openOnContextMenu(a)}),t&2&&L("data-cdk-menu-stack-id",null)},inputs:{menuTemplateRef:[0,"cdkContextMenuTriggerFor","menuTemplateRef"],menuPosition:[0,"cdkContextMenuPosition","menuPosition"],menuData:[0,"cdkContextMenuTriggerData","menuData"],disabled:[2,"cdkContextMenuDisabled","disabled",Oe]},outputs:{opened:"cdkContextMenuOpened",closed:"cdkContextMenuClosed"},exportAs:["cdkContextMenuTriggerFor"],features:[te([{provide:De,useExisting:r},{provide:N,useClass:Ge}]),J]})}return r})();var hi=(()=>{class r{static \u0275fac=function(t){return new(t||r)};static \u0275mod=dt({type:r});static \u0275inj=ot({imports:[Ot]})}return r})();var Ei=r=>["/menu","hms","front-desk","reservations","edit",r];function Fi(r,i){if(r&1){let e=P();s(0,"button",11),_("click",function(){v(e);let n=m();return y(n.openRoomChangeDialog())}),s(1,"mat-icon"),l(2,"swap_horiz"),c(),l(3," Change Room "),c()}}var Ce=class r{dialogRef=u(Xt);data=u(Jt);dialog=u(be);guestService=u(ni);reservationService=u(Me);snackBar=u(Et);storeStore=u(fe);router=u(pe);route=u(me);reservation=T(this.data.reservation);roomAssignment=p(()=>{let i=this.reservation()?.rooms||[];return this.data.room?.id&&i.find(e=>e?.room?._id===this.data.room?.id)||i[0]});assignedGuest=p(()=>this.roomAssignment()?.assignedGuest||this.reservation()?.guest);guestName=p(()=>{let i=this.assignedGuest();return this.guestService.getGuestName(i)});openReservation(){this.close(),this.router.navigate(["../../../edit",this.reservation()?._id],{relativeTo:this.route})}roomCheckIn=p(()=>this.roomAssignment()?.stayPeriod?.from||this.reservation()?.checkInDate);roomCheckOut=p(()=>this.roomAssignment()?.stayPeriod?.to||this.reservation()?.checkOutDate);roomTypeName=p(()=>{let e=this.roomAssignment()?.room?.roomType;return typeof e=="object"&&e?.name?e.name:"\u2014"});roomNumber=p(()=>this.roomAssignment()?.room?.roomNumber||"\u2014");roomName=p(()=>this.roomAssignment()?.room?.name||"\u2014");roomGuestsCount=p(()=>{let e=this.roomAssignment()?.guests||{},t=Number(e.adults||0),n=Number(e.children||0);return t+n||1});roomTotal=p(()=>this.roomAssignment()?.pricing?.total||0);amountPaid=p(()=>this.reservation()?.pricing?.paid||0);balanceAmount=p(()=>Math.max(0,this.roomTotal()-this.amountPaid()));bookingTotal=p(()=>this.reservation()?.pricing?.total||0);bookingSource=p(()=>this.reservation()?.bookingSource||"\u2014");reservationType=p(()=>this.reservation()?.bookingType||this.reservation()?.reservationType||"\u2014");confirmationNumber=p(()=>this.reservation()?.confirmationNumber||this.reservation()?._id||"\u2014");paymentMethod=p(()=>this.reservation()?.paymentInfo?.method||"\u2014");canChangeRooms=p(()=>{let i=this.reservation()?.status;return i&&!["checked_out","cancelled","no_show"].includes(i)});openRoomChangeDialog(){let i=this.reservation();if(!i||!this.canChangeRooms()){this.snackBar.open("Cannot change rooms for this reservation","Close",{duration:3e3});return}this.dialog.open(oi,{width:"500px",maxWidth:"95vw",disableClose:!0,data:{reservationId:i._id,currentRooms:i.rooms,checkInDate:new Date(i.checkInDate).toISOString(),checkOutDate:new Date(i.checkOutDate).toISOString(),numberOfNights:i.numberOfNights,currency:this.storeStore.selectedStore()?.currency||"USD",actualCheckInDate:i.actualCheckInDate?new Date(i.actualCheckInDate).toISOString():void 0,reservationStatus:i.status}}).afterClosed().subscribe(t=>Qe(this,null,function*(){if(t)try{let n=yield this.reservationService.changeRooms(i._id,t).toPromise();n?.success&&(this.snackBar.open("Room changed successfully","Close",{duration:3e3}),this.reservation.set(n.data))}catch(n){console.error("Error changing rooms:",n);let o=n?.error?.error||n?.error?.message||n?.message||"Failed to change rooms";this.snackBar.open(o,"Close",{duration:5e3})}}))}close(){this.dialogRef.close()}statusLabel=p(()=>(this.reservation()?.status||"reserved").replace("_"," "));statusClass=p(()=>{let i=this.reservation()?.status||"reserved";return{pending:"bg-yellow-100 text-yellow-800 border border-yellow-200",confirmed:"bg-blue-100 text-blue-800 border border-blue-200",checked_in:"bg-green-100 text-green-800 border border-green-200",checked_out:"bg-gray-100 text-gray-800 border border-gray-200",cancelled:"bg-red-100 text-red-800 border border-red-200",no_show:"bg-orange-100 text-orange-800 border border-orange-200",reserved:"bg-indigo-100 text-indigo-800 border border-indigo-200"}[i]||"bg-gray-100 text-gray-800 border border-gray-200"});static \u0275fac=function(e){return new(e||r)};static \u0275cmp=ce({type:r,selectors:[["app-reservation-preview-dialog"]],decls:77,vars:37,consts:[["mat-dialog-title","",1,"flex","items-center","justify-between"],["color","primary",1,"capitalize"],[1,"capitalize"],["mat-subheader",""],["matListItemMeta",""],["matListItemMeta","",1,"capitalize"],["matListItemMeta","",1,"font-semibold"],["align","end",1,"gap-2"],["matButton","tonal"],["matButton","outlined",3,"click","routerLink"],["matButton","outlined",3,"click"],["matButton","tonal",3,"click"]],template:function(e,t){if(e&1&&(s(0,"h2",0),l(1),c(),s(2,"mat-dialog-content")(3,"mat-chip-set")(4,"mat-chip",1),l(5),c(),s(6,"mat-chip",2),l(7),c(),s(8,"mat-chip"),l(9),c()(),s(10,"mat-list")(11,"div",3),l(12,"Stay"),c(),s(13,"mat-list-item"),l(14," Check-in "),s(15,"span",4),l(16),x(17,"date"),c()(),s(18,"mat-list-item"),l(19," Check-out "),s(20,"span",4),l(21),x(22,"date"),c()(),s(23,"mat-list-item"),l(24," Source "),s(25,"span",5),l(26),c()()(),j(27,"mat-divider"),s(28,"mat-list")(29,"div",3),l(30,"Room"),c(),s(31,"mat-list-item"),l(32," Room Type "),s(33,"span",4),l(34),c()(),s(35,"mat-list-item"),l(36," Room Number "),s(37,"span",4),l(38),c()(),s(39,"mat-list-item"),l(40," Room Name "),s(41,"span",4),l(42),c()()(),j(43,"mat-divider"),s(44,"mat-list")(45,"div",3),l(46,"Payment"),c(),s(47,"mat-list-item"),l(48," Payment Mode "),s(49,"span",5),l(50),c()(),s(51,"mat-list-item"),l(52," Total "),s(53,"span",4),l(54),x(55,"currency"),c()(),s(56,"mat-list-item"),l(57," Amount Paid "),s(58,"span",4),l(59),x(60,"currency"),c()(),s(61,"mat-list-item"),l(62," Balance "),s(63,"span",4),l(64),x(65,"currency"),c()(),s(66,"mat-list-item"),l(67," Booking Total "),s(68,"span",6),l(69),x(70,"currency"),c()()()(),s(71,"mat-dialog-actions",7),W(72,Fi,4,0,"button",8),s(73,"a",9),_("click",function(){return t.close()}),l(74,"View"),c(),s(75,"button",10),_("click",function(){return t.close()}),l(76,"Close"),c()()),e&2){let n,o,a,h;d(),G(" ",t.guestName(),`
`),d(4),g(t.statusLabel()),d(2),g(t.reservationType()),d(2),g(t.confirmationNumber()),d(7),g(U(17,17,t.roomCheckIn(),"dd/MM/yyyy")),d(5),g(U(22,20,t.roomCheckOut(),"dd/MM/yyyy")),d(5),g(t.bookingSource()),d(8),g(t.roomTypeName()),d(4),g(t.roomNumber()),d(4),g(t.roomName()),d(8),g(t.paymentMethod()),d(4),g(U(55,23,t.roomTotal(),(n=t.storeStore.selectedStore())==null?null:n.currency)),d(5),g(U(60,26,t.amountPaid(),(o=t.storeStore.selectedStore())==null?null:o.currency)),d(5),g(U(65,29,t.balanceAmount(),(a=t.storeStore.selectedStore())==null?null:a.currency)),d(5),g(U(70,32,t.bookingTotal(),(h=t.storeStore.selectedStore())==null?null:h.currency)),d(3),$(t.canChangeRooms()?72:-1),d(),I("routerLink",vt(35,Ei,t.reservation()._id))}},dependencies:[de,ke,ei,ii,ti,ve,_e,he,ge,Lt,Vt,Zt,Yt,Qt,Gt,Wt,$t,jt,Kt,xt,Ct,Dt],encapsulation:2})};var Pi=(r,i,e,t)=>({"bg-green-100 border-l-green-500":r,"bg-amber-100 border-l-amber-500":i,"bg-blue-100 border-l-blue-500":e,"bg-red-100 border-l-red-500":t}),Ni=(r,i)=>({roomId:r,currentStatus:i}),Ai=(r,i,e,t)=>({"text-green-600":r,"text-amber-600":i,"text-blue-600":e,"text-red-600":t}),ne=(r,i)=>i.key;function Bi(r,i){if(r&1){let e=P();s(0,"button",21),_("click",function(){let n=v(e).$implicit,o=m();return y(o.onStatusChange(n))}),l(1),x(2,"titlecase"),c()}if(r&2){let e=i.$implicit;d(),g(Z(2,1,e))}}function Hi(r,i){r&1&&(s(0,"div",27),j(1,"mat-progress-spinner",40),c())}function Vi(r,i){if(r&1&&(s(0,"div",32),j(1,"span",41),s(2,"span",42),l(3),c()()),r&2){let e=i.$implicit;d(),I("ngClass",we(2,Pi,e.key==="clean",e.key==="dirty",e.key==="inspected",e.key==="out_of_order")),d(2),g(e.label)}}function Li(r,i){if(r&1&&(s(0,"div",32),j(1,"span",43),s(2,"span",42),l(3),x(4,"titlecase"),c()()),r&2){let e=i.$implicit,t=m();d(),I("ngClass",t.getStatusColorClass(e)),d(2),g(Z(4,2,e))}}function Ki(r,i){if(r&1&&(s(0,"th",44)(1,"p",45),l(2),c(),s(3,"p",46),l(4),c()()),r&2){let e=i.$implicit,t=m();ee("width",t.cellWidthPx(),"px"),E("bg-white",t.hoveredDateKey()!==e.key)("bg-blue-500",t.hoveredDateKey()===e.key)("text-white",t.hoveredDateKey()===e.key),d(),E("text-gray-600",t.hoveredDateKey()!==e.key),d(),g(e.dayName),d(),E("text-gray-900",t.hoveredDateKey()!==e.key),d(),g(e.day)}}function Wi(r,i){if(r&1){let e=P();s(0,"td",51),_("mouseenter",function(){let n=v(e).$implicit,o=m(3);return y(o.hoveredDateKey.set(n.key))})("mouseleave",function(){v(e);let n=m(3);return y(n.hoveredDateKey.set(null))}),c()}if(r&2){let e=i.$implicit,t=m(3);ee("width",t.cellWidthPx(),"px"),E("bg-gray-100",t.hoveredDateKey()!==e.key)("bg-blue-100",t.hoveredDateKey()===e.key)}}function $i(r,i){if(r&1&&(s(0,"tr")(1,"td",48)(2,"span",49),l(3),c()(),R(4,Wi,1,6,"td",50,ne),c()),r&2){let e=m().$implicit,t=m();d(3),g(e.roomTypeName),d(),O(t.dateRange())}}function ji(r,i){if(r&1){let e=P();s(0,"div",56),_("click",function(n){v(e);let o=m().$implicit,a=m(3).$implicit;return m().openReservationPreview(o.reservation,a),y(n.stopPropagation())})("mousedown",function(n){return v(e),y(n.stopPropagation())}),s(1,"div",57),l(2),c()()}if(r&2){let e=m().$implicit,t=m().$implicit,n=m(2).$implicit,o=m();ee("top",o.getReservationTopPercent(n.reservations,t,e),"%")("height",o.getReservationHeightPercent(n.reservations,t),"%")("width",o.getReservationWidth(e,t),"px"),I("ngClass",o.getReservationStyle(e))("matTooltip",o.getReservationTooltip(e,n.roomName)),d(2),G("",o.getReservationBlockLabel(e)," ")}}function Gi(r,i){if(r&1&&W(0,ji,3,9,"div",55),r&2){let e=i.$implicit,t=m().$implicit,n=m(3);$(n.shouldRenderReservationFromDate(e,t)?0:-1)}}function Ui(r,i){if(r&1){let e=P();s(0,"td",54),_("mousedown",function(n){let o=v(e).$implicit,a=m(2).$implicit,h=m();return y(h.onCellMouseDown(n,o,a))})("mouseenter",function(){let n=v(e).$implicit,o=m(2).$implicit,a=m();return a.onCellMouseEnter(n,o),y(a.hoveredDateKey.set(n.key))})("mouseleave",function(){v(e);let n=m(3);return y(n.hoveredDateKey.set(null))})("mouseup",function(){v(e);let n=m(3);return y(n.onCellMouseUp())}),R(1,Gi,1,1,null,null,Se),c()}if(r&2){let e=i.$implicit,t=m(2).$implicit,n=m();ee("width",n.cellWidthPx(),"px"),E("bg-blue-100",n.isCellInSelection(e,t)&&!n.dragSelection().hasConflict)("bg-red-100",n.isCellInSelection(e,t)&&n.dragSelection().hasConflict)("bg-blue-50",n.hoveredDateKey()===e.key&&!n.isCellInSelection(e,t))("cursor-pointer",!n.hasReservationOnDate(t.roomId,e.date))("cursor-not-allowed",n.hasReservationOnDate(t.roomId,e.date)),d(),O(t.reservations)}}function zi(r,i){if(r&1&&(s(0,"tr",47)(1,"td",52),x(2,"titlecase"),s(3,"div",32)(4,"span"),l(5),c()()(),R(6,Ui,3,12,"td",53,ne),c()),r&2){let e=m().$implicit,t=m(),n=ue(117);d(),I("ngClass",t.getHousekeepingStatusClass(e.housekeepingStatus))("matTooltip","Housekeeping: "+Z(2,5,e.housekeepingStatus)+" (Right-click to change)")("cdkContextMenuTriggerFor",n)("cdkContextMenuTriggerData",yt(7,Ni,e.roomId,e.housekeepingStatus)),d(4),g(e.roomName),d(),O(t.dateRange())}}function Yi(r,i){if(r&1&&W(0,$i,6,1,"tr")(1,zi,8,10,"tr",47),r&2){let e=i.$implicit;$(e.isGroup?0:1)}}function Qi(r,i){r&1&&(s(0,"mat-icon",64),l(1,"check"),c())}function Zi(r,i){if(r&1){let e=P();s(0,"button",62),_("cdkMenuItemTriggered",function(){let n=v(e).$implicit,o=m().roomId,a=m();return y(a.updateHousekeepingStatus(o,n.key))}),s(1,"mat-icon",63),l(2),c(),s(3,"span"),l(4),c(),W(5,Qi,2,0,"mat-icon",64),c()}if(r&2){let e=i.$implicit,t=m().currentStatus,n=m();E("bg-gray-50",t===e.key)("font-semibold",t===e.key),d(),I("ngClass",we(8,Ai,e.key==="clean",e.key==="dirty",e.key==="inspected",e.key==="out_of_order")),d(),g(n.getHousekeepingStatusIcon(e.key)),d(2),g(e.label),d(),$(t===e.key?5:-1)}}function qi(r,i){if(r&1&&(s(0,"div",58)(1,"div",59)(2,"span",60),l(3,"Update Housekeeping Status"),c()(),R(4,Zi,6,13,"button",61,ne),c()),r&2){let e=m();d(4),O(e.housekeepingStatuses)}}var fi=class r{storeStore=u(fe);reservationService=u(Me);roomService=u(ri);router=u(pe);route=u(me);dialog=u(be);viewMode=T("monthly");startDate=T(new Date);selectedStatus=T("all");excludedStatuses=T(new Set(["checked_out","cancelled","no_show"]));dragSelection=T({isSelecting:!1,startDate:null,endDate:null,roomId:null,roomName:null,roomTypeId:null,roomTypeName:null,hasConflict:!1});hoveredDateKey=T(null);reservationStatuses=["pending","confirmed","checked_in","checked_out","cancelled","no_show","reserved"];housekeepingStatuses=[{key:"clean",label:"Clean"},{key:"dirty",label:"Dirty"},{key:"inspected",label:"Inspected"},{key:"out_of_order",label:"Out of Order"}];statusColorMap={pending:"bg-yellow-500",confirmed:"bg-blue-600",checked_in:"bg-green-600",checked_out:"bg-gray-500",cancelled:"bg-red-600",no_show:"bg-orange-600",reserved:"bg-indigo-600"};dateRange=p(()=>{let i=[],e=this.viewMode(),t=this.alignStartOfPeriod(this.startDate(),e);if(e==="weekly")for(let n=0;n<7;n++){let o=new Date(t);o.setDate(o.getDate()+n),i.push({key:o.toISOString().slice(0,10),day:o.getDate(),dayName:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][o.getDay()],date:new Date(o)})}else{let n=t.getFullYear(),o=t.getMonth(),a=new Date(n,o+1,0).getDate();for(let h=0;h<a;h++){let b=new Date(n,o,h+1);i.push({key:b.toISOString().slice(0,10),day:b.getDate(),dayName:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][b.getDay()],date:new Date(b)})}}return i});rooms=ye({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:i})=>this.roomService.getRooms(i.storeId)});reservations=ye({params:()=>{let i=this.storeStore.selectedStore()?._id,e=this.viewMode(),t=this.alignStartOfPeriod(this.startDate(),e),{dateFrom:n,dateTo:o}=this.getPeriodDateRangeStrings(t,e),a=this.selectedStatus();return{storeId:i,dateFrom:n,dateTo:o,status:a==="all"?void 0:a}},stream:({params:i})=>this.reservationService.getReservations({storeId:i.storeId,dateFrom:i.dateFrom,dateTo:i.dateTo,status:i.status})});roomTypes=ye({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:i})=>this.roomService.getRoomTypes(i.storeId)});roomsWithReservations=p(()=>{let i=this.rooms.value()||[],e=this.roomTypes.value()||[],t=this.reservations.value(),n=Array.isArray(t)?t:t?.reservations||[],o=this.excludedStatuses(),a=n.filter(f=>this.selectedStatus()!=="all"?f.status===this.selectedStatus():!o.has(f.status)),h=new Map;for(let f of e)f&&f._id&&h.set(f._id,f.name||"Room");let b=new Map;for(let f of i){let S,M="Room";typeof f.roomType=="string"?(S=f.roomType,M=h.get(f.roomType)||f.roomType):f.roomType&&(S=f.roomType._id,M=f.roomType.name||"Room");let B=S||M;b.has(B)||b.set(B,{typeName:M,rooms:[]}),b.get(B).rooms.push(f)}let k=[];for(let f of e)f&&f._id&&b.has(f._id)&&k.push(f._id);for(let f of b.keys())k.includes(f)||k.push(f);let A=[];for(let f of k){let S=b.get(f);if(S){A.push({isGroup:!0,roomTypeName:S.typeName});for(let M of S.rooms){let B=[];for(let D of a){if(!D?.rooms)continue;let Ye=D.rooms.filter(z=>z?.room?._id===M._id);if(Ye?.length)for(let z of Ye){let _i=z?.stayPeriod?.from||D.checkInDate,vi=z?.stayPeriod?.to||D.checkOutDate,yi=z?.assignedGuest||D.guest;B.push({reservationId:D._id,roomAssignmentId:z?._id,checkInDate:_i,checkOutDate:vi,guest:yi,status:D.status,bookingType:D.bookingType,confirmationNumber:D.confirmationNumber,reservation:D})}}A.push({isGroup:!1,roomId:M._id,roomName:`${M.name} ${M.roomNumber??""}`,roomTypeId:typeof M.roomType=="string"?M.roomType:M.roomType?._id,roomTypeName:S.typeName,capacity:M.capacity||2,housekeepingStatus:M.housekeepingStatus||"clean",reservations:B})}}}return A});confirmedCount=p(()=>this.reservations.value()?.reservations.filter(i=>i.status==="confirmed").length);checkedInCount=p(()=>this.reservations.value()?.reservations.filter(i=>i.status==="checked_in").length);pendingCount=p(()=>this.reservations.value()?.reservations.filter(i=>i.status==="pending").length);cancelledCount=p(()=>this.reservations.value()?.reservations.filter(i=>i.status==="cancelled").length);totalRevenue=p(()=>this.reservations.value()?.reservations.reduce((i,e)=>i+this.getEffectiveTotal(e),0));getEffectiveTotal(i){return i.pricing?.total||0}ngOnInit(){let i=new Date,e=new Date(i.getFullYear(),i.getMonth(),1);this.startDate.set(e)}reloadData(){this.reservations.reload()}clearFilters(){this.viewMode.set("monthly"),this.selectedStatus.set("all");let i=new Date,e=new Date(i.getFullYear(),i.getMonth(),1);this.startDate.set(e)}createReservation(){this.dialog.open(Le,{width:"600px",disableClose:!1}).afterClosed().subscribe(e=>{e&&this.router.navigate(["../create"],{relativeTo:this.route.parent,queryParams:{quickReservation:JSON.stringify(e)}})})}getPeriodLabel(){let i=this.viewMode(),e=this.alignStartOfPeriod(this.startDate(),i),t=new Date(e);i==="weekly"?t.setDate(t.getDate()+6):(t=new Date(e.getFullYear(),e.getMonth()+1,0),t.setHours(0,0,0,0));let n=new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric"});return`${n.format(e)} \u2013 ${n.format(t)}`}isReservationOnDate(i,e){let t=new Date(i.checkInDate),n=new Date(i.checkOutDate);t.setHours(0,0,0,0),n.setHours(0,0,0,0);let o=new Date(e.date);return o.setHours(0,0,0,0),o>=t&&o<n}isReservationStartingOnDate(i,e){let t=this.parseDateOnly(i.checkInDate);return this.parseDateOnly(e.date).getTime()===t.getTime()}shouldRenderReservationFromDate(i,e){let t=this.parseDateOnly(i.checkInDate),n=this.parseDateOnly(i.checkOutDate),o=this.parseDateOnly(e.date);if(o.getTime()===t.getTime())return!0;let a=this.dateRange();if(Array.isArray(a)&&a.length>0){let h=this.parseDateOnly(a[0].date);if(o.getTime()===h.getTime()&&o>=t&&o<n)return!0}return!1}parseDateOnly(i){if(i instanceof Date)return new Date(i.getFullYear(),i.getMonth(),i.getDate());let e=String(i);if(e.includes("T")||e.includes("Z")){let n=e.split("T")[0],[o,a,h]=n.split("-").map(Number);return new Date(o,a-1,h)}let t=new Date(i);return new Date(t.getFullYear(),t.getMonth(),t.getDate())}getReservationWidth(i,e){let t=this.cellWidthPx(),n=this.parseDateOnly(i.checkInDate),o=this.parseDateOnly(i.checkOutDate),a=this.parseDateOnly(e.date);if(a<n)return 0;let h=a>n?a:n,b=new Date(o);b.setDate(b.getDate()-1);let k=this.dateRange(),A=b;if(Array.isArray(k)&&k.length>0){let D=this.parseDateOnly(k[k.length-1].date);A=A<D?A:D}let f=1e3*60*60*24,S=Math.round((A.getTime()-h.getTime())/f)+1;if(S<=0)return 0;let B=S*t+(S-1)*1-2;return Math.max(B,t-4)}getReservationStyle(i){let e=i?.status||"reserved";return this.statusColorMap[e]||"bg-gray-500"}getStatusColorClass(i){return this.statusColorMap[i]||"bg-gray-500"}getHousekeepingStatusClass(i){return{clean:"bg-green-100 border-l-4 border-l-green-500",dirty:"bg-amber-100 border-l-4 border-l-amber-500",inspected:"bg-blue-100 border-l-4 border-l-blue-500",out_of_order:"bg-red-100 border-l-4 border-l-red-500"}[i]||"bg-gray-50"}getHousekeepingStatusIcon(i){return{clean:"check_circle",dirty:"warning",inspected:"verified",out_of_order:"do_not_disturb"}[i]||"help"}updateHousekeepingStatus(i,e){this.roomService.updateHousekeepingStatus(i,e).subscribe({next:()=>{this.rooms.reload()},error:t=>{console.error("Failed to update housekeeping status:",t)}})}previousWeek(){let i=this.viewMode(),e=new Date(this.startDate());i==="weekly"?e.setDate(e.getDate()-7):e.setMonth(e.getMonth()-1),this.startDate.set(this.alignStartOfPeriod(e,i))}nextWeek(){let i=this.viewMode(),e=new Date(this.startDate());i==="weekly"?e.setDate(e.getDate()+7):e.setMonth(e.getMonth()+1),this.startDate.set(this.alignStartOfPeriod(e,i))}goToToday(){let i=new Date;this.startDate.set(this.alignStartOfPeriod(i,this.viewMode()))}onViewModeChange(i){this.viewMode.set(i),this.goToToday()}onStatusChange(i){this.selectedStatus.set(i)}alignStartOfPeriod(i,e){let t=new Date(i);return e==="weekly"?(t.setHours(0,0,0,0),t):new Date(t.getFullYear(),t.getMonth(),1)}getPeriodDateRangeStrings(i,e){let t=new Date(i);t.setHours(0,0,0,0);let n=new Date(t);e==="weekly"?n.setDate(n.getDate()+6):(n=new Date(t.getFullYear(),t.getMonth()+1,0),n.setHours(0,0,0,0));let o=t.toISOString().split("T")[0],a=n.toISOString().split("T")[0];return{dateFrom:o,dateTo:a}}getReservationTooltip(i,e){let t=i.guest?.firstName&&i.guest?.lastName?`${i.guest.firstName} ${i.guest.lastName}`:i.guestName||"Guest",n=e||"Room",o=new Date(i.checkInDate),a=new Date(i.checkOutDate),h={year:"numeric",month:"short",day:"2-digit"},b=o.toLocaleDateString(void 0,h),k=a.toLocaleDateString(void 0,h);return`${n} | ${t} | Check-in: ${b} | Check-out: ${k}`}cellWidthPx(){return this.viewMode()==="weekly"?160:80}cellGapPx(){return this.viewMode()==="weekly"?4:2}getCellReservationsCount(i,e){return(i||[]).filter(t=>this.isReservationStartingOnDate(t,e)).length}getCellStackIndex(i,e,t){let o=(i||[]).filter(a=>this.isReservationStartingOnDate(a,e)).findIndex(a=>a===t||a.roomAssignmentId&&t.roomAssignmentId&&a.roomAssignmentId===t.roomAssignmentId||a.reservationId&&t.reservationId&&a.reservationId===t.reservationId);return o>=0?o:0}getReservationTopPercent(i,e,t){let n=this.getCellReservationsCount(i,e);return n<=1?0:this.getCellStackIndex(i,e,t)*(100/n)}getReservationHeightPercent(i,e){return 100/(this.getCellReservationsCount(i,e)||1)}isGroupReservation(i){if(!i)return!1;let e=i;return e.reservationType==="group"||e.bookingType==="group"||e.groupReservation===!0||e.guest?.type==="group"||e.guest?.guestType==="group"||!!e.guest?.companyName}getReservationBlockLabel(i){let e=i?.guest||{},t=`${e.firstName||""} ${e.lastName||""}`.trim()||"Guest";return`${this.isGroupReservation(i)?"(G)":""} ${t}`}openReservationPreview(i,e){i&&this.dialog.open(Ce,{width:"700px",data:{reservation:i,room:{name:e?.roomName,id:e?.roomId}}})}hasReservationOnDate(i,e){let n=this.roomsWithReservations().find(a=>!a.isGroup&&a.roomId===i);if(!n||!n.reservations)return!1;let o=this.parseDateOnly(e);return n.reservations.some(a=>{let h=this.parseDateOnly(a.checkInDate),b=this.parseDateOnly(a.checkOutDate);return o>=h&&o<b})}hasConflictInRange(i,e,t){let n=new Date(Math.min(e.getTime(),t.getTime())),o=new Date(Math.max(e.getTime(),t.getTime()));n.setHours(0,0,0,0),o.setHours(0,0,0,0);let a=new Date(n);for(;a<=o;){if(this.hasReservationOnDate(i,a))return!0;a.setDate(a.getDate()+1)}return!1}onCellMouseDown(i,e,t){if(t.isGroup)return;i.preventDefault();let n=new Date(e.date),o=new Date(e.date);o.setDate(o.getDate()+1);let a=this.hasReservationOnDate(t.roomId,n)||this.hasReservationOnDate(t.roomId,o);this.dragSelection.set({isSelecting:!0,startDate:new Date(e.date),endDate:new Date(e.date),roomId:t.roomId,roomName:t.roomName,roomTypeId:t.roomTypeId||null,roomTypeName:t.roomTypeName||null,hasConflict:a})}onCellMouseEnter(i,e){let t=this.dragSelection();if(!t.isSelecting||e.roomId!==t.roomId)return;let n=new Date(i.date),o=this.hasConflictInRange(t.roomId,t.startDate,n);this.dragSelection.update(a=>re(H({},a),{endDate:n,hasConflict:o}))}onCellMouseUp(){let i=this.dragSelection();if(i.isSelecting){if(!i.hasConflict&&i.startDate&&i.endDate&&i.roomId){let e=new Date(Math.min(i.startDate.getTime(),i.endDate.getTime())),t=new Date(Math.max(i.startDate.getTime(),i.endDate.getTime())),n=new Date(t);e.getTime()===t.getTime()&&n.setDate(n.getDate()+1),console.log("Check-in:",e,"Check-out:",n),this.openQuickReservationWithDates(e,n,i.roomId,i.roomName,i.roomTypeId,i.roomTypeName)}this.resetDragSelection()}}resetDragSelection(){this.dragSelection.set({isSelecting:!1,startDate:null,endDate:null,roomId:null,roomName:null,roomTypeId:null,roomTypeName:null,hasConflict:!1})}isCellInSelection(i,e){let t=this.dragSelection();if(!t.isSelecting||!t.startDate||!t.endDate||e.isGroup||e.roomId!==t.roomId)return!1;let n=new Date(i.date);n.setHours(0,0,0,0);let o=new Date(Math.min(t.startDate.getTime(),t.endDate.getTime())),a=new Date(Math.max(t.startDate.getTime(),t.endDate.getTime()));return o.setHours(0,0,0,0),a.setHours(0,0,0,0),o.getTime()===a.getTime()&&(a=new Date(a),a.setDate(a.getDate()+1)),n>=o&&n<=a}openQuickReservationWithDates(i,e,t,n,o,a){let h={checkInDate:i,checkOutDate:e,preselectedRoomId:t,preselectedRoomName:n??void 0,preselectedRoomTypeId:o??void 0,preselectedRoomTypeName:a??void 0};this.dialog.open(Le,{width:"600px",data:h}).afterClosed().subscribe(k=>{k&&k&&this.router.navigate(["../create"],{relativeTo:this.route.parent,queryParams:{quickReservation:JSON.stringify(k)}})})}onDocumentMouseUp(){this.dragSelection().isSelecting&&this.onCellMouseUp()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=ce({type:r,selectors:[["app-reservations-calendar"]],hostBindings:function(e,t){e&1&&_("mouseup",function(){return t.onDocumentMouseUp()},ct)},decls:118,vars:17,consts:[["viewMenu","matMenu"],["statusMenu","matMenu"],["housekeepingMenu",""],["title","Reservations","subtitle","Manage hotel reservations and guest bookings","viewToggleRoute","/menu/hms/front-desk/reservations/view",3,"showViewToggle"],["actions",""],["matButton","outlined",3,"click"],[1,"mr-1"],["matButton","filled",3,"click"],[1,"min-h-screen","flex","flex-col"],[1,"py-4"],[1,"flex","justify-between","items-center"],[1,"flex","flex-wrap","gap-4","mt-2"],[1,"flex","items-center","gap-2","text-sm","text-gray-600"],[1,"text-base"],[1,"text-base","text-green-600"],[1,"text-base","text-purple-600"],[1,"text-base","text-orange-600"],[1,"text-base","text-red-600"],[1,"flex","gap-3","items-center"],["mat-stroked-button","",3,"matMenuTriggerFor"],[1,"ml-1"],["mat-menu-item","",3,"click"],["mat-menu-item",""],["matButton","tonal",3,"click"],["matButton","","color","warn"],[1,"flex-1","overflow-hidden","flex","flex-col","min-h-96"],[1,"overflow-auto","flex-1","relative","min-h-80"],[1,"absolute","inset-0","z-50","flex","items-center","justify-center","bg-white/60"],[1,"w-full","border-collapse","overflow-hidden"],[1,"sticky","left-0","z-10","w-48","border","border-outline-variant","px-4","py-2"],[1,"flex","flex-col","gap-1"],[1,"text-xs","font-semibold","text-gray-600","mb-1"],[1,"flex","items-center","gap-2"],[1,"border","border-outline-variant","px-4","py-2"],[1,"flex","flex-col","gap-2"],[1,"text-xs","font-semibold","text-gray-600"],[1,"flex","flex-wrap","items-center","gap-4"],[1,"sticky","left-0","top-0","z-30","w-48","bg-white","border","border-outline-variant","text-center"],[1,"text-xs","font-semibold","text-gray-700","uppercase"],[1,"sticky","top-0","z-20","border","border-outline-variant","text-center","transition-colors","duration-150",3,"width","bg-white","bg-blue-500","text-white"],["diameter","40","mode","indeterminate"],[1,"inline-block","w-3","h-3","rounded-sm","border-l-2",3,"ngClass"],[1,"text-xs","text-gray-700"],[1,"inline-block","w-3","h-3","rounded-sm",3,"ngClass"],[1,"sticky","top-0","z-20","border","border-outline-variant","text-center","transition-colors","duration-150"],[1,"text-xs","font-semibold"],[1,"text-sm","font-bold"],[1,"h-12"],[1,"sticky","left-0","z-10","w-48","border","border-outline-variant","px-4","py-2","text-left","bg-gray-100"],[1,"text-xs","font-semibold","text-gray-800"],[1,"border","border-outline-variant","transition-colors","duration-150",3,"bg-gray-100","bg-blue-100","width"],[1,"border","border-outline-variant","transition-colors","duration-150",3,"mouseenter","mouseleave"],["matTooltipPosition","right",1,"sticky","left-0","z-10","w-48","border","border-outline-variant","px-4","text-xs","cursor-context-menu",3,"ngClass","matTooltip","cdkContextMenuTriggerFor","cdkContextMenuTriggerData"],[1,"border","border-outline-variant","relative","overflow-visible","select-none","transition-colors","duration-150",3,"bg-blue-100","bg-red-100","bg-blue-50","cursor-pointer","cursor-not-allowed","width"],[1,"border","border-outline-variant","relative","overflow-visible","select-none","transition-colors","duration-150",3,"mousedown","mouseenter","mouseleave","mouseup"],["matTooltipPosition","above",1,"absolute","left-0.5","right-0.5","border","flex","items-center","text-white","text-xs","font-semibold","overflow-hidden","z-10","cursor-pointer",3,"ngClass","top","height","width","matTooltip"],["matTooltipPosition","above",1,"absolute","left-0.5","right-0.5","border","flex","items-center","text-white","text-xs","font-semibold","overflow-hidden","z-10","cursor-pointer",3,"click","mousedown","ngClass","matTooltip"],[1,"truncate","px-1"],["cdkMenu","",1,"bg-white","rounded-lg","shadow-lg","border","border-gray-200","py-2","min-w-[200px]"],[1,"px-4","py-2","border-b","border-gray-100"],[1,"text-xs","font-semibold","text-gray-500","uppercase"],["cdkMenuItem","",1,"w-full","px-4","py-2","text-left","text-sm","hover:bg-gray-100","flex","items-center","gap-3","transition-colors",3,"bg-gray-50","font-semibold"],["cdkMenuItem","",1,"w-full","px-4","py-2","text-left","text-sm","hover:bg-gray-100","flex","items-center","gap-3","transition-colors",3,"cdkMenuItemTriggered"],[1,"text-base",3,"ngClass"],[1,"ml-auto","text-base","text-green-600"]],template:function(e,t){if(e&1){let n=P();s(0,"app-page-header",3),pt(1,4),s(2,"button",5),_("click",function(){return v(n),y(t.clearFilters())}),s(3,"mat-icon"),l(4,"clear"),c(),l(5," Clear Filters "),c(),s(6,"button",5),_("click",function(){return v(n),y(t.reloadData())}),s(7,"mat-icon",6),l(8,"refresh"),c(),l(9," Reload "),c(),s(10,"button",7),_("click",function(){return v(n),y(t.createReservation())}),s(11,"mat-icon",6),l(12,"add"),c(),l(13," Create Reservation "),c(),gt(),c(),s(14,"div",8)(15,"div",9)(16,"div",10)(17,"div")(18,"div",11)(19,"div",12)(20,"mat-icon",13),l(21,"hotel"),c(),s(22,"span"),l(23,"Total: "),s(24,"strong"),l(25),c()()(),s(26,"div",12)(27,"mat-icon",14),l(28,"check_circle"),c(),s(29,"span"),l(30,"Confirmed: "),s(31,"strong"),l(32),c()()(),s(33,"div",12)(34,"mat-icon",15),l(35,"person"),c(),s(36,"span"),l(37,"Checked In: "),s(38,"strong"),l(39),c()()(),s(40,"div",12)(41,"mat-icon",16),l(42,"schedule"),c(),s(43,"span"),l(44,"Pending: "),s(45,"strong"),l(46),c()()(),s(47,"div",12)(48,"mat-icon",17),l(49,"cancel"),c(),s(50,"span"),l(51,"Cancelled: "),s(52,"strong"),l(53),c()()()()(),s(54,"div",18)(55,"button",19),l(56),x(57,"titlecase"),s(58,"mat-icon",20),l(59,"expand_more"),c()(),s(60,"mat-menu",null,0)(62,"button",21),_("click",function(){return v(n),y(t.onViewModeChange("weekly"))}),l(63,"Weekly"),c(),s(64,"button",21),_("click",function(){return v(n),y(t.onViewModeChange("monthly"))}),l(65,"Monthly"),c()(),s(66,"button",19),l(67),x(68,"titlecase"),s(69,"mat-icon",20),l(70,"expand_more"),c()(),s(71,"mat-menu",null,1)(73,"button",21),_("click",function(){return v(n),y(t.onStatusChange("all"))}),l(74,"All"),c(),R(75,Bi,3,3,"button",22,Te),c(),s(77,"button",23),_("click",function(){return v(n),y(t.previousWeek())}),s(78,"mat-icon",6),l(79,"chevron_left"),c(),l(80," Previous "),c(),s(81,"button",24),l(82),c(),s(83,"button",23),_("click",function(){return v(n),y(t.nextWeek())}),l(84," Next "),s(85,"mat-icon",20),l(86,"chevron_right"),c()()()()(),s(87,"div",25)(88,"div",26),W(89,Hi,2,0,"div",27),s(90,"table",28)(91,"tfoot")(92,"tr")(93,"td",29)(94,"div",30)(95,"span",31),l(96,"Room Status"),c(),R(97,Vi,4,7,"div",32,ne),c()(),s(99,"td",33)(100,"div",34)(101,"span",35),l(102,"Reservation Status"),c(),s(103,"div",36),R(104,Li,5,4,"div",32,Te),c()()()()(),s(106,"thead")(107,"tr")(108,"th",37)(109,"span",38),l(110,"Rooms"),c()(),R(111,Ki,5,14,"th",39,ne),c()(),s(113,"tbody"),R(114,Yi,2,1,null,null,Se),c()()()()(),mt(116,qi,6,0,"ng-template",null,2,bt)}if(e&2){let n,o=ue(61),a=ue(72);I("showViewToggle",!0),d(25),g(((n=t.reservations.value())==null||n.reservations==null?null:n.reservations.length)||0),d(7),g(t.confirmedCount()||0),d(7),g(t.checkedInCount()||0),d(7),g(t.pendingCount()||0),d(7),g(t.cancelledCount()||0),d(2),I("matMenuTriggerFor",o),d(),G(" ",Z(57,13,t.viewMode())," "),d(10),I("matMenuTriggerFor",a),d(),G(" Status: ",Z(68,15,t.selectedStatus())," "),d(8),O(t.reservationStatuses),d(7),G(" ",t.getPeriodLabel()," "),d(7),$(t.reservations.isLoading()?89:-1),d(8),O(t.housekeepingStatuses),d(2),L("colspan",t.dateRange().length),d(5),O(t.reservationStatuses),d(7),O(t.dateRange()),d(3),O(t.roomsWithReservations())}},dependencies:[de,kt,he,ge,ve,_e,At,Pt,Ft,Nt,Ht,Bt,zt,Ut,ke,hi,pi,ze,gi,qt,Mt],encapsulation:2})};export{fi as ReservationsCalendar};
