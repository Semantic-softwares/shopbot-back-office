import{b as _e}from"./chunk-LSNVMFZZ.js";import{f as de}from"./chunk-LPOORG3R.js";import{a as fe}from"./chunk-QWARUEJB.js";import{a as ge,b as ve}from"./chunk-4SHNZOR7.js";import{a as se,b as pe,e as ce,h as ue}from"./chunk-LKRQNUDW.js";import{i as L}from"./chunk-WFQLSX5X.js";import{d as me}from"./chunk-WD3LGOJ6.js";import{b as ne,c as oe,d as re}from"./chunk-VN3HHLBZ.js";import{a as ee,b as te,h as ie}from"./chunk-THLNJRLH.js";import{a as ae,b as le}from"./chunk-YJKLGOC4.js";import{B as Z,b as z,d,g as U,h as H,m as J,n as K,s as Q,t as W,v as X,z as Y}from"./chunk-ADPCW6JI.js";import{a as j}from"./chunk-VNGKQKTG.js";import{b as R,c as $}from"./chunk-IYN665YT.js";import{Y as A,Z as G,aa as P}from"./chunk-OYVOT3CA.js";import{p as q,r as B}from"./chunk-6BQAOBQP.js";import{$a as l,Gb as s,Hb as p,Jc as N,Kb as I,Lb as k,Lc as T,Mb as u,Nb as i,Ob as t,Pb as c,Wb as w,_b as f,ac as b,ea as v,ib as _,ja as O,ka as F,ob as D,pc as o,qc as h,rc as x,va as V}from"./chunk-H33Y42PP.js";import{a as S,b as C}from"./chunk-GAL4ENT6.js";var Se=(r,n)=>n._id;function Ce(r,n){r&1&&(i(0,"mat-error"),o(1," Name is required "),t())}function he(r,n){r&1&&(i(0,"mat-error"),o(1," At Least value is required "),t())}function xe(r,n){r&1&&(i(0,"mat-error"),o(1," Value must be 0 or greater "),t())}function Ee(r,n){r&1&&(i(0,"mat-error"),o(1," At Most value is required "),t())}function Me(r,n){r&1&&(i(0,"mat-error"),o(1," Value must be 0 or greater "),t())}function ye(r,n){if(r&1){let a=w();i(0,"div",27)(1,"div")(2,"span",28),o(3),t(),i(4,"span",29),o(5),N(6,"currency"),t()(),i(7,"a",30),f("click",function(){let m=O(a).$implicit,g=b(2);return F(g.removeOption(m))}),i(8,"mat-icon"),o(9,"close"),t()()()}if(r&2){let a,e=n.$implicit,m=b(2);l(3),h(e.name),l(2),h(T(6,2,e.price,(a=m.storeStore.selectedStore())==null?null:a.currency))}}function Oe(r,n){if(r&1&&(i(0,"div",19)(1,"h4",26),o(2,"Added Options:"),t(),I(3,ye,10,5,"div",27,Se),t()),r&2){let a=b();l(3),k(a.selectedOptions)}}function Fe(r,n){r&1&&c(0,"mat-spinner",25)}var be=class r{constructor(n,a,e){this.fb=n;this.dialogRef=a;this.data=e;this.variantForm=this.fb.group({name:["",d.required],atLeast:[0,[d.required,d.min(0)]],atMost:[0,[d.required,d.min(0)]],enabled:[!0],store:[this.storeStore.selectedStore()?._id,d.required]}),this.newOptionForm=this.fb.group({name:["",d.required],price:[0,[d.required,d.min(0)]],inStock:[!0],store:[this.storeStore.selectedStore()?._id,d.required]}),e.isEdit&&e.variant&&(this.variantForm.patchValue(e.variant),e.variant._id&&this.productService.getGroupOptionItems(e.variant._id).subscribe({next:m=>{this.selectedOptions=m}}))}productService=v(fe);storeStore=v(L);snackBar=v(j);isSubmitting=V(!1);variantForm;existingOptions=me({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:n})=>this.productService.getStoreOptions(n.storeId)});selectedOptions=[];newOptionForm;addNewOption(){if(this.newOptionForm.valid){let n=C(S({},this.newOptionForm.value),{store:this.storeStore.selectedStore()?._id,variant:this.data.variant?._id});this.productService.saveOption(n).subscribe({next:a=>{this.selectedOptions.push(a),this.newOptionForm.reset({name:"",price:0,store:this.storeStore.selectedStore()?._id,inStock:!0}),this.snackBar.open("Option added successfully","Close",{duration:3e3})},error:()=>{this.snackBar.open("Error adding option","Close",{duration:3e3})}})}}removeOption(n){let a=this.selectedOptions.findIndex(e=>e._id===n._id);a>-1&&(this.selectedOptions.splice(a,1),this.productService.deleteOptionItem(n._id).subscribe({next:()=>{this.snackBar.open("Option removed successfully","Close",{duration:3e3})},error:()=>{this.snackBar.open("Error removing option","Close",{duration:3e3})}}))}onSubmit(){if(this.variantForm.valid){this.isSubmitting.set(!0);let n=C(S({},this.variantForm.getRawValue()),{options:this.selectedOptions.map(e=>e._id)});(this.data.isEdit?this.productService.updateVariant(n,this.data.variant._id):this.productService.createVariant(n)).subscribe({next:()=>{this.snackBar.open(`Variant ${this.data.isEdit?"updated":"created"} successfully`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dialogRef.close(!0)},error:()=>{this.snackBar.open(`Error ${this.data.isEdit?"updating":"creating"} variant`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isSubmitting.set(!1)}})}}onCancel(){this.dialogRef.close()}static \u0275fac=function(a){return new(a||r)(_(Y),_(se),_(pe))};static \u0275cmp=D({type:r,selectors:[["app-variant-dialog"]],decls:54,vars:13,consts:[[1,"p-6"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter variant name"],[1,"grid","grid-cols-2","gap-4"],["matInput","","type","number","formControlName","atLeast","min","0"],["matInput","","type","number","formControlName","atMost","min","0"],[1,"bg-gray-50","rounded-lg","space-y-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-lg","font-medium"],[1,"space-y-4",3,"formGroup"],["matInput","","formControlName","name","placeholder","e.g., Small, Medium, Large"],["matInput","","type","number","formControlName","price","min","0"],[1,"flex","items-center","justify-between"],["formControlName","inStock","color","primary"],["mat-stroked-button","","color","primary","type","button",3,"click","disabled"],[1,"mr-2"],[1,"mt-4","space-y-2"],[1,"flex","items-center","py-4","bg-gray-50","rounded-lg"],["formControlName","enabled","color","primary"],[1,"flex","justify-end","space-x-2","mt-6","pt-4","border-t","border-gray-200"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",1,"mr-2"],[1,"text-sm","font-medium","text-gray-700"],[1,"flex","items-center","justify-between","p-2","bg-white","rounded","border","border-gray-200"],[1,"font-medium"],[1,"ml-2","text-sm","text-gray-500"],["mat-icon-button","","color","warn",3,"click"]],template:function(a,e){if(a&1&&(i(0,"div",0)(1,"h2",1),o(2),t(),i(3,"form",2),f("ngSubmit",function(){return e.onSubmit()}),i(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),o(7,"Name"),t(),c(8,"input",5),s(9,Ce,2,0,"mat-error"),t(),i(10,"div",6)(11,"mat-form-field",4)(12,"mat-label"),o(13,"At Least"),t(),c(14,"input",7),s(15,he,2,0,"mat-error"),s(16,xe,2,0,"mat-error"),t(),i(17,"mat-form-field",4)(18,"mat-label"),o(19,"At Most"),t(),c(20,"input",8),s(21,Ee,2,0,"mat-error"),s(22,Me,2,0,"mat-error"),t()(),i(23,"div",9)(24,"div",10)(25,"h3",11),o(26,"Options"),t()(),i(27,"form",12)(28,"div",6)(29,"mat-form-field",4)(30,"mat-label"),o(31,"Option Name"),t(),c(32,"input",13),t(),i(33,"mat-form-field",4)(34,"mat-label"),o(35,"Price"),t(),c(36,"input",14),t()(),i(37,"div",15)(38,"mat-slide-toggle",16),o(39," In Stock "),t(),i(40,"a",17),f("click",function(){return e.addNewOption()}),i(41,"mat-icon",18),o(42,"add"),t(),o(43," Add Option "),t()()(),s(44,Oe,5,0,"div",19),t(),i(45,"div",20)(46,"mat-slide-toggle",21),o(47," Published "),t()()(),i(48,"div",22)(49,"button",23),f("click",function(){return e.onCancel()}),o(50,"Cancel"),t(),i(51,"button",24),s(52,Fe,1,0,"mat-spinner",25),o(53),t()()()()),a&2){let m,g,E,M,y;l(2),x(" ",e.data.isEdit?"Edit Variant":"Create New Variant"," "),l(),u("formGroup",e.variantForm),l(6),p((m=e.variantForm.get("name"))!=null&&m.hasError("required")?9:-1),l(6),p((g=e.variantForm.get("atLeast"))!=null&&g.hasError("required")?15:-1),l(),p((E=e.variantForm.get("atLeast"))!=null&&E.hasError("min")?16:-1),l(5),p((M=e.variantForm.get("atMost"))!=null&&M.hasError("required")?21:-1),l(),p((y=e.variantForm.get("atMost"))!=null&&y.hasError("min")?22:-1),l(5),u("formGroup",e.newOptionForm),l(13),u("disabled",!e.newOptionForm.valid),l(4),p(e.selectedOptions.length>0?44:-1),l(7),u("disabled",!e.variantForm.valid||e.isSubmitting()),l(),p(e.isSubmitting()?52:-1),l(),x(" ",e.data.isEdit?"Update":"Create"," ")}},dependencies:[B,ue,ce,P,G,A,ne,ie,ee,te,re,oe,$,R,Z,J,z,K,U,H,X,W,Q,ve,ge,le,ae,de,_e,q],encapsulation:2})};export{be as a};
