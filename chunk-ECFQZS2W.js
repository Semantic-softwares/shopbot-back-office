import{b as Se}from"./chunk-24SFQJLQ.js";import{a as ve}from"./chunk-P5XCBOGO.js";import{a as _e,b as be}from"./chunk-BTXZK3DD.js";import{a as fe,b as ge}from"./chunk-LIUA42FM.js";import{b as ie,c as re,d as ne}from"./chunk-3632TDEK.js";import{a as R}from"./chunk-I24LUS2H.js";import{c as ue}from"./chunk-DSRTAZMJ.js";import{a as se,b as de,d as pe,g as ce}from"./chunk-H55FNLX4.js";import{d as le}from"./chunk-NGGCDKIH.js";import{a as Z,b as ee,h as te}from"./chunk-JGZ2V5AL.js";import{B as X,D as Y,b as $,d as s,g as z,h as U,m as H,n as J,p as K,s as Q,x as W}from"./chunk-CXVWFC6J.js";import{a as oe,b as ae}from"./chunk-7C3RSL2D.js";import{o as P,p as j,q as L}from"./chunk-FSA22CPB.js";import{b as me}from"./chunk-6U4I4OYM.js";import{k as B,s as A,t as G}from"./chunk-DWCYWQVU.js";import{Cc as T,Db as h,Eb as C,Ec as q,Hb as k,Ib as w,Jb as d,Kb as i,Lb as t,Mb as p,Qb as N,Ub as c,Vb as _,_a as m,db as g,fa as f,ic as n,jc as x,kb as D,kc as E,la as F,ma as I,qb as v,va as V}from"./chunk-5AECHVKR.js";import{a as b,b as S}from"./chunk-EQDQRRRY.js";var Ce=(o,r)=>r._id;function xe(o,r){o&1&&(i(0,"mat-error"),n(1," Name is required "),t())}function Ee(o,r){o&1&&(i(0,"mat-error"),n(1," At Least value is required "),t())}function Me(o,r){o&1&&(i(0,"mat-error"),n(1," Value must be 0 or greater "),t())}function ye(o,r){o&1&&(i(0,"mat-error"),n(1," At Most value is required "),t())}function Oe(o,r){o&1&&(i(0,"mat-error"),n(1," Value must be 0 or greater "),t())}function Fe(o,r){if(o&1){let a=N();i(0,"div",28)(1,"div")(2,"span",29),n(3),t(),i(4,"span",30),n(5),T(6,"currency"),t()(),i(7,"a",31),c("click",function(){let l=F(a).$implicit,u=_(2);return I(u.removeOption(l))}),i(8,"mat-icon"),n(9,"close"),t()()()}if(o&2){let a,e=r.$implicit,l=_(2);m(3),x(e.name),m(2),x(q(6,2,e.price,(a=l.storeStore.selectedStore())==null?null:a.currency))}}function Ie(o,r){if(o&1&&(i(0,"div",20)(1,"h4",27),n(2,"Added Options:"),t(),k(3,Fe,10,5,"div",28,Ce),t()),o&2){let a=_();m(3),w(a.selectedOptions)}}function Ve(o,r){o&1&&p(0,"mat-spinner",26)}var he=class o{constructor(r,a,e){this.fb=r;this.dialogRef=a;this.data=e;this.variantForm=this.fb.group({name:["",s.required],atLeast:[0,[s.required,s.min(0)]],atMost:[0,[s.required,s.min(0)]],enabled:[!0],store:[this.storeStore.selectedStore()?._id,s.required]}),this.newOptionForm=this.fb.group({name:["",s.required],price:[0,[s.required,s.min(0)]],inStock:[!0],store:[this.storeStore.selectedStore()?._id,s.required]}),e.isEdit&&e.variant&&(this.variantForm.patchValue(e.variant),e.variant._id&&this.productService.getGroupOptionItems(e.variant._id).subscribe({next:l=>{this.selectedOptions=l}}))}productService=f(ve);storeStore=f(me);snackBar=f(R);isSubmitting=V(!1);variantForm;existingOptions=le({params:()=>({storeId:this.storeStore.selectedStore()?._id}),stream:({params:r})=>this.productService.getStoreOptions(r.storeId)});selectedOptions=[];newOptionForm;addNewOption(){if(this.newOptionForm.valid){let r=S(b({},this.newOptionForm.value),{store:this.storeStore.selectedStore()?._id,variant:this.data.variant?._id});this.productService.saveOption(r).subscribe({next:a=>{this.selectedOptions.push(a),this.newOptionForm.reset({name:"",price:0,store:this.storeStore.selectedStore()?._id,inStock:!0}),this.snackBar.open("Option added successfully","Close",{duration:3e3})},error:()=>{this.snackBar.open("Error adding option","Close",{duration:3e3})}})}}removeOption(r){let a=this.selectedOptions.findIndex(e=>e._id===r._id);a>-1&&(this.selectedOptions.splice(a,1),this.productService.deleteOptionItem(r._id).subscribe({next:()=>{this.snackBar.open("Option removed successfully","Close",{duration:3e3})},error:()=>{this.snackBar.open("Error removing option","Close",{duration:3e3})}}))}onSubmit(){if(this.variantForm.valid){this.isSubmitting.set(!0);let r=S(b({},this.variantForm.getRawValue()),{options:this.selectedOptions.map(e=>e._id)});(this.data.isEdit?this.productService.updateVariant(r,this.data.variant._id):this.productService.createVariant(r)).subscribe({next:()=>{this.snackBar.open(`Variant ${this.data.isEdit?"updated":"created"} successfully`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.dialogRef.close(!0)},error:()=>{this.snackBar.open(`Error ${this.data.isEdit?"updating":"creating"} variant`,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isSubmitting.set(!1)}})}}onCancel(){this.dialogRef.close()}static \u0275fac=function(a){return new(a||o)(g(X),g(se),g(de))};static \u0275cmp=D({type:o,selectors:[["app-variant-dialog"]],decls:54,vars:13,consts:[[1,"p-6"],["mat-dialog-title","",1,"text-xl","font-bold","mb-4"],[3,"ngSubmit","formGroup"],[1,"space-y-4"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","Enter variant name"],[4,"ngIf"],[1,"grid","grid-cols-2","gap-4"],["matInput","","type","number","formControlName","atLeast","min","0"],["matInput","","type","number","formControlName","atMost","min","0"],[1,"bg-gray-50","rounded-lg","space-y-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-lg","font-medium"],[1,"space-y-4",3,"formGroup"],["matInput","","formControlName","name","placeholder","e.g., Small, Medium, Large"],["matInput","","type","number","formControlName","price","min","0"],[1,"flex","items-center","justify-between"],["formControlName","inStock","color","primary"],["mat-stroked-button","","color","primary","type","button",3,"click","disabled"],[1,"mr-2"],[1,"mt-4","space-y-2"],[1,"flex","items-center","py-4","bg-gray-50","rounded-lg"],["formControlName","enabled","color","primary"],[1,"flex","justify-end","space-x-2","mt-6","pt-4","border-t","border-gray-200"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",1,"mr-2"],[1,"text-sm","font-medium","text-gray-700"],[1,"flex","items-center","justify-between","p-2","bg-white","rounded","border","border-gray-200"],[1,"font-medium"],[1,"ml-2","text-sm","text-gray-500"],["mat-icon-button","","color","warn",3,"click"]],template:function(a,e){if(a&1&&(i(0,"div",0)(1,"h2",1),n(2),t(),i(3,"form",2),c("ngSubmit",function(){return e.onSubmit()}),i(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),n(7,"Name"),t(),p(8,"input",5),v(9,xe,2,0,"mat-error",6),t(),i(10,"div",7)(11,"mat-form-field",4)(12,"mat-label"),n(13,"At Least"),t(),p(14,"input",8),v(15,Ee,2,0,"mat-error",6)(16,Me,2,0,"mat-error",6),t(),i(17,"mat-form-field",4)(18,"mat-label"),n(19,"At Most"),t(),p(20,"input",9),v(21,ye,2,0,"mat-error",6)(22,Oe,2,0,"mat-error",6),t()(),i(23,"div",10)(24,"div",11)(25,"h3",12),n(26,"Options"),t()(),i(27,"form",13)(28,"div",7)(29,"mat-form-field",4)(30,"mat-label"),n(31,"Option Name"),t(),p(32,"input",14),t(),i(33,"mat-form-field",4)(34,"mat-label"),n(35,"Price"),t(),p(36,"input",15),t()(),i(37,"div",16)(38,"mat-slide-toggle",17),n(39," In Stock "),t(),i(40,"a",18),c("click",function(){return e.addNewOption()}),i(41,"mat-icon",19),n(42,"add"),t(),n(43," Add Option "),t()()(),h(44,Ie,5,0,"div",20),t(),i(45,"div",21)(46,"mat-slide-toggle",22),n(47," Published "),t()()(),i(48,"div",23)(49,"button",24),c("click",function(){return e.onCancel()}),n(50,"Cancel"),t(),i(51,"button",25),h(52,Ve,1,0,"mat-spinner",26),n(53),t()()()()),a&2){let l,u,M,y,O;m(2),E(" ",e.data.isEdit?"Edit Variant":"Create New Variant"," "),m(),d("formGroup",e.variantForm),m(6),d("ngIf",(l=e.variantForm.get("name"))==null?null:l.hasError("required")),m(6),d("ngIf",(u=e.variantForm.get("atLeast"))==null?null:u.hasError("required")),m(),d("ngIf",(M=e.variantForm.get("atLeast"))==null?null:M.hasError("min")),m(5),d("ngIf",(y=e.variantForm.get("atMost"))==null?null:y.hasError("required")),m(),d("ngIf",(O=e.variantForm.get("atMost"))==null?null:O.hasError("min")),m(5),d("formGroup",e.newOptionForm),m(13),d("disabled",!e.newOptionForm.valid),m(4),C(e.selectedOptions.length>0?44:-1),m(7),d("disabled",!e.variantForm.valid||e.isSubmitting()),m(),C(e.isSubmitting()?52:-1),m(),E(" ",e.data.isEdit?"Update":"Create"," ")}},dependencies:[G,B,A,ce,pe,L,j,P,ie,te,Z,ee,ne,re,ae,oe,Y,H,$,J,z,U,W,K,Q,be,_e,ge,fe,ue,Se],encapsulation:2})};export{he as a};
