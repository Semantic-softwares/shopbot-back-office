import{a as P}from"./chunk-KP7TGH7C.js";import{E as F,Lc as v,M as K,Mc as x,Nc as R,W as z,Z as M,aa as O,b as E,c as T,fa as S,g as C,ka as k,l as A,p as W,pa as D,ra as b,ua as w,va as H}from"./chunk-5AECHVKR.js";import{a as r,b as p}from"./chunk-EQDQRRRY.js";function U(e){let t=v(()=>e());return Q(t)?new Proxy(e,{get(n,o){return o in t?(w(n[o])||Object.defineProperty(n,o,{value:x(()=>n()[o]),configurable:!0}),U(n[o])):n[o]}}):e}var J=[WeakSet,WeakMap,Promise,Date,Error,RegExp,ArrayBuffer,DataView,Function];function Q(e){if(e===null||typeof e!="object"||X(e))return!1;let t=Object.getPrototypeOf(e);if(t===Object.prototype)return!0;for(;t&&t!==Object.prototype;){if(J.includes(t.constructor))return!1;t=Object.getPrototypeOf(t)}return t===Object.prototype}function X(e){return typeof e?.[Symbol.iterator]=="function"}var Z=new WeakMap,a=Symbol("STATE_SOURCE");function u(e,...t){e[a].update(n=>t.reduce((o,s)=>r(r({},o),typeof s=="function"?s(o):s),n)),te(e)}function N(e){return e[a]()}function ee(e){return Z.get(e[a])||[]}function te(e){let t=ee(e);for(let n of t){let o=v(()=>N(e));n(o)}}function _(...e){let t=[...e],n=typeof t[0]=="function"?{}:t.shift(),o=t;return(()=>{class c{constructor(){let f=o.reduce((g,G)=>G(g),ne()),{stateSignals:h,props:m,methods:y,hooks:i}=f,d=r(r(r({},h),m),y);this[a]=f[a];for(let g of Reflect.ownKeys(d))this[g]=d[g];let{onInit:j,onDestroy:I}=i;j&&j(),I&&S(b).onDestroy(I)}static \u0275fac=function(h){return new(h||c)};static \u0275prov=O({token:c,factory:c.\u0275fac,providedIn:n.providedIn||null})}return c})()}function ne(){return{[a]:H({}),stateSignals:{},props:{},methods:{},hooks:{}}}function oe(e){return t=>{let n=e(r(r(r({[a]:t[a]},t.stateSignals),t.props),t.methods));return Reflect.ownKeys(n),p(r({},t),{props:r(r({},t.props),n)})}}function $(e){return oe(e)}function q(e){return t=>{let n=r(r(r({[a]:t[a]},t.stateSignals),t.props),t.methods),o=typeof e=="function"?e(n):e,s=c=>{let l=o[c],f=t.hooks[c];return l?()=>{f&&f(),l(n)}:f};return p(r({},t),{hooks:{onInit:s("onInit"),onDestroy:s("onDestroy")}})}}function B(e){return t=>{let n=e(r(r(r({[a]:t[a]},t.stateSignals),t.props),t.methods));return Reflect.ownKeys(n),p(r({},t),{methods:r(r({},t.methods),n)})}}function V(e){return t=>{let n=typeof e=="function"?e():e,o=Reflect.ownKeys(n);t[a].update(c=>r(r({},c),n));let s=o.reduce((c,l)=>{let f=x(()=>t[a]()[l]);return p(r({},c),{[l]:U(f)})},{});return p(r({},t),{stateSignals:r(r({},t.stateSignals),s)})}}function Y(e,t,n){let o=typeof e=="function"?{next:e,error:t,complete:n}:e;return s=>s.pipe(M({next:o.next,complete:o.complete}),F(c=>(o.error(c),A)),o.finalize?K(o.finalize):c=>c)}function L(e,t){t?.injector||k(L);let n=t?.injector??S(D),o=new C,s=e(o).subscribe();n.get(b).onDestroy(()=>s.unsubscribe());let c=(l,f)=>{if(re(l))return o.next(l),{destroy:E};let h=ie(),m=f?.injector??h??n;if(w(l)){let i=R(()=>{let d=l();v(()=>o.next(d))},{injector:m});return s.add({unsubscribe:()=>i.destroy()}),i}let y=l.subscribe(i=>o.next(i));return s.add(y),m!==n&&m.get(b).onDestroy(()=>y.unsubscribe()),{destroy:()=>y.unsubscribe()}};return c.destroy=s.unsubscribe.bind(s),c}function re(e){return!w(e)&&!W(e)}function ie(){try{return S(D)}catch{return}}var ce={stores:[],isLoading:!1,selectedStore:null,error:null,logoPath:null,bannerPath:null},Re=_({providedIn:"root"},V(ce),$(({stores:e})=>({storesCount:x(()=>e().length)})),B((e,t=S(P))=>{function n(i){u(e,{isLoading:i})}function o(i){t.saveStoreLocally(i),u(e,{selectedStore:i})}function s(i){t.saveStoresLocally(i),u(e,{stores:i})}function c(){u(e,{stores:[]})}function l(){let i=t.getStoreLocally;i&&u(e,{selectedStore:i})}function f(i,d){let j=e.selectedStore();if(j){let I=j.staffs.map(g=>g._id===i?r(r({},g),d):g);u(e,{selectedStore:p(r({},j),{staffs:I})})}}function h(i){let d=e.selectedStore();d&&u(e,{selectedStore:p(r(r({},d),i),{_id:d._id})})}function m(i){u(e,{logoPath:i})}let y=L(T(M(()=>u(e,{isLoading:!0,error:null})),z(i=>t.updateStore(e.selectedStore()._id,i).pipe(Y({next(d){u(e,{isLoading:!1,error:null,logoPath:null,bannerPath:null}),h(i)},error(d){u(e,{isLoading:!1,error:d})}})))));return{setSelectedStores:s,clearStores:c,updateStore$:y,updateStore:h,updateStoreStaffs:f,setSelectedStore:o,initializeFromStorage:l,updateLogoPath:m,setLoadingState:n}}),q({onInit(e,t=S(P)){let n=t.getStoresLocally,o=t.getStoreLocally;n&&n.length>0&&u(e,{stores:n}),o&&u(e,{selectedStore:o})}}));export{Re as a};
